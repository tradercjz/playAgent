<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="DolphinDB 支持流数据的发布、订阅、预处理、实时内存计算、复杂指标的滚动窗口计算等，既能处理分析实时数据，也能对历史数据进行计算分析，帮助用户利用、发挥这些数据的价值。为满足流数据服务不中断的需求，DolphinDB 提供了流数据的高可用功能。 一个发布订阅流数据系统包含三个角色: Publisher（生产者），Broker 和 Subscriber（消费者）。在 DolphinDB ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../stream/str_intro.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="streamha"/><title>流数据高可用</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="streamha-d9713e4783"/><meta name="wh-source-relpath" content="stream/str_ha.dita"/><meta name="wh-out-relpath" content="stream/str_ha.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="streamha" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="chap7_tutorials_streaming"><div class="title"><a href="../stream/str_intro.html"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li class="active"><div class="topicref" data-id="streamha"><div class="title"><a href="../stream/str_ha.html"><span class="keyword label">流数据高可用</span></a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="streamfunctions-d9713e3813" class="topicref" data-id="streamfunctions" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action streamfunctions-d9713e3813-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_funcs.html" id="streamfunctions-d9713e3813-link">功能简介</a></div></div></li><li role="treeitem"><div data-tocid="入门示例-01实时计算买卖价差-d9713e4044" class="topicref" data-id="入门示例-01实时计算买卖价差" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/try_example1.html" id="入门示例-01实时计算买卖价差-d9713e4044-link">入门示例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="内置流式计算算子-d9713e4090" class="topicref" data-id="内置流式计算算子" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 内置流式计算算子-d9713e4090-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_operator.html" id="内置流式计算算子-d9713e4090-link"><span class="keyword label">流式计算算子</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="streamingEngineTopic-d9713e4229" class="topicref" data-id="streamingEngineTopic" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action streamingEngineTopic-d9713e4229-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/themes/streamingEngine.html" id="streamingEngineTopic-d9713e4229-link"><span class="keyword label">流计算引擎</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e4506" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e4506-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_join_engine.html" id="chap7_tutorials_streaming-d9713e4506-link"><span class="keyword label">内置多数据源流式关联引擎</span></a></div></div></li><li role="treeitem" class="active"><div data-tocid="streamha-d9713e4783" class="topicref" data-id="streamha" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_ha.html" id="streamha-d9713e4783-link"><span class="keyword label">流数据高可用</span></a></div></div></li><li role="treeitem"><div data-tocid="流计算状态监控-d9713e4830" class="topicref" data-id="流计算状态监控" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_monitor.html" id="流计算状态监控-d9713e4830-link">流计算状态监控</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="replay-d9713e4876" class="topicref" data-id="replay" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action replay-d9713e4876-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_replay.html" id="replay-d9713e4876-link"><span class="keyword label">历史数据回放</span></a></div></div></li><li role="treeitem"><div data-tocid="流批一体功能-d9713e5061" class="topicref" data-id="流批一体功能" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_batch.html" id="流批一体功能-d9713e5061-link"><span class="keyword label">流批一体</span></a></div></div></li><li role="treeitem"><div data-tocid="streamengineparser-解析原理介绍-d9713e5108" class="topicref" data-id="streamengineparser-解析原理介绍" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_eng_parser.html" id="streamengineparser-解析原理介绍-d9713e5108-link">StreamEngineParser 解析原理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="realtime_data_acces-d9713e5155" class="topicref" data-id="realtime_data_acces" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action realtime_data_acces-d9713e5155-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/realtime_data_acces.html" id="realtime_data_acces-d9713e5155-link">实时流数据接入</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="cep-d9713e5617" class="topicref" data-id="cep" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action cep-d9713e5617-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/cep.html" id="cep-d9713e5617-link">复杂事件处理（CEP）引擎</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e6123" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e6123-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/local_sub.html" id="tocId-d9713e6123-link">流处理结果交互方式</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e6312" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e6312-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_altair.html" id="tocId-d9713e6312-link">数据可视化工具</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e6405" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e6405-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_auto_sub.html" id="tocId-d9713e6405-link">金融场景应用案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7097" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7097-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_str_app_iot.html" id="tocId-d9713e7097-link">物联网场景应用案例</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1">
    <h1 class="- topic/title title topictitle1" id="ariaid-title1"><span class="- topic/keyword keyword label">流数据高可用</span></h1>
    <div class="- topic/body body">
        <p class="- topic/p p">DolphinDB
            支持流数据的发布、订阅、预处理、实时内存计算、复杂指标的滚动窗口计算等，既能处理分析实时数据，也能对历史数据进行计算分析，帮助用户利用、发挥这些数据的价值。为满足流数据服务不中断的需求，DolphinDB
            提供了流数据的高可用功能。</p>
        <p class="- topic/p p">一个发布订阅流数据系统包含三个角色: Publisher（生产者），Broker 和 Subscriber（消费者）。在 DolphinDB 流数据框架中，Broker 由
            DolphinDB 的数据节点或计算节点担任，Publisher 和 Subscriber 由 DolphinDB 数据节点、计算节点或第三方 API 程序担任。</p>
        <figure class="- topic/fig fig fignone" id="streamha__fig_oqd_4jl_xzb" data-ofbid="streamha__fig_oqd_4jl_xzb">
            <br/><div class="imageleft"><img class="- topic/image image imageleft" id="streamha__image_w4h_bgh_rzb" height="500" src="images/str_ha_1.png" width="900"/></div><br/>
        </figure>
        <p class="- topic/p p">如上图所示，DolphinDB 流数据高可用功能采用了基于 Raft 协议的高可用多副本架构：</p>
        <ul class="- topic/ul ul" id="streamha__ul_h3f_pjl_xzb" data-ofbid="streamha__ul_h3f_pjl_xzb">
            <li class="- topic/li li">
                <p class="- topic/p p">相同流数据的副本存储在 Raft 组内不同节点上，Raft 协议用来维护多个副本的一致性。</p>
            </li>
            <li class="- topic/li li">
                <p class="- topic/p p">Raft 组具有自动恢复的性质，当少数节点失效的时候不影响 Raft 组的正常工作，当大多数节点失效的时候，Raft 组则会停止服务。Raft
                    组能够容忍小于半数的节点宕机，例如包含三个节点的组，可以容忍一个节点出现故障；包含五个节点的组，可以容忍两个节点出现故障。</p>
            </li>
            <li class="- topic/li li">
                <p class="- topic/p p">正常情况下 Raft 组内只有一个 Leader（领导节点）负责响应来自所有客户端的请求、为客户端提供服务，其他节点都是 Follower（追随节点）。</p>
            </li>
        </ul>
        <p class="- topic/p p">DolphinDB 流数据的高可用包括 Broker 的高可用、生产者和消费者的高可用，并具有以下特性：</p>
        <ul class="- topic/ul ul" id="streamha__ul_i3f_pjl_xzb" data-ofbid="streamha__ul_i3f_pjl_xzb">
            <li class="- topic/li li">
                <p class="- topic/p p">每个节点上可以定义一个或多个 Raft 组，一个 Raft 组可以接纳多个流数据表。</p>
            </li>
            <li class="- topic/li li">
                <p class="- topic/p p">一个流数据表创建时可指定一个 Raft 组，表明该表为高可用的流数据表。如果没有指定 Raft 组，就是普通的流数据表，不具备高可用功能。</p>
            </li>
            <li class="- topic/li li">
                <p class="- topic/p p">Publisher 向 Leader 写入数据。若写入失败或者收到非 Leader 异常，就自动切换到新的 Leader 节点写入。</p>
            </li>
            <li class="- topic/li li">
                <p class="- topic/p p">Subscriber 从 Leader 订阅流数据。Leader 重新选举后，从 Leader 变换为 Follower 时，Broker 会主动断开这个
                    Raft 组内所有的流表对应的订阅端连接。Subscriber 连接被断开，或者收到新的 Leader 选出的通知后，会自动向新的 Leader
                    发起订阅。</p>
            </li>
        </ul>
        <p class="- topic/p p">以下内容介绍如何使用 Broker 的高可用功能、生产者和消费者的高可用功能，以及如何提高高可用流数据流表的写入性能。</p>
    </div>
    <article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="broker-的高可用">
        <h2 class="- topic/title title topictitle2" id="ariaid-title2">Broker 的高可用</h2>
        <article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="集群配置">
            <h3 class="- topic/title title topictitle3" id="ariaid-title3">集群配置</h3>
            <div class="- topic/body body">
                <p class="- topic/p p">在启用流数据高可用功能前，需要先在多个服务器上部署 DolphinDB
                    集群（目前高可用功能仅在集群中支持，在单节点模式中不支持)，然后根据流数据教程配置相关参数，再创建高可用流数据表。</p>
                <figure class="- topic/fig fig fignone" id="集群配置__fig_xyk_tkl_xzb" data-ofbid="集群配置__fig_xyk_tkl_xzb">
                    <img class="- topic/image image" id="集群配置__image_cfv_skl_xzb" src="images/str_ha_2.png" height="547" width="787"/>
                </figure>
                <p class="- topic/p p">高可用相关的配置项主要的有：</p>
                <ul class="- topic/ul ul" id="集群配置__ul_kr4_tjl_xzb" data-ofbid="集群配置__ul_kr4_tjl_xzb">
                    <li class="- topic/li li">
                        <p class="- topic/p p">streamingHAMode：指定高可用功能采用的协议，当设置为 Raft 时，表示流数据高可用功能采用了 Raft 协议。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">streamingRaftGroups：配置 Raft
                            组。格式为:"groupId:node_name1:node_name2:node_name3"，其中 groupId 表示 Raft
                            组号，为大于等于 2 的整数，node_name 为数据节点或计算节点的节点名字，须配置至少 3
                            个，中间用冒号分隔。系统支持配置多组，用逗号分隔。建议每组的数据节点分别位于不同的服务器上，以防止一台服务器宕机，组内节点都不可用。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">persistenceDir：流数据表的保存路径。高可用流数据表数据要保存到磁盘上，必须配置
                            <em class="+ topic/ph hi-d/i ph i">persistenceDir</em>。在集群模式中，应当为每个节点配置不同的 <em class="+ topic/ph hi-d/i ph i">persistenceDir</em>。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">streamingHADir：流数据 Raft 日志文件的存储目录。Raft
                            日志包括注册表、删除表、append（追加）数据等信息。为保证断电后不丢失数据，DolphinDB 会调用 fsync 把日志刷到磁盘上。一般
                            HDD 硬盘上 fsync 性能比较差，例如有的 HDD 硬盘刷一次要 10-30 毫秒，为了保证性能，建议这个目录配置在 SSD
                            硬盘上。如果不配置，系统默认值为
                            &lt;HomeDir&gt;/log/streamLog。如果在同一个服务器上部署了多个数据节点，每个节点应当配置不同的
                                <em class="+ topic/ph hi-d/i ph i">streamingHADir</em>。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">streamingHAPurgeInterval：Raft 日志垃圾回收周期。在系统运行时，节点中的 Raft
                            日志信息若不断增长，会影响节点恢复时状态回放的效率。Raft 采用 Checkpoint（检查点）的方式来截断日志。做 Checkpoint
                            有一些需要注意的性能点：不要做得太频繁，否则消耗磁盘带宽；也不要做得太不频繁，否则一旦节点重启需要回放大量日志，影响可用性。系统默认值300，单位为秒。</p>
                    </li>
                </ul>
                <p class="- topic/p p">用户需要在集群 <em class="+ topic/ph hi-d/i ph i">cluster.cfg</em> 配置文件中配置上述参数。以下例子配置了 2 个 Raft 组，组 2 包含 3 个数据节点，分别为
                    DataNode1、DataNode3 和 DataNode5。组 3 包含 3 个数据节点，分别为 DataNode2、DataNode4 和
                    DataNode6。</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="集群配置__codeblock_lr4_tjl_xzb" data-ofbid="集群配置__codeblock_lr4_tjl_xzb">streamingHAMode=raft
streamingRaftGroups=<span class="hl-number">2</span>:DataNode1:DataNode3:DataNode5,<span class="hl-number">3</span>:DataNode2:DataNode4:DataNode6
persistenceDir=/ssd/dolphindb/persistenceDir/&lt;ALIAS&gt;
streamingHADir=/ssd/dolphindb/streamLog/&lt;ALIAS&gt;</pre>
                <p class="- topic/p p">注意：</p>
                <ul class="- topic/ul ul" id="集群配置__ul_mr4_tjl_xzb" data-ofbid="集群配置__ul_mr4_tjl_xzb">
                    <li class="- topic/li li">
                        <p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">streamingRaftGroups</em> 配置的节点名字，必须和配置文件 <em class="+ topic/ph hi-d/i ph i">cluster.nodes</em>
                            中配置的数据节点或计算节点名字一致</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">persistenceDir</em> 和 <em class="+ topic/ph hi-d/i ph i">streamingHADir</em> 配置的路径必须根据实际服务器的目录情况配置</p>
                    </li>
                </ul>
            </div>
        </article>
        <article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="获取-raft-组">
            <h3 class="- topic/title title topictitle3" id="ariaid-title4">获取 Raft 组</h3>
            <div class="- topic/body body">
                <p class="- topic/p p">可使用<code class="+ topic/ph pr-d/codeph ph codeph">getStreamingRaftGroups</code>函数以获取与验证用户在集群配置的 Raft 组。</p>
                <p class="- topic/p p">此函数只能获取当前数据节点上配置的 Raft 组。例如在上述例子中配置的
                        DataNode1上运行<code class="+ topic/ph pr-d/codeph ph codeph">getStreamingRaftGroups()</code>，结果如下：</p>
                <div class="table-container"><table class="- topic/table table" id="获取-raft-组__table_aph_bgh_rzb" data-ofbid="获取-raft-组__table_aph_bgh_rzb" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead">
                            <tr class="- topic/row">
                                <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="获取-raft-组__table_aph_bgh_rzb__entry__1">id</th>
                                <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="获取-raft-组__table_aph_bgh_rzb__entry__2">sites</th>
                            </tr>
                        </thead><tbody class="- topic/tbody tbody">
                            <tr class="- topic/row">
                                <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="获取-raft-组__table_aph_bgh_rzb__entry__1">2</td>
                                <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="获取-raft-组__table_aph_bgh_rzb__entry__2">192.168.1.11:19151:DataNode1,192.168.1.12:19153:DataNode3,192.168.1.13:19155:DataNode5</td>
                            </tr>
                        </tbody></table></div>
            </div>
        </article>
        <article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="获取-raft-组的-leader">
            <h3 class="- topic/title title topictitle3" id="ariaid-title5">获取 Raft 组的 Leader</h3>
            <div class="- topic/body body">
                <p class="- topic/p p">在集群中配置 Raft 组后，每个 Raft 组会自动选出 Leader，组中其他节点为 Follower，由 Leader 为客户端提供流数据订阅服务。当
                    Leader 出现故障不可用时，系统会自动选举出新的 Leader 来提供流数据服务。获取指定 raft 组的
                        Leader，可以调用函数<code class="+ topic/ph pr-d/codeph ph codeph">getStreamingLeader</code>。函数语法如下：</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="获取-raft-组的-leader__codeblock_bph_bgh_rzb" data-ofbid="获取-raft-组的-leader__codeblock_bph_bgh_rzb">getStreamingLeader(groupId)</pre>
                <p class="- topic/p p">其中参数 <em class="+ topic/ph hi-d/i ph i">groupId</em> 是 Raft 组的编号。</p>
                <p class="- topic/p p">需要注意的是，要获取指定 Raft 组的 Leader，只能在该组配置的数据节点上运行该函数。例如要获取上述例子配置的 Raft 组 2 的 Leader，可以在
                    DataNode1、DataNode3 或 DataNode5 上运行下列代码：</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="获取-raft-组的-leader__codeblock_cph_bgh_rzb" data-ofbid="获取-raft-组的-leader__codeblock_cph_bgh_rzb">getStreamingLeader(<span class="hl-number">2</span>)</pre>
                <p class="- topic/p p">若要在其他节点上获取组 2 的 Leader，需要先获取配置了该组的任意节点，然后使用<code class="+ topic/ph pr-d/codeph ph codeph">rpc</code>函数到该节点获取
                    Leader。例子如下：</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="获取-raft-组的-leader__codeblock_ifz_ngh_rzb" data-ofbid="获取-raft-组的-leader__codeblock_ifz_ngh_rzb">t = <strong class="hl-keyword">exec</strong> top <span class="hl-number">1</span> id,node <strong class="hl-keyword">from</strong> pnodeRun(getStreamingRaftGroups) where id =<span class="hl-number">2</span>
leader = rpc(t.node[<span class="hl-number">0</span>],getStreamingLeader,t.id[<span class="hl-number">0</span>])</pre>
            </div>
        </article>
        <article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="创建高可用流数据表">
            <h3 class="- topic/title title topictitle3" id="ariaid-title6">创建高可用流数据表</h3>
            <div class="- topic/body body">
                <p class="- topic/p p">创建高可用流数据表使用函数<code class="+ topic/ph pr-d/codeph ph codeph">haStreamTable</code>。语法如下：</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="创建高可用流数据表__codeblock_eph_bgh_rzb" data-ofbid="创建高可用流数据表__codeblock_eph_bgh_rzb">haStreamTable(raftGroup, table, tableName, cacheLimit, [keyColumn], [retentionMinutes=<span class="hl-number">1440</span>])</pre>
                <p class="- topic/p p">参数 <em class="+ topic/ph hi-d/i ph i">raftGroup</em> 是一个大于 1 的整数，表示 Raft 组的 ID，它必须是通过 streamingRaftGroups 配置的 Raft
                    组中的一个成员。</p>
                <p class="- topic/p p">可选参数 <em class="+ topic/ph hi-d/i ph i">keyColumn</em> 是一个字符串，表示主键。设置了 <em class="+ topic/ph hi-d/i ph i">keyColumn</em> 后，系统能根据 <em class="+ topic/ph hi-d/i ph i">keyColumn</em>
                    自动过滤重复数据。比如从设备采集的流数据，这个 <em class="+ topic/ph hi-d/i ph i">keyColumn</em>
                        产生规则可以是设备编号+每个设备的消息唯一号；从股市获取的股票信息，<em class="+ topic/ph hi-d/i ph i">keyColumn</em>
                    可以是股票编码+每个股票消息的唯一号，这样从多个采集源采集入库或重复入库，都能保证数据不重复。</p>
                <p class="- topic/p p">一个 Raft 组可以包含多个高可用流数据表。这里要注意以下几点：</p>
                <ul class="- topic/ul ul" id="创建高可用流数据表__ul_fph_bgh_rzb" data-ofbid="创建高可用流数据表__ul_fph_bgh_rzb">
                    <li class="- topic/li li">
                        <p class="- topic/p p">高可用流数据表在日志中持久化了表结构信息，重启后不需要重新建表。普通流数据表在节点重启后，需要重新创建流数据表。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">客户端只需订阅 Raft 组中任意一个数据节点上的高可用流数据表，并启用订阅的自动重连功能。Leader
                            上的高可用流数据表会向客户端发布数据。如果 Raft 组中的 Leader 宕机，系统会选举出新的 Leader
                            继续发布数据，客户端会自动切换订阅到新的 Leader 上的高可用流数据表。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">在启动高可用流数据功能后，普通流数据表和高可用流数据表可共存于同一个数据节点上。普通流数据表与高可用流数据表也可互相兼容，但从普通流数据表转化为同名高可用流数据表时，要注意清除之前普通流数据表的数据和日志（使用<code class="+ topic/ph pr-d/codeph ph codeph">dropStreamTable</code>命令进行删除）。与普通流数据表一样，查看高可用流数据表的元数据信息可使用<code class="+ topic/ph pr-d/codeph ph codeph">getPersistenceMeta</code>函数。</p>
                    </li>
                </ul>
                <p class="- topic/p p">下面的例子在 Raft 组2上创建了一个高可用流数据表 <em class="+ topic/ph hi-d/i ph i">haDevSt</em>，其中 <em class="+ topic/ph hi-d/i ph i">cacheLimit</em>
                        是100000，<em class="+ topic/ph hi-d/i ph i">keyColumn</em> 是 id。</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="创建高可用流数据表__codeblock_drd_5gh_rzb" data-ofbid="创建高可用流数据表__codeblock_drd_5gh_rzb">tmp = table(<span class="hl-number">1</span>:<span class="hl-number">0</span>, [<span class="hl-string">"id"</span>, <span class="hl-string">"source_address"</span>, <span class="hl-string">"source_port"</span>, <span class="hl-string">"destination_address"</span>, <span class="hl-string">"destination_port"</span>], [STRING,INT,INT,INT,INT])
haStreamTable(<span class="hl-number">2</span>, tmp, <span class="hl-string">"haDevSt"</span>, <span class="hl-number">100000</span>, <span class="hl-string">"id"</span>)</pre>
            </div>
        </article>
        <article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="删除高可用流数据表">
            <h3 class="- topic/title title topictitle3" id="ariaid-title7">删除高可用流数据表</h3>
            <div class="- topic/body body">
                <p class="- topic/p p">删除高可用流数据表可调用命令<code class="+ topic/ph pr-d/codeph ph codeph">dropStreamTable</code>。语法如下：</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="删除高可用流数据表__codeblock_hph_bgh_rzb" data-ofbid="删除高可用流数据表__codeblock_hph_bgh_rzb">dropStreamTable(tableName)</pre>
                <p class="- topic/p p">用户需要在取消所有订阅客户端后才能删除流数据表。</p>
                <div class="- topic/note note note note_note" id="删除高可用流数据表__note_zlz_sqf_tzb" data-ofbid="删除高可用流数据表__note_zlz_sqf_tzb"><span class="note__title">注：</span> <code class="+ topic/ph pr-d/codeph ph codeph">dropStreamTable</code> 也支持删除普通流数据表。普通流数据表还可以用
                        <code class="+ topic/ph pr-d/codeph ph codeph">clearTablePersistence(objByName( tableName))</code>（若有持久化）和
                        <code class="+ topic/ph pr-d/codeph ph codeph">undef(tableName, SHARED)</code>命令删除。</div>
            </div>
        </article>
    </article>
    <article class="- topic/topic topic nested1" aria-labelledby="ariaid-title8" id="生产者和消费者的高可用">
        <h2 class="- topic/title title topictitle2" id="ariaid-title8">生产者和消费者的高可用</h2>
        <article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="写入流数据">
            <h3 class="- topic/title title topictitle3" id="ariaid-title9">写入流数据</h3>
            <div class="- topic/body body">
                <p class="- topic/p p">生产者向流数据表写入数据，只能向 Leader 节点写入，向 Follower 节点写数据会抛出 NotLeader 异常。目前 JAVA API、C++ API
                    和 Python API 已支持流数据生产者的高可用，能自动捕获这个异常，并获取异常中携带的新 Leader 的节点信息，然后向新 Leader
                    继续写入数据。在 API 中，要求在 <code class="+ topic/ph pr-d/codeph ph codeph">connect</code> 函数中指定 <em class="+ topic/ph hi-d/i ph i">highAvailabilitySites</em>
                        参数。<em class="+ topic/ph hi-d/i ph i">highAvailabilitySites</em> 是一个 String 类型的 Array，每个 String 都是 host:port
                    格式。这样在 Leader 切换时，就能自动切换到 <em class="+ topic/ph hi-d/i ph i">highAvailabilitySites</em> 中的另一个节点，即新的 Leader。JAVA
                    API 代码举例如下：</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="写入流数据__codeblock_wsy_xgh_rzb" data-ofbid="写入流数据__codeblock_wsy_xgh_rzb">String[] haSites = new String[]{<span class="hl-string">"192.168.1.11:19151"</span>,<span class="hl-string">"192.168.1.12:19153"</span>,<span class="hl-string">"192.168.1.13:19155"</span>};
conn.connect(host,port,<span class="hl-string">"admin"</span>, <span class="hl-string">"123456"</span>, initScript, true,haSites);</pre>
                <p class="- topic/p p">Python API 代码举例如下：</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="写入流数据__codeblock_jph_bgh_rzb" data-ofbid="写入流数据__codeblock_jph_bgh_rzb">conn.connect(host, port, <span class="hl-string">"admin"</span>,<span class="hl-string">"123456"</span>, initScript, True, [<span class="hl-string">"192.168.1.2:9921"</span>, <span class="hl-string">"192.168.1.3:9921"</span>,<span class="hl-string">"192.168.1.4:9921"</span>])</pre>
            </div>
        </article>
        <article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="订阅流数据">
            <h3 class="- topic/title title topictitle3" id="ariaid-title10">订阅流数据</h3>
            <div class="- topic/body body">
                <p class="- topic/p p">客户端只需订阅 Raft 组中任意一个数据节点上的高可用流数据表，并启用订阅的自动重连功能（即把<code class="+ topic/ph pr-d/codeph ph codeph">subscribeTable</code>的
                        <em class="+ topic/ph hi-d/i ph i">reconnect</em> 参数设置为 true）。Leader 上的高可用流数据表会向订阅端发布数据。如果 Raft 组中的 Leader
                    宕机，系统会选举出新的 Leader 继续发布数据，客户端会自动切换订阅到新 Leader 上的高可用流数据表。</p>
                <p class="- topic/p p">同时针对高可用流数据表，<code class="+ topic/ph pr-d/codeph ph codeph">subscribeTable</code>提供了持久化保存最新一条已经处理过的订阅数据的偏移量的功能，以避免在重订阅时部分未处理的数据丢失，通过设置参数
                        <em class="+ topic/ph hi-d/i ph i">persistOffset</em> = true 可开启该功能。偏移量可以通过 <a class="- topic/xref xref" href="../funcs/g/getTopicProcessedOffset.html">getTopicProcessedOffset</a> 函数获取。</p>
                <p class="- topic/p p">下面的例子在 Raft 组2上创建了一个高可用流数据表
                        <em class="+ topic/ph hi-d/i ph i">haDevSt</em>。然后在集群中的某个节点上执行<code class="+ topic/ph pr-d/codeph ph codeph">subscribeTable</code>，向 Leader 节点订阅
                        <em class="+ topic/ph hi-d/i ph i">haDevSt</em>。<code class="+ topic/ph pr-d/codeph ph codeph">subscribeTable</code>的参数 <em class="+ topic/ph hi-d/i ph i">reconnect</em> 和
                        <em class="+ topic/ph hi-d/i ph i">persistOffset</em> 设为 true。</p>
                <pre class="+ topic/pre pr-d/codeblock pre codeblock language-python" id="订阅流数据__codeblock_blr_chh_rzb" data-ofbid="订阅流数据__codeblock_blr_chh_rzb">t1=table(<span class="hl-number">1</span>:<span class="hl-number">0</span>, [<span class="hl-string">"id"</span>,<span class="hl-string">"source_address"</span>,<span class="hl-string">"source_port"</span>,<span class="hl-string">"destination_address"</span>,<span class="hl-string">"destination_port"</span>], [STRING,INT,INT,INT,INT] )
haStreamTable(<span class="hl-number">2</span>,t1,<span class="hl-string">"haDevSt"</span>,<span class="hl-number">100000</span>,<span class="hl-string">"id"</span>)
​
t=select id,node <strong class="hl-keyword">from</strong> pnodeRun(getStreamingRaftGroups) where id =<span class="hl-number">2</span>
<strong class="hl-keyword">def</strong> msgProc(msg){ //todo        
}
subscribeTable(server=t.node[<span class="hl-number">0</span>], tableName=<span class="hl-string">"haDevSt"</span>,  handler=msgProc{}, reconnect=true, persistOffset=true)</pre>
                <p class="- topic/p p">当流数据表启用高可用时，API 客户端连接必须启用重连功能。目前 JAVA API、C++ API 和 Python API
                    已支持流数据消费者的高可用。其实现原理如下：</p>
                <ul class="- topic/ul ul" id="订阅流数据__ul_lph_bgh_rzb" data-ofbid="订阅流数据__ul_lph_bgh_rzb">
                    <li class="- topic/li li">
                        <p class="- topic/p p">客户端订阅时，保存 raftGroup 中所有节点的 site（节点信息）。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">Leader 变为 Follower 时，Broker 会主动关闭这个组中所有的流数据表对应的订阅，所以客户端就会发起重连。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">客户端重连时如果连接到了 Follower 上，会收到 Not Leader Exception 的异常，这个异常中还携带了目前新 Leader
                            的信息（如果 Leader 尚未被选出，Follower 就返回自身节点信息）。客户端收到这个异常之后，等待一段时间后再尝试连接新的
                            Leader。</p>
                    </li>
                    <li class="- topic/li li">
                        <p class="- topic/p p">客户端重连一个节点多次都失败时，则开始尝试连接其他配置的节点。</p>
                    </li>
                </ul>
            </div>
        </article>
    </article>
    <article class="- topic/topic topic nested1" aria-labelledby="ariaid-title11" id="流数据高可用的设计">
        <h2 class="- topic/title title topictitle2" id="ariaid-title11">流数据高可用的设计</h2>
        <div class="- topic/body body">
            <p class="- topic/p p">流数据高可用架构采用 Raft 协议实现一致性。Raft 采用分而治之的办法，将复杂问题分解为三个子问题：选举（Leader election）、日志复制（Log
                replication）和安全性（Safety）。Raft 开始时先在组内选举出 Leader 负责日志复制的管理，Leader
                接受来自客户端的事务请求（日志），并将它们复制给组内其它节点，然后负责通知组内其它节点提交日志，Leader 负责保证其它节点与它的日志同步，当 Leader
                宕机后组内其它节点会发起选举选出新的 Leader。</p>
            <p class="- topic/p p">DolphinDB 的 Raft 日志内容包含流数据表的增删信息和流数据表记录的添加信息，系统对 Raft
                日志采取同步顺序写的方式保存到磁盘。当流数据表较大时，为了避免内存不足，系统会把流数据表中较旧的数据从内存中清理，保存到磁盘。因此消费者订阅比较旧的数据时，就需要从数据文件中加载。Raft
                日志顺序存放，获取流数据时就需要从头回放，不能满足快速订阅的需求，所以流数据存储时引入了数据日志并建立索引，发布时用索引来帮助系统快速定位到订阅的起始行。系统对每个
                Raft 日志记录一个 LSN（Log Sequence Number），对每个数据文件也记录一个 LSN（表示对数据文件进行修改的最新 Raft
                日志记录），每次异步写入数据文件之后更新 LSN。在恢复的时候，对比日志记录的 LSN 与数据文件的 LSN，若 Raft 日志的 LSN 小于数据文件的
                LSN，那么表明这个日志已经写入数据文件，可以不用重做（Redo），否则需要重做。Raft 日志会不断增长，当 Raft 日志达到一定大小时，系统采用
                Checkpoint（检查点）的方式截断日志，以免日志膨胀。</p>
            <p class="- topic/p p">流数据生产者写入流数据时，把数据发送到 Leader，Leader 收到之后，先写入 log 记录到 Raft日志，然后一边复制 Raft 日志到
                Follower，一边异步写入数据文件，等复制 Raft 日志和写数据文件都完成后，再回复生产者写入成功。收到 Leader 发来的日志后，Follower
                节点直接异步把日志写入数据文件。通过 Raft 日志、数据日志和 Raft 一致性协议，保证了生产者成功写入的流数据是不会丢失的。当一个节点宕机或重启时，Raft
                协议能保证 Leader 把 Follower
                离线时写入的数据同步更新到这个节点，最终保持与组内其他副本的一致，以保证数据不丢失。但这个同步过程可能耗时过长，影响正常日志条目的复制，所以当这个节点离线时间较长、写入流数据量已很大时，建议在系统空闲时再重新加入
                Raft 组。</p>
            <p class="- topic/p p">流数据写入和订阅都不是事务的，所以不能保证不写入重复数据，比如在 Leader
                向生产者发送成功写入确认消息时，因网络或其他原因，生产者没收到这个消息，那生产者就可能重写这些数据导致重复。订阅者收到消息并处理后会把消息编号记录下来，下次重订阅时会根据记录的消息编号，订阅下一个消息。若在处理消息的过程中出了异常，导致数据已入库，但消息编号还没记录下来，那就可能重复订阅这个消息。DolphinDB
                系统提供了流数据表的主键功能，设置主键后，系统能根据主键自动过滤重复数据，以免在生产端写入重复数据。</p>
        </div>
    </article>
    <article class="- topic/topic topic nested1" aria-labelledby="ariaid-title12" id="高可用流数据表的性能">
        <h2 class="- topic/title title topictitle2" id="ariaid-title12">高可用流数据表的性能</h2>
        <div class="- topic/body body">
            <p class="- topic/p p">高可用流数据表因为需要向 Follower 节点复制副本，难免会影响写入性能。那这个影响有多大呢？我们在三台服务器上部署一个集群进行了比较测试。为减少网络传输、磁盘 IO
                对性能的影响，三台服务器之间用万兆网卡连接，流数据 Raft
                日志文件的存储目录配置在固态硬盘上，流数据表的记录保存路径配置在机械硬盘上。高可用流数据表、普通流数据表的保存模式、压缩模式保持一致，都设为同步保存和不压缩。写入流数据的
                API 客户端与 Leader 节点运行在同一台服务器上。在测试时，我们让高可用表的 Leader
                节点写入和普通流数据表的写入都在同一台服务器的同一个磁盘上进行，每次测试前，把流数据表及数据都清除干净以保持环境一致。</p>
            <p class="- topic/p p">流数据表定义详见附件，其中普通流数据表和高可用流数据表的列数保持一致，每列的数据类型也保持一致，为了测试每行记录字节总数对性能的影响，我们测了列数较少（11 列）和列数较多（211
                列）两种情况。因为每写入一批都要对 Raft
                日志刷盘一次，增加单批写入的记录数可提高系统吞吐量，所以还测试了不同单批数量的情况。一般用多线程能提升整体处理性能，所以还测了 4
                个线程的情况。列数较少时测试结果如下表：</p>
            <div class="table-container"><table class="- topic/table table" id="高可用流数据表的性能__table_mph_bgh_rzb" data-ofbid="高可用流数据表的性能__table_mph_bgh_rzb" data-cols="9"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead">
                        <tr class="- topic/row">
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">总写入记录数</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">线程数</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">单批数量/线程</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">写入次数/线程</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">高可用写入耗时ms</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">高可用写入速率（条/秒）</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">普通写入耗时</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">普通写入速率（条/秒）</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">高可用/普通速率比</th>
                        </tr>
                    </thead><tbody class="- topic/tbody tbody">
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">14,884</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">671.9</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">6,597</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">1,515.8</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">44.3%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">1,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">100</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">419,572</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">2,383.4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">407,980</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">2,451.1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">97.2%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">10,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">440,250</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">22,714.4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">421,990</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">23,697.2</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">95.9%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">10,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">26,382</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">379,046.3</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">18,868</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">529,997.9</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">71.5%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">40,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">45,213</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">884.7</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">7,120</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">5,618.0</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">15.7%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">4,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">100</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">421,568</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">9,488.4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">40,150</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">9,776.4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">97.1%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">40,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">446,746</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">89,536.3</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">427,825</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">93,496.2</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">95.8%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__1">40,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__3">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__4">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__5">59,203</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__6">675,641.4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__7">35,509</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__8">1,126,475.0</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_mph_bgh_rzb__entry__9">60.0%</td>
                        </tr>
                    </tbody></table></div>
            <p class="- topic/p p">列数较多时测试结果如下表：</p>
            <div class="table-container"><table class="- topic/table table" id="高可用流数据表的性能__table_nph_bgh_rzb" data-ofbid="高可用流数据表的性能__table_nph_bgh_rzb" data-cols="9"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead">
                        <tr class="- topic/row">
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">总写入记录数</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">线程数</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">单批数量/线程</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">写入次数/线程</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">高可用写入耗时ms</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">高可用写入速率（条/秒）</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">普通写入耗时</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">普通写入速率（条/秒）</th>
                            <th class="- topic/entry entry align-left colsep-0 rowsep-0" id="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">高可用/普通速率比%</th>
                        </tr>
                    </thead><tbody class="- topic/tbody tbody">
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">427,502</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">23.4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">419,282</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">23.9</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">98.1%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">1,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">100</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">256,728</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">3,895.2</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">242,651</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">4,121.1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">94.5%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">10,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">458,010</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">2,1833.6</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">339,780</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">29,430.8</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">74.2%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">10,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">167,349</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">59,755.4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">112,188</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">89,136.1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">67.0%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">40,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">1</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">429,201</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">93.2</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">415,907</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">96.2</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">96.9%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">4,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">100</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">295,807</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">13,522.3</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">171,150</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">23,371.3</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">57.9%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">40,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">519,405</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">77,011.2</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">372,236</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">107,458.7</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">71.7%</td>
                        </tr>
                        <tr class="- topic/row">
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__1">40,000,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__2">4</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__3">10,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__4">1,000</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__5">589,830</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__6">67,816.2</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__7">327,665</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__8">122,075.9</td>
                            <td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="高可用流数据表的性能__table_nph_bgh_rzb__entry__9">55.6%</td>
                        </tr>
                    </tbody></table></div>
            <p class="- topic/p p">从上述测试结果中可以发现，当列数较少、每批量特别小（如每批写记录为个位数）时，由于高可用流数据表 Raft
                日志网络传输的开销在整个处理时间中占比相对较大，所以对高可用流数据表的写入性能影响较大。当列数较多或批量较大（如
                100-1000）时，刷盘需要的时间增加，而因为万兆网卡的高性能传输，其对性能的影响相比刷盘的较大开销，有所减弱，所以高可用流数据表与普通流数据表的写入性能差别就不太明显。从测试结果也可以发现，通过增加线程数和单批写入数，可以提高写入的吞吐量。</p>
        </div>
    </article>
    <article class="- topic/topic topic nested1" aria-labelledby="ariaid-title13" id="总结">
        <h2 class="- topic/title title topictitle2" id="ariaid-title13">总结</h2>
        <div class="- topic/body body">
            <p class="- topic/p p">DolphinDB 流数据内置框架采用基于 Raft 协议的高可用多副本架构，实现了 Broker
                的高可用、生产者和消费者的高可用。性能测试结果显示，当列数较少、每批量特别小（如每批写记录为个位数）时，对高可用流表的写入性能影响较大。当列数较多或批量较大（如100-1000）时，高可用流表与普通流表的写入性能差别就不太明显。</p>
            <p class="- topic/p p">
                <a class="- topic/xref xref" href="../tutorials/script/hastreaming.dos">附录脚本</a>
            </p>
        </div>
    </article>
</article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#broker-%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8" data-tocid="broker-的高可用">Broker 的高可用</a><ul><li class="topic-item"><a href="#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE" data-tocid="集群配置">集群配置</a></li><li class="topic-item"><a href="#%E8%8E%B7%E5%8F%96-raft-%E7%BB%84" data-tocid="获取-raft-组">获取 Raft 组</a></li><li class="topic-item"><a href="#%E8%8E%B7%E5%8F%96-raft-%E7%BB%84%E7%9A%84-leader" data-tocid="获取-raft-组的-leader">获取 Raft 组的 Leader</a></li><li class="topic-item"><a href="#%E5%88%9B%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%B5%81%E6%95%B0%E6%8D%AE%E8%A1%A8" data-tocid="创建高可用流数据表">创建高可用流数据表</a></li><li class="topic-item"><a href="#%E5%88%A0%E9%99%A4%E9%AB%98%E5%8F%AF%E7%94%A8%E6%B5%81%E6%95%B0%E6%8D%AE%E8%A1%A8" data-tocid="删除高可用流数据表">删除高可用流数据表</a></li></ul></li><li class="topic-item"><a href="#%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8" data-tocid="生产者和消费者的高可用">生产者和消费者的高可用</a><ul><li class="topic-item"><a href="#%E5%86%99%E5%85%A5%E6%B5%81%E6%95%B0%E6%8D%AE" data-tocid="写入流数据">写入流数据</a></li><li class="topic-item"><a href="#%E8%AE%A2%E9%98%85%E6%B5%81%E6%95%B0%E6%8D%AE" data-tocid="订阅流数据">订阅流数据</a></li></ul></li><li class="topic-item"><a href="#%E6%B5%81%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%E8%AE%BE%E8%AE%A1" data-tocid="流数据高可用的设计">流数据高可用的设计</a></li><li class="topic-item"><a href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E6%B5%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E6%80%A7%E8%83%BD" data-tocid="高可用流数据表的性能">高可用流数据表的性能</a></li><li class="topic-item"><a href="#%E6%80%BB%E7%BB%93" data-tocid="总结">总结</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>