<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="本教程介绍物联网领域 DolphinDB 用户在安装部署、分布式数据库设计、数据写入和查询、流计算和高可用测试等过程中的常见问题、相应的解决方案与注意事项，以帮助新用户快速入门。 入门用户可先部署一个单节点模式 DolphinDB ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="物联网应用范例"/><title>物联网应用范例</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;物联网应用范例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;物联网应用范例&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;本教程介绍物联网领域 DolphinDB 用户在安装部署、分布式数据库设计、数据写入和查询、流计算和高可用测试等过程中的常见问题、相应的解决方案与注意事项，以帮助新用户快速入门。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:157;200:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-快速体验&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1. 快速体验&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;11-安装部署单节点服务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.1. 安装部署单节点服务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;入门用户可先部署一个单节点模式 DolphinDB 以快速体验。单节点模式拥有与集群模式相同的功能，区别在于单节点模式不支持扩展节点和高可用，而集群模式可以方便地扩展到多个服务器节点以及支持高可用。安装的第一步是在官网下载&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.dolphindb.cn/downloads.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;9:112&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 社区试用版&lt;/xref&gt;。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;10:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;选择 Windows 版本还是 Linux 版本？Linux 服务器比 Windows 服务器更稳定，建议生产环境选用 Linux 版本。若您现有环境是 Windows，亦可选择 Windows 版本进行体验。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;11:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;选择稳定版还是最新版？目前一般 1-2 周会发布一个最新版。新版本不仅包含 bug 修复，还可能包含新功能、改进、性能优化等其他内容的更新，可能会带来新的 bug。若用于生产环境，出于对稳定性的要求，请选择稳定版。稳定版只修复 bug，不增加新功能。若进行体验与测试，可选择最新版。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;13:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若选择了最新版，选择&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;jit.md&#34; xtrc=&#34;xref:2;13:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;JIT（即时编译）&lt;/xref&gt;版本还是非 JIT 版本？DolphinDB 的即时编译功能显著提高了 for 循环，while 循环和 if-else 等语句的运行速度，特别适合于无法使用向量化运算但又对运行速度有极高要求的场景。但另一方面，DolphinDB 的 JIT 版本使用一个动态库，安装包要增加 10 多兆字节，这对原本仅 20 来兆的安装包相当可观。所以请综合考虑是否需要即时编译功能以及是否对安装包大小敏感，以决定是否下载 JIT 版本。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下载后，请参照&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;standalone_server.md&#34; xtrc=&#34;xref:3;15:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;单节点部署教程&lt;/xref&gt;部署 DolphinDB。以 Linux 系统为例，步骤如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; wget https://www.dolphindb.com/downloads/DolphinDB_Linux64_V1.30.7.zip unzip DolphinDB_Linux64_V1.30.7.zip -d dolphindb cd dolphindb/server chmod +x dolphindb ./dolphindb&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;安装路径名不要含有空格或中文字符，否则会提示异常：Cannot open configuration file。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;安装过程若出现错误提示：Failed to bind the socket on port 8848，说明 8848 端口已被其他程序占用，请更换端口。假设修改端口为 8900，可在配置文件 dolphindb.cfg 中进行如下修改：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;localSite=localhost:8900:local8900&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;启动后出现如下界面。然后在 Console 中输入&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;29:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1+1;&lt;/codeph&gt;，若输出 2，即安装成功。 &lt;image class=&#34;- topic/image &#34; href=&#34;images/iotExam/serverStarted.png&#34; xtrc=&#34;image:1;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; dita-ot:image-width=&#34;1107&#34; dita-ot:image-height=&#34;302&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:1;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;注意&lt;/b&gt;：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;上述命令中 DolphinDB_Linux64_V1.30.7.zip 表明下载的是 1.30.7 版本，若是其他版本，请修改文件名中的版本号。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;上述命令中采用前台运行的方式，若要后台运行，修改&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;34:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;./dolphindb&lt;/codeph&gt;命令为&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;34:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;nohup ./dolphindb -console 0 &amp;amp;&lt;/codeph&gt;或&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;34:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;sh startSingle.sh&lt;/codeph&gt;，然后用命令&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;34:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;ps aux | grep dolphindb&lt;/codeph&gt;查看 dolphindb 进程是否已启动。若启动失败，请打开安装目录下的日志文件 dolphindb.log，查看日志中的错误提示信息。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;数据文件默认存放在&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;35:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&amp;lt;DolphinDB安装包&amp;gt;/server/local8848/storage/CHUNKS&lt;/codeph&gt;。请选择容量较大的磁盘存放数据文件，并通过参数 volumes 配置数据文件存放目录。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 通过参数 maxMemSize 设置节点的最大内存使用量，默认设置为 0，表示内存使用没有限制。内存对于改进节点的计算性能非常明显，尽可能高配，但也不能设置太大。例如一台机器内存为 16GB，并且只部署 1 个节点，建议将该参数设置为 12GB 左右。否则使用内存接近或超过实际物理内存，有可能会触发操作系统强制关闭进程。如果在数据库使用过程中发生奔溃，可以用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;36:193&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;dmesg -T | grep dolphindb&lt;/codeph&gt;查看一下 Linux 日志，确认一下是否被操作系统 kill。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;修改配置后，需要重启 DolphinDB 服务。前台用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;37:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;quit&lt;/codeph&gt;命令退出，后台用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;37:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;kill -9 &amp;lt;进程号&amp;gt;&lt;/codeph&gt;退出。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;12-测试-gui-和-web-连接&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.2. 测试 GUI 和 Web 连接&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;121-gui-连接&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.2.1. GUI 连接&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 提供了多种方式与数据库交互，如 GUI、VSCode 插件、Web Notebook、Jupyter Notebook、命令行等。对入门用户，建议使用 DolphinDB GUI 编写 DolphinDB 脚本。请到 DolphinDB 官网下载&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.dolphindb.cn/downloads.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:4;43:134&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB GUI&lt;/xref&gt;。安装前，需要确保已经安装 Java 8 及以上 64bit 版本。DolphinDB GUI 无需安装，开箱即用。在 Windows 环境下，双击 gui.bat 即可。在 Linu 和 Mac 环境下，在 Terminal 中输入：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;cd /your/gui/folder chmod +x gui.sh ./gui.sh&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若 GUI 无法启动，请在 GUI 安装目录下运行：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;50:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;java -version&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若系统不能显示 Java 版本信息，说明 Java 没有安装或 Java 的安装路径不在系统路径中。在 Windows 上，需要查看是否在&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;53:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;Path&lt;/codeph&gt;中；在 Linux 上，需要查看是否在&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;53:95&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;PATH&lt;/codeph&gt;中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若命令显示了 Java 版本信息，请检查版本是否符合要求。DolphinDB GUI 使用环境需要 64 位 Java 8 及以上版本。32 位的 Java 由于只支持 Client 模式，不支持 Server 模式，所以无法启动 GUI。符合要求的 Java 版本示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;java version &#34;1.8.0_121&#34; Java(TM) SE Runtime Environment (build 1.8.0_121-b13) Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;如果版本信息的最后一行如下所示，那么 DolphinDB GUI 将无法正常启动，需要到&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.oracle.com/technetwork/java/javase/downloads/index.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:5;61:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;Oracle 官网&lt;/xref&gt;重新下载安装。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;62:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;Java HotSpot(TM) Client VM&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;GUI 启动后，首先根据提示，选择一个文件夹作为工作区。然后请参照&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.dolphindb.cn/cn/gui/index.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:6;65:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;GUI 帮助手册&lt;/xref&gt;的说明，连接 DolphinDB 服务器，新建项目和脚本文件，再运行脚本。执行脚本时若出现错误提示：Failed to connect to selected server，请检查：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;66:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;66:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;66:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 端口是否被防火墙屏蔽。若端口没有开放，需要在防火墙打开该端口。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;67:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;67:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB server 的 license 是否过期。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;69:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;中文出现乱码&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;请在菜单栏点击 File-Preferences，在 Font 中设置中文字体，例如微软雅黑 (Microsoft Yahei)。然后执行 print(变量名)，查看输出结果，乱码是否消失。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;浮点数精度丢失&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB GUI 默认精度是 4 位，如果需要更高或低的精度，请在菜单栏点击 File-Preferences, 在 Default number of decimal places 中调整精度，例如设置为 8。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;77:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;执行脚本提示：java.lang.OutOfMemoryError: Java heap space&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;79:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;这意味着发生 GUI 内存溢出，说明 GUI 的默认 2048MB 启动内存不能满足需要。这种情况一般是由于执行了结果的数据量较大的 SQL 查询且未将查询结果赋值予一个变量（例如直接执行 select ... from ...)，因为此种操作会将结果的全部数据返回 GUI，占用 GUI 的内存。要避免此种情况下的 GUI 内存溢出，只需将结果赋值于一个变量，例如 t = select ... from ... 即可。此类语句在 server 端执行，不占用 GUI 内存。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;81:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;假设需将 GUI 的内存扩大至 4096MB，可修改 gui/gui.bat 或者 gui/gui.sh 中的 -Xmx 启动参数，如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;83:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;start javaw -classpath dolphindb.jar;dolphingui.jar;jfreechart-1.0.1.jar;jcommon-1.0.0.jar;jxl-2.6.12.jar;rsyntaxarea.jar;autocomplete.jar -Dlook=cross -Xmx4096m com.xxdb.gui.XXDBMain&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;87:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;关于 DolphinDB GUI 的更多细节，请参阅&lt;xref class=&#34;- topic/xref &#34; href=&#34;../db_distr_comp/gui.dita&#34; xtrc=&#34;xref:7;87:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB GUI 客户端&lt;/xref&gt;。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;122-web-连接&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.2.2. Web 连接&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;Web 客户端是 DolphinDB 安装包自带的、基于网页的图形化交互工具，主要用于系统监控、日志查看、以及数据浏览，也可用于快速编辑执行代码、查看变量、以及基本的画图功能。与 GUI 不同，Web 客户端更适合临时任务，不适于执行复杂的开发任务。为了保证 DolphinDB 服务器的性能，若 10 分钟内无命令执行，系统会自动关闭会话以释放 DolphinDB 系统资源。在单节点模式下，启动 DolphinDB 服务器后，只要在浏览器输入网址 (http://IP:PORT，默认为 http://localhost:8848 ) 即可访问。若无法访问，请检查：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 端口是否被防火墙屏蔽。若端口没有开放，需要在防火墙打开该端口。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB server 的 license 是否过期。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;http 是否写成了 https。若需要使用 https 协议访问 web，请按照&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;ACL_and_Security.md&#34; xtrc=&#34;xref:8;94:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;权限管理和安全&lt;/xref&gt;第 3 节&#34;使用 HTTPS 实现安全通信&#34;进行配置。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 不会强制用户登录服务器，但是有些功能例如浏览/创建数据库或分区表需要登录才能访问。如果需要将权限设置为用户登录后才能执行脚本，单节点模式下可在配置文件 dolphindb.cfg 中添加配置项：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;webLoginRequired=true;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若用户成功登录，会在屏幕上方显示登录用户名。如果 10 分钟内无命令执行，会自动退出登录。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;有关如何使用 Web 客户端的更多信息，请参阅 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../db_distr_comp/db_man/web/intro.dita&#34; xtrc=&#34;xref:9;102:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB Web 客户端&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;13-使用脚本建库建表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.3. 使用脚本建库建表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;106:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 采用数据分区技术，按照用户指定的规则将大规模数据集水平分区，每个分区内的数据采用列式存储。在数据存储时，一个分区是一个目录。以按天分区为例，一天的数据存于同一个目录下。借助数据分区，在后续的查询过程中可直接跳过不必要的数据目录，从而提升查询性能。合理地利用分区，还可以实现数据的更新与删除操作，譬如数据表按天分区，那么数据就可以按天的粒度被更新或删除。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 的每个分布式数据库采用一种分区机制，一个数据库内的多个事实表（fact table）共享这种分区机制，而且同一个分区的多个子表（tablet chunk）数据落在同一个节点上，保证同一个数据库的多个事实表连接 (join) 的效率非常高。除了分布式的事实表，DolphinDB 还提供了不分区的维度表（dimension table），通常用于存储不经常更新的小数据集。这类数据的数据量通常不会随着时间的积累而增长，而且数据内容变化较小。维度表可与任何采用分区机制的事实表关联。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 DolphinDB 中，数据库使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;110:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;database&lt;/codeph&gt;函数创建，分区表和维度表分别使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;110:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;createPartitionedTable&lt;/codeph&gt;和&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;110:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;createTable&lt;/codeph&gt;函数创建。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 不提供行级的索引，而是将分区作为数据库的物理索引。一个分区字段相当于数据表的一个物理索引。如果查询时用到了该分区字段做数据过滤，SQL 引擎就能快速定位需要的数据块，而无需对整表进行扫描。为提高查询和计算性能，每个分区的数据量不宜过大、也不宜过小，一般建议每个分区压缩前的数据量控制在 100MB 左右（第 2 章会详细介绍，亦可参阅&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;database.md&#34; xtrc=&#34;xref:10;112:178&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;分区数据库教程&lt;/xref&gt;）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下例中假设有 1000 台设备，每台设备有 50 个指标，每个指标的数据类型都是 float，每秒采集一次数据。假设常用的查询基于时间段和设备进行，因此按时间和设备标识这 2 个维度进行分区。每台设备每天产生的数据约 16MB，因此数据库可按 2 个维度分区，第一个维度按天（datetime 列）值分区，第二个维度按设备编号（machineId 列）范围分区，10 个设备一个区，每个分区数据量约 160MB。建库建表代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;116:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;db1 = database(&#34;&#34;,VALUE,2020.10.01..2020.12.30) db2 = database(&#34;&#34;,RANGE,0..100*10+1) db = database(&#34;dfs://iot&#34;,COMPO,[db1,db2]) m = &#34;tag&#34; + string(1..50) schema = table(1:0, `machineId`datetime join m, [INT,DATETIME] join take(FLOAT,50) ) db.createPartitionedTable(schema,&#34;machines&#34;,`datetime`machineId)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;上述代码新建分布式数据库 dfs://iot 与该库中的分布式数据表 machines。代码中，schema 是一个内存表，作为分区表的模板，指定了分区表的结构，包括设备编号列 machineNo、时间列 datetime 以及 50 个指标列 tag1~tag50，以及相应的数据类型。schema 表的第一个参数 1:0 分别为 capacity:size，其中 capacity 表示建表时系统为该表分配的内存（以行数为单位），size 表示该表新建时的行数。size=0 表示创建一个空表，仅仅作为分区表的模板使用。上述 schema 因为列名有规律、类型一致，所以用函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;125:291&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;join&lt;/codeph&gt;进行了简化，实际等价于下面 2 种写法，可根据列名、类型情况进行仿写：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;schema = table(1:0, `machineId`datetime`tag1`tag2`tag3`tag4`tag5`tag6`tag7`tag8`tag9`tag10`tag11`tag12`tag13`tag14`tag15`tag16`tag17`tag18`tag19`tag20`tag21`tag22`tag23`tag24`tag25`tag26`tag27`tag28`tag29`tag30`tag31`tag32`tag33`tag34`tag35`tag36`tag37`tag38`tag39`tag40`tag41`tag42`tag43`tag44`tag45`tag46`tag47`tag48`tag49`tag50, [INT,DATETIME,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT] ) schema=table( array(INT,0) as machineId, array(DATETIME,0) as datetime, array(FLOAT,0) as tag1, array(FLOAT,0) as tag2, array(FLOAT,0) as tag3, array(FLOAT,0) as tag4, array(FLOAT,0) as tag5, array(FLOAT,0) as tag6, array(FLOAT,0) as tag7, array(FLOAT,0) as tag8, array(FLOAT,0) as tag9, array(FLOAT,0) as tag10, array(FLOAT,0) as tag11, array(FLOAT,0) as tag12, array(FLOAT,0) as tag13, array(FLOAT,0) as tag14, array(FLOAT,0) as tag15, array(FLOAT,0) as tag16, array(FLOAT,0) as tag17, array(FLOAT,0) as tag18, array(FLOAT,0) as tag19, array(FLOAT,0) as tag20, array(FLOAT,0) as tag21, array(FLOAT,0) as tag22, array(FLOAT,0) as tag23, array(FLOAT,0) as tag24, array(FLOAT,0) as tag25, array(FLOAT,0) as tag26, array(FLOAT,0) as tag27, array(FLOAT,0) as tag28, array(FLOAT,0) as tag29, array(FLOAT,0) as tag30, array(FLOAT,0) as tag31, array(FLOAT,0) as tag32, array(FLOAT,0) as tag33, array(FLOAT,0) as tag34, array(FLOAT,0) as tag35, array(FLOAT,0) as tag36, array(FLOAT,0) as tag37, array(FLOAT,0) as tag38, array(FLOAT,0) as tag39, array(FLOAT,0) as tag40, array(FLOAT,0) as tag41, array(FLOAT,0) as tag42, array(FLOAT,0) as tag43, array(FLOAT,0) as tag44, array(FLOAT,0) as tag45, array(FLOAT,0) as tag46, array(FLOAT,0) as tag47, array(FLOAT,0) as tag48, array(FLOAT,0) as tag49, array(FLOAT,0) as tag50 )&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;注意&lt;/b&gt;：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;创建或访问分布式数据库和表需要相应的用户权限。若不登录，会出现类似&#34;&amp;lt;NotAuthenticated&amp;gt;Not granted to ...&#34;这样的错误提示。DolphinDB 的默认管理员用户是&#34;admin&#34;，其默认密码是&#34;123456&#34;。登录命令如下：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;login(`admin, `123456)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;登录后使用函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;193:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;changePwd&lt;/codeph&gt;修改密码。更多权限管理细节，请参阅&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;ACL_and_Security.md&#34; xtrc=&#34;xref:11;193:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;权限管理和安全&lt;/xref&gt;。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;库表创建后，可使用函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;195:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;getAllDBs()&lt;/codeph&gt;显示当前所有数据库，使用函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;195:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;schema&lt;/codeph&gt;显示某个表或某个数据库的结构信息。例如查询上述&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;195:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;dfs://iot&lt;/codeph&gt;数据库的设备分区信息可用如下代码：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;196:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;database(&#34;dfs://iot&#34;).schema().partitionSchema[1]&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;查询上述 machines 的表结构可用如下代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;loadTable(&#34;dfs://iot&#34;,&#34;machines&#34;).schema().colDefs&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;- 数据库创建后，无法通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;203:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;database&lt;/codeph&gt;函数修改分区类型或分区方案，若要修改，请先删库再重新创建。删除数据库可使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;203:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;dropDatabase&lt;/codeph&gt;函数。若删除某个数据表，可使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;203:90&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;dropTable&lt;/codeph&gt;。分布式表支持增加列，不支持修改列和删除列。增加列可使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;203:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;addColumn&lt;/codeph&gt;函数。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;14-数据库增删改查&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.4. 数据库增删改查&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;分布式表 (DFS table) 不支持使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;209:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;insert into&lt;/codeph&gt;插入数据，仅支持使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;209:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;append!&lt;/codeph&gt;或&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;209:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tableInsert&lt;/codeph&gt;函数插入数据。即使只插入一条数据，也要用表的形式来表示新增的数据。插入数据的代码示例如下，其中自定义函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;209:121&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;genData&lt;/codeph&gt;输入设备编号集，开始时间和每台设备记录数，返回一个包含所有模拟记录的内存表。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下面首先为 1000 个设备产生 1 小时的数据，然后举例说明如何查询、修改和删除数据库记录：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;def genData(uniqueMachineId, startDateTime, freqPerMachine){ numMachines = size(uniqueMachineId) numRecords = numMachines * freqPerMachine machineId = array(INT, numRecords) for(i in 0:numMachines) machineId[(i*freqPerMachine) : ((i+1)*freqPerMachine)] = uniqueMachineId[i] t = table(machineId, take(startDateTime + (0..(freqPerMachine-1)), numRecords) as ts) m = &#34;tag&#34; + string(1..50) for (i in 0 : 50) t[m[i]] =rand(10.0, numRecords) return t } machines = loadTable(&#34;dfs://iot&#34;, &#34;machines&#34;) t=genData(1..1000, datetime(2020.10.05), 3600) machines.append!(t)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;229:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;与其他关系数据库、NoSQL、NewSQL 等数据库不同，DolphinDB 将数据库、编程语言和分布式计算三者融为一体，这种设计使得 DolphinDB 可以一站式轻量化的解决海量大数据的存储与计算。但也使得数据库和表在 DolphinDB 中只是一个普通变量，引用数据库和表时，有可能会与脚本中的其他变量名发生冲突，所以不能直接使用数据库或表名，必须使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;229:180&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;loadTable&lt;/codeph&gt;函数先加载数据表。上例中，加载数据库 dfs://iot 中的数据表 machines，并把这个表对象赋值给变量 machines，之后就可以使用变量 machines 来访问这个数据表。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;231:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 1. 查询每个设备的记录总数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select count(*) from machines group by machineId&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;235:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若查询到的记录数是 0，请检查一下写入数据的分区字段值是否超出了分区范围。比如这个数据库日期分区是 2020.10.01 到 2020.12.30，若数据的时间是在 2020.10.01 之前或 2020.12.30 之后，就会写入失败。为了解决这个问题，请参照用户手册中&lt;xref class=&#34;- topic/xref &#34; href=&#34;../db_distr_comp/db_oper/add_partitions.dita&#34; xtrc=&#34;xref:12;235:137&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;增加分区&lt;/xref&gt;这小节的说明，在配置文件中增加配置项 newValuePartitionPolicy=add 并重启 DolphinDB 节点。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 2. 查询设备 1 在 2020.10.05 这一天的历史记录：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select * from machines where machineId=1 and datetime between 2020.10.05T00:00:00 : 2020.10.05T23:59:59&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;241:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;查询时需要注意：系统在执行分布式查询时，首先根据 where 条件确定相关分区。大多数分布式查询只涉及分布式表的部分分区，系统不必全表扫描，从而节省大量时间。但若不能根据 where 条件做分区剪枝，就会全表扫描，影响查询性能。另外，还可能出现类似下列错误：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;The number of partitions [372912] relevant to the query is too large. Please add more specific filtering conditions on partition columns in WHERE clause, or consider changing the value of the configuration parameter maxPartitionNumPerQuery.&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;245:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;配置参数 maxPartitionNumPerQuery 指定一个查询最多可以涉及的分区数量，默认值是 65535，用于防止生产环境中有人手误提交超级大的 query，影响性能。请注意，若 where 子句中的过滤条件不符合分区剪枝的规则，即使计算只使用了少数分区，在确定相关分区的过程中仍可能进行全表扫描，导致涉及的分区数量多于 maxPartitionNumPerQuery 的值。例如，若例 2 中的涉及日期的 where 条件写为 date(datetime)=2020.10.05，即使计算实质使用的分区数量不变，但由于违反了分区剪枝的规则，会全表扫描，耗时会显著增加。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;247:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;可以使用以下方法解决这个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;248:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;248:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;查询中限定尽可能精确的分区范围。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;249:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;定义数据库的分区机制时，时间戳列的定义不要包含将来的日期，可以在系统中将 newValuePartitionPolicy 设置成 add。这样新的日期出现时，系统会自动更新数据库定义。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;将 maxPartitionNumPerQuery 的值调大。不推荐这种方法，因为若不小心忘记设定查询的过滤条件或将过滤条件设置过松，则该查询会耗时过久，浪费系统资源。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;252:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 3. 查询设备 1 在 2020.10.05 这一天的最早的 10 条历史记录：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;253:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select top 10 * from machines where machineId=1 and datetime between 2020.10.05T00:00:00 : 2020.10.05T23:59:59&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 的分区之间存在先后顺序；分区内的数据按照写入顺序存储。查询或计算的时候，如果需要，可以用 order by、csort 等排序。下面我们选择不同分区的 1 号设备和 11 号设备，先写入 2020.10.06T00:00:01 各一条记录，然后写入 2020.10.06T00:00:00 各一条记录。再查询 top 2 记录：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;257:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;t=genData([1,11],2020.10.06T00:00:01,1) machines.append!(t) t=genData([1,11],2020.10.06T00:00:00,1) machines.append!(t) select top 2 * from machines where datetime &amp;gt;= 2020.10.06T00:00:00&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;264:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;查询结果如下所示。从中可见，虽然 11 号设备的 2020.10.06T00:00:01 的数据先写入，但因为它属于符合 where 条件（即 2020.10.06 日）第二个分区（每 10 台机器一个分区），所以结果中没有它，而是返回了第一个分区 1 号设备 2020.10.06T00:00:00 的数据。在第一个分区里，虽然 2020.10.06T00:00:00 的时间早，但它写入晚，所以先返回了 2020.10.06T00:00:01 的数据。如果查询 top 1，则只有 2020.10.06T00:00:01 的数据被返回。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;265:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;machineId datetime tag1 ... tag50 1 2020.10.06T00:00:01 1.7039 ... 7.8002 1 2020.10.06T00:00:00 7.9393 ... 2.7662 &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 4. 查询每个设备的最新一条记录：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select top 1 * from machines context by machineId csort datetime desc &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;此查询通过 SQL 的&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;275:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;context by&lt;/codeph&gt;子句对表内记录进行分组，然后在组内按时间戳列进行 csort 降序排序，再与 top 一起使用，获取每个分组中的最新记录。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;SQL 的&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;277:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;context by&lt;/codeph&gt;子句为 DolphinDB 对标准 SQL 进行的拓展，在处理面板数据 (panel data) 时极为方便。更多细节请参考用户手册的&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;277:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;context by&lt;/codeph&gt;的介绍。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;279:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若在生产环境中不断写入的情况下进行查询，为了减少查询范围，可增加一个查询条件，即限制 datetime 为最近一小时，如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select top 1 * from machines where datetime &amp;gt;= datetimeAdd(now().datetime(),-1,`h) context by machineId csort datetime desc &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若数据是按时间顺序插入，系统内存资源充足，此查询也可使用快照引擎实现。快照引擎性能更佳，但目前仅支持单节点服务模式。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;另外，在测试查询性能时，DolphinDB 提供了&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;285:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;timer&lt;/codeph&gt;函数用于计算查询耗费的时间。譬如在 GUI 中查询 21 号设备在 2020.10.05 的记录：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;286:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;timer select * from machines where machineId=21, datetime between 2020.10.05T00:00:00 : 2020.10.05T23:59:59&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;返回如下信息：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.10.28 19:34:34.181: executing code (line 2489)... Time elapsed: 9.52 ms 2020.10.28 19:34:34.227: execution was completed [46ms]&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;296:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;这里打印了 2 个时间。第一个时间 9.52 ms 是&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;296:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;timer&lt;/codeph&gt;返回的时间，为这个查询在服务器上运行耗费的时间；第二个时间 46 ms 则是从脚本命令发送到接收返回结果的整个过程花费的时间，两者之差为序列化/反序列化和网络传输的耗时。类似 select * from table 即返回整个数据集到 GUI 这样的查询语句，若数据量特别大，序列化/反序列化和网络传输的耗时可能会远远超过在服务器上运行的耗时。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;从 1.30.6 版本起，DolphinDB 支持使用 SQL update 和 delete 语句修改分布式表（包括维度表和分区表）&lt;/b&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;300:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 5. 更新设备 1 在 2020.10.05T00:00:00 时间点 tag1 值为 1.0：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;update machines set tag1 = 1.0 where machineId=1 and datetime=2020.10.05T00:00:00&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;304:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 6. 删除设备 1 在 2020.10.05T00:00:01 时间点的记录：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;305:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;delete from machines where machineId=1 and datetime=2020.10.05T00:00:01&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;15-grafana-连接-dolphindb&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.5. Grafana 连接 DolphinDB&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;311:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 提供了标准协议的 SQL 查询接口，与第三方分析可视化系统如 Grafana、Redash 和帆软等可轻松实现集成与对接。本节以 Grafana 为例，介绍 DolphinDB 与第三方可视化系统的连接与展示。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;151-安装配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;313:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;313:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.5.1. 安装配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;313:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;安装 Grafana 请参考&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;http://docs.grafana.org/installation/&#34; scope=&#34;external&#34; xtrc=&#34;xref:13;315:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;Grafana 官网教程&lt;/xref&gt;。安装后，若本机浏览器中可以打开 http://localhost:3000/ ，说明 Grafana 安装成功，否则请检查 3000 这个端口是否被防火墙屏蔽或被其他应用占用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 为了支持使用 Grafana 来实时展示时序数据，提供了 Grafana 的 dolphindb-datasource 插件，并且实现了对 Grafana 的 HTTP 数据接口，可以通过类 SQL 的查询脚本将 DolphinDB 的数据表以直观的方式展示在 Grafana 的 Dashboard 上。插件的下载与安装请参阅&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;../tools/grafana.md&#34; xtrc=&#34;xref:14;317:175&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;插件教程&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;152-显示数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;319:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;319:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.5.2. 显示数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;319:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 GUI 中运行以下脚本模拟 1 号设备每一秒产生一条数据，其中 gen 为 1.4 节描述的自定义函数，使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;321:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;submitJob&lt;/codeph&gt;函数把自定义的&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;321:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;writeIOTData&lt;/codeph&gt;函数提交批处理作业：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;def writeIoTData(){ login(&#34;admin&#34;, &#34;123456&#34;) machines = loadTable(&#34;dfs://iot&#34;, &#34;machines&#34;) for (i in 0:86400) { t=genData(1, now().datetime(), 1) machines.append!(t) sleep(1000) } } submitJob(&#34;jobId1&#34;,&#34;writeDataToMachine1&#34;,writeIoTData)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 Grafana 的 Home 界面点击&#34;Create Dashboard&#34;，然后点击&#34;Add new panel&#34;，在如下图所示界面的 Query options 中选择 DolphinDB 数据源后，数据源下方会出现一个用于输入脚本的文本输入框，输入以下查询语句以读取 1 号设备前 5 分钟的 tag1 数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:28;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;login('admin', '123456'); select gmtime(timestamp(datetime)) as time_sec, tag1 from loadTable('dfs://iot', 'machines') where machineId=1 and datetime&amp;gt; now().datetime()-5*60&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;339:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在右上角设置定时刷新及数据时间段的长度，就可以看到实时的数据变化走势图。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/iotExam/newDashboard.png&#34; placement=&#34;break&#34; xtrc=&#34;image:2;341:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; dita-ot:image-width=&#34;1920&#34; dita-ot:image-height=&#34;969&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:2;341:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;datasource1&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;343:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;上图若不能正常显示，请检查：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 GUI 中运行函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;344:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;getRecentJobs&lt;/codeph&gt;，查看作业运行是否有错，若有错，返回结果中 errorMsg 会显示错误信息。取消作业用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:37;344:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;cancelJob&lt;/codeph&gt;。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;345:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;Grafana 默认返回 timer_series 格式，SQL 中返回的第一个字段必须是 timestamp 类型。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DFS 数据库需要登录后才能访问，所以 select 语句前需要先登录。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;347:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;检查查询语句中是否含有双引号，若有双引号，改其为单引号。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;348:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若上述方法还不能解决问题，建议用 Goole Chrome 浏览器运行 Grafana，然后按 F12 调试，可以查看一下网络交互信息是否提示了异常。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;16-dolphindb-与其他数据库异同点小结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1.6. DolphinDB 与其他数据库异同点小结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;352:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;物联网历史数据有可能达到几百 TB 甚至 PB 级别。传统的关系型数据库（如 Oracle，SQL Server，MySQL 等）受到行式存储和数据索引的限制，处理如此量级数据的性能非常低下，即使分库分表，效果也不理想。DolphinDB 采用了分区机制，可以轻松应对 PB 级别的海量数据。DolphinDB 通过数据分区而不是索引的方式来快速定位数据，适合海量数据的存储，检索和计算。在数据量不是非常大时，创建索引可以显著提高系统的性能，但在海量数据场景下，随着数据量的不断增加，索引会不断膨胀（需要占用的内存甚至可能超过了服务器的内存），反而导致系统性能下降。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 将分布式数据库、分布式计算和编程语言从底层进行一体化设计，这种设计使得 DolphinDB 可以一站式轻量化的解决海量大数据的存储与计算。但是，引用数据库和表时，因为可能会与脚本中的变量名发生冲突，所以不能直接使用数据库或表名，必须使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:38;354:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;loadTable&lt;/codeph&gt;函数先加载数据表。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;与关系型数据库不同，DolphinDB 分布式表不支持使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:39;356:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;insert into&lt;/codeph&gt;插入数据，仅支持使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:40;356:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;append!&lt;/codeph&gt;或&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:41;356:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tableInsert&lt;/codeph&gt;函数以表的形式插入数据。DolphinDB 支持事务，客户端每次写入都是一个事务但是用户层面不提供事务操作，不需要用户像关系数据库一样显式地开始事务、提交事务等。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;358:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;相比其他时序数据库，DolphinDB 是一个非常轻量级的系统，用 GNU C++ 开发，核心程序仅 20 余兆字节，无任何依赖，开箱即用。DolphinDB 已适配国产的 X86、ARM、MIPS（龙芯）等 CPU，可以运行在 Linux 和 Windows 操作系统上。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-分布式数据库设计和测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2. 分布式数据库设计和测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-dolphindb-存储引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2.1. DolphinDB 存储引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 利用分布式文件系统实现数据库的存储和基本事务机制。数据库以分区（chunk）为单位进行管理。分区的元数据（元数据指&#34;../tools/grafana.md&#34;小，存储位置等）存储在控制节点，副本数据存储在各数据节点，统一由分布式文件系统进行管理。一个数据库的数据可能存储在多个服务器上，系统内部通过事务机制和二阶段提交协议保证数据的强一致性和完整性，对于外部用户来说，这些机制是完全透明的。每个分区副本的数据采用列式增量压缩存储。压缩算法采用了 LZ4 或 DELTA 算法，在实际生产环境中，磁盘数据的无损压缩比约 5:1，在有些重复较多、变动范围较小、写入批量大的场景，也能做到更高的压缩比。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;366:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;一个数据库最多可以支持三个维度的分区，支持百万甚至千万级的分区数。为尽可能保证每个分区的大小平衡，DolphinDB 提供了值（VALUE）分区，范围（RANGE）分区，哈希（HASH）分区，列表（LIST）分区和复合（COMPO）分区等多种分区方式，用户可以灵活使用，合理规划分区。在查询时，加载数据的最小单位是一个分区的一个列。DolphinDB 不提供行级的索引，而是将分区作为数据库的物理索引。一个分区字段相当于数据表的一个物理索引。如果查询时用到了该分区字段做数据过滤，SQL 引擎就能快速定位需要的数据块，而无需对整表进行扫描。在物联网领域，查询分析大多基于某一个时间段、某个设备或某个指标进行，因此时间和设备/指标标识是物联网领域最常用的分区维度。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下面展示一个数据库的存储目录和文件，其中数据库按照两个维度分区，第一个维度按天（ts 列）进行值分区，第二个维度按照标签编号（tagid 列）范围分区，建库建表以及测试数据写入代码如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:29;369:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;schema = table(1:0,`tagid`ts`data,[INT,TIMESTAMP,INT]); db1 = database(&#34;&#34;,VALUE,2020.01.01..2020.01.02) db2 = database(&#34;&#34;,RANGE,1 11 21 31) db = database(&#34;dfs://demo&#34;,COMPO,[db1,db2]) db.createPartitionedTable(schema,&#34;sensor&#34;,`ts`tagid) t=table(1..30 as tagid,take(2020.01.01T00:00:00.000 2020.01.02T00:00:00.000,30) as time,rand(10,30) as data ) loadTable(&#34;dfs://demo&#34;,&#34;sensor&#34;).append!(t)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;379:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;写入测试数据后，存储目录和数据文件如下所示，&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:30;380:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;[root@188 CHUNKS]# tree ./demo/ ./demo/ ├── 20200101 │   ├── 1_11 │   │   └── sensor │   │   ├── data.col │   │   ├── tagid.col │   │   └── ts.col │   ├── 11_21 │   │   └── sensor │   │   ├── data.col │   │   ├── tagid.col │   │   └── ts.col │   └── 21_31 │   └── sensor │   ├── data.col │   ├── tagid.col │   └── ts.col ├── 20200102 │   ├── 1_11 ... ├── dolphindb.lock ├── domain └── sensor.tbl &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;从中可以看到，一个分区维度对应一层子目录，譬如按天分区的子目录名是 20200101，20200102 等，按标签编号范围分区的子目录名是 1_11，11_21 等，表中每一列保存为一个后缀名为 col 的文件，如 data.col，tagid.col 等。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 对分布式数据库表的读写支持事务，保证多行写入数据（可以跨越多个分区，支持多个副本）的原子性和持久性。断电不影响写入的数据，也不破坏数据库的完整性。DolphinDB 采用多版本机制实现快照级别的隔离。当用户同时对数据库进行读写操作时，读和写的并发事务会相互隔离。在这种隔离机制下，数据的读操作和写操作互不阻塞，可以最大程度优化数据仓库读的性能。目前绝大部分的时序数据库不提供事务功能，因此有可能发生一致性和完整性问题，譬如写入两条记录可能一条成功，另一条不成功；已经写入的数据在断电重启后可能丢失最后几条数据；查询的时候可能查到正在写入的数据（尚未全部完成)。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-单值模型&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2.2. 单值模型&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;数据库通用的设计模式有两种，即单值模型和多值模型。单值模型针对测点建模。一个被监控的指标称为一个测点，例如电量仪中会有电压、电流、功率等测点，温湿度计中有温度、湿度测点。单值模型在写入时每一个测点为一行，所有采集的传感器指标值，无论种类，均存于同一列中。单值模型适合各测点采集频率不一致的应用场景，不适合不同指标之间要做很多协同处理的场景。单值模型数据占用的存储空间大，写入性能和查询性能也不如多值模型。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;415:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;假设某厂有 100 个机组，每台机组有 50 个测点，共有 100*50=5000 个测点。每个测点采集一个指标的数据，每秒采集一次数据，均为 float 类型。所有机组采集相同的 50 个指标的数据并存入数据库。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;417:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;对测点按顺序进行编号：一号机组的测点为 1~50，二号机组的测点是 51~100，以此类推。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;本案例若按单值模型设计，表结构可定义如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:1;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;列名&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;421:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;数据类型&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;421:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;备注&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;id&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;423:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;INT&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;423:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;测点编号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;424:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:7;424:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;datetime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:8;424:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DATETIME&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;424:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:10;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;value&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:11;425:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;FLOAT&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:12;425:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;指标值&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;单值模型适合的常用查询基于测点编号与时间段，可按测点编号和时间这 2 个维度进行分区。时间维度一般情况下可按天进行值（VALUE）分区，但也可根据数据量和典型查询场景采用其它分区方案。若某些场景下，查询时间跨度不是很长，而单位时间内的数据量又较大，也可以按小时进行分区。若数据量比较小，又常按一个月或几个月进行查询和计算，也可以按月分区。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;429:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;物联网设备监控场景的各指标的采集频率一般固定，比较容易计算单位时间的数据量大小，因此指标维度的分区通常采用范围（RANGE）或值（VALUE）方法。DolphinDB 中组合分区的多个列在逻辑上是并列的，不存在从属关系或优先级关系。如果时间维度有 n 个分区，指标维度有 m 个分区，最多可能有 n * m 个分区。为提高查询和计算性能，每个分区的数据量不宜过大、也不宜过小。一般建议每个分区压缩前的数据量控制在 100MB 左右（详情请参阅&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;database.md&#34; xtrc=&#34;xref:15;429:223&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;分区数据库教程&lt;/xref&gt;）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;431:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;本案例中，每 100 个测点（即两个机组）每天的数据约 100MB（12 字节/条*86400 条*100 测点）。所以第一个分区维度采用值分区，每天为一个分区；第二个分区维度采用范围（RANGE）分区，每 100 个测点（即两台机组）为一个分区。参考代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:31;432:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;numMachines=100 numMetrics=50 numMachinesPerPartition=2 ps1=2020.09.01..2020.12.31 ps2=(numMetrics*numMachinesPerPartition)*(0..(numMachines/numMachinesPerPartition))+1 def createDatabase(dbName,tableName, ps1, ps2){ tableSchema = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT]); db1 = database(&#34;&#34;, VALUE, ps1) db2 = database(&#34;&#34;, RANGE, ps2) db = database(dbName,COMPO,[db1,db2]) dfsTable = db.createPartitionedTable(tableSchema,tableName,`datetime`id) } createDatabase(&#34;dfs://svmDemo&#34;,&#34;sensors&#34;, ps1, ps2)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;以上建立的数据库 dfs://svmDemo 中的 svm 代表 single-value model（单值模型）。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-多值模型&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2.3. 多值模型&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;多值模型通常针对数据源（在物联网领域通常是设备）建模，写入时每一个设备在同一时刻被测量的所有指标值为一行。上一小节中案例若用多值建模，表结构定义如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:2;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:4;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:5;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:6;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:13;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;列名&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:14;454:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;数据类型&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:15;454:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;备注&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;456:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;456:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:16;456:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;id&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:17;456:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;INT&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:18;456:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;机组编号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:19;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;datetime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:20;457:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DATETIME&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:21;457:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;458:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:22;458:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;TAG1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:23;458:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;FLOAT&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:24;458:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1 号指标&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:25;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;...&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:morecols=&#34;1&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; nameend=&#34;col3&#34; namest=&#34;col2&#34; xtrc=&#34;entry:26;459:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;460:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:27;460:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;TAG50&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:28;460:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;FLOAT&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:29;460:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;50 号指标&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;462:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;多值模型适合的常用查询基于时间段和设备，因此多值模型的分区字段可选择时间和设备这 2 个维度。时间维度通常按天、按小时或按月进行值（VALUE）分区，由数据量和典型查询场景决定。若查询时间段跨度不大且单位时间内采集数据量大，可按小时进行分区；若查询时间段跨度大且单位时间内数据量不大，可按月分区。设备维度的分区可以采用哈希、范围、值、列表等多种方法，原则就是要根据业务特点对数据进行均匀分割，让每个分区压缩前的大小控制在 100MB 左右。但如果数据表为宽表（几百甚至几千个字段），若单个应用只会使用一小部分字段，因为未用到的字段不会加载到内存，不影响查询效率，这种情况可以适当放大分区上限的范围。数据库分区也可按三个维度进行。比如采集设备的网络日志，常用的查询基于时间段、源 IP 地址和目的 IP 地址，就可以考虑采用时间、源 IP 地址和目的 IP 地址三个分区维度。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;464:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;本案例每机组每天的记录数为 86400 条，每天的数据量约 16MB。常用查询按天和设备进行，因此可采用复合分区，按天进行值分区，按机组进行范围分区，每 10 个机组为一个分区。参考代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:32;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;numMachines=100 numMachinesPerPartition=10 ps1=2020.09.01..2020.12.31 ps2=numMachinesPerPartition*(0..(numMachines/numMachinesPerPartition))+1 def createDatabase(dbName,tableName, ps1, ps2, numMetrics){ m = &#34;tag&#34; + string(1..numMetrics) schema = table(1:0,`id`datetime join m, [INT,DATETIME] join take(FLOAT,50) ) db1 = database(&#34;&#34;,VALUE,ps1) db2 = database(&#34;&#34;,RANGE,ps2) db = database(dbName,COMPO,[db1,db2]) db.createPartitionedTable(schema,tableName,`datetime`id) } createDatabase(&#34;dfs://mvmDemo&#34;,&#34;machines&#34;, ps1, ps2, 50)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;481:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;以上建立的数据库 dfs://mvmDemo 中的 mvm 代表 multiple-value model（多值模型）。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-使用脚本生成测试数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2.4. 使用脚本生成测试数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;485:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若没有实际生产数据，可使用脚本模拟产生测试数据。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;487:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;487:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;单值模型的脚本见&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/singleValueModeWrite.txt&#34; xtrc=&#34;xref:16;487:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;附件 1&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;489:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;此脚本生成分布式表 dfs://svmDemo/sensors 多天的模拟数据。函数 generate1DayData 用于产生一天的模拟数据；函数 singleThreadWriting 调用 generate1DayData 产生模拟数据，并将数据用单线程写入分布式表中。singleThreadWriting 中每次写入操作写入一个分区的全部数据，这样每个分区的数据文件只需打开一次就全部写入，可提高写入性能。多线程并行写入能进一步提升写入性能。 函数 multipleThreadWriting 用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:42;490:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;cut&lt;/codeph&gt;函数把测点标号向量按线程数平均分隔，然后用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:43;490:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;ploop&lt;/codeph&gt;并行调用 singleThreadWriting 多线程写入数据库。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;492:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;代码中线程数设为 20，实际写入时请根据主机内存情况调整。写入开始后，可以使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:44;492:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;getRecentJobs&lt;/codeph&gt;函数查看作业处理情况，若返回结果中 endtime 等 endtime 全部显示出来了。使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:45;492:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;getClusterPerf&lt;/codeph&gt;函数查看系统 CPU 与内存等资源使用情况。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;494:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若有 1000 台机器，50 个指标，写入 5 天，在普通台式机上约需 50-100 分钟左右写入，在 I/O 性能较好的服务器上约需 4 分钟写入。磁盘上数据文件约为 160GB。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;多值模型的脚本见&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/multipleValueModeWrite.txt&#34; xtrc=&#34;xref:17;496:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;附件 2&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;这个脚本可以生成分布式表 dfs://mvmDemo/equip 多天的模拟数据，脚本逻辑与单值模型类似。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;501:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;要提升写入性能，可采取以下措施：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;503:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;503:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;批量写入每批次的数据量不宜过小，一般几十 MB 比较合适。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;505:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;以上述单值模型案例为例，100 个测点共写入 90 天的数据，即 777,600,000 条记录，用不同批量大小在一台 PowerEdge R730xd linux 主机上测试。DolphinDB 采用单节点部署，限制使用 32G 内存，16 核 CPU。元数据写入 SSD，数据写入 HDD，其他都采用默认配置。测试结果如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:3;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:7;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:8;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:9;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:30;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;每批记录数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:31;507:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;写入耗时（秒）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:32;507:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;每秒写入记录数&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:33;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;100&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:34;509:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;8,086&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:35;509:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;96,166&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;510:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:36;510:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:37;510:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;165&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:38;510:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;471,272&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;511:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:39;511:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;360,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:40;511:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;38&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:41;511:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;20,463,157&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;513:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;每次写入数据涉及的分区数量不宜过多。DolphinDB 存储时，每个分区每个列存为一个文件。若每次写入 3 列数据，涉及 3,600 个分区，那么每次需要写入 3,600*3=10,800 个文件，会严重影响写入性能。例如在上述测试环境中，还是每批写入 360,000 条，并写入一样多的记录总数，但每批涉及分区 3,600 个，耗时 7,922 秒，是每次写入单个分区耗时的 200 余倍。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;515:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;对小批量写入，启用 Redo Log 和写入数据缓存 (Cache Engine) 功能，能把多次少量的写入缓存起来，一次批量写入，能大大提高写入吞吐量。以上述 100 个测点共写入 777,600,000 条记录为例，在同样的测试环境，但设置了 dataSync=1（表示将 Redo log、数据和元数据强制刷盘）和 chunkCacheEngineMemSize=1（缓存为 1GB）。测试结果显示，每批写入 100 条记录，仅耗时 81 秒，吞吐量提高约 100 倍。有关 Redo Log 和 Cache Engine 的更多信息，请参阅&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;redoLog_cacheEngine.md&#34; xtrc=&#34;xref:18;515:277&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;Cache Engine 与数据库日志&lt;/xref&gt;&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;517:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;517:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用多个客户端多线程并行写入，但注意多个 writer 不能同时向同一个分区写入。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;519:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下面用&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/singleValueModeWrite.txt&#34; xtrc=&#34;xref:19;519:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;单值模型脚本&lt;/xref&gt;在一台台式机上测试，台式机 CPU 为 6 核 12 线程的 Intel I7，内存 32GB，128GB SSD 和 2TB 7200RPM HDD。DolphinDB 采用单节点部署，限制使用 16G 内存，启动 Redo Log 和写入缓存。元数据和 Redo Log 写入 SSD，数据写入 HDD。1000 台设备，50 个指标，写入 5 天历史数据，如下表所示，5 个线程是单线程写入性能快约 1.5 倍，10 线程时受硬件资源限制，与 5 线程相比提升不明显。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:4;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:10;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:11;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:12;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:42;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;线程数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:43;521:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;写入耗时（秒）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:44;521:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;每秒写入记录数&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;523:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;523:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:45;523:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:46;523:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4081&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:47;523:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5,292,820&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;524:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:48;524:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:49;524:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2925&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:50;524:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;7,384,615&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;525:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:51;525:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:52;525:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2907&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:53;525:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;7,430,340&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;528:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;528:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;不同的数据节点配置不同的磁盘，每个数据节点挂载多卷（Volumes），可并行利用多个磁盘的 I/O 接口，大幅提升节点的整体读写吞吐性能。例如下面配置 diskIOConcurrencyLevel 为 4，volumes 配置 4 个磁盘，也即为每一个挂载的硬盘配置一个读写线程，将对一个磁盘的读写任务串行化到一个队列，避免了并发线程之间的磁盘读写竞争。&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:33;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;diskIOConcurrencyLevel=4 volumes=/hdd/hdd1/volumes,/hdd/hdd2/volumes,/hdd/hdd3/volumes,/hdd/hdd4/volumes&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-历史数据查询&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;534:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;534:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3. 历史数据查询&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;534:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;536:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;本章节所用数据均为第 2 章中所建之单值模型 sensors 分布式表。请注意，由于 sensors 中 value 列的数据为随机生成，所以以下结果中涉及到 value 的数值会与您得到的结果有所差别。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;538:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;首先将 sensors 表元数据载入内存：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:34;539:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;login(&#34;admin&#34;,&#34;123456&#34;) sensors=loadTable(&#34;dfs://svmDemo&#34;,&#34;sensors&#34;)&lt;/codeblock&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-趋势查询&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;544:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;544:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.1. 趋势查询&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;544:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;546:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;将一天内 10 个指定测点的数据，按每 2 分钟分成若干时间段，每个时间段内计算最大值、最小值、开始值与结束值。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:35;547:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select first(value), last(value), max(value), min(value) from sensors where id in [1,2,51,52,101,102,151,152,201,202] and datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59 group by id, bar(datetime,120)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-对比查询&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;554:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;554:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.2. 对比查询&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;554:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;556:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;查询某天内 1，2，3 号设备中的 1 号指标每分钟的平均值，将结果按分钟与设备编号排列，以便于对比。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;558:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 支持在 SQL 中使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:46;558:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;pivot by&lt;/codeph&gt;子句将表中某列的内容按照两个维度重新排列，亦可配合数据转换函数使用。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:47;558:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;pivot by&lt;/codeph&gt;是 DolphinDB 对标准 SQL 语句的拓展。此查询的代码如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:36;559:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select avg(value) from sensors where id in [1,51,101], datetime between 2020.09.01T00:00:00 : 2020.09.01T23:59:59 pivot by datetime.minute() as time, id&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;564:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;结果如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:37;565:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;time C1 C51 C101 00:00m 0.5375 0.4846 0.4858 00:01m 0.5422 0.5549 0.5073 00:02m 0.4576 0.5358 0.4846 ...&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-分组查询-top-n&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.3. 分组查询 top N&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;575:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;查询指定 1 小时内 CPU 平均利用率最高的三台设备。假设 CPU 利用率为指标 1。这里使用嵌套查询，先分组计算平均值，然后根据平均值排序，再对结果使用 top 子句（或 limit 子句）。代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:38;576:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select top 3 id from ( select avg(value) as avg from sensors where mod(id, 50)=1, datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59 group by id order by avg desc )&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;以上脚本亦可写为：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:39;587:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select id from ( select avg(value) as avg from sensors where mod(id, 50)=1, datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59 group by id order by avg desc ) limit 3&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;596:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;注意这里 id 查询条件用了 mod(id, 50)=1，查询时不能分区剪枝，是因为这个查询本身就需要扫描全部 id 的分区，若只在部分设备中查询，建议用 id in [1,51,...]的方式。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;34-关联查询&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.4. 关联查询&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;599:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 支持如下 7 种关联查询：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;601:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;601:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;equal join (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:48;601:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;ej&lt;/codeph&gt;)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;602:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;left join (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:49;602:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;lj&lt;/codeph&gt;)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;603:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;cross join (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:50;603:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;cj&lt;/codeph&gt;)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;604:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;full join (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:51;604:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;fj&lt;/codeph&gt;)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;605:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;asof join (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:52;605:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;aj&lt;/codeph&gt;)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;606:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;window join (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:53;606:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;wj&lt;/codeph&gt;)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;607:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;prefix join (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:54;607:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;pj&lt;/codeph&gt;)&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:113;609:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 1：分布式表 sensors 中只存储了测点编号，现提供这些测点的描述信息，在查询分析时需与这些信息进行关联查询和计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:114;611:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;这些测点信息可以存储在维度表中。维度表是分布式数据库中没有分区的表，一般用于存储不频繁更新的小数据集。维度表可与任何分布式表，维度表以及内存表进行关联。DolphinDB 自动会在各个节点上缓存 (cache) 维度表，以提升查询和关联的性能。下面例子创建维度表 tagInfo 并插入一些样本数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:40;612:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;db = database(&#34;dfs://svmDemo&#34;) schema = table(1:0, `tagId`machineId`tagName`organization`description, [INT,INT,SYMBOL,SYMBOL,SYMBOL]) dt = db.createTable(schema,`tagInfo) tagInfo=loadTable(&#34;dfs://svmDemo&#34;,&#34;tagInfo&#34;) t = table(1 2 51 52 as tagId,1 1 2 2 as machineId,`speed`temperature`speed`temperature as tagName,`hangzhou`hangzhou`shanghai`shanghai as organization, &#34;Speed/No.1 Wind Turbine in Hangzhou&#34; &#34;Temperature/No.1 Wind Turbine in Hangzhou&#34; &#34;Speed/No.2 Wind Turbine in Shanghai&#34; &#34;Temperature/No.2 Wind Turbine in Shanghai&#34; as description ) tagInfo.append!(t)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:115;622:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;sensors 与 tagInfo 进行 equal join 关联查询：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:41;623:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select tagId,datetime,value,machineId,tagName,organization from ej(sensors,tagInfo,`id,`tagid) where machineId in [1,2], datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59 order by datetime&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:116;626:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;结果如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;6&#34; xtrc=&#34;tgroup:5;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:13;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:14;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:15;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:16;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:17;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:18;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:54;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tagId&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:55;628:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;datetime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:56;628:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;value&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:57;628:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;machineId&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:58;628:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tagName&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:59;628:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;organization&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;630:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;630:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:60;630:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:61;630:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.09.01T00:00:00&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:62;630:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;95.4607&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:63;630:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:64;630:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;speed&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:65;630:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;hangzhou&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;631:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:66;631:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:67;631:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.09.01T00:00:00&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:68;631:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;97.5109&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:69;631:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:70;631:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;temperature&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:71;631:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;hangzhou&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;632:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:72;632:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;51&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:73;632:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.09.01T00:00:00&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:74;632:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;67.7972&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:75;632:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:76;632:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;speed&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:77;632:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;shanghai&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;633:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:78;633:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;52&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:79;633:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.09.01T00:00:00&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:80;633:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;76.0762&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:81;633:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:82;633:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;temperature&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:83;633:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;shanghai&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;634:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:84;634:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:85;634:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.09.01T00:00:01&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:86;634:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;49.3085&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:87;634:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:88;634:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;speed&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:89;634:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;hangzhou&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;635:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:90;635:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:morecols=&#34;1&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; nameend=&#34;col3&#34; namest=&#34;col2&#34; xtrc=&#34;entry:91;635:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;...&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:morecols=&#34;1&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; nameend=&#34;col5&#34; namest=&#34;col4&#34; xtrc=&#34;entry:92;635:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:117;637:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 2：根据温度异常指标记录表（t1）以及 sensors 表，寻找温度（3 号指标）异常发生时，同一机器的湿度（4 号指标）的最新值。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:118;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:55;639:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;aj&lt;/codeph&gt;(asof join) 的常用场景是在时间字段上进行非同时连接，为左表中每条记录，在右表中获取符合指定条件的组中该时刻之前（包括该时刻）的最后一条记录。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:119;641:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在本例中，为了展示 asof join，我们将 sensors 中的数据进行了改动，假设温度异常发生之前，有一段时间内 sensors 表中不存在湿度的数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:120;643:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;示例代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:42;645:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;t1 = table(3 53 as id, 1 2 as machineId, 2020.09.01T09:56:06 2020.09.01T09:58:12 as datetime, 50.6 50.7 as anomalyMetrics) t2_1 = select *, 1 as machineId from sensors where id=4, datetime between 2020.09.01T09:00:00 : 2020.09.01T09:54:00 t2_2 = select *, 2 as machineId from sensors where id=54, datetime between 2020.09.01T09:00:00 : 2020.09.01T09:57:00 t2 = unionAll(t2_1, t2_2) select * from aj(t1, t2, `machineId`datetime);&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:121;652:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;asof join 和 left join 的区别为：假设连接列是时间，对于左表中时间 t 对应的行，如果右表中没有与之匹配的记录，则取右表中在 t 之前的最近时间对应的行。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:122;654:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 3：t1 是异常指标记录表，现需要了解异常指标发生时间之前 5 秒钟的原始数据中的指标平均值、最大和最小值。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:123;656:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;此场景可使用函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:56;656:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;wj&lt;/codeph&gt;(window join)，为左表中每条记录，在右表中获取符合指定条件的组基于该时刻的指定时间范围的记录并进行计算。示例代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:43;657:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;t1 = table(1 51 as id, 2020.09.01T09:56:06 2020.09.01T09:56:07 as datetime, 50.6 50.7 as anomalyMetrics) t2 = select * from sensors where id in [1,51], datetime between 2020.09.01T09:00:00 : 2020.09.01T09:59:59 wj(t1, t2, -5000:0, &amp;lt;[avg(value),max(value),min(value)]&amp;gt;, `id`datetime)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:124;662:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 4：现有一张告警表，记录了设备的当前告警信息。告警后，用户需要对告警进行确认和清除。查询时，需要显示告警信息以及告警状态。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:125;664:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;告警表 Alarm 是分布式表，不支持单行更新。因此创建一张告警操作流水表 AlarmAction 记录告警确认和清除信息。每确认或清除一次，往操作流水表中添加一条记录。查询时将告警表和操作流水表通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:57;664:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;lj&lt;/codeph&gt;关联。示例代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:44;666:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;//创建告警表和告警操作流水表 alarm = table(1:0, `ID`deviceID`time`priority`desc, [UUID,SYMBOL, DATETIME, INT, STRING]) db1 = database(, VALUE, 2020.01.01..2020.12.31) db2 = database(, HASH, [SYMBOL, 10]) db = database(&#34;dfs://demo&#34;, COMPO, [db1,db2]) db.createPartitionedTable(alarm, &#34;alarm&#34;, `time`deviceID) alarmAction = table(1:0, `ID`deviceID`time`action`actionTime`user`remark, [UUID,SYMBOL,DATETIME, SYMBOL, DATETIME, SYMBOL, STRING]) db = database(&#34;dfs://demo&#34;) db.createPartitionedTable(alarmAction, &#34;alarmAction&#34;, `time`deviceID) //告警表中模拟写入3条记录 alarm = loadTable(&#34;dfs://demo&#34;,&#34;alarm&#34;) action = loadTable(&#34;dfs://demo&#34;,&#34;alarmAction&#34;) t = table([uuid(&#34;b9f36c85-43ce-45a3-8427-b3529a6c41cc&#34;),uuid(&#34;baba6fe6-67b9-4c18-885a-3fd6edd3002e&#34;),uuid(&#34;b510c959-4f9b-4eaf-81a7-ee7e420810c0&#34;)] as UUID,&#34;BDSA11_PSCADA&#34; &#34;DMS01&#34; &#34;XKZDEPOT_CCTV_DI20&#34; as deviceID,take(now().datetime(),3) as time,1..3 as priority,&#34;CONN_FAIL&#34; &#34;OFFLINE&#34; &#34;ERROR&#34; as descs) alarm.append!(t) //确认2条告警，写入告警操作流水表 arrUUID = uuid([&#34;b9f36c85-43ce-45a3-8427-b3529a6c41cc&#34;,&#34;baba6fe6-67b9-4c18-885a-3fd6edd3002e&#34;]) tmp = select ID,deviceId, time,&#34;CONFIRM&#34; as action, now().datetime() as actionTime, &#34;admin&#34; as actionUser, &#34;test confirm&#34; as remark from alarm where time &amp;gt; today().datetime(), ID in arrUUID action.tableInsert(tmp) //清除1条告警，写入告警操作流水表 tmp = select ID,deviceId, time,&#34;CLEAR&#34; as action, now().datetime() as actionTime, &#34;admin&#34; as actionUser, &#34;test clear&#34; as remark from alarm where time &amp;gt; today().datetime(), ID =uuid(&#34;b9f36c85-43ce-45a3-8427-b3529a6c41cc&#34;) action.tableInsert(tmp) //查询告警信息以及确认、清除信息 t1 = select ID,time, deviceID, actionTime,user as confirmUser, remark as confirmRemark from action where time &amp;gt; today().datetime(), action=&#34;CONFIRM&#34; t2 = select ID, actionTime, user as clearUser, remark as clearRemark from action where time &amp;gt; today().datetime(), action=&#34;CLEAR&#34; tmp = lsj(t1,t2,`ID) select * from lj(alarm, tmp,`time`deviceId`ID,`time`deviceID`ID) where time &amp;gt; today().datetime() &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:126;700:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;查询结果如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;11&#34; xtrc=&#34;tgroup:6;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:19;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:20;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:21;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:22;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:23;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:24;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:25;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col8&#34; colnum=&#34;8&#34; xtrc=&#34;colspec:26;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col9&#34; colnum=&#34;9&#34; xtrc=&#34;colspec:27;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col10&#34; colnum=&#34;10&#34; xtrc=&#34;colspec:28;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col11&#34; colnum=&#34;11&#34; xtrc=&#34;colspec:29;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:93;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;ID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:94;702:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;deviceID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:95;702:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;time&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:96;702:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;priority&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:97;702:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;desc&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:98;702:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;actionTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:99;702:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;confirmUser&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col8&#34; dita-ot:x=&#34;8&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:100;702:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;confirmRemark&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col9&#34; dita-ot:x=&#34;9&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:101;702:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;t2_actionTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col10&#34; dita-ot:x=&#34;10&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:102;702:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;clearUser&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col11&#34; dita-ot:x=&#34;11&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:103;702:103&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;clearRemark&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;704:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;704:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:104;704:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;b9f...&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:105;704:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;BDSA11_PSCADA&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:106;704:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.11.05T17:10:11&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:107;704:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:108;704:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;CONN_FAIL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:109;704:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.11.05T17:19:26&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:110;704:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;admin&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col8&#34; dita-ot:x=&#34;8&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:111;704:87&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;test confirm&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col9&#34; dita-ot:x=&#34;9&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:112;704:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.11.05T17:30:53&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col10&#34; dita-ot:x=&#34;10&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:113;704:122&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;admin&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col11&#34; dita-ot:x=&#34;11&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:114;704:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;test clear&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;705:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:115;705:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;bab...&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:116;705:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DMS01&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:117;705:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.11.05T17:10:11&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:118;705:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:119;705:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;OFFLINE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:120;705:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.11.05T17:19:26&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:121;705:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;admin&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col8&#34; dita-ot:morecols=&#34;3&#34; dita-ot:x=&#34;8&#34; dita-ot:y=&#34;3&#34; nameend=&#34;col11&#34; namest=&#34;col8&#34; xtrc=&#34;entry:122;705:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;test confirm&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;706:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:123;706:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;b51...&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:124;706:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;XKZDEPOT_CCTV_DI20&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:125;706:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2020.11.05T17:10:11&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:126;706:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:127;706:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;ERROR&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:morecols=&#34;5&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; nameend=&#34;col11&#34; namest=&#34;col6&#34; xtrc=&#34;entry:128;706:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;35-降精度&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;710:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;710:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.5. 降精度&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;710:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:127;712:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 支持最高纳秒级精度的时间序列数据，可将高精度大数据集聚合转换成低精度小数据集。支持多种时间精度分组抽样：月（month）、天（date）、分钟 (minute)、秒 (second)，以及其他任意时间精度。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:128;714:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 1：计算一天内指定测点每分钟的平均值。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:45;715:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select avg(value) as avg from sensors where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.01T23:59:59 group by id, minute(datetime)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:129;721:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 2：计算一天内指定测点每 30 秒的平均值。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:46;722:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select avg(value) as avg from sensors where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59 group by id, bar(datetime,30)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:130;728:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 3：先对每个指定测点求每 10 秒的平均值，再对每测点的平均值结果求最小值。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:47;729:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select min(avg) as minAvg from( select avg(value) as avg from sensors where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59 group by id, bar(datetime,10) ) group by id&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;36-插值查询&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;738:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;738:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.6. 插值查询&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;738:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:131;740:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在物联网领域经常会发生采集的数据缺失。对数据中的空值，DolphinDB 提供了&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:58;740:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;interpolate&lt;/codeph&gt;用于插值查询，插值的方式支持：linear（线性插值），pad（使用已有的值填充），nearest（使用最接近 NULL 值的有效值填充）和 krogh（使用 krogh 多项式插值）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:132;742:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 还提供了以下 4 个填充 NULL 值的函数：向前/向后取非空值（&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:59;742:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;bfill&lt;/codeph&gt;/&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:60;742:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;ffill&lt;/codeph&gt;），线性填充（&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:61;742:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;lfill&lt;/codeph&gt;）和指定值填充（&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:62;742:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;nullFill&lt;/codeph&gt;）。用户也可以通过脚本或 C++ 插件扩充新的插值函数。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:133;744:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 1：使用 ffill 函数进行填充空值。在脚本中，首先制造一分钟的空值。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:48;746:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;t = select * from sensors where id=1, datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59 update t set value=NULL where datetime between 2020.09.01T00:08:00 : 2020.09.01T00:09:00 update t set value=value.ffill() &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:134;752:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例 2：查询一段时间内每分钟的平均值，如果某一分钟内没有原始数据，需要插值。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:135;754:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 从 1.30.7 版本起在 group by 子句中引入了 dummy 函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:63;754:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;interval(X, duration, fill)&lt;/codeph&gt;来实现插值功能，fill 的方式有 5 种，分别是：prev，缺失值使用前一个值填充；post，缺失值使用后一个值填充；linear，缺失值使用线性插值填充（注意如果列是非数值列，则无法使用线性插值填充，这种情况下会回退到使用 prev 的方式填充）；null，缺失值使用 null 值填充；numericValue，以一个指定的 numeric 值来填充。例子如下，插值的方式用了线性插值：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:49;756:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select avg(value) as value from sensors where id = 1 and date(datetime)=2020.09.01 group by id, interval(datetime, 1m, &#34;linear&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:136;762:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;762:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;注意&lt;/b&gt;：1.30.7 前的版本，要用下面的方法实现，先生成时间戳表做为左表，然后用 lsj 连接：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:50;764:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;timeRange = 2020.09.01T00:00:00+(0..1439)*60 t = table(timeRange as time,take(1,size(timeRange)) as id) t1=select avg(value) as value from sensors where id = 1 and datetime between 2020.09.01T00:00:00 : 2020.09.01T23:59:59 group by id,bar(datetime,60) as time delete from t1 where rowNo(id)%2=1 //为了查看插值效果，特意删去t1偶数行 select time,interpolate(value) as value ,t.id from lsj(t,t1,`time)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;37-去重&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;777:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;777:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.7. 去重&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;777:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:137;779:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若从设备采集的数据有重复，或者一个时间间隔内有多条记录，但查询时每个时间间隔只需要一条记录，这些场景就需要去除表中的重复记录。DolphinDB 的数据模型支持重复数据，在插入时也不检测重复数据。若要去除分布式表中的重复记录，可以使用 context by 子句去重。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:138;781:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;context by 是 DolphinDB 独有的功能，是对标准 SQL 语句的拓展。context by 与 group by 类似，都对数据进行分组，但是使用 group by 时，每一组返回一个标量值，而使用 context by 时，每一组返回一个和组内元素数量相同的向量。context by 与 limit 一起使用能够获取表中每个分组前 n 条记录或最后 n 条记录。用 context by 去重的例子如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:51;782:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select * from sensors where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59 context by id, datetime limit -1&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:139;785:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;上述代码 limit 后面为负数，表示取每个分组的最后一条记录。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;38-函数视图&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;787:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;787:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.8. 函数视图&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;787:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:140;789:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;函数视图是封装了访问数据库以及相关计算语句的自定义函数。它类似关系数据库中的存储过程，可以封装复杂的业务逻辑，方便用户调用。与其他自定义函数会话隔离不同，函数视图可以实现会话之间的共享。函数视图的定义持久化存储在控制节点，因此如果 DolphinDB 集群重启，之前定义的函数视图仍然可以使用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:141;791:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下面例子使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:64;791:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;addFunctionView&lt;/codeph&gt;函数定义了一个函数视图 task1。其中先用 pivot by 对指定设备的第 1-6 个指标按分钟分组按列转置，然后对转置后的表进行列名修改，再对每列分别进行计算。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:52;792:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;def task1(MachineId){ t=select avg(value) from loadTable(&#34;dfs://svmDemo&#34;,&#34;sensors&#34;) where id in 1..6 + (MachineId-1)*50, datetime &amp;gt;datetimeAdd(now(),-1,`h).datetime() pivot by datetime.minute() as time, id t.rename!(`time`tag1`tag2`tag3`tag4`tag5`tag6) return select time, log(tag1) as target1, sqrt(tag2) as target2, tan(tag3) as target3, sin(tag4) as target4, floor(tag5) as target5, abs(tag6) as target6 from t } addFunctionView(task1) &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;39-api-查询数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.9. API 查询数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:142;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 提供 Python, C++, Java, C#, Go, JavaScript, Rust 等常用语言的 API 用于读写数据库。通常数据查询的流程如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;807:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:41;807:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;807:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:42;807:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;建立一个连接并登录&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:43;808:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:2;808:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:44;808:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;通过 run(&#34;DolphinDBScript&#34;) 运行查询语句查询或 run(&#34;DolphinDBFunctionName&#34;,args) 运行函数或函数视图查询。&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:143;810:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用 Python API 从分布式表中读取数据的例子如下。其中第一个 run 是运行查询语句，第二个 run 是运行上一小节定义的函数视图：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:53;812:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;import dolphindb as ddb import pandas as pd s = ddb.session() try: s.connect(&#34;127.0.0.1&#34;,8848,&#34;admin&#34;,&#34;123456&#34;) except Exception as e: print e exit(1) script=&#34;&#34;&#34; select * from loadTable('dfs://svmDemo','sensors') where id=1, datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59 &#34;&#34;&#34; try: t = s.run(script) print(t) t = s.run(&#34;task1&#34;,1) print(t) except Exception as e: print e&lt;/codeblock&gt;&lt;lq class=&#34;- topic/lq &#34; xtrc=&#34;lq:1;834:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:144;834:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;注意：&lt;/p&gt;&lt;/lq&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:18;835:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:45;835:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;run 方法可接受的脚本最大长度为 65,535 字节。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:46;836:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;脚本如果是多行，可以采用三引号的方式将脚本格式化，这样更易于维护。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:47;837:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 run 前，不需要判断连接是否正常，直接 run 即可。系统会判断有没有连接，若没有，就会自动尝试重连，连不上或执行脚本失败，会抛出异常，因此代码中需要俘获异常并进行处理。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:145;840:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用 Java API 从分布式表中读取数据的例子如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:146;842:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 Java API 中，数据表保存为 BasicTable 对象。由于 BasicTable 是列式存储，所以若要在 Java API 中读取行数据需要先取出需要的列，再取出行。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;java&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:54;843:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;public void getBasicTable(BasicTable table1) throws Exception{ BasicIntVector idVec = (BasicIntVector) table1.getColumn(&#34;id&#34;); BasicDateTimeVector timeVec = (BasicDateTimeVector) table1.getColumn(&#34;time&#34;); BasicFloatVector valueVec = (BasicFloatVector) table1.getColumn(&#34;value&#34;); for(int ri=0; ri&amp;lt;table1.rows(); ri++){ System.out.println(idVec.getInt(ri)); LocalDateTime timestamp = timeVec.getDatetime(ri); System.out.println(timestamp); System.out.println(valueVec.getDouble(ri)); } } DBConnection conn = new DBConnection(); try { conn.connect(SERVER, PORT, USER, PASSWORD); BasicTable table1=conn.run(String.format(&#34;select * from loadTable('%s','%s') where id=1, datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59&#34;,dbPath,tableName); getBasicTable(table1) ; } catch (IOException e) { e.printStackTrace(); }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:147;865:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;对于返回大结果集的查询，JAVA API 提供了分段读取方法 (此方法仅适用于 DolphinDB 1.20.5 及其以上版本)。即在 run 方法中使用参数 fetchSize 指定分段大小，查询结果保存到 EntityBlockReader 对象，然后通过 read() 方法一段段的读取数据。代码示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;java&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:55;866:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DBConnection conn = new DBConnection(); conn.connect(SERVER, PORT, USER, PASSWORD); EntityBlockReader v = (EntityBlockReader)conn.run(&#34;select * from loadTable('dfs://svmDemo','sensors') where datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59&#34;,(ProgressListener) null,4,4,10000); BasicTable data = (BasicTable)v.read(); while(v.hasNext()){ BasicTable t = (BasicTable)v.read(); data = data.combine(t); }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:148;876:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在使用上述分段读取的方法时，若数据未读取完毕，需要放弃后续数据的读取时，必须调用 skipAll 方法，否则会导致套接字缓冲区滞留数据，引发后续数据的反序列化失败。正确使用的示例代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;java&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:56;877:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; EntityBlockReader v = (EntityBlockReader)conn.run(&#34;select * from loadTable('dfs://svmDemo','sensors') where datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59&#34;,(ProgressListener) null,4,4,10000); BasicTable data = (BasicTable)v.read(); v.skipAll(); BasicTable t1 = (BasicTable)conn.run(&#34;select * from loadTable('dfs://svmDemo','sensors') where datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59&#34;); //若没有 skipAll 此段会抛出异常。&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:149;885:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 DolphinDB 中，分页查询还可以通过 top 关键字实现，比如查询第 50 到 100 行：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:57;886:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;select top 50:100 * from sensors where datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:150;889:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;但这种方法每获取一页都要重新查询一次，效率较低。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:151;891:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;有关 API 查询数据更详细的信息，请参阅 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/pydoc/py.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:20;891:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;Python API&lt;/xref&gt; 与 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/javadoc/newjava.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:21;891:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;JAVA API&lt;/xref&gt; 等教程。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-生产数据写入&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:28;893:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:28;893:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4. 生产数据写入&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:28;893:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:152;895:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 提供 Python, C++, Java, C#, Go, JavaScript, Rust 等常用语言的 API，将从设备采集的数据写入到 DolphinDB 数据库中。DolphinDB 中内存表可以像传统数据库那样利用循环调用 insert into 语句写入数据。对分布式表，DolphinDB 推荐一种更为高效的批量写入数据方式，即将数据组织成一个 table 对象，利用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:65;895:202&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tableInsert&lt;/codeph&gt;方式来批量写入。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:153;897:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;通常数据写入的流程如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:19;899:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:48;899:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1-建立一个连接并登录。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:49;900:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2-将待写入的数据组织成各 API 语言的本地对象。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:50;901:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3-通过连接对象调用 tableInsert 函数，将本地对象上传并写入数据库中。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:154;903:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;以下为各 API 的写入示例代码：&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-java-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:29;905:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:29;905:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4.1. Java API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:29;905:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;java&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:58;907:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DBConnection conn = new DBConnection(); try{ conn.connect(SERVER, PORT, USER, PASSWORD); List&amp;lt;String&amp;gt; colNames = Arrays.asList(&#34;id&#34;,&#34;datetime&#34;,&#34;value&#34;) ArrayList&amp;lt;Integer&amp;gt; idArray = new ArrayList&amp;lt;Integer&amp;gt;(Arrays.asList(1,2)); ArrayList&amp;lt;Long&amp;gt; datetimeArray = new ArrayList&amp;lt;Long&amp;gt;(Arrays.asList(1600735563458l,16007355634582l)); ArrayList&amp;lt;Double&amp;gt; valueArray = new ArrayList&amp;lt;Double&amp;gt;(Arrays.asList(22.3,43.1)); List&amp;lt;Vector&amp;gt; cols = Arrays.asList(new BasicIntVector(idArray),new BasicTimestampVector(datetimeArray),new BasicDoubleVector(valueArray)); BasicTable data = new BasicTable(colNames,cols); List&amp;lt;Entity&amp;gt; args = new ArrayList&amp;lt;Entity&amp;gt;(1); args.add(data); conn.run(String.format(&#34;tableInsert{loadTable('%s','%s')}&#34;,dbPath,tableName), args); }catch (IOException ex){ ex.printStackTrace(); } &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-c-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:30;928:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:30;928:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4.2. C# API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:30;928:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;csharp&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:59;930:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DBConnection conn = new DBConnection(); try { conn.connect(SERVER, PORT, USER, PASSWORD); List&amp;lt;String&amp;gt; colNames = new List&amp;lt;string&amp;gt;() { &#34;id&#34;, &#34;datetime&#34;, &#34;value&#34; }; List&amp;lt;int&amp;gt; idArray = new List&amp;lt;int&amp;gt;() { 1, 2 }; List&amp;lt;long&amp;gt; datetimeArray = new List&amp;lt;long&amp;gt;() { 1600735563458, 16007355634582 }; List&amp;lt;Double&amp;gt; valueArray = new List&amp;lt;Double&amp;gt;() { 22.3, 43.1 }; List&amp;lt;IVector&amp;gt; cols = new List&amp;lt;IVector&amp;gt;() { new BasicIntVector(idArray.ToArray()), new BasicTimestampVector(datetimeArray.ToArray()), new BasicDoubleVector(valueArray.ToArray()) }; BasicTable data = new BasicTable(colNames, cols); List&amp;lt;IEntity&amp;gt; args = new List&amp;lt;IEntity&amp;gt;(1); args.Add(data); conn.run(String.Format(&#34;tableInsert{{loadTable('{0}','{1}')}}&#34;, &#34;dfs://svmDemo&#34;, &#34;sensors&#34;), args); } catch (IOException ex) { Console.WriteLine(ex.StackTrace); } &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;43-python-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:31;953:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:31;953:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4.3. Python API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:31;953:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:60;954:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;s = ddb.session() s.connect(SERVER, PORT, USER, PASSWORD) data = {'id': np.array([1, 2], dtype=np.int32), 'datetime': np.array([1600735563458, 16007355634582]), 'value': np.array([22.3, 43.1])} try: s.run(&#34;tableInsert{{loadTable('{db}', `{tb})}}&#34;.format(db=dbPath,tb=tableName), pd.DataFrame(data)) except Exception as e: print e&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;44-c-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:32;966:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:32;966:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4.4. C++ API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:32;966:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:61;967:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;TableSP createDemoTable(long rows) { vector&amp;lt;string&amp;gt; colNames = {&#34;id&#34;,&#34;time&#34;,&#34;value&#34;}; vector&amp;lt;DATA_TYPE&amp;gt; colTypes = {DT_INT, DT_DATETIME, DT_FLOAT}; int colNum = 3, rowNum = rows, indexCapacity = rows; ConstantSP table = Util::createTable(colNames, colTypes, rowNum, indexCapacity); vector&amp;lt;VectorSP&amp;gt; columnVecs; for (int i = 0; i &amp;lt; colNum; i++) columnVecs.push_back(table-&amp;gt;getColumn(i)); for ( int i = 0; i &amp;lt; rowNum; i++) { columnVecs[0]-&amp;gt;setInt(i, i % 500 +1); columnVecs[1]-&amp;gt;setInt(i, Util::getEpochTime()/1000); columnVecs[2]-&amp;gt;setFloat(i, 1.0); } return table; } DBConnection conn; try { bool ret = conn.connect(hString, pLong, &#34;admin&#34;, &#34;123456&#34;); if (!ret) { cout &amp;lt;&amp;lt; &#34;Failed to connect to the server&#34; &amp;lt;&amp;lt; endl; return 0; } } catch (exception &amp;amp;ex) { cout &amp;lt;&amp;lt; &#34;Failed to connect with error: &#34; &amp;lt;&amp;lt; ex.what(); return -1; } TableSP table = createDemoTable(cLong, sLong, 1); vector&amp;lt;ConstantSP&amp;gt; args; args.push_back(table); try { conn.run(&#34;tableInsert{loadTable('dfs://svmDemo', `sensors)}&#34;, args); } catch (exception &amp;amp;ex) { cout &amp;lt;&amp;lt; &#34;Failed to run with error: &#34; &amp;lt;&amp;lt; ex.what(); }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:155;1007:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;C++ API 读写 Vector、Table 等数据类型有多种方法，不同场景不同的读写方法有较大的性能差异，详情请参阅&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;cpp_data_io.md&#34; xtrc=&#34;xref:22;1007:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;C++ API 数据读写指南&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;45-提升写入性能&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:33;1009:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:33;1009:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4.5. 提升写入性能&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:33;1009:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:156;1011:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;API 的写入性能的优化主要可通过以下几个方面：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:20;1013:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:51;1013:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;批量写入：每次组织大批量数据写入能够有效提升性能。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:52;1014:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;并行写入：将不同分区的数据，分多个任务并行写入。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:157;1016:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 的最小存储单元是分区，同一个分区不允许多个线程同时写入，否则会抛出异常。所以在并行写入时，需要考虑将数据按分区进行分流，避免同时向一个分区写入数据。具体多线程写入的实现案例请参阅&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://gitee.com/dolphindb/api-cplusplus/tree/main/example/DFSWritingWithMultiThread&#34; scope=&#34;external&#34; xtrc=&#34;xref:23;1016:100&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;C++ 多线程并行写入示例代码&lt;/xref&gt;。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:21;1017:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:53;1017:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;异步写入：异步写入在写入时不需要等待 server 回复确认消息，可显著提高连续写入的速度，适用于对写入速度要求高但可靠性要求不苛刻的场景。使用异步写入的方法是在声明 DBConnection 类变量的时候，置 enableAYSN 参数值为 true 即可。适用于 DolphinDB 1.10.17、1.20.6 及以上 linux64 版本。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;46-提升数据压缩比&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:34;1019:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:34;1019:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4.6. 提升数据压缩比&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:34;1019:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:158;1021:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 压缩算法支持压缩效果和解压缩时间综合性能较高的 LZ4 和 DELTA 算法。系统默认使用 LZ4 压缩算法，时间/日期类型或者相邻数据变化较小的整型建议采用 DELTA 算法。DolphinDB 采用增量压缩策略，每次对新增数据进行压缩。对小批量写入的场景，DolphinDB 提供了写入缓存（Cache Engine）机制。写完 WAL 之后，数据写入缓存，到达一定阈值以后，开始异步将缓存中的数据写入磁盘中。这相当于把少量多次的写入变成了批次写入，不仅能提升写入性能，也能提高压缩率。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:159;1023:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;文件&lt;xref class=&#34;- topic/xref &#34; format=&#34;bz2&#34; href=&#34;https://www.dolphindb.cn/downloads/docs/compressDemo.tar.bz2&#34; scope=&#34;external&#34; xtrc=&#34;xref:24;1023:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;compressDemo.tar.bz2&lt;/xref&gt;保存了从一个地震计采集的某分量一天的实际数据。数据分三个字段：tagId，标签标识，值都是 1；time 时间戳，每个间隔 10 毫秒;data，采用值，是相邻数据变化较小的整数。下面测试了用 2 种算法，每批写入不同记录数时它们压缩后的字节数。未启用写入缓存机制，测试结果如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;7&#34; xtrc=&#34;tgroup:7;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:30;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:31;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:32;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:33;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:34;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:35;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:36;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:129;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;每批写入记录数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:130;1025:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tagId 用 LZ4&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:131;1025:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tagId 用 DELTA&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:132;1025:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;time 用 LZ4&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:133;1025:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;time 用 DELTA&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:134;1025:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;data 用 LZ4&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:135;1025:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;data 用 DELTA&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;1027:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;1027:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:136;1027:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:137;1027:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;15,528,746&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:138;1027:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,155,816&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:139;1027:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;45,994,143&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:140;1027:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;31,057,472&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:141;1027:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;37,596,365&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:142;1027:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;31,047,336&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;1028:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:143;1028:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;100&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:144;1028:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,639,168&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:145;1028:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3,105,776&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:146;1028:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;35,960,194&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:147;1028:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3,795,960&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:148;1028:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;27,385,932&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:149;1028:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;11,447,608&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;1029:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:150;1029:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;10,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:151;1029:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;150,136&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:152;1029:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,100,840&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:153;1029:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,870,756&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:154;1029:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,138,784&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:155;1029:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,756,356&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:156;1029:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,546,840&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;1030:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:157;1030:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;100,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:158;1030:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;145,647&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:159;1030:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,094,972&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:160;1030:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,863,223&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:161;1030:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,118,460&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:162;1030:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,782,836&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:163;1030:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,540,884&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;1031:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:164;1031:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;8,627,069&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:165;1031:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;144,304&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:166;1031:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,093,160&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:167;1031:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,862,003&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:168;1031:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,116,356&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:169;1031:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,787,171&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:170;1031:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,539,072&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:160;1033:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;启用写入缓存机制，测试结果如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:8;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;7&#34; xtrc=&#34;tgroup:8;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:37;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:38;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:39;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:40;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:41;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:42;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:43;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:8;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:171;1035:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;每批写入记录数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:172;1035:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tagId 用 LZ4&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:173;1035:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;tagId 用 DELTA&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:174;1035:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;time 用 LZ4&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:175;1035:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;time 用 DELTA&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:176;1035:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;data 用 LZ4&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:177;1035:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;data 用 DELTA&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:8;1037:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:37;1037:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:178;1037:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:179;1037:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;146,337&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:180;1037:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,093,420&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:181;1037:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,863,946&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:182;1037:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,118,788&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:183;1037:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,782,183&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:184;1037:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,541,456&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:38;1038:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:185;1038:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;100&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:186;1038:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;144,532&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:187;1038:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,093,176&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:188;1038:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,862,534&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:189;1038:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,116,636&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:190;1038:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,787,829&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:191;1038:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,539,412&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:39;1039:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:192;1039:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;10,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:193;1039:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;144,337&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:194;1039:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,093,168&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:195;1039:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,862,092&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:196;1039:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,116,372&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:197;1039:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,786,148&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:198;1039:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,539,120&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:40;1040:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:199;1040:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;100,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:200;1040:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;144,312&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:201;1040:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,094,972&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:202;1040:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,862,011&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:203;1040:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,116,364&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:204;1040:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,787,179&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:205;1040:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,539,080&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:41;1041:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:206;1041:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;8,627,069&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:207;1041:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;144,312&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:208;1041:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,093,168&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:209;1041:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;34,862,011&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:210;1041:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1,116,356&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:211;1041:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;24,787,171&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:212;1041:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9,539,080&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:161;1043:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;从测试结果可以发现，这个数据集的标签标识用 LZ4 算法、时间戳和采样值用 DELTA 算法压缩压缩效果较好。若标签标识用 LZ4 算法、时间戳和采样值用 DELTA 算法压缩，时间戳和采样值两个字段的综合压缩比达到 10:1，标签标识、时间戳和采样值三个字段的综合压缩比达到 13:1。在未启用写入缓存（Cache Engine）机制时，随着每批写入记录数越多，压缩效果越好。启用写入缓存机制后，小批量写入也能达到与大批量写入同样的压缩效果。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:162;1045:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;测试脚本&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/compressDemo.txt&#34; xtrc=&#34;xref:25;1045:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;下载&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-实时数据和流计算&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:35;1047:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:35;1047:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5. 实时数据和流计算&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:35;1047:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:163;1049:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 提供了流数据表 (stream table) 和流计算引擎用于实时数据处理。内置流计算框架目前已支持&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/time_series_engine.dita&#34; xtrc=&#34;xref:26;1049:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;时序聚合引擎&lt;/xref&gt;、&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/cross_sectional_engine.dita&#34; xtrc=&#34;xref:27;1049:105&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;横截面聚合引擎&lt;/xref&gt;、&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;Anomaly_Detection_Engine.md&#34; xtrc=&#34;xref:28;1050:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;异常检测引擎&lt;/xref&gt;和自定义流计算引擎。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:22;1051:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:54;1051:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;时序聚合引擎 (Time-series Aggregator)：能对设备状态进行纵向聚合计算（按时间序列聚合），或者将多个设备状态横向聚合后再按时间聚合。时序聚合支持滑动窗口的流式计算。DolphinDB 对内置的窗口聚合函数均进行了性能优化，单核 CPU 每秒可完成近百万状态的时序聚合。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:55;1052:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;横截面聚合引擎 (Cross-sectional Aggregator)：是快照引擎的扩展，对设备状态进行横向聚合计算，比如计算一批设备的最新温度均值。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:56;1053:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;异常检测引擎 (Anomaly Detection Engine)：能实时检测数据是否符合用户自定义的警报指标，如发现异常数据，将它们输出到表中，满足物联网实时监控和预警的需求。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:57;1054:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;自定义流计算引擎：当以上三种引擎都不能满足需求时，用户也可以使用 DolphinDB 脚本或 API 语言自定义消息处理函数。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;51-数据写入流数据表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:36;1056:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:36;1056:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5.1. 数据写入流数据表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:36;1056:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:164;1058:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 DolphinDB 中执行如下脚本定义流数据表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:62;1059:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;t = streamTable(1:0,`id`datetime`value,[INT,DATETIME,FLOAT]); enableTableShareAndPersistence(table=t, tableName =`iot_stream, cacheSize=1000000, preCache=0) &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;52-api-写入&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:37;1063:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:37;1063:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5.2. API 写入&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:37;1063:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:165;1065:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用 API 写入流数据表与写入分布式表的方法非常相似，不同的地方主要有两点：一是流数据表与分布式数据库不同，流数据表的数据类型需要用户保证一致，不会自动转换；二是流数据表没有分区概念，多线程可以同时写入。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:166;1067:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;当用户写入的数据与流数据表的定义结构不一致需要转换时，通常可以通过自定义写入函数来实现。比如写入数据的时间戳是长整型表示的值，而 DolphinDB 字段是 Datetime 类型，这个转换可以用一个自定义写入函数来完成，在下例中用 java 代码来展示，其他语言的 API 也支持用同样的方式实现。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:167;1069:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在 java 环境中写入 dolphindb 的示例代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;java&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:63;1071:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DBConnection conn = new DBConnection(); try { conn.connect(&#34;localhost&#34;, 8848, &#34;admin&#34;, &#34;123456&#34;, &#34;def saveData(iot_stream, data){t = select id, datetime(timestamp(datetime)) as datetime,value from data;iot_stream.tableInsert(t)}&#34;); List&amp;lt;String&amp;gt; colNames = Arrays.asList(&#34;id&#34;, &#34;datetime&#34;, &#34;value&#34;); ArrayList&amp;lt;Integer&amp;gt; idArray = new ArrayList&amp;lt;Integer&amp;gt;(Arrays.asList(1, 2)); ArrayList&amp;lt;Long&amp;gt; datetimeArray = new ArrayList&amp;lt;Long&amp;gt;(Arrays.asList(1600735563458l, 16007355634582l)); ArrayList&amp;lt;Double&amp;gt; valueArray = new ArrayList&amp;lt;Double&amp;gt;(Arrays.asList(22.3, 43.1)); List&amp;lt;Vector&amp;gt; cols = Arrays.asList(new BasicIntVector(idArray), new BasicTimestampVector(datetimeArray), new BasicDoubleVector(valueArray)); BasicTable data = new BasicTable(colNames, cols); List&amp;lt;Entity&amp;gt; args = new ArrayList&amp;lt;Entity&amp;gt;(1); args.add(data); conn.run(&#34;saveData{iot_stream}&#34;, args); }catch(IOException ex){ ex.printStackTrace(); }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:168;1090:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 支持通过插件从 opc 和 mqtt 服务器获取数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:169;1092:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;对于常用插件，建议在节点配置文件中通过 preloadModules 方式预加载，这样节点启动后在脚本中可以直接使用插件，无需再调用 loadPlugin。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:64;1093:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;preloadModules=plugins::opc,plugins::mqtt&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:23;1097:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:58;1097:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:170;1097:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;以下代码是 DolphinDB 脚本调用 OPC UA 插件来订阅 opc server 数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:65;1099:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;loadPlugin(&#34;/plugins/opcua/PluginOPCUA.txt&#34;) //预加载可省略 conn = opcua::connect(EndpointUrl,&#34;myclient&#34;) opcua::subscribe(conn, 3, [&#34;Counter&#34;,&#34;Expression&#34;,&#34;Random&#34;,&#34;Sawtooth&#34;],iot_stream)&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:59;1105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:171;1105:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;以下代码是 DolphinDB 脚本调用 mqtt 插件来订阅 mqtt server 数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:66;1106:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;loadPlugin(&#34;/plugins/mqtt/PluginMQTTClient.txt&#34;) //预加载可省略 p = createCsvParser([INT, TIMESTAMP, FLOAT], ',', ';' ) conn = mqtt::subscribe(&#34;127.0.0.1&#34;,1883,&#34;sensor/#&#34;, p, iot_stream)&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:172;1112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;上述插件均使用了后台任务的方式订阅数据，后台任务在调用订阅函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:66;1112:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;subscribe&lt;/codeph&gt;启动，运行在服务器上。通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:67;1112:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;unsubscribe&lt;/codeph&gt;函数可终止订阅任务。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;53-使用内置计算引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:38;1115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:38;1115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5.3. 使用内置计算引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:38;1115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:173;1117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 提供了时序聚合引擎和横截面聚合引擎来配合流数据订阅处理实时数据。通过订阅将实时数据写入聚合引擎，然后由聚合引擎输出计算结果。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:174;1119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;这里我们通过一个例子来展示如何使用聚合引擎来做实时计算。通常分为如下几个步骤：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:3;1121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:60;1121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:175;1121:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;根据计算的业务需求选择合适的聚合引擎。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:61;1122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:176;1122:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;根据聚合引擎定义结果输出表。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:62;1123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:177;1123:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;根据需求设定订阅过滤器，仅订阅计算所需的数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:178;1125:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;比如下例中使用了 Speed 类测点的数据，假设一共 100 个设备，每一个设备 50 个测点，其中 1 号测点是 speed，那么在订阅时可以使用 DolphinDB 脚本：filter = (0..99)*50+1 以设定 filter[1,51,101,151...]。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:63;1127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:179;1127:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:68;1127:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;subscribeTable&lt;/codeph&gt;设立流数据订阅以及写入聚合引擎的规则。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:64;1128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:180;1128:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;数据进入流数据表后触发订阅及聚合引擎计算。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;531-时序聚合引擎每秒钟计算风机过去-5-分钟的实时转数均值最大值最小值与方差&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:39;1130:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:39;1130:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5.3.1. 时序聚合引擎：每秒钟计算风机过去 5 分钟的实时转数均值、最大值、最小值与方差。&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:39;1130:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:67;1132:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;share streamTable(10000:0, `time`id`avgSpeed`minSpeed`maxSpeed`stdSpeed, [DATETIME, INT,DOUBLE, DOUBLE,DOUBLE,DOUBLE]) as outputTable1 model = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT]) speedAggregator = createTimeSeriesAggregator(name=&#34;speedAggregator&#34;, windowSize=300, step=1, metrics=&amp;lt;[avg(value), max(value), min(value), std(value)]&amp;gt;, dummyTable=model, outputTable=outputTable1,timeColumn= `datetime,keyColumn= `id) subscribeTable(tableName=&#34;iot_stream&#34;, actionName=&#34;speed_calc&#34;, offset=0,handler= append!{speedAggregator}, msgAsTable=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:181;1138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;时序聚合引擎的更多信息请参阅&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/time_series_engine.dita&#34; xtrc=&#34;xref:29;1138:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;流数据时序聚合引擎&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;532-横截面聚合引擎计算当前所有风机的平均转速与最大最小转速差&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:40;1140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:40;1140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5.3.2. 横截面聚合引擎：计算当前所有风机的平均转速与最大最小转速差。&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:40;1140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:68;1142:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;share table(1:0, `time`avgSpeed`spanSpeed, [TIMESTAMP,DOUBLE,DOUBLE]) as outputTable2 model = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT]) speedCrossAggregator=createCrossSectionalAggregator(name=&#34;speedCrossAggregator&#34;,metrics=&amp;lt;[avg(value), max(value)-min(value)]&amp;gt;,dummyTable=model,outputTable=outputTable2, keyColumn=`id, triggeringPattern=`perRow) subscribeTable(tableName=&#34;iot_stream&#34;,actionName=&#34;speedCrossAggregator&#34;,offset=0,handler=append!{speedCrossAggregator}, msgAsTable=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:182;1148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;横截面聚合引擎的更多信息请参阅&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/cross_sectional_engine.dita&#34; xtrc=&#34;xref:30;1148:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;流数据横截面聚合引擎&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;54-异常检测引擎实时转速超出-10或低于-01以及转速差超出-02-时输出异常信号&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:41;1150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:41;1150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5.4. 异常检测引擎：实时转速超出 10，或低于 0.1，以及转速差超出 0.2 时，输出异常信号。&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:41;1150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:183;1152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;用户只需指定异常指标，异常检测引擎就可以实时地进行异常数据检测并输出信号。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:69;1153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;share streamTable(1000:0, `time`anomalyType`anomalyString, [DATETIME, INT, SYMBOL]) as outputTable3 model = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT]) engine = createAnomalyDetectionEngine(name=&#34;engine1&#34;, metrics=&amp;lt;[value &amp;gt; 10, value &amp;lt; 0.1, abs(deltas(value))&amp;gt;0.2]&amp;gt;, dummyTable=model, outputTable=outputTable3,timeColumn=`datetime,windowSize=6, step=3)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:184;1158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;异常检测引擎的更多信息，请参阅 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;Anomaly_Detection_Engine.md&#34; xtrc=&#34;xref:31;1158:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;流数据异常检测引擎&lt;/xref&gt; 和&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;iot_anomaly_detection.md&#34; xtrc=&#34;xref:32;1158:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;流计算引擎实现传感器数据异常检测&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;55-自定义计算引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:42;1160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:42;1160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5.5. 自定义计算引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:42;1160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:185;1162:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;除了内置的聚合引擎之外，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:69;1162:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;subscribeTable&lt;/codeph&gt;函数的 handler 可以指定任意一个自定义函数作为消息处理函数，例如：当风机的 5 分钟转速均值超出一个阈值时，需要邮件告警并采取人工介入，那么可以通过实时自定义函数来达到这一目标。对于阈值设定，系统中有一个表 (threshold) 来保存每类指标的阈值。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:9;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:9;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:44;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:45;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:46;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:9;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:42;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:213;1164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;category&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:214;1164:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;max&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:215;1164:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;min&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:9;1166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:43;1166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:216;1166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;SPD&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:217;1166:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;25&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:218;1166:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;10&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:44;1167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:219;1167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;PRS&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:220;1167:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2.2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:221;1167:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;0.8&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:45;1168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:222;1168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;ELE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:223;1168:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3.7&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:224;1168:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;0.2&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:186;1170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在前述案例中，通过时序聚合引擎已经得到了过去 5 分钟的转速均值指标输出到 outputTable1，可以直接订阅 outputTable1 表来获得 5 分钟均值。当检测到超限数据时，利用 DolphinDB 的 httpClient 插件，可以发送告警到邮件或到其他消息平台。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:70;1172:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;def alertHandler(userId, pwd, msg){ try(loadPlugin(&#34;plugins/httpclient/PluginHttpClient.txt&#34;)) catch(ex){} threshold = select first(max), as max, first(min) as min from loadTable(&#34;dfs://thresholdDB&#34;,&#34;threshold&#34;) where category==&#34;SPD&#34; max = threshold.max[0] min = threshold.min[0] overLimited = select Id, avgSpeed from msg where avgSpeed &amp;gt;max or avgSpeed &amp;lt; min if(overLimited.size()&amp;gt;0){ httpClient::sendEmail(userId,pwd,&#34;alert@company.com&#34;, &#34;转速超限告警&#34; , string(overLimited)) } } subscribeTable(, &#34;outputTable1&#34;, &#34;alertSub&#34;, -1, alertHandler{userId, pwd}, true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:187;1187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;注意：订阅的 handler 必须是一个一元函数，仅接受一个 msg 参数 (msg 即订阅到的实时数据)，若函数有多个参数，需要将除 msg 之外的参数通过部分应用来固化，生成一个符合要求的一元函数。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-高可用测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:43;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:43;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6. 高可用测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:43;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:188;1192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 支持高可用，多个元数据节点和多个数据副本之间保证强一致性。DolphinDB 的高可用机制包括：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:24;1193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:65;1193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;数据高可用。DolphinDB 采用多副本机制，相同数据块的副本存储在不同的数据节点上。一个数据库可以包含上百万个分区，分区的多副本之间使用改良的二阶段提交协议实现分区副本的强一致性。当分区副本数为 N 的时候，在 N-1 个节点宕机的情况下，保证系统可以持续写入和读取。分区的多副本之间没有采用 Raft 协议，主要是考虑到:（1）DolphinDB 集群是为海量数据设计的，单个集群可以支持千万级以上分区数，使用 Raft 和 Paxos 等算法创建千万级的协议组，成本太高；（2）使用 Raft 和 Paxos 等算法，查询数据时只有一个副本可用，对于 OLAP 应用场景来说过于浪费资源；（3）写入的数据如果跨分区，即使采用了 Raft 和 Paxos 等算法，仍然需要二阶段提交协议保证事务的 ACID。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:66;1194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;元数据高可用。DolphinDB 的元数据存储在控制节点上。为了保证元数据的高可用，DolphinDB 通过配置多个控制节点来组成一个 Raft 组。组内节点采用 Raft 协议实现强一致性。Raft 组中只有一个 Leader，其他都是 Follower，Leader 和 Follower 上的元数据保持强一致性。数据节点只能和 Leader 进行交互。如果当前 Leader 不可用，Raft 组会立即选举出新的 Leader 来提供元数据服务。Raft 组能够容忍小于半数的控制节点宕机。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:67;1195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;客户端高可用。DolphinDB API 提供了自动重连和切换机制。使用 API 与 DolphinDB 的数据节点交互时，如果连接的数据节点宕机，API 会先尝试重连，若重连失败会自动切换连接到集群中其他可用的数据节点，继续执行未完成的任务。切换连接数据节点对用户是透明的。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;61-数据高可用测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:44;1197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:44;1197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.1. 数据高可用测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:44;1197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:189;1199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;要使用数据高可用功能，至少需要 2 台物理服务器部署 DolphinDB 集群，每台部署 2 个数据节点。集群部署请参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;multi_machine_cluster_deployment.md&#34; xtrc=&#34;xref:33;1199:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;多服务器集群部署教程&lt;/xref&gt;。其中副本的个数在 controller.cfg 中配置。例如，把副本数设置为 2：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:71;1200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;dfsReplicationFactor=2&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:190;1203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;默认情况下，DolphinDB 允许相同数据块的副本分布在同一台机器上。为了保证数据高可用，需要把相同数据块的副本分布在不同的机器上。请在 controller.cfg 添加以下配置项：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:72;1204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;dfsReplicaReliabilityLevel=2&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:191;1207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;这里设置 dfsReplicaReliabilityLevel=2，即在资源允许情况下，副本优先部署在多台物理服务器。若集群中服务器台数大于副本数时，可设置 dfsReplicaReliabilityLevel=1。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:192;1209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用 API 与数据节点进行交互时，如果连接的数据节点宕机，API 会尝试重连，若重连失败会自动切换到其他可用的数据节点。这对用户是透明的。目前 Java、C#、C++ 和 Python API 支持高可用。以下例子设置 Java API 高可用：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:73;1210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;import com.xxdb; DBConnection conn = new DBConnection(); String[] sites=[&#34;115.239.209.228:21142&#34;, &#34;115.239.209.228:21143&#34;, &#34;115.239.209.224:21142&#34;, &#34;115.239.209.224:21143&#34;] boolean success = conn.connect(host=&#34;115.239.209.228&#34;, port=21142, userid=&#34;admin&#34;, password=&#34;123456&#34;, highAvailability=True, highAvailabilitySites=sites)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:193;1216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;如果数据节点 115.239.209.228:21142 宕机，API 会自动连接到其他可用的数据节点。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;62-元数据高可用测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:45;1218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:45;1218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.2. 元数据高可用测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:45;1218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;621-环境部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:46;1220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:46;1220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.2.1. 环境部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:46;1220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:194;1222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;要使用元数据高可用功能，至少需要三台物理服务器，每台部署一个控制节点（controller），一个代理节点（agent）和&#34;cpp_data_io.md&#34; node）。具体部署请参阅&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;ha_cluster_deployment.md&#34; xtrc=&#34;xref:34;1222:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;高可用集群部署教程&lt;/xref&gt;，配置两个副本，其他主要配置如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:195;1224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;agent.cfg 文件中配置&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:74;1225:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;mode =agent localSite=192.168.1.13:22215:agent2 controllerSite=192.168.1.12:22216:controller1 sites=192.168.1.13:22215:agent2:agent,192.168.1.12:22216:controller1:controller,192.168.1.13:22216:controller2:controller,192.168.1.14:22216:controller3:controller lanCluster=0 chunkCacheEngineMemSize=4&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:196;1233:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;cluster.cfg 文件中配置&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:75;1234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;lanCluster=0 maxPubConnections=64 maxMemSize=16 workerNum=4 newValuePartitionPolicy=add chunkCacheEngineMemSize=4&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:197;1242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;controller.cfg 文件中配置&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:76;1243:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;mode=controller localSite=192.168.1.13:22216:controller2 dfsReplicationFactor=2 dfsReplicaReliabilityLevel=1或dfsReplicaReliabilityLevel=2 dfsHAMode=Raft dataSync=1 maxConnections=128 maxMemSize=16 webWorkerNum=4 workerNum=4&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:198;1255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;节点配置信息 cluster.nodes 如下&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:77;1256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;localSite,mode 192.168.1.12:22216:controller1,controller 192.168.1.13:22216:controller2,controller 192.168.1.14:22216:controller3,controller 192.168.1.12:22215:agent1,agent 192.168.1.13:22215:agent2,agent 192.168.1.14:22215:agent3,agent 192.168.1.12:22217:NODE1,datanode 192.168.1.12:22218:NODE2,datanode 192.168.1.13:22217:NODE2241,datanode 192.168.1.13:22218:NODE2242,datanode 192.168.1.14:22217:NODE2281,datanode 192.168.1.14:22218:NODE2282,datanode ~ &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:199;1272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;API 中启用高可用，配置要切换的节点见如下所示 sites 字符串变量：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:78;1273:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;String[] sites={&#34;192.168.1.12:22217&#34;, &#34;192.168.1.12:22218&#34;, &#34;192.168.1.13:22217&#34;, &#34;192.168.1.13:22218&#34;, &#34;192.168.1.14:22217&#34;, &#34;192.168.1.14:22218&#34;} s.connect(host=&#34;192.168.1.12&#34;, port=21117, userid=&#34;admin&#34;, password=&#34;123456&#34;, highAvailability=True, highAvailabilitySites=sites)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;622-测试步骤&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:47;1277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:47;1277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.2.2. 测试步骤&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:47;1277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:200;1279:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;测试步骤参考如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:10;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:10;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:47;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:48;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:49;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:50;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:51;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:10;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:46;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:225;1281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;序号&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:226;1281:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;测试步骤&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:227;1281:164&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;预期结果&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:228;1281:282&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;是否符合预期&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:229;1281:291&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;原因&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:10;1283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:47;1283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:230;1283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:231;1283:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;启动集群的所有节点&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:232;1283:161&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;所有都节点正常能启动，浏览器打开 controller 面板，显示 leader 为 controller1（若不为 controller1，多次重启使其为 controller1）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:233;1283:255&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:234;1283:268&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;Raft 组中只有一个 Leader，其他都是 Follower&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:48;1284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:235;1284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:236;1284:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;API 连接节点，创建 1000 个分区的分布式表并开始持续读写，前 1000 次每次同时向每个已存在分区和一个新分区添加一组数据并读取总行数，之后每次随机向分区写入共 10000 条数据&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:237;1284:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;API 成功连接到 controller1 的数据节点，创建数据表并开始读写，正确打印总行数，副本存储在不同节点上&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:238;1284:191&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:239;1284:204&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:49;1285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:240;1285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;3&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:241;1285:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;在前 1000 次读写时，关闭正在读写的 NODE1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:242;1285:159&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;API 成功连接到 NODE2241，继续开始读写，写入的新分区副本不存在 NODE1 上&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:243;1285:260&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:244;1285:273&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用 API 与 DolphinDB 的数据节点交互时，如果连接的数据节点宕机，API 会先尝试重连，若重连失败会自动切换连接到集群中其他可用的数据节点，继续执行未完成的任务。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:50;1286:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:245;1286:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;4&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:246;1286:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;前 1000 次内重启 NODE1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:247;1286:168&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;NODE1 上的副本恢复。新的分区副本可以放在 NODE1 里&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:248;1286:275&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:249;1286:288&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;副本之间保持强一致性，只要数据库存在一个副本，就可以恢复&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:51;1287:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:250;1287:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;5&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:251;1287:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;一段时间后，前 1000 次内关闭 controller1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:252;1287:162&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;leader 切换到 controller2（或 controller3，后面步骤假设为 controller2），数据停顿几秒后继续读写，不影响 NODE1 和 NODE2 使用&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:253;1287:259&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:254;1287:272&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;由于数据节点和代理节点正常，因此还可以正常读写，但是由于采用 Raft 协议，Raft 组会立即选举出新的 Leader 来提供元数据服务，因此 leader 变成 controller2&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:52;1288:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:255;1288:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:256;1288:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;重启 controller1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:257;1288:169&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;对数据读写没有影响，leader 仍然是 controller2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:258;1288:280&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:259;1288:293&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:53;1289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:260;1289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;7&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:261;1289:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;一段时间后关闭 controller2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:262;1289:164&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;leader 切换回 controller1，数据停顿几秒后继续读写&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:263;1289:273&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:264;1289:286&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;同 5&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:54;1290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:265;1290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;8&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:266;1290:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;重启 controller2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:267;1290:169&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;对数据读写没有影响，leader 仍然是 controller1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:268;1290:280&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:269;1290:293&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:55;1291:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:270;1291:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;9&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:271;1291:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;关闭 NODE1 和 NODE2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:272;1291:170&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;节点切换到 NODE2281，继续读写&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:273;1291:284&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:274;1291:297&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;由于在不同机器上存储数据副本，即使一台服务器节点失效，访问其他机器上的副本也可以数据服务&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:56;1292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:275;1292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:276;1292:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;关闭 controller1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:277;1292:169&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;leader 切换到 controller2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:278;1292:290&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:279;1292:303&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:57;1293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:280;1293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;11&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:281;1293:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;打开 NODE1 和 NODE2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:282;1293:170&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;leader 不变，NODE1 和 NODE2 上数据恢复&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:283;1293:287&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:284;1293:300&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:58;1294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:285;1294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;12&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:286;1294:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;重启 controller1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:287;1294:169&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;leader 不变，数据读写没有影响&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:288;1294:281&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:289;1294:294&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:59;1295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:290;1295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;13&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:291;1295:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;长时间持续的数据读写后，重复以上步骤&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:292;1295:152&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;结果相同&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:293;1295:270&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;符合&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:294;1295:283&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:201;1297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;示例 Java API 代码&lt;xref class=&#34;- topic/xref &#34; format=&#34;java&#34; href=&#34;script/testHaCluster.java&#34; xtrc=&#34;xref:35;1297:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;?ditaot usertext?&gt;下载&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;63-跨机房容灾&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:48;1299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:48;1299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.3. 跨机房容灾&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:48;1299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:202;1301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;跨机房异步容灾组网架构如下图：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/iotExam/asynDisasterRecovery.PNG&#34; placement=&#34;break&#34; xtrc=&#34;image:3;1303:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34; dita-ot:image-width=&#34;727&#34; dita-ot:image-height=&#34;477&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:3;1303:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;asynDisasterRecovery&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:203;1305:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;主备系统部署方案：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:4;1307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:68;1307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;主备系统分别部署在两个不同的机房，配置相同，流数据表以及 DFS 数据库参数配置一致，主系统、备系统都保存所有的历史数据；流数据表为键值流数据表，该表的主键不允许包含重复值。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:69;1308:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;正常情况下，数据源写入主系统流数据表；备系统从主系统订阅流数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:70;1309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;读数据库数据的客户端程序启动时，配置主备两个 IP 地址和端口组，启动时优先连接主系统，当主系统宕机时，自动切换到备系统读取数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:71;1310:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;主系统宕机后，数据源写入备系统。备系统停止从主系统订阅流数据，备系统变为主系统。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:204;1312:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;原主系统宕机后系统恢复流程：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:5;1314:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:72;1314:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;检测到主系统在运行，将自己降为备系统。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:73;1315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;从主系统订阅流数据，以同步数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:74;1316:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;同步完数据后，再主备切换。&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;64-数据备份和恢复&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:49;1318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:49;1318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.4. 数据备份和恢复&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:49;1318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;641-数据备份&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:50;1320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:50;1320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.4.1. 数据备份&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:50;1320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:205;1322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinDB 提供了&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:70;1322:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;backup&lt;/codeph&gt;函数对分布式数据库进行备份。备份是以分区为单位进行的，可对指定数据表的部分或全部分区进行备份，支持全量备份与增量备份。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:206;1324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;备份需要指定存放备份文件的路径 backupDir 与数据（用 SQL 语句表示）。备份后，系统会在&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:71;1324:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&amp;lt;backupDir&amp;gt;/&amp;lt;dbName&amp;gt;/&amp;lt;tbName&amp;gt;&lt;/codeph&gt;目录下生成元数据文件_metaData.bin 和数据文件.bin，每个分区备份为一个数据文件。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:207;1326:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;例如备份 2020.09.01 到 2020.09.03 这三天的数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:79;1327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;backup(backupDir=&#34;/hdd/hdd1/backup/&#34;+today().format(&#34;yyyyMMdd&#34;),sqlObj=&amp;lt;select * from loadTable(&#34;dfs://svmDemo&#34;,&#34;sensors&#34;) where datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59 &amp;gt;,force=false,parallel=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:208;1330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;备份后，登录服务器，用 tree 命令列出目录的内容如下。从中可以看到，备份目录下根据数据库名和表名生成了 2 层子目录 svmDemo/sensors，在其下还有 1500 个分区数据文件和 1 个元数据文件_metaData：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:80;1331:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;[dolphindb@cnserver3 ~]$ tree /hdd/hdd1/backup/2020.09.20 -L 3 /hdd/hdd1/backup/2020.09.20 └── svmDemo └── sensors ├── 001f4f62-7a7c-ecbc-a74c-edbfe071c358 ├── 0023a6f3-84d6-8fa0-354b-8b97b4024e9a ├── 004c4795-3f7d-a3be-ec45-06089ab723ef ├── dolphindb.lock ├── e0363761-7f9a-5fa5-8f4a-c0cfff1749a6 ... ├── fec45f79-8163-a587-644d-2f260a9e358e └── _metaData 2 directories, 1502 files &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:209;1348:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;若要每天备份，可用定时作业来实现，下面的例子每天 00:05:00 备份前一天的数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:81;1349:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;login(`admin,`123456) scheduleJob(`backupJob, &#34;backupDB&#34;, backup{&#34;/hdd/hdd1/backupDemo/&#34;+(today()-1).format(&#34;yyyyMMdd&#34;),&amp;lt;select * from loadTable(&#34;dfs://svmDemo&#34;,&#34;sensors&#34;) where datetime between datetime(today()-1) : (today().datetime()-1) &amp;gt;,false,true}, 00:05m, today(), 2030.12.31, 'D');&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;642-数据恢复&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:51;1354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:51;1354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;6.4.2. 数据恢复&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:51;1354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:210;1356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;DolphinD 提供两种数据恢复的方法：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:25;1357:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:75;1357:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:72;1357:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;migrate&lt;/codeph&gt;函数&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:76;1358:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:73;1358:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;restore&lt;/codeph&gt;函数&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:211;1360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;两者的主要区别为：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:26;1361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:77;1361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:74;1361:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;migrate&lt;/codeph&gt;函数以表为单位恢复，可以批量恢复多个表的全部数据，而&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:75;1361:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;restore&lt;/codeph&gt;函数以分区为单位恢复，每次恢复一个表中部分或全部分区的数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:78;1362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:76;1362:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;migrate&lt;/codeph&gt;函数无需用户创建新数据库，系统会自动创建新数据库，而&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:77;1362:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;restore&lt;/codeph&gt;需要用户先建库建表。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:212;1364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下面的例子恢复 2020 年 9 月份的数据到原表，其中备份文件是上一小节的定时作业按天生成：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:82;1365:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;day=2020.01.01 for(i in 1:31){ path=&#34;/hdd/hdd1/backupDemo/&#34;+temporalFormat(day, &#34;yyyyMMdd&#34;) + &#34;/&#34;; day=datetimeAdd(day,1,`d) if(!exists(path)) continue; print &#34;restoring &#34; + path; restore(backupDir=path,dbPath=&#34;dfs://svmDemo&#34;,tableName=&#34;sensors&#34;,partition=&#34;%&#34;,force=true); }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:213;1376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;下面的例子把 2020 年 9 月份的数据恢复到一个新的数据库 dfs://db1 和表 sensors，其中先用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:78;1376:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;migrate&lt;/codeph&gt;恢复第一天的数据，然后用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:79;1376:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt;migrate&lt;/codeph&gt;把剩余备份数据恢复到临时表，再导入 sensors：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:83;1377:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/iot_examples.md&#34;&gt; migrate(backupDir=&#34;/hdd/hdd1/backupDemo/20200901/&#34;,backupDBPath=&#34;dfs://svmDemo&#34;,backupTableName=&#34;sensors&#34;,newDBPath=&#34;dfs://db1&#34;,newTableName=&#34;sensors&#34;) day=2020.09.02 newTable=loadTable(&#34;dfs://db1&#34;,&#34;sensors&#34;) for(i in 2:31){ path=&#34;/hdd/hdd1/backupDemo/&#34;+temporalFormat(day, &#34;yyyyMMdd&#34;) + &#34;/&#34;; day=datetimeAdd(day,1,`d) if(!exists(path)) continue; print &#34;restoring &#34; + path; t=migrate(backupDir=path,backupDBPath=&#34;dfs://svmDemo&#34;,backupTableName=&#34;sensors&#34;,newDBPath=&#34;dfs://db1&#34;,newTableName=&#34;tmp&#34;) if(t['success'][0]==false){ print t['errorMsg'][0] continue } newTable.append!(select * from loadTable(&#34;dfs://db1&#34;,&#34;tmp&#34;) where datetime between datetime(day-1) : (day.datetime()-1) &amp;gt; ) database(&#34;dfs://db1&#34;).dropTable(&#34;tmp&#34;) } &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/iot_examples.md"/><meta name="wh-out-relpath" content="tutorials/iot_examples.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="物联网应用范例" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html">物联网场景案例</a></div></div></li><li class="active"><div class="topicref" data-id="物联网应用范例"><div class="title"><a href="../tutorials/iot_examples.html">物联网应用范例</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="引擎级联监测门禁异常状态-d9713e104828" class="topicref" data-id="引擎级联监测门禁异常状态" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="引擎级联监测门禁异常状态-d9713e104828-link">引擎级联监测门禁异常状态</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-历史数据回放功能应用物联网设备故障分析-d9713e104874" class="topicref" data-id="dolphindb-历史数据回放功能应用物联网设备故障分析" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/faultAnalysis.html" id="dolphindb-历史数据回放功能应用物联网设备故障分析-d9713e104874-link">DolphinDB 历史数据回放功能应用：物联网设备故障分析</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-在工业物联网的应用-d9713e104920" class="topicref" data-id="dolphindb-在工业物联网的应用" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/iot_demo_2.html" id="dolphindb-在工业物联网的应用-d9713e104920-link">DolphinDB 在工业物联网的应用</a></div></div></li><li role="treeitem"><div data-tocid="出租车行程时间预测-d9713e104966" class="topicref" data-id="出租车行程时间预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/forecast_taxi_trip_dura_2.html" id="出租车行程时间预测-d9713e104966-link">出租车行程时间预测</a></div></div></li><li role="treeitem"><div data-tocid="传感器数据异常检测-d9713e105012" class="topicref" data-id="传感器数据异常检测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/iot_anomaly_detection_2.html" id="传感器数据异常检测-d9713e105012-link">传感器数据异常检测</a></div></div></li><li role="treeitem"><div data-tocid="地震波形数据存储解决方案-d9713e105058" class="topicref" data-id="地震波形数据存储解决方案" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/waveform_data_storage_2.html" id="地震波形数据存储解决方案-d9713e105058-link">地震波形数据存储解决方案</a></div></div></li><li role="treeitem"><div data-tocid="工业试验平台高频数据的存储和处理分析-d9713e105104" class="topicref" data-id="工业试验平台高频数据的存储和处理分析" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/high_freq_data_storage_and_analysis.html" id="工业试验平台高频数据的存储和处理分析-d9713e105104-link">工业试验平台高频数据的存储和处理分析</a></div></div></li><li role="treeitem"><div data-tocid="基于波形数据的地震预测-d9713e105150" class="topicref" data-id="基于波形数据的地震预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/earthquake_prediction_ddb_ml_2.html" id="基于波形数据的地震预测-d9713e105150-link">基于波形数据的地震预测</a></div></div></li><li role="treeitem"><div data-tocid="实时检测传感器状态变化-d9713e105196" class="topicref" data-id="实时检测传感器状态变化" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_str_app_iot_2.html" id="实时检测传感器状态变化-d9713e105196-link">实时检测传感器状态变化</a></div></div></li><li role="treeitem"><div data-tocid="实现设备指标的采集监控和展示-d9713e105242" class="topicref" data-id="实现设备指标的采集监控和展示" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_telegraf_grafana.html" id="实现设备指标的采集监控和展示-d9713e105242-link">实现设备指标的采集监控和展示</a></div></div></li><li role="treeitem"><div data-tocid="随机振动信号分析解决方案-d9713e105288" class="topicref" data-id="随机振动信号分析解决方案" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/random_vibr_sig_analysis_2.html" id="随机振动信号分析解决方案-d9713e105288-link">随机振动信号分析解决方案</a></div></div></li><li role="treeitem"><div data-tocid="物联网时序数据查询案例-d9713e105335" class="topicref" data-id="物联网时序数据查询案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/iot_query_case.html" id="物联网时序数据查询案例-d9713e105335-link">物联网时序数据查询案例</a></div></div></li><li role="treeitem"><div data-tocid="物联网实时数据异常率预警-d9713e105381" class="topicref" data-id="物联网实时数据异常率预警" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/knn_iot_2.html" id="物联网实时数据异常率预警-d9713e105381-link">物联网实时数据异常率预警</a></div></div></li><li role="treeitem" class="active"><div data-tocid="物联网应用范例-d9713e105427" class="topicref" data-id="物联网应用范例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/iot_examples.html" id="物联网应用范例-d9713e105427-link">物联网应用范例</a></div></div></li><li role="treeitem"><div data-tocid="云边协同dolphindb-构建一体化振动监控与故障诊断解决方案-d9713e105473" class="topicref" data-id="云边协同dolphindb-构建一体化振动监控与故障诊断解决方案" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Virbration_Monitor_Fault_Diagnose.html" id="云边协同dolphindb-构建一体化振动监控与故障诊断解决方案-d9713e105473-link">云边协同：DolphinDB 构建一体化振动监控与故障诊断解决方案</a></div></div></li><li role="treeitem"><div data-tocid="助力工业物联网实现智能运维-d9713e105519" class="topicref" data-id="助力工业物联网实现智能运维" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Iot_intelligent_O&amp;M.html" id="助力工业物联网实现智能运维-d9713e105519-link">助力工业物联网实现智能运维</a></div></div></li><li role="treeitem"><div data-tocid="使用-node-red-构建-dolphindb-低代码平台-d9713e105565" class="topicref" data-id="使用-node-red-构建-dolphindb-低代码平台" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/node_red_tutorial_iot.html" id="使用-node-red-构建-dolphindb-低代码平台-d9713e105565-link">使用 Node-RED 构建 DolphinDB 低代码平台</a></div></div></li><li role="treeitem"><div data-tocid="基于-glibc-升级的性能优化案例-d9713e105611" class="topicref" data-id="基于-glibc-升级的性能优化案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/perf_opti_glibc.html" id="基于-glibc-升级的性能优化案例-d9713e105611-link">基于 Glibc 升级的性能优化案例</a></div></div></li><li role="treeitem"><div data-tocid="当电力市场碰上量化技术如何构建高效电力交易解决方案-d9713e105657" class="topicref" data-id="当电力市场碰上量化技术如何构建高效电力交易解决方案" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/efficient_power_trading_solutions.html" id="当电力市场碰上量化技术如何构建高效电力交易解决方案-d9713e105657-link">当电力市场碰上量化技术，如何构建高效电力交易解决方案？</a></div></div></li><li role="treeitem"><div data-tocid="使用-dolphindb-进行汽车用户驾驶习惯行为画像分析-d9713e105703" class="topicref" data-id="使用-dolphindb-进行汽车用户驾驶习惯行为画像分析" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/behavioral_profiling_of_driving_habits.html" id="使用-dolphindb-进行汽车用户驾驶习惯行为画像分析-d9713e105703-link">使用 DolphinDB 进行汽车用户驾驶习惯行为画像分析</a></div></div></li><li role="treeitem"><div data-tocid="edge_to_cloud-d9713e105749" class="topicref" data-id="edge_to_cloud" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/edge_to_cloud.html" id="edge_to_cloud-d9713e105749-link">DolphinDB 实现边到云的实时数据汇聚</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">物联网应用范例</h1><div class="- topic/body body"><p class="- topic/p p">本教程介绍物联网领域 DolphinDB 用户在安装部署、分布式数据库设计、数据写入和查询、流计算和高可用测试等过程中的常见问题、相应的解决方案与注意事项，以帮助新用户快速入门。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-快速体验"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 快速体验</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="11-安装部署单节点服务"><h3 class="- topic/title title topictitle3" id="ariaid-title3">1.1. 安装部署单节点服务</h3><div class="- topic/body body"><p class="- topic/p p">入门用户可先部署一个单节点模式 DolphinDB 以快速体验。单节点模式拥有与集群模式相同的功能，区别在于单节点模式不支持扩展节点和高可用，而集群模式可以方便地扩展到多个服务器节点以及支持高可用。安装的第一步是在官网下载<a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads.html" target="_blank" rel="external noopener">DolphinDB 社区试用版</a>。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">选择 Windows 版本还是 Linux 版本？Linux 服务器比 Windows 服务器更稳定，建议生产环境选用 Linux 版本。若您现有环境是 Windows，亦可选择 Windows 版本进行体验。</p></li><li class="- topic/li li"><p class="- topic/p p">选择稳定版还是最新版？目前一般 1-2 周会发布一个最新版。新版本不仅包含 bug 修复，还可能包含新功能、改进、性能优化等其他内容的更新，可能会带来新的 bug。若用于生产环境，出于对稳定性的要求，请选择稳定版。稳定版只修复 bug，不增加新功能。若进行体验与测试，可选择最新版。</p></li><li class="- topic/li li"><p class="- topic/p p">若选择了最新版，选择<a class="- topic/xref xref" href="jit.html">JIT（即时编译）</a>版本还是非 JIT 版本？DolphinDB 的即时编译功能显著提高了 for 循环，while 循环和 if-else 等语句的运行速度，特别适合于无法使用向量化运算但又对运行速度有极高要求的场景。但另一方面，DolphinDB 的 JIT 版本使用一个动态库，安装包要增加 10 多兆字节，这对原本仅 20 来兆的安装包相当可观。所以请综合考虑是否需要即时编译功能以及是否对安装包大小敏感，以决定是否下载 JIT 版本。</p></li></ul><p class="- topic/p p">下载后，请参照<a class="- topic/xref xref" href="standalone_server.html">单节点部署教程</a>部署 DolphinDB。以 Linux 系统为例，步骤如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code> wget  https://www.dolphindb.com/downloads/DolphinDB_Linux64_V1.30.7.zip
 unzip DolphinDB_Linux64_V1.30.7.zip -d dolphindb
 cd dolphindb/server
 chmod +x dolphindb
 ./dolphindb</code></pre><p class="- topic/p p">安装路径名不要含有空格或中文字符，否则会提示异常：Cannot open configuration file。</p><p class="- topic/p p">安装过程若出现错误提示：Failed to bind the socket on port 8848，说明 8848 端口已被其他程序占用，请更换端口。假设修改端口为 8900，可在配置文件 dolphindb.cfg 中进行如下修改：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>localSite=localhost:8900:local8900</code></pre><p class="- topic/p p">启动后出现如下界面。然后在 Console 中输入<code class="+ topic/ph pr-d/codeph ph codeph">1+1;</code>，若输出 2，即安装成功。
<img class="- topic/image image" src="images/iotExam/serverStarted.png" alt="image"/><br/></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：</p><ul class="- topic/ul ul"><li class="- topic/li li">上述命令中 DolphinDB_Linux64_V1.30.7.zip 表明下载的是 1.30.7 版本，若是其他版本，请修改文件名中的版本号。</li><li class="- topic/li li">上述命令中采用前台运行的方式，若要后台运行，修改<code class="+ topic/ph pr-d/codeph ph codeph">./dolphindb</code>命令为<code class="+ topic/ph pr-d/codeph ph codeph">nohup ./dolphindb -console 0 &amp;</code>或<code class="+ topic/ph pr-d/codeph ph codeph">sh startSingle.sh</code>，然后用命令<code class="+ topic/ph pr-d/codeph ph codeph">ps aux | grep dolphindb</code>查看 dolphindb 进程是否已启动。若启动失败，请打开安装目录下的日志文件 dolphindb.log，查看日志中的错误提示信息。</li><li class="- topic/li li">数据文件默认存放在<code class="+ topic/ph pr-d/codeph ph codeph">&lt;DolphinDB安装包&gt;/server/local8848/storage/CHUNKS</code>。请选择容量较大的磁盘存放数据文件，并通过参数 volumes 配置数据文件存放目录。</li><li class="- topic/li li">DolphinDB 通过参数 maxMemSize 设置节点的最大内存使用量，默认设置为 0，表示内存使用没有限制。内存对于改进节点的计算性能非常明显，尽可能高配，但也不能设置太大。例如一台机器内存为 16GB，并且只部署 1 个节点，建议将该参数设置为 12GB 左右。否则使用内存接近或超过实际物理内存，有可能会触发操作系统强制关闭进程。如果在数据库使用过程中发生奔溃，可以用<code class="+ topic/ph pr-d/codeph ph codeph">dmesg -T  | grep dolphindb</code>查看一下 Linux 日志，确认一下是否被操作系统 kill。</li><li class="- topic/li li">修改配置后，需要重启 DolphinDB 服务。前台用<code class="+ topic/ph pr-d/codeph ph codeph">quit</code>命令退出，后台用<code class="+ topic/ph pr-d/codeph ph codeph">kill -9 &lt;进程号&gt;</code>退出。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="12-测试-gui-和-web-连接"><h3 class="- topic/title title topictitle3" id="ariaid-title4">1.2. 测试 GUI 和 Web 连接</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title5" id="121-gui-连接"><h4 class="- topic/title title topictitle4" id="ariaid-title5">1.2.1. GUI 连接</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供了多种方式与数据库交互，如 GUI、VSCode 插件、Web Notebook、Jupyter Notebook、命令行等。对入门用户，建议使用 DolphinDB GUI 编写 DolphinDB 脚本。请到 DolphinDB 官网下载<a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads.html" target="_blank" rel="external noopener">DolphinDB GUI</a>。安装前，需要确保已经安装 Java 8 及以上 64bit 版本。DolphinDB GUI 无需安装，开箱即用。在 Windows 环境下，双击 gui.bat 即可。在 Linu 和 Mac 环境下，在 Terminal 中输入：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>cd /your/gui/folder
chmod +x gui.sh
./gui.sh</code></pre><p class="- topic/p p">若 GUI 无法启动，请在 GUI 安装目录下运行：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>java -version</code></pre><p class="- topic/p p">若系统不能显示 Java 版本信息，说明 Java 没有安装或 Java 的安装路径不在系统路径中。在 Windows 上，需要查看是否在<code class="+ topic/ph pr-d/codeph ph codeph">Path</code>中；在 Linux 上，需要查看是否在<code class="+ topic/ph pr-d/codeph ph codeph">PATH</code>中。</p><p class="- topic/p p">若命令显示了 Java 版本信息，请检查版本是否符合要求。DolphinDB GUI 使用环境需要 64 位 Java 8 及以上版本。32 位的 Java 由于只支持 Client 模式，不支持 Server 模式，所以无法启动 GUI。符合要求的 Java 版本示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>java version "1.8.0_121"
Java(TM) SE Runtime Environment (build 1.8.0_121-b13)
Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)</code></pre><p class="- topic/p p">如果版本信息的最后一行如下所示，那么 DolphinDB GUI 将无法正常启动，需要到<a class="- topic/xref xref" href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external noopener">Oracle 官网</a>重新下载安装。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>Java HotSpot(TM) Client VM</code></pre><p class="- topic/p p">GUI 启动后，首先根据提示，选择一个文件夹作为工作区。然后请参照<a class="- topic/xref xref" href="https://www.dolphindb.cn/cn/gui/index.html" target="_blank" rel="external noopener">GUI 帮助手册</a>的说明，连接 DolphinDB 服务器，新建项目和脚本文件，再运行脚本。执行脚本时若出现错误提示：Failed to connect to selected server，请检查：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">DolphinDB 端口是否被防火墙屏蔽。若端口没有开放，需要在防火墙打开该端口。</p></li><li class="- topic/li li"><p class="- topic/p p">DolphinDB server 的 license 是否过期。</p></li><li class="- topic/li li"><p class="- topic/p p">中文出现乱码</p></li></ul><p class="- topic/p p">请在菜单栏点击 File-Preferences，在 Font 中设置中文字体，例如微软雅黑 (Microsoft Yahei)。然后执行 print(变量名)，查看输出结果，乱码是否消失。</p><ul class="- topic/ul ul"><li class="- topic/li li">浮点数精度丢失</li></ul><p class="- topic/p p">DolphinDB GUI 默认精度是 4 位，如果需要更高或低的精度，请在菜单栏点击 File-Preferences, 在 Default number of decimal places 中调整精度，例如设置为 8。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">执行脚本提示：java.lang.OutOfMemoryError: Java heap space</p><p class="- topic/p p">这意味着发生 GUI 内存溢出，说明 GUI 的默认 2048MB 启动内存不能满足需要。这种情况一般是由于执行了结果的数据量较大的 SQL 查询且未将查询结果赋值予一个变量（例如直接执行 select ... from ...)，因为此种操作会将结果的全部数据返回 GUI，占用 GUI 的内存。要避免此种情况下的 GUI 内存溢出，只需将结果赋值于一个变量，例如 t = select ... from ... 即可。此类语句在 server 端执行，不占用 GUI 内存。</p><p class="- topic/p p">假设需将 GUI 的内存扩大至 4096MB，可修改 gui/gui.bat 或者 gui/gui.sh 中的 -Xmx 启动参数，如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>start javaw -classpath dolphindb.jar;dolphingui.jar;jfreechart-1.0.1.jar;jcommon-1.0.0.jar;jxl-2.6.12.jar;rsyntaxarea.jar;autocomplete.jar -Dlook=cross -Xmx4096m com.xxdb.gui.XXDBMain</code></pre><p class="- topic/p p">关于 DolphinDB GUI 的更多细节，请参阅<a class="- topic/xref xref" href="../db_distr_comp/gui.html">DolphinDB GUI 客户端</a>。</p></li></ul></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title6" id="122-web-连接"><h4 class="- topic/title title topictitle4" id="ariaid-title6">1.2.2. Web 连接</h4><div class="- topic/body body"><p class="- topic/p p">Web 客户端是 DolphinDB 安装包自带的、基于网页的图形化交互工具，主要用于系统监控、日志查看、以及数据浏览，也可用于快速编辑执行代码、查看变量、以及基本的画图功能。与 GUI 不同，Web 客户端更适合临时任务，不适于执行复杂的开发任务。为了保证 DolphinDB 服务器的性能，若 10 分钟内无命令执行，系统会自动关闭会话以释放 DolphinDB 系统资源。在单节点模式下，启动 DolphinDB 服务器后，只要在浏览器输入网址 (http://IP:PORT，默认为 http://localhost:8848 ) 即可访问。若无法访问，请检查：</p><ul class="- topic/ul ul"><li class="- topic/li li">DolphinDB 端口是否被防火墙屏蔽。若端口没有开放，需要在防火墙打开该端口。</li><li class="- topic/li li">DolphinDB server 的 license 是否过期。</li><li class="- topic/li li">http 是否写成了 https。若需要使用 https 协议访问 web，请按照<a class="- topic/xref xref" href="ACL_and_Security.html">权限管理和安全</a>第 3 节"使用 HTTPS 实现安全通信"进行配置。</li></ul><p class="- topic/p p">DolphinDB 不会强制用户登录服务器，但是有些功能例如浏览/创建数据库或分区表需要登录才能访问。如果需要将权限设置为用户登录后才能执行脚本，单节点模式下可在配置文件 dolphindb.cfg 中添加配置项：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>webLoginRequired=true;</code></pre><p class="- topic/p p">若用户成功登录，会在屏幕上方显示登录用户名。如果 10 分钟内无命令执行，会自动退出登录。</p><p class="- topic/p p">有关如何使用 Web 客户端的更多信息，请参阅 <a class="- topic/xref xref" href="../db_distr_comp/db_man/web/intro.html">DolphinDB Web 客户端</a>。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="13-使用脚本建库建表"><h3 class="- topic/title title topictitle3" id="ariaid-title7">1.3. 使用脚本建库建表</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 采用数据分区技术，按照用户指定的规则将大规模数据集水平分区，每个分区内的数据采用列式存储。在数据存储时，一个分区是一个目录。以按天分区为例，一天的数据存于同一个目录下。借助数据分区，在后续的查询过程中可直接跳过不必要的数据目录，从而提升查询性能。合理地利用分区，还可以实现数据的更新与删除操作，譬如数据表按天分区，那么数据就可以按天的粒度被更新或删除。</p><p class="- topic/p p">DolphinDB 的每个分布式数据库采用一种分区机制，一个数据库内的多个事实表（fact table）共享这种分区机制，而且同一个分区的多个子表（tablet chunk）数据落在同一个节点上，保证同一个数据库的多个事实表连接 (join) 的效率非常高。除了分布式的事实表，DolphinDB 还提供了不分区的维度表（dimension table），通常用于存储不经常更新的小数据集。这类数据的数据量通常不会随着时间的积累而增长，而且数据内容变化较小。维度表可与任何采用分区机制的事实表关联。</p><p class="- topic/p p">在 DolphinDB 中，数据库使用<code class="+ topic/ph pr-d/codeph ph codeph">database</code>函数创建，分区表和维度表分别使用<code class="+ topic/ph pr-d/codeph ph codeph">createPartitionedTable</code>和<code class="+ topic/ph pr-d/codeph ph codeph">createTable</code>函数创建。</p><p class="- topic/p p">DolphinDB 不提供行级的索引，而是将分区作为数据库的物理索引。一个分区字段相当于数据表的一个物理索引。如果查询时用到了该分区字段做数据过滤，SQL 引擎就能快速定位需要的数据块，而无需对整表进行扫描。为提高查询和计算性能，每个分区的数据量不宜过大、也不宜过小，一般建议每个分区压缩前的数据量控制在 100MB 左右（第 2 章会详细介绍，亦可参阅<a class="- topic/xref xref" href="database.html">分区数据库教程</a>）。</p><p class="- topic/p p">下例中假设有 1000 台设备，每台设备有 50 个指标，每个指标的数据类型都是 float，每秒采集一次数据。假设常用的查询基于时间段和设备进行，因此按时间和设备标识这 2 个维度进行分区。每台设备每天产生的数据约 16MB，因此数据库可按 2 个维度分区，第一个维度按天（datetime 列）值分区，第二个维度按设备编号（machineId 列）范围分区，10 个设备一个区，每个分区数据量约 160MB。建库建表代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db1 = database("",VALUE,2020.10.01..2020.12.30)
db2 = database("",RANGE,0..100*10+1)
db = database("dfs://iot",COMPO,[db1,db2])

m = "tag" + string(1..50)
schema = table(1:0, `machineId`datetime join m, [INT,DATETIME] join take(FLOAT,50) )
db.createPartitionedTable(schema,"machines",`datetime`machineId)</code></pre><p class="- topic/p p">上述代码新建分布式数据库 dfs://iot 与该库中的分布式数据表 machines。代码中，schema 是一个内存表，作为分区表的模板，指定了分区表的结构，包括设备编号列 machineNo、时间列 datetime 以及 50 个指标列 tag1~tag50，以及相应的数据类型。schema 表的第一个参数 1:0 分别为 capacity:size，其中 capacity 表示建表时系统为该表分配的内存（以行数为单位），size 表示该表新建时的行数。size=0 表示创建一个空表，仅仅作为分区表的模板使用。上述 schema 因为列名有规律、类型一致，所以用函数<code class="+ topic/ph pr-d/codeph ph codeph">join</code>进行了简化，实际等价于下面 2 种写法，可根据列名、类型情况进行仿写：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>schema = table(1:0, `machineId`datetime`tag1`tag2`tag3`tag4`tag5`tag6`tag7`tag8`tag9`tag10`tag11`tag12`tag13`tag14`tag15`tag16`tag17`tag18`tag19`tag20`tag21`tag22`tag23`tag24`tag25`tag26`tag27`tag28`tag29`tag30`tag31`tag32`tag33`tag34`tag35`tag36`tag37`tag38`tag39`tag40`tag41`tag42`tag43`tag44`tag45`tag46`tag47`tag48`tag49`tag50,
		 [INT,DATETIME,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT,FLOAT] )

schema=table(	
	array(INT,0) as  machineId,
	array(DATETIME,0) as  datetime,
	array(FLOAT,0) as  tag1,
	array(FLOAT,0) as  tag2,
	array(FLOAT,0) as  tag3,
	array(FLOAT,0) as  tag4,
	array(FLOAT,0) as  tag5,
	array(FLOAT,0) as  tag6,
	array(FLOAT,0) as  tag7,
	array(FLOAT,0) as  tag8,
	array(FLOAT,0) as  tag9,
	array(FLOAT,0) as  tag10,
	array(FLOAT,0) as  tag11,
	array(FLOAT,0) as  tag12,
	array(FLOAT,0) as  tag13,
	array(FLOAT,0) as  tag14,
	array(FLOAT,0) as  tag15,
	array(FLOAT,0) as  tag16,
	array(FLOAT,0) as  tag17,
	array(FLOAT,0) as  tag18,
	array(FLOAT,0) as  tag19,
	array(FLOAT,0) as  tag20,
	array(FLOAT,0) as  tag21,
	array(FLOAT,0) as  tag22,
	array(FLOAT,0) as  tag23,
	array(FLOAT,0) as  tag24,
	array(FLOAT,0) as  tag25,
	array(FLOAT,0) as  tag26,
	array(FLOAT,0) as  tag27,
	array(FLOAT,0) as  tag28,
	array(FLOAT,0) as  tag29,
	array(FLOAT,0) as  tag30,
	array(FLOAT,0) as  tag31,
	array(FLOAT,0) as  tag32,
	array(FLOAT,0) as  tag33,
	array(FLOAT,0) as  tag34,
	array(FLOAT,0) as  tag35,
	array(FLOAT,0) as  tag36,
	array(FLOAT,0) as  tag37,
	array(FLOAT,0) as  tag38,
	array(FLOAT,0) as  tag39,
	array(FLOAT,0) as  tag40,
	array(FLOAT,0) as  tag41,
	array(FLOAT,0) as  tag42,
	array(FLOAT,0) as  tag43,
	array(FLOAT,0) as  tag44,
	array(FLOAT,0) as  tag45,
	array(FLOAT,0) as  tag46,
	array(FLOAT,0) as  tag47,
	array(FLOAT,0) as  tag48,
	array(FLOAT,0) as  tag49,
	array(FLOAT,0) as  tag50
)</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：</p><ul class="- topic/ul ul"><li class="- topic/li li">创建或访问分布式数据库和表需要相应的用户权限。若不登录，会出现类似"&lt;NotAuthenticated&gt;Not granted to ..."这样的错误提示。DolphinDB 的默认管理员用户是"admin"，其默认密码是"123456"。登录命令如下：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>login(`admin, `123456)</code></pre><p class="- topic/p p">登录后使用函数<code class="+ topic/ph pr-d/codeph ph codeph">changePwd</code>修改密码。更多权限管理细节，请参阅<a class="- topic/xref xref" href="ACL_and_Security.html">权限管理和安全</a>。</p><ul class="- topic/ul ul"><li class="- topic/li li">库表创建后，可使用函数<code class="+ topic/ph pr-d/codeph ph codeph">getAllDBs()</code>显示当前所有数据库，使用函数<code class="+ topic/ph pr-d/codeph ph codeph">schema</code>显示某个表或某个数据库的结构信息。例如查询上述<code class="+ topic/ph pr-d/codeph ph codeph">dfs://iot</code>数据库的设备分区信息可用如下代码：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>database("dfs://iot").schema().partitionSchema[1]</code></pre><p class="- topic/p p">查询上述 machines 的表结构可用如下代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>loadTable("dfs://iot","machines").schema().colDefs</code></pre><p class="- topic/p p">- 数据库创建后，无法通过<code class="+ topic/ph pr-d/codeph ph codeph">database</code>函数修改分区类型或分区方案，若要修改，请先删库再重新创建。删除数据库可使用<code class="+ topic/ph pr-d/codeph ph codeph">dropDatabase</code>函数。若删除某个数据表，可使用<code class="+ topic/ph pr-d/codeph ph codeph">dropTable</code>。分布式表支持增加列，不支持修改列和删除列。增加列可使用<code class="+ topic/ph pr-d/codeph ph codeph">addColumn</code>函数。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="14-数据库增删改查"><h3 class="- topic/title title topictitle3" id="ariaid-title8">1.4. 数据库增删改查</h3><div class="- topic/body body"><p class="- topic/p p">分布式表 (DFS table) 不支持使用<code class="+ topic/ph pr-d/codeph ph codeph">insert into</code>插入数据，仅支持使用<code class="+ topic/ph pr-d/codeph ph codeph">append!</code>或<code class="+ topic/ph pr-d/codeph ph codeph">tableInsert</code>函数插入数据。即使只插入一条数据，也要用表的形式来表示新增的数据。插入数据的代码示例如下，其中自定义函数<code class="+ topic/ph pr-d/codeph ph codeph">genData</code>输入设备编号集，开始时间和每台设备记录数，返回一个包含所有模拟记录的内存表。</p><p class="- topic/p p">下面首先为 1000 个设备产生 1 小时的数据，然后举例说明如何查询、修改和删除数据库记录：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def genData(uniqueMachineId, startDateTime, freqPerMachine){
	numMachines = size(uniqueMachineId)
	numRecords = numMachines * freqPerMachine
	machineId = array(INT, numRecords)
	for(i in 0:numMachines) machineId[(i*freqPerMachine) : ((i+1)*freqPerMachine)] = uniqueMachineId[i]
	t = table(machineId, take(startDateTime + (0..(freqPerMachine-1)), numRecords) as ts)
	
	m = "tag" + string(1..50)
	for (i in 0 : 50) t[m[i]] =rand(10.0, numRecords)
	return t
}
machines = loadTable("dfs://iot", "machines")
t=genData(1..1000, datetime(2020.10.05), 3600)
machines.append!(t)</code></pre><p class="- topic/p p">与其他关系数据库、NoSQL、NewSQL 等数据库不同，DolphinDB 将数据库、编程语言和分布式计算三者融为一体，这种设计使得 DolphinDB 可以一站式轻量化的解决海量大数据的存储与计算。但也使得数据库和表在 DolphinDB 中只是一个普通变量，引用数据库和表时，有可能会与脚本中的其他变量名发生冲突，所以不能直接使用数据库或表名，必须使用<code class="+ topic/ph pr-d/codeph ph codeph">loadTable</code>函数先加载数据表。上例中，加载数据库 dfs://iot 中的数据表 machines，并把这个表对象赋值给变量 machines，之后就可以使用变量 machines 来访问这个数据表。</p><p class="- topic/p p">例 1. 查询每个设备的记录总数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select count(*) from machines group by machineId</code></pre><p class="- topic/p p">若查询到的记录数是 0，请检查一下写入数据的分区字段值是否超出了分区范围。比如这个数据库日期分区是 2020.10.01 到 2020.12.30，若数据的时间是在 2020.10.01 之前或 2020.12.30 之后，就会写入失败。为了解决这个问题，请参照用户手册中<a class="- topic/xref xref" href="../db_distr_comp/db_oper/add_partitions.html">增加分区</a>这小节的说明，在配置文件中增加配置项 newValuePartitionPolicy=add 并重启 DolphinDB 节点。</p><p class="- topic/p p">例 2. 查询设备 1 在 2020.10.05 这一天的历史记录：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from machines where machineId=1 and datetime between 2020.10.05T00:00:00 : 2020.10.05T23:59:59</code></pre><p class="- topic/p p">查询时需要注意：系统在执行分布式查询时，首先根据 where 条件确定相关分区。大多数分布式查询只涉及分布式表的部分分区，系统不必全表扫描，从而节省大量时间。但若不能根据 where 条件做分区剪枝，就会全表扫描，影响查询性能。另外，还可能出现类似下列错误：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>The number of partitions [372912] relevant to the query is too large. Please add more specific filtering conditions on partition columns in WHERE clause, or consider changing the value of the configuration parameter maxPartitionNumPerQuery.</code></pre><p class="- topic/p p">配置参数 maxPartitionNumPerQuery 指定一个查询最多可以涉及的分区数量，默认值是 65535，用于防止生产环境中有人手误提交超级大的 query，影响性能。请注意，若 where 子句中的过滤条件不符合分区剪枝的规则，即使计算只使用了少数分区，在确定相关分区的过程中仍可能进行全表扫描，导致涉及的分区数量多于 maxPartitionNumPerQuery 的值。例如，若例 2 中的涉及日期的 where 条件写为 date(datetime)=2020.10.05，即使计算实质使用的分区数量不变，但由于违反了分区剪枝的规则，会全表扫描，耗时会显著增加。</p><p class="- topic/p p">可以使用以下方法解决这个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">查询中限定尽可能精确的分区范围。</li><li class="- topic/li li">定义数据库的分区机制时，时间戳列的定义不要包含将来的日期，可以在系统中将 newValuePartitionPolicy 设置成 add。这样新的日期出现时，系统会自动更新数据库定义。</li><li class="- topic/li li">将 maxPartitionNumPerQuery 的值调大。不推荐这种方法，因为若不小心忘记设定查询的过滤条件或将过滤条件设置过松，则该查询会耗时过久，浪费系统资源。</li></ul><p class="- topic/p p">例 3. 查询设备 1 在 2020.10.05 这一天的最早的 10 条历史记录：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select top 10 * from machines where machineId=1 and datetime between 2020.10.05T00:00:00 : 2020.10.05T23:59:59</code></pre><p class="- topic/p p">DolphinDB 的分区之间存在先后顺序；分区内的数据按照写入顺序存储。查询或计算的时候，如果需要，可以用 order by、csort 等排序。下面我们选择不同分区的 1 号设备和 11 号设备，先写入 2020.10.06T00:00:01 各一条记录，然后写入 2020.10.06T00:00:00 各一条记录。再查询 top 2 记录：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t=genData([1,11],2020.10.06T00:00:01,1)
machines.append!(t)
t=genData([1,11],2020.10.06T00:00:00,1)
machines.append!(t)
select top 2 * from machines where datetime &gt;= 2020.10.06T00:00:00</code></pre><p class="- topic/p p">查询结果如下所示。从中可见，虽然 11 号设备的 2020.10.06T00:00:01 的数据先写入，但因为它属于符合 where 条件（即 2020.10.06 日）第二个分区（每 10 台机器一个分区），所以结果中没有它，而是返回了第一个分区 1 号设备 2020.10.06T00:00:00 的数据。在第一个分区里，虽然 2020.10.06T00:00:00 的时间早，但它写入晚，所以先返回了 2020.10.06T00:00:01 的数据。如果查询 top 1，则只有 2020.10.06T00:00:01 的数据被返回。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>machineId	datetime		tag1	...	tag50
1		2020.10.06T00:00:01	1.7039	...	7.8002
1		2020.10.06T00:00:00	7.9393	...	2.7662
</code></pre><p class="- topic/p p">例 4. 查询每个设备的最新一条记录：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select top 1 * from machines context by machineId csort datetime desc </code></pre><p class="- topic/p p">此查询通过 SQL 的<code class="+ topic/ph pr-d/codeph ph codeph">context by</code>子句对表内记录进行分组，然后在组内按时间戳列进行 csort 降序排序，再与 top 一起使用，获取每个分组中的最新记录。</p><p class="- topic/p p">SQL 的<code class="+ topic/ph pr-d/codeph ph codeph">context by</code>子句为 DolphinDB 对标准 SQL 进行的拓展，在处理面板数据 (panel data) 时极为方便。更多细节请参考用户手册的<code class="+ topic/ph pr-d/codeph ph codeph">context by</code>的介绍。</p><p class="- topic/p p">若在生产环境中不断写入的情况下进行查询，为了减少查询范围，可增加一个查询条件，即限制 datetime 为最近一小时，如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select top 1 * from machines where datetime &gt;= datetimeAdd(now().datetime(),-1,`h) context by machineId csort datetime desc </code></pre><p class="- topic/p p">若数据是按时间顺序插入，系统内存资源充足，此查询也可使用快照引擎实现。快照引擎性能更佳，但目前仅支持单节点服务模式。</p><p class="- topic/p p">另外，在测试查询性能时，DolphinDB 提供了<code class="+ topic/ph pr-d/codeph ph codeph">timer</code>函数用于计算查询耗费的时间。譬如在 GUI 中查询 21 号设备在 2020.10.05 的记录：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>timer select * from machines where machineId=21, datetime between 2020.10.05T00:00:00 : 2020.10.05T23:59:59</code></pre><p class="- topic/p p">返回如下信息：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2020.10.28 19:34:34.181: executing code (line 2489)...
Time elapsed: 9.52 ms

2020.10.28 19:34:34.227: execution was completed [46ms]</code></pre><p class="- topic/p p">这里打印了 2 个时间。第一个时间 9.52 ms 是<code class="+ topic/ph pr-d/codeph ph codeph">timer</code>返回的时间，为这个查询在服务器上运行耗费的时间；第二个时间 46 ms 则是从脚本命令发送到接收返回结果的整个过程花费的时间，两者之差为序列化/反序列化和网络传输的耗时。类似 select * from table 即返回整个数据集到 GUI 这样的查询语句，若数据量特别大，序列化/反序列化和网络传输的耗时可能会远远超过在服务器上运行的耗时。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">从 1.30.6 版本起，DolphinDB 支持使用 SQL update 和 delete 语句修改分布式表（包括维度表和分区表）</strong>。</p><p class="- topic/p p">例 5. 更新设备 1 在 2020.10.05T00:00:00 时间点 tag1 值为 1.0：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>update machines set tag1 = 1.0  where machineId=1 and datetime=2020.10.05T00:00:00</code></pre><p class="- topic/p p">例 6. 删除设备 1 在 2020.10.05T00:00:01 时间点的记录：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>delete from machines  where machineId=1 and datetime=2020.10.05T00:00:01</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="15-grafana-连接-dolphindb"><h3 class="- topic/title title topictitle3" id="ariaid-title9">1.5. Grafana 连接 DolphinDB</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供了标准协议的 SQL 查询接口，与第三方分析可视化系统如 Grafana、Redash 和帆软等可轻松实现集成与对接。本节以 Grafana 为例，介绍 DolphinDB 与第三方可视化系统的连接与展示。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title10" id="151-安装配置"><h4 class="- topic/title title topictitle4" id="ariaid-title10">1.5.1. 安装配置</h4><div class="- topic/body body"><p class="- topic/p p">安装 Grafana 请参考<a class="- topic/xref xref" href="http://docs.grafana.org/installation/" target="_blank" rel="external noopener">Grafana 官网教程</a>。安装后，若本机浏览器中可以打开 http://localhost:3000/ ，说明 Grafana 安装成功，否则请检查 3000 这个端口是否被防火墙屏蔽或被其他应用占用。</p><p class="- topic/p p">DolphinDB 为了支持使用 Grafana 来实时展示时序数据，提供了 Grafana 的 dolphindb-datasource 插件，并且实现了对 Grafana 的 HTTP 数据接口，可以通过类 SQL 的查询脚本将 DolphinDB 的数据表以直观的方式展示在 Grafana 的 Dashboard 上。插件的下载与安装请参阅<a class="- topic/xref xref" href="../tools/grafana.html">插件教程</a>。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="152-显示数据"><h4 class="- topic/title title topictitle4" id="ariaid-title11">1.5.2. 显示数据</h4><div class="- topic/body body"><p class="- topic/p p">在 GUI 中运行以下脚本模拟 1 号设备每一秒产生一条数据，其中 gen 为 1.4 节描述的自定义函数，使用<code class="+ topic/ph pr-d/codeph ph codeph">submitJob</code>函数把自定义的<code class="+ topic/ph pr-d/codeph ph codeph">writeIOTData</code>函数提交批处理作业：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def writeIoTData(){
	login("admin", "123456")
	machines = loadTable("dfs://iot", "machines")
	for (i in 0:86400) {
		t=genData(1, now().datetime(), 1)
		machines.append!(t)
		sleep(1000)
	}
}
submitJob("jobId1","writeDataToMachine1",writeIoTData)</code></pre><p class="- topic/p p">在 Grafana 的 Home 界面点击"Create Dashboard"，然后点击"Add new panel"，在如下图所示界面的 Query options 中选择 DolphinDB 数据源后，数据源下方会出现一个用于输入脚本的文本输入框，输入以下查询语句以读取 1 号设备前 5 分钟的 tag1 数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>login('admin', '123456'); select gmtime(timestamp(datetime)) as time_sec, tag1  from loadTable('dfs://iot', 'machines') where machineId=1 and datetime&gt; now().datetime()-5*60</code></pre><p class="- topic/p p">在右上角设置定时刷新及数据时间段的长度，就可以看到实时的数据变化走势图。</p><br/><img class="- topic/image image" src="images/iotExam/newDashboard.png" alt="datasource1"/><br/><p class="- topic/p p">上图若不能正常显示，请检查：</p><ul class="- topic/ul ul"><li class="- topic/li li">在 GUI 中运行函数<code class="+ topic/ph pr-d/codeph ph codeph">getRecentJobs</code>，查看作业运行是否有错，若有错，返回结果中 errorMsg 会显示错误信息。取消作业用<code class="+ topic/ph pr-d/codeph ph codeph">cancelJob</code>。</li><li class="- topic/li li">Grafana 默认返回 timer_series 格式，SQL 中返回的第一个字段必须是 timestamp 类型。</li><li class="- topic/li li">DFS 数据库需要登录后才能访问，所以 select 语句前需要先登录。</li><li class="- topic/li li">检查查询语句中是否含有双引号，若有双引号，改其为单引号。</li><li class="- topic/li li">若上述方法还不能解决问题，建议用 Goole Chrome 浏览器运行 Grafana，然后按 F12 调试，可以查看一下网络交互信息是否提示了异常。</li></ul></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="16-dolphindb-与其他数据库异同点小结"><h3 class="- topic/title title topictitle3" id="ariaid-title12">1.6. DolphinDB 与其他数据库异同点小结</h3><div class="- topic/body body"><p class="- topic/p p">物联网历史数据有可能达到几百 TB 甚至 PB 级别。传统的关系型数据库（如 Oracle，SQL Server，MySQL 等）受到行式存储和数据索引的限制，处理如此量级数据的性能非常低下，即使分库分表，效果也不理想。DolphinDB 采用了分区机制，可以轻松应对 PB 级别的海量数据。DolphinDB 通过数据分区而不是索引的方式来快速定位数据，适合海量数据的存储，检索和计算。在数据量不是非常大时，创建索引可以显著提高系统的性能，但在海量数据场景下，随着数据量的不断增加，索引会不断膨胀（需要占用的内存甚至可能超过了服务器的内存），反而导致系统性能下降。</p><p class="- topic/p p">DolphinDB 将分布式数据库、分布式计算和编程语言从底层进行一体化设计，这种设计使得 DolphinDB 可以一站式轻量化的解决海量大数据的存储与计算。但是，引用数据库和表时，因为可能会与脚本中的变量名发生冲突，所以不能直接使用数据库或表名，必须使用<code class="+ topic/ph pr-d/codeph ph codeph">loadTable</code>函数先加载数据表。</p><p class="- topic/p p">与关系型数据库不同，DolphinDB 分布式表不支持使用<code class="+ topic/ph pr-d/codeph ph codeph">insert into</code>插入数据，仅支持使用<code class="+ topic/ph pr-d/codeph ph codeph">append!</code>或<code class="+ topic/ph pr-d/codeph ph codeph">tableInsert</code>函数以表的形式插入数据。DolphinDB 支持事务，客户端每次写入都是一个事务但是用户层面不提供事务操作，不需要用户像关系数据库一样显式地开始事务、提交事务等。</p><p class="- topic/p p">相比其他时序数据库，DolphinDB 是一个非常轻量级的系统，用 GNU C++ 开发，核心程序仅 20 余兆字节，无任何依赖，开箱即用。DolphinDB 已适配国产的 X86、ARM、MIPS（龙芯）等 CPU，可以运行在 Linux 和 Windows 操作系统上。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title13" id="2-分布式数据库设计和测试"><h2 class="- topic/title title topictitle2" id="ariaid-title13">2. 分布式数据库设计和测试</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title14" id="21-dolphindb-存储引擎"><h3 class="- topic/title title topictitle3" id="ariaid-title14">2.1. DolphinDB 存储引擎</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 利用分布式文件系统实现数据库的存储和基本事务机制。数据库以分区（chunk）为单位进行管理。分区的元数据（元数据指"../tools/grafana.md"小，存储位置等）存储在控制节点，副本数据存储在各数据节点，统一由分布式文件系统进行管理。一个数据库的数据可能存储在多个服务器上，系统内部通过事务机制和二阶段提交协议保证数据的强一致性和完整性，对于外部用户来说，这些机制是完全透明的。每个分区副本的数据采用列式增量压缩存储。压缩算法采用了 LZ4 或 DELTA 算法，在实际生产环境中，磁盘数据的无损压缩比约 5:1，在有些重复较多、变动范围较小、写入批量大的场景，也能做到更高的压缩比。</p><p class="- topic/p p">一个数据库最多可以支持三个维度的分区，支持百万甚至千万级的分区数。为尽可能保证每个分区的大小平衡，DolphinDB 提供了值（VALUE）分区，范围（RANGE）分区，哈希（HASH）分区，列表（LIST）分区和复合（COMPO）分区等多种分区方式，用户可以灵活使用，合理规划分区。在查询时，加载数据的最小单位是一个分区的一个列。DolphinDB 不提供行级的索引，而是将分区作为数据库的物理索引。一个分区字段相当于数据表的一个物理索引。如果查询时用到了该分区字段做数据过滤，SQL 引擎就能快速定位需要的数据块，而无需对整表进行扫描。在物联网领域，查询分析大多基于某一个时间段、某个设备或某个指标进行，因此时间和设备/指标标识是物联网领域最常用的分区维度。</p><p class="- topic/p p">下面展示一个数据库的存储目录和文件，其中数据库按照两个维度分区，第一个维度按天（ts 列）进行值分区，第二个维度按照标签编号（tagid 列）范围分区，建库建表以及测试数据写入代码如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>schema = table(1:0,`tagid`ts`data,[INT,TIMESTAMP,INT]);
db1 = database("",VALUE,2020.01.01..2020.01.02)
db2 = database("",RANGE,1 11 21 31)
db = database("dfs://demo",COMPO,[db1,db2])
db.createPartitionedTable(schema,"sensor",`ts`tagid)

t=table(1..30 as tagid,take(2020.01.01T00:00:00.000 2020.01.02T00:00:00.000,30) as time,rand(10,30) as data )
loadTable("dfs://demo","sensor").append!(t)</code></pre><p class="- topic/p p">写入测试数据后，存储目录和数据文件如下所示，</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>[root@188 CHUNKS]# tree ./demo/
./demo/
├── 20200101
│   ├── 1_11
│   │   └── sensor
│   │       ├── data.col
│   │       ├── tagid.col
│   │       └── ts.col
│   ├── 11_21
│   │   └── sensor
│   │       ├── data.col
│   │       ├── tagid.col
│   │       └── ts.col
│   └── 21_31
│       └── sensor
│           ├── data.col
│           ├── tagid.col
│           └── ts.col
├── 20200102
│   ├── 1_11
...
├── dolphindb.lock
├── domain
└── sensor.tbl
</code></pre><p class="- topic/p p">从中可以看到，一个分区维度对应一层子目录，譬如按天分区的子目录名是 20200101，20200102 等，按标签编号范围分区的子目录名是 1_11，11_21 等，表中每一列保存为一个后缀名为 col 的文件，如 data.col，tagid.col 等。</p><p class="- topic/p p">DolphinDB 对分布式数据库表的读写支持事务，保证多行写入数据（可以跨越多个分区，支持多个副本）的原子性和持久性。断电不影响写入的数据，也不破坏数据库的完整性。DolphinDB 采用多版本机制实现快照级别的隔离。当用户同时对数据库进行读写操作时，读和写的并发事务会相互隔离。在这种隔离机制下，数据的读操作和写操作互不阻塞，可以最大程度优化数据仓库读的性能。目前绝大部分的时序数据库不提供事务功能，因此有可能发生一致性和完整性问题，譬如写入两条记录可能一条成功，另一条不成功；已经写入的数据在断电重启后可能丢失最后几条数据；查询的时候可能查到正在写入的数据（尚未全部完成)。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title15" id="22-单值模型"><h3 class="- topic/title title topictitle3" id="ariaid-title15">2.2. 单值模型</h3><div class="- topic/body body"><p class="- topic/p p">数据库通用的设计模式有两种，即单值模型和多值模型。单值模型针对测点建模。一个被监控的指标称为一个测点，例如电量仪中会有电压、电流、功率等测点，温湿度计中有温度、湿度测点。单值模型在写入时每一个测点为一行，所有采集的传感器指标值，无论种类，均存于同一列中。单值模型适合各测点采集频率不一致的应用场景，不适合不同指标之间要做很多协同处理的场景。单值模型数据占用的存储空间大，写入性能和查询性能也不如多值模型。</p><p class="- topic/p p">假设某厂有 100 个机组，每台机组有 50 个测点，共有 100*50=5000 个测点。每个测点采集一个指标的数据，每秒采集一次数据，均为 float 类型。所有机组采集相同的 50 个指标的数据并存入数据库。</p><p class="- topic/p p">对测点按顺序进行编号：一号机组的测点为 1~50，二号机组的测点是 51~100，以此类推。</p><p class="- topic/p p">本案例若按单值模型设计，表结构可定义如下：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="22-单值模型__entry__1">列名</th><th class="- topic/entry entry colsep-0 rowsep-0" id="22-单值模型__entry__2">数据类型</th><th class="- topic/entry entry colsep-0 rowsep-0" id="22-单值模型__entry__3">备注</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__1">id</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__2">INT</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__3">测点编号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__1">datetime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__2">DATETIME</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__3">时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__1">value</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__2">FLOAT</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-单值模型__entry__3">指标值</td></tr></tbody></table></div><p class="- topic/p p">单值模型适合的常用查询基于测点编号与时间段，可按测点编号和时间这 2 个维度进行分区。时间维度一般情况下可按天进行值（VALUE）分区，但也可根据数据量和典型查询场景采用其它分区方案。若某些场景下，查询时间跨度不是很长，而单位时间内的数据量又较大，也可以按小时进行分区。若数据量比较小，又常按一个月或几个月进行查询和计算，也可以按月分区。</p><p class="- topic/p p">物联网设备监控场景的各指标的采集频率一般固定，比较容易计算单位时间的数据量大小，因此指标维度的分区通常采用范围（RANGE）或值（VALUE）方法。DolphinDB 中组合分区的多个列在逻辑上是并列的，不存在从属关系或优先级关系。如果时间维度有 n 个分区，指标维度有 m 个分区，最多可能有 n * m 个分区。为提高查询和计算性能，每个分区的数据量不宜过大、也不宜过小。一般建议每个分区压缩前的数据量控制在 100MB 左右（详情请参阅<a class="- topic/xref xref" href="database.html">分区数据库教程</a>）。</p><p class="- topic/p p">本案例中，每 100 个测点（即两个机组）每天的数据约 100MB（12 字节/条*86400 条*100 测点）。所以第一个分区维度采用值分区，每天为一个分区；第二个分区维度采用范围（RANGE）分区，每 100 个测点（即两台机组）为一个分区。参考代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>numMachines=100
numMetrics=50
numMachinesPerPartition=2
ps1=2020.09.01..2020.12.31
ps2=(numMetrics*numMachinesPerPartition)*(0..(numMachines/numMachinesPerPartition))+1

def createDatabase(dbName,tableName, ps1, ps2){
	tableSchema = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT]);
	db1 = database("", VALUE, ps1)
	db2 = database("", RANGE, ps2)
	db = database(dbName,COMPO,[db1,db2])
	dfsTable = db.createPartitionedTable(tableSchema,tableName,`datetime`id)
}
createDatabase("dfs://svmDemo","sensors", ps1, ps2)</code></pre><p class="- topic/p p">以上建立的数据库 dfs://svmDemo 中的 svm 代表 single-value model（单值模型）。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title16" id="23-多值模型"><h3 class="- topic/title title topictitle3" id="ariaid-title16">2.3. 多值模型</h3><div class="- topic/body body"><p class="- topic/p p">多值模型通常针对数据源（在物联网领域通常是设备）建模，写入时每一个设备在同一时刻被测量的所有指标值为一行。上一小节中案例若用多值建模，表结构定义如下：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="23-多值模型__entry__1">列名</th><th class="- topic/entry entry colsep-0 rowsep-0" id="23-多值模型__entry__2">数据类型</th><th class="- topic/entry entry colsep-0 rowsep-0" id="23-多值模型__entry__3">备注</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__1">id</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__2">INT</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__3">机组编号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__1">datetime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__2">DATETIME</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__3">时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__1">TAG1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__2">FLOAT</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__3">1 号指标</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__1">...</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__2 23-多值模型__entry__3" colspan="2"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__1">TAG50</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__2">FLOAT</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-多值模型__entry__3">50 号指标</td></tr></tbody></table></div><p class="- topic/p p">多值模型适合的常用查询基于时间段和设备，因此多值模型的分区字段可选择时间和设备这 2 个维度。时间维度通常按天、按小时或按月进行值（VALUE）分区，由数据量和典型查询场景决定。若查询时间段跨度不大且单位时间内采集数据量大，可按小时进行分区；若查询时间段跨度大且单位时间内数据量不大，可按月分区。设备维度的分区可以采用哈希、范围、值、列表等多种方法，原则就是要根据业务特点对数据进行均匀分割，让每个分区压缩前的大小控制在 100MB 左右。但如果数据表为宽表（几百甚至几千个字段），若单个应用只会使用一小部分字段，因为未用到的字段不会加载到内存，不影响查询效率，这种情况可以适当放大分区上限的范围。数据库分区也可按三个维度进行。比如采集设备的网络日志，常用的查询基于时间段、源 IP 地址和目的 IP 地址，就可以考虑采用时间、源 IP 地址和目的 IP 地址三个分区维度。</p><p class="- topic/p p">本案例每机组每天的记录数为 86400 条，每天的数据量约 16MB。常用查询按天和设备进行，因此可采用复合分区，按天进行值分区，按机组进行范围分区，每 10 个机组为一个分区。参考代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>numMachines=100
numMachinesPerPartition=10
ps1=2020.09.01..2020.12.31
ps2=numMachinesPerPartition*(0..(numMachines/numMachinesPerPartition))+1

def createDatabase(dbName,tableName, ps1, ps2, numMetrics){
	m = "tag" + string(1..numMetrics)
	schema = table(1:0,`id`datetime join m, [INT,DATETIME] join take(FLOAT,50) )
	db1 = database("",VALUE,ps1)
	db2 = database("",RANGE,ps2)
	db = database(dbName,COMPO,[db1,db2])
	db.createPartitionedTable(schema,tableName,`datetime`id)
}
createDatabase("dfs://mvmDemo","machines", ps1, ps2, 50)</code></pre><p class="- topic/p p">以上建立的数据库 dfs://mvmDemo 中的 mvm 代表 multiple-value model（多值模型）。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title17" id="24-使用脚本生成测试数据"><h3 class="- topic/title title topictitle3" id="ariaid-title17">2.4. 使用脚本生成测试数据</h3><div class="- topic/body body"><p class="- topic/p p">若没有实际生产数据，可使用脚本模拟产生测试数据。</p><ul class="- topic/ul ul"><li class="- topic/li li">单值模型的脚本见<a class="- topic/xref xref" href="script/singleValueModeWrite.txt">附件 1</a></li></ul><p class="- topic/p p">此脚本生成分布式表 dfs://svmDemo/sensors 多天的模拟数据。函数 generate1DayData 用于产生一天的模拟数据；函数 singleThreadWriting 调用 generate1DayData 产生模拟数据，并将数据用单线程写入分布式表中。singleThreadWriting 中每次写入操作写入一个分区的全部数据，这样每个分区的数据文件只需打开一次就全部写入，可提高写入性能。多线程并行写入能进一步提升写入性能。
函数 multipleThreadWriting 用<code class="+ topic/ph pr-d/codeph ph codeph">cut</code>函数把测点标号向量按线程数平均分隔，然后用<code class="+ topic/ph pr-d/codeph ph codeph">ploop</code>并行调用 singleThreadWriting 多线程写入数据库。</p><p class="- topic/p p">代码中线程数设为 20，实际写入时请根据主机内存情况调整。写入开始后，可以使用<code class="+ topic/ph pr-d/codeph ph codeph">getRecentJobs</code>函数查看作业处理情况，若返回结果中 endtime 等 endtime 全部显示出来了。使用<code class="+ topic/ph pr-d/codeph ph codeph">getClusterPerf</code>函数查看系统 CPU 与内存等资源使用情况。</p><p class="- topic/p p">若有 1000 台机器，50 个指标，写入 5 天，在普通台式机上约需 50-100 分钟左右写入，在 I/O 性能较好的服务器上约需 4 分钟写入。磁盘上数据文件约为 160GB。</p><ul class="- topic/ul ul"><li class="- topic/li li">多值模型的脚本见<a class="- topic/xref xref" href="script/multipleValueModeWrite.txt">附件 2</a></li></ul><p class="- topic/p p">这个脚本可以生成分布式表 dfs://mvmDemo/equip 多天的模拟数据，脚本逻辑与单值模型类似。</p><p class="- topic/p p">要提升写入性能，可采取以下措施：</p><ul class="- topic/ul ul"><li class="- topic/li li">批量写入每批次的数据量不宜过小，一般几十 MB 比较合适。</li></ul><p class="- topic/p p">以上述单值模型案例为例，100 个测点共写入 90 天的数据，即 777,600,000 条记录，用不同批量大小在一台 PowerEdge R730xd linux 主机上测试。DolphinDB 采用单节点部署，限制使用 32G 内存，16 核 CPU。元数据写入 SSD，数据写入 HDD，其他都采用默认配置。测试结果如下：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="24-使用脚本生成测试数据__entry__1">每批记录数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-使用脚本生成测试数据__entry__2">写入耗时（秒）</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-使用脚本生成测试数据__entry__3">每秒写入记录数</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__1">100</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__2">8,086</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__3">96,166</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__1">6,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__2">165</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__3">471,272</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__1">360,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__2">38</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__3">20,463,157</td></tr></tbody></table></div><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">每次写入数据涉及的分区数量不宜过多。DolphinDB 存储时，每个分区每个列存为一个文件。若每次写入 3 列数据，涉及 3,600 个分区，那么每次需要写入 3,600*3=10,800 个文件，会严重影响写入性能。例如在上述测试环境中，还是每批写入 360,000 条，并写入一样多的记录总数，但每批涉及分区 3,600 个，耗时 7,922 秒，是每次写入单个分区耗时的 200 余倍。</p></li><li class="- topic/li li"><p class="- topic/p p">对小批量写入，启用 Redo Log 和写入数据缓存 (Cache Engine) 功能，能把多次少量的写入缓存起来，一次批量写入，能大大提高写入吞吐量。以上述 100 个测点共写入 777,600,000 条记录为例，在同样的测试环境，但设置了 dataSync=1（表示将 Redo log、数据和元数据强制刷盘）和 chunkCacheEngineMemSize=1（缓存为 1GB）。测试结果显示，每批写入 100 条记录，仅耗时 81 秒，吞吐量提高约 100 倍。有关 Redo Log 和 Cache Engine 的更多信息，请参阅<a class="- topic/xref xref" href="redoLog_cacheEngine.html">Cache Engine 与数据库日志</a></p></li><li class="- topic/li li"><p class="- topic/p p">使用多个客户端多线程并行写入，但注意多个 writer 不能同时向同一个分区写入。</p></li></ul><p class="- topic/p p">下面用<a class="- topic/xref xref" href="script/singleValueModeWrite.txt">单值模型脚本</a>在一台台式机上测试，台式机 CPU 为 6 核 12 线程的 Intel I7，内存 32GB，128GB SSD 和 2TB 7200RPM HDD。DolphinDB 采用单节点部署，限制使用 16G 内存，启动 Redo Log 和写入缓存。元数据和 Redo Log 写入 SSD，数据写入 HDD。1000 台设备，50 个指标，写入 5 天历史数据，如下表所示，5 个线程是单线程写入性能快约 1.5 倍，10 线程时受硬件资源限制，与 5 线程相比提升不明显。</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="24-使用脚本生成测试数据__entry__13">线程数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-使用脚本生成测试数据__entry__14">写入耗时（秒）</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-使用脚本生成测试数据__entry__15">每秒写入记录数</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__13">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__14">4081</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__15">5,292,820</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__13">5</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__14">2925</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__15">7,384,615</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__13">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__14">2907</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-使用脚本生成测试数据__entry__15">7,430,340</td></tr></tbody></table></div><ul class="- topic/ul ul"><li class="- topic/li li">不同的数据节点配置不同的磁盘，每个数据节点挂载多卷（Volumes），可并行利用多个磁盘的 I/O 接口，大幅提升节点的整体读写吞吐性能。例如下面配置 diskIOConcurrencyLevel 为 4，volumes 配置 4 个磁盘，也即为每一个挂载的硬盘配置一个读写线程，将对一个磁盘的读写任务串行化到一个队列，避免了并发线程之间的磁盘读写竞争。</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>diskIOConcurrencyLevel=4
volumes=/hdd/hdd1/volumes,/hdd/hdd2/volumes,/hdd/hdd3/volumes,/hdd/hdd4/volumes</code></pre></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title18" id="3-历史数据查询"><h2 class="- topic/title title topictitle2" id="ariaid-title18">3. 历史数据查询</h2><div class="- topic/body body"><p class="- topic/p p">本章节所用数据均为第 2 章中所建之单值模型 sensors 分布式表。请注意，由于 sensors 中 value 列的数据为随机生成，所以以下结果中涉及到 value 的数值会与您得到的结果有所差别。</p><p class="- topic/p p">首先将 sensors 表元数据载入内存：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>login("admin","123456")
sensors=loadTable("dfs://svmDemo","sensors")</code></pre></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title19" id="31-趋势查询"><h3 class="- topic/title title topictitle3" id="ariaid-title19">3.1. 趋势查询</h3><div class="- topic/body body"><p class="- topic/p p">将一天内 10 个指定测点的数据，按每 2 分钟分成若干时间段，每个时间段内计算最大值、最小值、开始值与结束值。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select first(value), last(value), max(value), min(value)
from sensors 
where id in [1,2,51,52,101,102,151,152,201,202] and datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59  
group by id, bar(datetime,120)</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title20" id="32-对比查询"><h3 class="- topic/title title topictitle3" id="ariaid-title20">3.2. 对比查询</h3><div class="- topic/body body"><p class="- topic/p p">查询某天内 1，2，3 号设备中的 1 号指标每分钟的平均值，将结果按分钟与设备编号排列，以便于对比。</p><p class="- topic/p p">DolphinDB 支持在 SQL 中使用<code class="+ topic/ph pr-d/codeph ph codeph">pivot by</code>子句将表中某列的内容按照两个维度重新排列，亦可配合数据转换函数使用。<code class="+ topic/ph pr-d/codeph ph codeph">pivot by</code>是 DolphinDB 对标准 SQL 语句的拓展。此查询的代码如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(value) from sensors 
where id in [1,51,101], datetime between 2020.09.01T00:00:00 : 2020.09.01T23:59:59   
pivot by datetime.minute() as time, id</code></pre><p class="- topic/p p">结果如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>time	C1	C51	C101
00:00m	0.5375	0.4846	0.4858
00:01m	0.5422	0.5549	0.5073
00:02m	0.4576	0.5358	0.4846
...</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title21" id="33-分组查询-top-n"><h3 class="- topic/title title topictitle3" id="ariaid-title21">3.3. 分组查询 top N</h3><div class="- topic/body body"><p class="- topic/p p">查询指定 1 小时内 CPU 平均利用率最高的三台设备。假设 CPU 利用率为指标 1。这里使用嵌套查询，先分组计算平均值，然后根据平均值排序，再对结果使用 top 子句（或 limit 子句）。代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select top 3 id 
from (
	select avg(value) as avg
	from sensors 
	where mod(id, 50)=1, datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59  
	group by id order by avg desc
	)</code></pre><p class="- topic/p p">以上脚本亦可写为：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select id 
from (
	select avg(value) as avg
	from sensors 
	where mod(id, 50)=1, datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59  
	group by id order by avg desc
	) limit 3</code></pre><p class="- topic/p p">注意这里 id 查询条件用了 mod(id, 50)=1，查询时不能分区剪枝，是因为这个查询本身就需要扫描全部 id 的分区，若只在部分设备中查询，建议用 id in [1,51,...]的方式。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title22" id="34-关联查询"><h3 class="- topic/title title topictitle3" id="ariaid-title22">3.4. 关联查询</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 支持如下 7 种关联查询：</p><ul class="- topic/ul ul"><li class="- topic/li li">equal join (<code class="+ topic/ph pr-d/codeph ph codeph">ej</code>)</li><li class="- topic/li li">left join (<code class="+ topic/ph pr-d/codeph ph codeph">lj</code>)</li><li class="- topic/li li">cross join (<code class="+ topic/ph pr-d/codeph ph codeph">cj</code>)</li><li class="- topic/li li">full join (<code class="+ topic/ph pr-d/codeph ph codeph">fj</code>)</li><li class="- topic/li li">asof join (<code class="+ topic/ph pr-d/codeph ph codeph">aj</code>)</li><li class="- topic/li li">window join (<code class="+ topic/ph pr-d/codeph ph codeph">wj</code>)</li><li class="- topic/li li">prefix join (<code class="+ topic/ph pr-d/codeph ph codeph">pj</code>)</li></ul><p class="- topic/p p">例 1：分布式表 sensors 中只存储了测点编号，现提供这些测点的描述信息，在查询分析时需与这些信息进行关联查询和计算。</p><p class="- topic/p p">这些测点信息可以存储在维度表中。维度表是分布式数据库中没有分区的表，一般用于存储不频繁更新的小数据集。维度表可与任何分布式表，维度表以及内存表进行关联。DolphinDB 自动会在各个节点上缓存 (cache) 维度表，以提升查询和关联的性能。下面例子创建维度表 tagInfo 并插入一些样本数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db = database("dfs://svmDemo")
schema = table(1:0, `tagId`machineId`tagName`organization`description, [INT,INT,SYMBOL,SYMBOL,SYMBOL])
dt = db.createTable(schema,`tagInfo)

tagInfo=loadTable("dfs://svmDemo","tagInfo")
t = table(1 2 51 52 as tagId,1 1 2 2 as machineId,`speed`temperature`speed`temperature as tagName,`hangzhou`hangzhou`shanghai`shanghai as organization,
  "Speed/No.1 Wind Turbine in Hangzhou" "Temperature/No.1 Wind Turbine in Hangzhou" "Speed/No.2 Wind Turbine in Shanghai" "Temperature/No.2 Wind Turbine in Shanghai" as description )
tagInfo.append!(t)</code></pre><p class="- topic/p p">sensors 与 tagInfo 进行 equal join 关联查询：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select tagId,datetime,value,machineId,tagName,organization from ej(sensors,tagInfo,`id,`tagid) where machineId in [1,2], datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59 order by datetime</code></pre><p class="- topic/p p">结果如下：</p><div class="table-container"><table class="- topic/table table" data-cols="6"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__1">tagId</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__2">datetime</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__3">value</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__4">machineId</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__5">tagName</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__6">organization</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__2">2020.09.01T00:00:00</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__3">95.4607</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__4">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__5">speed</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__6">hangzhou</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__1">2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__2">2020.09.01T00:00:00</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__3">97.5109</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__4">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__5">temperature</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__6">hangzhou</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__1">51</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__2">2020.09.01T00:00:00</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__3">67.7972</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__4">2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__5">speed</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__6">shanghai</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__1">52</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__2">2020.09.01T00:00:00</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__3">76.0762</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__4">2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__5">temperature</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__6">shanghai</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__2">2020.09.01T00:00:01</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__3">49.3085</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__4">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__5">speed</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__6">hangzhou</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__1"></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__2 34-关联查询__entry__3" colspan="2">...</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__4 34-关联查询__entry__5" colspan="2">	</td></tr></tbody></table></div><p class="- topic/p p">例 2：根据温度异常指标记录表（t1）以及 sensors 表，寻找温度（3 号指标）异常发生时，同一机器的湿度（4 号指标）的最新值。</p><p class="- topic/p p">函数<code class="+ topic/ph pr-d/codeph ph codeph">aj</code>(asof join) 的常用场景是在时间字段上进行非同时连接，为左表中每条记录，在右表中获取符合指定条件的组中该时刻之前（包括该时刻）的最后一条记录。</p><p class="- topic/p p">在本例中，为了展示 asof join，我们将 sensors 中的数据进行了改动，假设温度异常发生之前，有一段时间内 sensors 表中不存在湿度的数据。</p><p class="- topic/p p">示例代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t1 = table(3 53 as id, 1 2 as machineId, 2020.09.01T09:56:06 2020.09.01T09:58:12 as datetime, 50.6 50.7 as anomalyMetrics)
t2_1 = select *, 1 as machineId from sensors where id=4, datetime between 2020.09.01T09:00:00 : 2020.09.01T09:54:00
t2_2 = select *, 2 as machineId from sensors where id=54, datetime between 2020.09.01T09:00:00 : 2020.09.01T09:57:00
t2 = unionAll(t2_1, t2_2)
select * from aj(t1, t2, `machineId`datetime);</code></pre><p class="- topic/p p">asof join 和 left join 的区别为：假设连接列是时间，对于左表中时间 t 对应的行，如果右表中没有与之匹配的记录，则取右表中在 t 之前的最近时间对应的行。</p><p class="- topic/p p">例 3：t1 是异常指标记录表，现需要了解异常指标发生时间之前 5 秒钟的原始数据中的指标平均值、最大和最小值。</p><p class="- topic/p p">此场景可使用函数<code class="+ topic/ph pr-d/codeph ph codeph">wj</code>(window join)，为左表中每条记录，在右表中获取符合指定条件的组基于该时刻的指定时间范围的记录并进行计算。示例代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t1 = table(1 51 as id, 2020.09.01T09:56:06 2020.09.01T09:56:07 as datetime, 50.6 50.7 as anomalyMetrics)
t2 = select * from sensors where id in [1,51], datetime between 2020.09.01T09:00:00 : 2020.09.01T09:59:59
wj(t1, t2, -5000:0, &lt;[avg(value),max(value),min(value)]&gt;, `id`datetime)</code></pre><p class="- topic/p p">例 4：现有一张告警表，记录了设备的当前告警信息。告警后，用户需要对告警进行确认和清除。查询时，需要显示告警信息以及告警状态。</p><p class="- topic/p p">告警表 Alarm 是分布式表，不支持单行更新。因此创建一张告警操作流水表 AlarmAction 记录告警确认和清除信息。每确认或清除一次，往操作流水表中添加一条记录。查询时将告警表和操作流水表通过<code class="+ topic/ph pr-d/codeph ph codeph">lj</code>关联。示例代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//创建告警表和告警操作流水表
alarm = table(1:0, `ID`deviceID`time`priority`desc, [UUID,SYMBOL, DATETIME, INT, STRING])
db1 = database(, VALUE, 2020.01.01..2020.12.31)
db2 = database(, HASH, [SYMBOL, 10])
db = database("dfs://demo", COMPO, [db1,db2])
db.createPartitionedTable(alarm, "alarm", `time`deviceID)

alarmAction = table(1:0, `ID`deviceID`time`action`actionTime`user`remark, [UUID,SYMBOL,DATETIME, SYMBOL, DATETIME, SYMBOL, STRING])
db = database("dfs://demo")
db.createPartitionedTable(alarmAction, "alarmAction", `time`deviceID)

//告警表中模拟写入3条记录
alarm = loadTable("dfs://demo","alarm")
action = loadTable("dfs://demo","alarmAction")
t = table([uuid("b9f36c85-43ce-45a3-8427-b3529a6c41cc"),uuid("baba6fe6-67b9-4c18-885a-3fd6edd3002e"),uuid("b510c959-4f9b-4eaf-81a7-ee7e420810c0")] as UUID,"BDSA11_PSCADA" "DMS01" "XKZDEPOT_CCTV_DI20" as deviceID,take(now().datetime(),3) as time,1..3 as priority,"CONN_FAIL" "OFFLINE" "ERROR" as descs)
alarm.append!(t)

//确认2条告警，写入告警操作流水表
arrUUID = uuid(["b9f36c85-43ce-45a3-8427-b3529a6c41cc","baba6fe6-67b9-4c18-885a-3fd6edd3002e"])
tmp = select ID,deviceId,  time,"CONFIRM" as action, now().datetime() as actionTime, "admin" as actionUser, "test confirm" as remark from alarm where time &gt; today().datetime(),  ID in arrUUID
action.tableInsert(tmp)

//清除1条告警，写入告警操作流水表
tmp = select ID,deviceId,  time,"CLEAR" as action, now().datetime() as actionTime, "admin" as actionUser, "test clear" as remark from alarm where time &gt; today().datetime(),  ID =uuid("b9f36c85-43ce-45a3-8427-b3529a6c41cc")
action.tableInsert(tmp)

//查询告警信息以及确认、清除信息
t1 = select ID,time, deviceID, actionTime,user as confirmUser, remark as confirmRemark from action where time &gt; today().datetime(), action="CONFIRM"
t2 = select ID, actionTime, user as clearUser, remark as clearRemark from action where time &gt; today().datetime(), action="CLEAR"
tmp = lsj(t1,t2,`ID)
select * from lj(alarm, tmp,`time`deviceId`ID,`time`deviceID`ID) where time &gt; today().datetime()
</code></pre><p class="- topic/p p">查询结果如下：</p><div class="table-container"><table class="- topic/table table" data-cols="11"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__40">ID</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__41">deviceID</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__42">time</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__43">priority</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__44">desc</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__45">actionTime</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__46">confirmUser</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__47">confirmRemark</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__48">t2_actionTime</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__49">clearUser</th><th class="- topic/entry entry colsep-0 rowsep-0" id="34-关联查询__entry__50">clearRemark</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__40">b9f...</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__41">BDSA11_PSCADA</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__42">2020.11.05T17:10:11</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__43">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__44">CONN_FAIL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__45">2020.11.05T17:19:26</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__46">admin</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__47">test confirm</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__48">2020.11.05T17:30:53</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__49">admin</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__50">test clear</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__40">bab...</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__41">DMS01</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__42">2020.11.05T17:10:11</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__43">2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__44">OFFLINE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__45">2020.11.05T17:19:26</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__46">admin</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__47 34-关联查询__entry__48 34-关联查询__entry__49 34-关联查询__entry__50" colspan="4">test confirm</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__40">b51...</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__41">XKZDEPOT_CCTV_DI20</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__42">2020.11.05T17:10:11</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__43">3</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__44">ERROR</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="34-关联查询__entry__45 34-关联查询__entry__46 34-关联查询__entry__47 34-关联查询__entry__48 34-关联查询__entry__49 34-关联查询__entry__50" colspan="6">	</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title23" id="35-降精度"><h3 class="- topic/title title topictitle3" id="ariaid-title23">3.5. 降精度</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 支持最高纳秒级精度的时间序列数据，可将高精度大数据集聚合转换成低精度小数据集。支持多种时间精度分组抽样：月（month）、天（date）、分钟 (minute)、秒 (second)，以及其他任意时间精度。</p><p class="- topic/p p">例 1：计算一天内指定测点每分钟的平均值。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(value) as avg 
from sensors 
where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.01T23:59:59  
group by id, minute(datetime)</code></pre><p class="- topic/p p">例 2：计算一天内指定测点每 30 秒的平均值。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(value) as avg 
from sensors 
where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59  
group by id, bar(datetime,30)</code></pre><p class="- topic/p p">例 3：先对每个指定测点求每 10 秒的平均值，再对每测点的平均值结果求最小值。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select min(avg) as minAvg from(
	select avg(value) as avg
	from sensors 
	where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59  
	group by id, bar(datetime,10)
) group by id</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title24" id="36-插值查询"><h3 class="- topic/title title topictitle3" id="ariaid-title24">3.6. 插值查询</h3><div class="- topic/body body"><p class="- topic/p p">在物联网领域经常会发生采集的数据缺失。对数据中的空值，DolphinDB 提供了<code class="+ topic/ph pr-d/codeph ph codeph">interpolate</code>用于插值查询，插值的方式支持：linear（线性插值），pad（使用已有的值填充），nearest（使用最接近 NULL 值的有效值填充）和 krogh（使用 krogh 多项式插值）。</p><p class="- topic/p p">DolphinDB 还提供了以下 4 个填充 NULL 值的函数：向前/向后取非空值（<code class="+ topic/ph pr-d/codeph ph codeph">bfill</code>/<code class="+ topic/ph pr-d/codeph ph codeph">ffill</code>），线性填充（<code class="+ topic/ph pr-d/codeph ph codeph">lfill</code>）和指定值填充（<code class="+ topic/ph pr-d/codeph ph codeph">nullFill</code>）。用户也可以通过脚本或 C++ 插件扩充新的插值函数。</p><p class="- topic/p p">例 1：使用 ffill 函数进行填充空值。在脚本中，首先制造一分钟的空值。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t = select * from sensors where id=1, datetime between 2020.09.01T00:00:00 : 2020.09.01T00:59:59 
update t set value=NULL where datetime between 2020.09.01T00:08:00 : 2020.09.01T00:09:00
update t set value=value.ffill() </code></pre><p class="- topic/p p">例 2：查询一段时间内每分钟的平均值，如果某一分钟内没有原始数据，需要插值。</p><p class="- topic/p p">DolphinDB 从 1.30.7 版本起在 group by 子句中引入了 dummy 函数<code class="+ topic/ph pr-d/codeph ph codeph">interval(X, duration, fill)</code>来实现插值功能，fill 的方式有 5 种，分别是：prev，缺失值使用前一个值填充；post，缺失值使用后一个值填充；linear，缺失值使用线性插值填充（注意如果列是非数值列，则无法使用线性插值填充，这种情况下会回退到使用 prev 的方式填充）；null，缺失值使用 null 值填充；numericValue，以一个指定的 numeric 值来填充。例子如下，插值的方式用了线性插值：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(value)  as value 
from sensors 
where id = 1 and date(datetime)=2020.09.01 group by id, interval(datetime, 1m, "linear")</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：1.30.7 前的版本，要用下面的方法实现，先生成时间戳表做为左表，然后用 lsj 连接：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>timeRange = 2020.09.01T00:00:00+(0..1439)*60
t = table(timeRange as time,take(1,size(timeRange)) as id)

t1=select avg(value)  as value 
from sensors 
where id = 1 and datetime between 2020.09.01T00:00:00 : 2020.09.01T23:59:59 
group by id,bar(datetime,60) as time  
delete from t1 where rowNo(id)%2=1 //为了查看插值效果，特意删去t1偶数行

select time,interpolate(value) as value ,t.id from lsj(t,t1,`time)</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title25" id="37-去重"><h3 class="- topic/title title topictitle3" id="ariaid-title25">3.7. 去重</h3><div class="- topic/body body"><p class="- topic/p p">若从设备采集的数据有重复，或者一个时间间隔内有多条记录，但查询时每个时间间隔只需要一条记录，这些场景就需要去除表中的重复记录。DolphinDB 的数据模型支持重复数据，在插入时也不检测重复数据。若要去除分布式表中的重复记录，可以使用 context by 子句去重。</p><p class="- topic/p p">context by 是 DolphinDB 独有的功能，是对标准 SQL 语句的拓展。context by 与 group by 类似，都对数据进行分组，但是使用 group by 时，每一组返回一个标量值，而使用 context by 时，每一组返回一个和组内元素数量相同的向量。context by 与 limit 一起使用能够获取表中每个分组前 n 条记录或最后 n 条记录。用 context by 去重的例子如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from sensors where id in [1,51,101,151,201], datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59 context by id, datetime limit -1</code></pre><p class="- topic/p p">上述代码 limit 后面为负数，表示取每个分组的最后一条记录。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title26" id="38-函数视图"><h3 class="- topic/title title topictitle3" id="ariaid-title26">3.8. 函数视图</h3><div class="- topic/body body"><p class="- topic/p p">函数视图是封装了访问数据库以及相关计算语句的自定义函数。它类似关系数据库中的存储过程，可以封装复杂的业务逻辑，方便用户调用。与其他自定义函数会话隔离不同，函数视图可以实现会话之间的共享。函数视图的定义持久化存储在控制节点，因此如果 DolphinDB 集群重启，之前定义的函数视图仍然可以使用。</p><p class="- topic/p p">下面例子使用<code class="+ topic/ph pr-d/codeph ph codeph">addFunctionView</code>函数定义了一个函数视图 task1。其中先用 pivot by 对指定设备的第 1-6 个指标按分钟分组按列转置，然后对转置后的表进行列名修改，再对每列分别进行计算。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def task1(MachineId){
	t=select avg(value) from loadTable("dfs://svmDemo","sensors")  
	where id in 1..6 + (MachineId-1)*50, datetime &gt;datetimeAdd(now(),-1,`h).datetime()   
	pivot by datetime.minute() as time, id
	t.rename!(`time`tag1`tag2`tag3`tag4`tag5`tag6)
	return select time, log(tag1) as target1, sqrt(tag2) as target2, tan(tag3) as target3, sin(tag4) as target4, floor(tag5) as target5, abs(tag6) as target6 from t
}
addFunctionView(task1)  </code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title27" id="39-api-查询数据"><h3 class="- topic/title title topictitle3" id="ariaid-title27">3.9. API 查询数据</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供 Python, C++, Java, C#, Go, JavaScript, Rust 等常用语言的 API 用于读写数据库。通常数据查询的流程如下：</p><ul class="- topic/ul ul"><li class="- topic/li li"><ol class="- topic/ol ol"><li class="- topic/li li">建立一个连接并登录</li></ol></li><li class="- topic/li li"><ol class="- topic/ol ol"><li class="- topic/li li">通过 run("DolphinDBScript") 运行查询语句查询或 run("DolphinDBFunctionName",args) 运行函数或函数视图查询。</li></ol></li></ul><p class="- topic/p p">使用 Python API 从分布式表中读取数据的例子如下。其中第一个 run 是运行查询语句，第二个 run 是运行上一小节定义的函数视图：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python"><strong class="hl-keyword">import</strong> dolphindb <strong class="hl-keyword">as</strong> ddb
<strong class="hl-keyword">import</strong> pandas <strong class="hl-keyword">as</strong> pd
s = ddb.session()
<strong class="hl-keyword">try</strong>:
	s.connect(<span class="hl-string">"127.0.0.1"</span>,<span class="hl-number">8848</span>,<span class="hl-string">"admin"</span>,<span class="hl-string">"123456"</span>)
<strong class="hl-keyword">except</strong> Exception <strong class="hl-keyword">as</strong> e:
	<strong class="hl-keyword">print</strong> e
	exit(<span class="hl-number">1</span>)
script=<span class="hl-string">"""
select * from loadTable('dfs://svmDemo','sensors') 
where id=1, datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59
"""</span>
<strong class="hl-keyword">try</strong>:
	t = s.run(script)
	<strong class="hl-keyword">print</strong>(t)

	t = s.run(<span class="hl-string">"task1"</span>,<span class="hl-number">1</span>)
	<strong class="hl-keyword">print</strong>(t)
<strong class="hl-keyword">except</strong> Exception <strong class="hl-keyword">as</strong> e:
	<strong class="hl-keyword">print</strong> e</pre><blockquote class="- topic/lq lq"><p class="- topic/p p">注意：</p></blockquote><ul class="- topic/ul ul"><li class="- topic/li li">run 方法可接受的脚本最大长度为 65,535 字节。</li><li class="- topic/li li">脚本如果是多行，可以采用三引号的方式将脚本格式化，这样更易于维护。</li><li class="- topic/li li">在 run 前，不需要判断连接是否正常，直接 run 即可。系统会判断有没有连接，若没有，就会自动尝试重连，连不上或执行脚本失败，会抛出异常，因此代码中需要俘获异常并进行处理。</li></ul><p class="- topic/p p">使用 Java API 从分布式表中读取数据的例子如下：</p><p class="- topic/p p">在 Java API 中，数据表保存为 BasicTable 对象。由于 BasicTable 是列式存储，所以若要在 Java API 中读取行数据需要先取出需要的列，再取出行。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock java"><strong class="hl-keyword">public</strong> <strong class="hl-keyword">void</strong> getBasicTable(BasicTable table1) <strong class="hl-keyword">throws</strong> Exception{
    BasicIntVector idVec = (BasicIntVector) table1.getColumn(<span class="hl-string">"id"</span>);
    BasicDateTimeVector timeVec = (BasicDateTimeVector) table1.getColumn(<span class="hl-string">"time"</span>);
    BasicFloatVector valueVec = (BasicFloatVector) table1.getColumn(<span class="hl-string">"value"</span>);
    <strong class="hl-keyword">for</strong>(<strong class="hl-keyword">int</strong> ri=<span class="hl-number">0</span>; ri&lt;table1.rows(); ri++){
        System.out.println(idVec.getInt(ri));
        LocalDateTime timestamp = timeVec.getDatetime(ri);
        System.out.println(timestamp);
        System.out.println(valueVec.getDouble(ri));
    }
}
DBConnection conn = <strong class="hl-keyword">new</strong> DBConnection();
<strong class="hl-keyword">try</strong> {
	conn.connect(SERVER, PORT, USER, PASSWORD);
	BasicTable table1=conn.run(String.format(<span class="hl-string">"select * from loadTable('%s','%s')  where id=1, datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59"</span>,dbPath,tableName);
	getBasicTable(table1) ;
} <strong class="hl-keyword">catch</strong> (IOException e) {
    e.printStackTrace();
}</pre><p class="- topic/p p">对于返回大结果集的查询，JAVA API 提供了分段读取方法 (此方法仅适用于 DolphinDB 1.20.5 及其以上版本)。即在 run 方法中使用参数 fetchSize 指定分段大小，查询结果保存到 EntityBlockReader 对象，然后通过 read() 方法一段段的读取数据。代码示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock java">DBConnection conn = <strong class="hl-keyword">new</strong> DBConnection();
conn.connect(SERVER, PORT, USER, PASSWORD);
EntityBlockReader v = (EntityBlockReader)conn.run(<span class="hl-string">"select * from loadTable('dfs://svmDemo','sensors') where datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59"</span>,(ProgressListener) null,<span class="hl-number">4</span>,<span class="hl-number">4</span>,<span class="hl-number">10000</span>);
BasicTable data = (BasicTable)v.read();
<strong class="hl-keyword">while</strong>(v.hasNext()){
    BasicTable t = (BasicTable)v.read();
    data = data.combine(t);
}</pre><p class="- topic/p p">在使用上述分段读取的方法时，若数据未读取完毕，需要放弃后续数据的读取时，必须调用 skipAll 方法，否则会导致套接字缓冲区滞留数据，引发后续数据的反序列化失败。正确使用的示例代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock java">
EntityBlockReader v = (EntityBlockReader)conn.run(<span class="hl-string">"select * from loadTable('dfs://svmDemo','sensors') where datetime between 2020.09.01T00:00:00 : 2020.09.07T23:59:59"</span>,(ProgressListener) null,<span class="hl-number">4</span>,<span class="hl-number">4</span>,<span class="hl-number">10000</span>);
BasicTable data = (BasicTable)v.read();
v.skipAll();
BasicTable t1 = (BasicTable)conn.run(<span class="hl-string">"select * from loadTable('dfs://svmDemo','sensors') where datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59"</span>); <em class="hl-comment">//若没有 skipAll 此段会抛出异常。</em></pre><p class="- topic/p p">在 DolphinDB 中，分页查询还可以通过 top 关键字实现，比如查询第 50 到 100 行：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select top 50:100 * from sensors where datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59</code></pre><p class="- topic/p p">但这种方法每获取一页都要重新查询一次，效率较低。</p><p class="- topic/p p">有关 API 查询数据更详细的信息，请参阅 <a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/pydoc/py.html" target="_blank" rel="external noopener">Python API</a> 与 <a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/javadoc/newjava.html" target="_blank" rel="external noopener">JAVA API</a> 等教程。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title28" id="4-生产数据写入"><h2 class="- topic/title title topictitle2" id="ariaid-title28">4. 生产数据写入</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供 Python, C++, Java, C#, Go, JavaScript, Rust 等常用语言的 API，将从设备采集的数据写入到 DolphinDB 数据库中。DolphinDB 中内存表可以像传统数据库那样利用循环调用 insert into 语句写入数据。对分布式表，DolphinDB 推荐一种更为高效的批量写入数据方式，即将数据组织成一个 table 对象，利用<code class="+ topic/ph pr-d/codeph ph codeph">tableInsert</code>方式来批量写入。</p><p class="- topic/p p">通常数据写入的流程如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">1-建立一个连接并登录。</li><li class="- topic/li li">2-将待写入的数据组织成各 API 语言的本地对象。</li><li class="- topic/li li">3-通过连接对象调用 tableInsert 函数，将本地对象上传并写入数据库中。</li></ul><p class="- topic/p p">以下为各 API 的写入示例代码：</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title29" id="41-java-api"><h3 class="- topic/title title topictitle3" id="ariaid-title29">4.1. Java API</h3><div class="- topic/body body"><pre class="+ topic/pre pr-d/codeblock pre codeblock java">DBConnection conn = <strong class="hl-keyword">new</strong> DBConnection();
<strong class="hl-keyword">try</strong>{
    conn.connect(SERVER, PORT, USER, PASSWORD);
    List&lt;String&gt; colNames =  Arrays.asList(<span class="hl-string">"id"</span>,<span class="hl-string">"datetime"</span>,<span class="hl-string">"value"</span>)
    ArrayList&lt;Integer&gt; idArray = <strong class="hl-keyword">new</strong> ArrayList&lt;Integer&gt;(Arrays.asList(<span class="hl-number">1</span>,<span class="hl-number">2</span>));
    ArrayList&lt;Long&gt; datetimeArray = <strong class="hl-keyword">new</strong> ArrayList&lt;Long&gt;(Arrays.asList(<span class="hl-number">1600735563458l</span>,<span class="hl-number">16007355634582l</span>));
    ArrayList&lt;Double&gt; valueArray = <strong class="hl-keyword">new</strong> ArrayList&lt;Double&gt;(Arrays.asList(<span class="hl-number">22.3</span>,<span class="hl-number">43.1</span>));
    List&lt;Vector&gt; cols = Arrays.asList(<strong class="hl-keyword">new</strong> BasicIntVector(idArray),<strong class="hl-keyword">new</strong> BasicTimestampVector(datetimeArray),<strong class="hl-keyword">new</strong> BasicDoubleVector(valueArray));            
	BasicTable data = <strong class="hl-keyword">new</strong> BasicTable(colNames,cols);

    List&lt;Entity&gt; args = <strong class="hl-keyword">new</strong> ArrayList&lt;Entity&gt;(<span class="hl-number">1</span>);
    args.add(data);
	conn.run(String.format(<span class="hl-string">"tableInsert{loadTable('%s','%s')}"</span>,dbPath,tableName), args);
        
}<strong class="hl-keyword">catch</strong> (IOException ex){
   ex.printStackTrace();
}
</pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title30" id="42-c-api"><h3 class="- topic/title title topictitle3" id="ariaid-title30">4.2. C# API</h3><div class="- topic/body body"><pre class="+ topic/pre pr-d/codeblock pre codeblock csharp">DBConnection conn = <strong class="hl-keyword">new</strong> DBConnection();
<strong class="hl-keyword">try</strong> { 
    conn.connect(SERVER, PORT, USER, PASSWORD);

	List&lt;String&gt; colNames = <strong class="hl-keyword">new</strong> List&lt;<strong class="hl-keyword">string</strong>&gt;() { <span class="hl-string">"id"</span>, <span class="hl-string">"datetime"</span>, <span class="hl-string">"value"</span> };

    List&lt;<strong class="hl-keyword">int</strong>&gt; idArray = <strong class="hl-keyword">new</strong> List&lt;<strong class="hl-keyword">int</strong>&gt;() { <span class="hl-number">1</span>, <span class="hl-number">2</span> };
    List&lt;<strong class="hl-keyword">long</strong>&gt; datetimeArray = <strong class="hl-keyword">new</strong> List&lt;<strong class="hl-keyword">long</strong>&gt;() { <span class="hl-number">1600735563458</span>, <span class="hl-number">16007355634582</span> };
    List&lt;Double&gt; valueArray = <strong class="hl-keyword">new</strong> List&lt;Double&gt;() { <span class="hl-number">22.3</span>, <span class="hl-number">43.1</span> };

    List&lt;IVector&gt; cols = <strong class="hl-keyword">new</strong> List&lt;IVector&gt;() { <strong class="hl-keyword">new</strong> BasicIntVector(idArray.ToArray()), <strong class="hl-keyword">new</strong> BasicTimestampVector(datetimeArray.ToArray()), <strong class="hl-keyword">new</strong> BasicDoubleVector(valueArray.ToArray()) };
    BasicTable data = <strong class="hl-keyword">new</strong> BasicTable(colNames, cols);
    List&lt;IEntity&gt; args = <strong class="hl-keyword">new</strong> List&lt;IEntity&gt;(<span class="hl-number">1</span>);
    args.Add(data);
    conn.run(String.Format(<span class="hl-string">"tableInsert{{loadTable('{0}','{1}')}}"</span>, <span class="hl-string">"dfs://svmDemo"</span>, <span class="hl-string">"sensors"</span>), args);
}
<strong class="hl-keyword">catch</strong> (IOException ex)
{
    Console.WriteLine(ex.StackTrace);
}
</pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title31" id="43-python-api"><h3 class="- topic/title title topictitle3" id="ariaid-title31">4.3. Python API</h3><div class="- topic/body body"><pre class="+ topic/pre pr-d/codeblock pre codeblock python">s = ddb.session()
s.connect(SERVER, PORT, USER, PASSWORD)

data = {<span class="hl-string">'id'</span>: np.array([<span class="hl-number">1</span>, <span class="hl-number">2</span>], dtype=np.int32),
<span class="hl-string">'datetime'</span>: np.array([<span class="hl-number">1600735563458</span>, <span class="hl-number">16007355634582</span>]),
<span class="hl-string">'value'</span>: np.array([<span class="hl-number">22.3</span>, <span class="hl-number">43.1</span>])}
<strong class="hl-keyword">try</strong>:
	s.run(<span class="hl-string">"tableInsert{{loadTable('{db}', `{tb})}}"</span>.format(db=dbPath,tb=tableName), pd.DataFrame(data))
<strong class="hl-keyword">except</strong> Exception <strong class="hl-keyword">as</strong> e:
	<strong class="hl-keyword">print</strong> e</pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title32" id="44-c-api"><h3 class="- topic/title title topictitle3" id="ariaid-title32">4.4. C++ API</h3><div class="- topic/body body"><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>TableSP createDemoTable(long rows) {
  vector&lt;string&gt; colNames = {"id","time","value"};
  vector&lt;DATA_TYPE&gt; colTypes = {DT_INT, DT_DATETIME, DT_FLOAT};
  int colNum = 3, rowNum = rows, indexCapacity = rows;
  ConstantSP table =
      Util::createTable(colNames, colTypes, rowNum, indexCapacity);
  vector&lt;VectorSP&gt; columnVecs;
  for (int i = 0; i &lt; colNum; i++)
    columnVecs.push_back(table-&gt;getColumn(i));
  
  for ( int i = 0; i &lt; rowNum; i++) {
    columnVecs[0]-&gt;setInt(i, i % 500 +1);
    columnVecs[1]-&gt;setInt(i, Util::getEpochTime()/1000);
    columnVecs[2]-&gt;setFloat(i, 1.0);
  }
  return table;
}

DBConnection conn;
try {
	bool ret = conn.connect(hString, pLong, "admin", "123456");
	if (!ret) {
		cout &lt;&lt; "Failed to connect to the server" &lt;&lt; endl;
		return 0;
	}
} catch (exception &amp;ex) {
	cout &lt;&lt; "Failed to  connect  with error: " &lt;&lt; ex.what();
	return -1;
}

TableSP table = createDemoTable(cLong, sLong, 1);
vector&lt;ConstantSP&gt; args;
args.push_back(table);
try {
	conn.run("tableInsert{loadTable('dfs://svmDemo', `sensors)}", args);
} catch (exception &amp;ex) {
	cout &lt;&lt; "Failed to  run  with error: " &lt;&lt; ex.what();
}</code></pre><p class="- topic/p p">C++ API 读写 Vector、Table 等数据类型有多种方法，不同场景不同的读写方法有较大的性能差异，详情请参阅<a class="- topic/xref xref" href="cpp_data_io.html">C++ API 数据读写指南</a>。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title33" id="45-提升写入性能"><h3 class="- topic/title title topictitle3" id="ariaid-title33">4.5. 提升写入性能</h3><div class="- topic/body body"><p class="- topic/p p">API 的写入性能的优化主要可通过以下几个方面：</p><ul class="- topic/ul ul"><li class="- topic/li li">批量写入：每次组织大批量数据写入能够有效提升性能。</li><li class="- topic/li li">并行写入：将不同分区的数据，分多个任务并行写入。</li></ul><p class="- topic/p p">DolphinDB 的最小存储单元是分区，同一个分区不允许多个线程同时写入，否则会抛出异常。所以在并行写入时，需要考虑将数据按分区进行分流，避免同时向一个分区写入数据。具体多线程写入的实现案例请参阅<a class="- topic/xref xref" href="https://gitee.com/dolphindb/api-cplusplus/tree/main/example/DFSWritingWithMultiThread" target="_blank" rel="external noopener">C++ 多线程并行写入示例代码</a>。</p><ul class="- topic/ul ul"><li class="- topic/li li">异步写入：异步写入在写入时不需要等待 server 回复确认消息，可显著提高连续写入的速度，适用于对写入速度要求高但可靠性要求不苛刻的场景。使用异步写入的方法是在声明 DBConnection 类变量的时候，置 enableAYSN 参数值为 true 即可。适用于 DolphinDB 1.10.17、1.20.6 及以上 linux64 版本。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title34" id="46-提升数据压缩比"><h3 class="- topic/title title topictitle3" id="ariaid-title34">4.6. 提升数据压缩比</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 压缩算法支持压缩效果和解压缩时间综合性能较高的 LZ4 和 DELTA 算法。系统默认使用 LZ4 压缩算法，时间/日期类型或者相邻数据变化较小的整型建议采用 DELTA 算法。DolphinDB 采用增量压缩策略，每次对新增数据进行压缩。对小批量写入的场景，DolphinDB 提供了写入缓存（Cache Engine）机制。写完 WAL 之后，数据写入缓存，到达一定阈值以后，开始异步将缓存中的数据写入磁盘中。这相当于把少量多次的写入变成了批次写入，不仅能提升写入性能，也能提高压缩率。</p><p class="- topic/p p">文件<a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads/docs/compressDemo.tar.bz2" target="_blank" rel="external noopener">compressDemo.tar.bz2</a>保存了从一个地震计采集的某分量一天的实际数据。数据分三个字段：tagId，标签标识，值都是 1；time 时间戳，每个间隔 10 毫秒;data，采用值，是相邻数据变化较小的整数。下面测试了用 2 种算法，每批写入不同记录数时它们压缩后的字节数。未启用写入缓存机制，测试结果如下：</p><div class="table-container"><table class="- topic/table table" data-cols="7"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__1">每批写入记录数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__2">tagId 用 LZ4</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__3">tagId 用 DELTA</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__4">time 用 LZ4</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__5">time 用 DELTA</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__6">data 用 LZ4</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__7">data 用 DELTA</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__1">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__2">15,528,746</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__3">24,155,816</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__4">45,994,143</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__5">31,057,472</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__6">37,596,365</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__7">31,047,336</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__1">100</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__2">1,639,168</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__3">3,105,776</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__4">35,960,194</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__5">3,795,960</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__6">27,385,932</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__7">11,447,608</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__1">10,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__2">150,136</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__3">1,100,840</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__4">34,870,756</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__5">1,138,784</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__6">24,756,356</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__7">9,546,840</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__1">100,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__2">145,647</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__3">1,094,972</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__4">34,863,223</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__5">1,118,460</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__6">24,782,836</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__7">9,540,884</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__1">8,627,069</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__2">144,304</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__3">1,093,160</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__4">34,862,003</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__5">1,116,356</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__6">24,787,171</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__7">9,539,072</td></tr></tbody></table></div><p class="- topic/p p">启用写入缓存机制，测试结果如下：</p><div class="table-container"><table class="- topic/table table" data-cols="7"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__43">每批写入记录数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__44">tagId 用 LZ4</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__45">tagId 用 DELTA</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__46">time 用 LZ4</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__47">time 用 DELTA</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__48">data 用 LZ4</th><th class="- topic/entry entry colsep-0 rowsep-0" id="46-提升数据压缩比__entry__49">data 用 DELTA</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__43">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__44">146,337</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__45">1,093,420</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__46">34,863,946</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__47">1,118,788</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__48">24,782,183</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__49">9,541,456</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__43">100</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__44">144,532</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__45">1,093,176</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__46">34,862,534</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__47">1,116,636</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__48">24,787,829</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__49">9,539,412</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__43">10,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__44">144,337</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__45">1,093,168</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__46">34,862,092</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__47">1,116,372</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__48">24,786,148</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__49">9,539,120</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__43">100,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__44">144,312</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__45">1,094,972</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__46">34,862,011</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__47">1,116,364</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__48">24,787,179</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__49">9,539,080</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__43">8,627,069</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__44">144,312</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__45">1,093,168</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__46">34,862,011</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__47">1,116,356</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__48">24,787,171</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="46-提升数据压缩比__entry__49">9,539,080</td></tr></tbody></table></div><p class="- topic/p p">从测试结果可以发现，这个数据集的标签标识用 LZ4 算法、时间戳和采样值用 DELTA 算法压缩压缩效果较好。若标签标识用 LZ4 算法、时间戳和采样值用 DELTA 算法压缩，时间戳和采样值两个字段的综合压缩比达到 10:1，标签标识、时间戳和采样值三个字段的综合压缩比达到 13:1。在未启用写入缓存（Cache Engine）机制时，随着每批写入记录数越多，压缩效果越好。启用写入缓存机制后，小批量写入也能达到与大批量写入同样的压缩效果。</p><p class="- topic/p p">测试脚本<a class="- topic/xref xref" href="script/compressDemo.txt">下载</a>。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title35" id="5-实时数据和流计算"><h2 class="- topic/title title topictitle2" id="ariaid-title35">5. 实时数据和流计算</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供了流数据表 (stream table) 和流计算引擎用于实时数据处理。内置流计算框架目前已支持<a class="- topic/xref xref" href="../stream/time_series_engine.html">时序聚合引擎</a>、<a class="- topic/xref xref" href="../stream/cross_sectional_engine.html">横截面聚合引擎</a>、<a class="- topic/xref xref" href="Anomaly_Detection_Engine.html">异常检测引擎</a>和自定义流计算引擎。</p><ul class="- topic/ul ul"><li class="- topic/li li">时序聚合引擎 (Time-series Aggregator)：能对设备状态进行纵向聚合计算（按时间序列聚合），或者将多个设备状态横向聚合后再按时间聚合。时序聚合支持滑动窗口的流式计算。DolphinDB 对内置的窗口聚合函数均进行了性能优化，单核 CPU 每秒可完成近百万状态的时序聚合。</li><li class="- topic/li li">横截面聚合引擎 (Cross-sectional Aggregator)：是快照引擎的扩展，对设备状态进行横向聚合计算，比如计算一批设备的最新温度均值。</li><li class="- topic/li li">异常检测引擎 (Anomaly Detection Engine)：能实时检测数据是否符合用户自定义的警报指标，如发现异常数据，将它们输出到表中，满足物联网实时监控和预警的需求。</li><li class="- topic/li li">自定义流计算引擎：当以上三种引擎都不能满足需求时，用户也可以使用 DolphinDB 脚本或 API 语言自定义消息处理函数。</li></ul></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title36" id="51-数据写入流数据表"><h3 class="- topic/title title topictitle3" id="ariaid-title36">5.1. 数据写入流数据表</h3><div class="- topic/body body"><p class="- topic/p p">在 DolphinDB 中执行如下脚本定义流数据表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t = streamTable(1:0,`id`datetime`value,[INT,DATETIME,FLOAT]);
enableTableShareAndPersistence(table=t, tableName =`iot_stream, cacheSize=1000000, preCache=0)	</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title37" id="52-api-写入"><h3 class="- topic/title title topictitle3" id="ariaid-title37">5.2. API 写入</h3><div class="- topic/body body"><p class="- topic/p p">使用 API 写入流数据表与写入分布式表的方法非常相似，不同的地方主要有两点：一是流数据表与分布式数据库不同，流数据表的数据类型需要用户保证一致，不会自动转换；二是流数据表没有分区概念，多线程可以同时写入。</p><p class="- topic/p p">当用户写入的数据与流数据表的定义结构不一致需要转换时，通常可以通过自定义写入函数来实现。比如写入数据的时间戳是长整型表示的值，而 DolphinDB 字段是 Datetime 类型，这个转换可以用一个自定义写入函数来完成，在下例中用 java 代码来展示，其他语言的 API 也支持用同样的方式实现。</p><p class="- topic/p p">在 java 环境中写入 dolphindb 的示例代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock java">DBConnection conn = <strong class="hl-keyword">new</strong> DBConnection();
<strong class="hl-keyword">try</strong> {
    conn.connect(<span class="hl-string">"localhost"</span>, <span class="hl-number">8848</span>, <span class="hl-string">"admin"</span>, <span class="hl-string">"123456"</span>, <span class="hl-string">"def saveData(iot_stream, data){t = select id, datetime(timestamp(datetime)) as datetime,value from data;iot_stream.tableInsert(t)}"</span>);
    List&lt;String&gt; colNames = Arrays.asList(<span class="hl-string">"id"</span>, <span class="hl-string">"datetime"</span>, <span class="hl-string">"value"</span>);
    ArrayList&lt;Integer&gt; idArray = <strong class="hl-keyword">new</strong> ArrayList&lt;Integer&gt;(Arrays.asList(<span class="hl-number">1</span>, <span class="hl-number">2</span>));
    ArrayList&lt;Long&gt; datetimeArray = <strong class="hl-keyword">new</strong> ArrayList&lt;Long&gt;(Arrays.asList(<span class="hl-number">1600735563458l</span>, <span class="hl-number">16007355634582l</span>));
    ArrayList&lt;Double&gt; valueArray = <strong class="hl-keyword">new</strong> ArrayList&lt;Double&gt;(Arrays.asList(<span class="hl-number">22.3</span>, <span class="hl-number">43.1</span>));
    List&lt;Vector&gt; cols = Arrays.asList(<strong class="hl-keyword">new</strong> BasicIntVector(idArray), <strong class="hl-keyword">new</strong> BasicTimestampVector(datetimeArray), <strong class="hl-keyword">new</strong> BasicDoubleVector(valueArray));
    BasicTable data = <strong class="hl-keyword">new</strong> BasicTable(colNames, cols);

    List&lt;Entity&gt; args = <strong class="hl-keyword">new</strong> ArrayList&lt;Entity&gt;(<span class="hl-number">1</span>);
    args.add(data);
    conn.run(<span class="hl-string">"saveData{iot_stream}"</span>, args);
}<strong class="hl-keyword">catch</strong>(IOException ex){
    ex.printStackTrace();
}</pre><p class="- topic/p p">DolphinDB 支持通过插件从 opc 和 mqtt 服务器获取数据。</p><p class="- topic/p p">对于常用插件，建议在节点配置文件中通过 preloadModules 方式预加载，这样节点启动后在脚本中可以直接使用插件，无需再调用 loadPlugin。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>preloadModules=plugins::opc,plugins::mqtt</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">以下代码是 DolphinDB 脚本调用 OPC UA 插件来订阅 opc server 数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>loadPlugin("/plugins/opcua/PluginOPCUA.txt") //预加载可省略
conn = opcua::connect(EndpointUrl,"myclient")
opcua::subscribe(conn, 3, ["Counter","Expression","Random","Sawtooth"],iot_stream)</code></pre></li><li class="- topic/li li"><p class="- topic/p p">以下代码是 DolphinDB 脚本调用 mqtt 插件来订阅 mqtt server 数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>loadPlugin("/plugins/mqtt/PluginMQTTClient.txt") //预加载可省略
p = createCsvParser([INT, TIMESTAMP, FLOAT], ',', ';' )
conn = mqtt::subscribe("127.0.0.1",1883,"sensor/#", p, iot_stream)</code></pre></li></ul><p class="- topic/p p">上述插件均使用了后台任务的方式订阅数据，后台任务在调用订阅函数<code class="+ topic/ph pr-d/codeph ph codeph">subscribe</code>启动，运行在服务器上。通过<code class="+ topic/ph pr-d/codeph ph codeph">unsubscribe</code>函数可终止订阅任务。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title38" id="53-使用内置计算引擎"><h3 class="- topic/title title topictitle3" id="ariaid-title38">5.3. 使用内置计算引擎</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供了时序聚合引擎和横截面聚合引擎来配合流数据订阅处理实时数据。通过订阅将实时数据写入聚合引擎，然后由聚合引擎输出计算结果。</p><p class="- topic/p p">这里我们通过一个例子来展示如何使用聚合引擎来做实时计算。通常分为如下几个步骤：</p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">根据计算的业务需求选择合适的聚合引擎。</p></li><li class="- topic/li li"><p class="- topic/p p">根据聚合引擎定义结果输出表。</p></li><li class="- topic/li li"><p class="- topic/p p">根据需求设定订阅过滤器，仅订阅计算所需的数据。</p><p class="- topic/p p">比如下例中使用了 Speed 类测点的数据，假设一共 100 个设备，每一个设备 50 个测点，其中 1 号测点是 speed，那么在订阅时可以使用 DolphinDB 脚本：filter = (0..99)*50+1 以设定 filter[1,51,101,151...]。</p></li><li class="- topic/li li"><p class="- topic/p p">通过<code class="+ topic/ph pr-d/codeph ph codeph">subscribeTable</code>设立流数据订阅以及写入聚合引擎的规则。</p></li><li class="- topic/li li"><p class="- topic/p p">数据进入流数据表后触发订阅及聚合引擎计算。</p></li></ol></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title39" id="531-时序聚合引擎每秒钟计算风机过去-5-分钟的实时转数均值最大值最小值与方差"><h4 class="- topic/title title topictitle4" id="ariaid-title39">5.3.1. 时序聚合引擎：每秒钟计算风机过去 5 分钟的实时转数均值、最大值、最小值与方差。</h4><div class="- topic/body body"><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>share streamTable(10000:0, `time`id`avgSpeed`minSpeed`maxSpeed`stdSpeed, [DATETIME, INT,DOUBLE, DOUBLE,DOUBLE,DOUBLE]) as outputTable1
model = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT])
speedAggregator = createTimeSeriesAggregator(name="speedAggregator", windowSize=300, step=1, metrics=&lt;[avg(value), max(value), min(value), std(value)]&gt;, dummyTable=model, outputTable=outputTable1,timeColumn= `datetime,keyColumn= `id)
subscribeTable(tableName="iot_stream", actionName="speed_calc", offset=0,handler= append!{speedAggregator}, msgAsTable=true)</code></pre><p class="- topic/p p">时序聚合引擎的更多信息请参阅<a class="- topic/xref xref" href="../stream/time_series_engine.html">流数据时序聚合引擎</a>。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title40" id="532-横截面聚合引擎计算当前所有风机的平均转速与最大最小转速差"><h4 class="- topic/title title topictitle4" id="ariaid-title40">5.3.2. 横截面聚合引擎：计算当前所有风机的平均转速与最大最小转速差。</h4><div class="- topic/body body"><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>share table(1:0, `time`avgSpeed`spanSpeed, [TIMESTAMP,DOUBLE,DOUBLE]) as outputTable2
model = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT])
speedCrossAggregator=createCrossSectionalAggregator(name="speedCrossAggregator",metrics=&lt;[avg(value), max(value)-min(value)]&gt;,dummyTable=model,outputTable=outputTable2, keyColumn=`id, triggeringPattern=`perRow)
subscribeTable(tableName="iot_stream",actionName="speedCrossAggregator",offset=0,handler=append!{speedCrossAggregator}, msgAsTable=true)</code></pre><p class="- topic/p p">横截面聚合引擎的更多信息请参阅<a class="- topic/xref xref" href="../stream/cross_sectional_engine.html">流数据横截面聚合引擎</a>。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title41" id="54-异常检测引擎实时转速超出-10或低于-01以及转速差超出-02-时输出异常信号"><h3 class="- topic/title title topictitle3" id="ariaid-title41">5.4. 异常检测引擎：实时转速超出 10，或低于 0.1，以及转速差超出 0.2 时，输出异常信号。</h3><div class="- topic/body body"><p class="- topic/p p">用户只需指定异常指标，异常检测引擎就可以实时地进行异常数据检测并输出信号。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>share streamTable(1000:0, `time`anomalyType`anomalyString, [DATETIME, INT, SYMBOL]) as outputTable3
model = table(1:0,`id`datetime`value,[INT,DATETIME,FLOAT])
engine = createAnomalyDetectionEngine(name="engine1", metrics=&lt;[value &gt; 10, value &lt; 0.1, abs(deltas(value))&gt;0.2]&gt;, dummyTable=model, outputTable=outputTable3,timeColumn=`datetime,windowSize=6, step=3)</code></pre><p class="- topic/p p">异常检测引擎的更多信息，请参阅 <a class="- topic/xref xref" href="Anomaly_Detection_Engine.html">流数据异常检测引擎</a> 和<a class="- topic/xref xref" href="iot_anomaly_detection.html">流计算引擎实现传感器数据异常检测</a>。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title42" id="55-自定义计算引擎"><h3 class="- topic/title title topictitle3" id="ariaid-title42">5.5. 自定义计算引擎</h3><div class="- topic/body body"><p class="- topic/p p">除了内置的聚合引擎之外，<code class="+ topic/ph pr-d/codeph ph codeph">subscribeTable</code>函数的 handler 可以指定任意一个自定义函数作为消息处理函数，例如：当风机的 5 分钟转速均值超出一个阈值时，需要邮件告警并采取人工介入，那么可以通过实时自定义函数来达到这一目标。对于阈值设定，系统中有一个表 (threshold) 来保存每类指标的阈值。</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="55-自定义计算引擎__entry__1">category</th><th class="- topic/entry entry colsep-0 rowsep-0" id="55-自定义计算引擎__entry__2">max</th><th class="- topic/entry entry colsep-0 rowsep-0" id="55-自定义计算引擎__entry__3">min</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__1">SPD</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__2">25</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__3">10</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__1">PRS</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__2">2.2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__3">0.8</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__1">ELE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__2">3.7</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="55-自定义计算引擎__entry__3">0.2</td></tr></tbody></table></div><p class="- topic/p p">在前述案例中，通过时序聚合引擎已经得到了过去 5 分钟的转速均值指标输出到 outputTable1，可以直接订阅 outputTable1 表来获得 5 分钟均值。当检测到超限数据时，利用 DolphinDB 的 httpClient 插件，可以发送告警到邮件或到其他消息平台。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def alertHandler(userId, pwd, msg){
	try(loadPlugin("plugins/httpclient/PluginHttpClient.txt")) catch(ex){}
	threshold = select first(max), as max, first(min) as min from loadTable("dfs://thresholdDB","threshold") where category=="SPD"
	max = threshold.max[0]
	min = threshold.min[0]
	overLimited = select Id, avgSpeed  from msg where avgSpeed &gt;max or avgSpeed &lt; min

	if(overLimited.size()&gt;0){
		httpClient::sendEmail(userId,pwd,"alert@company.com", "转速超限告警" , string(overLimited))
	}
}
subscribeTable(, "outputTable1", "alertSub", -1, alertHandler{userId, pwd}, true)</code></pre><p class="- topic/p p">注意：订阅的 handler 必须是一个一元函数，仅接受一个 msg 参数 (msg 即订阅到的实时数据)，若函数有多个参数，需要将除 msg 之外的参数通过部分应用来固化，生成一个符合要求的一元函数。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title43" id="6-高可用测试"><h2 class="- topic/title title topictitle2" id="ariaid-title43">6. 高可用测试</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 支持高可用，多个元数据节点和多个数据副本之间保证强一致性。DolphinDB 的高可用机制包括：</p><ul class="- topic/ul ul"><li class="- topic/li li">数据高可用。DolphinDB 采用多副本机制，相同数据块的副本存储在不同的数据节点上。一个数据库可以包含上百万个分区，分区的多副本之间使用改良的二阶段提交协议实现分区副本的强一致性。当分区副本数为 N 的时候，在 N-1 个节点宕机的情况下，保证系统可以持续写入和读取。分区的多副本之间没有采用 Raft 协议，主要是考虑到:（1）DolphinDB 集群是为海量数据设计的，单个集群可以支持千万级以上分区数，使用 Raft 和 Paxos 等算法创建千万级的协议组，成本太高；（2）使用 Raft 和 Paxos 等算法，查询数据时只有一个副本可用，对于 OLAP 应用场景来说过于浪费资源；（3）写入的数据如果跨分区，即使采用了 Raft 和 Paxos 等算法，仍然需要二阶段提交协议保证事务的 ACID。</li><li class="- topic/li li">元数据高可用。DolphinDB 的元数据存储在控制节点上。为了保证元数据的高可用，DolphinDB 通过配置多个控制节点来组成一个 Raft 组。组内节点采用 Raft 协议实现强一致性。Raft 组中只有一个 Leader，其他都是 Follower，Leader 和 Follower 上的元数据保持强一致性。数据节点只能和 Leader 进行交互。如果当前 Leader 不可用，Raft 组会立即选举出新的 Leader 来提供元数据服务。Raft 组能够容忍小于半数的控制节点宕机。</li><li class="- topic/li li">客户端高可用。DolphinDB API 提供了自动重连和切换机制。使用 API 与 DolphinDB 的数据节点交互时，如果连接的数据节点宕机，API 会先尝试重连，若重连失败会自动切换连接到集群中其他可用的数据节点，继续执行未完成的任务。切换连接数据节点对用户是透明的。</li></ul></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title44" id="61-数据高可用测试"><h3 class="- topic/title title topictitle3" id="ariaid-title44">6.1. 数据高可用测试</h3><div class="- topic/body body"><p class="- topic/p p">要使用数据高可用功能，至少需要 2 台物理服务器部署 DolphinDB 集群，每台部署 2 个数据节点。集群部署请参考<a class="- topic/xref xref" href="multi_machine_cluster_deployment.html">多服务器集群部署教程</a>。其中副本的个数在 controller.cfg 中配置。例如，把副本数设置为 2：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>dfsReplicationFactor=2</code></pre><p class="- topic/p p">默认情况下，DolphinDB 允许相同数据块的副本分布在同一台机器上。为了保证数据高可用，需要把相同数据块的副本分布在不同的机器上。请在 controller.cfg 添加以下配置项：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>dfsReplicaReliabilityLevel=2</code></pre><p class="- topic/p p">这里设置 dfsReplicaReliabilityLevel=2，即在资源允许情况下，副本优先部署在多台物理服务器。若集群中服务器台数大于副本数时，可设置 dfsReplicaReliabilityLevel=1。</p><p class="- topic/p p">使用 API 与数据节点进行交互时，如果连接的数据节点宕机，API 会尝试重连，若重连失败会自动切换到其他可用的数据节点。这对用户是透明的。目前 Java、C#、C++ 和 Python API 支持高可用。以下例子设置 Java API 高可用：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>import com.xxdb;
DBConnection conn = new DBConnection();
String[]  sites=["115.239.209.228:21142", "115.239.209.228:21143", "115.239.209.224:21142", "115.239.209.224:21143"]
boolean success = conn.connect(host="115.239.209.228", port=21142, userid="admin", password="123456", highAvailability=True, highAvailabilitySites=sites)</code></pre><p class="- topic/p p">如果数据节点 115.239.209.228:21142 宕机，API 会自动连接到其他可用的数据节点。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title45" id="62-元数据高可用测试"><h3 class="- topic/title title topictitle3" id="ariaid-title45">6.2. 元数据高可用测试</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title46" id="621-环境部署"><h4 class="- topic/title title topictitle4" id="ariaid-title46">6.2.1. 环境部署</h4><div class="- topic/body body"><p class="- topic/p p">要使用元数据高可用功能，至少需要三台物理服务器，每台部署一个控制节点（controller），一个代理节点（agent）和"cpp_data_io.md" node）。具体部署请参阅<a class="- topic/xref xref" href="ha_cluster_deployment.html">高可用集群部署教程</a>，配置两个副本，其他主要配置如下：</p><p class="- topic/p p">agent.cfg 文件中配置</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>mode =agent
localSite=192.168.1.13:22215:agent2
controllerSite=192.168.1.12:22216:controller1
sites=192.168.1.13:22215:agent2:agent,192.168.1.12:22216:controller1:controller,192.168.1.13:22216:controller2:controller,192.168.1.14:22216:controller3:controller
lanCluster=0
chunkCacheEngineMemSize=4</code></pre><p class="- topic/p p">cluster.cfg 文件中配置</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>lanCluster=0
maxPubConnections=64
maxMemSize=16
workerNum=4
newValuePartitionPolicy=add
chunkCacheEngineMemSize=4</code></pre><p class="- topic/p p">controller.cfg 文件中配置</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>mode=controller
localSite=192.168.1.13:22216:controller2
dfsReplicationFactor=2
dfsReplicaReliabilityLevel=1或dfsReplicaReliabilityLevel=2
dfsHAMode=Raft
dataSync=1
maxConnections=128
maxMemSize=16
webWorkerNum=4
workerNum=4</code></pre><p class="- topic/p p">节点配置信息 cluster.nodes 如下</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>localSite,mode
192.168.1.12:22216:controller1,controller
192.168.1.13:22216:controller2,controller
192.168.1.14:22216:controller3,controller
192.168.1.12:22215:agent1,agent
192.168.1.13:22215:agent2,agent
192.168.1.14:22215:agent3,agent
192.168.1.12:22217:NODE1,datanode
192.168.1.12:22218:NODE2,datanode
192.168.1.13:22217:NODE2241,datanode
192.168.1.13:22218:NODE2242,datanode
192.168.1.14:22217:NODE2281,datanode
192.168.1.14:22218:NODE2282,datanode
~                                      </code></pre><p class="- topic/p p">API 中启用高可用，配置要切换的节点见如下所示 sites 字符串变量：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>String[]  sites={"192.168.1.12:22217", "192.168.1.12:22218", "192.168.1.13:22217", "192.168.1.13:22218", "192.168.1.14:22217", "192.168.1.14:22218"}
s.connect(host="192.168.1.12", port=21117, userid="admin", password="123456", highAvailability=True, highAvailabilitySites=sites)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title47" id="622-测试步骤"><h4 class="- topic/title title topictitle4" id="ariaid-title47">6.2.2. 测试步骤</h4><div class="- topic/body body"><p class="- topic/p p">测试步骤参考如下：</p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="622-测试步骤__entry__1">序号</th><th class="- topic/entry entry colsep-0 rowsep-0" id="622-测试步骤__entry__2">测试步骤</th><th class="- topic/entry entry colsep-0 rowsep-0" id="622-测试步骤__entry__3">预期结果</th><th class="- topic/entry entry colsep-0 rowsep-0" id="622-测试步骤__entry__4">是否符合预期</th><th class="- topic/entry entry colsep-0 rowsep-0" id="622-测试步骤__entry__5">原因</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">启动集群的所有节点</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">所有都节点正常能启动，浏览器打开 controller 面板，显示 leader 为 controller1（若不为 controller1，多次重启使其为 controller1）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5">Raft 组中只有一个 Leader，其他都是 Follower</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">API 连接节点，创建 1000 个分区的分布式表并开始持续读写，前 1000 次每次同时向每个已存在分区和一个新分区添加一组数据并读取总行数，之后每次随机向分区写入共 10000 条数据</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">API 成功连接到 controller1 的数据节点，创建数据表并开始读写，正确打印总行数，副本存储在不同节点上</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">3</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">在前 1000 次读写时，关闭正在读写的 NODE1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">API 成功连接到 NODE2241，继续开始读写，写入的新分区副本不存在 NODE1 上</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5">使用 API 与 DolphinDB 的数据节点交互时，如果连接的数据节点宕机，API 会先尝试重连，若重连失败会自动切换连接到集群中其他可用的数据节点，继续执行未完成的任务。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">4</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">前 1000 次内重启 NODE1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">NODE1 上的副本恢复。新的分区副本可以放在 NODE1 里</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5">副本之间保持强一致性，只要数据库存在一个副本，就可以恢复</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">5</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">一段时间后，前 1000 次内关闭 controller1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">leader 切换到 controller2（或 controller3，后面步骤假设为 controller2），数据停顿几秒后继续读写，不影响 NODE1 和 NODE2 使用</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5">由于数据节点和代理节点正常，因此还可以正常读写，但是由于采用 Raft 协议，Raft 组会立即选举出新的 Leader 来提供元数据服务，因此 leader 变成 controller2</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">6</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">重启 controller1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">对数据读写没有影响，leader 仍然是 controller2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">7</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">一段时间后关闭 controller2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">leader 切换回 controller1，数据停顿几秒后继续读写</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5">同 5</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">8</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">重启 controller2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">对数据读写没有影响，leader 仍然是 controller1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">9</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">关闭 NODE1 和 NODE2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">节点切换到 NODE2281，继续读写</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5">由于在不同机器上存储数据副本，即使一台服务器节点失效，访问其他机器上的副本也可以数据服务</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">关闭 controller1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">leader 切换到 controller2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">11</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">打开 NODE1 和 NODE2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">leader 不变，NODE1 和 NODE2 上数据恢复</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">12</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">重启 controller1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">leader 不变，数据读写没有影响</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__1">13</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__2">长时间持续的数据读写后，重复以上步骤</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__3">结果相同</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__4">符合</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="622-测试步骤__entry__5"> </td></tr></tbody></table></div><p class="- topic/p p">示例 Java API 代码<a class="- topic/xref xref" href="script/testHaCluster.java">下载</a>。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title48" id="63-跨机房容灾"><h3 class="- topic/title title topictitle3" id="ariaid-title48">6.3. 跨机房容灾</h3><div class="- topic/body body"><p class="- topic/p p">跨机房异步容灾组网架构如下图：</p><br/><img class="- topic/image image" src="images/iotExam/asynDisasterRecovery.PNG" alt="asynDisasterRecovery"/><br/><p class="- topic/p p">主备系统部署方案：</p><ol class="- topic/ol ol"><li class="- topic/li li">主备系统分别部署在两个不同的机房，配置相同，流数据表以及 DFS 数据库参数配置一致，主系统、备系统都保存所有的历史数据；流数据表为键值流数据表，该表的主键不允许包含重复值。</li><li class="- topic/li li">正常情况下，数据源写入主系统流数据表；备系统从主系统订阅流数据。</li><li class="- topic/li li">读数据库数据的客户端程序启动时，配置主备两个 IP 地址和端口组，启动时优先连接主系统，当主系统宕机时，自动切换到备系统读取数据。</li><li class="- topic/li li">主系统宕机后，数据源写入备系统。备系统停止从主系统订阅流数据，备系统变为主系统。</li></ol><p class="- topic/p p">原主系统宕机后系统恢复流程：</p><ol class="- topic/ol ol"><li class="- topic/li li">检测到主系统在运行，将自己降为备系统。</li><li class="- topic/li li">从主系统订阅流数据，以同步数据。</li><li class="- topic/li li">同步完数据后，再主备切换。</li></ol></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title49" id="64-数据备份和恢复"><h3 class="- topic/title title topictitle3" id="ariaid-title49">6.4. 数据备份和恢复</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title50" id="641-数据备份"><h4 class="- topic/title title topictitle4" id="ariaid-title50">6.4.1. 数据备份</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供了<code class="+ topic/ph pr-d/codeph ph codeph">backup</code>函数对分布式数据库进行备份。备份是以分区为单位进行的，可对指定数据表的部分或全部分区进行备份，支持全量备份与增量备份。</p><p class="- topic/p p">备份需要指定存放备份文件的路径 backupDir 与数据（用 SQL 语句表示）。备份后，系统会在<code class="+ topic/ph pr-d/codeph ph codeph">&lt;backupDir&gt;/&lt;dbName&gt;/&lt;tbName&gt;</code>目录下生成元数据文件_metaData.bin 和数据文件.bin，每个分区备份为一个数据文件。</p><p class="- topic/p p">例如备份 2020.09.01 到 2020.09.03 这三天的数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>backup(backupDir="/hdd/hdd1/backup/"+today().format("yyyyMMdd"),sqlObj=&lt;select * from loadTable("dfs://svmDemo","sensors") where datetime between 2020.09.01T00:00:00 : 2020.09.03T23:59:59 &gt;,force=false,parallel=true)</code></pre><p class="- topic/p p">备份后，登录服务器，用 tree 命令列出目录的内容如下。从中可以看到，备份目录下根据数据库名和表名生成了 2 层子目录 svmDemo/sensors，在其下还有 1500 个分区数据文件和 1 个元数据文件_metaData：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>[dolphindb@cnserver3 ~]$ tree /hdd/hdd1/backup/2020.09.20  -L 3
/hdd/hdd1/backup/2020.09.20
└── svmDemo
    └── sensors
        ├── 001f4f62-7a7c-ecbc-a74c-edbfe071c358
        ├── 0023a6f3-84d6-8fa0-354b-8b97b4024e9a
        ├── 004c4795-3f7d-a3be-ec45-06089ab723ef
        ├── dolphindb.lock
        ├── e0363761-7f9a-5fa5-8f4a-c0cfff1749a6
        ...
        ├── fec45f79-8163-a587-644d-2f260a9e358e
        └── _metaData

2 directories, 1502 files
</code></pre><p class="- topic/p p">若要每天备份，可用定时作业来实现，下面的例子每天 00:05:00 备份前一天的数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>login(`admin,`123456)
scheduleJob(`backupJob, "backupDB", backup{"/hdd/hdd1/backupDemo/"+(today()-1).format("yyyyMMdd"),&lt;select * from loadTable("dfs://svmDemo","sensors") where datetime between datetime(today()-1) : (today().datetime()-1) &gt;,false,true}, 00:05m, today(), 2030.12.31, 'D');</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title51" id="642-数据恢复"><h4 class="- topic/title title topictitle4" id="ariaid-title51">6.4.2. 数据恢复</h4><div class="- topic/body body"><p class="- topic/p p">DolphinD 提供两种数据恢复的方法：</p><ul class="- topic/ul ul"><li class="- topic/li li">使用<code class="+ topic/ph pr-d/codeph ph codeph">migrate</code>函数</li><li class="- topic/li li">使用<code class="+ topic/ph pr-d/codeph ph codeph">restore</code>函数</li></ul><p class="- topic/p p">两者的主要区别为：</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">migrate</code>函数以表为单位恢复，可以批量恢复多个表的全部数据，而<code class="+ topic/ph pr-d/codeph ph codeph">restore</code>函数以分区为单位恢复，每次恢复一个表中部分或全部分区的数据。</li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">migrate</code>函数无需用户创建新数据库，系统会自动创建新数据库，而<code class="+ topic/ph pr-d/codeph ph codeph">restore</code>需要用户先建库建表。</li></ul><p class="- topic/p p">下面的例子恢复 2020 年 9 月份的数据到原表，其中备份文件是上一小节的定时作业按天生成：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>day=2020.01.01
for(i in 1:31){
	path="/hdd/hdd1/backupDemo/"+temporalFormat(day, "yyyyMMdd") + "/";
	day=datetimeAdd(day,1,`d)
	if(!exists(path)) continue;
	print "restoring " + path;
	restore(backupDir=path,dbPath="dfs://svmDemo",tableName="sensors",partition="%",force=true);
}</code></pre><p class="- topic/p p">下面的例子把 2020 年 9 月份的数据恢复到一个新的数据库 dfs://db1 和表 sensors，其中先用<code class="+ topic/ph pr-d/codeph ph codeph">migrate</code>恢复第一天的数据，然后用<code class="+ topic/ph pr-d/codeph ph codeph">migrate</code>把剩余备份数据恢复到临时表，再导入 sensors：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>
migrate(backupDir="/hdd/hdd1/backupDemo/20200901/",backupDBPath="dfs://svmDemo",backupTableName="sensors",newDBPath="dfs://db1",newTableName="sensors")
day=2020.09.02
newTable=loadTable("dfs://db1","sensors")
for(i in 2:31){
	path="/hdd/hdd1/backupDemo/"+temporalFormat(day, "yyyyMMdd") + "/";
	day=datetimeAdd(day,1,`d)
	if(!exists(path)) continue;
	print "restoring " + path;
	t=migrate(backupDir=path,backupDBPath="dfs://svmDemo",backupTableName="sensors",newDBPath="dfs://db1",newTableName="tmp") 
	if(t['success'][0]==false){
		print t['errorMsg'][0]
		continue
	}
	newTable.append!(select * from loadTable("dfs://db1","tmp") where datetime between datetime(day-1) : (day.datetime()-1) &gt; )
	database("dfs://db1").dropTable("tmp")
}
</code></pre></div></article></article></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C" data-tocid="1-快速体验">1. 快速体验</a><ul><li class="topic-item"><a href="#11-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E5%8D%95%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1" data-tocid="11-安装部署单节点服务">1.1. 安装部署单节点服务</a></li><li class="topic-item"><a href="#12-%E6%B5%8B%E8%AF%95-gui-%E5%92%8C-web-%E8%BF%9E%E6%8E%A5" data-tocid="12-测试-gui-和-web-连接">1.2. 测试 GUI 和 Web 连接</a><ul><li class="topic-item"><a href="#121-gui-%E8%BF%9E%E6%8E%A5" data-tocid="121-gui-连接">1.2.1. GUI 连接</a></li><li class="topic-item"><a href="#122-web-%E8%BF%9E%E6%8E%A5" data-tocid="122-web-连接">1.2.2. Web 连接</a></li></ul></li><li class="topic-item"><a href="#13-%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E5%BB%BA%E5%BA%93%E5%BB%BA%E8%A1%A8" data-tocid="13-使用脚本建库建表">1.3. 使用脚本建库建表</a></li><li class="topic-item"><a href="#14-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5" data-tocid="14-数据库增删改查">1.4. 数据库增删改查</a></li><li class="topic-item"><a href="#15-grafana-%E8%BF%9E%E6%8E%A5-dolphindb" data-tocid="15-grafana-连接-dolphindb">1.5. Grafana 连接 DolphinDB</a><ul><li class="topic-item"><a href="#151-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE" data-tocid="151-安装配置">1.5.1. 安装配置</a></li><li class="topic-item"><a href="#152-%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE" data-tocid="152-显示数据">1.5.2. 显示数据</a></li></ul></li><li class="topic-item"><a href="#16-dolphindb-%E4%B8%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%82%E5%90%8C%E7%82%B9%E5%B0%8F%E7%BB%93" data-tocid="16-dolphindb-与其他数据库异同点小结">1.6. DolphinDB 与其他数据库异同点小结</a></li></ul></li><li class="topic-item"><a href="#2-%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%B5%8B%E8%AF%95" data-tocid="2-分布式数据库设计和测试">2. 分布式数据库设计和测试</a><ul><li class="topic-item"><a href="#21-dolphindb-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E" data-tocid="21-dolphindb-存储引擎">2.1. DolphinDB 存储引擎</a></li><li class="topic-item"><a href="#22-%E5%8D%95%E5%80%BC%E6%A8%A1%E5%9E%8B" data-tocid="22-单值模型">2.2. 单值模型</a></li><li class="topic-item"><a href="#23-%E5%A4%9A%E5%80%BC%E6%A8%A1%E5%9E%8B" data-tocid="23-多值模型">2.3. 多值模型</a></li><li class="topic-item"><a href="#24-%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE" data-tocid="24-使用脚本生成测试数据">2.4. 使用脚本生成测试数据</a></li></ul></li><li class="topic-item"><a href="#3-%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2" data-tocid="3-历史数据查询">3. 历史数据查询</a><ul><li class="topic-item"><a href="#31-%E8%B6%8B%E5%8A%BF%E6%9F%A5%E8%AF%A2" data-tocid="31-趋势查询">3.1. 趋势查询</a></li><li class="topic-item"><a href="#32-%E5%AF%B9%E6%AF%94%E6%9F%A5%E8%AF%A2" data-tocid="32-对比查询">3.2. 对比查询</a></li><li class="topic-item"><a href="#33-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2-top-n" data-tocid="33-分组查询-top-n">3.3. 分组查询 top N</a></li><li class="topic-item"><a href="#34-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2" data-tocid="34-关联查询">3.4. 关联查询</a></li><li class="topic-item"><a href="#35-%E9%99%8D%E7%B2%BE%E5%BA%A6" data-tocid="35-降精度">3.5. 降精度</a></li><li class="topic-item"><a href="#36-%E6%8F%92%E5%80%BC%E6%9F%A5%E8%AF%A2" data-tocid="36-插值查询">3.6. 插值查询</a></li><li class="topic-item"><a href="#37-%E5%8E%BB%E9%87%8D" data-tocid="37-去重">3.7. 去重</a></li><li class="topic-item"><a href="#38-%E5%87%BD%E6%95%B0%E8%A7%86%E5%9B%BE" data-tocid="38-函数视图">3.8. 函数视图</a></li><li class="topic-item"><a href="#39-api-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE" data-tocid="39-api-查询数据">3.9. API 查询数据</a></li></ul></li><li class="topic-item"><a href="#4-%E7%94%9F%E4%BA%A7%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5" data-tocid="4-生产数据写入">4. 生产数据写入</a><ul><li class="topic-item"><a href="#41-java-api" data-tocid="41-java-api">4.1. Java API</a></li><li class="topic-item"><a href="#42-c-api" data-tocid="42-c-api">4.2. C# API</a></li><li class="topic-item"><a href="#43-python-api" data-tocid="43-python-api">4.3. Python API</a></li><li class="topic-item"><a href="#44-c-api" data-tocid="44-c-api">4.4. C++ API</a></li><li class="topic-item"><a href="#45-%E6%8F%90%E5%8D%87%E5%86%99%E5%85%A5%E6%80%A7%E8%83%BD" data-tocid="45-提升写入性能">4.5. 提升写入性能</a></li><li class="topic-item"><a href="#46-%E6%8F%90%E5%8D%87%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9%E6%AF%94" data-tocid="46-提升数据压缩比">4.6. 提升数据压缩比</a></li></ul></li><li class="topic-item"><a href="#5-%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%92%8C%E6%B5%81%E8%AE%A1%E7%AE%97" data-tocid="5-实时数据和流计算">5. 实时数据和流计算</a><ul><li class="topic-item"><a href="#51-%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E6%B5%81%E6%95%B0%E6%8D%AE%E8%A1%A8" data-tocid="51-数据写入流数据表">5.1. 数据写入流数据表</a></li><li class="topic-item"><a href="#52-api-%E5%86%99%E5%85%A5" data-tocid="52-api-写入">5.2. API 写入</a></li><li class="topic-item"><a href="#53-%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E8%AE%A1%E7%AE%97%E5%BC%95%E6%93%8E" data-tocid="53-使用内置计算引擎">5.3. 使用内置计算引擎</a><ul><li class="topic-item"><a href="#531-%E6%97%B6%E5%BA%8F%E8%81%9A%E5%90%88%E5%BC%95%E6%93%8E%E6%AF%8F%E7%A7%92%E9%92%9F%E8%AE%A1%E7%AE%97%E9%A3%8E%E6%9C%BA%E8%BF%87%E5%8E%BB-5-%E5%88%86%E9%92%9F%E7%9A%84%E5%AE%9E%E6%97%B6%E8%BD%AC%E6%95%B0%E5%9D%87%E5%80%BC%E6%9C%80%E5%A4%A7%E5%80%BC%E6%9C%80%E5%B0%8F%E5%80%BC%E4%B8%8E%E6%96%B9%E5%B7%AE" data-tocid="531-时序聚合引擎每秒钟计算风机过去-5-分钟的实时转数均值最大值最小值与方差">5.3.1. 时序聚合引擎：每秒钟计算风机过去 5 分钟的实时转数均值、最大值、最小值与方差。</a></li><li class="topic-item"><a href="#532-%E6%A8%AA%E6%88%AA%E9%9D%A2%E8%81%9A%E5%90%88%E5%BC%95%E6%93%8E%E8%AE%A1%E7%AE%97%E5%BD%93%E5%89%8D%E6%89%80%E6%9C%89%E9%A3%8E%E6%9C%BA%E7%9A%84%E5%B9%B3%E5%9D%87%E8%BD%AC%E9%80%9F%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E8%BD%AC%E9%80%9F%E5%B7%AE" data-tocid="532-横截面聚合引擎计算当前所有风机的平均转速与最大最小转速差">5.3.2. 横截面聚合引擎：计算当前所有风机的平均转速与最大最小转速差。</a></li></ul></li><li class="topic-item"><a href="#54-%E5%BC%82%E5%B8%B8%E6%A3%80%E6%B5%8B%E5%BC%95%E6%93%8E%E5%AE%9E%E6%97%B6%E8%BD%AC%E9%80%9F%E8%B6%85%E5%87%BA-10%E6%88%96%E4%BD%8E%E4%BA%8E-01%E4%BB%A5%E5%8F%8A%E8%BD%AC%E9%80%9F%E5%B7%AE%E8%B6%85%E5%87%BA-02-%E6%97%B6%E8%BE%93%E5%87%BA%E5%BC%82%E5%B8%B8%E4%BF%A1%E5%8F%B7" data-tocid="54-异常检测引擎实时转速超出-10或低于-01以及转速差超出-02-时输出异常信号">5.4. 异常检测引擎：实时转速超出 10，或低于 0.1，以及转速差超出 0.2 时，输出异常信号。</a></li><li class="topic-item"><a href="#55-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A1%E7%AE%97%E5%BC%95%E6%93%8E" data-tocid="55-自定义计算引擎">5.5. 自定义计算引擎</a></li></ul></li><li class="topic-item"><a href="#6-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%B5%8B%E8%AF%95" data-tocid="6-高可用测试">6. 高可用测试</a><ul><li class="topic-item"><a href="#61-%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8%E6%B5%8B%E8%AF%95" data-tocid="61-数据高可用测试">6.1. 数据高可用测试</a></li><li class="topic-item"><a href="#62-%E5%85%83%E6%95%B0%E6%8D%AE%E9%AB%98%E5%8F%AF%E7%94%A8%E6%B5%8B%E8%AF%95" data-tocid="62-元数据高可用测试">6.2. 元数据高可用测试</a><ul><li class="topic-item"><a href="#621-%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2" data-tocid="621-环境部署">6.2.1. 环境部署</a></li><li class="topic-item"><a href="#622-%E6%B5%8B%E8%AF%95%E6%AD%A5%E9%AA%A4" data-tocid="622-测试步骤">6.2.2. 测试步骤</a></li></ul></li><li class="topic-item"><a href="#63-%E8%B7%A8%E6%9C%BA%E6%88%BF%E5%AE%B9%E7%81%BE" data-tocid="63-跨机房容灾">6.3. 跨机房容灾</a></li><li class="topic-item"><a href="#64-%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D" data-tocid="64-数据备份和恢复">6.4. 数据备份和恢复</a><ul><li class="topic-item"><a href="#641-%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD" data-tocid="641-数据备份">6.4.1. 数据备份</a></li><li class="topic-item"><a href="#642-%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D" data-tocid="642-数据恢复">6.4.2. 数据恢复</a></li></ul></li></ul></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>