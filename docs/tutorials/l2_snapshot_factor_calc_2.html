<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="因子挖掘是量化交易的基础。近年来，Python 是很多研究员进行数据分析和因子挖掘的主流工具。但是通过 Python 挖掘的有效因子在投产时，通常需要由 QUANT 团队的研究员将代码提交给 IT 团队，IT 团队用 C++ 代码转写后部署到生产环境，以满足实盘低延时的要求。这种做法虽然通过维护两套系统解决了产研一体化的问题，但开发周期较长，成本也相对较高。 ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践"/><title>快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ..?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;快速搭建-level-2-快照数据流批一体因子计算平台最佳实践&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;因子挖掘是量化交易的基础。近年来，Python 是很多研究员进行数据分析和因子挖掘的主流工具。但是通过 Python 挖掘的有效因子在投产时，通常需要由 QUANT 团队的研究员将代码提交给 IT 团队，IT 团队用 C++ 代码转写后部署到生产环境，以满足实盘低延时的要求。这种做法虽然通过维护两套系统解决了产研一体化的问题，但开发周期较长，成本也相对较高。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;量化金融是一个高度市场化、多方机构高度博弈的领域，因子的有效时间会随着博弈程度的加剧而缩短。如何使用更高效的工具和流程，更快地找到新的有效因子并投产部署到实盘交易，是每一个交易团队必须面对的问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程旨在指导用户基于 DolphinDB 快速搭建一个方便、快捷、扩展性好和兼容性强的流批一体因子计算平台原型，提供基于快照数据计算分钟因子和进一步加工分钟因子为复杂因子的功能。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;因子业务开发人员无需理解 DolphinDB 流计算框架的底层架构，仅需根据业务因子计算逻辑编写函数表达式，然后调度因子计算平台的计算接口，便可完成因子计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;基于这一平台，开发人员无需再转写代码，因子投研和生产只需一套系统、一种脚本即可无缝切换，极大降低了开发运维成本，提高了因子投产的全流程效率。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:114;149:86&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-概述&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;1. 概述&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在基于 Level-2 快照数据做实时分钟因子加工的时候，比如实时做 K 线，常常会面临以下几个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;以机器时间还是事件时间作为窗口关闭的信号？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;如果使用事件时间作为窗口关闭的信号，如何保证及时关闭不活跃股票的计算窗口？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;如果使用事件时间作为窗口关闭的信号，如何保证及时关闭 11:30（午间休市）、14:57（连续竞价结束）的计算窗口 ？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;计算时窗口边界的开闭是左闭右开还是左开右闭？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;计算输出结果的时间是计算窗口起始时间还是结束时间？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;如果在某个计算窗口内，分组内没有数据，如何用前值或者指定值填充？&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在基于分钟因子进一步加工有状态的复杂因子的时候，比如实时计算 MACD、RSI 等，常常会面临以下几个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;计算因子是有状态的：不仅与当前的多个指标有关，而且与多个指标的历史状态相关，如何开发有状态的算子？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;有状态的算子如何实现增量计算，提高计算效率？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在一次响应计算过程中，如果计算 1000 个因子，这 1000 个因子依赖一个共同的中间变量，如何避免重复计算？&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB 内置的时间序列流计算引擎可以满足 Level-2 快照数据实时分钟因子计算，响应式状态流计算引擎可以满足分钟因子进一步加工有状态的复杂因子的计算。上述问题会在本教程中逐一解答。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-level-2-快照数据流批一体因子计算平台&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;2. Level-2 快照数据流批一体因子计算平台&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-因子计算平台业务使用流程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;2.1. 因子计算平台业务使用流程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;按照本教程部署完基于 DolphinDB 搭建的因子计算平台后，基于历史数据的因子开发阶段的调试流程如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/snapshot_factor_1.png&#34; xtrc=&#34;image:1;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;1693&#34; dita-ot:image-height=&#34;488&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;因子业务开发人员只需要在 DolphinDB 提供的集成开发环境中编写因子计算的函数表达式，然后调用因子计算平台的计算接口就可以完成调试。如果编写因子符合 DolphinDB 的语法，就可以成功执行并返回计算结果。如果编写因子不符合 DolphinDB 的语法，就会报错中断。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在已经开发了一定数量的因子后，需要在生产环境部署实时计算业务，部署流程如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/snapshot_factor_2.png&#34; xtrc=&#34;image:2;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;1693&#34; dita-ot:image-height=&#34;647&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;因子业务开发人员只需通过客户端调用封装好的实时因子计算服务执行函数，便可以完成部署。执行完以后，DolphinDB server 会出现该流计算服务的入口，是一个表对象，可以通过 DolphinDB 提供的实时数据接入工具来接入数据。同时也会自动创建流计算服务的出口，也是一个表对象，存储计算结果。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-因子计算平台框架&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;2.2. 因子计算平台框架&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例 Level-2 快照数据流批一体因子计算平台的架构如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/snapshot_factor_3.png&#34; xtrc=&#34;image:3;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;1693&#34; dita-ot:image-height=&#34;1397&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;主要包括以下功能模块&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;实时数据低延时接入功能模块&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;57:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;57:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB API 实时数据写入接口：C++ API, Java API 等&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;58:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB 实时行情接入插件：amdQuote, Insight, NSQ 等&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;59:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB 消息中间件订阅插件：Kafka, zmq, MQTT 等&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;历史数据回放功能模块：因子开发阶段的调试和因子回测都需要基于历史数据，DolphinDB 提供了单表和多表的严格按照时序的控速回放功能，能够便捷高效地把已经存储在 DolphinDB 数据库中的历史数据回放成流。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;内置流计算引擎功能模块：DolphinDB 根据各种时序数据流式计算场景，开发了多个流计算引擎。本教程中，对快照数据做滚动窗口的聚合计算（计算生成不同分钟频的因子）使用了时间序列聚合流计算引擎，进一步加工成复杂因子用了响应式状态流计算引擎。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;62:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;集成开发环境功能模块：因子业务开发人员可以把 DolphinDB GUI 和 DolphinDB Vscode 作为集成开发环境，进行因子表达式代码的开发和调试。同时可以通过各种语言的 DolphinDB API 与 DolphinDB server 进行交互，进行任务的调度和作业的执行。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;低延时消息总线发布模块：DolphinDB 提供了对接各种消息队列中间件的插件，可以把实时计算结果推送到 Kafka, zmq, RabbitMQ, MQTT 等。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-因子计算平台的计算能力&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;2.3. 因子计算平台的计算能力&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例 Level-2 快照数据流批一体因子计算平台拥有计算下述两类因子的能力：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;（1）&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;69:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第一类：基于快照数据计算分钟因子&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第一类因子是指直接对快照数据，做指定窗口大小的滚动窗口聚合计算，比如任意分钟的 K 线等聚合指标计算。第一类因子使用了 DolphinDB 内置的时间序列引擎（createTimeSeriesEngine），具体教程可参考&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/c/createTimeSeriesEngine.dita&#34; xtrc=&#34;xref:1;71:112&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;时间序列引擎（createTimeSeriesEngine）&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;（2）&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;73:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第二类：进一步加工分钟因子为复杂因子&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第二类因子是指对第一类因子做进一步加工，做步长为1行、窗口为 n 行或者指定时间的滑动窗口计算，比如 EMA、RSI 等有状态因子的计算。第二类因子使用了 DolphinDB 内置的流计算引擎（createReactiveStateEngine），具体教程可参考&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/c/createReactiveStateEngine.dita&#34; xtrc=&#34;xref:2;75:132&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;响应式状态引擎（createReactiveStateEngine）&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-用户二次开发自定义因子表达式&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;2.4. 用户二次开发自定义因子表达式&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;241-自定义分钟因子表达式&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;2.4.1. 自定义分钟因子表达式&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第一类因子是指直接对快照数据，做指定窗口大小的滚动窗口聚合计算，用了 DolphinDB 内置的时间序列引擎。时间序列引擎对以下聚合计算算子进行了优化，实现了增量计算，显著提升了性能：corr, covar, first, last, max, med, min, percentile, quantile, std, var, sum, sum2, sum3, sum4, wavg, wsum, count, firstNot, ifirstNot, lastNot, ilastNot, imax, imin, nunique, prod, sem, mode, searchK。所以，如果分钟因子可以直接用 DolphinDB 内置聚合算子表达，就可以实现增量计算。如果分钟因子复杂程度较高，无法直接用 DolphinDB 内置聚合算子直接表达，那么就需要用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;81:385&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;defg&lt;/codeph&gt; 函数声明自定义聚合计算函数来表达。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;下面我们以分钟 K 线计算和指定窗口内的买卖压力指标计算为例，说明增量计算的因子表达式编写方式和非增量计算的因子表达式编写方式。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;增量计算因子表达式&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;def High(){ return &#34;max(LastPx)&#34; }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;函数名 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;92:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;High&lt;/codeph&gt; 对应因子名称，表示分钟 K 线的最高价，业务上的计算逻辑是对计算窗口内发生的所有价格求最大值，可以用 DolphinDB 内置的聚合算子 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;92:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;max&lt;/codeph&gt; 直接表达，所以用字符串 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;92:99&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;max(LastPx)&lt;/codeph&gt; 直接表示，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;92:118&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;LastPx&lt;/codeph&gt; 表示最新成交价格。因子计算平台会自动解析字符串 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;92:151&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;max(LastPx)&lt;/codeph&gt; 为元代码的格式 &amp;lt;max(LastPx)&amp;gt;，并传入时间序列引擎。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;同理，分钟 K 线的开盘价、收盘价和最低价可以这样表示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;def Open(){ return &#34;first(LastPx)&#34; }&lt;/codeblock&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;def Close(){ return &#34;last(LastPx)&#34; }&lt;/codeblock&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;def Low(){ return &#34;min(LastPx)&#34; }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;非增量计算因子表达式&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;116:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;defg Press(BidPrice0,BidPrice1,BidPrice2,BidPrice3,BidPrice4,BidPrice5,BidPrice6,BidPrice7,BidPrice8,BidPrice9,BidOrderQty0,BidOrderQty1,BidOrderQty2,BidOrderQty3,BidOrderQty4,BidOrderQty5,BidOrderQty6,BidOrderQty7,BidOrderQty8,BidOrderQty9,OfferPrice0,OfferPrice1,OfferPrice2,OfferPrice3,OfferPrice4,OfferPrice5,OfferPrice6,OfferPrice7,OfferPrice8,OfferPrice9,OfferOrderQty0,OfferOrderQty1,OfferOrderQty2,OfferOrderQty3,OfferOrderQty4,OfferOrderQty5,OfferOrderQty6,OfferOrderQty7,OfferOrderQty8,OfferOrderQty9){ bidPrice = matrix(BidPrice0,BidPrice1,BidPrice2,BidPrice3,BidPrice4,BidPrice5,BidPrice6,BidPrice7,BidPrice8,BidPrice9) bidQty = matrix(BidOrderQty0,BidOrderQty1,BidOrderQty2,BidOrderQty3,BidOrderQty4,BidOrderQty5,BidOrderQty6,BidOrderQty7,BidOrderQty8,BidOrderQty9) offerPrice = matrix(OfferPrice0,OfferPrice1,OfferPrice2,OfferPrice3,OfferPrice4,OfferPrice5,OfferPrice6,OfferPrice7,OfferPrice8,OfferPrice9) offerQty = matrix(OfferOrderQty0,OfferOrderQty1,OfferOrderQty2,OfferOrderQty3,OfferOrderQty4,OfferOrderQty5,OfferOrderQty6,OfferOrderQty7,OfferOrderQty8,OfferOrderQty9) wap = (bidPrice[0]*offerQty[0] + offerPrice[0]*bidQty[0])\(bidQty[0]+offerQty[0]) bidw=(1.0\(bidPrice-wap)) bidw=bidw\(bidw.rowSum()) offerw=(1.0\(offerPrice-wap)) offerw=offerw\(offerw.rowSum()) press = log((bidQty*bidw).rowSum())-log((offerQty*offerw).rowSum()) return avg(press) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;函数名 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;131:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;Press&lt;/codeph&gt; 对应因子名，表示买卖压力指标，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;131:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;BidPrice&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;131:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;BidOrderQty&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;131:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;OfferPrice&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;131:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;OfferOrderQty&lt;/codeph&gt; 表示买卖方向的十档量价，其函数表达式如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/2_4.png&#34; xtrc=&#34;image:4;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;531&#34; dita-ot:image-height=&#34;58&#34;/&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/2_5.png&#34; xtrc=&#34;image:5;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;316&#34; dita-ot:image-height=&#34;262&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;该因子的表达式复杂度较高，无法直接用 DolphinDB 内置的聚合算子表示，需要用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;137:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;defg&lt;/codeph&gt; 函数声明自定义聚合计算函数来表达。因子计算平台会自动解析聚合函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;137:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;Press&lt;/codeph&gt; 为元代码的格式 &amp;lt;Press()&amp;gt;，并传入时间序列引擎。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;242-自定义复杂因子表达式&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;2.4.2. 自定义复杂因子表达式&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第二类因子是指对第一类因子做进一步加工，做步长为1行、窗口为 n 行或者指定时间的滑动窗口计算，用了 DolphinDB 内置的响应式状态引擎。状态算子计算时需要用到历史状态。如果每一次计算都使用全量数据，性能不佳。状态函数的优化，也就是增量方式的流式实现非常关键。下列状态函数在 DolphinDB 的响应式状态引擎中的实现均得到了优化：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;累计窗口函数：cumavg, cumsum, cumprod, cumcount, cummin, cummax, cumvar, cumvarp, cumstd, cumstdp, cumcorr, cumcovar, cumbeta, cumwsum, cumwavg&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;滑动窗口函数：ema, mavg, msum, mcount, mprod, mvar, mvarp, mstd, mstdp, mskew, mkurtosis, mmin, mmax, mimin, mimax, mmed, mpercentile, mrank, mcorr, mcovar, mbeta, mwsum, mwavg, mslr&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;序列相关函数：deltas, ratios, ffill, move, prev, iterate, ewmMean, ewmVar, ewmStd, ewmCovar, ewmCorr&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;上述函数除了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;147:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;mslr&lt;/codeph&gt; 返回两个值以外，其余函数均只有一个返回值。在后续的版本中，DolphinDB 将允许用户用插件来开发自己的状态函数，注册后即可在状态引擎中使用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;下面我们以进一步加工分钟收盘价为 MACD 为例：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;@state def MACD(Close, SHORT_ = 12, LONG_ = 26, M = 9) { DIF = ewmMean(Close, span = SHORT_, adjust = false) - ewmMean(Close, span = LONG_, adjust = false) DEA = ewmMean(DIF, span = M, adjust = false) MACD = (DIF - DEA) * 2 return round(DIF, 3), round(DEA, 3), round(MACD, 3) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;函数名 MACD 对应因子名，Close 是指分钟收盘价，必须包括在时间序列聚合引擎的输出结果中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在定义复杂因子表达式的时候，如果定义的函数是有状态的，即当前行返回值基于之前行的数据，则需要在定义函数前用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;163:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;@state&lt;/codeph&gt; 声明。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-部署和因子开发&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;3. 部署和因子开发&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-因子计算平台部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;3.1. 因子计算平台部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第一步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;把本教程功能模块代码导入本地集成开发环境（DolphinDB GUI），功能模块源码见附录 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;171:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;SnapshotFactorCalculationPlatform&lt;/i&gt;。导入的目录结构必须严格按照下图所示结构：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_1.png&#34; xtrc=&#34;image:6;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;476&#34; dita-ot:image-height=&#34;283&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第二步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;右击 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;177:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;SnapshotFactorCalculationPlatform&lt;/i&gt; 目录，把本地模块代码同步到 DolphinDB server 端。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_2.png&#34; xtrc=&#34;image:7;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;506&#34; dita-ot:image-height=&#34;555&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第三步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;183:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码进行功能验证&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad /** 计算服务部署传参 testConfig.dos 是示例 Json 配置文件 parallel 指定计算的并行度 */ jsonPath = &#34;./modules/DolphinDBModules/SnapshotFactorCalculationPlatform/testConfig.dos&#34; parallel = 2 // 执行计算服务部署函数 loadJsonConfig(jsonPath, parallel)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;198:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;执行成功后，可以在 DolphinDB GUI 的右下角变量栏看到流计算相应的入口和出口的表变量：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_3.png&#34; xtrc=&#34;image:8;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;265&#34; dita-ot:image-height=&#34;171&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;202:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;此时，只需要把实时数据或者库内历史数据注入到入口 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;202:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;snapshotStream&lt;/codeph&gt; 中，就会在出口（结果表）中看到相应的输出。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-第一类分钟因子开发和调试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;3.2. 第一类分钟因子开发和调试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第一步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;208:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;208:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;SnapshotFactorCalculationPlatform&lt;/i&gt; 模块的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;208:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;Factor1&lt;/i&gt; 目录定义第一类分钟因子的表达式，按照“因子计算平台部署”部署完因子计算平台后，内置了如下分钟因子，以调试 Close 和 Press 为例：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_4.png&#34; xtrc=&#34;image:9;210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;319&#34; dita-ot:image-height=&#34;287&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;定义完新的因子表达式后，手动把修改后的模块文件同步到 DolphinDB server，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_5.png&#34; xtrc=&#34;image:10;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;479&#34; dita-ot:image-height=&#34;473&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第二步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;218:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码，生成 Json 格式的配置文件：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonGetFileString // 第一类分钟因子配置参数 FactorLevel1 = `Close`Press`Close`Press isInc = `true`false`true`false barMinutesLevel1 = 1 1 5 5 useSystemTime = `false`false`false`false // 指定存储 Json 配置文件的路径 jsonPath = &#34;./test.json&#34; JsonFileString = JsonGetFileString(FactorLevel1, isInc, barMinutesLevel1, useSystemTime) saveTextFile(JsonFileString, jsonPath)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;代码说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;236:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;236:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt;：指定需要计算的分钟因子名称，必须在 step1 中定义，并同步到 DolphinDB server。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;238:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;238:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;isInc&lt;/codeph&gt;：与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;238:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt; 的长度相同，表示计算的分钟因子是否需要按照增量计算解析，“true” 表示计算因子按照增量计算函数解析，“false” 表示计算因子按照非增量计算函数解析。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;240:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;240:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;barMinutesLevel1&lt;/codeph&gt;：与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;240:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt; 的长度相同，表示计算的分钟因子的频率，单位是“分”。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;242:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;242:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;useSystemTime&lt;/codeph&gt;：与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;242:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt; 的长度相同，表示计算的分钟因子的窗口关闭方式，“true” 表示用机器时间触发窗口，“false” 表示用事件时间触发窗口。同一个频率的计算因子窗口关闭方式必须一致。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;244:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;执行完毕后，会在 DolphinDB server 部署目录生成一个 Json 格式的配置文件 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;244:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;test.json&lt;/i&gt;，内容如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;246:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;[{&#34;factor&#34;: &#34;Close&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 1, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;Press&#34;, &#34;isInc&#34;: false, &#34;barMinute&#34;: 1, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;Close&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 5, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;Press&#34;, &#34;isInc&#34;: false, &#34;barMinute&#34;: 5, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}]&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第三步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;252:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;252:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码，部署计算服务：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;// 初始化流计算环境 use DolphinDBModules::ops clearAllStreamEnv() go // 执行计算服务部署函数 use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad jsonPath = &#34;./test.json&#34; parallel = 1 loadJsonConfig(jsonPath, parallel)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;266:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;注意，ops 功能模块中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;266:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;clearAllStreamEnv()&lt;/codeph&gt; 函数会把当前节点的所有订阅、引擎和共享表都会清除，所以在多人协作开发的环境中使用时需要注意。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;268:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;268:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第四步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;270:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;把测试的 csv 数据文件放到 DolphinDB server 端服务器的指定位置，例如本教程放在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:9;270:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv&lt;/i&gt;，测试的 csv 数据可在教程附录下载。然后在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:10;270:156&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码，把 csv 数据按照流的方式回放进来：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;use DolphinDBModules::SnapshotFactorCalculationPlatform::snapshotReplay csvPath = &#34;/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv&#34; snapshotCsvReplayJob(csvPath, snapshotStream)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;此时可以在 DolphinDB GUI 中执行函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;278:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;now()&lt;/codeph&gt;，起到刷新客户端的效果，可以看到右下角变量栏的结果表不断地在更新，查看结果表中的数据，以 1 分钟计算结果表为例，具体内容如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_6.png&#34; xtrc=&#34;image:11;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;332&#34; dita-ot:image-height=&#34;252&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-第二类复杂因子开发和调试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;3.3. 第二类复杂因子开发和调试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第一步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;286:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:11;286:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;SnapshotFactorCalculationPlatform&lt;/i&gt; 模块的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:12;286:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;Factor2&lt;/i&gt; 目录定义第二类复杂因子的表达式，按照 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#因子计算平台部署&#34; xtrc=&#34;xref:3;286:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;?ditaot usertext?&gt;因子计算平台部署&lt;/xref&gt; 部署完因子计算平台后，内置了如下复杂因子，以调试 RSI 和 MACD 为例：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_7.png&#34; xtrc=&#34;image:12;288:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;331&#34; dita-ot:image-height=&#34;291&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;定义完新的因子表达式后，手动把修改后的模块文件同步到 DolphinDB server。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第二步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:13;294:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码，生成 Json 格式的配置文件：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;296:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonGetFileString // 第一类分钟因子配置参数 FactorLevel1 = `Close`Press`Close`Press isInc = `true`false`true`false barMinutesLevel1 = 1 1 5 5 useSystemTime = `false`false`false`false // 第二类复杂因子配置参数 FactorLevel2 = `RSI`MACD`RSI`MACD barMinutesLevel2 = [[1, 1], [1], [5], [5]] colNameLevel2 = [`RSI, `DIF`DEA`MACD, `RSI, `DIF`DEA`MACD] paramsName = [`N, `SHORT_`LONG_`M, `N,`SHORT_`LONG_`M] paramsValue = [[[24], [30]], [[18, 30, 10]], [[24]], [[9, 25, 6]], [[12, 26, 9]]] // 指定存储 Json 配置文件的路径 jsonPath = &#34;./test.json&#34; JsonFileString = JsonGetFileString(FactorLevel1, isInc, barMinutesLevel1, useSystemTime, FactorLevel2, barMinutesLevel2, colNameLevel2, paramsName, paramsValue) saveTextFile(JsonFileString, jsonPath)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;代码说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;320:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;320:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel2&lt;/codeph&gt;：指定需要计算的复杂因子名称，必须在 step1 中定义，并同步到 DolphinDB server。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;322:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;322:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;barMinutesLevel2&lt;/codeph&gt;：与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;322:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt; 的长度相同，例子中第一个元素 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;322:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;[1, 1]&lt;/codeph&gt; 表示对 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;322:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel2[0]&lt;/codeph&gt;（RSI ）做两个 1 分钟频率的计算，其窗口大小通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;322:112&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;paramsValue&lt;/codeph&gt; 配置。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;324:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;324:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;colNameLevel2&lt;/codeph&gt;：与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;324:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt; 的长度相同，表示因子计算函数输出的列名。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;326:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;326:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;326:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;paramsName&lt;/codeph&gt;：与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;326:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt; 的长度相同，表示因子计算函数的参数名字。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;328:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;328:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;paramsValue&lt;/codeph&gt;：与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:37;328:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;FactorLevel1&lt;/codeph&gt; 的长度相同，与 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:38;328:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;barMinutesLevel2&lt;/codeph&gt; 对应，如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:39;328:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;[[24], [30]]&lt;/codeph&gt; 对应 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:40;328:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;barMinutesLevel2[0]&lt;/codeph&gt;，即 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:41;328:108&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;[1, 1]&lt;/codeph&gt;，表示对 RSI 做两个 1 分钟频率的计算，其窗口大小分别是 24 和 30。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;执行完毕后，会在 DolphinDB server 部署目录生成一个 Json 格式的配置文件 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:14;330:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;test.json&lt;/i&gt;，内容如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;[{&#34;factor&#34;: &#34;Close&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 1, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;High&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 1, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;Low&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 1, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;Close&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 5, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;High&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 5, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;Low&#34;, &#34;isInc&#34;: true, &#34;barMinute&#34;: 5, &#34;level&#34;: 1, &#34;useSystemTime&#34;: false}, {&#34;factor&#34;: &#34;RSI&#34;, &#34;level&#34;: 2, &#34;colName&#34;: `R_1, &#34;barMinute&#34;: 1, &#34;N&#34;: 24}, {&#34;factor&#34;: &#34;RSI&#34;, &#34;level&#34;: 2, &#34;colName&#34;: `R_2, &#34;barMinute&#34;: 1, &#34;N&#34;: 30}, {&#34;factor&#34;: &#34;MACD&#34;, &#34;level&#34;: 2, &#34;colName&#34;: `DIF_1`DEA_1`MACD_1, &#34;barMinute&#34;: 1, &#34;SHORT_&#34;: 18, &#34;LONG_&#34;: 30, &#34;M&#34;: 10}, {&#34;factor&#34;: &#34;RSI&#34;, &#34;level&#34;: 2, &#34;colName&#34;: `R_1, &#34;barMinute&#34;: 5, &#34;N&#34;: 24}, {&#34;factor&#34;: &#34;MACD&#34;, &#34;level&#34;: 2, &#34;colName&#34;: `DIF_1`DEA_1`MACD_1, &#34;barMinute&#34;: 5, &#34;SHORT_&#34;: 9, &#34;LONG_&#34;: 25, &#34;M&#34;: 6}]&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第三步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:15;338:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码，部署计算服务：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;339:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;// 初始化流计算环境 use DolphinDBModules::ops clearAllStreamEnv() go // 执行计算服务部署函数 use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad jsonPath = &#34;./test.json&#34; parallel = 1 loadJsonConfig(jsonPath, parallel)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;351:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;注意，ops 功能模块中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:42;351:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;clearAllStreamEnv()&lt;/codeph&gt; 函数会把当前节点的所有订阅、引擎和共享表都会清除，所以在多人协作开发的环境中使用时需要注意。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;353:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;353:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第四步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;355:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;把测试的 csv 数据文件放到 DolphinDB server 端服务器的指定位置，例如本教程放在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:16;355:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv&lt;/i&gt;，测试的 csv 数据可在教程附录下载。然后在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:17;355:156&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码，把 csv 数据按照流的方式回放进来：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;use DolphinDBModules::SnapshotFactorCalculationPlatform::snapshotReplay csvPath = &#34;/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv&#34; snapshotCsvReplayJob(csvPath, snapshotStream)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;此时可以在 DolphinDB GUI 中执行函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:43;362:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;now()&lt;/codeph&gt;，起到刷新客户端的效果，可以看到右下角变量栏的结果表不断地在更新，查看结果表中的数据，以 1 分钟复杂因子计算结果表为例，具体内容如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_8.png&#34; xtrc=&#34;image:13;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;727&#34; dita-ot:image-height=&#34;219&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;366:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:44;366:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;CostTime&lt;/codeph&gt; 表示单次响应的计算耗时，单位是微秒。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;34-python-客户端调度任务和订阅结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;3.4. Python 客户端调度任务和订阅结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;370:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程用 jupyter 环境调试，具体测试软件版本如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;372:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;372:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB server 版本：2.00.9.2&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;373:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB Python API 版本：1.30.21.1&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;374:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;Python 的版本：3.7.6&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第一步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;378:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;导入依赖的 Python 包，并与 DolphinDB server 建立连接：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;379:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;import dolphindb as ddb import numpy as np s = ddb.session(host=&#34;localhost&#34;, port=8892, userid='admin', password='123456',enablePickle=False)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;386:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;386:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第二步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;388:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;部署因子计算服务：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;jsonPath = &#34;./modules/DolphinDBModules/SnapshotFactorCalculationPlatform/testConfig.dos&#34; parallel = 1 scripts = &#34;&#34;&#34; use DolphinDBModules::ops clearAllStreamEnv() go use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad loadJsonConfig(&#34;{0}&#34;, {1}) &#34;&#34;&#34;.format(jsonPath, parallel) s.run(scripts)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;402:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:45;402:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;jsonPath&lt;/codeph&gt; 路径是指 DolphinDB server 端的相对路径，是调试用的默认测试配置文件。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:19;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第三步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;执行数据回放服务：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;csvPath = &#34;/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv&#34; scripts = &#34;&#34;&#34; use DolphinDBModules::SnapshotFactorCalculationPlatform::snapshotReplay snapshotCsvReplayJob(&#34;{0}&#34;, snapshotStream) &#34;&#34;&#34;.format(csvPath) s.run(scripts)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;416:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:46;416:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;csvPath&lt;/codeph&gt; 路径是指 DolphinDB server 所在服务器的绝对路径，需要用户自己下载测试数据（见附录），并放到相应目录。例如，本教程测试环境数据文件所在路径是 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:18;416:90&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv&lt;/i&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;418:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:20;418:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第四步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;420:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;查询数据至 python 客户端：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;queryDate = &#34;2021.12.01&#34; SecurityID = &#34;600000&#34; scripts = &#34;&#34;&#34; select * from resultTable1Min where date(DateTime)={0}, SecurityID=&#34;{1}&#34; &#34;&#34;&#34;.format(queryDate, SecurityID) resultdf = s.run(scripts) resultdf&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;431:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:47;431:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;resultdf&lt;/codeph&gt; 的内容如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_9.png&#34; xtrc=&#34;image:14;433:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;980&#34; dita-ot:image-height=&#34;153&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:21;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;第五步&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;Python 客户端订阅 DolphinDB server 端的结果表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;438:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;s.enableStreaming(0) def handler(lst): print(lst) s.subscribe(host=&#34;localhost&#34;, port=8892, handler=handler, tableName=&#34;aggr1Min&#34;, actionName=&#34;sub1min&#34;, offset=0, msgAsTable=False, filter=np.array(['600010']))&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;此处 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:48;445:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;offset&lt;/codeph&gt; 设置为 0，表示从结果表的第一行数据开始订阅，订阅返回结果如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_10.png&#34; xtrc=&#34;image:15;447:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;954&#34; dita-ot:image-height=&#34;210&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;如果想取消订阅，可以执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;s.unsubscribe(host=&#34;localhost&#34;, port=8892,tableName=&#34;aggr1Min&#34;,actionName=&#34;sub1min&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;调试完毕后，建议手动关闭 Python 客户端会话：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;455:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;s.close()&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;其它语言的客户端，如 C++, Java 等，与 DolphinDB server 交互的方式与 Python 客户端相似，具体参考官方的教程文档即可。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;35-计算结果实时推送至-kafka&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;3.5. 计算结果实时推送至 Kafka&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB server 计算的结果，也可以实时推送到客户本地的低延时消息总线。本教程以推送至 Kafka 为例。开始调试下述功能的前提条件是在 Kafka 中创建好 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:49;463:89&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;aggr1Min&lt;/codeph&gt; 的 topic，同时 DolphinDB server 已经加载 Kafka 插件。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在 DolphinDB GUI 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:19;465:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;scripts&lt;/i&gt; 目录创建脚本文件，执行下述代码，把 1 分钟因子计算结果表中的数据推送至 Kafka：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;use DolphinDBModules::SnapshotFactorCalculationPlatform::resultToKafka producer = initKafkaProducer(&#34;localhost:9092&#34;) subscribeTable(tableName=&#34;aggr1Min&#34;, actionName=&#34;aggr1MinToKafka&#34;, offset=0, handler=aggr1MinToKafka{producer, &#34;aggr1Min&#34;}, msgAsTable=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;473:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;其中，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:50;473:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;initKafkaProducer(&#34;localhost:9092&#34;)&lt;/codeph&gt;是指 Kafka 服务的部署 IP 和 Port。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;475:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;Kafka 的消费者可以及时消费这些数据，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_11.png&#34; xtrc=&#34;image:16;477:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;1357&#34; dita-ot:image-height=&#34;69&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;479:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;从 DolphinDB server 的监控日志可以看到，计算结果推送至 Kafka 的平均耗时约 180 微秒：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level2_Snapshot_Factor_Calculation/3_12.png&#34; xtrc=&#34;image:17;481:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34; dita-ot:image-width=&#34;749&#34; dita-ot:image-height=&#34;67&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-流计算相关问题解答&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;4. 流计算相关问题解答&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-时间序列引擎计算分钟因子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;485:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;485:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;4.1. 时间序列引擎计算分钟因子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;485:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;487:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在基于 Level-2 快照数据做实时分钟因子加工的时候，比如实时做 K 线，常常会面临以下几个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;489:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;489:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:22;489:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;以机器时间还是事件时间作为窗口关闭的信号？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;491:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例因子计算平台默认以事件时间作为窗口关闭的触发信号。DolphinDB 内置的时间序列引擎的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:20;491:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;useSystemTime&lt;/i&gt; 参数可以控制以机器时间还是事件时间作为窗口关闭的信号。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;493:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;493:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:23;493:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;如果使用事件时间作为窗口关闭的信号，如何保证及时关闭不活跃股票的计算窗口？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例因子计算平台以股票为分组，不同组（即不同股票）之间没有触发窗口关闭的机制。DolphinDB 内置的时间序列引擎的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:21;495:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;forceTriggerTime&lt;/i&gt; 参数设置后，可以通过活跃股票的数据强制触发不活跃股票的计算窗口关闭。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;497:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;497:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:24;497:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;如果使用事件时间作为窗口关闭的信号，如何保证及时关闭 11:30（午间休市）、14:57（连续竞价结束）的计算窗口 ？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例因子计算平台没有配置该功能。DolphinDB 内置的日级时间序列引擎的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:22;499:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;forceTriggerSessionEndTime&lt;/i&gt; 参数可以满足上述场景。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;501:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;501:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:25;501:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;计算时窗口边界的开闭是左闭右开还是左开右闭？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;503:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例因子计算平台的规则是左闭右开。DolphinDB 内置的时间序列引擎的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:23;503:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;closed&lt;/i&gt; 参数可以控制窗口边界规则。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;505:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;505:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:26;505:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;计算输出结果的时间是计算窗口起始时间还是结束时间？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例因子计算平台的规则是计算窗口起始时间。DolphinDB 内置的时间序列引擎的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:24;507:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;useWindowStartTime&lt;/i&gt; 参数可以输出规则。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:27;509:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;如果在某个计算窗口内，分组内没有数据，如何用前值或者指定值填充？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;511:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;本教程示例因子计算平台没有设置填充规则。DolphinDB 内置的时间序列引擎的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:25;511:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;fill&lt;/i&gt; 参数可以指定填充规则，若（某个分组的）某个窗口无数据时，支持以下几种填充的规则：&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:26;511:89&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;none&lt;/i&gt; 表示不输出结果；&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:27;511:104&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;null&lt;/i&gt; 表示输出结果为 NULL；&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:28;511:124&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;ffill&lt;/i&gt; 表示输出上一个有数据的窗口的结果；具体数值，需要和对应的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:29;511:161&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;metrics&lt;/i&gt; 计算结果的类型保持一致。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-响应式状态引擎计算复杂因子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;4.2. 响应式状态引擎计算复杂因子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在基于分钟因子进一步加工有状态的复杂因子的时候，比如实时计算 MACD、RSI 等，常常会面临以下几个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;517:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;517:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:28;517:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;计算因子是有状态的：不仅与当前的多个指标有关，而且与多个指标的历史状态相关，如何开发有状态的算子？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;519:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB 内置了大量有状态的算子，并进行了增量计算的优化，具体已经内置算子如下所示。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;521:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;521:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;累计窗口函数：cumavg, cumsum, cumprod, cumcount, cummin, cummax, cumvar, cumvarp, cumstd, cumstdp, cumcorr, cumcovar, cumbeta, cumwsum, cumwavg。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:41;523:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;523:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;滑动窗口函数：ema, mavg, msum, mcount, mprod, mvar, mvarp, mstd, mstdp, mskew, mkurtosis, mmin, mmax, mimin, mimax, mmed, mpercentile, mrank, mcorr, mcovar, mbeta, mwsum, mwavg, mslr。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:42;525:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;525:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;序列相关函数：deltas, ratios, ffill, move, prev, iterate, ewmMean, ewmVar, ewmStd, ewmCovar, ewmCorr。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;527:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB 也允许用户用插件来开发自己的状态函数，注册后即可在状态引擎中使用。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:43;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:29;529:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;在一次响应计算过程中，如果计算 1000 个因子，这 1000 个因子依赖一个共同的中间变量，如何避免重复计算？&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:113;531:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;比如在上述因子计算平台的复杂因子计算处，有两个因子，分别叫 factor1 和 factor2，表达式如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;532:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;@state def factor1(price) { a = ema(price, 20) b = ema(price, 40) tmp = 1000 * (a-b)\(a+b) return ema(tmp , 10) - ema(tmp , 20) }&lt;/codeblock&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;542:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;@state def factor2(price) { a = ema(price, 20) b = ema(price, 40) tmp = 1000 * (a-b)\(a+b) return mavg(tmp, 10) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:114;551:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;可以看到，两个因子的计算都依赖了相同的中间变量 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:51;551:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;tmp&lt;/codeph&gt;。如果要避免中间变量 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:52;551:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;tmp&lt;/codeph&gt; 的重复计算，可以先定义一个 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:53;551:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;tmpFactor&lt;/codeph&gt; 的函数，表达式如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;552:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;@state def tmpFactor(price) { a = ema(price, 20) b = ema(price, 40) tmp = 1000 * (a-b)\(a+b) return tmp }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:115;562:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;然后把 factor1 和 factor2 的表达式用如下方式表示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;563:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;@state def factor1(price) { tmp = tmpFactor(price) return ema(tmp , 10) - ema(tmp , 20) }&lt;/codeblock&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:28;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;@state def factor2(price) { tmp = tmpFactor(price) return mavg(tmp, 10) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:116;579:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;DolphinDB 内置的响应式状态引擎在解析复杂因子的计算表达式的时候，就会自动避免不同因子相同中间变量的重复计算。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-路线图roadmap&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;581:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;581:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;5. 路线图(Roadmap)&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;581:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:18;583:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:44;583:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;进一步完善 Level-2 快照数据流批一体因子计算平台的功能模块：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:19;584:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:45;584:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;开放更多配置参数，解决基于 Level-2 快照数据做实时分钟因子加工的时候遇到的问题&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:46;585:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;补充 Factor1 和 Factor2 下的内置因子，丰富内置因子库&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:47;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;开发 Level-2 快照频率流批一体因子计算平台功能模块&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:48;587:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;开发 Level2 多数据源融合流批一体因子计算平台功能模块&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-附录&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;589:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;589:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;6. 附录&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;589:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:20;592:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:49;592:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;功能模块源码： &lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;script/Level2_Snapshot_Factor_Calculation/snapshot_func.zip&#34; xtrc=&#34;xref:4;592:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;?ditaot usertext?&gt;SnapshotFactorCalculationPlatform&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:50;593:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;按照教程，把module内容同步到server后，测试所需脚本： &lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;script/Level2_Snapshot_Factor_Calculation/test_scripts.zip&#34; xtrc=&#34;xref:5;593:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;?ditaot usertext?&gt;test_scripts.zip&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:51;594:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;测试的 csv 数据： &lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;https://www.dolphindb.cn/downloads/docs/Level2_Snapshot_Factor_Calculation.zip&#34; scope=&#34;external&#34; xtrc=&#34;xref:6;594:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_snapshot_factor_calc.md&#34;&gt;&lt;?ditaot usertext?&gt;Level2_Snapshot_Factor_Calculation&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/l2_snapshot_factor_calc.md"/><meta name="wh-out-relpath" content="tutorials/l2_snapshot_factor_calc_2.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/OHLC_2.html">金融场景案例</a></div></div></li><li class="active"><div class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践"><div class="title"><a href="../tutorials/l2_snapshot_factor_calc_2.html">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="k-线计算-d9713e102569" class="topicref" data-id="k-线计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="k-线计算-d9713e102569-link">K 线计算</a></div></div></li><li role="treeitem"><div data-tocid="使用-klinechart-展示-dolphindb-k-线-d9713e102615" class="topicref" data-id="使用-klinechart-展示-dolphindb-k-线" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/displaying_the_dolphindb_k-line_with_klinechart.html" id="使用-klinechart-展示-dolphindb-k-线-d9713e102615-link">使用 KLineChart 展示 DolphinDB K 线</a></div></div></li><li role="treeitem"><div data-tocid="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661" class="topicref" data-id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_HDF5_vs_DolphinDB.html" id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661-link">Python + HDF5 因子计算与 DolphinDB 一体化因子计算方案对比</a></div></div></li><li role="treeitem"><div data-tocid="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707" class="topicref" data-id="python--文件存储与-dolphindb-因子计算性能比较" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_VS_PythonFile_Storage.html" id="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707-link">Python + 文件存储与 DolphinDB 因子计算性能比较</a></div></div></li><li role="treeitem"><div data-tocid="python-parser-在金融量化分析场景的应用入门-d9713e102753" class="topicref" data-id="python-parser-在金融量化分析场景的应用入门" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/py_parser__quant_fin.html" id="python-parser-在金融量化分析场景的应用入门-d9713e102753-link">Python Parser 在金融量化分析场景的应用入门</a></div></div></li><li role="treeitem"><div data-tocid="处理-level-2-行情数据实例-d9713e102799" class="topicref" data-id="处理-level-2-行情数据实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_stk_data_proc_2.html" id="处理-level-2-行情数据实例-d9713e102799-link">处理 Level-2 行情数据实例</a></div></div></li><li role="treeitem"><div data-tocid="存储金融数据的分区方案最佳实践-d9713e102845" class="topicref" data-id="存储金融数据的分区方案最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_partitioned_storage.html" id="存储金融数据的分区方案最佳实践-d9713e102845-link">存储金融数据的分区方案最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="公募基金历史数据基础分析教程-d9713e102891" class="topicref" data-id="公募基金历史数据基础分析教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/public_fund_basic_analysis.html" id="公募基金历史数据基础分析教程-d9713e102891-link">公募基金历史数据基础分析教程</a></div></div></li><li role="treeitem"><div data-tocid="股票行情回放-d9713e102937" class="topicref" data-id="股票行情回放" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_market_replay_2.html" id="股票行情回放-d9713e102937-link">股票行情回放</a></div></div></li><li role="treeitem"><div data-tocid="搭建行情回放服务的最佳实践-d9713e102983" class="topicref" data-id="搭建行情回放服务的最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/appendices_market_replay_bp.html" id="搭建行情回放服务的最佳实践-d9713e102983-link">搭建行情回放服务的最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="国内股票行情数据导入实例-d9713e103029" class="topicref" data-id="国内股票行情数据导入实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stockdata_csv_import_demo.html" id="国内股票行情数据导入实例-d9713e103029-link">国内股票行情数据导入实例</a></div></div></li><li role="treeitem"><div data-tocid="基金份额参考价值-iopv-计算-d9713e103076" class="topicref" data-id="基金份额参考价值-iopv-计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_IOPV_2.html" id="基金份额参考价值-iopv-计算-d9713e103076-link">基金份额参考价值 IOPV 计算</a></div></div></li><li role="treeitem"><div data-tocid="基于快照行情的股票和基金-k-线合成-d9713e103122" class="topicref" data-id="基于快照行情的股票和基金-k-线合成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k.html" id="基于快照行情的股票和基金-k-线合成-d9713e103122-link">基于快照行情的股票和基金 K 线合成</a></div></div></li><li role="treeitem"><div data-tocid="计算基金日频因子-d9713e103168" class="topicref" data-id="计算基金日频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/fund_factor_contrasted_by_py.html" id="计算基金日频因子-d9713e103168-link">计算基金日频因子</a></div></div></li><li role="treeitem"><div data-tocid="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214" class="topicref" data-id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/orderBookSnapshotEngine.html" id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214-link">基于逐笔数据合成高频 Orderbook：DolphinDB Orderbook 引擎</a></div></div></li><li role="treeitem"><div data-tocid="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260" class="topicref" data-id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/LoadDataForPoc.html" id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260-link">金融 PoC 用户历史数据导入指导手册之股票 Level-2 逐笔篇</a></div></div></li><li role="treeitem"><div data-tocid="金融实时实际波动率预测-d9713e103306" class="topicref" data-id="金融实时实际波动率预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ml_volatility_2.html" id="金融实时实际波动率预测-d9713e103306-link">金融实时实际波动率预测</a></div></div></li><li role="treeitem"><div data-tocid="金融因子流式实现-d9713e103352" class="topicref" data-id="金融因子流式实现" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/str_comp_fin_quant_2.html" id="金融因子流式实现-d9713e103352-link">金融因子流式实现</a></div></div></li><li role="treeitem"><div data-tocid="开发股票波动率预测模型的-676-个输入特征-d9713e103398" class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/metacode_derived_features_2.html" id="开发股票波动率预测模型的-676-个输入特征-d9713e103398-link">开发股票波动率预测模型的 676 个输入特征</a></div></div></li><li role="treeitem" class="active"><div data-tocid="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444" class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_snapshot_factor_calc_2.html" id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444-link">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="量化金融范例-d9713e103490" class="topicref" data-id="量化金融范例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/quant_finance_examples.html" id="量化金融范例-d9713e103490-link">量化金融范例</a></div></div></li><li role="treeitem"><div data-tocid="流式计算中证-1000-指数主买主卖交易量-d9713e103536" class="topicref" data-id="流式计算中证-1000-指数主买主卖交易量" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/CSI_1000_2.html" id="流式计算中证-1000-指数主买主卖交易量-d9713e103536-link">流式计算中证 1000 指数主买/主卖交易量</a></div></div></li><li role="treeitem"><div data-tocid="深度不平衡买卖压力指标波动率计算-d9713e103583" class="topicref" data-id="深度不平衡买卖压力指标波动率计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/sql_performance_optimization_wap_di_rv.html" id="深度不平衡买卖压力指标波动率计算-d9713e103583-link">深度不平衡、买卖压力指标、波动率计算</a></div></div></li><li role="treeitem"><div data-tocid="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629" class="topicref" data-id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/insight_plugin_orderbook_engine_application.html" id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629-link">实时合成自定义频订单簿快照：DolphinDB INSIGHT 行情插件与订单簿引擎应用</a></div></div></li><li role="treeitem"><div data-tocid="实时计算分钟资金流-d9713e103675" class="topicref" data-id="实时计算分钟资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_order_by_order_2.html" id="实时计算分钟资金流-d9713e103675-link">实时计算分钟资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算高频因子-d9713e103721" class="topicref" data-id="实时计算高频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hf_factor_streaming_2.html" id="实时计算高频因子-d9713e103721-link">实时计算高频因子</a></div></div></li><li role="treeitem"><div data-tocid="实时计算日累计逐单资金流-d9713e103767" class="topicref" data-id="实时计算日累计逐单资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_daily_2.html" id="实时计算日累计逐单资金流-d9713e103767-link">实时计算日累计逐单资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算涨幅榜-d9713e103813" class="topicref" data-id="实时计算涨幅榜" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/rt_stk_price_inc_calc_2.html" id="实时计算涨幅榜-d9713e103813-link">实时计算涨幅榜</a></div></div></li><li role="treeitem"><div data-tocid="实时选取外汇行情多价源最优价-d9713e103859" class="topicref" data-id="实时选取外汇行情多价源最优价" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_price_selection.html" id="实时选取外汇行情多价源最优价-d9713e103859-link">实时选取外汇行情多价源最优价</a></div></div></li><li role="treeitem"><div data-tocid="外汇掉期估值计算-d9713e103905" class="topicref" data-id="外汇掉期估值计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/FxSwapValuation.html" id="外汇掉期估值计算-d9713e103905-link">外汇掉期估值计算</a></div></div></li><li role="treeitem"><div data-tocid="因子计算平台构建-d9713e103951" class="topicref" data-id="因子计算平台构建" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_Celery.html" id="因子计算平台构建-d9713e103951-link">因子计算平台构建</a></div></div></li><li role="treeitem"><div data-tocid="因子计算最佳实践-d9713e103997" class="topicref" data-id="因子计算最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_factor_calculation.html" id="因子计算最佳实践-d9713e103997-link">因子计算最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="mvo_tutorial-d9713e104043" class="topicref" data-id="mvo_tutorial" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/MVO.html" id="mvo_tutorial-d9713e104043-link">优化投资组合：DolphinDB 最优化求解系列函数应用指南</a></div></div></li><li role="treeitem"><div data-tocid="中高频多因子库存储最佳实践-d9713e104090" class="topicref" data-id="中高频多因子库存储最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_multi_factor.html" id="中高频多因子库存储最佳实践-d9713e104090-link">中高频多因子库存储最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136" class="topicref" data-id="alphalens-在-dolphindb-中的应用因子分析建模实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Practical_Factor_Analysis_Modeling.html" id="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136-link">Alphalens 在 DolphinDB 中的应用：因子分析建模实践</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-dolphinscheduler-的集成-d9713e104182" class="topicref" data-id="dolphindb-与-dolphinscheduler-的集成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="dolphindb-与-dolphinscheduler-的集成-d9713e104182-link">DolphinDB 与 DolphinScheduler 的集成</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-python-airflow-最佳实践-d9713e104228" class="topicref" data-id="dolphindb-与-python-airflow-最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_airflow.html" id="dolphindb-与-python-airflow-最佳实践-d9713e104228-link">DolphinDB 与 Python AirFlow 最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="gplearn-d9713e104274" class="topicref" data-id="gplearn" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/gplearn.html" id="gplearn-d9713e104274-link">Shark GPLearn 快速上手</a></div></div></li><li role="treeitem"><div data-tocid="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320" class="topicref" data-id="利用jit加速计算-etf-期权隐含波动率和希腊值" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/IV_Greeks_Calculation_for_ETF_Options_Using_JIT.html" id="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320-link">利用JIT加速计算 ETF 期权隐含波动率和希腊值</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366" class="topicref" data-id="基于-dolphindb-的-brinson-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/brinson.html" id="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366-link">基于 DolphinDB 的 Brinson 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412" class="topicref" data-id="基于-dolphindb-的-campisi-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/campisi.html" id="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412-link">基于 DolphinDB 的 Campisi 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="期货分钟频cta策略回测案例-d9713e104458" class="topicref" data-id="期货分钟频cta策略回测案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/futures_minute_frequency_cta_strategy_backtest_example.html" id="期货分钟频cta策略回测案例-d9713e104458-link">期货分钟频CTA策略回测案例</a></div></div></li><li role="treeitem"><div data-tocid="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504" class="topicref" data-id="exchdata-交易所历史股票数据自动化导入功能模块使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/exchdata_exchange_historical_stock_data_auto_import_module_tutorial.html" id="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504-link">ExchData 交易所历史股票数据自动化导入功能模块使用教程</a></div></div></li><li role="treeitem"><div data-tocid="ficc_func_uasge_and_performance-d9713e104550" class="topicref" data-id="ficc_func_uasge_and_performance" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_func_uasge_and_performance.html" id="ficc_func_uasge_and_performance-d9713e104550-link">FICC 固收系列函数使用示例及性能</a></div></div></li><li role="treeitem"><div data-tocid="title1-d9713e104597" class="topicref" data-id="title1" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_funcs_application.html" id="title1-d9713e104597-link">FICC 固收系列函数应用场景</a></div></div></li><li role="treeitem"><div data-tocid="最优化函数_socp_的使用及转化案例-d9713e104643" class="topicref" data-id="最优化函数_socp_的使用及转化案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/socp_usage_case.html" id="最优化函数_socp_的使用及转化案例-d9713e104643-link">最优化函数 socp 的使用及转化案例</a></div></div></li><li role="treeitem"><div data-tocid="k_line_calculation-d9713e104689" class="topicref" data-id="k_line_calculation" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k_line_calculation%20.html" id="k_line_calculation-d9713e104689-link">基于期货快照行情数据计算合约 K 线以及主连行情</a></div></div></li><li role="treeitem"><div data-tocid="backtest_introduction_usage-d9713e104735" class="topicref" data-id="backtest_introduction_usage" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backtest_introduction_usage.html" id="backtest_introduction_usage-d9713e104735-link">融资融券策略回测使用说明及回测案例</a></div></div></li><li role="treeitem"><div data-tocid="stock_backtest-d9713e104781" class="topicref" data-id="stock_backtest" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_backtest.html" id="stock_backtest-d9713e104781-link">股票中低频投资组合回测案例实现</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</h1><div class="- topic/body body"><p class="- topic/p p">因子挖掘是量化交易的基础。近年来，Python 是很多研究员进行数据分析和因子挖掘的主流工具。但是通过 Python 挖掘的有效因子在投产时，通常需要由 QUANT 团队的研究员将代码提交给 IT 团队，IT 团队用 C++ 代码转写后部署到生产环境，以满足实盘低延时的要求。这种做法虽然通过维护两套系统解决了产研一体化的问题，但开发周期较长，成本也相对较高。</p><p class="- topic/p p">量化金融是一个高度市场化、多方机构高度博弈的领域，因子的有效时间会随着博弈程度的加剧而缩短。如何使用更高效的工具和流程，更快地找到新的有效因子并投产部署到实盘交易，是每一个交易团队必须面对的问题。</p><p class="- topic/p p">本教程旨在指导用户基于 DolphinDB 快速搭建一个方便、快捷、扩展性好和兼容性强的流批一体因子计算平台原型，提供基于快照数据计算分钟因子和进一步加工分钟因子为复杂因子的功能。</p><p class="- topic/p p">因子业务开发人员无需理解 DolphinDB 流计算框架的底层架构，仅需根据业务因子计算逻辑编写函数表达式，然后调度因子计算平台的计算接口，便可完成因子计算。</p><p class="- topic/p p">基于这一平台，开发人员无需再转写代码，因子投研和生产只需一套系统、一种脚本即可无缝切换，极大降低了开发运维成本，提高了因子投产的全流程效率。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-概述"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 概述</h2><div class="- topic/body body"><p class="- topic/p p">在基于 Level-2 快照数据做实时分钟因子加工的时候，比如实时做 K 线，常常会面临以下几个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">以机器时间还是事件时间作为窗口关闭的信号？</li><li class="- topic/li li">如果使用事件时间作为窗口关闭的信号，如何保证及时关闭不活跃股票的计算窗口？</li><li class="- topic/li li">如果使用事件时间作为窗口关闭的信号，如何保证及时关闭 11:30（午间休市）、14:57（连续竞价结束）的计算窗口 ？</li><li class="- topic/li li">计算时窗口边界的开闭是左闭右开还是左开右闭？</li><li class="- topic/li li">计算输出结果的时间是计算窗口起始时间还是结束时间？</li><li class="- topic/li li">如果在某个计算窗口内，分组内没有数据，如何用前值或者指定值填充？</li></ul><p class="- topic/p p">在基于分钟因子进一步加工有状态的复杂因子的时候，比如实时计算 MACD、RSI 等，常常会面临以下几个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">计算因子是有状态的：不仅与当前的多个指标有关，而且与多个指标的历史状态相关，如何开发有状态的算子？</li><li class="- topic/li li">有状态的算子如何实现增量计算，提高计算效率？</li><li class="- topic/li li">在一次响应计算过程中，如果计算 1000 个因子，这 1000 个因子依赖一个共同的中间变量，如何避免重复计算？</li></ul><p class="- topic/p p">DolphinDB 内置的时间序列流计算引擎可以满足 Level-2 快照数据实时分钟因子计算，响应式状态流计算引擎可以满足分钟因子进一步加工有状态的复杂因子的计算。上述问题会在本教程中逐一解答。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-level-2-快照数据流批一体因子计算平台"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. Level-2 快照数据流批一体因子计算平台</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-因子计算平台业务使用流程"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1. 因子计算平台业务使用流程</h3><div class="- topic/body body"><p class="- topic/p p">按照本教程部署完基于 DolphinDB 搭建的因子计算平台后，基于历史数据的因子开发阶段的调试流程如下：</p><img class="- topic/image image" src="../stream/images/snapshot_factor_1.png"/><br/><p class="- topic/p p">因子业务开发人员只需要在 DolphinDB 提供的集成开发环境中编写因子计算的函数表达式，然后调用因子计算平台的计算接口就可以完成调试。如果编写因子符合 DolphinDB 的语法，就可以成功执行并返回计算结果。如果编写因子不符合 DolphinDB 的语法，就会报错中断。</p><p class="- topic/p p">在已经开发了一定数量的因子后，需要在生产环境部署实时计算业务，部署流程如下：</p><img class="- topic/image image" src="../stream/images/snapshot_factor_2.png"/><br/><p class="- topic/p p">因子业务开发人员只需通过客户端调用封装好的实时因子计算服务执行函数，便可以完成部署。执行完以后，DolphinDB server 会出现该流计算服务的入口，是一个表对象，可以通过 DolphinDB 提供的实时数据接入工具来接入数据。同时也会自动创建流计算服务的出口，也是一个表对象，存储计算结果。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="22-因子计算平台框架"><h3 class="- topic/title title topictitle3" id="ariaid-title5">2.2. 因子计算平台框架</h3><div class="- topic/body body"><p class="- topic/p p">本教程示例 Level-2 快照数据流批一体因子计算平台的架构如下图所示：</p><img class="- topic/image image" src="../stream/images/snapshot_factor_3.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">主要包括以下功能模块</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">实时数据低延时接入功能模块<ul class="- topic/ul ul"><li class="- topic/li li">DolphinDB API 实时数据写入接口：C++ API, Java API 等</li><li class="- topic/li li">DolphinDB 实时行情接入插件：amdQuote, Insight, NSQ 等</li><li class="- topic/li li">DolphinDB 消息中间件订阅插件：Kafka, zmq, MQTT 等</li></ul></li><li class="- topic/li li">历史数据回放功能模块：因子开发阶段的调试和因子回测都需要基于历史数据，DolphinDB 提供了单表和多表的严格按照时序的控速回放功能，能够便捷高效地把已经存储在 DolphinDB 数据库中的历史数据回放成流。</li><li class="- topic/li li">内置流计算引擎功能模块：DolphinDB 根据各种时序数据流式计算场景，开发了多个流计算引擎。本教程中，对快照数据做滚动窗口的聚合计算（计算生成不同分钟频的因子）使用了时间序列聚合流计算引擎，进一步加工成复杂因子用了响应式状态流计算引擎。</li><li class="- topic/li li">集成开发环境功能模块：因子业务开发人员可以把 DolphinDB GUI 和 DolphinDB Vscode 作为集成开发环境，进行因子表达式代码的开发和调试。同时可以通过各种语言的 DolphinDB API 与 DolphinDB server 进行交互，进行任务的调度和作业的执行。</li><li class="- topic/li li">低延时消息总线发布模块：DolphinDB 提供了对接各种消息队列中间件的插件，可以把实时计算结果推送到 Kafka, zmq, RabbitMQ, MQTT 等。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="23-因子计算平台的计算能力"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.3. 因子计算平台的计算能力</h3><div class="- topic/body body"><p class="- topic/p p">本教程示例 Level-2 快照数据流批一体因子计算平台拥有计算下述两类因子的能力：</p><p class="- topic/p p">（1）<strong class="+ topic/ph hi-d/b ph b">第一类：基于快照数据计算分钟因子</strong></p><p class="- topic/p p">第一类因子是指直接对快照数据，做指定窗口大小的滚动窗口聚合计算，比如任意分钟的 K 线等聚合指标计算。第一类因子使用了 DolphinDB 内置的时间序列引擎（createTimeSeriesEngine），具体教程可参考<a class="- topic/xref xref" href="../funcs/c/createTimeSeriesEngine.html">时间序列引擎（createTimeSeriesEngine）</a>。</p><p class="- topic/p p">（2）<strong class="+ topic/ph hi-d/b ph b">第二类：进一步加工分钟因子为复杂因子</strong></p><p class="- topic/p p">第二类因子是指对第一类因子做进一步加工，做步长为1行、窗口为 n 行或者指定时间的滑动窗口计算，比如 EMA、RSI 等有状态因子的计算。第二类因子使用了 DolphinDB 内置的流计算引擎（createReactiveStateEngine），具体教程可参考<a class="- topic/xref xref" href="../funcs/c/createReactiveStateEngine.html">响应式状态引擎（createReactiveStateEngine）</a>。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="24-用户二次开发自定义因子表达式"><h3 class="- topic/title title topictitle3" id="ariaid-title7">2.4. 用户二次开发自定义因子表达式</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title8" id="241-自定义分钟因子表达式"><h4 class="- topic/title title topictitle4" id="ariaid-title8">2.4.1. 自定义分钟因子表达式</h4><div class="- topic/body body"><p class="- topic/p p">第一类因子是指直接对快照数据，做指定窗口大小的滚动窗口聚合计算，用了 DolphinDB 内置的时间序列引擎。时间序列引擎对以下聚合计算算子进行了优化，实现了增量计算，显著提升了性能：corr, covar, first, last, max, med, min, percentile, quantile, std, var, sum, sum2, sum3, sum4, wavg, wsum, count, firstNot, ifirstNot, lastNot, ilastNot, imax, imin, nunique, prod, sem, mode, searchK。所以，如果分钟因子可以直接用 DolphinDB 内置聚合算子表达，就可以实现增量计算。如果分钟因子复杂程度较高，无法直接用 DolphinDB 内置聚合算子直接表达，那么就需要用 <code class="+ topic/ph pr-d/codeph ph codeph">defg</code> 函数声明自定义聚合计算函数来表达。</p><p class="- topic/p p">下面我们以分钟 K 线计算和指定窗口内的买卖压力指标计算为例，说明增量计算的因子表达式编写方式和非增量计算的因子表达式编写方式。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">增量计算因子表达式</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def High(){
	return "max(LastPx)"
}</code></pre><p class="- topic/p p">函数名 <code class="+ topic/ph pr-d/codeph ph codeph">High</code> 对应因子名称，表示分钟 K 线的最高价，业务上的计算逻辑是对计算窗口内发生的所有价格求最大值，可以用 DolphinDB 内置的聚合算子 <code class="+ topic/ph pr-d/codeph ph codeph">max</code> 直接表达，所以用字符串 <code class="+ topic/ph pr-d/codeph ph codeph">max(LastPx)</code> 直接表示，<code class="+ topic/ph pr-d/codeph ph codeph">LastPx</code> 表示最新成交价格。因子计算平台会自动解析字符串 <code class="+ topic/ph pr-d/codeph ph codeph">max(LastPx)</code> 为元代码的格式 &lt;max(LastPx)&gt;，并传入时间序列引擎。</p><p class="- topic/p p">同理，分钟 K 线的开盘价、收盘价和最低价可以这样表示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def Open(){
	return "first(LastPx)"
}</code></pre><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def Close(){
	return "last(LastPx)"
}</code></pre><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def Low(){
	return "min(LastPx)"
}</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">非增量计算因子表达式</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg Press(BidPrice0,BidPrice1,BidPrice2,BidPrice3,BidPrice4,BidPrice5,BidPrice6,BidPrice7,BidPrice8,BidPrice9,BidOrderQty0,BidOrderQty1,BidOrderQty2,BidOrderQty3,BidOrderQty4,BidOrderQty5,BidOrderQty6,BidOrderQty7,BidOrderQty8,BidOrderQty9,OfferPrice0,OfferPrice1,OfferPrice2,OfferPrice3,OfferPrice4,OfferPrice5,OfferPrice6,OfferPrice7,OfferPrice8,OfferPrice9,OfferOrderQty0,OfferOrderQty1,OfferOrderQty2,OfferOrderQty3,OfferOrderQty4,OfferOrderQty5,OfferOrderQty6,OfferOrderQty7,OfferOrderQty8,OfferOrderQty9){
	bidPrice = matrix(BidPrice0,BidPrice1,BidPrice2,BidPrice3,BidPrice4,BidPrice5,BidPrice6,BidPrice7,BidPrice8,BidPrice9)
	bidQty = matrix(BidOrderQty0,BidOrderQty1,BidOrderQty2,BidOrderQty3,BidOrderQty4,BidOrderQty5,BidOrderQty6,BidOrderQty7,BidOrderQty8,BidOrderQty9)
	offerPrice = matrix(OfferPrice0,OfferPrice1,OfferPrice2,OfferPrice3,OfferPrice4,OfferPrice5,OfferPrice6,OfferPrice7,OfferPrice8,OfferPrice9)
	offerQty = matrix(OfferOrderQty0,OfferOrderQty1,OfferOrderQty2,OfferOrderQty3,OfferOrderQty4,OfferOrderQty5,OfferOrderQty6,OfferOrderQty7,OfferOrderQty8,OfferOrderQty9)
	wap = (bidPrice[0]*offerQty[0] + offerPrice[0]*bidQty[0])\(bidQty[0]+offerQty[0])
	bidw=(1.0\(bidPrice-wap))
	bidw=bidw\(bidw.rowSum())
	offerw=(1.0\(offerPrice-wap))
	offerw=offerw\(offerw.rowSum())
	press = log((bidQty*bidw).rowSum())-log((offerQty*offerw).rowSum())
	return avg(press)
}</code></pre><p class="- topic/p p">函数名 <code class="+ topic/ph pr-d/codeph ph codeph">Press</code> 对应因子名，表示买卖压力指标，<code class="+ topic/ph pr-d/codeph ph codeph">BidPrice</code>, <code class="+ topic/ph pr-d/codeph ph codeph">BidOrderQty</code>, <code class="+ topic/ph pr-d/codeph ph codeph">OfferPrice</code>, <code class="+ topic/ph pr-d/codeph ph codeph">OfferOrderQty</code> 表示买卖方向的十档量价，其函数表达式如下：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/2_4.png"/><br/><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/2_5.png"/><br/><p class="- topic/p p">该因子的表达式复杂度较高，无法直接用 DolphinDB 内置的聚合算子表示，需要用 <code class="+ topic/ph pr-d/codeph ph codeph">defg</code> 函数声明自定义聚合计算函数来表达。因子计算平台会自动解析聚合函数 <code class="+ topic/ph pr-d/codeph ph codeph">Press</code> 为元代码的格式 &lt;Press()&gt;，并传入时间序列引擎。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title9" id="242-自定义复杂因子表达式"><h4 class="- topic/title title topictitle4" id="ariaid-title9">2.4.2. 自定义复杂因子表达式</h4><div class="- topic/body body"><p class="- topic/p p">第二类因子是指对第一类因子做进一步加工，做步长为1行、窗口为 n 行或者指定时间的滑动窗口计算，用了 DolphinDB 内置的响应式状态引擎。状态算子计算时需要用到历史状态。如果每一次计算都使用全量数据，性能不佳。状态函数的优化，也就是增量方式的流式实现非常关键。下列状态函数在 DolphinDB 的响应式状态引擎中的实现均得到了优化：</p><ul class="- topic/ul ul"><li class="- topic/li li">累计窗口函数：cumavg, cumsum, cumprod, cumcount, cummin, cummax, cumvar, cumvarp, cumstd, cumstdp, cumcorr, cumcovar, cumbeta, cumwsum, cumwavg</li><li class="- topic/li li">滑动窗口函数：ema, mavg, msum, mcount, mprod, mvar, mvarp, mstd, mstdp, mskew, mkurtosis, mmin, mmax, mimin, mimax, mmed, mpercentile, mrank, mcorr, mcovar, mbeta, mwsum, mwavg, mslr</li><li class="- topic/li li">序列相关函数：deltas, ratios, ffill, move, prev, iterate, ewmMean, ewmVar, ewmStd, ewmCovar, ewmCorr</li></ul><p class="- topic/p p">上述函数除了 <code class="+ topic/ph pr-d/codeph ph codeph">mslr</code> 返回两个值以外，其余函数均只有一个返回值。在后续的版本中，DolphinDB 将允许用户用插件来开发自己的状态函数，注册后即可在状态引擎中使用。</p><p class="- topic/p p">下面我们以进一步加工分钟收盘价为 MACD 为例：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def MACD(Close, SHORT_ = 12, LONG_ = 26, M = 9) {
	DIF = ewmMean(Close, span = SHORT_, adjust = false) - ewmMean(Close, span = LONG_, adjust = false)
	DEA = ewmMean(DIF, span = M, adjust = false)
	MACD = (DIF - DEA) * 2
	return round(DIF, 3), round(DEA, 3), round(MACD, 3)
}</code></pre><p class="- topic/p p">函数名 MACD 对应因子名，Close 是指分钟收盘价，必须包括在时间序列聚合引擎的输出结果中。</p><p class="- topic/p p">在定义复杂因子表达式的时候，如果定义的函数是有状态的，即当前行返回值基于之前行的数据，则需要在定义函数前用 <code class="+ topic/ph pr-d/codeph ph codeph">@state</code> 声明。</p></div></article></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title10" id="3-部署和因子开发"><h2 class="- topic/title title topictitle2" id="ariaid-title10">3. 部署和因子开发</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title11" id="31-因子计算平台部署"><h3 class="- topic/title title topictitle3" id="ariaid-title11">3.1. 因子计算平台部署</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步</strong></p><p class="- topic/p p">把本教程功能模块代码导入本地集成开发环境（DolphinDB GUI），功能模块源码见附录 <em class="+ topic/ph hi-d/i ph i">SnapshotFactorCalculationPlatform</em>。导入的目录结构必须严格按照下图所示结构：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_1.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步</strong></p><p class="- topic/p p">右击 <em class="+ topic/ph hi-d/i ph i">SnapshotFactorCalculationPlatform</em> 目录，把本地模块代码同步到 DolphinDB server 端。</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_2.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第三步</strong></p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码进行功能验证</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad

/**
计算服务部署传参
testConfig.dos 是示例 Json 配置文件
parallel 指定计算的并行度
 */
jsonPath = "./modules/DolphinDBModules/SnapshotFactorCalculationPlatform/testConfig.dos"
parallel = 2
// 执行计算服务部署函数
loadJsonConfig(jsonPath, parallel)</code></pre><p class="- topic/p p">执行成功后，可以在 DolphinDB GUI 的右下角变量栏看到流计算相应的入口和出口的表变量：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_3.png"/><br/><p class="- topic/p p">此时，只需要把实时数据或者库内历史数据注入到入口 <code class="+ topic/ph pr-d/codeph ph codeph">snapshotStream</code> 中，就会在出口（结果表）中看到相应的输出。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="32-第一类分钟因子开发和调试"><h3 class="- topic/title title topictitle3" id="ariaid-title12">3.2. 第一类分钟因子开发和调试</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步</strong></p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">SnapshotFactorCalculationPlatform</em> 模块的 <em class="+ topic/ph hi-d/i ph i">Factor1</em> 目录定义第一类分钟因子的表达式，按照“因子计算平台部署”部署完因子计算平台后，内置了如下分钟因子，以调试 Close 和 Press 为例：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_4.png"/><br/><p class="- topic/p p">定义完新的因子表达式后，手动把修改后的模块文件同步到 DolphinDB server，如下图所示：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_5.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步</strong></p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码，生成 Json 格式的配置文件：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonGetFileString

// 第一类分钟因子配置参数
FactorLevel1 = `Close`Press`Close`Press
isInc = `true`false`true`false
barMinutesLevel1 = 1 1 5 5
useSystemTime = `false`false`false`false
// 指定存储 Json 配置文件的路径
jsonPath = "./test.json"
JsonFileString = JsonGetFileString(FactorLevel1, isInc, barMinutesLevel1, useSystemTime)
saveTextFile(JsonFileString, jsonPath)</code></pre><p class="- topic/p p">代码说明：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code>：指定需要计算的分钟因子名称，必须在 step1 中定义，并同步到 DolphinDB server。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">isInc</code>：与 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code> 的长度相同，表示计算的分钟因子是否需要按照增量计算解析，“true” 表示计算因子按照增量计算函数解析，“false” 表示计算因子按照非增量计算函数解析。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">barMinutesLevel1</code>：与 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code> 的长度相同，表示计算的分钟因子的频率，单位是“分”。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">useSystemTime</code>：与 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code> 的长度相同，表示计算的分钟因子的窗口关闭方式，“true” 表示用机器时间触发窗口，“false” 表示用事件时间触发窗口。同一个频率的计算因子窗口关闭方式必须一致。</p></li></ul><p class="- topic/p p">执行完毕后，会在 DolphinDB server 部署目录生成一个 Json 格式的配置文件 <em class="+ topic/ph hi-d/i ph i">test.json</em>，内容如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>[{"factor": "Close", "isInc": true, "barMinute": 1, "level": 1, "useSystemTime": false}, {"factor": "Press", "isInc": false, "barMinute": 1, "level": 1, "useSystemTime": false}, {"factor": "Close", "isInc": true, "barMinute": 5, "level": 1, "useSystemTime": false}, {"factor": "Press", "isInc": false, "barMinute": 5, "level": 1, "useSystemTime": false}]</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第三步</strong></p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码，部署计算服务：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 初始化流计算环境
use DolphinDBModules::ops
clearAllStreamEnv()
go
// 执行计算服务部署函数
use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad
jsonPath = "./test.json"
parallel = 1
loadJsonConfig(jsonPath, parallel)</code></pre><p class="- topic/p p">注意，ops 功能模块中的 <code class="+ topic/ph pr-d/codeph ph codeph">clearAllStreamEnv()</code> 函数会把当前节点的所有订阅、引擎和共享表都会清除，所以在多人协作开发的环境中使用时需要注意。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第四步</strong></p><p class="- topic/p p">把测试的 csv 数据文件放到 DolphinDB server 端服务器的指定位置，例如本教程放在 <em class="+ topic/ph hi-d/i ph i">/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv</em>，测试的 csv 数据可在教程附录下载。然后在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码，把 csv 数据按照流的方式回放进来：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>use DolphinDBModules::SnapshotFactorCalculationPlatform::snapshotReplay
csvPath = "/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv"
snapshotCsvReplayJob(csvPath, snapshotStream)</code></pre><p class="- topic/p p">此时可以在 DolphinDB GUI 中执行函数 <code class="+ topic/ph pr-d/codeph ph codeph">now()</code>，起到刷新客户端的效果，可以看到右下角变量栏的结果表不断地在更新，查看结果表中的数据，以 1 分钟计算结果表为例，具体内容如下：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_6.png"/><br/></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title13" id="33-第二类复杂因子开发和调试"><h3 class="- topic/title title topictitle3" id="ariaid-title13">3.3. 第二类复杂因子开发和调试</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步</strong></p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">SnapshotFactorCalculationPlatform</em> 模块的 <em class="+ topic/ph hi-d/i ph i">Factor2</em> 目录定义第二类复杂因子的表达式，按照 <a class="- topic/xref xref" href="#%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2">因子计算平台部署</a> 部署完因子计算平台后，内置了如下复杂因子，以调试 RSI 和 MACD 为例：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_7.png"/><br/><p class="- topic/p p">定义完新的因子表达式后，手动把修改后的模块文件同步到 DolphinDB server。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步</strong></p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码，生成 Json 格式的配置文件：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonGetFileString

// 第一类分钟因子配置参数
FactorLevel1 = `Close`Press`Close`Press
isInc = `true`false`true`false
barMinutesLevel1 = 1 1 5 5
useSystemTime = `false`false`false`false

// 第二类复杂因子配置参数
FactorLevel2 = `RSI`MACD`RSI`MACD
barMinutesLevel2 = [[1, 1], [1], [5], [5]]
colNameLevel2 = [`RSI, `DIF`DEA`MACD, `RSI, `DIF`DEA`MACD]
paramsName = [`N, `SHORT_`LONG_`M, `N,`SHORT_`LONG_`M]
paramsValue = [[[24], [30]], [[18, 30, 10]], [[24]], [[9, 25, 6]], [[12, 26, 9]]]

// 指定存储 Json 配置文件的路径
jsonPath = "./test.json"
JsonFileString = JsonGetFileString(FactorLevel1, isInc, barMinutesLevel1, useSystemTime, FactorLevel2, barMinutesLevel2, colNameLevel2, paramsName, paramsValue)
saveTextFile(JsonFileString, jsonPath)</code></pre><p class="- topic/p p">代码说明：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel2</code>：指定需要计算的复杂因子名称，必须在 step1 中定义，并同步到 DolphinDB server。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">barMinutesLevel2</code>：与 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code> 的长度相同，例子中第一个元素 <code class="+ topic/ph pr-d/codeph ph codeph">[1, 1]</code> 表示对 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel2[0]</code>（RSI ）做两个 1 分钟频率的计算，其窗口大小通过 <code class="+ topic/ph pr-d/codeph ph codeph">paramsValue</code> 配置。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">colNameLevel2</code>：与 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code> 的长度相同，表示因子计算函数输出的列名。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">paramsName</code>：与 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code> 的长度相同，表示因子计算函数的参数名字。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">paramsValue</code>：与 <code class="+ topic/ph pr-d/codeph ph codeph">FactorLevel1</code> 的长度相同，与 <code class="+ topic/ph pr-d/codeph ph codeph">barMinutesLevel2</code> 对应，如 <code class="+ topic/ph pr-d/codeph ph codeph">[[24], [30]]</code> 对应 <code class="+ topic/ph pr-d/codeph ph codeph">barMinutesLevel2[0]</code>，即 <code class="+ topic/ph pr-d/codeph ph codeph">[1, 1]</code>，表示对 RSI 做两个 1 分钟频率的计算，其窗口大小分别是 24 和 30。</p></li></ul><p class="- topic/p p">执行完毕后，会在 DolphinDB server 部署目录生成一个 Json 格式的配置文件 <em class="+ topic/ph hi-d/i ph i">test.json</em>，内容如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>[{"factor": "Close", "isInc": true, "barMinute": 1, "level": 1, "useSystemTime": false}, {"factor": "High", "isInc": true, "barMinute": 1, "level": 1, "useSystemTime": false}, {"factor": "Low", "isInc": true, "barMinute": 1, "level": 1, "useSystemTime": false}, {"factor": "Close", "isInc": true, "barMinute": 5, "level": 1, "useSystemTime": false}, {"factor": "High", "isInc": true, "barMinute": 5, "level": 1, "useSystemTime": false}, {"factor": "Low", "isInc": true, "barMinute": 5, "level": 1, "useSystemTime": false}, {"factor": "RSI", "level": 2, "colName": `R_1, "barMinute": 1, "N": 24}, {"factor": "RSI", "level": 2, "colName": `R_2, "barMinute": 1, "N": 30}, {"factor": "MACD", "level": 2, "colName": `DIF_1`DEA_1`MACD_1, "barMinute": 1, "SHORT_": 18, "LONG_": 30, "M": 10}, {"factor": "RSI", "level": 2, "colName": `R_1, "barMinute": 5, "N": 24}, {"factor": "MACD", "level": 2, "colName": `DIF_1`DEA_1`MACD_1, "barMinute": 5, "SHORT_": 9, "LONG_": 25, "M": 6}]</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第三步</strong></p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码，部署计算服务：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 初始化流计算环境
use DolphinDBModules::ops
clearAllStreamEnv()
go
// 执行计算服务部署函数
use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad
jsonPath = "./test.json"
parallel = 1
loadJsonConfig(jsonPath, parallel)</code></pre><p class="- topic/p p">注意，ops 功能模块中的 <code class="+ topic/ph pr-d/codeph ph codeph">clearAllStreamEnv()</code> 函数会把当前节点的所有订阅、引擎和共享表都会清除，所以在多人协作开发的环境中使用时需要注意。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第四步</strong></p><p class="- topic/p p">把测试的 csv 数据文件放到 DolphinDB server 端服务器的指定位置，例如本教程放在 <em class="+ topic/ph hi-d/i ph i">/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv</em>，测试的 csv 数据可在教程附录下载。然后在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码，把 csv 数据按照流的方式回放进来：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>use DolphinDBModules::SnapshotFactorCalculationPlatform::snapshotReplay
csvPath = "/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv"
snapshotCsvReplayJob(csvPath, snapshotStream)</code></pre><p class="- topic/p p">此时可以在 DolphinDB GUI 中执行函数 <code class="+ topic/ph pr-d/codeph ph codeph">now()</code>，起到刷新客户端的效果，可以看到右下角变量栏的结果表不断地在更新，查看结果表中的数据，以 1 分钟复杂因子计算结果表为例，具体内容如下：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_8.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">CostTime</code> 表示单次响应的计算耗时，单位是微秒。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title14" id="34-python-客户端调度任务和订阅结果"><h3 class="- topic/title title topictitle3" id="ariaid-title14">3.4. Python 客户端调度任务和订阅结果</h3><div class="- topic/body body"><p class="- topic/p p">本教程用 jupyter 环境调试，具体测试软件版本如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">DolphinDB server 版本：2.00.9.2</li><li class="- topic/li li">DolphinDB Python API 版本：1.30.21.1</li><li class="- topic/li li">Python 的版本：3.7.6</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步</strong></p><p class="- topic/p p">导入依赖的 Python 包，并与 DolphinDB server 建立连接：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>import dolphindb as ddb
import numpy as np

s = ddb.session(host="localhost", port=8892, userid='admin', password='123456',enablePickle=False)</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步</strong></p><p class="- topic/p p">部署因子计算服务：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>jsonPath = "./modules/DolphinDBModules/SnapshotFactorCalculationPlatform/testConfig.dos"
parallel = 1
scripts = """
    use DolphinDBModules::ops
    clearAllStreamEnv()
    go
    use DolphinDBModules::SnapshotFactorCalculationPlatform::JsonConfig::JsonConfigLoad
    loadJsonConfig("{0}", {1})
""".format(jsonPath, parallel)
s.run(scripts)</code></pre><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">jsonPath</code> 路径是指 DolphinDB server 端的相对路径，是调试用的默认测试配置文件。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第三步</strong></p><p class="- topic/p p">执行数据回放服务：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>csvPath = "/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv"
scripts = """
    use DolphinDBModules::SnapshotFactorCalculationPlatform::snapshotReplay
    snapshotCsvReplayJob("{0}", snapshotStream)
""".format(csvPath)
s.run(scripts)</code></pre><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">csvPath</code> 路径是指 DolphinDB server 所在服务器的绝对路径，需要用户自己下载测试数据（见附录），并放到相应目录。例如，本教程测试环境数据文件所在路径是 <em class="+ topic/ph hi-d/i ph i">/hdd/hdd9/tutorials/SnapshotFactorCalculationPlatform/test.csv</em>。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第四步</strong></p><p class="- topic/p p">查询数据至 python 客户端：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>queryDate = "2021.12.01"
SecurityID = "600000"
scripts = """
    select * from resultTable1Min where date(DateTime)={0}, SecurityID="{1}"
""".format(queryDate, SecurityID)
resultdf = s.run(scripts)
resultdf</code></pre><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">resultdf</code> 的内容如下：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_9.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第五步</strong></p><p class="- topic/p p">Python 客户端订阅 DolphinDB server 端的结果表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>s.enableStreaming(0)
def handler(lst):
    print(lst)
s.subscribe(host="localhost", port=8892, handler=handler, tableName="aggr1Min", actionName="sub1min", offset=0, msgAsTable=False,  filter=np.array(['600010']))</code></pre><p class="- topic/p p">此处 <code class="+ topic/ph pr-d/codeph ph codeph">offset</code> 设置为 0，表示从结果表的第一行数据开始订阅，订阅返回结果如下：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_10.png"/><br/><p class="- topic/p p">如果想取消订阅，可以执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>s.unsubscribe(host="localhost", port=8892,tableName="aggr1Min",actionName="sub1min")</code></pre><p class="- topic/p p">调试完毕后，建议手动关闭 Python 客户端会话：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>s.close()</code></pre><p class="- topic/p p">其它语言的客户端，如 C++, Java 等，与 DolphinDB server 交互的方式与 Python 客户端相似，具体参考官方的教程文档即可。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title15" id="35-计算结果实时推送至-kafka"><h3 class="- topic/title title topictitle3" id="ariaid-title15">3.5. 计算结果实时推送至 Kafka</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB server 计算的结果，也可以实时推送到客户本地的低延时消息总线。本教程以推送至 Kafka 为例。开始调试下述功能的前提条件是在 Kafka 中创建好 <code class="+ topic/ph pr-d/codeph ph codeph">aggr1Min</code> 的 topic，同时 DolphinDB server 已经加载 Kafka 插件。</p><p class="- topic/p p">在 DolphinDB GUI 的 <em class="+ topic/ph hi-d/i ph i">scripts</em> 目录创建脚本文件，执行下述代码，把 1 分钟因子计算结果表中的数据推送至 Kafka：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>use DolphinDBModules::SnapshotFactorCalculationPlatform::resultToKafka

producer = initKafkaProducer("localhost:9092")
subscribeTable(tableName="aggr1Min", actionName="aggr1MinToKafka", offset=0, handler=aggr1MinToKafka{producer, "aggr1Min"}, msgAsTable=true)</code></pre><p class="- topic/p p">其中，<code class="+ topic/ph pr-d/codeph ph codeph">initKafkaProducer("localhost:9092")</code>是指 Kafka 服务的部署 IP 和 Port。</p><p class="- topic/p p">Kafka 的消费者可以及时消费这些数据，如下图所示：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_11.png"/><br/><p class="- topic/p p">从 DolphinDB server 的监控日志可以看到，计算结果推送至 Kafka 的平均耗时约 180 微秒：</p><img class="- topic/image image" src="images/Level2_Snapshot_Factor_Calculation/3_12.png"/><br/></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title16" id="4-流计算相关问题解答"><h2 class="- topic/title title topictitle2" id="ariaid-title16">4. 流计算相关问题解答</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title17" id="41-时间序列引擎计算分钟因子"><h3 class="- topic/title title topictitle3" id="ariaid-title17">4.1. 时间序列引擎计算分钟因子</h3><div class="- topic/body body"><p class="- topic/p p">在基于 Level-2 快照数据做实时分钟因子加工的时候，比如实时做 K 线，常常会面临以下几个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">以机器时间还是事件时间作为窗口关闭的信号？</strong></li></ul><p class="- topic/p p">本教程示例因子计算平台默认以事件时间作为窗口关闭的触发信号。DolphinDB 内置的时间序列引擎的 <em class="+ topic/ph hi-d/i ph i">useSystemTime</em> 参数可以控制以机器时间还是事件时间作为窗口关闭的信号。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">如果使用事件时间作为窗口关闭的信号，如何保证及时关闭不活跃股票的计算窗口？</strong></li></ul><p class="- topic/p p">本教程示例因子计算平台以股票为分组，不同组（即不同股票）之间没有触发窗口关闭的机制。DolphinDB 内置的时间序列引擎的 <em class="+ topic/ph hi-d/i ph i">forceTriggerTime</em> 参数设置后，可以通过活跃股票的数据强制触发不活跃股票的计算窗口关闭。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">如果使用事件时间作为窗口关闭的信号，如何保证及时关闭 11:30（午间休市）、14:57（连续竞价结束）的计算窗口 ？</strong></li></ul><p class="- topic/p p">本教程示例因子计算平台没有配置该功能。DolphinDB 内置的日级时间序列引擎的 <em class="+ topic/ph hi-d/i ph i">forceTriggerSessionEndTime</em> 参数可以满足上述场景。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">计算时窗口边界的开闭是左闭右开还是左开右闭？</strong></li></ul><p class="- topic/p p">本教程示例因子计算平台的规则是左闭右开。DolphinDB 内置的时间序列引擎的 <em class="+ topic/ph hi-d/i ph i">closed</em> 参数可以控制窗口边界规则。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">计算输出结果的时间是计算窗口起始时间还是结束时间？</strong></li></ul><p class="- topic/p p">本教程示例因子计算平台的规则是计算窗口起始时间。DolphinDB 内置的时间序列引擎的 <em class="+ topic/ph hi-d/i ph i">useWindowStartTime</em> 参数可以输出规则。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">如果在某个计算窗口内，分组内没有数据，如何用前值或者指定值填充？</strong></li></ul><p class="- topic/p p">本教程示例因子计算平台没有设置填充规则。DolphinDB 内置的时间序列引擎的 <em class="+ topic/ph hi-d/i ph i">fill</em> 参数可以指定填充规则，若（某个分组的）某个窗口无数据时，支持以下几种填充的规则：<em class="+ topic/ph hi-d/i ph i">none</em> 表示不输出结果；<em class="+ topic/ph hi-d/i ph i">null</em> 表示输出结果为 NULL；<em class="+ topic/ph hi-d/i ph i">ffill</em> 表示输出上一个有数据的窗口的结果；具体数值，需要和对应的 <em class="+ topic/ph hi-d/i ph i">metrics</em> 计算结果的类型保持一致。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title18" id="42-响应式状态引擎计算复杂因子"><h3 class="- topic/title title topictitle3" id="ariaid-title18">4.2. 响应式状态引擎计算复杂因子</h3><div class="- topic/body body"><p class="- topic/p p">在基于分钟因子进一步加工有状态的复杂因子的时候，比如实时计算 MACD、RSI 等，常常会面临以下几个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">计算因子是有状态的：不仅与当前的多个指标有关，而且与多个指标的历史状态相关，如何开发有状态的算子？</strong></li></ul><p class="- topic/p p">DolphinDB 内置了大量有状态的算子，并进行了增量计算的优化，具体已经内置算子如下所示。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">累计窗口函数：cumavg, cumsum, cumprod, cumcount, cummin, cummax, cumvar, cumvarp, cumstd, cumstdp, cumcorr, cumcovar, cumbeta, cumwsum, cumwavg。</p></li><li class="- topic/li li"><p class="- topic/p p">滑动窗口函数：ema, mavg, msum, mcount, mprod, mvar, mvarp, mstd, mstdp, mskew, mkurtosis, mmin, mmax, mimin, mimax, mmed, mpercentile, mrank, mcorr, mcovar, mbeta, mwsum, mwavg, mslr。</p></li><li class="- topic/li li"><p class="- topic/p p">序列相关函数：deltas, ratios, ffill, move, prev, iterate, ewmMean, ewmVar, ewmStd, ewmCovar, ewmCorr。</p></li></ul><p class="- topic/p p">DolphinDB 也允许用户用插件来开发自己的状态函数，注册后即可在状态引擎中使用。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">在一次响应计算过程中，如果计算 1000 个因子，这 1000 个因子依赖一个共同的中间变量，如何避免重复计算？</strong></li></ul><p class="- topic/p p">比如在上述因子计算平台的复杂因子计算处，有两个因子，分别叫 factor1 和 factor2，表达式如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def factor1(price) {
    a = ema(price, 20)
    b = ema(price, 40)
    tmp = 1000 * (a-b)\(a+b)
    return  ema(tmp , 10) - ema(tmp , 20)
}</code></pre><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def factor2(price) {
    a = ema(price, 20)
    b = ema(price, 40)
    tmp = 1000 * (a-b)\(a+b)
    return  mavg(tmp, 10)
}</code></pre><p class="- topic/p p">可以看到，两个因子的计算都依赖了相同的中间变量 <code class="+ topic/ph pr-d/codeph ph codeph">tmp</code>。如果要避免中间变量 <code class="+ topic/ph pr-d/codeph ph codeph">tmp</code> 的重复计算，可以先定义一个 <code class="+ topic/ph pr-d/codeph ph codeph">tmpFactor</code> 的函数，表达式如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def tmpFactor(price) {
    a = ema(price, 20)
    b = ema(price, 40)
    tmp = 1000 * (a-b)\(a+b)
    return  tmp
}</code></pre><p class="- topic/p p">然后把 factor1 和 factor2 的表达式用如下方式表示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def factor1(price) {
    tmp = tmpFactor(price)
    return  ema(tmp , 10) - ema(tmp , 20)
}</code></pre><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def factor2(price) {
    tmp = tmpFactor(price)
    return  mavg(tmp, 10)
}</code></pre><p class="- topic/p p">DolphinDB 内置的响应式状态引擎在解析复杂因子的计算表达式的时候，就会自动避免不同因子相同中间变量的重复计算。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title19" id="5-路线图roadmap"><h2 class="- topic/title title topictitle2" id="ariaid-title19">5. 路线图(Roadmap)</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">进一步完善 Level-2 快照数据流批一体因子计算平台的功能模块：<ul class="- topic/ul ul"><li class="- topic/li li">开放更多配置参数，解决基于 Level-2 快照数据做实时分钟因子加工的时候遇到的问题</li><li class="- topic/li li">补充 Factor1 和 Factor2 下的内置因子，丰富内置因子库</li></ul></li><li class="- topic/li li">开发 Level-2 快照频率流批一体因子计算平台功能模块</li><li class="- topic/li li">开发 Level2 多数据源融合流批一体因子计算平台功能模块</li></ul></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title20" id="6-附录"><h2 class="- topic/title title topictitle2" id="ariaid-title20">6. 附录</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">功能模块源码： <a class="- topic/xref xref" href="script/Level2_Snapshot_Factor_Calculation/snapshot_func.zip">SnapshotFactorCalculationPlatform</a></li><li class="- topic/li li">按照教程，把module内容同步到server后，测试所需脚本： <a class="- topic/xref xref" href="script/Level2_Snapshot_Factor_Calculation/test_scripts.zip">test_scripts.zip</a></li><li class="- topic/li li">测试的 csv 数据： <a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads/docs/Level2_Snapshot_Factor_Calculation.zip" target="_blank" rel="external noopener">Level2_Snapshot_Factor_Calculation</a></li></ul></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E6%A6%82%E8%BF%B0" data-tocid="1-概述">1. 概述</a></li><li class="topic-item"><a href="#2-level-2-%E5%BF%AB%E7%85%A7%E6%95%B0%E6%8D%AE%E6%B5%81%E6%89%B9%E4%B8%80%E4%BD%93%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0" data-tocid="2-level-2-快照数据流批一体因子计算平台">2. Level-2 快照数据流批一体因子计算平台</a><ul><li class="topic-item"><a href="#21-%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0%E4%B8%9A%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B" data-tocid="21-因子计算平台业务使用流程">2.1. 因子计算平台业务使用流程</a></li><li class="topic-item"><a href="#22-%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0%E6%A1%86%E6%9E%B6" data-tocid="22-因子计算平台框架">2.2. 因子计算平台框架</a></li><li class="topic-item"><a href="#23-%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0%E7%9A%84%E8%AE%A1%E7%AE%97%E8%83%BD%E5%8A%9B" data-tocid="23-因子计算平台的计算能力">2.3. 因子计算平台的计算能力</a></li><li class="topic-item"><a href="#24-%E7%94%A8%E6%88%B7%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%A0%E5%AD%90%E8%A1%A8%E8%BE%BE%E5%BC%8F" data-tocid="24-用户二次开发自定义因子表达式">2.4. 用户二次开发自定义因子表达式</a><ul><li class="topic-item"><a href="#241-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%92%9F%E5%9B%A0%E5%AD%90%E8%A1%A8%E8%BE%BE%E5%BC%8F" data-tocid="241-自定义分钟因子表达式">2.4.1. 自定义分钟因子表达式</a></li><li class="topic-item"><a href="#242-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%8D%E6%9D%82%E5%9B%A0%E5%AD%90%E8%A1%A8%E8%BE%BE%E5%BC%8F" data-tocid="242-自定义复杂因子表达式">2.4.2. 自定义复杂因子表达式</a></li></ul></li></ul></li><li class="topic-item"><a href="#3-%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9B%A0%E5%AD%90%E5%BC%80%E5%8F%91" data-tocid="3-部署和因子开发">3. 部署和因子开发</a><ul><li class="topic-item"><a href="#31-%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2" data-tocid="31-因子计算平台部署">3.1. 因子计算平台部署</a></li><li class="topic-item"><a href="#32-%E7%AC%AC%E4%B8%80%E7%B1%BB%E5%88%86%E9%92%9F%E5%9B%A0%E5%AD%90%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95" data-tocid="32-第一类分钟因子开发和调试">3.2. 第一类分钟因子开发和调试</a></li><li class="topic-item"><a href="#33-%E7%AC%AC%E4%BA%8C%E7%B1%BB%E5%A4%8D%E6%9D%82%E5%9B%A0%E5%AD%90%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95" data-tocid="33-第二类复杂因子开发和调试">3.3. 第二类复杂因子开发和调试</a></li><li class="topic-item"><a href="#34-python-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B0%83%E5%BA%A6%E4%BB%BB%E5%8A%A1%E5%92%8C%E8%AE%A2%E9%98%85%E7%BB%93%E6%9E%9C" data-tocid="34-python-客户端调度任务和订阅结果">3.4. Python 客户端调度任务和订阅结果</a></li><li class="topic-item"><a href="#35-%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E5%AE%9E%E6%97%B6%E6%8E%A8%E9%80%81%E8%87%B3-kafka" data-tocid="35-计算结果实时推送至-kafka">3.5. 计算结果实时推送至 Kafka</a></li></ul></li><li class="topic-item"><a href="#4-%E6%B5%81%E8%AE%A1%E7%AE%97%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94" data-tocid="4-流计算相关问题解答">4. 流计算相关问题解答</a><ul><li class="topic-item"><a href="#41-%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%BC%95%E6%93%8E%E8%AE%A1%E7%AE%97%E5%88%86%E9%92%9F%E5%9B%A0%E5%AD%90" data-tocid="41-时间序列引擎计算分钟因子">4.1. 时间序列引擎计算分钟因子</a></li><li class="topic-item"><a href="#42-%E5%93%8D%E5%BA%94%E5%BC%8F%E7%8A%B6%E6%80%81%E5%BC%95%E6%93%8E%E8%AE%A1%E7%AE%97%E5%A4%8D%E6%9D%82%E5%9B%A0%E5%AD%90" data-tocid="42-响应式状态引擎计算复杂因子">4.2. 响应式状态引擎计算复杂因子</a></li></ul></li><li class="topic-item"><a href="#5-%E8%B7%AF%E7%BA%BF%E5%9B%BEroadmap" data-tocid="5-路线图roadmap">5. 路线图(Roadmap)</a></li><li class="topic-item"><a href="#6-%E9%99%84%E5%BD%95" data-tocid="6-附录">6. 附录</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>