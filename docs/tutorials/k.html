<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="教程难度 中级 面向读者 已经掌握 DolphinDB 基础编程语法和 SQL 语法的用户： 编程语言 map-reduce 函数 已经掌握 DolphinDB 流数据基础功能的用户： 流数据表 发布与订阅 响应式状态引擎 时序聚合引擎 本教程提供了完整的测试数据和测试代码，初学者也可以跟随教程内容复现业务场景 ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="基于快照行情的股票和基金-k-线合成"/><title>基于快照行情的股票和基金 K 线合成</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;基于快照行情的股票和基金-k-线合成&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;基于快照行情的股票和基金 K 线合成&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;教程难度&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;中级&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;面向读者&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;已经掌握 DolphinDB 基础编程语法和 SQL 语法的用户：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;10:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;10:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../progr/progr_intro.dita&#34; xtrc=&#34;xref:1;10:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;编程语言&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;11:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/m/mr.dita&#34; xtrc=&#34;xref:2;11:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;map-reduce 函数&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;已经掌握 DolphinDB 流数据基础功能的用户：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;13:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;13:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/str_table.dita&#34; xtrc=&#34;xref:3;13:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;流数据表&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;14:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/sub_pub.dita&#34; xtrc=&#34;xref:4;14:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;发布与订阅&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;15:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/reactive_state_engine.dita&#34; xtrc=&#34;xref:5;15:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;响应式状态引擎&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;16:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/time_series_engine.dita&#34; xtrc=&#34;xref:6;16:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;时序聚合引擎&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程提供了完整的测试数据和测试代码，初学者也可以跟随教程内容复现业务场景&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:107;142:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-概述&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1. 概述&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;由于不同交易所不同资产的交易规则是有差异的，导致不同交易所基于快照行情或逐笔成交合成不同资产1分钟 K 线的计算方法是不同的。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程旨在提高 DolphinDB 在具体业务场景下的落地效率，降低 DolphinDB 在实际业务使用中的开发难度。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程中会学习到：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;如何基于历史快照行情数据合成1分钟 K 线&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;如何基于实时快照行情数据合成1分钟 K 线&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程适用范围如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;表1-1 教程支持 K 线合成的资产范围&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:1;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;交易所&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;34:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;是否支持&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:3;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;36:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;深交所-股票&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;36:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;是&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:5;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;37:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;深交所-基金&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:6;37:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;是&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:7;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;38:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;上交所-股票&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:8;38:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;是&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:9;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;39:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;上交所-基金&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:10;39:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;是&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:11;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;40:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;北交所-股票&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:12;40:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;是&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;沪深北三大交易所股票和基金资产&lt;/b&gt;的交易时间段如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;早盘集合竞价：09:15:00 - 09:25:00&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;连续竞价：09:30:00 - 11:30:00&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;连续竞价：13:00:00 - 14:57:00&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;午盘集合竞价：14:57:00 - 15:00:00&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-基于历史快照行情合成-k-线&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;2. 基于历史快照行情合成 K 线&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-快照行情数据特征&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;2.1 快照行情数据特征&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;交易所 Level-1或 Level-2 快照行情的数据频率约3秒（即每个股票每隔3秒推送一条快照数据），但是并不是3秒等间隔推送。实盘行情下，平均每个股票和基金1天的快照行情数据条数约4000条左右。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:1;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;942&#34; dita-ot:image-height=&#34;182&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:1;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;01&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-1 活跃股票快照行情非3秒等间隔推送&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.2.png&#34; placement=&#34;break&#34; xtrc=&#34;image:2;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;933&#34; dita-ot:image-height=&#34;283&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:2;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;02&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-2 不活跃基金快照行情非3秒等间隔推送&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.3.png&#34; placement=&#34;break&#34; xtrc=&#34;image:3;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;206&#34; dita-ot:image-height=&#34;228&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:3;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;03&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-3 2023年2月沪深交易所股票和基金快照行情数据量统计&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;不同的数据供应商、不同的交易所，提供的快照行情字段都会有差异。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程针对沪深北交易所的股票和基金快照行情做了统一处理，数据表中的重要字段如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;表2-1 沪深北交易所的股票和基金快照行情表结构&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:2;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:3;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:4;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:5;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:13;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;字段名称&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:14;73:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;数据类型&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:15;73:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;数据说明&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:16;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TradeTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:17;75:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TIMESTAMP&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:18;75:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;日期时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:19;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:20;76:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;SYMBOL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:21;76:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;证券代码&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:22;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;OpenPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:23;77:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:24;77:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;开盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:25;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;PreCloPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:26;78:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:27;78:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;昨收价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:28;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;HighPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:29;79:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:30;79:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日最高价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:31;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LowPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:32;80:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:33;80:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日最低价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:34;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LastPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:35;81:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:36;81:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日最新价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:37;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;PreCloseIOPV&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:38;82:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:39;82:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;昨日 IOPV（基金）&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:40;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;IOPV&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:41;83:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:42;83:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;IOPV（基金）&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:43;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TotalVolumeTrade&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:44;84:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LONG&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:45;84:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;日累计成交量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:46;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TotalValueTrade&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:47;85:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:48;85:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;日累计成交金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:49;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;NumTrades&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:50;86:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LONG&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:51;86:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;日累计成交笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:52;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;UpLimitPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:53;87:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:54;87:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日涨停价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:55;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DownLimitPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:56;88:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:57;88:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日跌停价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:58;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;……&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:59;89:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;……&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:60;89:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;快照行情字段太多，只展示一部分&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程基于沪深北交易所的股票和基金快照行情数据合成的1分钟 K 线的表结构如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;表2-2 1分钟 K 线表结构&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:3;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:6;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:7;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:8;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:9;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:61;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;字段名称&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:62;95:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;数据类型&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:63;95:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;数据说明&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:64;95:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算规则&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:65;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:66;97:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;SYMBOL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:67;97:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;证券代码&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:68;97:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;证券代码&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:69;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TradeTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:70;98:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TIMESTAMP&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:71;98:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;日期时间&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:72;98:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;早盘集合竞价数据纳入第一根 K 线； 第一根 K 线的输出时间是09:30:00，计算窗口为 [09:25:00, 09:31:00)K 线的输出时间为计算窗口的左边界，计算窗口规则为左闭右开； 合成 K 线一共240根，包括11:30:00, 14:57:00和15:00:00，不包括14:58:00和14:59:00&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:73;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;OpenPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:74;99:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:75;99:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;开始价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:76;99:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算窗口内的第一条快照行情的最新价； 如果开盘后没有成交，为0； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:77;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;HighPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:78;100:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:79;100:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;最高价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:80;100:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算窗口内的最高价 如果开盘后没有成交，为0； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:81;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LowPrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:82;101:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:83;101:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;最低价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:84;101:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算窗口内的最低价 如果开盘后没有成交，为0； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:85;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;ClosePrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:86;102:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:87;102:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;收盘价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:88;102:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算窗口内的最后一条快照行情的最新价； 如果开盘后没有成交，为0； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:89;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;Volume&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:90;103:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LONG&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:91;103:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;成交量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:92;103:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算窗口内的所有快照行情成交量求和； 如果缺失快照行情，填充0&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:93;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;Turnover&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:94;104:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:95;104:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;成交金额&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:96;104:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算窗口内的所有快照行情成交金额求和； 如果缺失快照行情，填充0&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:97;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TradesCount&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:98;105:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;INT&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:99;105:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;成交笔数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:100;105:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算窗口内的所有快照行情成交笔数求和； 如果缺失快照行情，填充0&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;106:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:101;106:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;PreClosePrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:102;106:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:103;106:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;昨收价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:104;106:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日快照行情中的昨收价； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的昨日收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:105;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;PreCloseIOPV&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:106;107:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:107;107:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;昨日 IOPV（基金）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:108;107:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;基金当日快照行情中的昨日 IOPV，深交所基金有该字段，上交所基金没有该字段； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的昨日IOPV&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:109;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;IOPV&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:110;108:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:111;108:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;IOPV（基金）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:112;108:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;基金当日快照行情中的 IOPV，深交所基金没有该字段，上交所基金有该字段； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的昨日IOPV&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:113;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;UpLimitPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:114;109:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:115;109:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;涨停价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:116;109:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日快照行情中的涨停价，深交所有该字段，上交所没有该字段； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的涨停价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:37;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:117;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DownLimitPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:118;110:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:119;110:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;跌停价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:120;110:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日快照行情中的跌停价，深交所有该字段，上交所没有该字段； 如果盘中计算窗口缺失快照行情，填充上一根 K 线的跌停价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:38;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:121;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;ChangeRate&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:122;111:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:123;111:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;上涨或下跌幅度&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:124;111:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当前计算窗口 K 线的收盘价相比上一根 K 线的收盘价的变化幅度； 开盘第一根 K 线的涨跌幅等于 [09:25:00, 09:31:00) 计算窗口内最后一笔快照的最新价和第一笔快照的最新价的变化幅度如果缺失快照行情，填充0&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-快照行情合成-k-线的规则&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;113:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;2.2 快照行情合成 K 线的规则&lt;/b&gt;&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;（1）最高价和最低价的处理&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;因为快照行情是非等时间间隔的数据切片，所以会出现如下情况：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日最高价（HighPrice）在当前计算窗口内发生变化，但是当前计算窗口内的所有最新价（LastPrice）并不包含发生在当前计算窗口内的当日最高价。&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.4.png&#34; placement=&#34;break&#34; xtrc=&#34;image:4;121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;433&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:4;121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;04&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-4 最高价计算规则说明&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;当日最低价（LowPrice）在当前计算窗口内发生变化，但是当前计算窗口内的所有最新价（LastPrice）并不包含发生在当前计算窗口内的当日最低价。&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.5.png&#34; placement=&#34;break&#34; xtrc=&#34;image:5;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;433&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:5;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;05&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-5 最低价计算规则说明&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;因此，1分钟 K 线的最高价的自定义计算函数如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;defg high(DeltasHighPrice, HighPrice, LastPrice){ if(sum(DeltasHighPrice)&amp;gt;0.000001){ return max(HighPrice) } else{ return max(LastPrice) } }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;参数说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;146:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DeltasHighPrice：&lt;/b&gt; 同一个股票或基金两笔相邻快照的当日最高价（HighPrice）的差&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;147:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;HighPrice：&lt;/b&gt; 快照行情的当日最高价&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;148:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LastPrice：&lt;/b&gt; 快照行情的当日最新价&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;函数计算逻辑说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最高价发生变化，那么1分钟 K 线的最高价等于计算窗口内当日最高价的最大值&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最高价没有发生变化，那么1分钟 K 线的最高价等于计算窗口内当日最新价的最大值&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;因此，1分钟 K 线的最低价的自定义计算函数如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;defg low(DeltasLowPrice, LowPrice, LastPrice){ sumDeltas = sum(DeltasLowPrice) if(sumDeltas&amp;lt;-0.000001 and sumDeltas!=NULL){ return min(iif(LowPrice==0.0, NULL, LowPrice)) } else{ return min(LastPrice) } }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;参数说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;171:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DeltasLowPrice：&lt;/b&gt; 同一个股票或基金两笔相邻快照的当日最低价（LowPrice）的差&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;172:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;172:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LowPrice：&lt;/b&gt; 快照行情的当日最低价&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;173:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;LastPrice：&lt;/b&gt; 快照行情的当日最新价&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;函数计算逻辑说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最低价发生变化，那么1分钟 K 线的最低价等于计算窗口内当日最低价的最小值&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;178:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;开盘没有成交的股票或基金，推送的快照行情的最新价和最低价都为0，在当日第一个有成交的窗口内，最低价发生变化，此时计算窗口 K 线的最低价等于不为0的快照行情当日最低价的最小值，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;178:91&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;min(iif(LowPrice==0.0, NULL, LowPrice))&lt;/codeph&gt; 就是在处理此种特殊情况&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最低价没有发生变化，那么1分钟 K 线的最低价等于计算窗口内当日最新价的最小值&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;性能优化小技巧：第三行代码的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;180:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;if&lt;/codeph&gt; 判断条件，两次引用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;180:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;sum(DeltasLowPrice)&lt;/codeph&gt;，建议先用变量 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;180:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;sumDeltas = sum(DeltasLowPrice)&lt;/codeph&gt; 进行一次聚合计算。如果在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;180:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;if&lt;/codeph&gt; 判断条件写成 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;180:121&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;if(sum(DeltasLowPrice)&amp;lt;-0.000001 and sum(DeltasLowPrice)!=NULL)&lt;/codeph&gt; ，则此处进行了两次聚合计算&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.6.png&#34; placement=&#34;break&#34; xtrc=&#34;image:6;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;943&#34; dita-ot:image-height=&#34;284&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:6;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;06&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-6 开盘没有成交的股票或基金的快照行情&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;（2）成交量、成交额和成交笔数的处理&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;快照行情中的成交量、成交金额和成交笔数都是日累计求和值，所以按照窗口为1分钟、步长为1分钟的滚动窗口计算前，需要先求出两笔相邻快照的增量。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.7.png&#34; placement=&#34;break&#34; xtrc=&#34;image:7;190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;937&#34; dita-ot:image-height=&#34;288&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:7;190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;07&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-7 快照行情中的日累计成交量、日累计成交额和成日累计交笔数&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;可以使用 DolphinDB 内置的 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/d/deltas.dita&#34; xtrc=&#34;xref:7;194:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;deltas 函数&lt;/xref&gt;和 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../progr/sql/contextBy.dita&#34; xtrc=&#34;xref:8;194:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;context by SQL 语句&lt;/xref&gt;进行数据预处理，具体处理代码下文会详细介绍。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;196:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;196:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;（3）开盘以后没有成交&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;198:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;部分成交不活跃的股票和基金，09:15:00 开始交易后一直没有成交，但是快照行情会正常推送。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.8.png&#34; placement=&#34;break&#34; xtrc=&#34;image:8;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;934&#34; dita-ot:image-height=&#34;280&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:8;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;08&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;202:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-8 开盘没有成交的股票或基金的快照行情&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;针对开盘以后一直没有成交的计算窗口，本教程处理规则如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;OpenPrice, HighPrice, LowPrice, ClosePrice, Volume, Turnover, TradesCount, ChangeRate 为0&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;PreClosePrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx 为快照行情中对应的值&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:19;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;（4）盘中计算窗口内没有成交&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;部分成交不活跃的股票和基金，会出现盘中某些计算窗口内完全没有成交，但是快照行情会正常推送。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.9.png&#34; placement=&#34;break&#34; xtrc=&#34;image:9;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;947&#34; dita-ot:image-height=&#34;291&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:9;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;09&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-9 盘中计算窗口内没有成交的快照行情&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;针对盘中没有成交的计算窗口，本教程处理规则如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;OpenPrice, HighPrice, LowPrice, ClosePrice 等于前一根 K 线的 ClosePrice&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;Volume, Turnover, TradesCount, ChangeRate 为0&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;PreClosePrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx 等于前一根 K 线对应的值&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-基于历史快照行情合成-k-线&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;2.3 基于历史快照行情合成 K 线&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;225:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:20;225:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第一步：部署测试环境&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;部署 DolphinDB 单节点：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;standalone_server.md&#34; xtrc=&#34;xref:9;227:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;单节点部署教程&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;下载测试数据，并上传到 DolphinDB 部署的 server 目录下： &lt;xref class=&#34;- topic/xref &#34; format=&#34;csv&#34; href=&#34;data/k/testData.csv&#34; xtrc=&#34;xref:10;228:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;?ditaot usertext?&gt;testData.csv&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;229:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;根据部署教程打开节点 web 编程界面，登陆后运行后续步骤测试代码，默认 admin 账户的密码是 123456&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.10.png&#34; placement=&#34;break&#34; xtrc=&#34;image:10;231:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;368&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:10;231:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;10&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;233:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-10 DolphinDB web 编程界面&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;235:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:21;235:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第二步：创建数据库和分区表&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;下述数据库和分区表创建代码适用于沪深两市股票和基金 Level-2 行情快照数据共同存储在同一表中，更多关于数据库和分区表创建的方法可以参考：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;best_practices_for_partitioned_storage.md&#34; xtrc=&#34;xref:11;237:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;存储金融数据的分区方案最佳实践&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;239:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;粘贴下述代码至 web 编程界面，选中需要执行代码点击执行（执行快捷键：Ctrl+E）即可：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;241:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;//创建数据库 create database &#34;dfs://snapshotDB&#34; partitioned by VALUE(2020.01.01..2021.01.01), HASH([SYMBOL, 50]) engine='TSDB' //创建分区表 create table &#34;dfs://snapshotDB&#34;.&#34;snapshotTB&#34;( Market SYMBOL TradeTime TIMESTAMP MDStreamID SYMBOL SecurityID SYMBOL SecurityIDSource SYMBOL TradingPhaseCode SYMBOL ImageStatus INT PreCloPrice DOUBLE NumTrades LONG TotalVolumeTrade LONG TotalValueTrade DOUBLE LastPrice DOUBLE OpenPrice DOUBLE HighPrice DOUBLE LowPrice DOUBLE ClosePrice DOUBLE DifPrice1 DOUBLE DifPrice2 DOUBLE PE1 DOUBLE PE2 DOUBLE PreCloseIOPV DOUBLE IOPV DOUBLE TotalBidQty LONG WeightedAvgBidPx DOUBLE AltWAvgBidPri DOUBLE TotalOfferQty LONG WeightedAvgOfferPx DOUBLE AltWAvgAskPri DOUBLE UpLimitPx DOUBLE DownLimitPx DOUBLE OpenInt INT OptPremiumRatio DOUBLE OfferPrice DOUBLE[] BidPrice DOUBLE[] OfferOrderQty LONG[] BidOrderQty LONG[] BidNumOrders INT[] OfferNumOrders INT[] ETFBuyNumber INT ETFBuyAmount LONG ETFBuyMoney DOUBLE ETFSellNumber INT ETFSellAmount LONG ETFSellMoney DOUBLE YieldToMatu DOUBLE TotWarExNum DOUBLE WithdrawBuyNumber INT WithdrawBuyAmount LONG WithdrawBuyMoney DOUBLE WithdrawSellNumber INT WithdrawSellAmount LONG WithdrawSellMoney DOUBLE TotalBidNumber INT TotalOfferNumber INT MaxBidDur INT MaxSellDur INT BidNum INT SellNum INT LocalTime TIME SeqNo INT OfferOrders LONG[] BidOrders LONG[] ) partitioned by TradeTime, SecurityID, sortColumns=[`Market,`SecurityID,`TradeTime], keepDuplicates=ALL&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;316:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;运行不报错，即执行成功，可以执行下述代码查看分区表的表结构信息：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;loadTable(&#34;dfs://snapshotDB&#34;, &#34;snapshotTB&#34;).schema().colDefs&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;返回：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.11.png&#34; placement=&#34;break&#34; xtrc=&#34;image:11;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;484&#34; dita-ot:image-height=&#34;327&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:11;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;11&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;326:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-11 行情快照分区表的部分表结构信息&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:22;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第三步：导入 csv 测试数据&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，导入测试 csv 文本数据。注意，执行下述代码前，必须把测试数据 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;330:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;testData.csv&lt;/codeph&gt; 文件上传到DolphinDB 部署的 server 目录下。也可以把 csv 文件上传到自定义路径，例如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;330:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;/data/testData.csv&lt;/codeph&gt;，此时需要下述代码的&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;330:139&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt; loadTextEx&lt;/codeph&gt; 导入函数的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;330:159&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;filename=&#34;/data/testData.csv&#34;&lt;/codeph&gt;。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;tmp = loadTable(&#34;dfs://snapshotDB&#34;, &#34;snapshotTB&#34;).schema().colDefs schemaTB = table(tmp.name as name, tmp.typeString as type) loadTextEx(dbHandle=database(&#34;dfs://snapshotDB&#34;), tableName=&#34;snapshotTB&#34;, partitionColumns=`TradeDate`SecurityID, filename=&#34;./testData.csv&#34;, schema=schemaTB)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;成功导入后可以执行下述代码，查询前10行数据至内存中查看：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;data = select top 10 * from loadTable(&#34;dfs://snapshotDB&#34;, &#34;snapshotTB&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;返回：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.12.png&#34; placement=&#34;break&#34; xtrc=&#34;image:12;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1066&#34; dita-ot:image-height=&#34;718&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:12;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;12&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;348:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-12 数据预览方法&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:23;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第四步：自定义最高价最低价计算函数&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;352:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，在当前会话中声明自定义函数，可以在同一个会话的后续操作中直接引用函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;352:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;high&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;352:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;low&lt;/codeph&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;defg high(DeltasHighPrice, HighPrice, LastPrice){ if(sum(DeltasHighPrice)&amp;gt;0.000001){ return max(HighPrice) } else{ return max(LastPrice) } } defg low(DeltasLowPrice, LowPrice, LastPrice){ sumDeltas = sum(DeltasLowPrice) if(sumDeltas&amp;lt;-0.000001 and sumDeltas!=NULL){ return min(iif(LowPrice==0.0, NULL, LowPrice)) } else{ return min(LastPrice) } }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;375:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:24;375:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第五步：加载少量数据至内存调试&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;377:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;为了方便临时调试代码的正确性，可以先加载少量数据到内存中，方便后续复杂业务代码调试。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;379:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，加载1天2个票的数据到内存中，并赋值给表变量 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;379:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;snapshotTB&lt;/codeph&gt;，后续代码中，可以直接引用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;379:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;snapshotTB&lt;/codeph&gt; 这个表变量调试代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;381:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;snapshotTB = select TradeTime, SecurityID, OpenPrice, PreCloPrice, HighPrice, LowPrice, LastPrice, PreCloseIOPV, IOPV, TotalVolumeTrade, TotalValueTrade, NumTrades, UpLimitPx, DownLimitPx from loadTable(&#34;dfs://snapshotDB&#34;, &#34;snapshotTB&#34;) where TradeTime.date()=2023.02.01, SecurityID in `888888`999999&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:25;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第六步：原始行情快照数据处理&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;393:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，对原始的快照行情进行处理，主要进行了以下几个方面的数据加工：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;395:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;395:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;把09:25:00-09:30:00的数据归入第一根 K 线：[09:30:00, 09:31:00]&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算同一个股票或者基金的两笔相邻快照的最高价和最低价的变化幅度&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:41;397:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算同一个股票或者基金的两笔相邻快照的成交量、成交金额和成交笔数的增量&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;399:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;tempTB1 = select TradeTime.date() as TradeDate, iif(TradeTime.time()&amp;lt;=09:30:00.000, 09:30:00.000, TradeTime.time()) as TradeTime, SecurityID, OpenPrice, PreCloPrice, HighPrice, LowPrice, LastPrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx, iif(deltas(HighPrice)&amp;gt;0.000001, 1, 0) as DeltasHighPrice, iif(abs(deltas(LowPrice))&amp;gt;0.000001, -1, 0) as DeltasLowPrice, iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade)) as DeltasVolume, iif(deltas(TotalValueTrade)==NULL, TotalValueTrade, deltas(TotalValueTrade)) as DeltasTurnover, iif(deltas(NumTrades)==NULL, NumTrades, deltas(NumTrades)) as DeltasTradesCount from snapshotTB where TradeTime.time()&amp;gt;=09:25:00.000 context by SecurityID&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;422:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:26;422:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第七步：1分钟窗口和1分钟步长的聚合计算&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;424:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，针对处理后的快照行情做窗口为1分钟、步长为1分钟的滚动窗口计算，重要处理步骤如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:42;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;调用了自定义函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;426:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;high&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;426:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;low &lt;/codeph&gt;计算 K 线的最高价和最低价&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:43;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;427:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;FirstBarChangeRate&lt;/codeph&gt;表示当前1分钟计算窗口内，最后一条最新价不为0的快照相对第一条最新价不为0的快照的变化幅度，用于开盘第一根 K 线的涨跌幅计算&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:44;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;数据降频处理调用了 DolphinDB 内置函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;428:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;interval&lt;/codeph&gt;，在此步骤时，针对盘中计算窗口缺失快照行情的情况，统一用0填充，后面会针对全部为0的 K 线填充数据做进一步处理&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;430:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;tempTB2 = select firstNot(LastPrice, 0) as OpenPrice, high(DeltasHighPrice, HighPrice, LastPrice) as HighPrice, low(DeltasLowPrice, LowPrice, LastPrice) as LowPrice, last(LastPrice) as ClosePrice, sum(DeltasVolume) as Volume, sum(DeltasTurnover) as Turnover, sum(DeltasTradesCount) as TradesCount, last(PreCloPrice) as PreClosePrice, last(PreCloseIOPV) as PreCloseIOPV, last(IOPV) as IOPV, last(UpLimitPx) as UpLimitPx, last(DownLimitPx) as DownLimitPx, lastNot(LastPrice, 0)\firstNot(LastPrice, 0)-1 as FirstBarChangeRate from tempTB1 group by SecurityID, TradeDate, interval(X=TradeTime, duration=60s, label='left', fill=0) as TradeTime&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:27;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第八步：对齐每日240根 K 线&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程实例中，合成的1分钟 K 线一共240根：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:18;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:45;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第一根 K 线的输出时间是09:30:00，计算窗口为 [09:25:00, 09:31:00)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:46;453:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;全部输出包括11:30:00, 14:57:00和15:00:00，不包括14:58:00和14:59:00&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;455:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;如果用户需要自定义输出规则，比如需要输出14:58:00和14:59:00这两个特殊时间段的 K 线，可以调整下述代码实现。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;codes = select distinct(SecurityID) as SecurityID from tempTB2 order by SecurityID allTime = table((take(0..120, 121)*60*1000+09:30:00.000).join(take(0..117, 118)*60*1000+13:00:00.000).join(15:00:00.000) as TradeTime) tempTB3 = cj(codes, allTime)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:28;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第九步：缺失快照行情计算窗口填充&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，针对对齐每日240根 K 线的结果数据进行如下处理，得到最终结果：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:19;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:47;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;针对盘中没有成交的计算窗口，OpenPrice, HighPrice, LowPrice, ClosePrice 用前一根 K 线的 ClosePrice 填充&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:48;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;针对盘中没有成交的计算窗口，PreClosePrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx 用前一根 K 线对应的值填充&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:49;469:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;开盘第一根 K 线的涨跌幅等于 [09:25:00, 09:31:00) 计算窗口内最后一笔快照的最新价和第一笔快照的最新价的变化幅度&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;471:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;result = select SecurityID, concatDateTime(TradeDate, TradeTime) as TradeTime, iif(OpenPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), OpenPrice) as OpenPrice, iif(HighPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), HighPrice) as HighPrice, iif(LowPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), LowPrice) as LowPrice, iif(ClosePrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), ClosePrice) as ClosePrice, Volume, Turnover, TradesCount, iif(PreClosePrice==0.0, cumlastNot(PreClosePrice, 0.0), PreClosePrice) as PreClosePrice, iif(PreCloseIOPV==0.0 and PreClosePrice==0.0, cumlastNot(PreCloseIOPV, 0.0), PreCloseIOPV).nullFill(0.0) as PreCloseIOPV, iif(IOPV==0.0 and PreCloseIOPV==0.0, cumlastNot(IOPV, 0.0), IOPV).nullFill(0.0) as IOPV, iif(UpLimitPx==0.0, cumlastNot(UpLimitPx, 0.0), UpLimitPx).nullFill(0.0) as UpLimitPx, iif(DownLimitPx==0.0, cumlastNot(DownLimitPx, 0.0), DownLimitPx).nullFill(0.0) as DownLimitPx, iif( time(TradeTime)==09:30:00.000, iif(FirstBarChangeRate!=NULL, FirstBarChangeRate, 0.0), iif(ratios(ClosePrice)!=NULL and ClosePrice!=0.0, ratios(ClosePrice)-1, 0.0)) as ChangeRate from lj(tempTB3, tempTB2, `TradeTime`SecurityID) context by SecurityID&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;493:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;返回：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.13.png&#34; placement=&#34;break&#34; xtrc=&#34;image:13;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;263&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:13;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;13&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;497:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-13 1分钟 K 线计算结果&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:29;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第十步：封装并行计算代码&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;501:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;完成前面九个步骤，已经可以针对少量快照行情数据完成 K 线合成任务，但是针对海量历史行情数据还需进一步封装，才能实现并行计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;503:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;可以先执行下述代码，情况当前会话中的所有临时内存变量：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;505:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;undef all&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;然后执行下述代码，定义并行计算相关函数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;511:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;defg high(DeltasHighPrice, HighPrice, LastPrice){ if(sum(DeltasHighPrice)&amp;gt;0.000001){ return max(HighPrice) } else{ return max(LastPrice) } } defg low(DeltasLowPrice, LowPrice, LastPrice){ sumDeltas = sum(DeltasLowPrice) if(sumDeltas&amp;lt;-0.000001 and sumDeltas!=NULL){ return min(iif(LowPrice==0.0, NULL, LowPrice)) } else{ return min(LastPrice) } } def calOHLCBaseOnSnapshotMapFuc(snapshotTB){ //Processing the original snapshot market table for calculating OHLC tempTB1 = select TradeTime.date() as TradeDate, iif(TradeTime.time()&amp;lt;=09:30:00.000, 09:30:00.000, TradeTime.time()) as TradeTime, SecurityID, OpenPrice, PreCloPrice, HighPrice, LowPrice, LastPrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx, iif(deltas(HighPrice)&amp;gt;0.000001, 1, 0) as DeltasHighPrice, iif(abs(deltas(LowPrice))&amp;gt;0.000001, -1, 0) as DeltasLowPrice, iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade)) as DeltasVolume, iif(deltas(TotalValueTrade)==NULL, TotalValueTrade, deltas(TotalValueTrade)) as DeltasTurnover, iif(deltas(NumTrades)==NULL, NumTrades, deltas(NumTrades)) as DeltasTradesCount from snapshotTB where TradeTime.time()&amp;gt;=09:25:00.000 context by SecurityID //Aggregate Calculating: temporary 1-minute OHLC table tempTB2 = select firstNot(LastPrice, 0.0) as OpenPrice, high(DeltasHighPrice, HighPrice, LastPrice) as HighPrice, low(DeltasLowPrice, LowPrice, LastPrice) as LowPrice, last(LastPrice) as ClosePrice, sum(DeltasVolume) as Volume, sum(DeltasTurnover) as Turnover, sum(DeltasTradesCount) as TradesCount, last(PreCloPrice) as PreClosePrice, last(PreCloseIOPV) as PreCloseIOPV, last(IOPV) as IOPV, last(UpLimitPx) as UpLimitPx, last(DownLimitPx) as DownLimitPx, lastNot(LastPrice, 0.0)\firstNot(LastPrice, 0.0)-1 as FirstBarChangeRate from tempTB1 group by SecurityID, TradeDate, interval(X=TradeTime, duration=60s, label='left', fill=0) as TradeTime //240 bars per day codes = select distinct(SecurityID) as SecurityID from tempTB2 order by SecurityID allTime = table((take(0..120, 121)*60*1000+09:30:00.000).join(take(0..117, 118)*60*1000+13:00:00.000).join(15:00:00.000) as TradeTime) tempTB3 = cj(codes, allTime) //Processing missing data calculation window, excluding opening result = select SecurityID, concatDateTime(TradeDate, TradeTime) as TradeTime, iif(OpenPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), OpenPrice) as OpenPrice, iif(HighPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), HighPrice) as HighPrice, iif(LowPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), LowPrice) as LowPrice, iif(ClosePrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), ClosePrice) as ClosePrice, Volume, Turnover, TradesCount, iif(PreClosePrice==0.0, cumlastNot(PreClosePrice, 0.0), PreClosePrice) as PreClosePrice, iif(PreCloseIOPV==0.0 and PreClosePrice==0.0, cumlastNot(PreCloseIOPV, 0.0), PreCloseIOPV).nullFill(0.0) as PreCloseIOPV, iif(IOPV==0.0 and PreCloseIOPV==0.0, cumlastNot(IOPV, 0.0), IOPV).nullFill(0.0) as IOPV, iif(UpLimitPx==0.0, cumlastNot(UpLimitPx, 0.0), UpLimitPx).nullFill(0.0) as UpLimitPx, iif(DownLimitPx==0.0, cumlastNot(DownLimitPx, 0.0), DownLimitPx).nullFill(0.0) as DownLimitPx, iif( time(TradeTime)==09:30:00.000, iif(FirstBarChangeRate!=NULL, FirstBarChangeRate, 0.0), iif(ratios(ClosePrice)!=NULL and ClosePrice!=0.0, ratios(ClosePrice)-1, 0.0)) as ChangeRate from lj(tempTB3, tempTB2, `TradeTime`SecurityID) context by SecurityID return result } def calOHLCBaseOnSnapshot(calStartDate, calEndDate, dbName, tbName){ //Generate data source: If SQL only contains the required columns for calculation, it can improve calculation efficiency dataSource = sqlDS(&amp;lt; select TradeTime, SecurityID, OpenPrice, PreCloPrice, HighPrice, LowPrice, LastPrice, PreCloseIOPV, IOPV, TotalVolumeTrade, TotalValueTrade, NumTrades, UpLimitPx, DownLimitPx from loadTable(dbName, tbName) where TradeTime.date()&amp;gt;=calStartDate, TradeTime.date()&amp;lt;=calEndDate&amp;gt;) result = mr(ds=dataSource, mapFunc=calOHLCBaseOnSnapshotMapFuc, finalFunc=unionAll{,false}, parallel=true) return result }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;610:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;最后执行下述代码，针对一天的沪深全市场快照行情并行计算1分钟 K 线：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;612:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;calStartDate = 2023.02.01 calEndDate = 2023.02.01 dbName = &#34;dfs://snapshotDB&#34; tbName = &#34;snapshotTB&#34; oneDayResult = calOHLCBaseOnSnapshot(calStartDate, calEndDate, dbName, tbName)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:30;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第十一步：1分钟 K 线数据存储&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;622:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;首次存储数据前，需要执行下述代码创建存储1分钟 K 线所需的数据库和分区表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;624:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;def createStockFundOHLCDfsTB(dbName=&#34;dfs://stockFundOHLC&#34;, tbName=&#34;stockFundOHLC&#34;){ if(existsDatabase(dbUrl=dbName)){ print(dbName + &#34; has been created !&#34;) print(tbName + &#34; has been created !&#34;) } else{ db = database(dbName, VALUE, 2021.01.01..2021.12.31) print(dbName + &#34; created successfully.&#34;) colNames = `SecurityID`TradeTime`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`ChangeRate colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE] schemaTable = table(1:0, colNames, colTypes) db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`TradeTime) print(tbName + &#34; created successfully.&#34;) } return loadTable(dbName, tbName).schema().colDefs } dbName = &#34;dfs://stockFundOHLC&#34; tbName = &#34;stockFundOHLC&#34; createStockFundOHLCDfsTB(dbName, tbName)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;646:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码将内存中的计算结果存入分区表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;648:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;loadTable(&#34;dfs://stockFundOHLC&#34;, &#34;stockFundOHLC&#34;).append!(oneDayResult)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;652:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;查询前10行数据至内存中查看：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;654:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;data = select top 10 * from loadTable(&#34;dfs://stockFundOHLC&#34;, &#34;stockFundOHLC&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;658:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;返回：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.14.png&#34; placement=&#34;break&#34; xtrc=&#34;image:14;660:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;267&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:14;660:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;14&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;662:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-14 1分钟 K 线分区表查询结果&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-并行计算性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;664:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;664:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;2.4 并行计算性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;664:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;666:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;表2-3 测试环境配置表&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:4;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:10;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:11;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:39;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:125;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;配置项&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:126;668:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;信息&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;670:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:40;670:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:127;670:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;OS（操作系统）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:128;670:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;CentOS Linux 7 (Core)&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:41;671:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:129;671:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;内核&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:130;671:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.10.0-1160.el7.x86_64&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:42;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:131;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;CPU&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:132;672:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;Intel(R) Xeon(R) Gold 5220R CPU @ 2.20GHz16 逻辑 CPU 核心&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:43;673:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:133;673:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;内存&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:134;673:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;256 GB&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;675:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;表2-4 计算性能测试结果表&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:5;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:12;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:13;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:14;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:15;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:16;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:44;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:135;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;测试场景&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:136;677:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;原始快照行情数据&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:137;677:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算结果行数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:138;677:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算结果大小&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:139;677:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;计算耗时&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;679:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:45;679:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:140;679:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1天&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:141;679:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;24,285,866 行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:142;679:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1,555,440 行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:143;679:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;172 MB&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:144;679:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;4.3 s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:46;680:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:145;680:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;10天&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:146;680:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;238,691,947 行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:147;680:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;15,563,760 行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:148;680:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1.7 GB&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:149;680:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;37.3 s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:47;681:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:150;681:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1个月（20天）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:151;681:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;474,919,708 行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:152;681:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;31,158,240 行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:153;681:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.4 GB&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:154;681:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;76.5 s&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;683:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;如果是社区版用户，在进行上述海量数据并行计算的时候，可能会因为内存不足（社区版限制最大内存使用为8 GB）导致计算任务失败，请添加微信号13306510479 或扫描下面二维码申请测试 license。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/2.15.png&#34; placement=&#34;break&#34; xtrc=&#34;image:15;685:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;430&#34; dita-ot:image-height=&#34;430&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:15;685:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;15&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;687:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图2-15 DolphinDB 技术支持&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-基于实时快照行情数据合成-k-线&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3. 基于实时快照行情数据合成 K 线&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;691:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;实时快照行情数据特征和1分钟 K 线合成规则与2.1和2.2章节中的介绍一致。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;693:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;基于实时快照行情数据合成 K 线的流程图如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:16;695:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;1525&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:16;695:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;16&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;697:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-1 基于实时快照行情数据合成 K 线的流程图&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;699:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;接下来将详细介绍如何在 DolphinDB 中实现1分钟 K 线的实时计算代码开发。关于 DolphinDB 的流数据功能的基础概念本教程中不再展开，可以参考官网教程：&lt;xref class=&#34;- topic/xref &#34; href=&#34;../stream/str_intro.dita&#34; xtrc=&#34;xref:12;699:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;流数据&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-定义创建流表所需的函数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;701:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;701:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.1 定义创建流表所需的函数&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;701:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;703:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，定义创建流数据表所需的函数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;705:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;def getMDLSnapshotTB(tableCapacity=1000000){ colNames = `Market`TradeTime`MDStreamID`SecurityID`SecurityIDSource`TradingPhaseCode`ImageStatus`PreCloPrice`NumTrades`TotalVolumeTrade`TotalValueTrade`LastPrice`OpenPrice`HighPrice`LowPrice`ClosePrice`DifPrice1`DifPrice2`PE1`PE2`PreCloseIOPV`IOPV`TotalBidQty`WeightedAvgBidPx`AltWAvgBidPri`TotalOfferQty`WeightedAvgOfferPx`AltWAvgAskPri`UpLimitPx`DownLimitPx`OpenInt`OptPremiumRatio`OfferPrice`BidPrice`OfferOrderQty`BidOrderQty`BidNumOrders`OfferNumOrders`ETFBuyNumber`ETFBuyAmount`ETFBuyMoney`ETFSellNumber`ETFSellAmount`ETFSellMoney`YieldToMatu`TotWarExNum`WithdrawBuyNumber`WithdrawBuyAmount`WithdrawBuyMoney`WithdrawSellNumber`WithdrawSellAmount`WithdrawSellMoney`TotalBidNumber`TotalOfferNumber`MaxBidDur`MaxSellDur`BidNum`SellNum`LocalTime`SeqNo`OfferOrders`BidOrders colTypes = [SYMBOL,TIMESTAMP,SYMBOL,SYMBOL,SYMBOL,SYMBOL,INT,DOUBLE,LONG,LONG,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,LONG,DOUBLE,DOUBLE,LONG,DOUBLE,DOUBLE,DOUBLE,DOUBLE,INT,DOUBLE,DOUBLE[],DOUBLE[],LONG[],LONG[],INT[],INT[],INT,LONG,DOUBLE,INT,LONG,DOUBLE,DOUBLE,DOUBLE,INT,LONG,DOUBLE,INT,LONG,DOUBLE,INT,INT,INT,INT,INT,INT,TIME,INT,LONG[],LONG[]] return streamTable(tableCapacity:0, colNames, colTypes) } def getMDLSnapshotProcessTB(tableCapacity=1000000){ colNames = `SecurityID`TradeTime`UpLimitPx`DownLimitPx`PreCloPrice`HighPrice`LowPrice`LastPrice`PreCloseIOPV`IOPV`DeltasHighPrice`DeltasLowPrice`DeltasVolume`DeltasTurnover`DeltasTradesCount colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT] return streamTable(tableCapacity:0, colNames, colTypes) } def getMDLStockFundOHLCTempTB(tableCapacity=1000000){ colNames = `TradeTime`SecurityID`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`FirstBarChangeRate colTypes = [TIMESTAMP, SYMBOL, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE] return streamTable(tableCapacity:0, colNames, colTypes) } def getMDLStockFundOHLCTB(tableCapacity=1000000){ colNames = `SecurityID`TradeTime`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`ChangeRate colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE] return streamTable(tableCapacity:0, colNames, colTypes) }&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-定义最高价最低价计算函数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;731:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;731:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:31;731:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.2 定义最高价最低价计算函数&lt;/b&gt;&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;731:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;733:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，定义计算最高价最低价所需函数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;735:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;defg high(DeltasHighPrice, HighPrice, LastPrice){ if(sum(DeltasHighPrice)&amp;gt;0.000001){ return max(HighPrice) } else{ return max(LastPrice) } } defg low(DeltasLowPrice, LowPrice, LastPrice){ sumDeltas = sum(DeltasLowPrice) if(sumDeltas&amp;lt;-0.000001 and sumDeltas!=NULL){ return min(iif(LowPrice==0.0, NULL, LowPrice)) } else{ return min(LastPrice) } }&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-注册原始行情快照数据处理引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;756:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;756:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.3 注册原始行情快照数据处理引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;756:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;758:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:32;758:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第一步：创建相关流数据表&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;760:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;762:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;//Declare parameters tableCapacity = 1000000 mdlSnapshotTBName = &#34;mdlSnapshot&#34; mdlSnapshotProcessTBName = &#34;mdlSnapshotProcess&#34; //Create MDL snapshot table share(getMDLSnapshotTB(tableCapacity), mdlSnapshotTBName) //Create MDL processed snapshot table share(getMDLSnapshotProcessTB(tableCapacity), mdlSnapshotProcessTBName)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;773:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:20;775:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:50;775:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;775:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;tableCapacity&lt;/codeph&gt; 表示创建流数据表时预先分配的内存空间大小，如果该值小于实际接收的行情数量，则会自动扩容，扩容的时间点会有时延波动。该值也不建议设置太大，设置太大会造成内存浪费。合理的值应该是稍大于当天的全部行情数据量，这个值可以根据过去一段时间的行情数据统计得到。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:51;776:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;776:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;mdlSnapshotTBName&lt;/codeph&gt; 流数据表用于接收实时快照行情，并把增量数据实时推送给原始行情快照数据处理引擎。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:52;777:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;777:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;mdlSnapshotProcessTBName&lt;/codeph&gt; 流数据表用于接收引擎处理的结果数据。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;779:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:33;779:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第二步：定义原始行情快照处理引擎规则&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;781:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;783:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;//Original columns in the snapshot table colNames = `TradeTime`UpLimitPx`DownLimitPx`PreCloPrice`HighPrice`LowPrice`LastPrice`PreCloseIOPV`IOPV //Derived columns processed based on the original snapshot table convert = sqlCol(colNames).append!(sqlColAlias(&amp;lt;iif(deltas(HighPrice)&amp;gt;0.000001, 1, 0)&amp;gt;, `DeltasHighPrice)).append!(sqlColAlias(&amp;lt;iif(abs(deltas(LowPrice))&amp;gt;0.000001, -1, 0)&amp;gt;, `DeltasLowPrice)).append!(sqlColAlias(&amp;lt;iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade))&amp;gt;, `DeltasVolume)).append!(sqlColAlias(&amp;lt;iif(deltas(TotalValueTrade)==NULL, TotalValueTrade, deltas(TotalValueTrade))&amp;gt;, `DeltasTurnover)).append!(sqlColAlias(&amp;lt;iif(deltas(NumTrades)==NULL, NumTrades, deltas(NumTrades))&amp;gt;, `DeltasTradesCount))&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;790:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;可以点击本地变量查看定义的计算规则。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.2.png&#34; placement=&#34;break&#34; xtrc=&#34;image:17;792:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1171&#34; dita-ot:image-height=&#34;691&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:17;792:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;794:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-2 自定义行情数据处理规则&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;796:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;原始行情的加工处理包含两部分内容：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:21;798:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:53;798:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;保留一部分原始字段的值，如市场时间、涨停价、跌停价等，在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;798:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;colNames&lt;/codeph&gt; 变量中表示。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:54;799:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;对原始字段加工处理，如基于日累计成交量计算相邻两笔快照的成交量增量，在 DolphinDB 中的处理表达式为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;799:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&amp;lt;iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade))&amp;gt;&lt;/codeph&gt; ，&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/d/deltas.dita&#34; xtrc=&#34;xref:13;799:143&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;deltas 函数&lt;/xref&gt;表示计算两条相邻数据的差，第一条快照的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;799:198&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;deltas(TotalVolumeTrade)&lt;/codeph&gt; 计算结果为 NULL，这里用 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/i/iif.dita&#34; xtrc=&#34;xref:14;799:240&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;iif 函数&lt;/xref&gt;处理这种 if-else 的逻辑，第一条快照数据的成交量增量等于该条快照的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;799:307&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TotalVolumeTrade&lt;/codeph&gt;。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;801:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:34;801:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第三步：注册原始行情快照处理引擎（流处理引擎1）&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;803:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;805:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;mdlSnapshotProcessEngineName = &#34;mdlSnapshotProcessEngine&#34; createReactiveStateEngine( name=mdlSnapshotProcessEngineName, metrics =convert, dummyTable=objByName(mdlSnapshotTBName), outputTable=objByName(mdlSnapshotProcessTBName), keyColumn=&#34;SecurityID&#34;, filter=&amp;lt;TradeTime.time() between 09:25:00.000:11:31:00.000 or TradeTime.time() between 13:00:00.000:14:57:00.000 or TradeTime.time()&amp;gt;=15:00:00.000&amp;gt;, keepOrder = true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;817:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:22;819:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:55;819:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;此处使用了 DolphinDB 的响应式状态引擎 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;819:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;ReactiveStateEngine&lt;/codeph&gt; ，主要功能是针对输入数据做滑动窗口处理，即对每一条输入引擎的数据按照指定的计算逻辑处理，该引擎可以进行无状态和有状态计算，有状态计算函数都已经过算法优化，比如增量计算、避免重复计算等。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:56;820:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;该引擎支持过滤输出，此处指定了只输出以下时间段的处理结果：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:23;821:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:57;821:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;09:25:00.000-11:31:00.000&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:58;822:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;13:00:00.000-14:57:00.000&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:59;823:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;大于等于15:00:00.000&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;825:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，可以查看引擎注册情况，正常返回如下内容：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;827:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;getStreamEngineStat()&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.3.png&#34; placement=&#34;break&#34; xtrc=&#34;image:18;830:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1146&#34; dita-ot:image-height=&#34;239&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:18;830:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;17&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;832:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-3 引擎注册情况&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;834:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:35;834:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第四步：订阅原始行情流数据表&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;836:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;838:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;subscribeTable( tableName=mdlSnapshotTBName, actionName=mdlSnapshotProcessEngineName, handler=getStreamEngine(mdlSnapshotProcessEngineName), msgAsTable=true, batchSize=100, throttle=0.002, hash=0, reconnect=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;850:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:24;852:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:60;852:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;被订阅的流数据表是原始快照行情表&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:61;853:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;消费者是原始行情快照处理引擎，即原始行情表实时流入的数据会及时发布到引擎，实时完成原始行情的加工&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;855:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，可以查看订阅情况，正常返回如下内容：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;857:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;getStreamingStat().pubTables&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.4.png&#34; placement=&#34;break&#34; xtrc=&#34;image:19;861:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;534&#34; dita-ot:image-height=&#34;219&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:19;861:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;18&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;863:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-4 订阅情况&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;34-注册缺失行情填充处理引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;865:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;865:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.4 注册缺失行情填充处理引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;865:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;867:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;按照 K 线合成流程图，正常流程应该先注册流处理引擎2，再注册流处理引擎3。但是本教程中，流处理引擎2到流处理引擎3的用到了引擎级联的功能，所以需要先定义流处理引擎3，然后定义流处理引擎2的时候，才可以指定其输出为流处理引擎3的输入。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;869:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:36;869:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第一步：创建相关流数据表&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;871:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;873:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;//Declare parameters mdlStockFundOHLCTBName = &#34;mdlStockFundOHLC&#34; //Create MDL 1-minute OHLC table share(getMDLStockFundOHLCTB(100000), mdlStockFundOHLCTBName)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;880:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:25;882:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:62;882:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;882:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;mdlStockFundOHLCTBName&lt;/codeph&gt; 流数据表用于接收流处理引擎3最终的输出，即1分钟的 K 线数据。它可以被外部应用订阅，如 Python, C++, Java, C# 等。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:113;884:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:37;884:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第二步：注册缺失行情填充处理引擎（流处理引擎3）&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:114;886:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:28;888:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;//Declare parameters mdlStockFundOHLCEngineName = &#34;mdlStockFundOHLCEngine&#34; //Define engine calculation methods convert = &amp;lt;[ TradeTime, iif(OpenPrice==0, ClosePrice, OpenPrice).nullFill(0.0), iif(HighPrice==0, ClosePrice, HighPrice).nullFill(0.0), iif(LowPrice==0, ClosePrice, LowPrice).nullFill(0.0), ClosePrice.nullFill(0.0), Volume, Turnover, TradesCount, PreClosePrice, PreCloseIOPV.nullFill(0.0), IOPV.nullFill(0.0), UpLimitPx, DownLimitPx, iif(time(TradeTime)==09:30:00.000, FirstBarChangeRate, iif(ratios(ClosePrice)!=NULL, ratios(ClosePrice)-1, 0)).nullFill(0.0) ]&amp;gt; //Create ReactiveStateEngine: mdlStockFundOHLCEngineName createReactiveStateEngine( name=mdlStockFundOHLCEngineName, metrics =convert, dummyTable=getMDLStockFundOHLCTempTB(1), outputTable=objByName(mdlStockFundOHLCTBName), keyColumn=&#34;SecurityID&#34;, keepOrder = true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:115;918:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:26;920:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:63;920:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;流处理引擎2会基于处理后的快照行情数据做步长和窗口为1分钟的滚动窗口计算，其正常输出是每个股票或基金每分钟都有一条数据。但是会存在特殊情况，非常不活跃的股票或基金会存在某一分钟内一条行情快照数据都不存在的情况，此时流处理引擎2统一用0进行填充。为了符合 K 线的计算规则，比如计算窗口缺失快照行情的 K 线，OpenPrice, HighPrice, LowPrice, ClosePrice 用前一根 K 线的 ClosePrice 填充，上述引擎就是在处理这些异常情况。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:64;921:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;流处理引擎3的输入是流处理引擎2，所以流处理引擎3不需要订阅上游流数据表。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;35-注册1分钟窗口和1分钟步长的滚动计算引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;923:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;923:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.5 注册1分钟窗口和1分钟步长的滚动计算引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;923:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:116;925:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:29;927:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;mdlStockFundOHLCTempEngineName = &#34;mdlStockFundOHLCTempEngine&#34; //Define engine calculation methods barConvert = &amp;lt;[ firstNot(LastPrice, 0), high(DeltasHighPrice, HighPrice, LastPrice), low(DeltasLowPrice, LowPrice, LastPrice), lastNot(LastPrice, 0), sum(DeltasVolume), sum(DeltasTurnover), sum(DeltasTradesCount), first(PreCloPrice), first(PreCloseIOPV), lastNot(IOPV, 0), last(UpLimitPx), last(DownLimitPx), lastNot(LastPrice, 0)\firstNot(LastPrice, 0)-1 ]&amp;gt; //Define engine fill methods fillList = [0, 0, 0, 'ffill', 0, 0, 0, 'ffill', 'ffill', 'ffill', 'ffill', 'ffill', 0] createDailyTimeSeriesEngine( name=mdlStockFundOHLCTempEngineName, windowSize=60000, step=60000, metrics=barConvert, dummyTable=objByName(mdlSnapshotProcessTBName), outputTable=getStreamEngine(mdlStockFundOHLCEngineName), timeColumn=`TradeTime, keyColumn=`SecurityID, useWindowStartTime=true, forceTriggerTime=1000, fill=fillList, sessionBegin=09:30:00.000 13:00:00.000 15:00:00.000, sessionEnd=11:31:00.000 14:58:00.000 15:01:00.000, mergeSessionEnd=true, forceTriggerSessionEndTime=30000) //Subscribe to the processed snapshot table, input incremental data into the DailyTimeSeriesEngine of mdlStockFundOHLCTempEngineName subscribeTable( tableName=mdlSnapshotProcessTBName, actionName=mdlStockFundOHLCTempEngineName, handler=getStreamEngine(mdlStockFundOHLCTempEngineName), msgAsTable=true, batchSize=100, throttle=0.01, hash=0, reconnect=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:117;975:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:27;977:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:65;977:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;此处使用了 DolphinDB 的日级时间序列聚合引擎 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;977:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DailyTimeSeriesEngine&lt;/codeph&gt;，主要用于实时计算场景下滚动窗口和滑动窗口计算。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:66;978:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;978:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;forceTriggerTime=1000&lt;/codeph&gt; 表示整个市场上，任意1个股票或基金的最新快照行情时间 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;978:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;TradeTime&lt;/codeph&gt; 大于等于窗口关闭时间（本教程中是整分时间）1000 毫秒（1秒）时，强制触发不活跃股票和基金的最新1根 K 线的计算窗口关闭并输出 K 线结果。该强制输出的时延用户可以根据实际业务需求设置。&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.5.png&#34; placement=&#34;break&#34; xtrc=&#34;image:20;980:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;741&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:20;980:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;19&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:118;982:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-5 forceTriggerTime 参数使用场景说明&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:28;984:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:67;984:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;984:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;forceTriggerSessionEndTime=30000&lt;/codeph&gt; 表示机器时间到达每一个 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;984:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;sessionEnd&lt;/codeph&gt; 的时间点后，机器时间再过 30000 毫秒（30秒）时间后，强制关闭没有输出 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;984:102&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;sessionEnd&lt;/codeph&gt; 的最后一根 K 线的股票或基金。&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.6.png&#34; placement=&#34;break&#34; xtrc=&#34;image:21;986:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1329&#34; dita-ot:image-height=&#34;563&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:21;986:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;20&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:119;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-6 forceTriggerSessionEndTime 参数使用场景说明&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;36-实时合成-k-线存入分区表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;990:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;990:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.6 实时合成 K 线存入分区表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;990:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:120;992:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程的实时 K 线合成流程中，有三张流数据表，数据内容分别是：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:29;994:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:68;994:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;原始快照行情数据： mdlSnapshotTBName&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:69;995:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;对原始快照行情加工后的数据：mdlSnapshotProcessTBName&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:70;996:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;1分钟 K 线结果数据：mdlStockFundOHLCTBName&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:121;998:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;流数据表中的数据需要存入分区表才能满足永久保存的需求，下面以1分钟 K 线结果数据为例，详细介绍如何把流数据表中实时增加的数据存入分区表中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:122;1000:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:38;1000:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第一步：创建数据库和分区表&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:123;1002:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;数据库和分区表创建代码只需执行一次，创建成功后，分区表会一直存在，不需要反复执行：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:30;1004:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;def createStockFundOHLCDfsTB(dbName, tbName){ if(existsDatabase(dbUrl=dbName)){ print(dbName + &#34; has been created !&#34;) print(tbName + &#34; has been created !&#34;) } else{ db = database(dbName, VALUE, 2021.01.01..2021.12.31) print(dbName + &#34; created successfully.&#34;) colNames = `SecurityID`TradeTime`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`ChangeRate colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE] schemaTable = table(1:0, colNames, colTypes) db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`TradeTime) print(tbName + &#34; created successfully.&#34;) } return loadTable(dbName, tbName).schema().colDefs } dbName = &#34;dfs://stockFundStreamOHLC&#34; tbName = &#34;stockFundStreamOHLC&#34; createStockFundOHLCDfsTB(dbName, tbName)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:124;1026:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:39;1026:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;第二步：订阅1分钟 K 线结果表实时存储&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:125;1028:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:31;1030:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;subscribeTable( tableName=mdlStockFundOHLCTBName, actionName=mdlStockFundOHLCTBName, handler=loadTable(&#34;dfs://stockFundStreamOHLC&#34;, &#34;stockFundStreamOHLC&#34;), msgAsTable=true, batchSize=5000, throttle=1, hash=0, reconnect=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:126;1042:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:30;1044:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:71;1044:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;为了提高实时数据写入分区表的吞吐量，建议 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;1044:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;batchSize&lt;/codeph&gt; 可以设置为5000条，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;1044:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;throttle&lt;/codeph&gt;可以设置为1秒，起到批量写入的效果。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;37-实时行情数据接入&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;1046:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;1046:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:40;1046:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.7 实时行情数据接入&lt;/b&gt;&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;1046:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:127;1048:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;完成上述步骤后，把实时快照行情接入至原始行情表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;1048:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;mdlSnapshotTBName&lt;/codeph&gt;，即可触发已经定义好的 K 线计算任务。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:128;1050:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;实时行情数据可以通过 DolphinDB 行情插件、消息中间件插件或各种语言的 API 接入，可以参考官网对应教程或者添加 DolphinDB 小助手微信号13306510479咨询。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:129;1052:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程通过 DolphinDB 的 replay 回放功能把数据库中的历史行情回放成流数据，进行调试开发。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:130;1054:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;执行下述代码，启动回放任务：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:32;1056:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;replayData = select * from loadTable(&#34;dfs://snapshotDB&#34;, &#34;snapshotTB&#34;) where TradeTime.date()=2023.02.01 order by TradeTime replay( inputTables=replayData, outputTables=mdlSnapshot, dateColumn=`TradeTime, timeColumn=`TradeTime, replayRate=-1)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:131;1069:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;回放结束后，可以执行下述代码查看流数据表中的结果数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:33;1071:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;result = select * from mdlStockFundOHLC order by SecurityID&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.7.png&#34; placement=&#34;break&#34; xtrc=&#34;image:22;1075:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1198&#34; dita-ot:image-height=&#34;470&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:22;1075:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:132;1077:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-7 流数据表中的1分钟 K 线计算结果&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:133;1079:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;可以执行下述代码查看分区表中的结果数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:34;1081:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;result = select * from loadTable(&#34;dfs://stockFundStreamOHLC&#34;, &#34;stockFundStreamOHLC&#34;) where SecurityID=`666666&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.8.png&#34; placement=&#34;break&#34; xtrc=&#34;image:23;1087:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;1207&#34; dita-ot:image-height=&#34;485&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:23;1087:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;21&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:134;1089:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-8 分区表中的1分钟 K 线计算结果&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;38-python-客户端订阅&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;1091:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;1091:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.8 Python 客户端订阅&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;1091:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:135;1093:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DolphinDB 提供了各种语言的 API 订阅接口，包括 Python, C++, Java, C# 等，具体使用方法可以参考官方 API 相关教程。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:136;1095:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程以 Python 为例，展示一个简单的第三方客户端消费 DolphinDB 流数据的例子，在 Python 环境执行下述代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:35;1097:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;import dolphindb as ddb # 与 DolphinDB 建立会话和连接 s = ddb.session() s.connect(host=&#34;192.198.1.39&#34;, port=8988, userid=&#34;admin&#34;, password=&#34;123456&#34;) # 定义 Python 端的回调函数 def handlerTestPython(msg): print(msg) # python 客户端开启 DolphinDB 订阅功能 s.enableStreaming(0) # 订阅 s.subscribe(host=&#34;192.198.1.39&#34;, port=8988, handler=handlerTestPython, tableName=&#34;mdlStockFundOHLC&#34;, actionName=&#34;testStream&#34;, offset=0, batchSize=2, throttle=0.1, msgAsTable=True)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:137;1123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;返回：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.9.png&#34; placement=&#34;break&#34; xtrc=&#34;image:24;1125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;533&#34; dita-ot:image-height=&#34;310&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:24;1125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;22&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:138;1127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图3-9 Python 客户端订阅消费结果&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:139;1129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:31;1131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:72;1131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;例子中 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:37;1131:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;offset&lt;/codeph&gt; 设置为0，表示从流数据表中的内存中的第一条历史数据开始订阅消费。所以在 Python 启动该订阅时，Python 客户端可以消费到订阅流数据表中的所有记录。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:73;1132:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;实盘中，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:38;1132:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;offset&lt;/codeph&gt; 一般设置为-1，表示从订阅启动开始，订阅消费该时刻起被订阅流数据表中的增量数据，即最新数据。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;39-dolphindb-dashboard-面板配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;1134:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;1134:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.9 DolphinDB DashBoard 面板配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;1134:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:140;1136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DolphinDB 提供了便捷的可视化数据面板配置，具体使用方法可以参考官网教程：&lt;xref class=&#34;- topic/xref &#34; href=&#34;dashboard_tutorial.dita&#34; xtrc=&#34;xref:15;1136:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;数据面板&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:141;1138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;基于该教程合成的 K 线数据配置数据面板效果如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:142;1140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/3.10.png&#34; xtrc=&#34;image:25;1140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;674&#34; dita-ot:image-height=&#34;317&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:25;1140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;23&lt;/alt&gt;&lt;/image&gt; 图3-10 DolphinDB DashBoard 资产 K 线图&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;310-清理环境&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;1143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;1143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.10 清理环境&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;1143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:143;1145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;实时计算主要依赖 DolphinDB 的流数据功能，包括订阅发布、流数据表和流计算引擎，所以清理相关环境的时候也需要把上述定义内容全部删除掉。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:144;1147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;环境清理步骤：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:32;1149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:74;1149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;删除流数据表时必须先删除所有相关订阅发布，使用 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/u/unsubscribeTable.dita&#34; xtrc=&#34;xref:16;1149:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;unsubscribeTable 函数&lt;/xref&gt;。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:75;1150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;删除流数据表使用 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/d/dropStreamTable.dita&#34; xtrc=&#34;xref:17;1150:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;dropStreamTable 函数&lt;/xref&gt;。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:76;1151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;删除流计算引擎使用 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/d/dropStreamEngine.dita&#34; xtrc=&#34;xref:18;1151:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;dropStreamEngine 函数&lt;/xref&gt;。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:145;1153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;可以执行下述代码清理本教程中流数据功能相关环境：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:36;1155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;//Declare parameters mdlSnapshotTBName = &#34;mdlSnapshot&#34; mdlSnapshotProcessTBName = &#34;mdlSnapshotProcess&#34; mdlSnapshotProcessEngineName = &#34;mdlSnapshotProcessEngine&#34; mdlStockFundOHLCTempEngineName = &#34;mdlStockFundOHLCTempEngine&#34; mdlStockFundOHLCTBName = &#34;mdlStockFundOHLC&#34; mdlStockFundOHLCEngineName = &#34;mdlStockFundOHLCEngine&#34; //Cancel related subscriptions try{unsubscribeTable(tableName=mdlSnapshotTBName, actionName=mdlSnapshotProcessEngineName)} catch(ex){print(ex)} try{unsubscribeTable(tableName=mdlSnapshotProcessTBName, actionName=mdlStockFundOHLCTempEngineName)} catch(ex){print(ex)} try{unsubscribeTable(tableName=mdlStockFundOHLCTBName, actionName=mdlStockFundOHLCTBName)} catch(ex){print(ex)} //Cancel the definition of related stream tables try{dropStreamTable(mdlSnapshotTBName)} catch(ex){print(ex)} try{dropStreamTable(mdlSnapshotProcessTBName)} catch(ex){print(ex)} try{dropStreamTable(mdlStockFundOHLCTBName)} catch(ex){print(ex)} //Cancel the definition of related stream calculation engines try{dropStreamEngine(mdlSnapshotProcessEngineName)} catch(ex){print(ex)} try{dropStreamEngine(mdlStockFundOHLCEngineName)} catch(ex){print(ex)} try{dropStreamEngine(mdlStockFundOHLCTempEngineName)} catch(ex){print(ex)}&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;311-实时计算性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;1177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;1177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.11 实时计算性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;1177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:146;1179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;表3-1 测试环境配置表&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;1181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:6;1181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:17;1181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:18;1181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;1181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:48;1181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:155;1181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;配置项&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:156;1181:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;信息&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;1183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:49;1183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:157;1183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;OS（操作系统）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:158;1183:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;CentOS Linux 7 (Core)&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:50;1184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:159;1184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;内核&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:160;1184:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.10.0-1160.el7.x86_64&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:51;1185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:161;1185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;CPU&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:162;1185:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;Intel(R) Xeon(R) Gold 5220R CPU @ 2.20GHz16 逻辑 CPU 核心&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:52;1186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:163;1186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;内存&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:164;1186:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;256 GB&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:147;1188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;表3-2 实时计算性能测试结果表&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:7;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:19;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:20;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:53;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:165;1190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;测试场景&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:166;1190:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;平均单个股票或基金单次响应计算的时延&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;1192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:54;1192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:167;1192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;实盘全市场股票和基金（6481个代码）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:168;1192:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&amp;lt;0.50 ms&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;312-流批一体-k-线合成&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;1194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;1194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;3.12 流批一体 K 线合成&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;1194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:148;1196:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;为了满足产研一体化需求，需要共用一套代码完成基于历史和实时快照行情合成 K 线的计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:149;1198:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;该需求的用户只需根据本章节基于实时快照行情数据合成 K 线的教程，把全量历史数据全速回放，然后把回放所得的 K 线计算结果存入分区表中即可。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:150;1200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;实盘实时计算，按照本章节3.7小节所述，接入实时行情数据即可。如有问题，欢迎添加 DolphinDB 小助手微信号13306510479咨询。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-总结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;1202:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;1202:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;4. 总结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;1202:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:151;1204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程详细介绍了如何在 DolphinDB 中基于历史和实时快照行情数据合成沪深北交易所股票和基金的1分钟 K 线，旨在提高 DolphinDB 在具体业务场景下的落地效率。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:152;1206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DolphinDB 在海量数据的批计算性能上表现优异，基于16个 CPU 核心完成1天沪深全市场24,285,866 行原始快照行情的降频 K 线计算只需4.7秒，输出1分钟 K 线数据量为 1,555,440 行。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:153;1208:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;DolphinDB 在大流量的实时流计算性能上表现优异，可以达到微秒级别。基于2.20GHz 主频的 CPU 实时计算沪深全市场股票和基金的1分钟 K 线的平均单票单次响应计算的时延为 500 微秒。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:154;1210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程合成 K 线的规则可能和用户实际场景有差异，用户可以根据本教程提供的源码修改后快速完成项目开发。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-常见问题解答faq&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;1212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;1212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;5. 常见问题解答（FAQ）&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;1212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;51-out-of-memory-错误导致任务失败&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;1214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;1214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;5.1 out of memory 错误导致任务失败&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;1214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:155;1216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;在使用示例教程进行海量数据并行计算的时候，可能会因为内存不足导致计算任务失败，请添加微信号13306510479 或扫描下面二维码申请测试 license。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/k/5.1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:26;1218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34; dita-ot:image-width=&#34;430&#34; dita-ot:image-height=&#34;430&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:26;1218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:156;1220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;图5-1 DolphinDB 小助手&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;52-计算结果与所述计算规则不符&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;1222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;1222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;5.2 计算结果与所述计算规则不符&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;1222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:157;1224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;本教程是基于2023年某天的全市场股票和基金快照行情开发的，可能会有一些特殊情况并没有考虑周全。用户如果在使用教程代码中发现计算结果与所属计算规则不符的情况，请及时联系 DolphinDB 小助手反馈，联系方式请查看5.1。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-附录&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;1226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;1226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;6. 附录&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;1226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:33;1228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:77;1228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;测试数据：&lt;xref class=&#34;- topic/xref &#34; format=&#34;csv&#34; href=&#34;data/k/testData.csv&#34; xtrc=&#34;xref:19;1228:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;?ditaot usertext?&gt;testData.csv&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:78;1229:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;基于历史快照行情合成 K 线的代码：&lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/k/calHistoryOHLC.dos&#34; xtrc=&#34;xref:20;1229:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;?ditaot usertext?&gt;calHistoryOHLC.dos&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:79;1230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;基于实时行情快照合成 K 线的代码：&lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/k/calStreamOHLC.dos&#34; xtrc=&#34;xref:21;1230:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/k.md&#34;&gt;&lt;?ditaot usertext?&gt;calStreamOHLC.dos&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/k.md"/><meta name="wh-out-relpath" content="tutorials/k.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="基于快照行情的股票和基金-k-线合成" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/OHLC_2.html">金融场景案例</a></div></div></li><li class="active"><div class="topicref" data-id="基于快照行情的股票和基金-k-线合成"><div class="title"><a href="../tutorials/k.html">基于快照行情的股票和基金 K 线合成</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="k-线计算-d9713e102569" class="topicref" data-id="k-线计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="k-线计算-d9713e102569-link">K 线计算</a></div></div></li><li role="treeitem"><div data-tocid="使用-klinechart-展示-dolphindb-k-线-d9713e102615" class="topicref" data-id="使用-klinechart-展示-dolphindb-k-线" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/displaying_the_dolphindb_k-line_with_klinechart.html" id="使用-klinechart-展示-dolphindb-k-线-d9713e102615-link">使用 KLineChart 展示 DolphinDB K 线</a></div></div></li><li role="treeitem"><div data-tocid="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661" class="topicref" data-id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_HDF5_vs_DolphinDB.html" id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661-link">Python + HDF5 因子计算与 DolphinDB 一体化因子计算方案对比</a></div></div></li><li role="treeitem"><div data-tocid="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707" class="topicref" data-id="python--文件存储与-dolphindb-因子计算性能比较" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_VS_PythonFile_Storage.html" id="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707-link">Python + 文件存储与 DolphinDB 因子计算性能比较</a></div></div></li><li role="treeitem"><div data-tocid="python-parser-在金融量化分析场景的应用入门-d9713e102753" class="topicref" data-id="python-parser-在金融量化分析场景的应用入门" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/py_parser__quant_fin.html" id="python-parser-在金融量化分析场景的应用入门-d9713e102753-link">Python Parser 在金融量化分析场景的应用入门</a></div></div></li><li role="treeitem"><div data-tocid="处理-level-2-行情数据实例-d9713e102799" class="topicref" data-id="处理-level-2-行情数据实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_stk_data_proc_2.html" id="处理-level-2-行情数据实例-d9713e102799-link">处理 Level-2 行情数据实例</a></div></div></li><li role="treeitem"><div data-tocid="存储金融数据的分区方案最佳实践-d9713e102845" class="topicref" data-id="存储金融数据的分区方案最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_partitioned_storage.html" id="存储金融数据的分区方案最佳实践-d9713e102845-link">存储金融数据的分区方案最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="公募基金历史数据基础分析教程-d9713e102891" class="topicref" data-id="公募基金历史数据基础分析教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/public_fund_basic_analysis.html" id="公募基金历史数据基础分析教程-d9713e102891-link">公募基金历史数据基础分析教程</a></div></div></li><li role="treeitem"><div data-tocid="股票行情回放-d9713e102937" class="topicref" data-id="股票行情回放" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_market_replay_2.html" id="股票行情回放-d9713e102937-link">股票行情回放</a></div></div></li><li role="treeitem"><div data-tocid="搭建行情回放服务的最佳实践-d9713e102983" class="topicref" data-id="搭建行情回放服务的最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/appendices_market_replay_bp.html" id="搭建行情回放服务的最佳实践-d9713e102983-link">搭建行情回放服务的最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="国内股票行情数据导入实例-d9713e103029" class="topicref" data-id="国内股票行情数据导入实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stockdata_csv_import_demo.html" id="国内股票行情数据导入实例-d9713e103029-link">国内股票行情数据导入实例</a></div></div></li><li role="treeitem"><div data-tocid="基金份额参考价值-iopv-计算-d9713e103076" class="topicref" data-id="基金份额参考价值-iopv-计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_IOPV_2.html" id="基金份额参考价值-iopv-计算-d9713e103076-link">基金份额参考价值 IOPV 计算</a></div></div></li><li role="treeitem" class="active"><div data-tocid="基于快照行情的股票和基金-k-线合成-d9713e103122" class="topicref" data-id="基于快照行情的股票和基金-k-线合成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k.html" id="基于快照行情的股票和基金-k-线合成-d9713e103122-link">基于快照行情的股票和基金 K 线合成</a></div></div></li><li role="treeitem"><div data-tocid="计算基金日频因子-d9713e103168" class="topicref" data-id="计算基金日频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/fund_factor_contrasted_by_py.html" id="计算基金日频因子-d9713e103168-link">计算基金日频因子</a></div></div></li><li role="treeitem"><div data-tocid="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214" class="topicref" data-id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/orderBookSnapshotEngine.html" id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214-link">基于逐笔数据合成高频 Orderbook：DolphinDB Orderbook 引擎</a></div></div></li><li role="treeitem"><div data-tocid="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260" class="topicref" data-id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/LoadDataForPoc.html" id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260-link">金融 PoC 用户历史数据导入指导手册之股票 Level-2 逐笔篇</a></div></div></li><li role="treeitem"><div data-tocid="金融实时实际波动率预测-d9713e103306" class="topicref" data-id="金融实时实际波动率预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ml_volatility_2.html" id="金融实时实际波动率预测-d9713e103306-link">金融实时实际波动率预测</a></div></div></li><li role="treeitem"><div data-tocid="金融因子流式实现-d9713e103352" class="topicref" data-id="金融因子流式实现" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/str_comp_fin_quant_2.html" id="金融因子流式实现-d9713e103352-link">金融因子流式实现</a></div></div></li><li role="treeitem"><div data-tocid="开发股票波动率预测模型的-676-个输入特征-d9713e103398" class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/metacode_derived_features_2.html" id="开发股票波动率预测模型的-676-个输入特征-d9713e103398-link">开发股票波动率预测模型的 676 个输入特征</a></div></div></li><li role="treeitem"><div data-tocid="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444" class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_snapshot_factor_calc_2.html" id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444-link">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="量化金融范例-d9713e103490" class="topicref" data-id="量化金融范例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/quant_finance_examples.html" id="量化金融范例-d9713e103490-link">量化金融范例</a></div></div></li><li role="treeitem"><div data-tocid="流式计算中证-1000-指数主买主卖交易量-d9713e103536" class="topicref" data-id="流式计算中证-1000-指数主买主卖交易量" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/CSI_1000_2.html" id="流式计算中证-1000-指数主买主卖交易量-d9713e103536-link">流式计算中证 1000 指数主买/主卖交易量</a></div></div></li><li role="treeitem"><div data-tocid="深度不平衡买卖压力指标波动率计算-d9713e103583" class="topicref" data-id="深度不平衡买卖压力指标波动率计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/sql_performance_optimization_wap_di_rv.html" id="深度不平衡买卖压力指标波动率计算-d9713e103583-link">深度不平衡、买卖压力指标、波动率计算</a></div></div></li><li role="treeitem"><div data-tocid="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629" class="topicref" data-id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/insight_plugin_orderbook_engine_application.html" id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629-link">实时合成自定义频订单簿快照：DolphinDB INSIGHT 行情插件与订单簿引擎应用</a></div></div></li><li role="treeitem"><div data-tocid="实时计算分钟资金流-d9713e103675" class="topicref" data-id="实时计算分钟资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_order_by_order_2.html" id="实时计算分钟资金流-d9713e103675-link">实时计算分钟资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算高频因子-d9713e103721" class="topicref" data-id="实时计算高频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hf_factor_streaming_2.html" id="实时计算高频因子-d9713e103721-link">实时计算高频因子</a></div></div></li><li role="treeitem"><div data-tocid="实时计算日累计逐单资金流-d9713e103767" class="topicref" data-id="实时计算日累计逐单资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_daily_2.html" id="实时计算日累计逐单资金流-d9713e103767-link">实时计算日累计逐单资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算涨幅榜-d9713e103813" class="topicref" data-id="实时计算涨幅榜" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/rt_stk_price_inc_calc_2.html" id="实时计算涨幅榜-d9713e103813-link">实时计算涨幅榜</a></div></div></li><li role="treeitem"><div data-tocid="实时选取外汇行情多价源最优价-d9713e103859" class="topicref" data-id="实时选取外汇行情多价源最优价" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_price_selection.html" id="实时选取外汇行情多价源最优价-d9713e103859-link">实时选取外汇行情多价源最优价</a></div></div></li><li role="treeitem"><div data-tocid="外汇掉期估值计算-d9713e103905" class="topicref" data-id="外汇掉期估值计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/FxSwapValuation.html" id="外汇掉期估值计算-d9713e103905-link">外汇掉期估值计算</a></div></div></li><li role="treeitem"><div data-tocid="因子计算平台构建-d9713e103951" class="topicref" data-id="因子计算平台构建" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_Celery.html" id="因子计算平台构建-d9713e103951-link">因子计算平台构建</a></div></div></li><li role="treeitem"><div data-tocid="因子计算最佳实践-d9713e103997" class="topicref" data-id="因子计算最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_factor_calculation.html" id="因子计算最佳实践-d9713e103997-link">因子计算最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="mvo_tutorial-d9713e104043" class="topicref" data-id="mvo_tutorial" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/MVO.html" id="mvo_tutorial-d9713e104043-link">优化投资组合：DolphinDB 最优化求解系列函数应用指南</a></div></div></li><li role="treeitem"><div data-tocid="中高频多因子库存储最佳实践-d9713e104090" class="topicref" data-id="中高频多因子库存储最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_multi_factor.html" id="中高频多因子库存储最佳实践-d9713e104090-link">中高频多因子库存储最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136" class="topicref" data-id="alphalens-在-dolphindb-中的应用因子分析建模实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Practical_Factor_Analysis_Modeling.html" id="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136-link">Alphalens 在 DolphinDB 中的应用：因子分析建模实践</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-dolphinscheduler-的集成-d9713e104182" class="topicref" data-id="dolphindb-与-dolphinscheduler-的集成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="dolphindb-与-dolphinscheduler-的集成-d9713e104182-link">DolphinDB 与 DolphinScheduler 的集成</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-python-airflow-最佳实践-d9713e104228" class="topicref" data-id="dolphindb-与-python-airflow-最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_airflow.html" id="dolphindb-与-python-airflow-最佳实践-d9713e104228-link">DolphinDB 与 Python AirFlow 最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="gplearn-d9713e104274" class="topicref" data-id="gplearn" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/gplearn.html" id="gplearn-d9713e104274-link">Shark GPLearn 快速上手</a></div></div></li><li role="treeitem"><div data-tocid="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320" class="topicref" data-id="利用jit加速计算-etf-期权隐含波动率和希腊值" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/IV_Greeks_Calculation_for_ETF_Options_Using_JIT.html" id="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320-link">利用JIT加速计算 ETF 期权隐含波动率和希腊值</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366" class="topicref" data-id="基于-dolphindb-的-brinson-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/brinson.html" id="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366-link">基于 DolphinDB 的 Brinson 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412" class="topicref" data-id="基于-dolphindb-的-campisi-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/campisi.html" id="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412-link">基于 DolphinDB 的 Campisi 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="期货分钟频cta策略回测案例-d9713e104458" class="topicref" data-id="期货分钟频cta策略回测案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/futures_minute_frequency_cta_strategy_backtest_example.html" id="期货分钟频cta策略回测案例-d9713e104458-link">期货分钟频CTA策略回测案例</a></div></div></li><li role="treeitem"><div data-tocid="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504" class="topicref" data-id="exchdata-交易所历史股票数据自动化导入功能模块使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/exchdata_exchange_historical_stock_data_auto_import_module_tutorial.html" id="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504-link">ExchData 交易所历史股票数据自动化导入功能模块使用教程</a></div></div></li><li role="treeitem"><div data-tocid="ficc_func_uasge_and_performance-d9713e104550" class="topicref" data-id="ficc_func_uasge_and_performance" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_func_uasge_and_performance.html" id="ficc_func_uasge_and_performance-d9713e104550-link">FICC 固收系列函数使用示例及性能</a></div></div></li><li role="treeitem"><div data-tocid="title1-d9713e104597" class="topicref" data-id="title1" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_funcs_application.html" id="title1-d9713e104597-link">FICC 固收系列函数应用场景</a></div></div></li><li role="treeitem"><div data-tocid="最优化函数_socp_的使用及转化案例-d9713e104643" class="topicref" data-id="最优化函数_socp_的使用及转化案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/socp_usage_case.html" id="最优化函数_socp_的使用及转化案例-d9713e104643-link">最优化函数 socp 的使用及转化案例</a></div></div></li><li role="treeitem"><div data-tocid="k_line_calculation-d9713e104689" class="topicref" data-id="k_line_calculation" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k_line_calculation%20.html" id="k_line_calculation-d9713e104689-link">基于期货快照行情数据计算合约 K 线以及主连行情</a></div></div></li><li role="treeitem"><div data-tocid="backtest_introduction_usage-d9713e104735" class="topicref" data-id="backtest_introduction_usage" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backtest_introduction_usage.html" id="backtest_introduction_usage-d9713e104735-link">融资融券策略回测使用说明及回测案例</a></div></div></li><li role="treeitem"><div data-tocid="stock_backtest-d9713e104781" class="topicref" data-id="stock_backtest" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_backtest.html" id="stock_backtest-d9713e104781-link">股票中低频投资组合回测案例实现</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">基于快照行情的股票和基金 K 线合成</h1><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">教程难度</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">中级</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">面向读者</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">已经掌握 DolphinDB 基础编程语法和 SQL 语法的用户：<ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="../progr/progr_intro.html">编程语言</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="../funcs/m/mr.html">map-reduce 函数</a></li></ul></li><li class="- topic/li li">已经掌握 DolphinDB 流数据基础功能的用户：<ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="../stream/str_table.html">流数据表</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="../stream/sub_pub.html">发布与订阅</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="../stream/reactive_state_engine.html">响应式状态引擎</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="../stream/time_series_engine.html">时序聚合引擎</a></li></ul></li><li class="- topic/li li">本教程提供了完整的测试数据和测试代码，初学者也可以跟随教程内容复现业务场景</li></ul></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-概述"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 概述</h2><div class="- topic/body body"><p class="- topic/p p">由于不同交易所不同资产的交易规则是有差异的，导致不同交易所基于快照行情或逐笔成交合成不同资产1分钟 K 线的计算方法是不同的。</p><p class="- topic/p p">本教程旨在提高 DolphinDB 在具体业务场景下的落地效率，降低 DolphinDB 在实际业务使用中的开发难度。</p><p class="- topic/p p">本教程中会学习到：</p><ul class="- topic/ul ul"><li class="- topic/li li">如何基于历史快照行情数据合成1分钟 K 线</li><li class="- topic/li li">如何基于实时快照行情数据合成1分钟 K 线</li></ul><p class="- topic/p p">本教程适用范围如下：</p><p class="- topic/p p">表1-1  教程支持 K 线合成的资产范围</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="1-概述__entry__1">交易所</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-概述__entry__2">是否支持</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__1"><strong class="+ topic/ph hi-d/b ph b">深交所-股票</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__2">是</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__1"><strong class="+ topic/ph hi-d/b ph b">深交所-基金</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__2">是</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__1"><strong class="+ topic/ph hi-d/b ph b">上交所-股票</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__2">是</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__1"><strong class="+ topic/ph hi-d/b ph b">上交所-基金</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__2">是</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__1"><strong class="+ topic/ph hi-d/b ph b">北交所-股票</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-概述__entry__2">是</td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">沪深北三大交易所股票和基金资产</strong>的交易时间段如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">早盘集合竞价：09:15:00 - 09:25:00</li><li class="- topic/li li">连续竞价：09:30:00 - 11:30:00</li><li class="- topic/li li">连续竞价：13:00:00 - 14:57:00</li><li class="- topic/li li">午盘集合竞价：14:57:00 - 15:00:00</li></ul></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-基于历史快照行情合成-k-线"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. 基于历史快照行情合成 K 线</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-快照行情数据特征"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1 快照行情数据特征</h3><div class="- topic/body body"><p class="- topic/p p">交易所 Level-1或 Level-2 快照行情的数据频率约3秒（即每个股票每隔3秒推送一条快照数据），但是并不是3秒等间隔推送。实盘行情下，平均每个股票和基金1天的快照行情数据条数约4000条左右。</p><br/><img class="- topic/image image" src="images/k/2.1.png" alt="01"/><br/><p class="- topic/p p">图2-1 活跃股票快照行情非3秒等间隔推送</p><br/><img class="- topic/image image" src="images/k/2.2.png" alt="02"/><br/><p class="- topic/p p">图2-2 不活跃基金快照行情非3秒等间隔推送</p><br/><img class="- topic/image image" src="images/k/2.3.png" alt="03"/><br/><p class="- topic/p p">图2-3 2023年2月沪深交易所股票和基金快照行情数据量统计</p><p class="- topic/p p">不同的数据供应商、不同的交易所，提供的快照行情字段都会有差异。</p><p class="- topic/p p">本教程针对沪深北交易所的股票和基金快照行情做了统一处理，数据表中的重要字段如下：</p><p class="- topic/p p">表2-1  沪深北交易所的股票和基金快照行情表结构</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="21-快照行情数据特征__entry__1">字段名称</th><th class="- topic/entry entry colsep-0 rowsep-0" id="21-快照行情数据特征__entry__2">数据类型</th><th class="- topic/entry entry colsep-0 rowsep-0" id="21-快照行情数据特征__entry__3">数据说明</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">TradeTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">TIMESTAMP</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">日期时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">SecurityID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">SYMBOL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">证券代码</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">OpenPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">开盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">PreCloPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">昨收价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">HighPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">当日最高价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">LowPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">当日最低价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">LastPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">当日最新价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">PreCloseIOPV</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">昨日 IOPV（基金）</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">IOPV</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">IOPV（基金）</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">TotalVolumeTrade</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">LONG</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">日累计成交量</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">TotalValueTrade</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">日累计成交金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">NumTrades</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">LONG</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">日累计成交笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">UpLimitPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">当日涨停价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">DownLimitPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">当日跌停价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__1">……</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__2">……</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__3">快照行情字段太多，只展示一部分</td></tr></tbody></table></div><p class="- topic/p p">本教程基于沪深北交易所的股票和基金快照行情数据合成的1分钟 K 线的表结构如下：</p><p class="- topic/p p">表2-2  1分钟 K 线表结构</p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="21-快照行情数据特征__entry__49">字段名称</th><th class="- topic/entry entry colsep-0 rowsep-0" id="21-快照行情数据特征__entry__50">数据类型</th><th class="- topic/entry entry colsep-0 rowsep-0" id="21-快照行情数据特征__entry__51">数据说明</th><th class="- topic/entry entry colsep-0 rowsep-0" id="21-快照行情数据特征__entry__52">计算规则</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">SecurityID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">SYMBOL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">证券代码</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">证券代码</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">TradeTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">TIMESTAMP</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">日期时间</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">早盘集合竞价数据纳入第一根 K 线；  第一根 K 线的输出时间是09:30:00，计算窗口为 [09:25:00, 09:31:00)K 线的输出时间为计算窗口的左边界，计算窗口规则为左闭右开；  合成 K 线一共240根，包括11:30:00, 14:57:00和15:00:00，不包括14:58:00和14:59:00</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">OpenPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">开始价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">计算窗口内的第一条快照行情的最新价；  如果开盘后没有成交，为0；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">HighPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">最高价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">计算窗口内的最高价  如果开盘后没有成交，为0；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">LowPrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">最低价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">计算窗口内的最低价  如果开盘后没有成交，为0；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">ClosePrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">收盘价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">计算窗口内的最后一条快照行情的最新价；  如果开盘后没有成交，为0；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">Volume</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">LONG</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">成交量</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">计算窗口内的所有快照行情成交量求和；  如果缺失快照行情，填充0</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">Turnover</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">成交金额</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">计算窗口内的所有快照行情成交金额求和；  如果缺失快照行情，填充0</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">TradesCount</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">INT</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">成交笔数</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">计算窗口内的所有快照行情成交笔数求和；  如果缺失快照行情，填充0</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">PreClosePrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">昨收价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">当日快照行情中的昨收价；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的昨日收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">PreCloseIOPV</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">昨日 IOPV（基金）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">基金当日快照行情中的昨日 IOPV，深交所基金有该字段，上交所基金没有该字段；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的昨日IOPV</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">IOPV</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">IOPV（基金）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">基金当日快照行情中的 IOPV，深交所基金没有该字段，上交所基金有该字段；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的昨日IOPV</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">UpLimitPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">涨停价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">当日快照行情中的涨停价，深交所有该字段，上交所没有该字段；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的涨停价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">DownLimitPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">跌停价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">当日快照行情中的跌停价，深交所有该字段，上交所没有该字段；  如果盘中计算窗口缺失快照行情，填充上一根 K 线的跌停价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__49">ChangeRate</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__50">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__51">上涨或下跌幅度</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="21-快照行情数据特征__entry__52">当前计算窗口 K 线的收盘价相比上一根 K 线的收盘价的变化幅度；  开盘第一根 K 线的涨跌幅等于 [09:25:00, 09:31:00) 计算窗口内最后一笔快照的最新价和第一笔快照的最新价的变化幅度如果缺失快照行情，填充0</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="22-快照行情合成-k-线的规则"><h3 class="- topic/title title topictitle3" id="ariaid-title5"><strong class="+ topic/ph hi-d/b ph b">2.2 快照行情合成 K 线的规则</strong></h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（1）最高价和最低价的处理</strong></p><p class="- topic/p p">因为快照行情是非等时间间隔的数据切片，所以会出现如下情况：</p><ul class="- topic/ul ul"><li class="- topic/li li">当日最高价（HighPrice）在当前计算窗口内发生变化，但是当前计算窗口内的所有最新价（LastPrice）并不包含发生在当前计算窗口内的当日最高价。</li></ul><br/><img class="- topic/image image" src="images/k/2.4.png" alt="04"/><br/><p class="- topic/p p">图2-4 最高价计算规则说明</p><ul class="- topic/ul ul"><li class="- topic/li li">当日最低价（LowPrice）在当前计算窗口内发生变化，但是当前计算窗口内的所有最新价（LastPrice）并不包含发生在当前计算窗口内的当日最低价。</li></ul><br/><img class="- topic/image image" src="images/k/2.5.png" alt="05"/><br/><p class="- topic/p p">图2-5 最低价计算规则说明</p><p class="- topic/p p">因此，1分钟 K 线的最高价的自定义计算函数如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg high(DeltasHighPrice, HighPrice, LastPrice){
	if(sum(DeltasHighPrice)&gt;0.000001){
		return max(HighPrice)
	}
	else{
		return max(LastPrice)
	}
}</code></pre><p class="- topic/p p">参数说明：</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">DeltasHighPrice：</strong> 同一个股票或基金两笔相邻快照的当日最高价（HighPrice）的差</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">HighPrice：</strong> 快照行情的当日最高价</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">LastPrice：</strong> 快照行情的当日最新价</li></ul><p class="- topic/p p">函数计算逻辑说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最高价发生变化，那么1分钟 K 线的最高价等于计算窗口内当日最高价的最大值</li><li class="- topic/li li">1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最高价没有发生变化，那么1分钟 K 线的最高价等于计算窗口内当日最新价的最大值</li></ul><p class="- topic/p p">因此，1分钟 K 线的最低价的自定义计算函数如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg low(DeltasLowPrice, LowPrice, LastPrice){
	sumDeltas = sum(DeltasLowPrice)
	if(sumDeltas&lt;-0.000001 and sumDeltas!=NULL){
		return min(iif(LowPrice==0.0, NULL, LowPrice))
	}
	else{
		return min(LastPrice)
	}
}</code></pre><p class="- topic/p p">参数说明：</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">DeltasLowPrice：</strong> 同一个股票或基金两笔相邻快照的当日最低价（LowPrice）的差</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">LowPrice：</strong> 快照行情的当日最低价</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">LastPrice：</strong> 快照行情的当日最新价</li></ul><p class="- topic/p p">函数计算逻辑说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最低价发生变化，那么1分钟 K 线的最低价等于计算窗口内当日最低价的最小值</li><li class="- topic/li li">开盘没有成交的股票或基金，推送的快照行情的最新价和最低价都为0，在当日第一个有成交的窗口内，最低价发生变化，此时计算窗口 K 线的最低价等于不为0的快照行情当日最低价的最小值，<code class="+ topic/ph pr-d/codeph ph codeph">min(iif(LowPrice==0.0, NULL, LowPrice))</code> 就是在处理此种特殊情况</li><li class="- topic/li li">1分钟 K 线计算窗口内，如果同一个股票或基金两笔相邻快照的当日最低价没有发生变化，那么1分钟 K 线的最低价等于计算窗口内当日最新价的最小值</li><li class="- topic/li li">性能优化小技巧：第三行代码的 <code class="+ topic/ph pr-d/codeph ph codeph">if</code> 判断条件，两次引用 <code class="+ topic/ph pr-d/codeph ph codeph">sum(DeltasLowPrice)</code>，建议先用变量 <code class="+ topic/ph pr-d/codeph ph codeph">sumDeltas = sum(DeltasLowPrice)</code> 进行一次聚合计算。如果在 <code class="+ topic/ph pr-d/codeph ph codeph">if</code> 判断条件写成 <code class="+ topic/ph pr-d/codeph ph codeph">if(sum(DeltasLowPrice)&lt;-0.000001 and sum(DeltasLowPrice)!=NULL)</code> ，则此处进行了两次聚合计算</li></ul><br/><img class="- topic/image image" src="images/k/2.6.png" alt="06"/><br/><p class="- topic/p p">图2-6 开盘没有成交的股票或基金的快照行情</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（2）成交量、成交额和成交笔数的处理</strong></p><p class="- topic/p p">快照行情中的成交量、成交金额和成交笔数都是日累计求和值，所以按照窗口为1分钟、步长为1分钟的滚动窗口计算前，需要先求出两笔相邻快照的增量。</p><br/><img class="- topic/image image" src="images/k/2.7.png" alt="07"/><br/><p class="- topic/p p">图2-7 快照行情中的日累计成交量、日累计成交额和成日累计交笔数</p><p class="- topic/p p">可以使用 DolphinDB 内置的 <a class="- topic/xref xref" href="../funcs/d/deltas.html">deltas 函数</a>和 <a class="- topic/xref xref" href="../progr/sql/contextBy.html">context by SQL 语句</a>进行数据预处理，具体处理代码下文会详细介绍。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（3）开盘以后没有成交</strong></p><p class="- topic/p p">部分成交不活跃的股票和基金，09:15:00 开始交易后一直没有成交，但是快照行情会正常推送。</p><br/><img class="- topic/image image" src="images/k/2.8.png" alt="08"/><br/><p class="- topic/p p">图2-8 开盘没有成交的股票或基金的快照行情</p><p class="- topic/p p">针对开盘以后一直没有成交的计算窗口，本教程处理规则如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">OpenPrice, HighPrice, LowPrice, ClosePrice, Volume, Turnover, TradesCount, ChangeRate 为0</li><li class="- topic/li li">PreClosePrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx 为快照行情中对应的值</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（4）盘中计算窗口内没有成交</strong></p><p class="- topic/p p">部分成交不活跃的股票和基金，会出现盘中某些计算窗口内完全没有成交，但是快照行情会正常推送。</p><br/><img class="- topic/image image" src="images/k/2.9.png" alt="09"/><br/><p class="- topic/p p">图2-9 盘中计算窗口内没有成交的快照行情</p><p class="- topic/p p">针对盘中没有成交的计算窗口，本教程处理规则如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">OpenPrice, HighPrice, LowPrice, ClosePrice 等于前一根 K 线的 ClosePrice</li><li class="- topic/li li">Volume, Turnover, TradesCount, ChangeRate 为0</li><li class="- topic/li li">PreClosePrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx 等于前一根 K 线对应的值</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="23-基于历史快照行情合成-k-线"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.3 基于历史快照行情合成 K 线</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步：部署测试环境</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">部署 DolphinDB 单节点：<a class="- topic/xref xref" href="standalone_server.html">单节点部署教程</a></li><li class="- topic/li li">下载测试数据，并上传到 DolphinDB 部署的 server 目录下： <a class="- topic/xref xref" href="data/k/testData.csv">testData.csv</a></li><li class="- topic/li li">根据部署教程打开节点 web 编程界面，登陆后运行后续步骤测试代码，默认 admin 账户的密码是 123456</li></ul><br/><img class="- topic/image image" src="images/k/2.10.png" alt="10"/><br/><p class="- topic/p p">图2-10 DolphinDB web 编程界面</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步：创建数据库和分区表</strong></p><p class="- topic/p p">下述数据库和分区表创建代码适用于沪深两市股票和基金 Level-2 行情快照数据共同存储在同一表中，更多关于数据库和分区表创建的方法可以参考：<a class="- topic/xref xref" href="best_practices_for_partitioned_storage.html">存储金融数据的分区方案最佳实践</a>。</p><p class="- topic/p p">粘贴下述代码至 web 编程界面，选中需要执行代码点击执行（执行快捷键：Ctrl+E）即可：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//创建数据库
create database "dfs://snapshotDB"
partitioned by VALUE(2020.01.01..2021.01.01), HASH([SYMBOL, 50])
engine='TSDB'
//创建分区表
create table "dfs://snapshotDB"."snapshotTB"(
    Market SYMBOL
    TradeTime TIMESTAMP
    MDStreamID SYMBOL
    SecurityID SYMBOL
    SecurityIDSource SYMBOL
    TradingPhaseCode SYMBOL
    ImageStatus INT
    PreCloPrice DOUBLE
    NumTrades LONG
    TotalVolumeTrade LONG
    TotalValueTrade DOUBLE
    LastPrice DOUBLE
    OpenPrice DOUBLE
    HighPrice DOUBLE
    LowPrice DOUBLE
    ClosePrice DOUBLE
    DifPrice1 DOUBLE
    DifPrice2 DOUBLE
    PE1 DOUBLE
    PE2 DOUBLE
    PreCloseIOPV DOUBLE
    IOPV DOUBLE
    TotalBidQty LONG
    WeightedAvgBidPx DOUBLE
    AltWAvgBidPri DOUBLE
    TotalOfferQty LONG
    WeightedAvgOfferPx DOUBLE
    AltWAvgAskPri DOUBLE
    UpLimitPx DOUBLE
    DownLimitPx DOUBLE
    OpenInt INT
    OptPremiumRatio DOUBLE
    OfferPrice DOUBLE[]
    BidPrice DOUBLE[]
    OfferOrderQty LONG[]
    BidOrderQty LONG[]
    BidNumOrders INT[]
    OfferNumOrders INT[]
    ETFBuyNumber INT
    ETFBuyAmount LONG
    ETFBuyMoney DOUBLE
    ETFSellNumber INT
    ETFSellAmount LONG
    ETFSellMoney DOUBLE
    YieldToMatu DOUBLE
    TotWarExNum DOUBLE
    WithdrawBuyNumber INT
    WithdrawBuyAmount LONG
    WithdrawBuyMoney DOUBLE
    WithdrawSellNumber INT
    WithdrawSellAmount LONG
    WithdrawSellMoney DOUBLE
    TotalBidNumber INT
    TotalOfferNumber INT
    MaxBidDur INT
    MaxSellDur INT
    BidNum INT
    SellNum INT
    LocalTime TIME
    SeqNo INT
    OfferOrders LONG[]
    BidOrders LONG[]
)
partitioned by TradeTime, SecurityID,
sortColumns=[`Market,`SecurityID,`TradeTime],
keepDuplicates=ALL</code></pre><p class="- topic/p p">运行不报错，即执行成功，可以执行下述代码查看分区表的表结构信息：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>loadTable("dfs://snapshotDB", "snapshotTB").schema().colDefs</code></pre><p class="- topic/p p">返回：</p><br/><img class="- topic/image image" src="images/k/2.11.png" alt="11"/><br/><p class="- topic/p p">图2-11 行情快照分区表的部分表结构信息</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第三步：导入 csv 测试数据</strong></p><p class="- topic/p p">执行下述代码，导入测试 csv 文本数据。注意，执行下述代码前，必须把测试数据 <code class="+ topic/ph pr-d/codeph ph codeph">testData.csv</code> 文件上传到DolphinDB 部署的 server 目录下。也可以把 csv 文件上传到自定义路径，例如 <code class="+ topic/ph pr-d/codeph ph codeph">/data/testData.csv</code>，此时需要下述代码的<code class="+ topic/ph pr-d/codeph ph codeph"> loadTextEx</code> 导入函数的 <code class="+ topic/ph pr-d/codeph ph codeph">filename="/data/testData.csv"</code>。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>tmp = loadTable("dfs://snapshotDB", "snapshotTB").schema().colDefs
schemaTB = table(tmp.name as name, tmp.typeString as type)
loadTextEx(dbHandle=database("dfs://snapshotDB"), tableName="snapshotTB", partitionColumns=`TradeDate`SecurityID, filename="./testData.csv", schema=schemaTB)</code></pre><p class="- topic/p p">成功导入后可以执行下述代码，查询前10行数据至内存中查看：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>data = select top 10 * from loadTable("dfs://snapshotDB", "snapshotTB")</code></pre><p class="- topic/p p">返回：</p><br/><img class="- topic/image image" src="images/k/2.12.png" alt="12"/><br/><p class="- topic/p p">图2-12 数据预览方法</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第四步：自定义最高价最低价计算函数</strong></p><p class="- topic/p p">执行下述代码，在当前会话中声明自定义函数，可以在同一个会话的后续操作中直接引用函数 <code class="+ topic/ph pr-d/codeph ph codeph">high</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">low</code>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg high(DeltasHighPrice, HighPrice, LastPrice){
	if(sum(DeltasHighPrice)&gt;0.000001){
		return max(HighPrice)
	}
	else{
		return max(LastPrice)
	}
}

defg low(DeltasLowPrice, LowPrice, LastPrice){
	sumDeltas = sum(DeltasLowPrice)
	if(sumDeltas&lt;-0.000001 and sumDeltas!=NULL){
		return min(iif(LowPrice==0.0, NULL, LowPrice))
	}
	else{
		return min(LastPrice)
	}
}</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第五步：加载少量数据至内存调试</strong></p><p class="- topic/p p">为了方便临时调试代码的正确性，可以先加载少量数据到内存中，方便后续复杂业务代码调试。</p><p class="- topic/p p">执行下述代码，加载1天2个票的数据到内存中，并赋值给表变量 <code class="+ topic/ph pr-d/codeph ph codeph">snapshotTB</code>，后续代码中，可以直接引用 <code class="+ topic/ph pr-d/codeph ph codeph">snapshotTB</code> 这个表变量调试代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>snapshotTB =	select	TradeTime, SecurityID, OpenPrice,
			PreCloPrice, HighPrice, LowPrice,
			LastPrice, PreCloseIOPV, IOPV,
			TotalVolumeTrade, TotalValueTrade, NumTrades,
			UpLimitPx, DownLimitPx
		from loadTable("dfs://snapshotDB", "snapshotTB")
		where TradeTime.date()=2023.02.01, SecurityID in `888888`999999</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第六步：原始行情快照数据处理</strong></p><p class="- topic/p p">执行下述代码，对原始的快照行情进行处理，主要进行了以下几个方面的数据加工：</p><ul class="- topic/ul ul"><li class="- topic/li li">把09:25:00-09:30:00的数据归入第一根 K 线：[09:30:00, 09:31:00]</li><li class="- topic/li li">计算同一个股票或者基金的两笔相邻快照的最高价和最低价的变化幅度</li><li class="- topic/li li">计算同一个股票或者基金的两笔相邻快照的成交量、成交金额和成交笔数的增量</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>tempTB1 =	select	TradeTime.date() as TradeDate,
			iif(TradeTime.time()&lt;=09:30:00.000, 09:30:00.000, TradeTime.time()) as TradeTime,
			SecurityID,
			OpenPrice,
			PreCloPrice,
			HighPrice,
			LowPrice,
			LastPrice,
			PreCloseIOPV,
			IOPV,
			UpLimitPx,
			DownLimitPx,
			iif(deltas(HighPrice)&gt;0.000001, 1, 0) as DeltasHighPrice,
			iif(abs(deltas(LowPrice))&gt;0.000001, -1, 0) as DeltasLowPrice,
			iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade)) as DeltasVolume,
			iif(deltas(TotalValueTrade)==NULL, TotalValueTrade, deltas(TotalValueTrade)) as DeltasTurnover,
			iif(deltas(NumTrades)==NULL, NumTrades, deltas(NumTrades)) as DeltasTradesCount
		from snapshotTB
		where TradeTime.time()&gt;=09:25:00.000
		context by SecurityID</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第七步：1分钟窗口和1分钟步长的聚合计算</strong></p><p class="- topic/p p">执行下述代码，针对处理后的快照行情做窗口为1分钟、步长为1分钟的滚动窗口计算，重要处理步骤如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">调用了自定义函数 <code class="+ topic/ph pr-d/codeph ph codeph">high</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">low </code>计算 K 线的最高价和最低价</li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">FirstBarChangeRate</code>表示当前1分钟计算窗口内，最后一条最新价不为0的快照相对第一条最新价不为0的快照的变化幅度，用于开盘第一根 K 线的涨跌幅计算</li><li class="- topic/li li">数据降频处理调用了 DolphinDB 内置函数<code class="+ topic/ph pr-d/codeph ph codeph">interval</code>，在此步骤时，针对盘中计算窗口缺失快照行情的情况，统一用0填充，后面会针对全部为0的 K 线填充数据做进一步处理</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>tempTB2 =	select	firstNot(LastPrice, 0) as OpenPrice,
			high(DeltasHighPrice, HighPrice, LastPrice) as HighPrice,
			low(DeltasLowPrice, LowPrice, LastPrice) as LowPrice,
			last(LastPrice) as ClosePrice,
			sum(DeltasVolume) as Volume,
			sum(DeltasTurnover) as Turnover,
			sum(DeltasTradesCount) as TradesCount,
			last(PreCloPrice) as PreClosePrice,
			last(PreCloseIOPV) as PreCloseIOPV,
			last(IOPV) as IOPV,
			last(UpLimitPx) as UpLimitPx,
			last(DownLimitPx) as DownLimitPx,
			lastNot(LastPrice, 0)\firstNot(LastPrice, 0)-1 as FirstBarChangeRate	
		from tempTB1
		group by SecurityID, TradeDate, interval(X=TradeTime, duration=60s, label='left', fill=0) as TradeTime</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第八步：对齐每日240根 K 线</strong></p><p class="- topic/p p">本教程实例中，合成的1分钟 K 线一共240根：</p><ul class="- topic/ul ul"><li class="- topic/li li">第一根 K 线的输出时间是09:30:00，计算窗口为 [09:25:00, 09:31:00)</li><li class="- topic/li li">全部输出包括11:30:00, 14:57:00和15:00:00，不包括14:58:00和14:59:00</li></ul><p class="- topic/p p">如果用户需要自定义输出规则，比如需要输出14:58:00和14:59:00这两个特殊时间段的 K 线，可以调整下述代码实现。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>codes = select distinct(SecurityID) as SecurityID from tempTB2 order by SecurityID
allTime = table((take(0..120, 121)*60*1000+09:30:00.000).join(take(0..117, 118)*60*1000+13:00:00.000).join(15:00:00.000) as TradeTime)
tempTB3 = cj(codes, allTime)</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第九步：缺失快照行情计算窗口填充</strong></p><p class="- topic/p p">执行下述代码，针对对齐每日240根 K 线的结果数据进行如下处理，得到最终结果：</p><ul class="- topic/ul ul"><li class="- topic/li li">针对盘中没有成交的计算窗口，OpenPrice, HighPrice, LowPrice, ClosePrice 用前一根 K 线的 ClosePrice 填充</li><li class="- topic/li li">针对盘中没有成交的计算窗口，PreClosePrice, PreCloseIOPV, IOPV, UpLimitPx, DownLimitPx 用前一根 K 线对应的值填充</li><li class="- topic/li li">开盘第一根 K 线的涨跌幅等于 [09:25:00, 09:31:00) 计算窗口内最后一笔快照的最新价和第一笔快照的最新价的变化幅度</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>result = select	SecurityID,
		concatDateTime(TradeDate, TradeTime) as TradeTime,
		iif(OpenPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), OpenPrice) as OpenPrice,
		iif(HighPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), HighPrice) as HighPrice,
		iif(LowPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), LowPrice) as LowPrice,
		iif(ClosePrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), ClosePrice) as ClosePrice,
		Volume,
		Turnover,
		TradesCount,
		iif(PreClosePrice==0.0, cumlastNot(PreClosePrice, 0.0), PreClosePrice) as PreClosePrice,
		iif(PreCloseIOPV==0.0 and PreClosePrice==0.0, cumlastNot(PreCloseIOPV, 0.0), PreCloseIOPV).nullFill(0.0) as PreCloseIOPV,
		iif(IOPV==0.0 and PreCloseIOPV==0.0, cumlastNot(IOPV, 0.0), IOPV).nullFill(0.0) as IOPV,
		iif(UpLimitPx==0.0, cumlastNot(UpLimitPx, 0.0), UpLimitPx).nullFill(0.0) as UpLimitPx,
		iif(DownLimitPx==0.0, cumlastNot(DownLimitPx, 0.0), DownLimitPx).nullFill(0.0) as DownLimitPx,
		iif(	time(TradeTime)==09:30:00.000,
			iif(FirstBarChangeRate!=NULL, FirstBarChangeRate, 0.0),
			iif(ratios(ClosePrice)!=NULL and ClosePrice!=0.0, ratios(ClosePrice)-1, 0.0)) as ChangeRate
	from lj(tempTB3, tempTB2, `TradeTime`SecurityID)
	context by SecurityID</code></pre><p class="- topic/p p">返回：</p><br/><img class="- topic/image image" src="images/k/2.13.png" alt="13"/><br/><p class="- topic/p p">图2-13 1分钟 K 线计算结果</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第十步：封装并行计算代码</strong></p><p class="- topic/p p">完成前面九个步骤，已经可以针对少量快照行情数据完成 K 线合成任务，但是针对海量历史行情数据还需进一步封装，才能实现并行计算。</p><p class="- topic/p p">可以先执行下述代码，情况当前会话中的所有临时内存变量：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>undef all</code></pre><p class="- topic/p p">然后执行下述代码，定义并行计算相关函数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg high(DeltasHighPrice, HighPrice, LastPrice){
	if(sum(DeltasHighPrice)&gt;0.000001){
		return max(HighPrice)
	}
	else{
		return max(LastPrice)
	}
}

defg low(DeltasLowPrice, LowPrice, LastPrice){
	sumDeltas = sum(DeltasLowPrice)
	if(sumDeltas&lt;-0.000001 and sumDeltas!=NULL){
		return min(iif(LowPrice==0.0, NULL, LowPrice))
	}
	else{
		return min(LastPrice)
	}
}

def calOHLCBaseOnSnapshotMapFuc(snapshotTB){
	//Processing the original snapshot market table for calculating OHLC
	tempTB1 =	select	TradeTime.date() as TradeDate,
				iif(TradeTime.time()&lt;=09:30:00.000, 09:30:00.000, TradeTime.time()) as TradeTime,
				SecurityID,
				OpenPrice,
				PreCloPrice,
				HighPrice,
				LowPrice,
				LastPrice,
				PreCloseIOPV,
				IOPV,
				UpLimitPx,
				DownLimitPx,
				iif(deltas(HighPrice)&gt;0.000001, 1, 0) as DeltasHighPrice,
				iif(abs(deltas(LowPrice))&gt;0.000001, -1, 0) as DeltasLowPrice,
				iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade)) as DeltasVolume,
				iif(deltas(TotalValueTrade)==NULL, TotalValueTrade, deltas(TotalValueTrade)) as DeltasTurnover,
				iif(deltas(NumTrades)==NULL, NumTrades, deltas(NumTrades)) as DeltasTradesCount
			from snapshotTB
			where TradeTime.time()&gt;=09:25:00.000
			context by SecurityID
	//Aggregate Calculating: temporary 1-minute OHLC table
	tempTB2 =	select	firstNot(LastPrice, 0.0) as OpenPrice,
				high(DeltasHighPrice, HighPrice, LastPrice) as HighPrice,
				low(DeltasLowPrice, LowPrice, LastPrice) as LowPrice,
				last(LastPrice) as ClosePrice,
				sum(DeltasVolume) as Volume,
				sum(DeltasTurnover) as Turnover,
				sum(DeltasTradesCount) as TradesCount,
				last(PreCloPrice) as PreClosePrice,
				last(PreCloseIOPV) as PreCloseIOPV,
				last(IOPV) as IOPV,
				last(UpLimitPx) as UpLimitPx,
				last(DownLimitPx) as DownLimitPx,
				lastNot(LastPrice, 0.0)\firstNot(LastPrice, 0.0)-1 as FirstBarChangeRate	
		from tempTB1
		group by SecurityID, TradeDate, interval(X=TradeTime, duration=60s, label='left', fill=0) as TradeTime
	//240 bars per day
	codes = select distinct(SecurityID) as SecurityID from tempTB2 order by SecurityID
	allTime = table((take(0..120, 121)*60*1000+09:30:00.000).join(take(0..117, 118)*60*1000+13:00:00.000).join(15:00:00.000) as TradeTime)
	tempTB3 = cj(codes, allTime)
	//Processing missing data calculation window, excluding opening
	result = select	SecurityID,
			concatDateTime(TradeDate, TradeTime) as TradeTime,
			iif(OpenPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), OpenPrice) as OpenPrice,
			iif(HighPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), HighPrice) as HighPrice,
			iif(LowPrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), LowPrice) as LowPrice,
			iif(ClosePrice==0.0 and PreClosePrice==0.0, cumlastNot(ClosePrice, 0.0), ClosePrice) as ClosePrice,
			Volume,
			Turnover,
			TradesCount,
			iif(PreClosePrice==0.0, cumlastNot(PreClosePrice, 0.0), PreClosePrice) as PreClosePrice,
			iif(PreCloseIOPV==0.0 and PreClosePrice==0.0, cumlastNot(PreCloseIOPV, 0.0), PreCloseIOPV).nullFill(0.0) as PreCloseIOPV,
			iif(IOPV==0.0 and PreCloseIOPV==0.0, cumlastNot(IOPV, 0.0), IOPV).nullFill(0.0) as IOPV,
			iif(UpLimitPx==0.0, cumlastNot(UpLimitPx, 0.0), UpLimitPx).nullFill(0.0) as UpLimitPx,
			iif(DownLimitPx==0.0, cumlastNot(DownLimitPx, 0.0), DownLimitPx).nullFill(0.0) as DownLimitPx,
			iif(	time(TradeTime)==09:30:00.000,
				iif(FirstBarChangeRate!=NULL, FirstBarChangeRate, 0.0),
				iif(ratios(ClosePrice)!=NULL and ClosePrice!=0.0, ratios(ClosePrice)-1, 0.0)) as ChangeRate
		from lj(tempTB3, tempTB2, `TradeTime`SecurityID)
		context by SecurityID
	return result
}

def calOHLCBaseOnSnapshot(calStartDate, calEndDate, dbName, tbName){
	//Generate data source: If SQL only contains the required columns for calculation, it can improve calculation efficiency
	dataSource = sqlDS(&lt;	select	TradeTime, SecurityID, OpenPrice,
					PreCloPrice, HighPrice, LowPrice,
					LastPrice, PreCloseIOPV, IOPV,
					TotalVolumeTrade, TotalValueTrade, NumTrades,
					UpLimitPx, DownLimitPx
				from loadTable(dbName, tbName)
				where TradeTime.date()&gt;=calStartDate, TradeTime.date()&lt;=calEndDate&gt;)
	result = mr(ds=dataSource, mapFunc=calOHLCBaseOnSnapshotMapFuc, finalFunc=unionAll{,false}, parallel=true)
	return result
}</code></pre><p class="- topic/p p">最后执行下述代码，针对一天的沪深全市场快照行情并行计算1分钟 K 线：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>calStartDate = 2023.02.01
calEndDate = 2023.02.01
dbName = "dfs://snapshotDB"
tbName = "snapshotTB"
oneDayResult = calOHLCBaseOnSnapshot(calStartDate, calEndDate, dbName, tbName)</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第十一步：1分钟 K 线数据存储</strong></p><p class="- topic/p p">首次存储数据前，需要执行下述代码创建存储1分钟 K 线所需的数据库和分区表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def createStockFundOHLCDfsTB(dbName="dfs://stockFundOHLC", tbName="stockFundOHLC"){
	if(existsDatabase(dbUrl=dbName)){
		print(dbName + " has been created !")
		print(tbName + " has been created !")
	}
	else{
		db = database(dbName, VALUE, 2021.01.01..2021.12.31)
		print(dbName + " created successfully.")
		colNames = `SecurityID`TradeTime`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`ChangeRate
		colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE]
		schemaTable = table(1:0, colNames, colTypes)
		db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`TradeTime)
		print(tbName + " created successfully.")
	}
	return loadTable(dbName, tbName).schema().colDefs
}
dbName = "dfs://stockFundOHLC"
tbName = "stockFundOHLC"
createStockFundOHLCDfsTB(dbName, tbName)</code></pre><p class="- topic/p p">执行下述代码将内存中的计算结果存入分区表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>loadTable("dfs://stockFundOHLC", "stockFundOHLC").append!(oneDayResult)</code></pre><p class="- topic/p p">查询前10行数据至内存中查看：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>data = select top 10 * from loadTable("dfs://stockFundOHLC", "stockFundOHLC")</code></pre><p class="- topic/p p">返回：</p><br/><img class="- topic/image image" src="images/k/2.14.png" alt="14"/><br/><p class="- topic/p p">图2-14 1分钟 K 线分区表查询结果</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="24-并行计算性能测试"><h3 class="- topic/title title topictitle3" id="ariaid-title7">2.4 并行计算性能测试</h3><div class="- topic/body body"><p class="- topic/p p">表2-3 测试环境配置表</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="24-并行计算性能测试__entry__1">配置项</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-并行计算性能测试__entry__2">信息</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__1">OS（操作系统）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__2">CentOS Linux 7 (Core)</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__1">内核</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__2">3.10.0-1160.el7.x86_64</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__1">CPU</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__2">Intel(R) Xeon(R) Gold 5220R CPU @ 2.20GHz16 逻辑 CPU 核心</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__1">内存</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__2">256 GB</td></tr></tbody></table></div><p class="- topic/p p">表2-4 计算性能测试结果表</p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="24-并行计算性能测试__entry__11">测试场景</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-并行计算性能测试__entry__12">原始快照行情数据</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-并行计算性能测试__entry__13">计算结果行数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-并行计算性能测试__entry__14">计算结果大小</th><th class="- topic/entry entry colsep-0 rowsep-0" id="24-并行计算性能测试__entry__15">计算耗时</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__11">1天</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__12">24,285,866 行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__13">1,555,440 行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__14">172 MB</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__15">4.3 s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__11">10天</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__12">238,691,947 行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__13">15,563,760 行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__14">1.7 GB</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__15">37.3 s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__11">1个月（20天）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__12">474,919,708 行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__13">31,158,240 行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__14">3.4 GB</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="24-并行计算性能测试__entry__15">76.5 s</td></tr></tbody></table></div><p class="- topic/p p">如果是社区版用户，在进行上述海量数据并行计算的时候，可能会因为内存不足（社区版限制最大内存使用为8 GB）导致计算任务失败，请添加微信号13306510479 或扫描下面二维码申请测试 license。</p><br/><img class="- topic/image image" src="images/k/2.15.png" alt="15"/><br/><p class="- topic/p p">图2-15 DolphinDB 技术支持</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title8" id="3-基于实时快照行情数据合成-k-线"><h2 class="- topic/title title topictitle2" id="ariaid-title8">3. 基于实时快照行情数据合成 K 线</h2><div class="- topic/body body"><p class="- topic/p p">实时快照行情数据特征和1分钟 K 线合成规则与2.1和2.2章节中的介绍一致。</p><p class="- topic/p p">基于实时快照行情数据合成 K 线的流程图如下：</p><br/><img class="- topic/image image" src="images/k/3.1.png" alt="16"/><br/><p class="- topic/p p">图3-1 基于实时快照行情数据合成 K 线的流程图</p><p class="- topic/p p">接下来将详细介绍如何在 DolphinDB 中实现1分钟 K 线的实时计算代码开发。关于 DolphinDB 的流数据功能的基础概念本教程中不再展开，可以参考官网教程：<a class="- topic/xref xref" href="../stream/str_intro.html">流数据</a>。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="31-定义创建流表所需的函数"><h3 class="- topic/title title topictitle3" id="ariaid-title9">3.1 定义创建流表所需的函数</h3><div class="- topic/body body"><p class="- topic/p p">执行下述代码，定义创建流数据表所需的函数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def getMDLSnapshotTB(tableCapacity=1000000){
	colNames = `Market`TradeTime`MDStreamID`SecurityID`SecurityIDSource`TradingPhaseCode`ImageStatus`PreCloPrice`NumTrades`TotalVolumeTrade`TotalValueTrade`LastPrice`OpenPrice`HighPrice`LowPrice`ClosePrice`DifPrice1`DifPrice2`PE1`PE2`PreCloseIOPV`IOPV`TotalBidQty`WeightedAvgBidPx`AltWAvgBidPri`TotalOfferQty`WeightedAvgOfferPx`AltWAvgAskPri`UpLimitPx`DownLimitPx`OpenInt`OptPremiumRatio`OfferPrice`BidPrice`OfferOrderQty`BidOrderQty`BidNumOrders`OfferNumOrders`ETFBuyNumber`ETFBuyAmount`ETFBuyMoney`ETFSellNumber`ETFSellAmount`ETFSellMoney`YieldToMatu`TotWarExNum`WithdrawBuyNumber`WithdrawBuyAmount`WithdrawBuyMoney`WithdrawSellNumber`WithdrawSellAmount`WithdrawSellMoney`TotalBidNumber`TotalOfferNumber`MaxBidDur`MaxSellDur`BidNum`SellNum`LocalTime`SeqNo`OfferOrders`BidOrders
	colTypes = [SYMBOL,TIMESTAMP,SYMBOL,SYMBOL,SYMBOL,SYMBOL,INT,DOUBLE,LONG,LONG,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,DOUBLE,LONG,DOUBLE,DOUBLE,LONG,DOUBLE,DOUBLE,DOUBLE,DOUBLE,INT,DOUBLE,DOUBLE[],DOUBLE[],LONG[],LONG[],INT[],INT[],INT,LONG,DOUBLE,INT,LONG,DOUBLE,DOUBLE,DOUBLE,INT,LONG,DOUBLE,INT,LONG,DOUBLE,INT,INT,INT,INT,INT,INT,TIME,INT,LONG[],LONG[]]
	return streamTable(tableCapacity:0, colNames, colTypes)
}

def getMDLSnapshotProcessTB(tableCapacity=1000000){
	colNames = `SecurityID`TradeTime`UpLimitPx`DownLimitPx`PreCloPrice`HighPrice`LowPrice`LastPrice`PreCloseIOPV`IOPV`DeltasHighPrice`DeltasLowPrice`DeltasVolume`DeltasTurnover`DeltasTradesCount
	colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT]
	return streamTable(tableCapacity:0, colNames, colTypes)
}

def getMDLStockFundOHLCTempTB(tableCapacity=1000000){
	colNames = `TradeTime`SecurityID`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`FirstBarChangeRate
	colTypes = [TIMESTAMP, SYMBOL, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE]
	return streamTable(tableCapacity:0, colNames, colTypes)
}

def getMDLStockFundOHLCTB(tableCapacity=1000000){
	colNames = `SecurityID`TradeTime`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`ChangeRate
	colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE]
	return streamTable(tableCapacity:0, colNames, colTypes)
}</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="32-定义最高价最低价计算函数"><h3 class="- topic/title title topictitle3" id="ariaid-title10"><strong class="+ topic/ph hi-d/b ph b">3.2 定义最高价最低价计算函数</strong></h3><div class="- topic/body body"><p class="- topic/p p">执行下述代码，定义计算最高价最低价所需函数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg high(DeltasHighPrice, HighPrice, LastPrice){
	if(sum(DeltasHighPrice)&gt;0.000001){
		return max(HighPrice)
	}
	else{
		return max(LastPrice)
	}
}

defg low(DeltasLowPrice, LowPrice, LastPrice){
	sumDeltas = sum(DeltasLowPrice)
	if(sumDeltas&lt;-0.000001 and sumDeltas!=NULL){
		return min(iif(LowPrice==0.0, NULL, LowPrice))
	}
	else{
		return min(LastPrice)
	}
}</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title11" id="33-注册原始行情快照数据处理引擎"><h3 class="- topic/title title topictitle3" id="ariaid-title11">3.3 注册原始行情快照数据处理引擎</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步：创建相关流数据表</strong></p><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//Declare parameters
tableCapacity = 1000000
mdlSnapshotTBName = "mdlSnapshot"
mdlSnapshotProcessTBName = "mdlSnapshotProcess"
//Create MDL snapshot table
share(getMDLSnapshotTB(tableCapacity), mdlSnapshotTBName)
//Create MDL processed snapshot table
share(getMDLSnapshotProcessTB(tableCapacity), mdlSnapshotProcessTBName)</code></pre><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">tableCapacity</code> 表示创建流数据表时预先分配的内存空间大小，如果该值小于实际接收的行情数量，则会自动扩容，扩容的时间点会有时延波动。该值也不建议设置太大，设置太大会造成内存浪费。合理的值应该是稍大于当天的全部行情数据量，这个值可以根据过去一段时间的行情数据统计得到。</li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">mdlSnapshotTBName</code> 流数据表用于接收实时快照行情，并把增量数据实时推送给原始行情快照数据处理引擎。</li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">mdlSnapshotProcessTBName</code> 流数据表用于接收引擎处理的结果数据。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步：定义原始行情快照处理引擎规则</strong></p><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//Original columns in the snapshot table
colNames = `TradeTime`UpLimitPx`DownLimitPx`PreCloPrice`HighPrice`LowPrice`LastPrice`PreCloseIOPV`IOPV
//Derived columns processed based on the original snapshot table
convert = sqlCol(colNames).append!(sqlColAlias(&lt;iif(deltas(HighPrice)&gt;0.000001, 1, 0)&gt;, `DeltasHighPrice)).append!(sqlColAlias(&lt;iif(abs(deltas(LowPrice))&gt;0.000001, -1, 0)&gt;, `DeltasLowPrice)).append!(sqlColAlias(&lt;iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade))&gt;, `DeltasVolume)).append!(sqlColAlias(&lt;iif(deltas(TotalValueTrade)==NULL, TotalValueTrade, deltas(TotalValueTrade))&gt;, `DeltasTurnover)).append!(sqlColAlias(&lt;iif(deltas(NumTrades)==NULL, NumTrades, deltas(NumTrades))&gt;, `DeltasTradesCount))</code></pre><p class="- topic/p p">可以点击本地变量查看定义的计算规则。</p><br/><img class="- topic/image image" src="images/k/3.2.png" alt="image"/><br/><p class="- topic/p p">图3-2 自定义行情数据处理规则</p><p class="- topic/p p">原始行情的加工处理包含两部分内容：</p><ul class="- topic/ul ul"><li class="- topic/li li">保留一部分原始字段的值，如市场时间、涨停价、跌停价等，在 <code class="+ topic/ph pr-d/codeph ph codeph">colNames</code> 变量中表示。</li><li class="- topic/li li">对原始字段加工处理，如基于日累计成交量计算相邻两笔快照的成交量增量，在 DolphinDB 中的处理表达式为 <code class="+ topic/ph pr-d/codeph ph codeph">&lt;iif(deltas(TotalVolumeTrade)==NULL, TotalVolumeTrade, deltas(TotalVolumeTrade))&gt;</code> ，<a class="- topic/xref xref" href="../funcs/d/deltas.html">deltas 函数</a>表示计算两条相邻数据的差，第一条快照的 <code class="+ topic/ph pr-d/codeph ph codeph">deltas(TotalVolumeTrade)</code> 计算结果为 NULL，这里用 <a class="- topic/xref xref" href="../funcs/i/iif.html">iif 函数</a>处理这种 if-else 的逻辑，第一条快照数据的成交量增量等于该条快照的 <code class="+ topic/ph pr-d/codeph ph codeph">TotalVolumeTrade</code>。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第三步：注册原始行情快照处理引擎（流处理引擎1）</strong></p><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>mdlSnapshotProcessEngineName = "mdlSnapshotProcessEngine"
createReactiveStateEngine(
	name=mdlSnapshotProcessEngineName,
	metrics =convert,
	dummyTable=objByName(mdlSnapshotTBName),
	outputTable=objByName(mdlSnapshotProcessTBName),
	keyColumn="SecurityID",
	filter=&lt;TradeTime.time() between 09:25:00.000:11:31:00.000 or TradeTime.time() between 13:00:00.000:14:57:00.000 or TradeTime.time()&gt;=15:00:00.000&gt;,
	keepOrder = true)</code></pre><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">此处使用了 DolphinDB 的响应式状态引擎 <code class="+ topic/ph pr-d/codeph ph codeph">ReactiveStateEngine</code> ，主要功能是针对输入数据做滑动窗口处理，即对每一条输入引擎的数据按照指定的计算逻辑处理，该引擎可以进行无状态和有状态计算，有状态计算函数都已经过算法优化，比如增量计算、避免重复计算等。</li><li class="- topic/li li">该引擎支持过滤输出，此处指定了只输出以下时间段的处理结果：<ul class="- topic/ul ul"><li class="- topic/li li">09:25:00.000-11:31:00.000</li><li class="- topic/li li">13:00:00.000-14:57:00.000</li><li class="- topic/li li">大于等于15:00:00.000</li></ul></li></ul><p class="- topic/p p">执行下述代码，可以查看引擎注册情况，正常返回如下内容：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>getStreamEngineStat()</code></pre><br/><img class="- topic/image image" src="images/k/3.3.png" alt="17"/><br/><p class="- topic/p p">图3-3 引擎注册情况</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第四步：订阅原始行情流数据表</strong></p><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>subscribeTable(
	tableName=mdlSnapshotTBName,
	actionName=mdlSnapshotProcessEngineName,
	handler=getStreamEngine(mdlSnapshotProcessEngineName),
	msgAsTable=true,
	batchSize=100,
	throttle=0.002,
	hash=0,
	reconnect=true)</code></pre><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">被订阅的流数据表是原始快照行情表</li><li class="- topic/li li">消费者是原始行情快照处理引擎，即原始行情表实时流入的数据会及时发布到引擎，实时完成原始行情的加工</li></ul><p class="- topic/p p">执行下述代码，可以查看订阅情况，正常返回如下内容：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>getStreamingStat().pubTables</code></pre><br/><img class="- topic/image image" src="images/k/3.4.png" alt="18"/><br/><p class="- topic/p p">图3-4 订阅情况</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="34-注册缺失行情填充处理引擎"><h3 class="- topic/title title topictitle3" id="ariaid-title12">3.4 注册缺失行情填充处理引擎</h3><div class="- topic/body body"><p class="- topic/p p">按照 K 线合成流程图，正常流程应该先注册流处理引擎2，再注册流处理引擎3。但是本教程中，流处理引擎2到流处理引擎3的用到了引擎级联的功能，所以需要先定义流处理引擎3，然后定义流处理引擎2的时候，才可以指定其输出为流处理引擎3的输入。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步：创建相关流数据表</strong></p><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//Declare parameters
mdlStockFundOHLCTBName = "mdlStockFundOHLC"
//Create MDL 1-minute OHLC table
share(getMDLStockFundOHLCTB(100000), mdlStockFundOHLCTBName)</code></pre><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">mdlStockFundOHLCTBName</code> 流数据表用于接收流处理引擎3最终的输出，即1分钟的 K 线数据。它可以被外部应用订阅，如 Python, C++, Java, C# 等。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步：注册缺失行情填充处理引擎（流处理引擎3）</strong></p><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//Declare parameters
mdlStockFundOHLCEngineName = "mdlStockFundOHLCEngine"
//Define engine calculation methods
convert = &lt;[
	TradeTime,
	iif(OpenPrice==0, ClosePrice, OpenPrice).nullFill(0.0),
	iif(HighPrice==0, ClosePrice, HighPrice).nullFill(0.0),
	iif(LowPrice==0, ClosePrice, LowPrice).nullFill(0.0),
	ClosePrice.nullFill(0.0),
	Volume,
	Turnover,
	TradesCount,
	PreClosePrice,
	PreCloseIOPV.nullFill(0.0),
	IOPV.nullFill(0.0),
	UpLimitPx,
	DownLimitPx,
	iif(time(TradeTime)==09:30:00.000, FirstBarChangeRate, iif(ratios(ClosePrice)!=NULL, ratios(ClosePrice)-1, 0)).nullFill(0.0)
]&gt;
//Create ReactiveStateEngine: mdlStockFundOHLCEngineName
createReactiveStateEngine(
	name=mdlStockFundOHLCEngineName,
	metrics =convert,
	dummyTable=getMDLStockFundOHLCTempTB(1),
	outputTable=objByName(mdlStockFundOHLCTBName),
	keyColumn="SecurityID",
	keepOrder = true)</code></pre><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">流处理引擎2会基于处理后的快照行情数据做步长和窗口为1分钟的滚动窗口计算，其正常输出是每个股票或基金每分钟都有一条数据。但是会存在特殊情况，非常不活跃的股票或基金会存在某一分钟内一条行情快照数据都不存在的情况，此时流处理引擎2统一用0进行填充。为了符合 K 线的计算规则，比如计算窗口缺失快照行情的 K 线，OpenPrice, HighPrice, LowPrice, ClosePrice 用前一根 K 线的 ClosePrice 填充，上述引擎就是在处理这些异常情况。</li><li class="- topic/li li">流处理引擎3的输入是流处理引擎2，所以流处理引擎3不需要订阅上游流数据表。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title13" id="35-注册1分钟窗口和1分钟步长的滚动计算引擎"><h3 class="- topic/title title topictitle3" id="ariaid-title13">3.5 注册1分钟窗口和1分钟步长的滚动计算引擎</h3><div class="- topic/body body"><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>mdlStockFundOHLCTempEngineName = "mdlStockFundOHLCTempEngine"
//Define engine calculation methods
barConvert = &lt;[
	firstNot(LastPrice, 0),
	high(DeltasHighPrice, HighPrice, LastPrice),
	low(DeltasLowPrice, LowPrice, LastPrice),
	lastNot(LastPrice, 0),
	sum(DeltasVolume),
	sum(DeltasTurnover),
	sum(DeltasTradesCount),
	first(PreCloPrice),
	first(PreCloseIOPV),
	lastNot(IOPV, 0),
	last(UpLimitPx),
	last(DownLimitPx),
	lastNot(LastPrice, 0)\firstNot(LastPrice, 0)-1
]&gt;
//Define engine fill methods
fillList = [0, 0, 0, 'ffill', 0, 0, 0, 'ffill', 'ffill', 'ffill', 'ffill', 'ffill', 0]
createDailyTimeSeriesEngine(
	name=mdlStockFundOHLCTempEngineName,
	windowSize=60000,
	step=60000,
	metrics=barConvert,
	dummyTable=objByName(mdlSnapshotProcessTBName),
	outputTable=getStreamEngine(mdlStockFundOHLCEngineName),
	timeColumn=`TradeTime,
	keyColumn=`SecurityID,
	useWindowStartTime=true,
	forceTriggerTime=1000,
	fill=fillList,
	sessionBegin=09:30:00.000 13:00:00.000 15:00:00.000,
	sessionEnd=11:31:00.000 14:58:00.000 15:01:00.000,
	mergeSessionEnd=true,
	forceTriggerSessionEndTime=30000)
//Subscribe to the processed snapshot table, input incremental data into the DailyTimeSeriesEngine of mdlStockFundOHLCTempEngineName
subscribeTable(
	tableName=mdlSnapshotProcessTBName,
	actionName=mdlStockFundOHLCTempEngineName,
	handler=getStreamEngine(mdlStockFundOHLCTempEngineName),
	msgAsTable=true,
	batchSize=100,
	throttle=0.01,
	hash=0,
	reconnect=true)</code></pre><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">此处使用了 DolphinDB 的日级时间序列聚合引擎 <code class="+ topic/ph pr-d/codeph ph codeph">DailyTimeSeriesEngine</code>，主要用于实时计算场景下滚动窗口和滑动窗口计算。</li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">forceTriggerTime=1000</code> 表示整个市场上，任意1个股票或基金的最新快照行情时间 <code class="+ topic/ph pr-d/codeph ph codeph">TradeTime</code> 大于等于窗口关闭时间（本教程中是整分时间）1000 毫秒（1秒）时，强制触发不活跃股票和基金的最新1根 K 线的计算窗口关闭并输出 K 线结果。该强制输出的时延用户可以根据实际业务需求设置。</li></ul><br/><img class="- topic/image image" src="images/k/3.5.png" alt="19"/><br/><p class="- topic/p p">图3-5 forceTriggerTime 参数使用场景说明</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">forceTriggerSessionEndTime=30000</code> 表示机器时间到达每一个 <code class="+ topic/ph pr-d/codeph ph codeph">sessionEnd</code> 的时间点后，机器时间再过 30000 毫秒（30秒）时间后，强制关闭没有输出 <code class="+ topic/ph pr-d/codeph ph codeph">sessionEnd</code> 的最后一根 K 线的股票或基金。</li></ul><br/><img class="- topic/image image" src="images/k/3.6.png" alt="20"/><br/><p class="- topic/p p">图3-6 forceTriggerSessionEndTime 参数使用场景说明</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title14" id="36-实时合成-k-线存入分区表"><h3 class="- topic/title title topictitle3" id="ariaid-title14">3.6 实时合成 K 线存入分区表</h3><div class="- topic/body body"><p class="- topic/p p">本教程的实时 K 线合成流程中，有三张流数据表，数据内容分别是：</p><ul class="- topic/ul ul"><li class="- topic/li li">原始快照行情数据： mdlSnapshotTBName</li><li class="- topic/li li">对原始快照行情加工后的数据：mdlSnapshotProcessTBName</li><li class="- topic/li li">1分钟 K 线结果数据：mdlStockFundOHLCTBName</li></ul><p class="- topic/p p">流数据表中的数据需要存入分区表才能满足永久保存的需求，下面以1分钟 K 线结果数据为例，详细介绍如何把流数据表中实时增加的数据存入分区表中。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步：创建数据库和分区表</strong></p><p class="- topic/p p">数据库和分区表创建代码只需执行一次，创建成功后，分区表会一直存在，不需要反复执行：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def createStockFundOHLCDfsTB(dbName, tbName){
	if(existsDatabase(dbUrl=dbName)){
		print(dbName + " has been created !")
		print(tbName + " has been created !")
	}
	else{
		db = database(dbName, VALUE, 2021.01.01..2021.12.31)
		print(dbName + " created successfully.")
		colNames = `SecurityID`TradeTime`OpenPrice`HighPrice`LowPrice`ClosePrice`Volume`Turnover`TradesCount`PreClosePrice`PreCloseIOPV`IOPV`UpLimitPx`DownLimitPx`ChangeRate
		colTypes = [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE]
		schemaTable = table(1:0, colNames, colTypes)
		db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`TradeTime)
		print(tbName + " created successfully.")
	}
	return loadTable(dbName, tbName).schema().colDefs
}
dbName = "dfs://stockFundStreamOHLC"
tbName = "stockFundStreamOHLC"
createStockFundOHLCDfsTB(dbName, tbName)</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步：订阅1分钟 K 线结果表实时存储</strong></p><p class="- topic/p p">执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>subscribeTable(
	tableName=mdlStockFundOHLCTBName,
	actionName=mdlStockFundOHLCTBName,
	handler=loadTable("dfs://stockFundStreamOHLC", "stockFundStreamOHLC"),
	msgAsTable=true,
	batchSize=5000,
	throttle=1,
	hash=0,
	reconnect=true)</code></pre><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">为了提高实时数据写入分区表的吞吐量，建议 <code class="+ topic/ph pr-d/codeph ph codeph">batchSize</code> 可以设置为5000条，<code class="+ topic/ph pr-d/codeph ph codeph">throttle</code>可以设置为1秒，起到批量写入的效果。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title15" id="37-实时行情数据接入"><h3 class="- topic/title title topictitle3" id="ariaid-title15"><strong class="+ topic/ph hi-d/b ph b">3.7 实时行情数据接入</strong></h3><div class="- topic/body body"><p class="- topic/p p">完成上述步骤后，把实时快照行情接入至原始行情表 <code class="+ topic/ph pr-d/codeph ph codeph">mdlSnapshotTBName</code>，即可触发已经定义好的 K 线计算任务。</p><p class="- topic/p p">实时行情数据可以通过 DolphinDB 行情插件、消息中间件插件或各种语言的 API 接入，可以参考官网对应教程或者添加 DolphinDB 小助手微信号13306510479咨询。</p><p class="- topic/p p">本教程通过 DolphinDB 的 replay 回放功能把数据库中的历史行情回放成流数据，进行调试开发。</p><p class="- topic/p p">执行下述代码，启动回放任务：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>replayData =	select *
		from loadTable("dfs://snapshotDB", "snapshotTB")
		where TradeTime.date()=2023.02.01
		order by TradeTime
replay(
	inputTables=replayData,
	outputTables=mdlSnapshot,
	dateColumn=`TradeTime,
	timeColumn=`TradeTime,
	replayRate=-1)</code></pre><p class="- topic/p p">回放结束后，可以执行下述代码查看流数据表中的结果数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>result = select * from mdlStockFundOHLC order by SecurityID</code></pre><br/><img class="- topic/image image" src="images/k/3.7.png" alt="image"/><br/><p class="- topic/p p">图3-7 流数据表中的1分钟 K 线计算结果</p><p class="- topic/p p">可以执行下述代码查看分区表中的结果数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>result = select *
	from loadTable("dfs://stockFundStreamOHLC", "stockFundStreamOHLC")
	where SecurityID=`666666</code></pre><br/><img class="- topic/image image" src="images/k/3.8.png" alt="21"/><br/><p class="- topic/p p">图3-8 分区表中的1分钟 K 线计算结果</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title16" id="38-python-客户端订阅"><h3 class="- topic/title title topictitle3" id="ariaid-title16">3.8 Python 客户端订阅</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供了各种语言的 API 订阅接口，包括 Python, C++, Java, C# 等，具体使用方法可以参考官方 API 相关教程。</p><p class="- topic/p p">本教程以 Python 为例，展示一个简单的第三方客户端消费 DolphinDB 流数据的例子，在 Python 环境执行下述代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>import dolphindb as ddb

# 与 DolphinDB 建立会话和连接
s = ddb.session()
s.connect(host="192.198.1.39", port=8988, userid="admin", password="123456")

# 定义 Python 端的回调函数
def handlerTestPython(msg):
    print(msg)
    
# python 客户端开启 DolphinDB 订阅功能
s.enableStreaming(0)

# 订阅
s.subscribe(host="192.198.1.39",
            port=8988,
            handler=handlerTestPython,
            tableName="mdlStockFundOHLC",
            actionName="testStream",
            offset=0,
            batchSize=2,
            throttle=0.1,
            msgAsTable=True)</code></pre><p class="- topic/p p">返回：</p><br/><img class="- topic/image image" src="images/k/3.9.png" alt="22"/><br/><p class="- topic/p p">图3-9 Python 客户端订阅消费结果</p><p class="- topic/p p">说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">例子中 <code class="+ topic/ph pr-d/codeph ph codeph">offset</code> 设置为0，表示从流数据表中的内存中的第一条历史数据开始订阅消费。所以在 Python 启动该订阅时，Python 客户端可以消费到订阅流数据表中的所有记录。</li><li class="- topic/li li">实盘中，<code class="+ topic/ph pr-d/codeph ph codeph">offset</code> 一般设置为-1，表示从订阅启动开始，订阅消费该时刻起被订阅流数据表中的增量数据，即最新数据。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title17" id="39-dolphindb-dashboard-面板配置"><h3 class="- topic/title title topictitle3" id="ariaid-title17">3.9 DolphinDB DashBoard 面板配置</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供了便捷的可视化数据面板配置，具体使用方法可以参考官网教程：<a class="- topic/xref xref" href="dashboard_tutorial.html">数据面板</a>。</p><p class="- topic/p p">基于该教程合成的 K 线数据配置数据面板效果如下：</p><p class="- topic/p p"><img class="- topic/image image" src="images/k/3.10.png" alt="23"/><br/>
图3-10 DolphinDB DashBoard 资产 K 线图</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title18" id="310-清理环境"><h3 class="- topic/title title topictitle3" id="ariaid-title18">3.10 清理环境</h3><div class="- topic/body body"><p class="- topic/p p">实时计算主要依赖 DolphinDB 的流数据功能，包括订阅发布、流数据表和流计算引擎，所以清理相关环境的时候也需要把上述定义内容全部删除掉。</p><p class="- topic/p p">环境清理步骤：</p><ul class="- topic/ul ul"><li class="- topic/li li">删除流数据表时必须先删除所有相关订阅发布，使用 <a class="- topic/xref xref" href="../funcs/u/unsubscribeTable.html">unsubscribeTable 函数</a>。</li><li class="- topic/li li">删除流数据表使用 <a class="- topic/xref xref" href="../funcs/d/dropStreamTable.html">dropStreamTable 函数</a>。</li><li class="- topic/li li">删除流计算引擎使用 <a class="- topic/xref xref" href="../funcs/d/dropStreamEngine.html">dropStreamEngine 函数</a>。</li></ul><p class="- topic/p p">可以执行下述代码清理本教程中流数据功能相关环境：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//Declare parameters
mdlSnapshotTBName = "mdlSnapshot"
mdlSnapshotProcessTBName = "mdlSnapshotProcess"
mdlSnapshotProcessEngineName = "mdlSnapshotProcessEngine"
mdlStockFundOHLCTempEngineName = "mdlStockFundOHLCTempEngine"
mdlStockFundOHLCTBName = "mdlStockFundOHLC"
mdlStockFundOHLCEngineName = "mdlStockFundOHLCEngine"
//Cancel related subscriptions
try{unsubscribeTable(tableName=mdlSnapshotTBName, actionName=mdlSnapshotProcessEngineName)} catch(ex){print(ex)}
try{unsubscribeTable(tableName=mdlSnapshotProcessTBName, actionName=mdlStockFundOHLCTempEngineName)} catch(ex){print(ex)}
try{unsubscribeTable(tableName=mdlStockFundOHLCTBName, actionName=mdlStockFundOHLCTBName)} catch(ex){print(ex)}
//Cancel the definition of related stream tables
try{dropStreamTable(mdlSnapshotTBName)} catch(ex){print(ex)}
try{dropStreamTable(mdlSnapshotProcessTBName)} catch(ex){print(ex)}
try{dropStreamTable(mdlStockFundOHLCTBName)} catch(ex){print(ex)}
//Cancel the definition of related stream calculation engines
try{dropStreamEngine(mdlSnapshotProcessEngineName)} catch(ex){print(ex)}
try{dropStreamEngine(mdlStockFundOHLCEngineName)} catch(ex){print(ex)}
try{dropStreamEngine(mdlStockFundOHLCTempEngineName)} catch(ex){print(ex)}</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title19" id="311-实时计算性能测试"><h3 class="- topic/title title topictitle3" id="ariaid-title19">3.11 实时计算性能测试</h3><div class="- topic/body body"><p class="- topic/p p">表3-1 测试环境配置表</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="311-实时计算性能测试__entry__1">配置项</th><th class="- topic/entry entry colsep-0 rowsep-0" id="311-实时计算性能测试__entry__2">信息</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__1">OS（操作系统）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__2">CentOS Linux 7 (Core)</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__1">内核</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__2">3.10.0-1160.el7.x86_64</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__1">CPU</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__2">Intel(R) Xeon(R) Gold 5220R CPU @ 2.20GHz16 逻辑 CPU 核心</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__1">内存</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__2">256 GB</td></tr></tbody></table></div><p class="- topic/p p">表3-2 实时计算性能测试结果表</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="311-实时计算性能测试__entry__11">测试场景</th><th class="- topic/entry entry colsep-0 rowsep-0" id="311-实时计算性能测试__entry__12">平均单个股票或基金单次响应计算的时延</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__11">实盘全市场股票和基金（6481个代码）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="311-实时计算性能测试__entry__12">&lt;0.50 ms</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title20" id="312-流批一体-k-线合成"><h3 class="- topic/title title topictitle3" id="ariaid-title20">3.12 流批一体 K 线合成</h3><div class="- topic/body body"><p class="- topic/p p">为了满足产研一体化需求，需要共用一套代码完成基于历史和实时快照行情合成 K 线的计算。</p><p class="- topic/p p">该需求的用户只需根据本章节基于实时快照行情数据合成 K 线的教程，把全量历史数据全速回放，然后把回放所得的 K 线计算结果存入分区表中即可。</p><p class="- topic/p p">实盘实时计算，按照本章节3.7小节所述，接入实时行情数据即可。如有问题，欢迎添加 DolphinDB 小助手微信号13306510479咨询。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title21" id="4-总结"><h2 class="- topic/title title topictitle2" id="ariaid-title21">4. 总结</h2><div class="- topic/body body"><p class="- topic/p p">本教程详细介绍了如何在 DolphinDB 中基于历史和实时快照行情数据合成沪深北交易所股票和基金的1分钟 K 线，旨在提高 DolphinDB 在具体业务场景下的落地效率。</p><p class="- topic/p p">DolphinDB 在海量数据的批计算性能上表现优异，基于16个 CPU 核心完成1天沪深全市场24,285,866 行原始快照行情的降频 K 线计算只需4.7秒，输出1分钟 K 线数据量为 1,555,440 行。</p><p class="- topic/p p">DolphinDB 在大流量的实时流计算性能上表现优异，可以达到微秒级别。基于2.20GHz 主频的 CPU 实时计算沪深全市场股票和基金的1分钟 K 线的平均单票单次响应计算的时延为 500 微秒。</p><p class="- topic/p p">本教程合成 K 线的规则可能和用户实际场景有差异，用户可以根据本教程提供的源码修改后快速完成项目开发。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title22" id="5-常见问题解答faq"><h2 class="- topic/title title topictitle2" id="ariaid-title22">5. 常见问题解答（FAQ）</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title23" id="51-out-of-memory-错误导致任务失败"><h3 class="- topic/title title topictitle3" id="ariaid-title23">5.1 out of memory 错误导致任务失败</h3><div class="- topic/body body"><p class="- topic/p p">在使用示例教程进行海量数据并行计算的时候，可能会因为内存不足导致计算任务失败，请添加微信号13306510479 或扫描下面二维码申请测试 license。</p><br/><img class="- topic/image image" src="images/k/5.1.png" alt="image"/><br/><p class="- topic/p p">图5-1 DolphinDB 小助手</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title24" id="52-计算结果与所述计算规则不符"><h3 class="- topic/title title topictitle3" id="ariaid-title24">5.2 计算结果与所述计算规则不符</h3><div class="- topic/body body"><p class="- topic/p p">本教程是基于2023年某天的全市场股票和基金快照行情开发的，可能会有一些特殊情况并没有考虑周全。用户如果在使用教程代码中发现计算结果与所属计算规则不符的情况，请及时联系 DolphinDB 小助手反馈，联系方式请查看5.1。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title25" id="6-附录"><h2 class="- topic/title title topictitle2" id="ariaid-title25">6. 附录</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">测试数据：<a class="- topic/xref xref" href="data/k/testData.csv">testData.csv</a></li><li class="- topic/li li">基于历史快照行情合成 K 线的代码：<a class="- topic/xref xref" href="script/k/calHistoryOHLC.dos">calHistoryOHLC.dos</a></li><li class="- topic/li li">基于实时行情快照合成 K 线的代码：<a class="- topic/xref xref" href="script/k/calStreamOHLC.dos">calStreamOHLC.dos</a></li></ul></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E6%A6%82%E8%BF%B0" data-tocid="1-概述">1. 概述</a></li><li class="topic-item"><a href="#2-%E5%9F%BA%E4%BA%8E%E5%8E%86%E5%8F%B2%E5%BF%AB%E7%85%A7%E8%A1%8C%E6%83%85%E5%90%88%E6%88%90-k-%E7%BA%BF" data-tocid="2-基于历史快照行情合成-k-线">2. 基于历史快照行情合成 K 线</a><ul><li class="topic-item"><a href="#21-%E5%BF%AB%E7%85%A7%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E7%89%B9%E5%BE%81" data-tocid="21-快照行情数据特征">2.1 快照行情数据特征</a></li><li class="topic-item"><a href="#22-%E5%BF%AB%E7%85%A7%E8%A1%8C%E6%83%85%E5%90%88%E6%88%90-k-%E7%BA%BF%E7%9A%84%E8%A7%84%E5%88%99" data-tocid="22-快照行情合成-k-线的规则"><strong class="+ topic/ph hi-d/b ph b">2.2 快照行情合成 K 线的规则</strong></a></li><li class="topic-item"><a href="#23-%E5%9F%BA%E4%BA%8E%E5%8E%86%E5%8F%B2%E5%BF%AB%E7%85%A7%E8%A1%8C%E6%83%85%E5%90%88%E6%88%90-k-%E7%BA%BF" data-tocid="23-基于历史快照行情合成-k-线">2.3 基于历史快照行情合成 K 线</a></li><li class="topic-item"><a href="#24-%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="24-并行计算性能测试">2.4 并行计算性能测试</a></li></ul></li><li class="topic-item"><a href="#3-%E5%9F%BA%E4%BA%8E%E5%AE%9E%E6%97%B6%E5%BF%AB%E7%85%A7%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E5%90%88%E6%88%90-k-%E7%BA%BF" data-tocid="3-基于实时快照行情数据合成-k-线">3. 基于实时快照行情数据合成 K 线</a><ul><li class="topic-item"><a href="#31-%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E6%B5%81%E8%A1%A8%E6%89%80%E9%9C%80%E7%9A%84%E5%87%BD%E6%95%B0" data-tocid="31-定义创建流表所需的函数">3.1 定义创建流表所需的函数</a></li><li class="topic-item"><a href="#32-%E5%AE%9A%E4%B9%89%E6%9C%80%E9%AB%98%E4%BB%B7%E6%9C%80%E4%BD%8E%E4%BB%B7%E8%AE%A1%E7%AE%97%E5%87%BD%E6%95%B0" data-tocid="32-定义最高价最低价计算函数"><strong class="+ topic/ph hi-d/b ph b">3.2 定义最高价最低价计算函数</strong></a></li><li class="topic-item"><a href="#33-%E6%B3%A8%E5%86%8C%E5%8E%9F%E5%A7%8B%E8%A1%8C%E6%83%85%E5%BF%AB%E7%85%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%BC%95%E6%93%8E" data-tocid="33-注册原始行情快照数据处理引擎">3.3 注册原始行情快照数据处理引擎</a></li><li class="topic-item"><a href="#34-%E6%B3%A8%E5%86%8C%E7%BC%BA%E5%A4%B1%E8%A1%8C%E6%83%85%E5%A1%AB%E5%85%85%E5%A4%84%E7%90%86%E5%BC%95%E6%93%8E" data-tocid="34-注册缺失行情填充处理引擎">3.4 注册缺失行情填充处理引擎</a></li><li class="topic-item"><a href="#35-%E6%B3%A8%E5%86%8C1%E5%88%86%E9%92%9F%E7%AA%97%E5%8F%A3%E5%92%8C1%E5%88%86%E9%92%9F%E6%AD%A5%E9%95%BF%E7%9A%84%E6%BB%9A%E5%8A%A8%E8%AE%A1%E7%AE%97%E5%BC%95%E6%93%8E" data-tocid="35-注册1分钟窗口和1分钟步长的滚动计算引擎">3.5 注册1分钟窗口和1分钟步长的滚动计算引擎</a></li><li class="topic-item"><a href="#36-%E5%AE%9E%E6%97%B6%E5%90%88%E6%88%90-k-%E7%BA%BF%E5%AD%98%E5%85%A5%E5%88%86%E5%8C%BA%E8%A1%A8" data-tocid="36-实时合成-k-线存入分区表">3.6 实时合成 K 线存入分区表</a></li><li class="topic-item"><a href="#37-%E5%AE%9E%E6%97%B6%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%85%A5" data-tocid="37-实时行情数据接入"><strong class="+ topic/ph hi-d/b ph b">3.7 实时行情数据接入</strong></a></li><li class="topic-item"><a href="#38-python-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%A2%E9%98%85" data-tocid="38-python-客户端订阅">3.8 Python 客户端订阅</a></li><li class="topic-item"><a href="#39-dolphindb-dashboard-%E9%9D%A2%E6%9D%BF%E9%85%8D%E7%BD%AE" data-tocid="39-dolphindb-dashboard-面板配置">3.9 DolphinDB DashBoard 面板配置</a></li><li class="topic-item"><a href="#310-%E6%B8%85%E7%90%86%E7%8E%AF%E5%A2%83" data-tocid="310-清理环境">3.10 清理环境</a></li><li class="topic-item"><a href="#311-%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="311-实时计算性能测试">3.11 实时计算性能测试</a></li><li class="topic-item"><a href="#312-%E6%B5%81%E6%89%B9%E4%B8%80%E4%BD%93-k-%E7%BA%BF%E5%90%88%E6%88%90" data-tocid="312-流批一体-k-线合成">3.12 流批一体 K 线合成</a></li></ul></li><li class="topic-item"><a href="#4-%E6%80%BB%E7%BB%93" data-tocid="4-总结">4. 总结</a></li><li class="topic-item"><a href="#5-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94faq" data-tocid="5-常见问题解答faq">5. 常见问题解答（FAQ）</a><ul><li class="topic-item"><a href="#51-out-of-memory-%E9%94%99%E8%AF%AF%E5%AF%BC%E8%87%B4%E4%BB%BB%E5%8A%A1%E5%A4%B1%E8%B4%A5" data-tocid="51-out-of-memory-错误导致任务失败">5.1 out of memory 错误导致任务失败</a></li><li class="topic-item"><a href="#52-%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%9C%E4%B8%8E%E6%89%80%E8%BF%B0%E8%AE%A1%E7%AE%97%E8%A7%84%E5%88%99%E4%B8%8D%E7%AC%A6" data-tocid="52-计算结果与所述计算规则不符">5.2 计算结果与所述计算规则不符</a></li></ul></li><li class="topic-item"><a href="#6-%E9%99%84%E5%BD%95" data-tocid="6-附录">6. 附录</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>