<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="DolphinDB 从 1.30.6 版本开始支持更新分布式表数据。更新操作支持事务，具备事务 ACID 的特性，且通过 MVCC 实现快照隔离级别。DolphinDB 为多模数据库，目前支持两种存储引擎：OLAP 和 TSDB（详见 DolphinDB 数据模型，不同引擎的更新操作的原理和性能不同。本文将分别介绍两种存储引擎的更新操作相关的原理，并通过实验验证和分析相关性能。 DolphinDB ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="分布式表数据更新原理和性能"/><title>分布式表数据更新原理和性能</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;分布式表数据更新原理和性能&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;分布式表数据更新原理和性能&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:12;27:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-概述&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;1. 概述&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;DolphinDB 从 1.30.6 版本开始支持更新分布式表数据。更新操作支持事务，具备事务 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://en.wikipedia.org/wiki/ACID&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;5:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;?ditaot usertext?&gt;ACID&lt;/xref&gt; 的特性，且通过 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://en.wikipedia.org/wiki/Multiversion_concurrency_control&#34; scope=&#34;external&#34; xtrc=&#34;xref:2;5:100&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;?ditaot usertext?&gt;MVCC&lt;/xref&gt; 实现快照隔离级别。DolphinDB 为多模数据库，目前支持两种存储引擎：OLAP 和 TSDB（详见 DolphinDB 数据模型，不同引擎的更新操作的原理和性能不同。本文将分别介绍两种存储引擎的更新操作相关的原理，并通过实验验证和分析相关性能。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-使用方法&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;2. 使用方法&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;DolphinDB 提供 3 种更新分布式表的方法：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;11:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;标准 SQL 的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;11:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;update&lt;/codeph&gt; 语法（注意，DolphinDB 仅支持关键字小写）；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;13:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;13:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;sqlUpdate&lt;/codeph&gt;方法，动态生成 SQL update 语句的元代码。生成元代码后，通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;13:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;eval&lt;/codeph&gt; 函数执行。具体用法见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;meta_programming.md&#34; xtrc=&#34;xref:3;13:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;元编程&lt;/xref&gt;；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;15:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;15:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;upsert!&lt;/codeph&gt; 方法，若新数据的主键值已存在，更新该主键值的数据；否则添加数据。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;下面通过一个简单的例子介绍更新分布式表的 3 种方法：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;19:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通过 update SQL 和 sqlUpdate 方法更新所有 ID=1 的行的 vol 列数据；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;21:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通过 upsert! 更新第一个 ID=1 所在行的 date 和 vol 列数据。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;23:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;使用附件脚本建库表；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;25:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新数据：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;27:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;方法 1，下列 update SQL 语句执行后，ID 为 1 的所有记录的 vol 值更新为 1：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;29:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;update pt set vol = 1 where ID = 1&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;33:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;方法 2，下列 sqlUpdate 语句执行后，ID 为 1 的所有记录的 vol 值更新为 2：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;35:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;sqlUpdate(pt, &amp;lt;2 as vol&amp;gt;, where=&amp;lt;ID = 1&amp;gt;).eval()&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;38:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;方法 3，下列 upsert! 语句执行后，第一个 ID=1 所在记录的 date 更新为 2022.08.07，vol 更新为 3：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;40:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;newData = table(1 as ID, 2022.08.07 as date, 3 as vol) upsert!(pt, newData, keyColNames=`ID)&lt;/codeblock&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-存储机制简介&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;3. 存储机制简介&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在了解更新原理之前，需要先简单了解 DolphinDB 的存储机制。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;DolphinDB 内置分布式文件系统 DFS，由其统一管理各个节点的存储空间，在对数据集进行分割时，可以全局优化，规避数据分布不均匀等问题。通过 DFS，我们可以将同一集群中不同数据节点上的存储文件夹组织起来，形成一个单独的、逻辑的、层次式的共享文件系统。更多分区数据库介绍可以参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;database.md&#34; xtrc=&#34;xref:4;49:143&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;《DolphinDB 教程：分区数据库》&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;DolphinDB 提供配置项 volume，可以为每个节点指定数据文件的存储路径，用户可以通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;51:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;pnodeRun(getAllStorages)&lt;/codeph&gt; 查询路径。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-olap-引擎存储结构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;3.1. OLAP 引擎存储结构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在 OLAP 中，每个分区内部都会为表的每列数据分别存储一个列文件。例如第 2 节脚本创建的使用 OLAP 引擎的表 pt，其分区 [0, 50) 的数据文件保存在 &amp;lt;volumes&amp;gt;/CHUNKS/db1/0_50/gA/pt_2 路径下，其中：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;57:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;db1 为库名；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;59:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;0_50 为范围分区 [0, 50)；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;61:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;gA 为表的物理名索引，于 1.30.16/2.00.4 版本为支持表级分区时引入；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;63:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;pt_2 为 pt 表的版本文件夹，其中“_2“指表在库内的序号，于 1.30.1 版本支持 renameTable 特性时引入。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;用户可以进入库名目录，通过 tree 命令查看表的数据文件目录结构，如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── 0_50 │   └── gA │   └── pt_2 │   ├── date.col │   ├── ID.col │   └── vol.col ├── 50_100 │   └── gA │   └── pt_2 │   ├── date.col │   ├── ID.col │   └── vol.col ├── dolphindb.lock ├── domain └── pt.tbl 6 directories, 9 files&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-tsdb-引擎存储结构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;3.2. TSDB 引擎存储结构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;TSDB 引擎以 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://en.wikipedia.org/wiki/Log-structured_merge-tree&#34; scope=&#34;external&#34; xtrc=&#34;xref:5;91:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;?ditaot usertext?&gt;LSM 树（Log Structured Merge Tree）&lt;/xref&gt;的结构存储表数据。例如第 2 节脚本创建的使用 TSDB 引擎的表 pt1，分区 [0, 50) 的数据文件保存在 &amp;lt;volumes&amp;gt;/CHUNKS/TSDB_db1/0_50/gE/pt1_2 路径下，路径组成同 OLAP 引擎。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在库名目录使用 tree 命令查看内容，可以看到 pt1 表的 level file，也就是 LSM 树的分层数据文件，如下所示，其中开头下划线前的数字表示层级，目前支持 4 层：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── 0_50 │   └── gE │   ├── chunk.dict │   └── pt1_2 │   └── 0_00000623 ├── 50_100 │   └── gE │   ├── chunk.dict │   └── pt1_2 │   └── 0_00000624 ├── dolphindb.lock ├── domain&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;如果 level file 未及时生成，用户可以执行 flushTSDBCache()，将 TSDB 引擎缓冲区里已经完成的事务强制写入磁盘。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-数据更新原理&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4. 数据更新原理&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;116:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;下面分别介绍 OLAP 和 TSDB 存储引擎更新分布式表数据的基本原理。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-olap-存储引擎更新原理&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4.1. OLAP 存储引擎更新原理&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;411-更新流程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4.1.1. 更新流程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;image class=&#34;- topic/image &#34; height=&#34;500&#34; href=&#34;images/dolphindb_update/olap_update_flowchart.png&#34; width=&#34;800&#34; xtrc=&#34;image:1;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; dita-ot:image-width=&#34;3208&#34; dita-ot:image-height=&#34;2248&#34; dita-ot:horizontal-dpi=&#34;400&#34; dita-ot:vertical-dpi=&#34;400&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;124:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;分布式表数据更新过程是一个事务，采用 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://en.wikipedia.org/wiki/Two-phase_commit_protocol&#34; scope=&#34;external&#34; xtrc=&#34;xref:6;124:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;?ditaot usertext?&gt;两阶段提交&lt;/xref&gt;协议和 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://en.wikipedia.org/wiki/Multiversion_concurrency_control&#34; scope=&#34;external&#34; xtrc=&#34;xref:7;124:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;?ditaot usertext?&gt;MVCC&lt;/xref&gt; 机制，OLAP 引擎数据更新的具体流程如下：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:2;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;126:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;向控制节点申请创建事务，控制节点会给涉及的分区加锁，并分配事务 tid，返回分区 chunk ID 等信息；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;128:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;判断是否开启 OLAP cache engine：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:3;130:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;130:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;如果开启了 cache engine，先刷写所有已完成的事务的缓存数据到磁盘；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;131:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;数据写入 redo log；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;132:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在数据节点上创建事务和对应临时目录，并更新数据到该目录下。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;134:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通过事务 tid 生成一个临时的路径，格式为”physicalDir_tid_tidValue”，并把数据更新到该目录下。如果某些列的数据无变化，则直接创建原列文件的硬链接；对于 linux 这种支持硬链接但不支持跨 volume，或类似 beegfs 这种不支持硬链接的文件系统，则采用复制的方式来解决。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;136:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;如果没有开启 cache engine，只做第 2.3 步；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;138:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;向控制节点申请事务提交的 cid。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;140:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新事务 commit 时，生成一个单调递增的 cid，即 Commit ID 作为提交动作的唯一标识，每个表的元数据有一个 createCids 数组记录该 cid；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;142:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;142:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通知所有事务参与者提交事务：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:4;144:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;144:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;写 commit redo log 并持久化到磁盘；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;145:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;重命名临时目录为 &#34;physicalDir_cid&#34;；&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;147:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通知所有事务参与者完成事务，写 complete redo log。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;149:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;不管参与者节点是否成功完成事务，协调者都标记完成事务。如果有失败的情况，通过事务决议和 recovery 机制来恢复。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;151:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;事务结束后，最终只会保留最后一个版本，因为程序启动后，其他版本都是历史数据，应该回收掉，不应该继续保留。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;412-定期回收机制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4.1.2. 定期回收机制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在实际操作中，用户常常会进行多次数据更新，导致上述目录序列不断增加。为此，系统提供了定期垃圾回收的机制。默认情况下，系统每隔 60 秒回收一定时间值之前更新生成的目录。在开始周期性垃圾回收前，系统最多保留 5 个更新版本。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;413-快照隔离级别&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4.1.3. 快照隔离级别&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新数据的整个过程是一个事务，满足 ACID 特性，且通过多版本并发控制机制（MVCC, Multi-Version Concurrency Control）进行读写分离，保证了数据在更新时不影响读取。例如，不同用户同时对相同数据表进行更新和查询操作时，系统将根据操作发生的顺序为其分配 cid，并将它们和 createCids 数组里的版本号对比，寻找所有版本号中值最大且小于 cid 的文件路径，此路径即为该 cid 对应的操作路径。如需要在线获取最新的 cid，可执行 getTabletsMeta().createCids 命令。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-tsdb-存储引擎更新原理&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4.2. TSDB 存储引擎更新原理&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;421-建表参数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4.2.1. 建表参数&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;DolphinDB TSDB 引擎在建表时另外提供了两个参数：sortColumns 和 keepDuplicates。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;167:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;sortColumns：用于指定表的排序列。系统默认 sortColumns 最后一列为时间列，其余列字段作为排序的索引列，其组合值称作 sortKey。目前不支持更新 sortColumes 列。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;169:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;keepDuplicates：用于去重，即指定在每个分区内如何处理所有 sortColumns 的值相同的数据。参数默认值为 ALL，表示保留所有数据；取值为 LAST 表示仅保留最新数据；取值为 FIRST 表示仅保留第一条数据。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;422-更新策略&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;4.2.2. 更新策略&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;不同的 keepDuplicates 参数值，会有不同的数据更新策略。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;175:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;keepDuplicates=LAST&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;177:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;这种情况下数据更新实质上是向 LSM 树的内存缓冲区追加数据。这部分数据最终会持久化到 level 0 层级的 level file 里，故不会产生新的版本目录。通过在 LSM 树中增加 cid 列来实现 MVCC。查询时，TSDB 引擎会做过滤，只返回最新的数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;179:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;写入量达到一定值或更新后一段时间内，会自动合并 level file 以节省硬盘空间。若未及时触发 level file 的合并，可以手动执行 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;179:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;triggerTSDBCompaction()&lt;/codeph&gt; 强制触发指定 chunk 内 level 0 级别的所有 level file 的合并操作。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;181:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新流程图如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;183:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;image class=&#34;- topic/image &#34; height=&#34;500&#34; href=&#34;images/dolphindb_update/tsdb_last_update_flowchart.png&#34; width=&#34;800&#34; xtrc=&#34;image:2;183:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; dita-ot:image-width=&#34;3368&#34; dita-ot:image-height=&#34;2488&#34; dita-ot:horizontal-dpi=&#34;400&#34; dita-ot:vertical-dpi=&#34;400&#34;/&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:5;185:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;185:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;185:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;向控制节点申请创建事务，控制节点会给涉及的分区加锁，并分配事务 tid，返回分区 chunk ID 等信息；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;187:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;187:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;TSDB 必须开启 cache engine：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:6;189:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;189:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;刷写 cache engine 里所有已完成的事务的缓存数据到磁盘；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;190:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;数据写入 redo log；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;191:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;读取需要更新的数据到内存并更新，即只读取需要更新的 level file 的部分数据；&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;193:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;193:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;向控制节点申请事务提交的 cid。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;195:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新事务 commit 时，生成一个单调递增的 cid，即 Commit ID 作为提交动作的唯一标识，每个表的元数据有一个 createCids 数组记录该 cid；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;197:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;197:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通知所有事务参与者提交事务，写 commit redo log 并持久化到磁盘；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;199:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;199:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通知所有事务参与者完成事务：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:7;201:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;201:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;写 complete redo log；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;202:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;写入更新的数据到 cache engine，cache engine 的后台线程会异步写入数据到磁盘。&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/p&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;204:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;keepDuplicates=FIRST 或 keepDuplicates=ALL&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;206:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在这两种情况下，更新操作流程与 OLAP 基本相同，也是采用两阶段提交协议，每个分区每次更新产生一个独立的目录，且整个更新过程是一个事务，具备 ACID 特性，通过 MVCC 实现快照隔离级别。过期版本的清理机制也与 OLAP 相同。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;208:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;但是第 2.3 步读取要更新的数据到内存并更新到临时目录，TSDB keepDuplicates=FIRST 或 ALL 策略与 OLAP 不同，会读出所有文件进行更新，即未变化的列也会被更新，然后将更新的 level file 信息写入到元数据中。因此，我们也建议用户首先确定分区数据量较小（不能大于可用内存空间）再进行更新操作，否则容易导致内存溢出。&lt;/p&gt;&lt;/li&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-数据更新实验&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5. 数据更新实验&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;接下来我们通过实验来验证数据更新的基本原理，并对比分析 OLAP 和 TSDB 引擎在常见场景的性能特点。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;51-实验准备&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.1. 实验准备&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;511-部署集群&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.1.1. 部署集群&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;218:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;Linux 系统&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;220:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;DolphinDB v2.00.7 版本&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;222:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;单机集群部署 1 个控制节点 +1 个数据节点&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;224:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;单 SSD 硬盘，硬盘速度为 6 Gbps，文件系统为 xfs&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;226:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;开启 cache engine 和 redo log&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;512-创建库表和写入数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.1.2. 创建库表和写入数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;iot_examples.md&#34; xtrc=&#34;xref:8;230:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;《DolphinDB 入门：物联网范例》&lt;/xref&gt;第 2.3、2.4 节，创建多值模型数据库表，并写入数据。注意此处&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/multipleValueModeWrite.txt&#34; xtrc=&#34;xref:9;230:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;?ditaot usertext?&gt;脚本&lt;/xref&gt;为异步写入，可以通过 getRecentJobs() 方法查看写入是否完成。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;本实验将模拟 100 台机器 5 天的数据量，每台机器每天产生 86400 条记录，5 天总数据量为 43200000 条。OLAP 和 TSDB 引擎的基本数据和建库名如下表所示：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:1;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;234:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;OLAP&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;234:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;TSDB&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;占用磁盘空间&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;236:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;8.3 GB&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;236:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;8.3 G&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:7;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;每个分区大小&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:8;237:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;169 MB&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;237:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;170 MB&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:10;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;建库名&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:11;238:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;olapDemo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:12;238:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;tsdbDemo&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;参考以下脚本修改&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;iot_examples.md&#34; xtrc=&#34;xref:10;240:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;《DolphinDB 入门：物联网范例》&lt;/xref&gt;2.3 节的 createDatabase 函数。注意实验中需要修改 createPartitionedTable 函数的 keepDuplicates 参数值：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;def createDatabase(dbName,tableName, ps1, ps2, numMetrics){ m = &#34;tag&#34; + string(1..numMetrics) schema = table(1:0,`id`datetime join m, [INT,DATETIME] join take(FLOAT,numMetrics) ) db1 = database(&#34;&#34;,VALUE,ps1) db2 = database(&#34;&#34;,RANGE,ps2) db = database(dbName,COMPO,[db1,db2],,'TSDB') db.createPartitionedTable(schema,tableName,`datetime`id ,,`id`datetime, keepDuplicates=LAST) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;253:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;实验的基本思路为观察执行 update 语句前后数据目录和文件的变化与上文阐述的原理是否一致。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;52-olap-引擎更新实验&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.2. OLAP 引擎更新实验&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;257:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:41;257:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;257:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新前&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;259:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;首先进入到需要更新的数据所在目录，默认位置在 &amp;lt;HomeDir&amp;gt;/&amp;lt;nodeAlias&amp;gt;/storage/CHUNKS/olapDemo/20200901/1_11/2。其中，最后的 2 为表的物理名索引。通过 tree 命令查看 machines 表的列数据文件：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;261:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . └── 2 └── machines_2 ├── datetime.col ├── id.col ├── tag10.col ├── tag11.col ... └── tag9.col&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:42;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;274:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;执行更新&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;276:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在 GUI 执行如下脚本，对分区 20200901 下分区 1_11 里的数据进行 20 次更新：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;278:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;machines = loadTable(&#34;dfs://olapDemo&#34;, &#34;machines&#34;) for(i in 0..20) update machines set tag1=i,tag5=i where id in 1..5,date(datetime)=2020.09.01&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;284:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新过程中使用 ll 命令可以看到，命名带 tid 的中间文件夹已生成：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;286:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ ll total 20 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_115 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_116 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_117 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_118 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_119 drwxrwxr-x 2 dolphindb dolphindb 120 Sep 7 05:26 machines_2_tid_120&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:43;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;297:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新后&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;299:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;查看目录文件，如果没触发周期性清理旧版本，可以看到只保留了 5 个更新版本：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;301:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ ll total 20 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_121 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_122 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_123 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_124 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_125&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;311:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在触发周期性清理旧版本前，使用 ll 命令查看更新后的列数据文件，注意到只有更新的列 tag1 和 tag5 的数据文件链接数为 1，其他数据文件链接数均为 5 即硬链接。这是因为只更新了 tag1 和 tag5 的列，其他列无变化，因此直接创建了硬链接。如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ ll machines_2_125/ total 169632 -rw-rw-r-- 5 dolphindb dolphindb 3469846 Sep 7 05:15 datetime.col -rw-rw-r-- 5 dolphindb dolphindb 14526 Sep 7 05:15 id.col -rw-rw-r-- 5 dolphindb dolphindb 3469845 Sep 7 05:15 tag10.col -rw-rw-r-- 5 dolphindb dolphindb 3469846 Sep 7 05:15 tag11.col ... -rw-rw-r-- 1 dolphindb dolphindb 1742158 Sep 7 05:26 tag1.col ... -rw-rw-r-- 1 dolphindb dolphindb 1742158 Sep 7 05:26 tag5.col ...&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;327:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新后过一段时间，发现只保留了最新的版本。这是因为系统会定时进行回收，最终只保留一个最新的副本。如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;329:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ ll total 4 drwxrwxr-x 2 dolphindb dolphindb 4096 Sep 7 05:26 machines_2_125&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;53-tsdb-引擎更新实验&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.3. TSDB 引擎更新实验&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;531-keepduplicates--last&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.3.1. keepDuplicates = LAST&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;339:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:44;339:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;339:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新前&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;341:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;首先设置 createPartitionedTable 方法的 keepDuplicates 参数为 LAST，然后建库和导入数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;343:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;进入需要更新的数据所在的目录，默认位置在 &amp;lt;HomeDir&amp;gt;/&amp;lt;nodeAlias&amp;gt;/storage/CHUNKS/tsdbDemo/20200901/1_11/S，最后的 S 为表的物理名索引。用 tree 命令查看 machines 表的 level file：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;345:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── chunk.dict └── machines_2 ├── 0_00000010 ├── 0_00000011 ├── 0_00000012 ├── 0_00000013 ├── 0_00000014 └── 1_00000002 1 directory, 7 files&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:45;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;360:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;执行更新&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;362:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在 GUI 执行如下脚本，对分区 20200901 下分区 1_11 里的数据进行 20 次更新：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;364:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;machines = loadTable(&#34;dfs://tsdbDemo&#34;, &#34;machines&#34;) for(i in 0..20) update machines set tag1=i,tag5=i where id in 1..5,date(datetime)=2020.09.01&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;370:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新时或更新后，用 tree 命令查看数据文件，可见并没有生成新版本的临时目录，但 machines_2 目录下的 level file 变多，说明 keepDuplicates =LAST 时，更新等同于追加数据。如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;372:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── chunk.dict └── machines_2 ├── 0_00000010 ├── 0_00000011 ├── 0_00000012 ├── 0_00000013 ├── 0_00000014 ├── 0_00000241 ├── 0_00000243 ... ├── 1_00000002 ├── 1_00000050 └── 1_00000051 1 directory, 21 files&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:46;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;392:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新后&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;394:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新后过一段时间，用 tree 命令查看数据文件，发现 level file 进行了合并。合并 level file 时，系统会自动删除更新时的冗余数据，数量由 20 个减少为 6 个。如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;396:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;tree . ├── chunk.dict └── machines_2 ├── 0_00000272 ├── 0_00000274 ├── 0_00000276 ├── 1_00000002 ├── 1_00000050 └── 1_00000051 1 directory, 7 files&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;532-keepduplicates--all&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.3.2. keepDuplicates = ALL&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:47;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;413:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新前&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;415:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;设置 createPartitionedTable 方法的 keepDuplicates 参数为 ALL，然后建库和导入数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;417:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;通过 tree 命令查看 machines 表的 level file：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;419:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── chunk.dict └── machines_2 ├── 0_00000273 ├── 0_00000275 ├── 0_00000277 ├── 0_00000278 ├── 0_00000279 └── 1_00000054 1 directory, 7 files&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:48;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;434:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;执行更新&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;436:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新过程中使用 tree 命令可以看到，有命名包含 tid 的中间文件夹生成：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;438:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── chunk.dict ├── machines_2 │ ├── 0_00000273 │ ├── 0_00000275 │ ├── 0_00000277 │ ├── 0_00000278 │ ├── 0_00000279 │ └── 1_00000054 └── machines_2_tid_199 ├── 0_00000515 ├── 0_00000516 ├── 0_00000517 ├── 0_00000518 └── 0_00000519&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:49;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;457:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新后&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;459:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;使用 tree 命令，可以看到如果没触发周期性清理旧版本，则保留了 5 个更新版本，如下所示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;461:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── chunk.dict ├── machines_2_215 │ ├── 0_00000595 │ ├── 0_00000596 │ ├── 0_00000597 │ ├── 0_00000598 │ └── 0_00000599 ├── machines_2_216 │ ├── 0_00000600 │ ├── 0_00000601 │ ├── 0_00000602 │ ├── 0_00000603 │ └── 0_00000604 ├── machines_2_217 │ ├── 0_00000605 │ ├── 0_00000606 │ ├── 0_00000607 │ ├── 0_00000608 │ └── 0_00000609 ├── machines_2_218 │ ├── 0_00000610 │ ├── 0_00000611 │ ├── 0_00000612 │ ├── 0_00000613 │ └── 0_00000614 └── machines_2_219 ├── 0_00000615 ├── 0_00000616 ├── 0_00000617 ├── 0_00000618 └── 0_00000619&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;497:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在触发周期性清理旧版本前，使用 ll 查看更新后的列数据文件，注意到所有 level file 链接数均为 1，即不存在硬链接：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;499:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ ll machines_2_219 total 284764 -rw-rw-r-- 1 dolphindb dolphindb 57151251 Sep 7 05:48 0_00000615 -rw-rw-r-- 1 dolphindb dolphindb 57151818 Sep 7 05:48 0_00000616 -rw-rw-r-- 1 dolphindb dolphindb 58317419 Sep 7 05:48 0_00000617 -rw-rw-r-- 1 dolphindb dolphindb 59486006 Sep 7 05:48 0_00000618 -rw-rw-r-- 1 dolphindb dolphindb 59482644 Sep 7 05:48 0_00000619&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;509:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新后过一段时间，发现只保留了最新的版本：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;console&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;511:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;$ tree . ├── chunk.dict └── machines_2_219 ├── 0_00000615 ├── 0_00000616 ├── 0_00000617 ├── 0_00000618 └── 0_00000619 1 directory, 6 files&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;533-keepduplicates--first&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;525:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;525:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5.3.3. keepDuplicates = FIRST&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;525:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;527:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;createPartitionedTable 方法的 keepDuplicates 参数为 FIRST 时更新操作的表现与 keepDuplicates 参数为 ALL 时相同。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-性能分析&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;6. 性能分析&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;531:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;在上文实验的基础上，我们重复执行循环更新脚本，并统计耗时。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;533:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新 1 条记录的 2 列脚本如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;535:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;machines = loadTable(&#34;dfs://olapDemo&#34;, &#34;machines&#34;) timer update machines set tag1=1, tag5=5 where id=1 and datetime=2020.09.01T00:00:00&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;540:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新 20 次 分区 20200901 下分区 1_11 里的数据，总计 432000*20=8640000 条记录，2 列脚本如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;542:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;machines = loadTable(&#34;dfs://olapDemo&#34;, &#34;machines&#34;) timer{ for(i in 0..20) update machines set tag1=i,tag5=i where id in 1..5,date(datetime)=2020.09.01 }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;550:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新 20 次 分区 20200901 下分区 1_11 里的数据，总计 432000*20=8640000 条记录，20 列脚本如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;552:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;machines = loadTable(&#34;dfs://olapDemo&#34;, &#34;machines&#34;) timer{ for(i in 0..20) update machines set tag1=i,tag2=i,tag3=i,tag4=i,tag5=i,tag6=i,tag7=i,tag8=i,tag9=i,tag10=i,tag11=i,tag12=i,tag13=i,tag14=i,tag15=i,tag16=i,tag17=i,tag18=i,tag19=i,tag20=i where id in 1..5,date(datetime)=2020.09.01 }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;560:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;统计更新操作耗时如下表：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:2;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:4;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:5;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:6;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:7;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:13;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;配置&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:14;562:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;第一次执行耗时（ms）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:15;562:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;第二次执行耗时（ms）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:16;562:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;第三次执行耗时（ms）&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;564:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;564:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:17;564:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;OLAP&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:18;564:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:19;564:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:20;564:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;565:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:21;565:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新1条记录的2列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:22;565:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;131.263&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:23;565:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;135.649&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:24;565:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;150.013&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;566:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:25;566:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新8640000条记录的2列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:26;566:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;1,389.31&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:27;566:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;1,414.918&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:28;566:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;1,331.718&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;567:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:29;567:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新8640000条记录的20列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:30;567:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;6,309.484&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:31;567:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5,800.256&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:32;567:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;5,511.421&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;568:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:33;568:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;TSDB，keepDuplicates=LAST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:34;568:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:35;568:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:36;568:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;569:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:37;569:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新1条记录的2列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:38;569:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;29.745&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:39;569:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;31.686&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:40;569:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;29.333&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;570:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:41;570:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;插入1条记录&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:42;570:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;10.002&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:43;570:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;12.259&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:44;570:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;10.14&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:45;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新8640000条记录的2列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:46;571:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;19,358.699&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:47;571:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;21,832.69&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:48;571:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;19,686.798&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;572:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:49;572:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新8640000条记录的20列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:50;572:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;20,782.819&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:51;572:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;22,750.596&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:52;572:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;20,643.41&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:53;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;插入8640000条记录&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:54;573:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;10,813.92&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:55;573:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;9,506.557&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:56;573:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;12,695.168&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:57;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;TSDB，keepDuplicates=ALL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:58;574:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:59;574:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:60;574:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;575:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:61;575:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新8640000条记录的20列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:62;575:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;69,385.771&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:63;575:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;70,563.928&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:64;575:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;62,621.552&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;576:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:65;576:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;TSDB，keepDuplicates=FIRST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:66;576:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:67;576:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:68;576:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;577:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:69;577:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新8640000条记录的20列&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:70;577:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;57,614.807&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:71;577:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;65,081.804&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:72;577:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;58,425.8&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;579:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;注：程序运行性能受硬件性能、系统运行状况等因素影响，该表格运行耗时仅供参考。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;581:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:50;581:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;581:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;存储引擎配置为 OLAP 时&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;583:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新性能与需要更新的列数有关，因为更新操作实现为重新生成需要更新的列，而对未更新的列使用了硬链接。故更新 20 列比更新 2 列耗时明显长。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:51;585:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;585:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;存储引擎配置为 TSDB keepDuplicates=LAST 时&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;587:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;性能相较 keepDuplicates=ALL 或 keepDuplicates=FIRST 更好，因为更新操作只需要向 LSM 树的追加数据，而 LSM 树具有吞吐量大的特点，写性能优异。更新性能比插入性能慢 2-3 倍，是因为更新需要先读取数据到内存，而插入不需要。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:52;589:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;589:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;存储引擎配置为 TSDB keepDuplicates=ALL 或 FIRST 时&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;591:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;更新性能较差，因为该配置下每次更新都会在一个新的目录产生一个新的版本，且未变化的列也会被更新，磁盘 IO 较大，故而性能较差。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;593:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;综上所述，DolphinDB 只适合低频更新。使用 TSDB 引擎时，若对更新的性能有要求，建议配置 keepDuplicates=LAST。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;7-总结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;595:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;595:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;7. 总结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;595:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;本文对比介绍了 OLAP 和 TSDB 两种存储引擎更新分布式表数据的使用方法和基本原理，通过实验来验证基本原理，并分析了常见场景的性能问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;599:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;OLAP 存储引擎的更新性能与需要更新的列数和操作系统是否支持硬链接有关。TSDB 存储引擎的更新性能与建表参数 keepDuplicates 有关，建表参数 keepDuplicates=LAST 比 TSDB keepDuplicates=ALL 或 FIRST 时更新性能更好。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;601:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;实际应用中使用哪种引擎需要考虑更多的应用场景和实际的性能，更多详细信息可见：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;603:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:53;603:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../db_distr_comp/db/tsdb.dita&#34; xtrc=&#34;xref:11;603:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;TSDB 存储引擎&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:54;604:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../db_distr_comp/db/olap.dita&#34; xtrc=&#34;xref:12;604:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;OLAP 存储引擎&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;606:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;有关上述各章节提到的函数，参考：&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/funcs_intro.dita&#34; xtrc=&#34;xref:13;606:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;函数章节&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;8-附件&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;8. 附件&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;610:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:55;610:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/dolphindb_update/dolphindb_update.dos&#34; xtrc=&#34;xref:14;610:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/dolphindb_update.md&#34;&gt;&lt;?ditaot usertext?&gt;建库表脚本&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/dolphindb_update.md"/><meta name="wh-out-relpath" content="tutorials/dolphindb_update.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="分布式表数据更新原理和性能" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/database.html">数据库</a></div></div></li><li class="active"><div class="topicref" data-id="分布式表数据更新原理和性能"><div class="title"><a href="../tutorials/dolphindb_update.html">分布式表数据更新原理和性能</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="分区数据库设计和操作-d9713e98328" class="topicref" data-id="分区数据库设计和操作" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="分区数据库设计和操作-d9713e98328-link">分区数据库设计和操作</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-内存表详解-d9713e98374" class="topicref" data-id="dolphindb-内存表详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/in_memory_table.html" id="dolphindb-内存表详解-d9713e98374-link">DolphinDB 内存表详解</a></div></div></li><li role="treeitem"><div data-tocid="内存数据表-d9713e98420" class="topicref" data-id="内存数据表" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/partitioned_in_memory_table.html" id="内存数据表-d9713e98420-link">内存数据表</a></div></div></li><li role="treeitem"><div data-tocid="oltp-内存存储引擎非嵌入式版使用教程-d9713e98466" class="topicref" data-id="oltp-内存存储引擎非嵌入式版使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/oltp_in-memory_storage_engine_non-embedded_version_tutorials.html" id="oltp-内存存储引擎非嵌入式版使用教程-d9713e98466-link">OLTP 内存存储引擎（非嵌入式版）使用教程</a></div></div></li><li role="treeitem"><div data-tocid="利用缓存表快速实现-mysql-库间信息同步-d9713e98512" class="topicref" data-id="利用缓存表快速实现-mysql-库间信息同步" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cachedtable.html" id="利用缓存表快速实现-mysql-库间信息同步-d9713e98512-link">利用缓存表快速实现 MySQL 库间信息同步</a></div></div></li><li role="treeitem"><div data-tocid="建库建表最容易忽略的十个细节-d9713e98558" class="topicref" data-id="建库建表最容易忽略的十个细节" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database_and_table_creation_details.html" id="建库建表最容易忽略的十个细节-d9713e98558-link">建库建表最容易忽略的十个细节</a></div></div></li><li role="treeitem"><div data-tocid="redo-log-和-cache-engine-d9713e98604" class="topicref" data-id="redo-log-和-cache-engine" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/redoLog_cacheEngine.html" id="redo-log-和-cache-engine-d9713e98604-link">redo log 和 cache engine</a></div></div></li><li role="treeitem"><div data-tocid="tsdb-存储引擎简介-d9713e98650" class="topicref" data-id="tsdb-存储引擎简介" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_engine.html" id="tsdb-存储引擎简介-d9713e98650-link">TSDB 存储引擎简介</a></div></div></li><li role="treeitem"><div data-tocid="tsdb-存储引擎详解-d9713e98696" class="topicref" data-id="tsdb-存储引擎详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_explained.html" id="tsdb-存储引擎详解-d9713e98696-link">TSDB 存储引擎详解</a></div></div></li><li role="treeitem" class="active"><div data-tocid="分布式表数据更新原理和性能-d9713e98742" class="topicref" data-id="分布式表数据更新原理和性能" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_update.html" id="分布式表数据更新原理和性能-d9713e98742-link">分布式表数据更新原理和性能</a></div></div></li><li role="treeitem"><div data-tocid="软删除-d9713e98788" class="topicref" data-id="软删除" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/soft_delete.html" id="软删除-d9713e98788-link">软删除</a></div></div></li><li role="treeitem"><div data-tocid="基于-datax-的-dolphindb-数据导入工具-d9713e98835" class="topicref" data-id="基于-datax-的-dolphindb-数据导入工具" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/datax_writer.html" id="基于-datax-的-dolphindb-数据导入工具-d9713e98835-link">基于 DataX 的 DolphinDB 数据导入工具</a></div></div></li><li role="treeitem"><div data-tocid="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9713e98881" class="topicref" data-id="debezium--kafka-实时同步-mysql-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_and_Kafka_data_sync.html" id="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9713e98881-link">Debezium + Kafka 实时同步 MySQL 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9713e98927" class="topicref" data-id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_Kafka_Oracle_sync.html" id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9713e98927-link">Debezium+Kafka 实时同步 Oracle 11g 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="clear_cache-d9713e98973" class="topicref" data-id="clear_cache" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/clear_cache.html" id="clear_cache-d9713e98973-link">数据库缓存清理机制 </a></div></div></li><li role="treeitem"><div data-tocid="best_practice_for_storage_compute_separation-d9713e99019" class="topicref" data-id="best_practice_for_storage_compute_separation" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_storage_compute_separation.html" id="best_practice_for_storage_compute_separation-d9713e99019-link">存算分离最佳实践教程</a></div></div></li><li role="treeitem"><div data-tocid="database_and_table_creation_wizard-d9713e99065" class="topicref" data-id="database_and_table_creation_wizard" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database_and_table_creation_wizard.html" id="database_and_table_creation_wizard-d9713e99065-link">DolphinDB Web 界面库表创建指南</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">分布式表数据更新原理和性能</h1><div class="- topic/body body"></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-概述"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 概述</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 从 1.30.6 版本开始支持更新分布式表数据。更新操作支持事务，具备事务 <a class="- topic/xref xref" href="https://en.wikipedia.org/wiki/ACID" target="_blank" rel="external noopener">ACID</a> 的特性，且通过 <a class="- topic/xref xref" href="https://en.wikipedia.org/wiki/Multiversion_concurrency_control" target="_blank" rel="external noopener">MVCC</a> 实现快照隔离级别。DolphinDB 为多模数据库，目前支持两种存储引擎：OLAP 和 TSDB（详见 DolphinDB 数据模型，不同引擎的更新操作的原理和性能不同。本文将分别介绍两种存储引擎的更新操作相关的原理，并通过实验验证和分析相关性能。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-使用方法"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. 使用方法</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供 3 种更新分布式表的方法：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">标准 SQL 的 <code class="+ topic/ph pr-d/codeph ph codeph">update</code> 语法（注意，DolphinDB 仅支持关键字小写）；</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">sqlUpdate</code>方法，动态生成 SQL update 语句的元代码。生成元代码后，通过 <code class="+ topic/ph pr-d/codeph ph codeph">eval</code> 函数执行。具体用法见<a class="- topic/xref xref" href="meta_programming.html">元编程</a>；</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">upsert!</code> 方法，若新数据的主键值已存在，更新该主键值的数据；否则添加数据。</p></li></ul><p class="- topic/p p">下面通过一个简单的例子介绍更新分布式表的 3 种方法：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">通过 update SQL 和 sqlUpdate 方法更新所有 ID=1 的行的 vol 列数据；</p></li><li class="- topic/li li"><p class="- topic/p p">通过 upsert! 更新第一个 ID=1 所在行的 date 和 vol 列数据。</p></li></ul><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">使用附件脚本建库表；</p></li><li class="- topic/li li"><p class="- topic/p p">更新数据：</p><p class="- topic/p p">方法 1，下列 update SQL 语句执行后，ID 为 1 的所有记录的 vol 值更新为 1：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>update pt set vol = 1 where ID = 1</code></pre><p class="- topic/p p">方法 2，下列 sqlUpdate 语句执行后，ID 为 1 的所有记录的 vol 值更新为 2：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">sqlUpdate(pt, &lt;<span class="hl-number">2</span> <strong class="hl-keyword">as</strong> vol&gt;, where=&lt;ID = <span class="hl-number">1</span>&gt;).eval()</pre><p class="- topic/p p">方法 3，下列 upsert! 语句执行后，第一个 ID=1 所在记录的 date 更新为 2022.08.07，vol 更新为 3：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">newData = table(<span class="hl-number">1</span> <strong class="hl-keyword">as</strong> ID, <span class="hl-number">2022.08</span>.<span class="hl-number">07</span> <strong class="hl-keyword">as</strong> date, <span class="hl-number">3</span> <strong class="hl-keyword">as</strong> vol)
upsert!(pt, newData, keyColNames=`ID)</pre></li></ol></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title4" id="3-存储机制简介"><h2 class="- topic/title title topictitle2" id="ariaid-title4">3. 存储机制简介</h2><div class="- topic/body body"><p class="- topic/p p">在了解更新原理之前，需要先简单了解 DolphinDB 的存储机制。</p><p class="- topic/p p">DolphinDB 内置分布式文件系统 DFS，由其统一管理各个节点的存储空间，在对数据集进行分割时，可以全局优化，规避数据分布不均匀等问题。通过 DFS，我们可以将同一集群中不同数据节点上的存储文件夹组织起来，形成一个单独的、逻辑的、层次式的共享文件系统。更多分区数据库介绍可以参考<a class="- topic/xref xref" href="database.html">《DolphinDB 教程：分区数据库》</a>。</p><p class="- topic/p p">DolphinDB 提供配置项 volume，可以为每个节点指定数据文件的存储路径，用户可以通过 <code class="+ topic/ph pr-d/codeph ph codeph">pnodeRun(getAllStorages)</code> 查询路径。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="31-olap-引擎存储结构"><h3 class="- topic/title title topictitle3" id="ariaid-title5">3.1. OLAP 引擎存储结构</h3><div class="- topic/body body"><p class="- topic/p p">在 OLAP 中，每个分区内部都会为表的每列数据分别存储一个列文件。例如第 2 节脚本创建的使用 OLAP 引擎的表 pt，其分区 [0, 50) 的数据文件保存在 &lt;volumes&gt;/CHUNKS/db1/0_50/gA/pt_2 路径下，其中：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">db1 为库名；</p></li><li class="- topic/li li"><p class="- topic/p p">0_50 为范围分区 [0, 50)；</p></li><li class="- topic/li li"><p class="- topic/p p">gA 为表的物理名索引，于 1.30.16/2.00.4 版本为支持表级分区时引入；</p></li><li class="- topic/li li"><p class="- topic/p p">pt_2 为 pt 表的版本文件夹，其中“_2“指表在库内的序号，于 1.30.1 版本支持 renameTable 特性时引入。</p></li></ul><p class="- topic/p p">用户可以进入库名目录，通过 tree 命令查看表的数据文件目录结构，如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
├── 0_50
│   └── gA
│       └── pt_2
│           ├── date.col
│           ├── ID.col
│           └── vol.col
├── 50_100
│   └── gA
│       └── pt_2
│           ├── date.col
│           ├── ID.col
│           └── vol.col
├── dolphindb.lock
├── domain
└── pt.tbl

6 directories, 9 files</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="32-tsdb-引擎存储结构"><h3 class="- topic/title title topictitle3" id="ariaid-title6">3.2. TSDB 引擎存储结构</h3><div class="- topic/body body"><p class="- topic/p p">TSDB 引擎以 <a class="- topic/xref xref" href="https://en.wikipedia.org/wiki/Log-structured_merge-tree" target="_blank" rel="external noopener">LSM 树（Log Structured Merge Tree）</a>的结构存储表数据。例如第 2 节脚本创建的使用 TSDB 引擎的表 pt1，分区 [0, 50) 的数据文件保存在 &lt;volumes&gt;/CHUNKS/TSDB_db1/0_50/gE/pt1_2 路径下，路径组成同 OLAP 引擎。</p><p class="- topic/p p">在库名目录使用 tree 命令查看内容，可以看到 pt1 表的 level file，也就是 LSM 树的分层数据文件，如下所示，其中开头下划线前的数字表示层级，目前支持 4 层：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
├── 0_50
│   └── gE
│       ├── chunk.dict
│       └── pt1_2
│           └── 0_00000623
├── 50_100
│   └── gE
│       ├── chunk.dict
│       └── pt1_2
│           └── 0_00000624
├── dolphindb.lock
├── domain</code></pre><p class="- topic/p p">如果 level file 未及时生成，用户可以执行 flushTSDBCache()，将 TSDB 引擎缓冲区里已经完成的事务强制写入磁盘。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title7" id="4-数据更新原理"><h2 class="- topic/title title topictitle2" id="ariaid-title7">4. 数据更新原理</h2><div class="- topic/body body"><p class="- topic/p p">下面分别介绍 OLAP 和 TSDB 存储引擎更新分布式表数据的基本原理。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="41-olap-存储引擎更新原理"><h3 class="- topic/title title topictitle3" id="ariaid-title8">4.1. OLAP 存储引擎更新原理</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title9" id="411-更新流程"><h4 class="- topic/title title topictitle4" id="ariaid-title9">4.1.1. 更新流程</h4><div class="- topic/body body"><div class="- topic/p p"><img class="- topic/image image" height="500" src="images/dolphindb_update/olap_update_flowchart.png" width="800"/><br/><p class="- topic/p p">分布式表数据更新过程是一个事务，采用 <a class="- topic/xref xref" href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol" target="_blank" rel="external noopener">两阶段提交</a>协议和 <a class="- topic/xref xref" href="https://en.wikipedia.org/wiki/Multiversion_concurrency_control" target="_blank" rel="external noopener">MVCC</a> 机制，OLAP 引擎数据更新的具体流程如下：</p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">向控制节点申请创建事务，控制节点会给涉及的分区加锁，并分配事务 tid，返回分区 chunk ID 等信息；</p></li><li class="- topic/li li"><p class="- topic/p p">判断是否开启 OLAP cache engine：</p><ol class="- topic/ol ol" type="a"><li class="- topic/li li">如果开启了 cache engine，先刷写所有已完成的事务的缓存数据到磁盘；</li><li class="- topic/li li">数据写入 redo log；</li><li class="- topic/li li">在数据节点上创建事务和对应临时目录，并更新数据到该目录下。</li></ol><p class="- topic/p p">通过事务 tid 生成一个临时的路径，格式为”physicalDir_tid_tidValue”，并把数据更新到该目录下。如果某些列的数据无变化，则直接创建原列文件的硬链接；对于 linux 这种支持硬链接但不支持跨 volume，或类似 beegfs 这种不支持硬链接的文件系统，则采用复制的方式来解决。</p><p class="- topic/p p">如果没有开启 cache engine，只做第 2.3 步；</p></li><li class="- topic/li li"><p class="- topic/p p">向控制节点申请事务提交的 cid。</p><p class="- topic/p p">更新事务 commit 时，生成一个单调递增的 cid，即 Commit ID 作为提交动作的唯一标识，每个表的元数据有一个 createCids 数组记录该 cid；</p></li><li class="- topic/li li"><p class="- topic/p p">通知所有事务参与者提交事务：</p><ol class="- topic/ol ol" type="a"><li class="- topic/li li">写 commit redo log 并持久化到磁盘；</li><li class="- topic/li li">重命名临时目录为 "physicalDir_cid"；</li></ol></li><li class="- topic/li li"><p class="- topic/p p">通知所有事务参与者完成事务，写 complete redo log。</p><p class="- topic/p p">不管参与者节点是否成功完成事务，协调者都标记完成事务。如果有失败的情况，通过事务决议和 recovery 机制来恢复。</p><p class="- topic/p p">事务结束后，最终只会保留最后一个版本，因为程序启动后，其他版本都是历史数据，应该回收掉，不应该继续保留。</p></li></ol></div></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title10" id="412-定期回收机制"><h5 class="- topic/title title topictitle5" id="ariaid-title10">4.1.2. 定期回收机制</h5><div class="- topic/body body"><p class="- topic/p p">在实际操作中，用户常常会进行多次数据更新，导致上述目录序列不断增加。为此，系统提供了定期垃圾回收的机制。默认情况下，系统每隔 60 秒回收一定时间值之前更新生成的目录。在开始周期性垃圾回收前，系统最多保留 5 个更新版本。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title11" id="413-快照隔离级别"><h5 class="- topic/title title topictitle5" id="ariaid-title11">4.1.3. 快照隔离级别</h5><div class="- topic/body body"><p class="- topic/p p">更新数据的整个过程是一个事务，满足 ACID 特性，且通过多版本并发控制机制（MVCC, Multi-Version Concurrency Control）进行读写分离，保证了数据在更新时不影响读取。例如，不同用户同时对相同数据表进行更新和查询操作时，系统将根据操作发生的顺序为其分配 cid，并将它们和 createCids 数组里的版本号对比，寻找所有版本号中值最大且小于 cid 的文件路径，此路径即为该 cid 对应的操作路径。如需要在线获取最新的 cid，可执行 getTabletsMeta().createCids 命令。</p></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title12" id="42-tsdb-存储引擎更新原理"><h4 class="- topic/title title topictitle4" id="ariaid-title12">4.2. TSDB 存储引擎更新原理</h4><div class="- topic/body body"></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title13" id="421-建表参数"><h5 class="- topic/title title topictitle5" id="ariaid-title13">4.2.1. 建表参数</h5><div class="- topic/body body"><p class="- topic/p p">DolphinDB TSDB 引擎在建表时另外提供了两个参数：sortColumns 和 keepDuplicates。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">sortColumns：用于指定表的排序列。系统默认 sortColumns 最后一列为时间列，其余列字段作为排序的索引列，其组合值称作 sortKey。目前不支持更新 sortColumes 列。</p></li><li class="- topic/li li"><p class="- topic/p p">keepDuplicates：用于去重，即指定在每个分区内如何处理所有 sortColumns 的值相同的数据。参数默认值为 ALL，表示保留所有数据；取值为 LAST 表示仅保留最新数据；取值为 FIRST 表示仅保留第一条数据。</p></li></ul></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title14" id="422-更新策略"><h5 class="- topic/title title topictitle5" id="ariaid-title14">4.2.2. 更新策略</h5><div class="- topic/body body"><p class="- topic/p p">不同的 keepDuplicates 参数值，会有不同的数据更新策略。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">keepDuplicates=LAST</p><p class="- topic/p p">这种情况下数据更新实质上是向 LSM 树的内存缓冲区追加数据。这部分数据最终会持久化到 level 0 层级的 level file 里，故不会产生新的版本目录。通过在 LSM 树中增加 cid 列来实现 MVCC。查询时，TSDB 引擎会做过滤，只返回最新的数据。</p><p class="- topic/p p">写入量达到一定值或更新后一段时间内，会自动合并 level file 以节省硬盘空间。若未及时触发 level file 的合并，可以手动执行 <code class="+ topic/ph pr-d/codeph ph codeph">triggerTSDBCompaction()</code>  强制触发指定 chunk 内 level 0 级别的所有 level file 的合并操作。</p><p class="- topic/p p">更新流程图如下：</p><div class="- topic/p p"><img class="- topic/image image" height="500" src="images/dolphindb_update/tsdb_last_update_flowchart.png" width="800"/><br/><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">向控制节点申请创建事务，控制节点会给涉及的分区加锁，并分配事务 tid，返回分区 chunk ID 等信息；</p></li><li class="- topic/li li"><p class="- topic/p p">TSDB 必须开启 cache engine：</p><ol class="- topic/ol ol" type="a"><li class="- topic/li li">刷写 cache engine 里所有已完成的事务的缓存数据到磁盘；</li><li class="- topic/li li">数据写入 redo log；</li><li class="- topic/li li">读取需要更新的数据到内存并更新，即只读取需要更新的 level file 的部分数据；</li></ol></li><li class="- topic/li li"><p class="- topic/p p">向控制节点申请事务提交的 cid。</p><p class="- topic/p p">更新事务 commit 时，生成一个单调递增的 cid，即 Commit ID 作为提交动作的唯一标识，每个表的元数据有一个 createCids 数组记录该 cid；</p></li><li class="- topic/li li"><p class="- topic/p p">通知所有事务参与者提交事务，写 commit redo log 并持久化到磁盘；</p></li><li class="- topic/li li"><p class="- topic/p p">通知所有事务参与者完成事务：</p><ol class="- topic/ol ol" type="a"><li class="- topic/li li">写 complete redo log；</li><li class="- topic/li li">写入更新的数据到 cache engine，cache engine 的后台线程会异步写入数据到磁盘。</li></ol></li></ol></div><li class="- topic/li li"><p class="- topic/p p">keepDuplicates=FIRST 或 keepDuplicates=ALL</p><p class="- topic/p p">在这两种情况下，更新操作流程与 OLAP 基本相同，也是采用两阶段提交协议，每个分区每次更新产生一个独立的目录，且整个更新过程是一个事务，具备 ACID 特性，通过 MVCC 实现快照隔离级别。过期版本的清理机制也与 OLAP 相同。</p><p class="- topic/p p">但是第 2.3 步读取要更新的数据到内存并更新到临时目录，TSDB keepDuplicates=FIRST 或 ALL 策略与 OLAP 不同，会读出所有文件进行更新，即未变化的列也会被更新，然后将更新的 level file 信息写入到元数据中。因此，我们也建议用户首先确定分区数据量较小（不能大于可用内存空间）再进行更新操作，否则容易导致内存溢出。</p></li></li></ul></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title15" id="5-数据更新实验"><h4 class="- topic/title title topictitle4" id="ariaid-title15">5. 数据更新实验</h4><div class="- topic/body body"><p class="- topic/p p">接下来我们通过实验来验证数据更新的基本原理，并对比分析 OLAP 和 TSDB 引擎在常见场景的性能特点。</p></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title16" id="51-实验准备"><h5 class="- topic/title title topictitle5" id="ariaid-title16">5.1. 实验准备</h5><div class="- topic/body body"></div><article class="- topic/topic topic nested5" aria-labelledby="ariaid-title17" id="511-部署集群"><h6 class="- topic/title title topictitle6" id="ariaid-title17">5.1.1. 部署集群</h6><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">Linux 系统</p></li><li class="- topic/li li"><p class="- topic/p p">DolphinDB v2.00.7 版本</p></li><li class="- topic/li li"><p class="- topic/p p">单机集群部署 1 个控制节点 +1 个数据节点</p></li><li class="- topic/li li"><p class="- topic/p p">单 SSD 硬盘，硬盘速度为 6 Gbps，文件系统为 xfs</p></li><li class="- topic/li li"><p class="- topic/p p">开启 cache engine 和 redo log</p></li></ul></div></article><article class="- topic/topic topic nested5" aria-labelledby="ariaid-title18" id="512-创建库表和写入数据"><h6 class="- topic/title title topictitle6" id="ariaid-title18">5.1.2. 创建库表和写入数据</h6><div class="- topic/body body"><p class="- topic/p p">参考<a class="- topic/xref xref" href="iot_examples.html">《DolphinDB 入门：物联网范例》</a>第 2.3、2.4 节，创建多值模型数据库表，并写入数据。注意此处<a class="- topic/xref xref" href="script/multipleValueModeWrite.txt">脚本</a>为异步写入，可以通过 getRecentJobs() 方法查看写入是否完成。</p><p class="- topic/p p">本实验将模拟 100 台机器 5 天的数据量，每台机器每天产生 86400 条记录，5 天总数据量为 43200000 条。OLAP 和 TSDB 引擎的基本数据和建库名如下表所示：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="512-创建库表和写入数据__entry__1"> </th><th class="- topic/entry entry colsep-0 rowsep-0" id="512-创建库表和写入数据__entry__2">OLAP</th><th class="- topic/entry entry colsep-0 rowsep-0" id="512-创建库表和写入数据__entry__3">TSDB</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__1">占用磁盘空间</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__2">8.3 GB</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__3">8.3 G</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__1">每个分区大小</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__2">169 MB</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__3">170 MB</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__1">建库名</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__2">olapDemo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="512-创建库表和写入数据__entry__3">tsdbDemo</td></tr></tbody></table></div><p class="- topic/p p">参考以下脚本修改<a class="- topic/xref xref" href="iot_examples.html">《DolphinDB 入门：物联网范例》</a>2.3 节的 createDatabase 函数。注意实验中需要修改 createPartitionedTable 函数的 keepDuplicates 参数值：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python"><strong class="hl-keyword">def</strong> createDatabase(dbName,tableName, ps1, ps2, numMetrics){
	m = <span class="hl-string">"tag"</span> + string(<span class="hl-number">1.</span>.numMetrics)
	schema = table(<span class="hl-number">1</span>:<span class="hl-number">0</span>,`id`datetime join m, [INT,DATETIME] join take(FLOAT,numMetrics) )
	db1 = database(<span class="hl-string">""</span>,VALUE,ps1)
	db2 = database(<span class="hl-string">""</span>,RANGE,ps2)
	db = database(dbName,COMPO,[db1,db2],,<span class="hl-string">'TSDB'</span>)
	db.createPartitionedTable(schema,tableName,`datetime`id ,,`id`datetime, keepDuplicates=LAST)
}</pre><p class="- topic/p p">实验的基本思路为观察执行 update 语句前后数据目录和文件的变化与上文阐述的原理是否一致。</p></div></article></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title19" id="52-olap-引擎更新实验"><h5 class="- topic/title title topictitle5" id="ariaid-title19">5.2. OLAP 引擎更新实验</h5><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">更新前</p><p class="- topic/p p">首先进入到需要更新的数据所在目录，默认位置在 &lt;HomeDir&gt;/&lt;nodeAlias&gt;/storage/CHUNKS/olapDemo/20200901/1_11/2。其中，最后的 2 为表的物理名索引。通过 tree 命令查看 machines 表的列数据文件：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
└── 2
    └── machines_2
        ├── datetime.col
        ├── id.col
        ├── tag10.col
        ├── tag11.col
         ...
        └── tag9.col</code></pre></li><li class="- topic/li li"><p class="- topic/p p">执行更新</p><p class="- topic/p p">在 GUI 执行如下脚本，对分区 20200901 下分区 1_11 里的数据进行 20 次更新：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>machines = loadTable("dfs://olapDemo", "machines")
for(i in 0..20)
	update machines set tag1=i,tag5=i where id in 1..5,date(datetime)=2020.09.01</code></pre><p class="- topic/p p">更新过程中使用 ll 命令可以看到，命名带 tid 的中间文件夹已生成：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ ll
total 20
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_115
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_116
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_117
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_118
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_119
drwxrwxr-x 2 dolphindb dolphindb  120 Sep  7 05:26 machines_2_tid_120</code></pre></li><li class="- topic/li li"><p class="- topic/p p">更新后</p><p class="- topic/p p">查看目录文件，如果没触发周期性清理旧版本，可以看到只保留了 5 个更新版本：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ ll
total 20
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_121
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_122
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_123
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_124
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_125</code></pre><p class="- topic/p p">在触发周期性清理旧版本前，使用 ll 命令查看更新后的列数据文件，注意到只有更新的列 tag1 和 tag5 的数据文件链接数为 1，其他数据文件链接数均为 5 即硬链接。这是因为只更新了 tag1 和 tag5 的列，其他列无变化，因此直接创建了硬链接。如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ ll machines_2_125/
total 169632
-rw-rw-r-- 5 dolphindb dolphindb 3469846 Sep  7 05:15 datetime.col
-rw-rw-r-- 5 dolphindb dolphindb   14526 Sep  7 05:15 id.col
-rw-rw-r-- 5 dolphindb dolphindb 3469845 Sep  7 05:15 tag10.col
-rw-rw-r-- 5 dolphindb dolphindb 3469846 Sep  7 05:15 tag11.col
...
-rw-rw-r-- 1 dolphindb dolphindb 1742158 Sep  7 05:26 tag1.col
...
-rw-rw-r-- 1 dolphindb dolphindb 1742158 Sep  7 05:26 tag5.col
...</code></pre><p class="- topic/p p">更新后过一段时间，发现只保留了最新的版本。这是因为系统会定时进行回收，最终只保留一个最新的副本。如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ ll
total 4
drwxrwxr-x 2 dolphindb dolphindb 4096 Sep  7 05:26 machines_2_125</code></pre></li></ul></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title20" id="53-tsdb-引擎更新实验"><h5 class="- topic/title title topictitle5" id="ariaid-title20">5.3. TSDB 引擎更新实验</h5><div class="- topic/body body"></div><article class="- topic/topic topic nested5" aria-labelledby="ariaid-title21" id="531-keepduplicates--last"><h6 class="- topic/title title topictitle6" id="ariaid-title21">5.3.1. keepDuplicates = LAST</h6><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">更新前</p><p class="- topic/p p">首先设置 createPartitionedTable 方法的 keepDuplicates 参数为 LAST，然后建库和导入数据。</p><p class="- topic/p p">进入需要更新的数据所在的目录，默认位置在 &lt;HomeDir&gt;/&lt;nodeAlias&gt;/storage/CHUNKS/tsdbDemo/20200901/1_11/S，最后的 S 为表的物理名索引。用 tree 命令查看 machines 表的 level file：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
├── chunk.dict
└── machines_2
    ├── 0_00000010
    ├── 0_00000011
    ├── 0_00000012
    ├── 0_00000013
    ├── 0_00000014
    └── 1_00000002

1 directory, 7 files</code></pre></li><li class="- topic/li li"><p class="- topic/p p">执行更新</p><p class="- topic/p p">在 GUI 执行如下脚本，对分区 20200901 下分区 1_11 里的数据进行 20 次更新：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>machines = loadTable("dfs://tsdbDemo", "machines")
for(i in 0..20)
	update machines set tag1=i,tag5=i where id in 1..5,date(datetime)=2020.09.01</code></pre><p class="- topic/p p">更新时或更新后，用 tree 命令查看数据文件，可见并没有生成新版本的临时目录，但 machines_2 目录下的 level file 变多，说明 keepDuplicates =LAST 时，更新等同于追加数据。如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
├── chunk.dict
└── machines_2
    ├── 0_00000010
    ├── 0_00000011
    ├── 0_00000012
    ├── 0_00000013
    ├── 0_00000014
    ├── 0_00000241
    ├── 0_00000243
     ...
    ├── 1_00000002
    ├── 1_00000050
    └── 1_00000051

1 directory, 21 files</code></pre></li><li class="- topic/li li"><p class="- topic/p p">更新后</p><p class="- topic/p p">更新后过一段时间，用 tree 命令查看数据文件，发现 level file 进行了合并。合并 level file 时，系统会自动删除更新时的冗余数据，数量由 20 个减少为 6 个。如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>tree
.
├── chunk.dict
└── machines_2
    ├── 0_00000272
    ├── 0_00000274
    ├── 0_00000276
    ├── 1_00000002
    ├── 1_00000050
    └── 1_00000051

1 directory, 7 files</code></pre></li></ul></div></article><article class="- topic/topic topic nested5" aria-labelledby="ariaid-title22" id="532-keepduplicates--all"><h6 class="- topic/title title topictitle6" id="ariaid-title22">5.3.2. keepDuplicates = ALL</h6><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">更新前</p><p class="- topic/p p">设置 createPartitionedTable 方法的 keepDuplicates 参数为 ALL，然后建库和导入数据。</p><p class="- topic/p p">通过 tree 命令查看 machines 表的 level file：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
├── chunk.dict
└── machines_2
    ├── 0_00000273
    ├── 0_00000275
    ├── 0_00000277
    ├── 0_00000278
    ├── 0_00000279
    └── 1_00000054

1 directory, 7 files</code></pre></li><li class="- topic/li li"><p class="- topic/p p">执行更新</p><p class="- topic/p p">更新过程中使用 tree 命令可以看到，有命名包含 tid 的中间文件夹生成：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
├── chunk.dict
├── machines_2
│   ├── 0_00000273
│   ├── 0_00000275
│   ├── 0_00000277
│   ├── 0_00000278
│   ├── 0_00000279
│   └── 1_00000054
└── machines_2_tid_199
    ├── 0_00000515
    ├── 0_00000516
    ├── 0_00000517
    ├── 0_00000518
    └── 0_00000519</code></pre></li><li class="- topic/li li"><p class="- topic/p p">更新后</p><p class="- topic/p p">使用 tree 命令，可以看到如果没触发周期性清理旧版本，则保留了 5 个更新版本，如下所示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree
.
├── chunk.dict
├── machines_2_215
│   ├── 0_00000595
│   ├── 0_00000596
│   ├── 0_00000597
│   ├── 0_00000598
│   └── 0_00000599
├── machines_2_216
│   ├── 0_00000600
│   ├── 0_00000601
│   ├── 0_00000602
│   ├── 0_00000603
│   └── 0_00000604
├── machines_2_217
│   ├── 0_00000605
│   ├── 0_00000606
│   ├── 0_00000607
│   ├── 0_00000608
│   └── 0_00000609
├── machines_2_218
│   ├── 0_00000610
│   ├── 0_00000611
│   ├── 0_00000612
│   ├── 0_00000613
│   └── 0_00000614
└── machines_2_219
    ├── 0_00000615
    ├── 0_00000616
    ├── 0_00000617
    ├── 0_00000618
    └── 0_00000619</code></pre><p class="- topic/p p">在触发周期性清理旧版本前，使用 ll 查看更新后的列数据文件，注意到所有 level  file 链接数均为 1，即不存在硬链接：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ ll machines_2_219
total 284764
-rw-rw-r-- 1 dolphindb dolphindb 57151251 Sep  7 05:48 0_00000615
-rw-rw-r-- 1 dolphindb dolphindb 57151818 Sep  7 05:48 0_00000616
-rw-rw-r-- 1 dolphindb dolphindb 58317419 Sep  7 05:48 0_00000617
-rw-rw-r-- 1 dolphindb dolphindb 59486006 Sep  7 05:48 0_00000618
-rw-rw-r-- 1 dolphindb dolphindb 59482644 Sep  7 05:48 0_00000619</code></pre><p class="- topic/p p">更新后过一段时间，发现只保留了最新的版本：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock console"><code>$ tree 
.
├── chunk.dict
└── machines_2_219
    ├── 0_00000615
    ├── 0_00000616
    ├── 0_00000617
    ├── 0_00000618
    └── 0_00000619

1 directory, 6 files</code></pre></li></ul></div></article><article class="- topic/topic topic nested5" aria-labelledby="ariaid-title23" id="533-keepduplicates--first"><h6 class="- topic/title title topictitle6" id="ariaid-title23">5.3.3. keepDuplicates = FIRST</h6><div class="- topic/body body"><p class="- topic/p p">createPartitionedTable 方法的 keepDuplicates 参数为 FIRST 时更新操作的表现与 keepDuplicates 参数为 ALL 时相同。</p></div></article></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title24" id="6-性能分析"><h4 class="- topic/title title topictitle4" id="ariaid-title24">6. 性能分析</h4><div class="- topic/body body"><p class="- topic/p p">在上文实验的基础上，我们重复执行循环更新脚本，并统计耗时。</p><p class="- topic/p p">更新 1 条记录的 2 列脚本如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">machines = loadTable(<span class="hl-string">"dfs://olapDemo"</span>, <span class="hl-string">"machines"</span>)
timer update machines set tag1=<span class="hl-number">1</span>, tag5=<span class="hl-number">5</span> where id=<span class="hl-number">1</span> <strong class="hl-keyword">and</strong> datetime=<span class="hl-number">2020.09</span>.<span class="hl-number">01</span>T00:<span class="hl-number">00</span>:<span class="hl-number">00</span></pre><p class="- topic/p p">更新 20 次 分区 20200901 下分区 1_11 里的数据，总计 432000*20=8640000 条记录，2 列脚本如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">machines = loadTable(<span class="hl-string">"dfs://olapDemo"</span>, <span class="hl-string">"machines"</span>)
timer{
<strong class="hl-keyword">for</strong>(i <strong class="hl-keyword">in</strong> <span class="hl-number">0.</span><span class="hl-number">.20</span>)
	update machines set tag1=i,tag5=i where id <strong class="hl-keyword">in</strong> <span class="hl-number">1.</span><span class="hl-number">.5</span>,date(datetime)=<span class="hl-number">2020.09</span>.<span class="hl-number">01</span>
}</pre><p class="- topic/p p">更新 20 次 分区 20200901 下分区 1_11 里的数据，总计 432000*20=8640000 条记录，20 列脚本如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">machines = loadTable(<span class="hl-string">"dfs://olapDemo"</span>, <span class="hl-string">"machines"</span>)
timer{
<strong class="hl-keyword">for</strong>(i <strong class="hl-keyword">in</strong> <span class="hl-number">0.</span><span class="hl-number">.20</span>)
	update machines set tag1=i,tag2=i,tag3=i,tag4=i,tag5=i,tag6=i,tag7=i,tag8=i,tag9=i,tag10=i,tag11=i,tag12=i,tag13=i,tag14=i,tag15=i,tag16=i,tag17=i,tag18=i,tag19=i,tag20=i where id <strong class="hl-keyword">in</strong> <span class="hl-number">1.</span><span class="hl-number">.5</span>,date(datetime)=<span class="hl-number">2020.09</span>.<span class="hl-number">01</span>
}</pre><p class="- topic/p p">统计更新操作耗时如下表：</p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="6-性能分析__entry__1">配置</th><th class="- topic/entry entry colsep-0 rowsep-0" id="6-性能分析__entry__2">第一次执行耗时（ms）</th><th class="- topic/entry entry colsep-0 rowsep-0" id="6-性能分析__entry__3">第二次执行耗时（ms）</th><th class="- topic/entry entry colsep-0 rowsep-0" id="6-性能分析__entry__4">第三次执行耗时（ms）</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">OLAP</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新1条记录的2列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">131.263</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">135.649</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">150.013</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新8640000条记录的2列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">1,389.31</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">1,414.918</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">1,331.718</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新8640000条记录的20列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">6,309.484</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">5,800.256</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">5,511.421</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">TSDB，keepDuplicates=LAST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新1条记录的2列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">29.745</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">31.686</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">29.333</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">插入1条记录</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">10.002</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">12.259</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">10.14</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新8640000条记录的2列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">19,358.699</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">21,832.69</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">19,686.798</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新8640000条记录的20列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">20,782.819</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">22,750.596</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">20,643.41</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">插入8640000条记录</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">10,813.92</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">9,506.557</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">12,695.168</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">TSDB，keepDuplicates=ALL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新8640000条记录的20列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">69,385.771</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">70,563.928</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">62,621.552</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">TSDB，keepDuplicates=FIRST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__1">更新8640000条记录的20列</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__2">57,614.807</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__3">65,081.804</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="6-性能分析__entry__4">58,425.8</td></tr></tbody></table></div><p class="- topic/p p">注：程序运行性能受硬件性能、系统运行状况等因素影响，该表格运行耗时仅供参考。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">存储引擎配置为 OLAP 时</p><p class="- topic/p p">更新性能与需要更新的列数有关，因为更新操作实现为重新生成需要更新的列，而对未更新的列使用了硬链接。故更新 20 列比更新 2 列耗时明显长。</p></li><li class="- topic/li li"><p class="- topic/p p">存储引擎配置为 TSDB keepDuplicates=LAST 时</p><p class="- topic/p p">性能相较  keepDuplicates=ALL 或  keepDuplicates=FIRST 更好，因为更新操作只需要向 LSM 树的追加数据，而 LSM 树具有吞吐量大的特点，写性能优异。更新性能比插入性能慢 2-3 倍，是因为更新需要先读取数据到内存，而插入不需要。</p></li><li class="- topic/li li"><p class="- topic/p p">存储引擎配置为 TSDB keepDuplicates=ALL 或 FIRST 时</p><p class="- topic/p p">更新性能较差，因为该配置下每次更新都会在一个新的目录产生一个新的版本，且未变化的列也会被更新，磁盘 IO 较大，故而性能较差。</p></li></ul><p class="- topic/p p">综上所述，DolphinDB 只适合低频更新。使用 TSDB 引擎时，若对更新的性能有要求，建议配置 keepDuplicates=LAST。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title25" id="7-总结"><h4 class="- topic/title title topictitle4" id="ariaid-title25">7. 总结</h4><div class="- topic/body body"><p class="- topic/p p">本文对比介绍了 OLAP 和 TSDB 两种存储引擎更新分布式表数据的使用方法和基本原理，通过实验来验证基本原理，并分析了常见场景的性能问题。</p><p class="- topic/p p">OLAP 存储引擎的更新性能与需要更新的列数和操作系统是否支持硬链接有关。TSDB 存储引擎的更新性能与建表参数 keepDuplicates 有关，建表参数 keepDuplicates=LAST 比 TSDB keepDuplicates=ALL 或 FIRST 时更新性能更好。</p><p class="- topic/p p">实际应用中使用哪种引擎需要考虑更多的应用场景和实际的性能，更多详细信息可见：</p><ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="../db_distr_comp/db/tsdb.html">TSDB 存储引擎</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="../db_distr_comp/db/olap.html">OLAP 存储引擎</a></li></ul><p class="- topic/p p">有关上述各章节提到的函数，参考：<a class="- topic/xref xref" href="../funcs/funcs_intro.html">函数章节</a></p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title26" id="8-附件"><h4 class="- topic/title title topictitle4" id="ariaid-title26">8. 附件</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="script/dolphindb_update/dolphindb_update.dos">建库表脚本</a></li></ul></div></article></article></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E6%A6%82%E8%BF%B0" data-tocid="1-概述">1. 概述</a></li><li class="topic-item"><a href="#2-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" data-tocid="2-使用方法">2. 使用方法</a></li><li class="topic-item"><a href="#3-%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6%E7%AE%80%E4%BB%8B" data-tocid="3-存储机制简介">3. 存储机制简介</a><ul><li class="topic-item"><a href="#31-olap-%E5%BC%95%E6%93%8E%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84" data-tocid="31-olap-引擎存储结构">3.1. OLAP 引擎存储结构</a></li><li class="topic-item"><a href="#32-tsdb-%E5%BC%95%E6%93%8E%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84" data-tocid="32-tsdb-引擎存储结构">3.2. TSDB 引擎存储结构</a></li></ul></li><li class="topic-item"><a href="#4-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86" data-tocid="4-数据更新原理">4. 数据更新原理</a><ul><li class="topic-item"><a href="#41-olap-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86" data-tocid="41-olap-存储引擎更新原理">4.1. OLAP 存储引擎更新原理</a><ul><li class="topic-item"><a href="#411-%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B" data-tocid="411-更新流程">4.1.1. 更新流程</a><ul><li class="topic-item"><a href="#412-%E5%AE%9A%E6%9C%9F%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6" data-tocid="412-定期回收机制">4.1.2. 定期回收机制</a></li><li class="topic-item"><a href="#413-%E5%BF%AB%E7%85%A7%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB" data-tocid="413-快照隔离级别">4.1.3. 快照隔离级别</a></li></ul></li><li class="topic-item"><a href="#42-tsdb-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86" data-tocid="42-tsdb-存储引擎更新原理">4.2. TSDB 存储引擎更新原理</a><ul><li class="topic-item"><a href="#421-%E5%BB%BA%E8%A1%A8%E5%8F%82%E6%95%B0" data-tocid="421-建表参数">4.2.1. 建表参数</a></li><li class="topic-item"><a href="#422-%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5" data-tocid="422-更新策略">4.2.2. 更新策略</a></li></ul></li><li class="topic-item"><a href="#5-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E5%AE%9E%E9%AA%8C" data-tocid="5-数据更新实验">5. 数据更新实验</a><ul><li class="topic-item"><a href="#51-%E5%AE%9E%E9%AA%8C%E5%87%86%E5%A4%87" data-tocid="51-实验准备">5.1. 实验准备</a><ul><li class="topic-item"><a href="#511-%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4" data-tocid="511-部署集群">5.1.1. 部署集群</a></li><li class="topic-item"><a href="#512-%E5%88%9B%E5%BB%BA%E5%BA%93%E8%A1%A8%E5%92%8C%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE" data-tocid="512-创建库表和写入数据">5.1.2. 创建库表和写入数据</a></li></ul></li><li class="topic-item"><a href="#52-olap-%E5%BC%95%E6%93%8E%E6%9B%B4%E6%96%B0%E5%AE%9E%E9%AA%8C" data-tocid="52-olap-引擎更新实验">5.2. OLAP 引擎更新实验</a></li><li class="topic-item"><a href="#53-tsdb-%E5%BC%95%E6%93%8E%E6%9B%B4%E6%96%B0%E5%AE%9E%E9%AA%8C" data-tocid="53-tsdb-引擎更新实验">5.3. TSDB 引擎更新实验</a><ul><li class="topic-item"><a href="#531-keepduplicates--last" data-tocid="531-keepduplicates--last">5.3.1. keepDuplicates = LAST</a></li><li class="topic-item"><a href="#532-keepduplicates--all" data-tocid="532-keepduplicates--all">5.3.2. keepDuplicates = ALL</a></li><li class="topic-item"><a href="#533-keepduplicates--first" data-tocid="533-keepduplicates--first">5.3.3. keepDuplicates = FIRST</a></li></ul></li></ul></li><li class="topic-item"><a href="#6-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90" data-tocid="6-性能分析">6. 性能分析</a></li><li class="topic-item"><a href="#7-%E6%80%BB%E7%BB%93" data-tocid="7-总结">7. 总结</a></li><li class="topic-item"><a href="#8-%E9%99%84%E4%BB%B6" data-tocid="8-附件">8. 附件</a></li></ul></li></ul></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>