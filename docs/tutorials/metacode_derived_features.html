<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="随着算力的提升和机器学习与深度学习的普及，在进行数据建模时往往会采用批量生成衍生特征的方法来丰富数据集的特征，如：对原有的 10 维特征都采用 max, min, avg, std, sum 这五种方式进行分段时间窗口的聚合，数据的特征将变为 5 维，有可能显著提升模型的准确性。 本教程受 Kaggle 的 Optiver Realized Volatility Prediction ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../stream/str_intro.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="开发股票波动率预测模型的-676-个输入特征"/><title>开发股票波动率预测模型的 676 个输入特征</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;开发股票波动率预测模型的-676-个输入特征&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;开发股票波动率预测模型的 676 个输入特征&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;随着算力的提升和机器学习与深度学习的普及，在进行数据建模时往往会采用批量生成衍生特征的方法来丰富数据集的特征，如：对原有的 10 维特征都采用 max, min, avg, std, sum 这五种方式进行分段时间窗口的聚合，数据的特征将变为 5 维，有可能显著提升模型的准确性。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;本教程受 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.kaggle.com&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;5:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;Kaggle&lt;/xref&gt; 的 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.kaggle.com/competitions/optiver-realized-volatility-prediction/overview/description&#34; scope=&#34;external&#34; xtrc=&#34;xref:2;5:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;Optiver Realized Volatility Prediction&lt;/xref&gt;竞赛项目启发，该项目排名第一的代码中使用了两档的买卖量价数据及 pandas 的元编程实现了批量衍生特征的计算，本教程在此基础上，使用 2021 年 16 支股票的 Level 2 快照数据，在 DolphinDB 中构建频率为 10 分钟的特征，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;5:302&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;低代码量&lt;/b&gt;实现了 676 列衍生特征的计算。与多个 Python Pandas 进程并行计算相比，DolphinDB 能带来&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;5:367&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;约 30 倍的性能提升&lt;/b&gt;。教程还展示了如何在生产环境中用流式计算进行特征的实时计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;注意&lt;/b&gt;：本教程示例代码必须在 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;7:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;2.00.6&lt;/b&gt; 及以上版本的 DolphinDB server 上运行。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:65;103:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_stream.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../stream/str_intro.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_stream.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;流数据&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 流数据引擎及流数据计算的基本概念&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-snapshot-数据文件结构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;1. Snapshot 数据文件结构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;本教程应用的数据源为股票的 level 2 快照数据（Snapshot），每幅快照间隔时间为 3 秒，数据文件结构如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;6&#34; xtrc=&#34;tgroup:1;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:4;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:5;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:6;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;字段&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;13:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;含义&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;13:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;字段&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:4;13:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;含义&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:5;13:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;字段&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:6;13:68&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;含义&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:7;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:8;15:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;证券代码&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:9;15:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;LowPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:10;15:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;最低价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:11;15:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;BidPrice[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:12;15:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;申买十价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:13;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;DateTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:14;16:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;日期时间&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:15;16:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;LastPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:16;16:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;最新价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:17;16:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;BidOrderQty[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:18;16:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;申买十量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:19;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;PreClosePx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:20;17:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;昨收价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:21;17:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;TotalVolumeTrade&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:22;17:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;成交总量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:23;17:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;OfferPrice[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:24;17:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;申卖十价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:25;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;OpenPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:26;18:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;开始价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:27;18:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;TotalValueTrade&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:28;18:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;成交总金额&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:29;18:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;OfferOrderQty[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:30;18:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;申卖十量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:31;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;HighPx&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:32;19:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;最高价&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:33;19:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;InstrumentStatus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:34;19:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;交易状态&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:35;19:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;……&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:36;19:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;……&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;2021 年某市所有股票快照测试数据已经提前导入至 DolphinDB 数据库中，一共约 17 亿条数据，导入方法见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;stockdata_csv_import_demo.md&#34; xtrc=&#34;xref:3;21:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;国内股票行情数据导入实例&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-特征工程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;2. 特征工程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-一级指标&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;2.1. 一级指标&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;一级指标由快照数据中的 10 档买卖单量价数据计算而来：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Weighted Averaged Price(wap)&lt;/b&gt;：加权平均价格&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/wap.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:1;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;389.017958pt&#34; dita-ot:image-height=&#34;30.672396pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Price Spread(priceSpread)&lt;/b&gt;：卖 1 价与买 1 价之差与均价之比&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/pricespread.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:2;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;274.604906pt&#34; dita-ot:image-height=&#34;31.293826pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Bid Price Spread(bidSpread)&lt;/b&gt;：买 1 价和买 2 价之差&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/bidspread.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:3;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;202.60184pt&#34; dita-ot:image-height=&#34;12.131387pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Offer Price Spread(offerSpread)&lt;/b&gt;：卖 1 价和卖 2 价之差&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/offerspread.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:4;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;255.801089pt&#34; dita-ot:image-height=&#34;12.266481pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Total Volume(totalVolume)&lt;/b&gt;：10 档买卖单的总量&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/totalvolume.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:5;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;313.451313pt&#34; dita-ot:image-height=&#34;38.700701pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Volume Imbalance(volumeImbalance)&lt;/b&gt;：买卖单总量之差的绝对值&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/volumeimbalance.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:6;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;365.704089pt&#34; dita-ot:image-height=&#34;38.700701pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Log Return of Offer Price(logReturnOffer)&lt;/b&gt;：卖单价的对数收益&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/logreturnoffer.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:7;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;225.265691pt&#34; dita-ot:image-height=&#34;30.672396pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Log Return of Bid Price(logReturnBid)&lt;/b&gt;：买单价的对数收益&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/logreturnbid.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:8;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;191.156082pt&#34; dita-ot:image-height=&#34;29.897847pt&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-二级指标&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;2.2. 二级指标&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;二级指标由一级指标计算生成&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;WAP Balance(wapBalance)&lt;/b&gt;：加权平均价格之差的绝对值&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/wapbalance.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:9;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;169.681253pt&#34; dita-ot:image-height=&#34;13.50934pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Log Return of WAP(logReturnWap)&lt;/b&gt;：加权平均价格对数收益&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/logreturnwap.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:10;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;170.310991pt&#34; dita-ot:image-height=&#34;26.984347pt&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-衍生特征&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;2.3. 衍生特征&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;衍生特征是对一级指标和二级指标进行 10 分钟级别聚合计算的结果，所用到的聚合函数如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:2;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:7;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:8;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:37;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;指标名称&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:38;77:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;衍生方法&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:39;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;DateTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:40;79:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;count&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:41;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Wap[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:42;80:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:43;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;LogReturn[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:44;81:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, realizedVolatility, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:45;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;LogReturnOffer[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:46;82:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, realizedVolatility, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:47;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;LogReturnBid[10]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:48;83:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, realizedVolatility, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:49;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;WapBalance&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:50;84:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:51;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;PriceSpread&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:52;85:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:53;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;BidSpread&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:54;86:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:55;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;OfferSpread&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:56;87:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:57;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;TotalVolume&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:58;88:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:59;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;VolumeImbalance&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:60;89:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sum, mean, std&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;最终预测的计算指标为实际波动率：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Realized Volatility(realizedVolatility)&lt;/b&gt;：实际波动率&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/realizedvolatility.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:11;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;224.515648pt&#34; dita-ot:image-height=&#34;40.52802pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;同时考虑到特征具有时效性，所以本教程对 10 分钟的特征切分成了 0-600s（全部），150-600s，300-600s，450-600s 四段，分别进行上述衍生指标的计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;10 分钟的快照数据最终形成 676 维的聚合特征，如下图所示：&lt;/b&gt;&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/metacode_derived_features_1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:12;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;2804&#34; dita-ot:image-height=&#34;1588&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-dolphindb-元编程代码&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;3. DolphinDB 元编程代码&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;本教程中的重点和难点是批量生成大量特征列计算表达式，使用元编程的方式可以显著减少所需的代码量。本教程通过元编程函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;105:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;sql&lt;/codeph&gt;生成元代码。在计算特征的自定义聚合函数中，首先进行一二级指标计算，再进行衍生特征计算。通过 DolphinDB 元编程对 level 2 快照数据完成 676 列衍生特征的完整计算代码如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;107:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features.txt&#34; xtrc=&#34;xref:4;107:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 批计算代码&lt;/xref&gt;：十档量价数据用多列存储。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;109:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_arrayVector.txt&#34; xtrc=&#34;xref:5;109:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 批计算代码（数组向量版）&lt;/xref&gt;：十档量价数据用数组向量存储。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-一二级指标计算&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;3.1. 一二级指标计算&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;自定义聚合函数的入参是某支股票的 BidPrice, BidOrderQty, OfferPrice, OfferOrderQty 这四个十档量价数据的矩阵。在 DolphinDB 中对一二级指标的计算代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c++&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;wap = (BidPrice * OfferOrderQty + BidOrderQty * OfferPrice) \ (BidOrderQty + OfferOrderQty) wapBalance = abs(wap[0] - wap[1]) priceSpread = (OfferPrice[0] - BidPrice[0]) \ ((OfferPrice[0] + BidPrice[0]) \ 2) BidSpread = BidPrice[0] - BidPrice[1] OfferSpread = OfferPrice[0] - OfferPrice[1] totalVolume = OfferOrderQty.rowSum() + BidOrderQty.rowSum() volumeImbalance = abs(OfferOrderQty.rowSum() - BidOrderQty.rowSum()) LogReturnWap = logReturn(wap) LogReturnOffer = logReturn(OfferPrice) LogReturnBid = logReturn(BidPrice)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-衍生特征计算&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;3.2. 衍生特征计算&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;130:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;利用 Python 的 pandas 库，通过向 groupby.agg 传入一个字典（字典的 key 为列名，value 为聚合函数列表），即可实现对指定的列进行批量的聚合指标计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;132:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;在 DolphinDB 中，亦可通过自定义函数实现类似的需求，即把字典转换成元编程代码，具体代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c++&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;134:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;def createAggMetaCode(aggDict){ metaCode = [] metaCodeColName = [] for(colName in aggDict.keys()){ for(funcName in aggDict[colName]) { metaCode.append!(sqlCol(colName, funcByName(funcName), colName + `_ + funcName$STRING)) metaCodeColName.append!(colName + `_ + funcName$STRING) } } return metaCode, metaCodeColName$STRING } features = { &#34;DateTime&#34;:[`count] } for(i in 0..9) { features[&#34;Wap&#34;+i] = [`sum, `mean, `std] features[&#34;LogReturn&#34;+i] = [`sum, `realizedVolatility, `mean, `std] features[&#34;LogReturnOffer&#34;+i] = [`sum, `realizedVolatility, `mean, `std] features[&#34;LogReturnBid&#34;+i] = [`sum, `realizedVolatility, `mean, `std] } features[&#34;WapBalance&#34;] = [`sum, `mean, `std] features[&#34;PriceSpread&#34;] = [`sum, `mean, `std] features[&#34;BidSpread&#34;] = [`sum, `mean, `std] features[&#34;OfferSpread&#34;] = [`sum, `mean, `std] features[&#34;TotalVolume&#34;] = [`sum, `mean, `std] features[&#34;VolumeImbalance&#34;] = [`sum, `mean, `std] aggMetaCode, metaCodeColName = createAggMetaCode(features)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;返回结果为元代码向量和对应的元代码列名，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/metacodeResult.png&#34; placement=&#34;break&#34; xtrc=&#34;image:13;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;1422&#34; dita-ot:image-height=&#34;885&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;在计算特征的自定义聚合函数中，为了方便后续使用元编程进行衍生特征计算，需要将一二级指标拼接成一个 table，同时修改列名，具体代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;subTable = table(DateTime as `DateTime, BidPrice, BidOrderQty, OfferPrice, OfferOrderQty, wap, wapBalance, priceSpread, BidSpread, OfferSpread, totalVolume, volumeImbalance, LogReturnWap, LogReturnOffer, LogReturnBid) colNum = 0..9$STRING colName = `DateTime &amp;lt;- (`BidPrice + colNum) &amp;lt;- (`BidOrderQty + colNum) &amp;lt;- (`OfferPrice + colNum) &amp;lt;- (`OfferOrderQty + colNum) &amp;lt;- (`Wap + colNum) &amp;lt;- `WapBalance`PriceSpread`BidSpread`OfferSpread`TotalVolume`VolumeImbalance &amp;lt;- (`LogReturn + colNum) &amp;lt;- (`LogReturnOffer + colNum) &amp;lt;- (`LogReturnBid + colNum) subTable.rename!(colName)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;其中“&amp;lt;-”是 DolphinDB 函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;180:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;join&lt;/codeph&gt;的简写符号，此处用于将各字段拼接成列向量。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;最后将元代码作为参数传入计算特征的自定义聚合函数，配合一二级指标拼接而成的 table 进行 676 列衍生指标的计算，并以 676 列的形式作为聚合结果返回，具体代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c++&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;subTable['BarDateTime'] = bar(subTable['DateTime'], 10m) result = sql(select = aggMetaCode, from = subTable).eval().matrix() result150 = sql(select = aggMetaCode, from = subTable, where = &amp;lt;time(DateTime) &amp;gt;= (time(BarDateTime) + 150*1000) &amp;gt;).eval().matrix() result300 = sql(select = aggMetaCode, from = subTable, where = &amp;lt;time(DateTime) &amp;gt;= (time(BarDateTime) + 300*1000) &amp;gt;).eval().matrix() result450 = sql(select = aggMetaCode, from = subTable, where = &amp;lt;time(DateTime) &amp;gt;= (time(BarDateTime) + 450*1000) &amp;gt;).eval().matrix() return concatMatrix([result, result150, result300, result450])&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;部分计算结果展示&lt;/b&gt;&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/resultTable2021.png&#34; placement=&#34;break&#34; xtrc=&#34;image:14;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;960&#34; dita-ot:image-height=&#34;633&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;衍生特征列名展示&lt;/b&gt;&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/resultColNames.png&#34; placement=&#34;break&#34; xtrc=&#34;image:15;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;1254&#34; dita-ot:image-height=&#34;574&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-dolphindb-vs-python&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;4. DolphinDB vs Python&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;测试数据为 2021 年 16 支股票的 level 2 快照数据，总记录数为 19,220,237。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;计算逻辑为按股票代码分组，计算 676 个 10 分钟聚合指标。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;DolphinDB 和 Python 的 CPU 计算调用资源都是 8 核。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features.txt&#34; xtrc=&#34;xref:6;206:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 批计算代码&lt;/xref&gt;：十档量价数据用多列存储。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_arrayVector.txt&#34; xtrc=&#34;xref:7;207:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 批计算代码（数组向量版）&lt;/xref&gt;：十档量价数据用数组向量存储。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;208:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;py&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_python_script.py&#34; xtrc=&#34;xref:8;208:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;Python 批计算代码&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;由于 DolphinDB 的计算是分布式并行计算，本教程中配置的并行度为 8，因此在使用 Python 实现衍生特征计算时，也采用了 8 的并行度进行并行计算，即同时调用 8 个 Python 进程进行计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:19;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;计算性能对比结果&lt;/b&gt;&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:3;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:9;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:10;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:11;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:12;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:13;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:61;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;股票数量&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:62;214:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;交易天数&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:63;214:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;数据量&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:64;214:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;Python(s)&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:65;214:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;DolphinDB(s)&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:66;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;16&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:67;216:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;243&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:68;216:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;19,220,237&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:69;216:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;3,039&lt;/entry&gt;&lt;entry align=&#34;center&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:70;216:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;100&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-模型构建&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;5. 模型构建&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;DolphinDB 支持一系列常用的机器学习算法，例如 最小二乘回归、随机森林、K - 平均等，使用户能够方便地完成&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.dolphindb.cn/cn/help/200/FunctionsandCommands/FunctionStatistics/index.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:9;220:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;回归、分类、聚类等任务&lt;/xref&gt;。除了内置的经典的机器学习函数，DolphinDB 还支持许多第三方库，因此我们也可以调用 DolphinDB 提供的第三方库插件来进行模型训练。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;XGBOOST（Extreme Gradient Boosting）是一种 Tree Boosting 的可扩展机器学习系统，它在 Gradient Boosting 框架下实现机器学习算法，提供了并行树提升（也称为 GBDT，GBM），可以快速准确地解决许多数据科学的问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;本教程参考 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;machine_learning.md&#34; xtrc=&#34;xref:10;224:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;机器学习教程：使用 DolphinDB 插件进行机器学习&lt;/xref&gt;，选取 XGBOOST 进行训练。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:20;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;注意&lt;/b&gt;：安装 XGBOOST 参考：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;../plugins/xgboost/xgboost.md&#34; xtrc=&#34;xref:11;226:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;XGBOOST 插件安装教程&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;模型评价指标：根均方百分比误差（Root Mean Square Percentage Error, RMSPE）&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/rmspe.svg&#34; placement=&#34;break&#34; xtrc=&#34;image:16;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;176.314364pt&#34; dita-ot:image-height=&#34;48.633876pt&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;对应脚本：&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_buildmodel.txt&#34; xtrc=&#34;xref:12;232:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;模型构建和训练代码&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;51-数据处理&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;5.1. 数据处理&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;删除掉含 NULL 的记录，标注 label 并将构造出来的 676 维特征适当调整为 XGBOOST 输入的数据格式，具体代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c++&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;// 将计算出来的特征中包含 NULL 的记录删除 result = result[each(isValid, result.values()).rowAnd()] result_input = copy(result) // 选取 LogReturn0_realizedVolatility 作为 label label = result[`LogReturn0_realizedVolatility] // 将 SYMBOL 型的 SecurityID 列转换为 XGBOOST 模型支持输入的 INT 型 result_input.update!(`SecurityID_int, int(result[`SecurityID])) // 调整输入的字段，去除不需要的列 result_input.dropColumns!(`SecurityID`DateTime`LogReturn0_realizedVolatility)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:21;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;注意&lt;/b&gt;：本次预测值为未来 10 分钟的波动率，WAP_0 最接近股价，所以选取 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;254:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;LogReturn0_realizedVolatility&lt;/codeph&gt; 作为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;254:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;label&lt;/codeph&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;52-划分训练集和测试集&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;5.2. 划分训练集和测试集&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;258:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;本项目中没有设置验证集，训练集和测试集按 7:3 比例划分，具体代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c++&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;def trainTestSplit(x, testRatio) { xSize = x.size() testSize =(xSize * (1-testRatio))$INT return x[0: testSize], x[testSize:xSize] } Train_x, Test_x = trainTestSplit(result_input, 0.3) Train_y, Test_y = trainTestSplit(label, 0.3)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;53-训练及评价&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;5.3. 训练及评价&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;273:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;DolphinDB 的 XGBOOST 插件中包含 4 个用户接口：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;用于训练模型的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;275:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;xgboost::train()&lt;/codeph&gt;；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;用于预测的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;276:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;xgboost::predict&lt;/codeph&gt;；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;用于保存模型到磁盘的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;277:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;xgboost::saveModel&lt;/codeph&gt;；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;用于从磁盘上加载模型的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;278:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;xgboost::loadModel&lt;/codeph&gt; 。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;具体代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c++&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;// 定义评估指标 RMSPE（Root Mean Square Percentage Error） def RMSPE(a,b) { return sqrt(sum( ((a-b)\a)*((a-b)\a) ) \a.size() ) } // 定义模型训练的参数 params = { objective: 'reg:squarederror', colsample_bytree: 0.8, subsample: 0.8, min_child_weight: 1, max_leaves:128, eta: 0.1, max_depth:10, eval_metric : 'rmse' } //XGBOOST 模型训练 model_1 = xgboost::train(Train_y ,Train_x, params, 500) // 用测试集预测波动率，并计算 RMPSE y_pred = xgboost::predict(model_1, Test_x) print('RMSPE='+RMSPE(Test_y, y_pred))&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:22;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;运行结果&lt;/b&gt;&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;311:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;RMSPE：0.559 模型训练时间：1m 3s 327ms&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;316:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:23;316:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;注意&lt;/b&gt;：本次预测采取手动粗调。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:24;318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;模型保存及加载&lt;/b&gt;&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;// 保存模型，modelSavePath 为保存模型的路径，需要根据实际环境配置 xgboost::saveModel(model_1, modelSavePath) // 模型加载，modelSavePath 为模型的路径，需要根据实际环境配置 model = xgboost::loadModel(modelSavePath)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:25;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;回归模型预测性能&lt;/b&gt;&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:4;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:14;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:15;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:71;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;数据量（条）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:72;330:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;模型预测时间（ms）&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:73;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:74;332:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;0.936&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:75;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:76;333:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;1.832&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;334:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:77;334:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;100&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:78;334:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;9.314&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:79;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;1000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:80;335:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;49.274&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:81;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;10000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:82;336:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;317.656&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-流计算实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;6. 流计算实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;以上部分的计算都是基于批量历史数据的计算。在实际生产环境中，数据的来源往往是以“流”的方式。如何套用上述复杂的衍生特征计算逻辑实现流式计算是业务层面面临的重大难题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;对于这类问题，DolphinDB 内置了多种类型的流计算引擎，以提供简易快捷的低延时解决方案。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;61-流计算实现架构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;6.1. 流计算实现架构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:26;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;流计算处理流程&lt;/b&gt;&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/metacode_derived_features_2.png&#34; placement=&#34;break&#34; xtrc=&#34;image:17;348:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;1693&#34; dita-ot:image-height=&#34;1565&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;实时的流数据通过 DolphinDBAPI 注入至 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;350:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;snapshotStream&lt;/codeph&gt;表中，然后通过订阅/推送，将快照数据注入至时间序列聚合引擎，进行窗口为 10 分钟，步长为 10 分钟的滑动窗口计算。核心代码如下：：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;352:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;352:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;352:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;定义存储 snapshot 的流数据表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;352:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;snapshotStream&lt;/codeph&gt;，特征工程结果表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;352:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;aggrFeatures10min&lt;/codeph&gt;，以及后续模型预测的结果表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;352:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;result10min&lt;/codeph&gt;。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;354:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;name = `SecurityID`DateTime`PreClosePx`OpenPx`HighPx`LowPx`LastPx`TotalVolumeTrade`TotalValueTrade`BidPrice0`BidPrice1`BidPrice2`BidPrice3`BidPrice4`BidPrice5`BidPrice6`BidPrice7`BidPrice8`BidPrice9`BidOrderQty0`BidOrderQty1`BidOrderQty2`BidOrderQty3`BidOrderQty4`BidOrderQty5`BidOrderQty6`BidOrderQty7`BidOrderQty8`BidOrderQty9`OfferPrice0`OfferPrice1`OfferPrice2`OfferPrice3`OfferPrice4`OfferPrice5`OfferPrice6`OfferPrice7`OfferPrice8`OfferPrice9`OfferOrderQty0`OfferOrderQty1`OfferOrderQty2`OfferOrderQty3`OfferOrderQty4`OfferOrderQty5`OfferOrderQty6`OfferOrderQty7`OfferOrderQty8`OfferOrderQty9 type =`SYMBOL`TIMESTAMP`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`INT`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`INT`INT`INT`INT`INT`INT`INT`INT`INT`INT`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`INT`INT`INT`INT`INT`INT`INT`INT`INT`INT share streamTable(100000:0, name, type) as snapshotStream share streamTable(100000:0 , `DateTime`SecurityID &amp;lt;- metaCodeColName &amp;lt;- (metaCodeColName+&#34;_150&#34;) &amp;lt;- (metaCodeColName+&#34;_300&#34;) &amp;lt;- (metaCodeColName+&#34;_450&#34;),`TIMESTAMP`SYMBOL &amp;lt;- take(`DOUBLE, 676)) as aggrFeatures10min share streamTable(100000:0 , `Predicted`SecurityID`DateTime, `FLOAT`SYMBOL`TIMESTAMP) as result10min &lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;365:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;365:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;注册时间序列聚合计算引擎&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;367:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;metrics=sqlColAlias(&amp;lt;featureEngineering(DateTime, matrix(BidPrice0,BidPrice1,BidPrice2,BidPrice3,BidPrice4,BidPrice5,BidPrice6,BidPrice7,BidPrice8,BidPrice9), matrix(BidOrderQty0,BidOrderQty1,BidOrderQty2,BidOrderQty3,BidOrderQty4,BidOrderQty5,BidOrderQty6,BidOrderQty7,BidOrderQty8,BidOrderQty9), matrix(OfferPrice0,OfferPrice1,OfferPrice2,OfferPrice3,OfferPrice4,OfferPrice5,OfferPrice6,OfferPrice7,OfferPrice8,OfferPrice9), matrix(OfferOrderQty0,OfferOrderQty1,OfferOrderQty2,OfferOrderQty3,OfferOrderQty4,OfferOrderQty5,OfferOrderQty6,OfferOrderQty7,OfferOrderQty8,OfferOrderQty9), aggMetaCode)&amp;gt;, metaCodeColName &amp;lt;- (metaCodeColName+&#34;_150&#34;) &amp;lt;- (metaCodeColName+&#34;_300&#34;) &amp;lt;- (metaCodeColName+&#34;_450&#34;)) createTimeSeriesEngine(name=&#34;aggrFeatures10min&#34;, windowSize=600000, step=600000, metrics=metrics, dummyTable=snapshotStream, outputTable=aggrFeatures10min, timeColumn=`DateTime, useWindowStartTime=true, keyColumn=`SecurityID)&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;377:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;377:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;订阅 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;377:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;snapshotStream&lt;/codeph&gt; 流数据表中的实时增量数据&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;379:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;subscribeTable(tableName=&#34;snapshotStream&#34;, actionName=&#34;aggrFeatures10min&#34;, offset=-1, handler=getStreamEngine(&#34;aggrFeatures10min&#34;), msgAsTable=true, batchSize=2000, throttle=1, hash=0, reconnect=true)&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;383:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;383:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;第二个订阅：实时获取 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;383:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;aggrFeatures10min&lt;/codeph&gt; 表中的特征数据，使用已训练好的模型来进行波动率预测，并将最终结果导入到 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;383:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;result10min&lt;/codeph&gt; 表中。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;385:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;def predictRV(mutable result10min, model, mutable msg){ startTime = now() temp_table = select SecurityID, DateTime from msg msg.update!(`SecurityID_int, int(msg[`SecurityID])).dropColumns!(`SecurityID`DateTime`LogReturn0_realizedVolatility) Predicted = xgboost::predict(model , msg) temp_table_2 = table(Predicted, temp_table) result10min.append!(temp_table_2) } subscribeTable(tableName=&#34;aggrFeatures10min&#34;, actionName=&#34;predictRV&#34;, offset=-1, handler=predictRV{result10min, model}, msgAsTable=true, hash=1, reconnect=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;397:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;上述脚本定义的 metrics 中的 featureEngineering 函数与批计算的代码脚本中的自定义聚合函数完全相同，体现了 DolphinDB &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:27;397:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;流批一体&lt;/b&gt; 的优势特点。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;399:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;构建好流计算框架后，我们通过历史数据回放的方式，将附录中的测试数据输入到上游的共享流数据表中。下游结果表中实盘波动率预测的结果展示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/metacode_derived_features/streamingResult.png&#34; placement=&#34;break&#34; xtrc=&#34;image:18;401:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; dita-ot:image-width=&#34;326&#34; dita-ot:image-height=&#34;330&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;62-流计算延时统计&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;6.2. 流计算延时统计&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;405:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;本章节统计了股票在时序聚合引擎中的计算延时情况，流计算延时主要由两部分构成：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;405:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;计算聚合特征的耗时&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;405:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;模型预测实时波动率的耗时&lt;/codeph&gt;。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;407:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;计算聚合特征耗时：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;409:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;timer getStreamEngine('aggrFeatures10min').append!(data)&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;413:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;模型预测实时波动率的耗时&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;415:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;test_x = select * from aggrFeatures10min timer{ temp_table = select SecurityID, DateTime from test_x test_x.update!(`SecurityID_int, int(test_x[`SecurityID])).dropColumns!(`SecurityID`DateTime`LogReturn0_realizedVolatility) Predicted = xgboost::predict(model , test_x) }&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;424:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;424:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;统计结果：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:5;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:16;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:17;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:18;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:19;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:20;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:83;426:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;股票数量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:84;426:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;10 分钟数据量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:85;426:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;计算聚合特征耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:86;426:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;模型预测实时波动率的耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:87;426:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;总耗时&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;428:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;428:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:88;428:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:89;428:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;201&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:90;428:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;22ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:91;428:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;3ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:92;428:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;25ms&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;429:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:93;429:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:94;429:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;2011&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:95;429:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;92ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:96;429:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;3ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:97;429:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;95ms&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;430:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:98;430:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;20&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:99;430:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;4020&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:100;430:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;162ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:101;430:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;4ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:102;430:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;168ms&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;431:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:103;431:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;30&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:104;431:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;6030&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:105;431:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;257ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:106;431:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;5ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:107;431:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;262ms&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;432:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:108;432:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;40&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:109;432:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;8040&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:110;432:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;321ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:111;432:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;6ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:112;432:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;327ms&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;433:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:113;433:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;50&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:114;433:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;10054&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:115;433:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;386ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:116;433:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;7ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:117;433:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;393ms&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_streaming.txt&#34; xtrc=&#34;xref:13;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 流计算代码&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;csv&#34; href=&#34;data/metacode_derived_features/testSnapshot.csv&#34; xtrc=&#34;xref:14;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;level 2 快照测试数据&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;7-附录&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;7. 附录&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features.txt&#34; xtrc=&#34;xref:15;441:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 批计算代码&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_arrayVector.txt&#34; xtrc=&#34;xref:16;442:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 批计算代码（数组向量版）&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_buildmodel.txt&#34; xtrc=&#34;xref:17;443:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;模型构建和训练代码&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;py&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_python_script.py&#34; xtrc=&#34;xref:18;444:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;Python 批计算代码&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/metacode_derived_features/metacode_derived_features_streaming.txt&#34; xtrc=&#34;xref:19;445:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 流计算代码&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;csv&#34; href=&#34;data/metacode_derived_features/testSnapshot.csv&#34; xtrc=&#34;xref:20;446:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;level 2 快照测试数据&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:28;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;开发环境&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;CPU 类型：Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;451:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;逻辑 CPU 总数：8&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;内存：64GB&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;453:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;OS：64 位 CentOS Linux 7 (Core)&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;磁盘：SSD 盘，最大读写速率为 520MB/s&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;455:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;server 版本：2.00.6（企业版）&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;456:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;server 部署模式：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;standalone_server.md&#34; xtrc=&#34;xref:21;456:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;单节点部署教程&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;配置文件：&lt;xref class=&#34;- topic/xref &#34; format=&#34;cfg&#34; href=&#34;script/machine_learning_volatility/200tsdb/dolphindb.cfg&#34; xtrc=&#34;xref:22;457:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/metacode_derived_features.md&#34;&gt;&lt;?ditaot usertext?&gt;dolphindb.cfg&lt;/xref&gt; (volumes, persistenceDir, TSDBRedoLogDir 需要根据实际环境磁盘路径修改)&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/metacode_derived_features.md"/><meta name="wh-out-relpath" content="tutorials/metacode_derived_features.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="开发股票波动率预测模型的-676-个输入特征" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="chap7_tutorials_streaming"><div class="title"><a href="../stream/str_intro.html"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/streaming_auto_sub.html">金融场景应用案例</a></div></div></li><li class="active"><div class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征"><div class="title"><a href="../tutorials/metacode_derived_features.html">开发股票波动率预测模型的 676 个输入特征</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="streamfunctions-d9713e3813" class="topicref" data-id="streamfunctions" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action streamfunctions-d9713e3813-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_funcs.html" id="streamfunctions-d9713e3813-link">功能简介</a></div></div></li><li role="treeitem"><div data-tocid="入门示例-01实时计算买卖价差-d9713e4044" class="topicref" data-id="入门示例-01实时计算买卖价差" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/try_example1.html" id="入门示例-01实时计算买卖价差-d9713e4044-link">入门示例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="内置流式计算算子-d9713e4090" class="topicref" data-id="内置流式计算算子" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 内置流式计算算子-d9713e4090-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_operator.html" id="内置流式计算算子-d9713e4090-link"><span class="keyword label">流式计算算子</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="streamingEngineTopic-d9713e4229" class="topicref" data-id="streamingEngineTopic" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action streamingEngineTopic-d9713e4229-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/themes/streamingEngine.html" id="streamingEngineTopic-d9713e4229-link"><span class="keyword label">流计算引擎</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e4506" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e4506-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_join_engine.html" id="chap7_tutorials_streaming-d9713e4506-link"><span class="keyword label">内置多数据源流式关联引擎</span></a></div></div></li><li role="treeitem"><div data-tocid="streamha-d9713e4783" class="topicref" data-id="streamha" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_ha.html" id="streamha-d9713e4783-link"><span class="keyword label">流数据高可用</span></a></div></div></li><li role="treeitem"><div data-tocid="流计算状态监控-d9713e4830" class="topicref" data-id="流计算状态监控" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_monitor.html" id="流计算状态监控-d9713e4830-link">流计算状态监控</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="replay-d9713e4876" class="topicref" data-id="replay" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action replay-d9713e4876-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_replay.html" id="replay-d9713e4876-link"><span class="keyword label">历史数据回放</span></a></div></div></li><li role="treeitem"><div data-tocid="流批一体功能-d9713e5061" class="topicref" data-id="流批一体功能" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_batch.html" id="流批一体功能-d9713e5061-link"><span class="keyword label">流批一体</span></a></div></div></li><li role="treeitem"><div data-tocid="streamengineparser-解析原理介绍-d9713e5108" class="topicref" data-id="streamengineparser-解析原理介绍" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_eng_parser.html" id="streamengineparser-解析原理介绍-d9713e5108-link">StreamEngineParser 解析原理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="realtime_data_acces-d9713e5155" class="topicref" data-id="realtime_data_acces" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action realtime_data_acces-d9713e5155-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/realtime_data_acces.html" id="realtime_data_acces-d9713e5155-link">实时流数据接入</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="cep-d9713e5617" class="topicref" data-id="cep" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action cep-d9713e5617-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/cep.html" id="cep-d9713e5617-link">复杂事件处理（CEP）引擎</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e6123" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e6123-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/local_sub.html" id="tocId-d9713e6123-link">流处理结果交互方式</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e6312" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e6312-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_altair.html" id="tocId-d9713e6312-link">数据可视化工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e6405" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e6405-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_auto_sub.html" id="tocId-d9713e6405-link">金融场景应用案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="节点启动时的流计算自动订阅-d9713e6406" class="topicref" data-id="节点启动时的流计算自动订阅" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_auto_sub.html" id="节点启动时的流计算自动订阅-d9713e6406-link">节点启动时的流计算自动订阅</a></div></div></li><li role="treeitem"><div data-tocid="k-线计算-d9713e6452" class="topicref" data-id="k-线计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC.html" id="k-线计算-d9713e6452-link">K 线计算</a></div></div></li><li role="treeitem"><div data-tocid="金融因子流式实现-d9713e6498" class="topicref" data-id="金融因子流式实现" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/str_comp_fin_quant.html" id="金融因子流式实现-d9713e6498-link">金融因子流式实现</a></div></div></li><li role="treeitem"><div data-tocid="多数据源流式实时关联处理-d9713e6544" class="topicref" data-id="多数据源流式实时关联处理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing.html" id="多数据源流式实时关联处理-d9713e6544-link">多数据源流式实时关联处理</a></div></div></li><li role="treeitem"><div data-tocid="实时计算高频因子-d9713e6590" class="topicref" data-id="实时计算高频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hf_factor_streaming.html" id="实时计算高频因子-d9713e6590-link">实时计算高频因子</a></div></div></li><li role="treeitem"><div data-tocid="股票行情回放-d9713e6636" class="topicref" data-id="股票行情回放" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_market_replay.html" id="股票行情回放-d9713e6636-link">股票行情回放</a></div></div></li><li role="treeitem"><div data-tocid="金融实时实际波动率预测-d9713e6682" class="topicref" data-id="金融实时实际波动率预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ml_volatility.html" id="金融实时实际波动率预测-d9713e6682-link">金融实时实际波动率预测</a></div></div></li><li role="treeitem" class="active"><div data-tocid="开发股票波动率预测模型的-676-个输入特征-d9713e6728" class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/metacode_derived_features.html" id="开发股票波动率预测模型的-676-个输入特征-d9713e6728-link">开发股票波动率预测模型的 676 个输入特征</a></div></div></li><li role="treeitem"><div data-tocid="实时计算日累计逐单资金流-d9713e6774" class="topicref" data-id="实时计算日累计逐单资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_daily.html" id="实时计算日累计逐单资金流-d9713e6774-link">实时计算日累计逐单资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算分钟资金流-d9713e6820" class="topicref" data-id="实时计算分钟资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_order_by_order.html" id="实时计算分钟资金流-d9713e6820-link">实时计算分钟资金流</a></div></div></li><li role="treeitem"><div data-tocid="流式计算中证-1000-指数主买主卖交易量-d9713e6866" class="topicref" data-id="流式计算中证-1000-指数主买主卖交易量" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/CSI_1000.html" id="流式计算中证-1000-指数主买主卖交易量-d9713e6866-link">流式计算中证 1000 指数主买/主卖交易量</a></div></div></li><li role="treeitem"><div data-tocid="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e6913" class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_snapshot_factor_calc.html" id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e6913-link">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="处理-level-2-行情数据实例-d9713e6959" class="topicref" data-id="处理-level-2-行情数据实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_stk_data_proc.html" id="处理-level-2-行情数据实例-d9713e6959-link">处理 Level-2 行情数据实例</a></div></div></li><li role="treeitem"><div data-tocid="实时计算涨幅榜-d9713e7005" class="topicref" data-id="实时计算涨幅榜" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/rt_stk_price_inc_calc.html" id="实时计算涨幅榜-d9713e7005-link">实时计算涨幅榜</a></div></div></li><li role="treeitem"><div data-tocid="基金份额参考价值-iopv-计算-d9713e7051" class="topicref" data-id="基金份额参考价值-iopv-计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_IOPV.html" id="基金份额参考价值-iopv-计算-d9713e7051-link">基金份额参考价值 IOPV 计算</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7097" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7097-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_str_app_iot.html" id="tocId-d9713e7097-link">物联网场景应用案例</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">开发股票波动率预测模型的 676 个输入特征</h1><div class="- topic/body body"><p class="- topic/p p">随着算力的提升和机器学习与深度学习的普及，在进行数据建模时往往会采用批量生成衍生特征的方法来丰富数据集的特征，如：对原有的 10 维特征都采用 max, min, avg, std, sum 这五种方式进行分段时间窗口的聚合，数据的特征将变为 5 维，有可能显著提升模型的准确性。</p><p class="- topic/p p">本教程受 <a class="- topic/xref xref" href="https://www.kaggle.com" target="_blank" rel="external noopener">Kaggle</a> 的 <a class="- topic/xref xref" href="https://www.kaggle.com/competitions/optiver-realized-volatility-prediction/overview/description" target="_blank" rel="external noopener">Optiver Realized Volatility Prediction</a>竞赛项目启发，该项目排名第一的代码中使用了两档的买卖量价数据及 pandas 的元编程实现了批量衍生特征的计算，本教程在此基础上，使用 2021 年 16 支股票的 Level 2 快照数据，在 DolphinDB 中构建频率为 10 分钟的特征，<strong class="+ topic/ph hi-d/b ph b">低代码量</strong>实现了 676 列衍生特征的计算。与多个 Python Pandas 进程并行计算相比，DolphinDB 能带来<strong class="+ topic/ph hi-d/b ph b">约 30 倍的性能提升</strong>。教程还展示了如何在生产环境中用流式计算进行特征的实时计算。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：本教程示例代码必须在 <strong class="+ topic/ph hi-d/b ph b">2.00.6</strong> 及以上版本的 DolphinDB server 上运行。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-snapshot-数据文件结构"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. Snapshot 数据文件结构</h2><div class="- topic/body body"><p class="- topic/p p">本教程应用的数据源为股票的 level 2 快照数据（Snapshot），每幅快照间隔时间为 3 秒，数据文件结构如下：</p><div class="table-container"><table class="- topic/table table" data-cols="6"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="1-snapshot-数据文件结构__entry__1">字段</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-snapshot-数据文件结构__entry__2">含义</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-snapshot-数据文件结构__entry__3">字段</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-snapshot-数据文件结构__entry__4">含义</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-snapshot-数据文件结构__entry__5">字段</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-snapshot-数据文件结构__entry__6">含义</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__1">SecurityID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__2">证券代码</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__3">LowPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__4">最低价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__5">BidPrice[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__6">申买十价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__1">DateTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__2">日期时间</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__3">LastPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__4">最新价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__5">BidOrderQty[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__6">申买十量</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__1">PreClosePx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__2">昨收价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__3">TotalVolumeTrade</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__4">成交总量</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__5">OfferPrice[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__6">申卖十价</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__1">OpenPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__2">开始价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__3">TotalValueTrade</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__4">成交总金额</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__5">OfferOrderQty[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__6">申卖十量</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__1">HighPx</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__2">最高价</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__3">InstrumentStatus</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__4">交易状态</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__5">……</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-snapshot-数据文件结构__entry__6">……</td></tr></tbody></table></div><p class="- topic/p p">2021 年某市所有股票快照测试数据已经提前导入至 DolphinDB 数据库中，一共约 17 亿条数据，导入方法见 <a class="- topic/xref xref" href="stockdata_csv_import_demo.html">国内股票行情数据导入实例</a>。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-特征工程"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. 特征工程</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-一级指标"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1. 一级指标</h3><div class="- topic/body body"><p class="- topic/p p">一级指标由快照数据中的 10 档买卖单量价数据计算而来：</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Weighted Averaged Price(wap)</strong>：加权平均价格</p><br/><img class="- topic/image image" src="images/metacode_derived_features/wap.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Price Spread(priceSpread)</strong>：卖 1 价与买 1 价之差与均价之比</p><br/><img class="- topic/image image" src="images/metacode_derived_features/pricespread.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Bid Price Spread(bidSpread)</strong>：买 1 价和买 2 价之差</p><br/><img class="- topic/image image" src="images/metacode_derived_features/bidspread.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Offer Price Spread(offerSpread)</strong>：卖 1 价和卖 2 价之差</p><br/><img class="- topic/image image" src="images/metacode_derived_features/offerspread.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Total Volume(totalVolume)</strong>：10 档买卖单的总量</p><br/><img class="- topic/image image" src="images/metacode_derived_features/totalvolume.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Volume Imbalance(volumeImbalance)</strong>：买卖单总量之差的绝对值</p><br/><img class="- topic/image image" src="images/metacode_derived_features/volumeimbalance.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Log Return of Offer Price(logReturnOffer)</strong>：卖单价的对数收益</p><br/><img class="- topic/image image" src="images/metacode_derived_features/logreturnoffer.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Log Return of Bid Price(logReturnBid)</strong>：买单价的对数收益</p><br/><img class="- topic/image image" src="images/metacode_derived_features/logreturnbid.svg"/><br/></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="22-二级指标"><h3 class="- topic/title title topictitle3" id="ariaid-title5">2.2. 二级指标</h3><div class="- topic/body body"><p class="- topic/p p">二级指标由一级指标计算生成</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">WAP Balance(wapBalance)</strong>：加权平均价格之差的绝对值</p><br/><img class="- topic/image image" src="images/metacode_derived_features/wapbalance.svg"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Log Return of WAP(logReturnWap)</strong>：加权平均价格对数收益</p><br/><img class="- topic/image image" src="images/metacode_derived_features/logreturnwap.svg"/><br/></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="23-衍生特征"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.3. 衍生特征</h3><div class="- topic/body body"><p class="- topic/p p">衍生特征是对一级指标和二级指标进行 10 分钟级别聚合计算的结果，所用到的聚合函数如下：</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="23-衍生特征__entry__1">指标名称</th><th class="- topic/entry entry colsep-0 rowsep-0" id="23-衍生特征__entry__2">衍生方法</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">DateTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">count</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">Wap[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">LogReturn[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, realizedVolatility, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">LogReturnOffer[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, realizedVolatility, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">LogReturnBid[10]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, realizedVolatility, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">WapBalance</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">PriceSpread</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">BidSpread</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">OfferSpread</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">TotalVolume</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, mean, std</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__1">VolumeImbalance</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="23-衍生特征__entry__2">sum, mean, std</td></tr></tbody></table></div><p class="- topic/p p">最终预测的计算指标为实际波动率：</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Realized Volatility(realizedVolatility)</strong>：实际波动率</p><br/><img class="- topic/image image" src="images/metacode_derived_features/realizedvolatility.svg"/><br/><p class="- topic/p p">同时考虑到特征具有时效性，所以本教程对 10 分钟的特征切分成了 0-600s（全部），150-600s，300-600s，450-600s 四段，分别进行上述衍生指标的计算。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">10 分钟的快照数据最终形成 676 维的聚合特征，如下图所示：</strong></p><br/><img class="- topic/image image" src="../stream/images/metacode_derived_features_1.png"/><br/></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title7" id="3-dolphindb-元编程代码"><h2 class="- topic/title title topictitle2" id="ariaid-title7">3. DolphinDB 元编程代码</h2><div class="- topic/body body"><p class="- topic/p p">本教程中的重点和难点是批量生成大量特征列计算表达式，使用元编程的方式可以显著减少所需的代码量。本教程通过元编程函数<code class="+ topic/ph pr-d/codeph ph codeph">sql</code>生成元代码。在计算特征的自定义聚合函数中，首先进行一二级指标计算，再进行衍生特征计算。通过 DolphinDB 元编程对 level 2 快照数据完成 676 列衍生特征的完整计算代码如下：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features.txt">DolphinDB 批计算代码</a>：十档量价数据用多列存储。</p></li><li class="- topic/li li"><p class="- topic/p p"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_arrayVector.txt">DolphinDB 批计算代码（数组向量版）</a>：十档量价数据用数组向量存储。</p></li></ul></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="31-一二级指标计算"><h3 class="- topic/title title topictitle3" id="ariaid-title8">3.1. 一二级指标计算</h3><div class="- topic/body body"><p class="- topic/p p">自定义聚合函数的入参是某支股票的 BidPrice, BidOrderQty, OfferPrice, OfferOrderQty 这四个十档量价数据的矩阵。在 DolphinDB 中对一二级指标的计算代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock c++"><code>wap = (BidPrice * OfferOrderQty + BidOrderQty * OfferPrice) \ (BidOrderQty + OfferOrderQty)
wapBalance = abs(wap[0] - wap[1])
priceSpread = (OfferPrice[0] - BidPrice[0]) \ ((OfferPrice[0] + BidPrice[0]) \ 2)
BidSpread = BidPrice[0] - BidPrice[1]
OfferSpread = OfferPrice[0] - OfferPrice[1]
totalVolume = OfferOrderQty.rowSum() + BidOrderQty.rowSum()
volumeImbalance = abs(OfferOrderQty.rowSum() - BidOrderQty.rowSum())
LogReturnWap = logReturn(wap)
LogReturnOffer = logReturn(OfferPrice)
LogReturnBid = logReturn(BidPrice)</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="32-衍生特征计算"><h3 class="- topic/title title topictitle3" id="ariaid-title9">3.2. 衍生特征计算</h3><div class="- topic/body body"><p class="- topic/p p">利用 Python 的 pandas 库，通过向 groupby.agg 传入一个字典（字典的 key 为列名，value 为聚合函数列表），即可实现对指定的列进行批量的聚合指标计算。</p><p class="- topic/p p">在 DolphinDB 中，亦可通过自定义函数实现类似的需求，即把字典转换成元编程代码，具体代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock c++"><code>def createAggMetaCode(aggDict){
 metaCode = []
 metaCodeColName = []
 for(colName in aggDict.keys()){
  for(funcName in aggDict[colName])
  {
   metaCode.append!(sqlCol(colName, funcByName(funcName), colName + `_ + funcName$STRING))
   metaCodeColName.append!(colName + `_ + funcName$STRING)
  }
 }
 return metaCode, metaCodeColName$STRING
}

features = {
 "DateTime":[`count]
}
for(i in 0..9)
{
 features["Wap"+i] = [`sum, `mean, `std]
 features["LogReturn"+i] = [`sum, `realizedVolatility, `mean, `std]
 features["LogReturnOffer"+i] = [`sum, `realizedVolatility, `mean, `std]
 features["LogReturnBid"+i] = [`sum, `realizedVolatility, `mean, `std]
}
features["WapBalance"] = [`sum, `mean, `std]
features["PriceSpread"] = [`sum, `mean, `std]
features["BidSpread"] = [`sum, `mean, `std]
features["OfferSpread"] = [`sum, `mean, `std]
features["TotalVolume"] = [`sum, `mean, `std]
features["VolumeImbalance"] = [`sum, `mean, `std]
aggMetaCode, metaCodeColName = createAggMetaCode(features)</code></pre><p class="- topic/p p">返回结果为元代码向量和对应的元代码列名，如下图所示：</p><br/><img class="- topic/image image" src="images/metacode_derived_features/metacodeResult.png"/><br/><p class="- topic/p p">在计算特征的自定义聚合函数中，为了方便后续使用元编程进行衍生特征计算，需要将一二级指标拼接成一个 table，同时修改列名，具体代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>subTable = table(DateTime as `DateTime, BidPrice, BidOrderQty, OfferPrice, OfferOrderQty, wap, wapBalance, priceSpread, BidSpread, OfferSpread, totalVolume, volumeImbalance, LogReturnWap, LogReturnOffer, LogReturnBid)
colNum = 0..9$STRING
colName = `DateTime &lt;- (`BidPrice + colNum) &lt;- (`BidOrderQty + colNum) &lt;- (`OfferPrice + colNum) &lt;- (`OfferOrderQty + colNum) &lt;- (`Wap + colNum) &lt;- `WapBalance`PriceSpread`BidSpread`OfferSpread`TotalVolume`VolumeImbalance &lt;- (`LogReturn + colNum) &lt;- (`LogReturnOffer + colNum) &lt;- (`LogReturnBid + colNum)
subTable.rename!(colName)</code></pre><p class="- topic/p p">其中“&lt;-”是 DolphinDB 函数<code class="+ topic/ph pr-d/codeph ph codeph">join</code>的简写符号，此处用于将各字段拼接成列向量。</p><p class="- topic/p p">最后将元代码作为参数传入计算特征的自定义聚合函数，配合一二级指标拼接而成的 table 进行 676 列衍生指标的计算，并以 676 列的形式作为聚合结果返回，具体代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock c++"><code>subTable['BarDateTime'] = bar(subTable['DateTime'], 10m)
result = sql(select = aggMetaCode, from = subTable).eval().matrix()
result150 = sql(select = aggMetaCode, from = subTable, where = &lt;time(DateTime) &gt;= (time(BarDateTime) + 150*1000) &gt;).eval().matrix()
result300 = sql(select = aggMetaCode, from = subTable, where = &lt;time(DateTime) &gt;= (time(BarDateTime) + 300*1000) &gt;).eval().matrix()
result450 = sql(select = aggMetaCode, from = subTable, where = &lt;time(DateTime) &gt;= (time(BarDateTime) + 450*1000) &gt;).eval().matrix()
return concatMatrix([result, result150, result300, result450])</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">部分计算结果展示</strong></p><br/><img class="- topic/image image" src="images/metacode_derived_features/resultTable2021.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">衍生特征列名展示</strong></p><br/><img class="- topic/image image" src="images/metacode_derived_features/resultColNames.png"/><br/></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title10" id="4-dolphindb-vs-python"><h2 class="- topic/title title topictitle2" id="ariaid-title10">4. DolphinDB vs Python</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">测试数据为 2021 年 16 支股票的 level 2 快照数据，总记录数为 19,220,237。</li><li class="- topic/li li">计算逻辑为按股票代码分组，计算 676 个 10 分钟聚合指标。</li><li class="- topic/li li">DolphinDB 和 Python 的 CPU 计算调用资源都是 8 核。</li><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features.txt">DolphinDB 批计算代码</a>：十档量价数据用多列存储。</li><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_arrayVector.txt">DolphinDB 批计算代码（数组向量版）</a>：十档量价数据用数组向量存储。</li><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_python_script.py">Python 批计算代码</a></li></ul><p class="- topic/p p">由于 DolphinDB 的计算是分布式并行计算，本教程中配置的并行度为 8，因此在使用 Python 实现衍生特征计算时，也采用了 8 的并行度进行并行计算，即同时调用 8 个 Python 进程进行计算。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">计算性能对比结果</strong></p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-center colsep-0 rowsep-0" id="4-dolphindb-vs-python__entry__1">股票数量</th><th class="- topic/entry entry align-center colsep-0 rowsep-0" id="4-dolphindb-vs-python__entry__2">交易天数</th><th class="- topic/entry entry align-center colsep-0 rowsep-0" id="4-dolphindb-vs-python__entry__3">数据量</th><th class="- topic/entry entry align-center colsep-0 rowsep-0" id="4-dolphindb-vs-python__entry__4">Python(s)</th><th class="- topic/entry entry align-center colsep-0 rowsep-0" id="4-dolphindb-vs-python__entry__5">DolphinDB(s)</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-center colsep-0 rowsep-0" headers="4-dolphindb-vs-python__entry__1">16</td><td class="- topic/entry entry align-center colsep-0 rowsep-0" headers="4-dolphindb-vs-python__entry__2">243</td><td class="- topic/entry entry align-center colsep-0 rowsep-0" headers="4-dolphindb-vs-python__entry__3">19,220,237</td><td class="- topic/entry entry align-center colsep-0 rowsep-0" headers="4-dolphindb-vs-python__entry__4">3,039</td><td class="- topic/entry entry align-center colsep-0 rowsep-0" headers="4-dolphindb-vs-python__entry__5">100</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title11" id="5-模型构建"><h2 class="- topic/title title topictitle2" id="ariaid-title11">5. 模型构建</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 支持一系列常用的机器学习算法，例如 最小二乘回归、随机森林、K - 平均等，使用户能够方便地完成<a class="- topic/xref xref" href="https://www.dolphindb.cn/cn/help/200/FunctionsandCommands/FunctionStatistics/index.html" target="_blank" rel="external noopener">回归、分类、聚类等任务</a>。除了内置的经典的机器学习函数，DolphinDB 还支持许多第三方库，因此我们也可以调用 DolphinDB 提供的第三方库插件来进行模型训练。</p><p class="- topic/p p">XGBOOST（Extreme Gradient Boosting）是一种 Tree Boosting 的可扩展机器学习系统，它在 Gradient Boosting 框架下实现机器学习算法，提供了并行树提升（也称为 GBDT，GBM），可以快速准确地解决许多数据科学的问题。</p><p class="- topic/p p">本教程参考 <a class="- topic/xref xref" href="machine_learning.html">机器学习教程：使用 DolphinDB 插件进行机器学习</a>，选取 XGBOOST 进行训练。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：安装 XGBOOST 参考：<a class="- topic/xref xref" href="../plugins/xgboost/xgboost.html">XGBOOST 插件安装教程</a></p><p class="- topic/p p">模型评价指标：根均方百分比误差（Root Mean Square Percentage Error, RMSPE）</p><br/><img class="- topic/image image" src="images/metacode_derived_features/rmspe.svg"/><br/><p class="- topic/p p">对应脚本：<a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_buildmodel.txt">模型构建和训练代码</a></p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="51-数据处理"><h3 class="- topic/title title topictitle3" id="ariaid-title12">5.1. 数据处理</h3><div class="- topic/body body"><p class="- topic/p p">删除掉含 NULL 的记录，标注 label 并将构造出来的 676 维特征适当调整为 XGBOOST 输入的数据格式，具体代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock c++"><code>// 将计算出来的特征中包含 NULL 的记录删除
result = result[each(isValid, result.values()).rowAnd()]

result_input = copy(result)

// 选取 LogReturn0_realizedVolatility 作为 label
label = result[`LogReturn0_realizedVolatility]

// 将 SYMBOL 型的 SecurityID 列转换为 XGBOOST 模型支持输入的 INT 型
result_input.update!(`SecurityID_int, int(result[`SecurityID]))

// 调整输入的字段，去除不需要的列
result_input.dropColumns!(`SecurityID`DateTime`LogReturn0_realizedVolatility)</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：本次预测值为未来 10 分钟的波动率，WAP_0 最接近股价，所以选取 <code class="+ topic/ph pr-d/codeph ph codeph">LogReturn0_realizedVolatility</code> 作为 <code class="+ topic/ph pr-d/codeph ph codeph">label</code>。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title13" id="52-划分训练集和测试集"><h3 class="- topic/title title topictitle3" id="ariaid-title13">5.2. 划分训练集和测试集</h3><div class="- topic/body body"><p class="- topic/p p">本项目中没有设置验证集，训练集和测试集按 7:3 比例划分，具体代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock c++"><code>def trainTestSplit(x, testRatio) {
    xSize = x.size()
    testSize =(xSize * (1-testRatio))$INT
    return x[0: testSize], x[testSize:xSize]
}

Train_x, Test_x = trainTestSplit(result_input, 0.3)
Train_y, Test_y = trainTestSplit(label, 0.3)</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title14" id="53-训练及评价"><h3 class="- topic/title title topictitle3" id="ariaid-title14">5.3. 训练及评价</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 的 XGBOOST 插件中包含 4 个用户接口：</p><ul class="- topic/ul ul"><li class="- topic/li li">用于训练模型的 <code class="+ topic/ph pr-d/codeph ph codeph">xgboost::train()</code>；</li><li class="- topic/li li">用于预测的 <code class="+ topic/ph pr-d/codeph ph codeph">xgboost::predict</code>；</li><li class="- topic/li li">用于保存模型到磁盘的 <code class="+ topic/ph pr-d/codeph ph codeph">xgboost::saveModel</code>；</li><li class="- topic/li li">用于从磁盘上加载模型的 <code class="+ topic/ph pr-d/codeph ph codeph">xgboost::loadModel</code> 。</li></ul><p class="- topic/p p">具体代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock c++"><code>// 定义评估指标 RMSPE（Root Mean Square Percentage Error）
def RMSPE(a,b)
{
 return sqrt(sum( ((a-b)\a)*((a-b)\a) ) \a.size()  )
}

// 定义模型训练的参数
params = {
 objective: 'reg:squarederror',
 colsample_bytree: 0.8,
 subsample: 0.8,
 min_child_weight: 1,
 max_leaves:128,
 eta: 0.1,
 max_depth:10,
 eval_metric : 'rmse'
 }

//XGBOOST 模型训练
model_1 = xgboost::train(Train_y ,Train_x, params, 500)

// 用测试集预测波动率，并计算 RMPSE
y_pred = xgboost::predict(model_1, Test_x)
print('RMSPE='+RMSPE(Test_y, y_pred))</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">运行结果</strong></p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>RMSPE：0.559
模型训练时间：1m 3s 327ms</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：本次预测采取手动粗调。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">模型保存及加载</strong></p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 保存模型，modelSavePath 为保存模型的路径，需要根据实际环境配置
xgboost::saveModel(model_1, modelSavePath)

// 模型加载，modelSavePath 为模型的路径，需要根据实际环境配置
model = xgboost::loadModel(modelSavePath)</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">回归模型预测性能</strong></p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="53-训练及评价__entry__1">数据量（条）</th><th class="- topic/entry entry colsep-0 rowsep-0" id="53-训练及评价__entry__2">模型预测时间（ms）</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__2">0.936</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__1">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__2">1.832</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__1">100</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__2">9.314</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__1">1000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__2">49.274</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__1">10000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="53-训练及评价__entry__2">317.656</td></tr></tbody></table></div></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title15" id="6-流计算实现"><h2 class="- topic/title title topictitle2" id="ariaid-title15">6. 流计算实现</h2><div class="- topic/body body"><p class="- topic/p p">以上部分的计算都是基于批量历史数据的计算。在实际生产环境中，数据的来源往往是以“流”的方式。如何套用上述复杂的衍生特征计算逻辑实现流式计算是业务层面面临的重大难题。</p><p class="- topic/p p">对于这类问题，DolphinDB 内置了多种类型的流计算引擎，以提供简易快捷的低延时解决方案。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title16" id="61-流计算实现架构"><h3 class="- topic/title title topictitle3" id="ariaid-title16">6.1. 流计算实现架构</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">流计算处理流程</strong></p><br/><img class="- topic/image image" src="../stream/images/metacode_derived_features_2.png"/><br/><p class="- topic/p p">实时的流数据通过 DolphinDBAPI 注入至 <code class="+ topic/ph pr-d/codeph ph codeph">snapshotStream</code>表中，然后通过订阅/推送，将快照数据注入至时间序列聚合引擎，进行窗口为 10 分钟，步长为 10 分钟的滑动窗口计算。核心代码如下：：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">定义存储 snapshot 的流数据表 <code class="+ topic/ph pr-d/codeph ph codeph">snapshotStream</code>，特征工程结果表 <code class="+ topic/ph pr-d/codeph ph codeph">aggrFeatures10min</code>，以及后续模型预测的结果表 <code class="+ topic/ph pr-d/codeph ph codeph">result10min</code>。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>name = `SecurityID`DateTime`PreClosePx`OpenPx`HighPx`LowPx`LastPx`TotalVolumeTrade`TotalValueTrade`BidPrice0`BidPrice1`BidPrice2`BidPrice3`BidPrice4`BidPrice5`BidPrice6`BidPrice7`BidPrice8`BidPrice9`BidOrderQty0`BidOrderQty1`BidOrderQty2`BidOrderQty3`BidOrderQty4`BidOrderQty5`BidOrderQty6`BidOrderQty7`BidOrderQty8`BidOrderQty9`OfferPrice0`OfferPrice1`OfferPrice2`OfferPrice3`OfferPrice4`OfferPrice5`OfferPrice6`OfferPrice7`OfferPrice8`OfferPrice9`OfferOrderQty0`OfferOrderQty1`OfferOrderQty2`OfferOrderQty3`OfferOrderQty4`OfferOrderQty5`OfferOrderQty6`OfferOrderQty7`OfferOrderQty8`OfferOrderQty9

type =`SYMBOL`TIMESTAMP`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`INT`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`INT`INT`INT`INT`INT`INT`INT`INT`INT`INT`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`DOUBLE`INT`INT`INT`INT`INT`INT`INT`INT`INT`INT

share streamTable(100000:0, name, type) as snapshotStream
share streamTable(100000:0 , `DateTime`SecurityID &lt;- metaCodeColName &lt;- (metaCodeColName+"_150") &lt;- (metaCodeColName+"_300") &lt;- (metaCodeColName+"_450"),`TIMESTAMP`SYMBOL &lt;- take(`DOUBLE, 676)) as aggrFeatures10min
share streamTable(100000:0 , `Predicted`SecurityID`DateTime, `FLOAT`SYMBOL`TIMESTAMP) as result10min
</code></pre></li><li class="- topic/li li"><p class="- topic/p p">注册时间序列聚合计算引擎</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>metrics=sqlColAlias(&lt;featureEngineering(DateTime,
  matrix(BidPrice0,BidPrice1,BidPrice2,BidPrice3,BidPrice4,BidPrice5,BidPrice6,BidPrice7,BidPrice8,BidPrice9),
  matrix(BidOrderQty0,BidOrderQty1,BidOrderQty2,BidOrderQty3,BidOrderQty4,BidOrderQty5,BidOrderQty6,BidOrderQty7,BidOrderQty8,BidOrderQty9),
  matrix(OfferPrice0,OfferPrice1,OfferPrice2,OfferPrice3,OfferPrice4,OfferPrice5,OfferPrice6,OfferPrice7,OfferPrice8,OfferPrice9),
  matrix(OfferOrderQty0,OfferOrderQty1,OfferOrderQty2,OfferOrderQty3,OfferOrderQty4,OfferOrderQty5,OfferOrderQty6,OfferOrderQty7,OfferOrderQty8,OfferOrderQty9), aggMetaCode)&gt;, metaCodeColName &lt;- (metaCodeColName+"_150") &lt;- (metaCodeColName+"_300") &lt;- (metaCodeColName+"_450"))

createTimeSeriesEngine(name="aggrFeatures10min", windowSize=600000, step=600000, metrics=metrics, dummyTable=snapshotStream, outputTable=aggrFeatures10min, timeColumn=`DateTime, useWindowStartTime=true, keyColumn=`SecurityID)</code></pre></li><li class="- topic/li li"><p class="- topic/p p">订阅 <code class="+ topic/ph pr-d/codeph ph codeph">snapshotStream</code> 流数据表中的实时增量数据</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>subscribeTable(tableName="snapshotStream", actionName="aggrFeatures10min", offset=-1, handler=getStreamEngine("aggrFeatures10min"), msgAsTable=true, batchSize=2000, throttle=1, hash=0, reconnect=true)</code></pre></li><li class="- topic/li li"><p class="- topic/p p">第二个订阅：实时获取 <code class="+ topic/ph pr-d/codeph ph codeph">aggrFeatures10min</code> 表中的特征数据，使用已训练好的模型来进行波动率预测，并将最终结果导入到 <code class="+ topic/ph pr-d/codeph ph codeph">result10min</code> 表中。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def predictRV(mutable result10min, model, mutable msg){
 startTime = now()
 temp_table = select SecurityID, DateTime from msg
 msg.update!(`SecurityID_int, int(msg[`SecurityID])).dropColumns!(`SecurityID`DateTime`LogReturn0_realizedVolatility)
 Predicted = xgboost::predict(model , msg)
 temp_table_2 = table(Predicted, temp_table)
 result10min.append!(temp_table_2)
}
subscribeTable(tableName="aggrFeatures10min", actionName="predictRV", offset=-1, handler=predictRV{result10min, model}, msgAsTable=true, hash=1, reconnect=true)</code></pre><p class="- topic/p p">上述脚本定义的 metrics 中的 featureEngineering 函数与批计算的代码脚本中的自定义聚合函数完全相同，体现了 DolphinDB <strong class="+ topic/ph hi-d/b ph b">流批一体</strong> 的优势特点。</p><p class="- topic/p p">构建好流计算框架后，我们通过历史数据回放的方式，将附录中的测试数据输入到上游的共享流数据表中。下游结果表中实盘波动率预测的结果展示：</p><br/><img class="- topic/image image" src="images/metacode_derived_features/streamingResult.png"/><br/></li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title17" id="62-流计算延时统计"><h3 class="- topic/title title topictitle3" id="ariaid-title17">6.2. 流计算延时统计</h3><div class="- topic/body body"><p class="- topic/p p">本章节统计了股票在时序聚合引擎中的计算延时情况，流计算延时主要由两部分构成：<code class="+ topic/ph pr-d/codeph ph codeph">计算聚合特征的耗时</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">模型预测实时波动率的耗时</code>。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">计算聚合特征耗时：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>timer getStreamEngine('aggrFeatures10min').append!(data)</code></pre></li><li class="- topic/li li"><p class="- topic/p p">模型预测实时波动率的耗时</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>test_x  = select * from aggrFeatures10min
timer{
temp_table = select SecurityID, DateTime from test_x
test_x.update!(`SecurityID_int, int(test_x[`SecurityID])).dropColumns!(`SecurityID`DateTime`LogReturn0_realizedVolatility)
Predicted = xgboost::predict(model , test_x)
}</code></pre></li><li class="- topic/li li"><p class="- topic/p p">统计结果：</p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="62-流计算延时统计__entry__1">股票数量</th><th class="- topic/entry entry colsep-0 rowsep-0" id="62-流计算延时统计__entry__2">10 分钟数据量</th><th class="- topic/entry entry colsep-0 rowsep-0" id="62-流计算延时统计__entry__3">计算聚合特征耗时</th><th class="- topic/entry entry colsep-0 rowsep-0" id="62-流计算延时统计__entry__4">模型预测实时波动率的耗时</th><th class="- topic/entry entry colsep-0 rowsep-0" id="62-流计算延时统计__entry__5">总耗时</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__2">201</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__3">22ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__4">3ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__5">25ms</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__1">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__2">2011</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__3">92ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__4">3ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__5">95ms</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__1">20</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__2">4020</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__3">162ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__4">4ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__5">168ms</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__1">30</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__2">6030</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__3">257ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__4">5ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__5">262ms</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__1">40</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__2">8040</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__3">321ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__4">6ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__5">327ms</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__1">50</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__2">10054</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__3">386ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__4">7ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-流计算延时统计__entry__5">393ms</td></tr></tbody></table></div></li></ul><p class="- topic/p p"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_streaming.txt">DolphinDB 流计算代码</a></p><p class="- topic/p p"><a class="- topic/xref xref" href="data/metacode_derived_features/testSnapshot.csv">level 2 快照测试数据</a></p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title18" id="7-附录"><h2 class="- topic/title title topictitle2" id="ariaid-title18">7. 附录</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features.txt">DolphinDB 批计算代码</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_arrayVector.txt">DolphinDB 批计算代码（数组向量版）</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_buildmodel.txt">模型构建和训练代码</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_python_script.py">Python 批计算代码</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/metacode_derived_features/metacode_derived_features_streaming.txt">DolphinDB 流计算代码</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="data/metacode_derived_features/testSnapshot.csv">level 2 快照测试数据</a></li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">开发环境</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">CPU 类型：Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz</li><li class="- topic/li li">逻辑 CPU 总数：8</li><li class="- topic/li li">内存：64GB</li><li class="- topic/li li">OS：64 位 CentOS Linux 7 (Core)</li><li class="- topic/li li">磁盘：SSD 盘，最大读写速率为 520MB/s</li><li class="- topic/li li">server 版本：2.00.6（企业版）</li><li class="- topic/li li">server 部署模式：<a class="- topic/xref xref" href="standalone_server.html">单节点部署教程</a></li><li class="- topic/li li">配置文件：<a class="- topic/xref xref" href="script/machine_learning_volatility/200tsdb/dolphindb.cfg">dolphindb.cfg</a> (volumes, persistenceDir, TSDBRedoLogDir 需要根据实际环境磁盘路径修改)</li></ul></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-snapshot-%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84" data-tocid="1-snapshot-数据文件结构">1. Snapshot 数据文件结构</a></li><li class="topic-item"><a href="#2-%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B" data-tocid="2-特征工程">2. 特征工程</a><ul><li class="topic-item"><a href="#21-%E4%B8%80%E7%BA%A7%E6%8C%87%E6%A0%87" data-tocid="21-一级指标">2.1. 一级指标</a></li><li class="topic-item"><a href="#22-%E4%BA%8C%E7%BA%A7%E6%8C%87%E6%A0%87" data-tocid="22-二级指标">2.2. 二级指标</a></li><li class="topic-item"><a href="#23-%E8%A1%8D%E7%94%9F%E7%89%B9%E5%BE%81" data-tocid="23-衍生特征">2.3. 衍生特征</a></li></ul></li><li class="topic-item"><a href="#3-dolphindb-%E5%85%83%E7%BC%96%E7%A8%8B%E4%BB%A3%E7%A0%81" data-tocid="3-dolphindb-元编程代码">3. DolphinDB 元编程代码</a><ul><li class="topic-item"><a href="#31-%E4%B8%80%E4%BA%8C%E7%BA%A7%E6%8C%87%E6%A0%87%E8%AE%A1%E7%AE%97" data-tocid="31-一二级指标计算">3.1. 一二级指标计算</a></li><li class="topic-item"><a href="#32-%E8%A1%8D%E7%94%9F%E7%89%B9%E5%BE%81%E8%AE%A1%E7%AE%97" data-tocid="32-衍生特征计算">3.2. 衍生特征计算</a></li></ul></li><li class="topic-item"><a href="#4-dolphindb-vs-python" data-tocid="4-dolphindb-vs-python">4. DolphinDB vs Python</a></li><li class="topic-item"><a href="#5-%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA" data-tocid="5-模型构建">5. 模型构建</a><ul><li class="topic-item"><a href="#51-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86" data-tocid="51-数据处理">5.1. 数据处理</a></li><li class="topic-item"><a href="#52-%E5%88%92%E5%88%86%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E6%B5%8B%E8%AF%95%E9%9B%86" data-tocid="52-划分训练集和测试集">5.2. 划分训练集和测试集</a></li><li class="topic-item"><a href="#53-%E8%AE%AD%E7%BB%83%E5%8F%8A%E8%AF%84%E4%BB%B7" data-tocid="53-训练及评价">5.3. 训练及评价</a></li></ul></li><li class="topic-item"><a href="#6-%E6%B5%81%E8%AE%A1%E7%AE%97%E5%AE%9E%E7%8E%B0" data-tocid="6-流计算实现">6. 流计算实现</a><ul><li class="topic-item"><a href="#61-%E6%B5%81%E8%AE%A1%E7%AE%97%E5%AE%9E%E7%8E%B0%E6%9E%B6%E6%9E%84" data-tocid="61-流计算实现架构">6.1. 流计算实现架构</a></li><li class="topic-item"><a href="#62-%E6%B5%81%E8%AE%A1%E7%AE%97%E5%BB%B6%E6%97%B6%E7%BB%9F%E8%AE%A1" data-tocid="62-流计算延时统计">6.2. 流计算延时统计</a></li></ul></li><li class="topic-item"><a href="#7-%E9%99%84%E5%BD%95" data-tocid="7-附录">7. 附录</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>