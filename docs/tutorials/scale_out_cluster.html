<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="本教程讲述如何水平扩展一个 DolphinDB 集群，以增强其数据容量及计算能力。 离线扩展数据节点的主要步骤如下： 在新服务器上部署 agent，并且配置好 agent.cfg 向 controller 注册新的 data node 信息和 agent 信息 重启集群内 controller 和所有 data node 在线扩展数据节点的主要步骤如下： 在新服务器上部署 agent，并且配置好 ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../sys_man/cluster_manage.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="集群扩容"/><title>集群扩容</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;集群扩容&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;集群扩容&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;本教程讲述如何水平扩展一个 DolphinDB 集群，以增强其数据容量及计算能力。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:3;13:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_om.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../sys_man/cluster_manage.dita&#34; mapclass=&#34;- map/topicref &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:2;12:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_om.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot gentext?&gt;集群管理&lt;/linktext&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;基本方法&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;基本方法&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;离线扩展数据节点的主要步骤如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在新服务器上部署 agent，并且配置好 agent.cfg&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;向 controller 注册新的 data node 信息和 agent 信息&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;重启集群内 controller 和所有 data node&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在线扩展数据节点的主要步骤如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在新服务器上部署 agent，并且配置好 agent.cfg&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;向 controller 注册新的 data node 信息和 agent 信息&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;启动新节点&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;若仅对某数据节点存储空间进行扩展，例如增加磁盘卷，只需要修改节点配置文件，为指定节点 volumes 参数 增加路径。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;扩展数据节点&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;扩展数据节点&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;本例中，我们将为已有集群增加一台新的物理服务器，并在其上增加一个新的数据节点。1.30.4 之前版本 DolphinDB 只支持离线方式扩展，需要重启集群 (详细步骤见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#离线增加数据节点&#34; xtrc=&#34;xref:1;23:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;离线增加数据节点&lt;/xref&gt;)，1.30.4 版本新增动态方式扩展数据节点，无需重启集群 (详细步骤见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#在线增加数据节点&#34; xtrc=&#34;xref:2;23:143&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;在线增加数据节点&lt;/xref&gt;)。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;原集群的配置情况为：服务器 4 台，操作系统均为 ubuntu 16.04，部署了 DolphinDB 1.30.4 版本。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;172.18.0.10 : controller 172.18.0.11 : datanode1 172.18.0.12 : datanode2 172.18.0.13 : datanode3&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;具体的配置文件如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;controller.cfg&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;localSite=172.18.0.10:8990:ctl8990&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;cluster.nodes&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;localSite,mode 172.18.0.11:8701:agent1,agent 172.18.0.12:8701:agent2,agent 172.18.0.13:8701:agent3,agent 172.18.0.11:8801:node1,datanode 172.18.0.12:8802:node2,datanode 172.18.0.13:8803:node3,datanode&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;54:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;启动 controller 脚本：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;nohup ./dolphindb -console 0 -mode controller -script dolphindb.dos -config config/controller.cfg -logFile log/controller.log -nodesFile config/cluster.nodes &amp;amp;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;启动 agent 脚本：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;62:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;./dolphindb -mode agent -home data -script dolphindb.dos -config config/agent.cfg -logFile log/agent.log&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;66:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;为了在扩展集群工作完成之后验证效果，在集群内创建一个分布式数据库，并写入初始数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;data = table(1..1000 as id,rand(`A`B`C,1000) as name) //分区时预留了1000的余量，预备后续写入测试用 db = database(&#34;dfs://scaleout_test_db&#34;,RANGE,cutPoints(1..2000,10)) tb = db.createPartitionedTable(data,&#34;scaleoutTB&#34;,`id) tb.append!(data)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;执行完后点击集群 web 管理界面的 DFS Explorer 按钮，查看生成的数据分布情况。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/scaleout/scale_dfs_exp1.PNG&#34; placement=&#34;break&#34; xtrc=&#34;image:1;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; dita-ot:image-width=&#34;947&#34; dita-ot:image-height=&#34;370&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:1;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在后续完成集群扩展之后，我们会向此数据库中追加数据，来验证拓展部分是否已经启用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;注意&lt;/b&gt;：需要了解集群初始化配置可以参考 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;multi_machine_cluster_deployment.md&#34; xtrc=&#34;xref:3;82:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;多物理机上部署集群教程&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;需要新增的物理机 IP：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;172.18.0.14&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;新增的节点信息：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;172.18.0.14:8804:datanode4&lt;/codeblock&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;离线增加数据节点&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;离线增加数据节点&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;配置-agent&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;配置 agent&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;原服务器上的 agent 部署在/home/&amp;lt;DolphinDBRoot&amp;gt;目录下，将该目录下文件拷贝到新机器的/home/&amp;lt;DolphinDBRoot&amp;gt;目录，并对/home/&amp;lt;DolphinDBRoot&amp;gt;/config/agent.cfg 做如下修改：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;cmd&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;//指定新的agent node的IP和端口号 localSite=172.18.0.14:8701:agent4 //controller信息 controllerSite=172.18.0.10:8990:ctl8990 mode=agent&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;配置-controller&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;配置 controller&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;修改节点清单配置 cluster.nodes，配置新增加的 data node 和 agent node:&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;116:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;localSite,mode 172.18.0.11:8701:agent1,agent 172.18.0.12:8701:agent2,agent 172.18.0.13:8701:agent3,agent 172.18.0.11:8801:node1,datanode 172.18.0.12:8802:node2,datanode 172.18.0.13:8803:node3,datanode //新增agent和data node 172.18.0.14:8704:agent4,agent 172.18.0.14:8804:node4,datanode&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;重启集群&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;重启集群&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;集群扩展数据节点必须重启整个集群，包括集群 controller 和所有的 data node。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;访问集群 web 管理界面 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;133:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;http://172.18.0.10:8990&lt;/codeph&gt; ，关闭所有的数据节点。&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/scaleout/controller_stopAll.PNG&#34; placement=&#34;break&#34; xtrc=&#34;image:2;135:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; dita-ot:image-width=&#34;1274&#34; dita-ot:image-height=&#34;363&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:2;135:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;137:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在 172.18.0.10 服务器上执行 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;137:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;pkill -9 dolphindb&lt;/codeph&gt;以关闭 controller。。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;139:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;重新启动 controller。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;141:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;回到 web 管理界面，可以看到已经新增了一个 agent4，在 web 界面上启动所有数据节点。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/scaleout/Controller_StartAll.PNG&#34; placement=&#34;break&#34; xtrc=&#34;image:3;143:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; dita-ot:image-width=&#34;1240&#34; dita-ot:image-height=&#34;363&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:3;143:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;至此我们已经完成了离线方式新节点的增加。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;在线增加数据节点&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在线增加数据节点&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;服务器配置文件的修改同前述离线增加数据节点相关章节，修改完 agent.cfg 以及 cluster.nodes，启动该服务器上的 agent 节点，然后通过 web 或 GUI 连接集群的控制节点并执行以下代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;addAgentToController(&#34;172.18.0.14&#34;,8704,&#34;agent4&#34;); addNode(&#34;172.18.0.14&#34;,8804,&#34;node4&#34;);&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;回到 web 管理界面，可以看到已经新增了一个 agent4 并且是未启动状态，再在 web 界面上启动所有数据节点。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;至此我们已经完成了在线方式新节点的增加。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;验证&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;验证&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;162:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;下面我们通过向集群写入一些数据来验证 node4 是否已经在集群中启用。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;tb = database(&#34;dfs://scaleout_test_db&#34;).loadTable(&#34;scaleoutTB&#34;) tb.append!(table(1001..2000 as id,rand(`A`B`C,1000) as name))&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;点击 DFS Explorer 并打开 scaleout_test_db，可以看到数据已经分布到新添加的 node4 节点上。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/scaleout/scale_dfs_exp2.PNG&#34; placement=&#34;break&#34; xtrc=&#34;image:4;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; dita-ot:image-width=&#34;942&#34; dita-ot:image-height=&#34;520&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:4;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;扩展数据节点后的数据分布机制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;扩展数据节点后的数据分布机制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在流行的 MPP 架构的集群中，添加节点后因为 hash 值变了，必须要对一部分数据 resharding，而通常对海量数据做 resharding 需要很长时间。DolphinDB 的数据存储基于底层分布式文件系统，通过元数据进行数据副本的管理，所以扩展了节点之后，不需要对原有的数据进行 resharding，新增的数据会保存到新的数据节点去。通过 resharding 可以让数据分布更加均匀，DolphinDB 正在开发这样的工具。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;扩展存储&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;扩展存储&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;本例中沿用上例中的原有集群。由于 node3 所在服务器本身的磁盘空间不足，为 node3 扩展了一块磁盘，路径为/dev/disk2。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;步骤&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;步骤&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;DolphinDB 的节点存储可以通过配置参数 volumes 来配置，默认的存储路径为&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;183:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&amp;lt;HomeDir&amp;gt;/&amp;lt;Data Node Alias&amp;gt;/storage&lt;/codeph&gt;，本例中为&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;183:87&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;/home/server/data/node3/storage&lt;/codeph&gt;目录。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;注意&lt;/b&gt;：若从默认路径增加磁盘，那么在设置 volumes 参数时，必须要将原默认路径显式设置，否则会导致默认路径下元数据丢失。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;默认的 volumes 参数值如下，如果 cluster.cfg 中没有这一行，需要手工添加。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;cluster.cfg&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;node3.volumes=/home/server/data/node3/storage &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;要增加新的磁盘路径&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;195:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;/dev/disk2/node3&lt;/codeph&gt;到 node3 节点，只要将路径添加到上述配置后，用逗号分隔即可。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;cluster.cfg&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;node3.volumes=/home/server/data/node3/storage,/dev/disk2/node3&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;修改配置文件后，在 controller 上执行&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;203:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;loadClusterNodesConfigs()&lt;/codeph&gt;使得 controller 重新载入节点配置。如果上述步骤在集群管理 web 界面上完成，这个重载过程会自动完成，无需手工执行&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;203:115&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;loadClusterNodesConfigs()&lt;/codeph&gt;。配置完成后无需重启 controller，只要在 web 界面上重启 node3 节点即可使新配置生效。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;注意&lt;/b&gt;：如果希望 node3 暂不重启，但是新的存储马上生效，可以在 node3 上执行 addVolumes(&#34;/dev/disk2/node3&#34;) 函数动态添加 volumes，此函数的效果并不会持久化，重启后会被新配置覆盖。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;验证-1&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;验证&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;配置完成后，使用下面的语句向集群写入新数据，查看数据是否被写入新的磁盘卷。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;tb = database(&#34;dfs://scaleout_test_db&#34;).loadTable(&#34;scaleoutTB&#34;) tb.append!(table(1501..2000 as id,rand(`A`B`C,500) as name))&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;数据已被写入：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/scaleout/3.PNG&#34; placement=&#34;break&#34; xtrc=&#34;image:5;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34; dita-ot:image-width=&#34;515&#34; dita-ot:image-height=&#34;131&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:5;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;image&lt;/alt&gt;&lt;/image&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;常见问题&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;常见问题&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;在验证节点的数据写入分布情况时 , 从 dfs explorer 里经常会发现 site 信息有时候会发生变化，比如原来保存在 node3 的数据迁移到其他节点了？&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;这个问题涉及到 DolphinDB 的 Recovery 机制：DolphinDB 的集群支持数据自动 Recovery 机制，当侦测到集群内部分节点长时间没有心跳时 (判定宕机)，将会从其他副本中自动恢复数据并且保持整个集群的副本数稳定，这也是当某个节点长时间未启动，系统后台会发生数据迁移的原因。需要注意的是，这个数据稳定的前提是宕掉的节点数少于系统设置的数据副本数。这个机制涉及到的配置项及默认值如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;controller.cfg&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;//集群内每个数据副本数，默认2 dfsReplicationFactor=2 //副本安全策略，0 多个副本允许存在一个节点 1 多个副本必须分存到不同节点,默认0 dfsReplicaReliabilityLevel=1 //节点心跳停止多久开启Recovery,默认不启用，单位ms dfsRecoveryWaitTime=30000&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;这 3 个参数对于系统的数据稳定性非常重要。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;239:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;dfsRecoveryWaitTime 控制 recovery 的启动，默认不设置即关闭 recovery 功能。这个等待时间的设置主要是为了避免一些计划内的停机维护导致不必要的 recovery，需要用户根据运维的实际情况来设置。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;241:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;从稳定性上来讲，副本数越多数据越不容易因意外丢失，但是副本数过多也会导致系统保存数据时性能低下，所以 dfsReplicationFactor 的值不建议低于 2，但是具体设置多高需要用户根据整体集群的节点数、数据稳定性需求、系统写入性能需求来综合考虑。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;243:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/scale_out_cluster.md&#34;&gt;dfsReplicaReliabilityLevel 这个设置在生产环境下建议设置为 1，0 只建议作为学习或者测试环境下使用。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/scale_out_cluster.md"/><meta name="wh-out-relpath" content="tutorials/scale_out_cluster.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="集群扩容" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="chap7_tutorials_system_management"><div class="title"><a href="../sys_man/om_intro.html"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li><div class="topicref" data-id="cluster_manage"><div class="title"><a href="../sys_man/cluster_manage.html">集群管理</a></div></div></li><li class="active"><div class="topicref" data-id="集群扩容"><div class="title"><a href="../tutorials/scale_out_cluster.html">集群扩容</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="true"><div data-tocid="cluster_manage-d9713e7993" class="topicref" data-id="cluster_manage" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action cluster_manage-d9713e7993-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/cluster_manage.html" id="cluster_manage-d9713e7993-link">集群管理</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" class="active"><div data-tocid="集群扩容-d9713e8039" class="topicref" data-id="集群扩容" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scale_out_cluster.html" id="集群扩容-d9713e8039-link">集群扩容</a></div></div></li><li role="treeitem"><div data-tocid="使用计算节点-d9713e8085" class="topicref" data-id="使用计算节点" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Compute_Node.html" id="使用计算节点-d9713e8085-link">使用计算节点</a></div></div></li><li role="treeitem"><div data-tocid="高可用集群的灰度升级-d9713e8131" class="topicref" data-id="高可用集群的灰度升级" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/gray_scale_upgrade_ha.html" id="高可用集群的灰度升级-d9713e8131-link">高可用集群的灰度升级</a></div></div></li><li role="treeitem"><div data-tocid="使用-haproxy-实现负载均衡-d9713e8177" class="topicref" data-id="使用-haproxy-实现负载均衡" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/haProxy_best_practices.html" id="使用-haproxy-实现负载均衡-d9713e8177-link">使用 HAProxy 实现负载均衡</a></div></div></li><li role="treeitem"><div data-tocid="multi_cluster_management-d9713e8223" class="topicref" data-id="multi_cluster_management" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/multi_cluster_management.html" id="multi_cluster_management-d9713e8223-link">多集群管理</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e8269" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e8269-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/thread_intro.html" id="tocId-d9713e8269-link">任务管理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="e6_97_a0_e6_a0_87_e9_a2_9810-d9713e8454" class="topicref" data-id="e6_97_a0_e6_a0_87_e9_a2_9810" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action e6_97_a0_e6_a0_87_e9_a2_9810-d9713e8454-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/e6_97_a0_e6_a0_87_e9_a2_9810.html" id="e6_97_a0_e6_a0_87_e9_a2_9810-d9713e8454-link">登录管理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="性能监控-d9713e8546" class="topicref" data-id="性能监控" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 性能监控-d9713e8546-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/perf_man.html" id="性能监控-d9713e8546-link"><span class="keyword label">运维监控</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e8639" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e8639-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/bak_resto.html" id="tocId-d9713e8639-link">安全与容灾</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">集群扩容</h1><div class="- topic/body body"><p class="- topic/p p">本教程讲述如何水平扩展一个 DolphinDB 集群，以增强其数据容量及计算能力。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="基本方法"><h2 class="- topic/title title topictitle2" id="ariaid-title2">基本方法</h2><div class="- topic/body body"><p class="- topic/p p">离线扩展数据节点的主要步骤如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">在新服务器上部署 agent，并且配置好 agent.cfg</li><li class="- topic/li li">向 controller 注册新的 data node 信息和 agent 信息</li><li class="- topic/li li">重启集群内 controller 和所有 data node</li></ul><p class="- topic/p p">在线扩展数据节点的主要步骤如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">在新服务器上部署 agent，并且配置好 agent.cfg</li><li class="- topic/li li">向 controller 注册新的 data node 信息和 agent 信息</li><li class="- topic/li li">启动新节点</li></ul><p class="- topic/p p">若仅对某数据节点存储空间进行扩展，例如增加磁盘卷，只需要修改节点配置文件，为指定节点 volumes 参数 增加路径。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="扩展数据节点"><h2 class="- topic/title title topictitle2" id="ariaid-title3">扩展数据节点</h2><div class="- topic/body body"><p class="- topic/p p">本例中，我们将为已有集群增加一台新的物理服务器，并在其上增加一个新的数据节点。1.30.4 之前版本 DolphinDB 只支持离线方式扩展，需要重启集群 (详细步骤见<a class="- topic/xref xref" href="#%E7%A6%BB%E7%BA%BF%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9">离线增加数据节点</a>)，1.30.4 版本新增动态方式扩展数据节点，无需重启集群 (详细步骤见<a class="- topic/xref xref" href="#%E5%9C%A8%E7%BA%BF%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9">在线增加数据节点</a>)。</p><p class="- topic/p p">原集群的配置情况为：服务器 4 台，操作系统均为 ubuntu 16.04，部署了 DolphinDB 1.30.4 版本。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>172.18.0.10 : controller
172.18.0.11 : datanode1
172.18.0.12 : datanode2
172.18.0.13 : datanode3</code></pre><p class="- topic/p p">具体的配置文件如下：</p><p class="- topic/p p">controller.cfg</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>localSite=172.18.0.10:8990:ctl8990</code></pre><p class="- topic/p p">cluster.nodes</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>localSite,mode
172.18.0.11:8701:agent1,agent
172.18.0.12:8701:agent2,agent
172.18.0.13:8701:agent3,agent
172.18.0.11:8801:node1,datanode
172.18.0.12:8802:node2,datanode
172.18.0.13:8803:node3,datanode</code></pre><p class="- topic/p p">启动 controller 脚本：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>nohup ./dolphindb -console 0 -mode controller -script dolphindb.dos -config config/controller.cfg -logFile log/controller.log -nodesFile config/cluster.nodes &amp;</code></pre><p class="- topic/p p">启动 agent 脚本：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>./dolphindb -mode agent -home data -script dolphindb.dos -config config/agent.cfg -logFile log/agent.log</code></pre><p class="- topic/p p">为了在扩展集群工作完成之后验证效果，在集群内创建一个分布式数据库，并写入初始数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>data = table(1..1000 as id,rand(`A`B`C,1000) as name)
//分区时预留了1000的余量，预备后续写入测试用
db = database("dfs://scaleout_test_db",RANGE,cutPoints(1..2000,10))
tb = db.createPartitionedTable(data,"scaleoutTB",`id)
tb.append!(data)</code></pre><p class="- topic/p p">执行完后点击集群 web 管理界面的 DFS Explorer 按钮，查看生成的数据分布情况。</p><br/><img class="- topic/image image" src="images/scaleout/scale_dfs_exp1.PNG" alt="image"/><br/><p class="- topic/p p">在后续完成集群扩展之后，我们会向此数据库中追加数据，来验证拓展部分是否已经启用。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：需要了解集群初始化配置可以参考 <a class="- topic/xref xref" href="multi_machine_cluster_deployment.html">多物理机上部署集群教程</a>。</p><p class="- topic/p p">需要新增的物理机 IP：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>172.18.0.14</code></pre><p class="- topic/p p">新增的节点信息：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>172.18.0.14:8804:datanode4</code></pre></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="离线增加数据节点"><h3 class="- topic/title title topictitle3" id="ariaid-title4">离线增加数据节点</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title5" id="配置-agent"><h4 class="- topic/title title topictitle4" id="ariaid-title5">配置 agent</h4><div class="- topic/body body"><p class="- topic/p p">原服务器上的 agent 部署在/home/&lt;DolphinDBRoot&gt;目录下，将该目录下文件拷贝到新机器的/home/&lt;DolphinDBRoot&gt;目录，并对/home/&lt;DolphinDBRoot&gt;/config/agent.cfg 做如下修改：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock cmd">//指定新的agent node的IP和端口号
localSite=<span class="hl-number">172.18</span>.<span class="hl-number">0.14</span>:<span class="hl-number">8701</span>:agent4

//controller信息
controllerSite=<span class="hl-number">172.18</span>.<span class="hl-number">0.10</span>:<span class="hl-number">8990</span>:ctl8990

<strong class="hl-keyword">mode</strong>=agent</pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title6" id="配置-controller"><h4 class="- topic/title title topictitle4" id="ariaid-title6">配置 controller</h4><div class="- topic/body body"><p class="- topic/p p">修改节点清单配置 cluster.nodes，配置新增加的 data node 和 agent node:</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>localSite,mode
172.18.0.11:8701:agent1,agent
172.18.0.12:8701:agent2,agent
172.18.0.13:8701:agent3,agent
172.18.0.11:8801:node1,datanode
172.18.0.12:8802:node2,datanode
172.18.0.13:8803:node3,datanode
//新增agent和data node
172.18.0.14:8704:agent4,agent
172.18.0.14:8804:node4,datanode</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title7" id="重启集群"><h4 class="- topic/title title topictitle4" id="ariaid-title7">重启集群</h4><div class="- topic/body body"><p class="- topic/p p">集群扩展数据节点必须重启整个集群，包括集群 controller 和所有的 data node。</p><ul class="- topic/ul ul"><li class="- topic/li li">访问集群 web 管理界面 <code class="+ topic/ph pr-d/codeph ph codeph">http://172.18.0.10:8990</code> ，关闭所有的数据节点。</li></ul><br/><img class="- topic/image image" src="images/scaleout/controller_stopAll.PNG" alt="image"/><br/><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">在 172.18.0.10 服务器上执行 <code class="+ topic/ph pr-d/codeph ph codeph">pkill -9 dolphindb</code>以关闭 controller。。</p></li><li class="- topic/li li"><p class="- topic/p p">重新启动 controller。</p></li><li class="- topic/li li"><p class="- topic/p p">回到 web 管理界面，可以看到已经新增了一个 agent4，在 web 界面上启动所有数据节点。</p></li></ul><br/><img class="- topic/image image" src="images/scaleout/Controller_StartAll.PNG" alt="image"/><br/><p class="- topic/p p">至此我们已经完成了离线方式新节点的增加。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="在线增加数据节点"><h3 class="- topic/title title topictitle3" id="ariaid-title8">在线增加数据节点</h3><div class="- topic/body body"><p class="- topic/p p">服务器配置文件的修改同前述离线增加数据节点相关章节，修改完 agent.cfg 以及 cluster.nodes，启动该服务器上的 agent 节点，然后通过 web 或 GUI 连接集群的控制节点并执行以下代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>addAgentToController("172.18.0.14",8704,"agent4");
addNode("172.18.0.14",8804,"node4");</code></pre><p class="- topic/p p">回到 web 管理界面，可以看到已经新增了一个 agent4 并且是未启动状态，再在 web 界面上启动所有数据节点。</p><p class="- topic/p p">至此我们已经完成了在线方式新节点的增加。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="验证"><h3 class="- topic/title title topictitle3" id="ariaid-title9">验证</h3><div class="- topic/body body"><p class="- topic/p p">下面我们通过向集群写入一些数据来验证 node4 是否已经在集群中启用。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>tb = database("dfs://scaleout_test_db").loadTable("scaleoutTB")
tb.append!(table(1001..2000 as id,rand(`A`B`C,1000) as name))</code></pre><p class="- topic/p p">点击 DFS Explorer 并打开 scaleout_test_db，可以看到数据已经分布到新添加的 node4 节点上。</p><br/><img class="- topic/image image" src="images/scaleout/scale_dfs_exp2.PNG" alt="image"/><br/></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="扩展数据节点后的数据分布机制"><h3 class="- topic/title title topictitle3" id="ariaid-title10">扩展数据节点后的数据分布机制</h3><div class="- topic/body body"><p class="- topic/p p">在流行的 MPP 架构的集群中，添加节点后因为 hash 值变了，必须要对一部分数据 resharding，而通常对海量数据做 resharding 需要很长时间。DolphinDB 的数据存储基于底层分布式文件系统，通过元数据进行数据副本的管理，所以扩展了节点之后，不需要对原有的数据进行 resharding，新增的数据会保存到新的数据节点去。通过 resharding 可以让数据分布更加均匀，DolphinDB 正在开发这样的工具。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title11" id="扩展存储"><h2 class="- topic/title title topictitle2" id="ariaid-title11">扩展存储</h2><div class="- topic/body body"><p class="- topic/p p">本例中沿用上例中的原有集群。由于 node3 所在服务器本身的磁盘空间不足，为 node3 扩展了一块磁盘，路径为/dev/disk2。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="步骤"><h3 class="- topic/title title topictitle3" id="ariaid-title12">步骤</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 的节点存储可以通过配置参数 volumes 来配置，默认的存储路径为<code class="+ topic/ph pr-d/codeph ph codeph">&lt;HomeDir&gt;/&lt;Data Node Alias&gt;/storage</code>，本例中为<code class="+ topic/ph pr-d/codeph ph codeph">/home/server/data/node3/storage</code>目录。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：若从默认路径增加磁盘，那么在设置 volumes 参数时，必须要将原默认路径显式设置，否则会导致默认路径下元数据丢失。</p><p class="- topic/p p">默认的 volumes 参数值如下，如果 cluster.cfg 中没有这一行，需要手工添加。</p><p class="- topic/p p">cluster.cfg</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>node3.volumes=/home/server/data/node3/storage </code></pre><p class="- topic/p p">要增加新的磁盘路径<code class="+ topic/ph pr-d/codeph ph codeph">/dev/disk2/node3</code>到 node3 节点，只要将路径添加到上述配置后，用逗号分隔即可。</p><p class="- topic/p p">cluster.cfg</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>node3.volumes=/home/server/data/node3/storage,/dev/disk2/node3</code></pre><p class="- topic/p p">修改配置文件后，在 controller 上执行<code class="+ topic/ph pr-d/codeph ph codeph">loadClusterNodesConfigs()</code>使得 controller 重新载入节点配置。如果上述步骤在集群管理 web 界面上完成，这个重载过程会自动完成，无需手工执行<code class="+ topic/ph pr-d/codeph ph codeph">loadClusterNodesConfigs()</code>。配置完成后无需重启 controller，只要在 web 界面上重启 node3 节点即可使新配置生效。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：如果希望 node3 暂不重启，但是新的存储马上生效，可以在 node3 上执行 addVolumes("/dev/disk2/node3") 函数动态添加 volumes，此函数的效果并不会持久化，重启后会被新配置覆盖。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title13" id="验证-1"><h3 class="- topic/title title topictitle3" id="ariaid-title13">验证</h3><div class="- topic/body body"><p class="- topic/p p">配置完成后，使用下面的语句向集群写入新数据，查看数据是否被写入新的磁盘卷。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>tb = database("dfs://scaleout_test_db").loadTable("scaleoutTB")
tb.append!(table(1501..2000 as id,rand(`A`B`C,500) as name))</code></pre><p class="- topic/p p">数据已被写入：</p><br/><img class="- topic/image image" src="images/scaleout/3.PNG" alt="image"/><br/></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title14" id="常见问题"><h2 class="- topic/title title topictitle2" id="ariaid-title14">常见问题</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">在验证节点的数据写入分布情况时 , 从 dfs explorer 里经常会发现 site 信息有时候会发生变化，比如原来保存在 node3 的数据迁移到其他节点了？</li></ul><p class="- topic/p p">这个问题涉及到 DolphinDB 的 Recovery 机制：DolphinDB 的集群支持数据自动 Recovery 机制，当侦测到集群内部分节点长时间没有心跳时 (判定宕机)，将会从其他副本中自动恢复数据并且保持整个集群的副本数稳定，这也是当某个节点长时间未启动，系统后台会发生数据迁移的原因。需要注意的是，这个数据稳定的前提是宕掉的节点数少于系统设置的数据副本数。这个机制涉及到的配置项及默认值如下：</p><p class="- topic/p p">controller.cfg</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//集群内每个数据副本数，默认2
dfsReplicationFactor=2
//副本安全策略，0 多个副本允许存在一个节点 1 多个副本必须分存到不同节点,默认0
dfsReplicaReliabilityLevel=1
//节点心跳停止多久开启Recovery,默认不启用，单位ms
dfsRecoveryWaitTime=30000</code></pre><p class="- topic/p p">这 3 个参数对于系统的数据稳定性非常重要。</p><p class="- topic/p p">dfsRecoveryWaitTime 控制 recovery 的启动，默认不设置即关闭 recovery 功能。这个等待时间的设置主要是为了避免一些计划内的停机维护导致不必要的 recovery，需要用户根据运维的实际情况来设置。</p><p class="- topic/p p">从稳定性上来讲，副本数越多数据越不容易因意外丢失，但是副本数过多也会导致系统保存数据时性能低下，所以 dfsReplicationFactor 的值不建议低于 2，但是具体设置多高需要用户根据整体集群的节点数、数据稳定性需求、系统写入性能需求来综合考虑。</p><p class="- topic/p p">dfsReplicaReliabilityLevel 这个设置在生产环境下建议设置为 1，0 只建议作为学习或者测试环境下使用。</p></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95" data-tocid="基本方法">基本方法</a></li><li class="topic-item"><a href="#%E6%89%A9%E5%B1%95%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9" data-tocid="扩展数据节点">扩展数据节点</a><ul><li class="topic-item"><a href="#%E7%A6%BB%E7%BA%BF%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9" data-tocid="离线增加数据节点">离线增加数据节点</a><ul><li class="topic-item"><a href="#%E9%85%8D%E7%BD%AE-agent" data-tocid="配置-agent">配置 agent</a></li><li class="topic-item"><a href="#%E9%85%8D%E7%BD%AE-controller" data-tocid="配置-controller">配置 controller</a></li><li class="topic-item"><a href="#%E9%87%8D%E5%90%AF%E9%9B%86%E7%BE%A4" data-tocid="重启集群">重启集群</a></li></ul></li><li class="topic-item"><a href="#%E5%9C%A8%E7%BA%BF%E5%A2%9E%E5%8A%A0%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9" data-tocid="在线增加数据节点">在线增加数据节点</a></li><li class="topic-item"><a href="#%E9%AA%8C%E8%AF%81" data-tocid="验证">验证</a></li><li class="topic-item"><a href="#%E6%89%A9%E5%B1%95%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E6%9C%BA%E5%88%B6" data-tocid="扩展数据节点后的数据分布机制">扩展数据节点后的数据分布机制</a></li></ul></li><li class="topic-item"><a href="#%E6%89%A9%E5%B1%95%E5%AD%98%E5%82%A8" data-tocid="扩展存储">扩展存储</a><ul><li class="topic-item"><a href="#%E6%AD%A5%E9%AA%A4" data-tocid="步骤">步骤</a></li><li class="topic-item"><a href="#%E9%AA%8C%E8%AF%81-1" data-tocid="验证-1">验证</a></li></ul></li><li class="topic-item"><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" data-tocid="常见问题">常见问题</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>