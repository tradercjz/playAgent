<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="使用 DolphinDB 创建数据库和表时，人们通常对分区列、分区类型和排序列的选择并不十分清晰。如果不加注意，可能导致查询速度变慢、数据丢失或插入错误等问题。合理地设置分区列、排序列和分区类型，有助于加快查询速度，减少内存使用，并提高 CPU 利用率。 以下内容可以帮助大家更好地了解创建数据库和表时的细节，优化脚本质量。 ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="建库建表最容易忽略的十个细节"/><title>建库建表最容易忽略的十个细节</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;建库建表最容易忽略的十个细节&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建库建表最容易忽略的十个细节&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;使用 DolphinDB 创建数据库和表时，人们通常对分区列、分区类型和排序列的选择并不十分清晰。如果不加注意，可能导致查询速度变慢、数据丢失或插入错误等问题。合理地设置分区列、排序列和分区类型，有助于加快查询速度，减少内存使用，并提高 CPU 利用率。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下内容可以帮助大家更好地了解创建数据库和表时的细节，优化脚本质量。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:8;23:98&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-分区与储存结构简介&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1 分区与储存结构简介&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;11-分区类型&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.1 分区类型&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;分区是进行数据管理和提高分布式文件系统性能的重要手段之一。通过分区实现对大型表的有效管理。一个合理的分区策略能够仅读取查询所需的数据，以减少扫描的数据量，从而降低系统响应延迟。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;DolphinDB 支持多种分区类型：范围分区、哈希分区、值分区、列表分区与复合分区。选择合适的分区类型，有助于用户根据业务特点对数据进行均匀分割。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;范围分区对每个分区区间创建一个分区。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;哈希分区利用哈希函数对分区列操作，方便建立指定数量的分区。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;值分区每个值创建一个分区，例如股票交易日期、股票交易月等。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;列表分区是根据用户枚举的列表来进行分区，比值分区更加灵活。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;复合分区适用于数据量特别大而且 SQL where 或 group by 语句经常涉及多列。可使用 2 个或 3 个分区列，每个分区选择都可以采用区间、值、哈希或列表分区。例如按股票交易日期进行值分区，同时按股票代码进行范围分区。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;12-分区与数据读写的关系&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.2 分区与数据读写的关系&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;DolphinDB 以分区为单位管理数据，数据写入和数据读取都是按分区为单位进行的。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于数据写入，DolphinDB 会将数据按分区写入磁盘，并且对于同一个分区，不允许并发写入数据。对于数据读取，DolphinDB 会根据查询条件进行分区剪枝，排除不符合条件的分区，缩窄查询范围，只对符合查询条件的分区进行读取，分区字段和分区粒度的选择很大程度上影响了查询的效率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;13-储存结构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.3 储存结构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;目前 DolphinDB 有 TSDB 和 OLAP 两种储存引擎。OLAP 为列式存储引擎，将数据表中每个分区的每一列存为一个文件。数据在表中的存储顺序与数据写入的顺序一致，数据写入有非常高的效率。TSDB 是基于 LSM 树的存储引擎，其储存结构为行列混存。每一个分区的数据写在一个或多个 Level File 中。每一个 Level File 内部的数据按照指定的列进行排序且创建块索引。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;131-排序列&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.3.1 排序列&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;排序列是 TSDB 引擎特有的结构，它在 TSDB 引擎的存储和读取流程中发挥着重要作用，包括分区内数据索引和去重的双重作用。在创建表时通过参数 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;33:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 来定义排序列，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;33:95&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 的最后一列必须是时间类型，而除了最后一列之外的其他列被称为排序键（Sort Key），每个排序键独特值对应的数据按列顺序存储在一起。排序键字段的组合值作为索引键，为数据查询提供了入口，能够迅速定位数据块的位置，从而降低查询时间。在写入过程中，每个事务中的数据会根据 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;33:242&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 进行排序和去重。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;TSDB 引擎的分区内索引包括每个索引键和字段组合的入口信息以及稀疏索引（最大值，最小值，个数和）信息。当索引键个数 X 字段数很大时，索引数据会很大，这对写入性能、查询性能和内存使用都会产生重大影响，可以通过对排序键进行哈希降维来减少索引数量。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-建库建表时容易忽略的细节&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2 建库建表时容易忽略的细节&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-使用-tsdb-引擎时单个索引键对应的数据条数过少&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.1 使用 TSDB 引擎时单个索引键对应的数据条数过少&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;使用 TSDB 引擎建表时要指定排序列字段，但是随意设置排序列可能会导致索引键对应的数据过少，会使查询变慢。推荐索引键对应的数据量大于一万行，当每个索引键对应很少的数据量的时候，会产生以下几个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;由于数据总量不变，导致索引键非常多，索引信息占据大量内存。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;数据碎片化存储，导致数据读写效率降低。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;由于数据按照 block 进行压缩，而 block 是每个索引键对应数据按照数据量进行划分的，若每个 block 数据量很少，压缩率也会降低。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;211-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.1.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;例子&lt;/b&gt;：股票数据（假设股票数量为 5000 支，每天记录 2000 万条，每天数据量为 800MB），按交易日期字段作为值分区条件。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;情况 1&lt;/b&gt;：只使用 TradeTime 作为排序列会导致索引键数量过多，但是每个索引键对应的数据量又特别少。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;单个排序列时，该列就称为排序键，一个分区的索引键数量计算公式：索引键数量 = 每个分区内的排序键独特值数量。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下例子中，每个分区索引键数量 = TradeTime 去重后的数量。由于 TradeTime 为股票交易时间，即使按秒级别计算一天也有 4 * 3600 = 14400 个独特值，实际上 TradeTime 为毫秒级，故索引键数量远大于 14400。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db=database(&#34;dfs://testDB1&#34;,VALUE, 2020.01.01..2021.01.01,engine=&#34;TSDB&#34;) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt1, partitionColumns=`TradeDate, sortColumns=`TradeTime, keepDuplicates=ALL)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;假设交易时间为半秒级，索引键数量为 28800 个，每个索引键对应的行数为 694。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;情况 2&lt;/b&gt;：使用 SecurityID、TradeTime 作为 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;67:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 会导致索引键数量和股票代码数量一样。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;多个 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;69:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 时索引键计算公式：索引键数量 = 每个分区内的除去最后一列外其余字段独特值组合值数量。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下例子中，每个分区索引键的数量为 SecurityID 独特值的数量，即 5000 个。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db=database(&#34;dfs://testDB1&#34;,VALUE, 2020.01.01..2021.01.01,engine=&#34;TSDB&#34;) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt2, partitionColumns=`TradeDate, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;假设股票数量为 5000 只，索引键数量为 5000 个，每个索引键对应的行数为 4000。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;212-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.1.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于上述例子中的情况可以通过以下方案解决。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;情况 1&lt;/b&gt;：只有一个 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;87:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 字段时不选择时间相关的或者去重后数量过多的字段。比如将 TradeTime 替换为 SecurityID 作为 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;87:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumn&lt;/i&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;该方案中，每个分区索引键数量 = SecurityID 去重后的数量 = 5000。每个索引键对应的行数为 4000 和上述例子中的情况 2 一样。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db=database(&#34;dfs://testDB1&#34;,VALUE, 2020.01.01..2021.01.01,engine=&#34;TSDB&#34;) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt3, partitionColumns=`TradeDate, sortColumns=`SecurityID, keepDuplicates=ALL)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;还可以对 SecurityID 排序列进行哈希降维。每个分区索引键数量 = 哈希降维后的数量（500）。每个索引键对应的行数为 40000。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db=database(&#34;dfs://testDB1&#34;,VALUE, 2020.01.01..2021.01.01,engine=&#34;TSDB&#34;) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt4, partitionColumns=`TradeDate, sortColumns=`SecurityID keepDuplicates=ALL,sortKeyMappingFunction=[hashBucket{,500}])&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;情况 2&lt;/b&gt;：有多个 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;109:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 字段时，可以配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:9;109:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortKeyMappingFunction&lt;/i&gt; 参数进行哈希降维（会影响相关 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:10;109:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumns&lt;/i&gt; 字段的点查性能，但是会提升范围查询性能）。如果每个分区内除最后一个时间列外，其余字段组合数量超过 1000，可以配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:11;109:150&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortKeyMappingFunction&lt;/i&gt; 参数进行哈希降维。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;使用 SecurityID、TradeTime 作为 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:12;111:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumn&lt;/i&gt; 并配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:13;111:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortKeyMappingFunction&lt;/i&gt; 参数进行哈希降维。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;多个 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:14;113:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;sortColumn&lt;/i&gt; 时索引键计算公式：索引键数量 = 每个分区内的除去最后一列外其余字段去重（或者哈希降维）后数量相乘。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下例子中，每个分区索引键数量 = 哈希降维后的数量（500）。每个索引键对应的行数为 40000。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db=database(&#34;dfs://testDB1&#34;,VALUE, 2020.01.01..2021.01.01,engine=&#34;TSDB&#34;) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt5, partitionColumns=`TradeDate, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL,sortKeyMappingFunction=[hashBucket{,500}])&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;213-性能测试结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.1.3 性能测试结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;按照上述五种建表方案进行建表，然后导入 10 天的数据（每天 2000 万条记录）测试其查询性能。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;范围查询&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(TradePrice) from pt where TradeDate between 2020.01.04 and 2020.01.05&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:1;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:4;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;135:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;排序列&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;135:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;135:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;每个分区索引键数&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;135:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;135:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:4;135:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;135:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;137:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;28,800&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:7;137:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;167.9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:8;137:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;215.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID、TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:10;138:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;5000&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:11;138:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;46.3&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:12;138:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;68.6&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:13;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:14;139:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;5000&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:15;139:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;47.7&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:16;139:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;66.9&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:17;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID（哈希降维）&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:18;140:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;500&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:19;140:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;6.6&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:20;140:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;8.5&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:21;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID（哈希降维）、TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:22;141:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;500&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:23;141:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;6.7&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:24;141:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;7.9&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;点查询 1（TradeDate + SecurityID）：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(TradePrice) from pt where TradeDate = 2020.01.04 and SecurityID=`600&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:2;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:5;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:6;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:7;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:8;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:25;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;149:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;排序列&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:26;149:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;149:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;每个分区索引键数&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:27;149:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;149:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:28;149:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;149:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:29;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:30;151:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;28,800&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:31;151:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2002.6&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:32;151:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2562.8&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:33;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID、TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:34;152:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;5000&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:35;152:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;4.0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:36;152:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;4.7&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:37;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:38;153:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;5000&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:39;153:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;3.4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:40;153:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;4.7&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:41;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID（哈希降维）&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:42;154:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;500&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:43;154:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;6.5&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:44;154:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;8.5&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:45;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID（哈希降维）、TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:46;155:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;500&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:47;155:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;7.7&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:48;155:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;8.3&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;点查询 2（TradeDate + SecurityID + TradeTime）：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select TradePrice from pt where TradeDate = 2020.01.04 and SecurityID=`3740 and TradeTime =09:30:00.000&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:3;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:9;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:10;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:11;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:12;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:49;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;163:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;排序列&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:50;163:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;163:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;每个分区索引键数&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:51;163:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;163:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:52;163:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;163:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:53;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:54;165:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;28,800&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:55;165:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:56;165:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:57;166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID、TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:58;166:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;5000&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:59;166:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.5&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:60;166:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.6&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:61;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:62;167:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;5000&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:63;167:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:64;167:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.3&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:65;168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID（哈希降维）&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:66;168:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;500&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:67;168:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;5.0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:68;168:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;7.3&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:69;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;SecurityID（哈希降维）、TradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:70;169:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;500&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:71;169:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;6.2&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:72;169:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;8.0&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;通过上述性能测试实验结果，可以得出结论：排序列设置不合理，查询字段中没有排序列字段，查询性能将大幅下降。对于范围查询索引键对应的数据过少，会影响其性能，可以通过哈希降维大幅提升性能（点查询性能会略微下降）。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-值value分区字段为含特殊字符的字符串&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.2 值（VALUE）分区字段为含特殊字符的字符串&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;值（VALUE）分区字段为字符串类型时，追加的分区列数据不能包含空格、&#34;/n&#34;、 &#34;/r&#34;、&#34;/t&#34; 等特殊字符。如果后续插入的数据对应字段有特殊字符，会导致数据插入失败。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;221-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.2.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建表时未考虑后续将设置为值（VALUE）分区字段的列内是否包含特殊字符，导致数据插入该列时因存在特殊字符而失败。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;n=1000 ID=take([&#34;1&#34;,&#34;2&#34;,&#34;3&#34;], n); x=rand(1.0, n); t=table(ID, x); //将 ID 列作为值分区 db=database(directory=&#34;dfs://valuedb&#34;, partitionType=VALUE, partitionScheme=[&#34;1&#34;]) pt = db.createPartitionedTable(t, `pt, `ID); pt.append!(t); n=1000 ID=take([&#34;1 12&#34;,&#34;2.12&#34;,&#34;3   12&#34;], n); x=rand(1.0, n); t=table(ID, x); pt.append!(t);&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;上述代码会报错：A string or symbol value-partitioning column can't contain any invisible character。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;222-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.2.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于前述例子中的错误，如果这些不可见的特殊字符无意义，可以在插入前删除。如果有意义，可以将该字段设置为哈希（HASH）分区来替代值分区方案。哈希（HASH）分区的数量需要按照具体数据量进行设置，避免分区粒度过大或者过小。或者将对应字段数据进行处理后插入。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-范围range分区时范围设置不合理导致插入数据丢失&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.3 范围（RANGE）分区时范围设置不合理导致插入数据丢失&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;采用范围（RANGE）分区策略时，如果插入数据的范围（RANGE）分区字段的值在预定义的分区范围外，那么这条记录将不会被插入到表中。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;205:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;tableInsert&lt;/codeph&gt; 会返回插入记录的条数以此判断是否有数据在范围（RANGE）分区外而没有存入分区表中。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;231-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.3.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下例子中，第 2 行 ID 和第 6 行 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:15;209:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;partitionScheme&lt;/i&gt; 的设置存在范围不一致的情况。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;n=1000000 ID=rand(20, n)//数据范围是 0-20 x=rand(1.0, n) t=table(ID, x); //设置分区时RANGE范围是 0-5，5-10 db=database(directory=&#34;dfs://rangedb&#34;, partitionType=RANGE, partitionScheme=0 5 10) pt = db.createPartitionedTable(t, `pt, `ID); //tableInsert之后只有在 0-10 部分的数据才被插入，其余的都被丢弃。 tableInsert(pt,t);&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;上述例子通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;224:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;tableInsert&lt;/codeph&gt; 插入后返回 499972 条（远小于 1000000）。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;232-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.3.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;由于 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:16;228:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;partitionScheme&lt;/i&gt; 设置为 0 5 10，导致只有 0-10 部分数据插入成功，其余部分数据丢失。因此应该设置合适的分区范围，考虑后续数据的范围。或者可以通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;228:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;addRangePartitions&lt;/codeph&gt; 函数后续添加分区范围。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-分区粒度过小&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.4 分区粒度过小&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;分区类型或者分区字段设置不合理会导致分区粒度过小。分区粒度过小可能会导致以下问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;如果查询范围较大，会报错 &#34;The number of partitions relevant to the query is too large.&#34;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;235:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;使用 TSDB 引擎时，Level File 索引缓存（LevelFileIndexCache）大量被占用，可能导致所有使用 TSDB 引擎的数据库的查询变慢。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;查询和计算作业往往会生成大量的子任务，增加数据节点和控制节点之间及控制节点之间的通讯和调度成本。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;造成很多低效的磁盘访问（小文件读写)，导致系统负荷过重。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;所有分区的元数据都会驻留在控制节点的内存中，过多的分区可能会导致控制节点内存不足。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;因此，建议每个分区未压缩前的数据量不要小于 100MB。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;241-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.4.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;244:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:19;244:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;例子&lt;/b&gt;：股票行情数据（每天 5000 万条记录），先按日期分区然后将股票代码字段按值分区。选择使用 TradeDate、SecurityID 二级分区，而且 SecurityID 是值分区，假设全是国内股票，一天分区数量就达到 5000+。每天数据量为 3MB（内存中），每个分区大小约为 0.6MB。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;246:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.默认最大查询分区数为 65536，假设每天 5000 个股票，查询 14 天的数据就会报错 The number of partitions relevant to the query is too large。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;248:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.Level File 索引缓存容量默认是最大内存的 5%，虽然单个分区的 Level File 索引（LevelFileIndex）较小，但是如果查询分区数非常多，会导致马上占满 Level File 索引缓存。占满 Level File 索引缓存之后会导致查询效率大幅度下降。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, VALUE, `a`b) db = database(directory=&#34;dfs://testDB1&#34;, partitionType=COMPO, partitionScheme=[db1, db2], engine=&#34;TSDB&#34;) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;242-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.4.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;262:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于上述例子，先按日期分区，然后将股票代码字段 HASH 分区（需要根据每天的量估计 HASH 多少个分区，一般一个分区占用内存应控制在 100MB - 1GB 之间），每天只有 25 个分区，每天数据量为 3MB（内存中），每个分区大小约为 120MB。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;264:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 25]) db = database(directory=&#34;dfs://testDB2&#34;, partitionType=COMPO, partitionScheme=[db1, db2], engine=&#34;TSDB&#34;) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;243-性能测试结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.4.3 性能测试结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 5000 万条记录）测试其范围查询性能。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(TradePrice) from pt where TradeDate=2020.01.04&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:4;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:13;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:14;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:15;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:73;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:20;282:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建表方案&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:74;282:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:21;282:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:75;282:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:22;282:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:76;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;日期值分区 + 股票代码值分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:77;284:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;214.4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:78;284:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;378.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:79;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;日期值分区 + 股票代码哈希分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:80;285:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;13.6&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:81;285:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;20.5&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;287:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;通过上述性能测试实验结果，可以得出结论：如果分区粒度过小会导致查询效率过低，建库建表时要选择合适的分区粒度。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;25-分区粒度过大&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.5 分区粒度过大&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;291:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;分区类型或者分区字段设置不合理会导致分区粒度过大。若分区粒度过大，可能造成：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;多个工作线程并行时内存不足。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;系统频繁地在磁盘和工作内存之间切换，影响性能。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;无法有效利用 DolphinDB 多节点多分区的优势，将本可以并行计算的任务转化成了顺序计算任务。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;251-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.5.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下例子中的股票行情数据（每天 5000 万条记录），直接按日期分区，一天数据大约有 3MB（内存中）。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;//按交易日期分区 db= database(&#34;dfs://testDB1&#34;, VALUE, 2020.01.01..2021.01.01) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) //每天只有 1 个分区，假设每天数据量为 3GB（内存中），每个分区大小约为 3GB，分区粒度过大 db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;252-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;311:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;311:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.5.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;311:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;313:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对以下例子中的股票行情数据，先按日期分区然后将股票代码字段哈希分区（需要根据每天的量估计需要哈希的分区数量，一般一个分区内存中大小 100MB - 1GB 之间）。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;//先按交易日期分区，然后按股票代码进行哈希分区 db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 25]) db = database(directory=&#34;dfs://testDB2&#34;, partitionType=COMPO, partitionScheme=[db1, db2]) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) //每天只有 25 个分区，假设每天数据量为 3GB（内存中），每个分区大小约为120MB db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;253-性能测试结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.5.3 性能测试结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;329:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 5000 万条记录）测试其点查性能。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;331:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(TradePrice) from pt where SecurityID=`600&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:5;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:16;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:17;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:18;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:82;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:23;335:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建表方案&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:83;335:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:24;335:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:84;335:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:25;335:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:85;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;日期值分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:86;337:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;560.4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:87;337:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;683.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:88;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;日期值分区 + 股票代码哈希分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:89;338:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;31.2&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:90;338:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;40.8&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;通过上述性能测试实验结果，可以得出结论：如果分区粒度过大会导致查询效率过低，建库建表时要选择合适的分区粒度。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;26-使用维度表存储大数据量的表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.6 使用维度表存储大数据量的表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;维度表会将整个表加载入内存，并且不会自动释放（2.00.11 版本之前）。如果创建维度表时未考虑之后的大数据量，会导致查询速度随数据量增加而下降，并占用大量内存。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;261-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.6.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;348:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;使用维度表存储超过 20 万条记录的数据或难以估算的数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:26;350:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;例子&lt;/b&gt;：以每天产生 2000 万条记录的股票数据为例，如果使用仅有一个分区的维度表，不到几天该表里就会有几亿条数据。假设每天的数据量为 800MB（内存中），读取维度表数据时会将整个维度表加载入内存，不到几天，内存就会被大量占用。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;352:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db= database(&#34;dfs://testDB1&#34;, VALUE, 2020.01.01..2021.01.01) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createTable(tbSchema,`dt)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;所以在预估数据量明确或较少时，可以使用维度表；预估数据量较多时，应该使用分区表。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;262-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:28;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:28;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.6.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:28;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;上述例子中每天产生 2000 万条股票数据。为了处理这些数据，可以使用分区表：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;366:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;366:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;首先按交易日期进行分区。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;367:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;然后按股票代码进行哈希分区，每天只会有 25 个分区。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;369:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下代码为使用分区表方案建表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;371:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 25]) db = database(directory=&#34;dfs://testDB2&#34;, partitionType=COMPO, partitionScheme=[db1, db2]) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;263-性能测试结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:29;381:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:29;381:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.6.3 性能测试结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:29;381:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;383:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;按照上述两种建表方案进行建表，然后导入一天的数据（2000 万条记录）测试其点查性能。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;385:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(TradePrice) from tb where SecurityID=`600&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:6;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:19;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:20;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:21;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:91;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:27;389:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建表方案&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:92;389:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:28;389:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:93;389:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:29;389:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:94;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;维度表&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:95;391:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1385.5&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:96;391:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1545.2&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:97;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;日期值分区 + 股票代码哈希分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:98;392:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;36.0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:99;392:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;60.3&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;通过上述性能测试实验结果，可以得出结论：预估数据量明确或较少时，可以使用维度表；预估数据量较多时，应该使用分区表。如果数据量非常多时使用维度表，其查询性能将非常差。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;27-分区字段选择不合理导致查询速度慢&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:30;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:30;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.7 分区字段选择不合理导致查询速度慢&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:30;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;398:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;如果经常查询的字段没有设置为分区字段，而且查询语句中没有涉及分区字段，会导致数据库无法进行分区剪枝，并因扫描所有数据使查询缓慢。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;271-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:31;400:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:31;400:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.7.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:31;400:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;402:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:30;402:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;例子&lt;/b&gt;：对于以下例子中的股票数据，只按股票代码进行分区，如果该数据经常按交易日期和股票代码进行查询，只设置股票代码作为分区列不但会导致按交易日期进行查询时会扫描所有分区，而且会导致分区大小因为每天有数据插入不断变大。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db = database(&#34;dfs://testDB1&#34;,HASH, [SYMBOL, 25]) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`SecurityID)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;272-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:32;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:32;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.7.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:32;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;414:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于上述例子中的股票数据，按交易日期和股票代码进行分区。如果该数据经常按交易日期和股票代码进行查询，可以设置交易日期和股票代码作为分区列。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;416:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 25]) db = database(&#34;dfs://testDB2&#34;, partitionType=COMPO, partitionScheme=[db1, db2]) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;273-性能测试结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:33;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:33;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.7.3 性能测试结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:33;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 2000 万条记录）测试其点查性能。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;430:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(TradePrice) from pt where SecurityID=`600 and TradeDate=2020.01.04&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:7;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:22;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:23;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:24;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:100;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:31;434:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建表方案&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:101;434:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:32;434:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:102;434:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:33;434:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;436:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;436:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:103;436:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;股票代码哈希分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:104;436:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;174.5&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:105;436:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;193.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:106;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;日期值分区 + 股票代码哈希分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:107;437:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;38.1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:108;437:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;50.4&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;通过上述性能测试实验结果，可以得出结论：选择分区字段时，应该考虑经常查询字段以提升查询效率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;28-分区字段选择不合理导致并发写入冲突&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:34;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:34;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.8 分区字段选择不合理导致并发写入冲突&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:34;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;为了最大程度优化数据仓库查询、分析、计算的性能，DolphinDB 对事务作了一些限制：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;首先，一个事务只能包含写或者读，不能同时进行写和读。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;其次，一个写事务可以跨越多个分区，但是同一个分区不能被并发写入。当一个分区被某一个事务 A 锁定之后，另一个事务 B 试图再次去锁定这个分区时，系统立刻会抛出异常导致事务 B 失败回滚。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建库建表时未考虑后续可能出现的并发写入。出现并发写入时，由于分区冲突，导致并发写入失败。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;281-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:35;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:35;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.8.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:35;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以下例子中，由于建库建表时未考虑后续出现的并发写入，未将各个并发数据不同的字段设置为分区，导致并发写入冲突。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;//假设后续并发，是按照日期进行写入，只按股票代码进行分区 db = database(&#34;dfs://testDB&#34;,HASH, [SYMBOL, 25]) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) //只按股票代码进行分区,而并发写入按照日期进行会导致并发写入冲突，报错“has been owned by transaction” db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`SecurityID)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;464:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;以上建库建表代码按日期并发写入时会报错：xxx has been owned by transaction。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;282-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:36;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:36;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.8.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:36;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于上述情况有以下解决方法：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:2;470:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;470:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建库建表时可以按照按日期分区的方式进行建库建表，并行写入程序也按日期划分写入数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;471:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;根据分区情况调整并行写入程序，避免写入分区重合。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;如果使用相关 api 进行写入，可以使用 api 中的并行写入函数，自动对写入数据进行划分，比如 c++ api 和 python api 中的 PartitionedTableAppender。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;474:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;上述解决方法目的都是，避免同一个分区同时被多个写入事务写入的情况。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;29-数据量与日俱增的表未使用日期字段分区&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:37;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:37;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.9 数据量与日俱增的表未使用日期字段分区&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:37;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;478:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;一些数据量随日期不断增加的表，没有使用日期字段作为分区字段。数据量随时间增加会导致分区过大，影响查询性能。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;291-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:38;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:38;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.9.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:38;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;数据量随日期不断增加的表中，没有把日期字段设为分区列。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;484:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:34;484:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;例子&lt;/b&gt;：对于以下例子中的股票数据，只按股票代码分区，导致按交易日期进行查询时会扫描所有分区，并且分区随每天的数据插入不断变大。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;486:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db = database(&#34;dfs://testDB1&#34;,HASH, [SYMBOL, 25]) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`SecurityID)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;494:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于数据量随日期不断增加的表，应将日期字段设为分区列。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;292-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:39;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:39;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.9.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:39;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于上述例子中的股票数据，按照交易日期和股票代码进行了分区。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;500:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;这样每个分区不会因为每天的数据插入而不断变大。由于按照交易日期进行了分区，新的分区会随着日期变化而生成。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;502:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 25]) db = database(&#34;dfs://testDB2&#34;, partitionType=COMPO, partitionScheme=[db1, db2]) colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;293-性能测试结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:40;512:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:40;512:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.9.3 性能测试结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:40;512:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;514:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 2000 万条记录）测试其点查性能。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;516:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(TradePrice) from pt where SecurityID=`600 and TradeDate=2020.01.04&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:8;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:8;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:25;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:26;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:27;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:8;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:109;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:35;520:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;建表方案&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:110;520:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:36;520:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:111;520:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:37;520:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:8;522:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;522:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:112;522:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;股票代码哈希分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:113;522:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;174.5&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:114;522:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;193.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;523:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:115;523:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;日期值分区 + 股票代码哈希分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:116;523:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;38.1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:117;523:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;50.4&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;525:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;通过上述性能测试实验结果，可以得出结论：对于数据量与日俱增的表应使用日期字段作为分区字段，提升查询效率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;210-使用-olap-引擎存储宽表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:41;527:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:41;527:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.10 使用 OLAP 引擎存储宽表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:41;527:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;因为 OLAP 引擎采用列式存储，每个分区的每一列数据都存储为一个文件。列文件过多时，会出现读写时的性能瓶颈，因此 OLAP 引擎不适于存储列数过多的宽表。如果使用 OLAP 引擎存储数据，表的列数应低于 100。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;531:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;由于 TSDB 引擎采用行列混存的存储策略，在存储宽表数据时，其产生的物理文件数量少于 OLAP 引擎。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2101-错误例子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:42;533:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:42;533:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.10.1 错误例子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:42;533:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;535:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:38;535:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;例子&lt;/b&gt;：每个 ID 有 200 个因子，每个因子为一列，该表一共 203 列。使用 OLAP 引擎存储该表。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;537:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db= database(&#34;dfs://testDB1&#34;, VALUE, 2020.01.01..2021.01.01) //202行的宽表，使用OLAP引擎（默认为OLAP） colName = `ID`Date`Time colName.append!(take(&#34;factor&#34;+string(0..200),200)) colType = `SYMBOL`DATE colType.append!(take([&#34;DOUBLE&#34;],200)) tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`Date)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2102-解决方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:43;548:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:43;548:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.10.2 解决方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:43;548:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;550:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;对于上述例子中表列数为 203，采用 TSDB 引擎存储该表能够避免读写时可能出现的性能瓶颈。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:28;552:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;db= database(&#34;dfs://testDB2&#34;, VALUE, 2020.01.01..2021.01.01,engine=&#34;TSDB&#34;) //203行的宽表，使用TSDB引擎 colName = `ID`Date`Time colName.append!(take(&#34;factor&#34;+string(0..200),200)) colType = `SYMBOL`DATE`TIME colType.append!(take([&#34;DOUBLE&#34;],200)) tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`Date,sortColumns=`ID`Time)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2103-性能测试结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:44;563:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:44;563:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;2.10.3 性能测试结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:44;563:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;565:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 200 万条记录）测试其点查性能。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:29;567:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;select avg(factor2) from pt where ID=`60 and Date=2020.01.04&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:9;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:9;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:28;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:29;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:30;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:9;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:118;571:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:39;571:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;引擎&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:119;571:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:40;571:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;平均耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:120;571:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:41;571:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最大耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:9;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:121;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;OLAP 引擎&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:122;573:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;62.6&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:123;573:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;95.9&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:124;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;TSDB 引擎&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:125;574:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.2&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:126;574:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;1.3&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;576:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;通过上述性能测试实验结果，可以得出结论：对于列数大于 100 列的表可以使用 TSDB 引擎，提升查询效率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-总结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:45;578:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:45;578:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;3 总结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:45;578:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;580:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;本文介绍了使用 DolphinDB 进行建库建表时，最容易忽略的 10 个细节。这些错误用法的产生，是因为用户对于 DolphinDB 分区机制和数据库引擎原理不了解导致的。阅读了上面的最容易忽略的 10 个细节，如果还想进一步了解 DolphinDB 原理层面细节，可以浏览以下网址：&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/tutorials/tsdb_explained.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;580:144&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;?ditaot usertext?&gt;TSDB 存储引擎详解 (dolphindb.cn)&lt;/xref&gt;、&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/tutorials/database.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:2;580:233&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;?ditaot usertext?&gt;数据库分区 (dolphindb.cn)&lt;/xref&gt;、&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/tutorials/dolphindb_update.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:3;580:310&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;&lt;?ditaot usertext?&gt;分布式表数据更新原理和性能 (dolphindb.cn)&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;582:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/database_and_table_creation_details.md&#34;&gt;最后归纳建库建表的要点：建库建表需要结合业务，首先根据业务特点选择合适的引擎（比如宽表选择 TSDB 引擎），其次根据业务特点选择分区字段和类型，然后根据分区大小在 100MB - 1GB 的原则设计分区粒度，最后根据业务特点完善对应引擎独有的参数（比如 TSDB 引擎特有的排序列）。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/database_and_table_creation_details.md"/><meta name="wh-out-relpath" content="tutorials/database_and_table_creation_details.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="建库建表最容易忽略的十个细节" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/database.html">数据库</a></div></div></li><li class="active"><div class="topicref" data-id="建库建表最容易忽略的十个细节"><div class="title"><a href="../tutorials/database_and_table_creation_details.html">建库建表最容易忽略的十个细节</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="分区数据库设计和操作-d9713e98328" class="topicref" data-id="分区数据库设计和操作" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="分区数据库设计和操作-d9713e98328-link">分区数据库设计和操作</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-内存表详解-d9713e98374" class="topicref" data-id="dolphindb-内存表详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/in_memory_table.html" id="dolphindb-内存表详解-d9713e98374-link">DolphinDB 内存表详解</a></div></div></li><li role="treeitem"><div data-tocid="内存数据表-d9713e98420" class="topicref" data-id="内存数据表" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/partitioned_in_memory_table.html" id="内存数据表-d9713e98420-link">内存数据表</a></div></div></li><li role="treeitem"><div data-tocid="oltp-内存存储引擎非嵌入式版使用教程-d9713e98466" class="topicref" data-id="oltp-内存存储引擎非嵌入式版使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/oltp_in-memory_storage_engine_non-embedded_version_tutorials.html" id="oltp-内存存储引擎非嵌入式版使用教程-d9713e98466-link">OLTP 内存存储引擎（非嵌入式版）使用教程</a></div></div></li><li role="treeitem"><div data-tocid="利用缓存表快速实现-mysql-库间信息同步-d9713e98512" class="topicref" data-id="利用缓存表快速实现-mysql-库间信息同步" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cachedtable.html" id="利用缓存表快速实现-mysql-库间信息同步-d9713e98512-link">利用缓存表快速实现 MySQL 库间信息同步</a></div></div></li><li role="treeitem" class="active"><div data-tocid="建库建表最容易忽略的十个细节-d9713e98558" class="topicref" data-id="建库建表最容易忽略的十个细节" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database_and_table_creation_details.html" id="建库建表最容易忽略的十个细节-d9713e98558-link">建库建表最容易忽略的十个细节</a></div></div></li><li role="treeitem"><div data-tocid="redo-log-和-cache-engine-d9713e98604" class="topicref" data-id="redo-log-和-cache-engine" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/redoLog_cacheEngine.html" id="redo-log-和-cache-engine-d9713e98604-link">redo log 和 cache engine</a></div></div></li><li role="treeitem"><div data-tocid="tsdb-存储引擎简介-d9713e98650" class="topicref" data-id="tsdb-存储引擎简介" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_engine.html" id="tsdb-存储引擎简介-d9713e98650-link">TSDB 存储引擎简介</a></div></div></li><li role="treeitem"><div data-tocid="tsdb-存储引擎详解-d9713e98696" class="topicref" data-id="tsdb-存储引擎详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_explained.html" id="tsdb-存储引擎详解-d9713e98696-link">TSDB 存储引擎详解</a></div></div></li><li role="treeitem"><div data-tocid="分布式表数据更新原理和性能-d9713e98742" class="topicref" data-id="分布式表数据更新原理和性能" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_update.html" id="分布式表数据更新原理和性能-d9713e98742-link">分布式表数据更新原理和性能</a></div></div></li><li role="treeitem"><div data-tocid="软删除-d9713e98788" class="topicref" data-id="软删除" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/soft_delete.html" id="软删除-d9713e98788-link">软删除</a></div></div></li><li role="treeitem"><div data-tocid="基于-datax-的-dolphindb-数据导入工具-d9713e98835" class="topicref" data-id="基于-datax-的-dolphindb-数据导入工具" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/datax_writer.html" id="基于-datax-的-dolphindb-数据导入工具-d9713e98835-link">基于 DataX 的 DolphinDB 数据导入工具</a></div></div></li><li role="treeitem"><div data-tocid="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9713e98881" class="topicref" data-id="debezium--kafka-实时同步-mysql-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_and_Kafka_data_sync.html" id="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9713e98881-link">Debezium + Kafka 实时同步 MySQL 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9713e98927" class="topicref" data-id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_Kafka_Oracle_sync.html" id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9713e98927-link">Debezium+Kafka 实时同步 Oracle 11g 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="clear_cache-d9713e98973" class="topicref" data-id="clear_cache" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/clear_cache.html" id="clear_cache-d9713e98973-link">数据库缓存清理机制 </a></div></div></li><li role="treeitem"><div data-tocid="best_practice_for_storage_compute_separation-d9713e99019" class="topicref" data-id="best_practice_for_storage_compute_separation" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_storage_compute_separation.html" id="best_practice_for_storage_compute_separation-d9713e99019-link">存算分离最佳实践教程</a></div></div></li><li role="treeitem"><div data-tocid="database_and_table_creation_wizard-d9713e99065" class="topicref" data-id="database_and_table_creation_wizard" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database_and_table_creation_wizard.html" id="database_and_table_creation_wizard-d9713e99065-link">DolphinDB Web 界面库表创建指南</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">建库建表最容易忽略的十个细节</h1><div class="- topic/body body"><p class="- topic/p p">使用 DolphinDB 创建数据库和表时，人们通常对分区列、分区类型和排序列的选择并不十分清晰。如果不加注意，可能导致查询速度变慢、数据丢失或插入错误等问题。合理地设置分区列、排序列和分区类型，有助于加快查询速度，减少内存使用，并提高 CPU 利用率。</p><p class="- topic/p p">以下内容可以帮助大家更好地了解创建数据库和表时的细节，优化脚本质量。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-分区与储存结构简介"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1 分区与储存结构简介</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="11-分区类型"><h3 class="- topic/title title topictitle3" id="ariaid-title3">1.1 分区类型</h3><div class="- topic/body body"><p class="- topic/p p">分区是进行数据管理和提高分布式文件系统性能的重要手段之一。通过分区实现对大型表的有效管理。一个合理的分区策略能够仅读取查询所需的数据，以减少扫描的数据量，从而降低系统响应延迟。</p><p class="- topic/p p">DolphinDB 支持多种分区类型：范围分区、哈希分区、值分区、列表分区与复合分区。选择合适的分区类型，有助于用户根据业务特点对数据进行均匀分割。</p><ul class="- topic/ul ul"><li class="- topic/li li">范围分区对每个分区区间创建一个分区。</li><li class="- topic/li li">哈希分区利用哈希函数对分区列操作，方便建立指定数量的分区。</li><li class="- topic/li li">值分区每个值创建一个分区，例如股票交易日期、股票交易月等。</li><li class="- topic/li li">列表分区是根据用户枚举的列表来进行分区，比值分区更加灵活。</li><li class="- topic/li li">复合分区适用于数据量特别大而且 SQL where 或 group by 语句经常涉及多列。可使用 2 个或 3 个分区列，每个分区选择都可以采用区间、值、哈希或列表分区。例如按股票交易日期进行值分区，同时按股票代码进行范围分区。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="12-分区与数据读写的关系"><h3 class="- topic/title title topictitle3" id="ariaid-title4">1.2 分区与数据读写的关系</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 以分区为单位管理数据，数据写入和数据读取都是按分区为单位进行的。</p><p class="- topic/p p">对于数据写入，DolphinDB 会将数据按分区写入磁盘，并且对于同一个分区，不允许并发写入数据。对于数据读取，DolphinDB 会根据查询条件进行分区剪枝，排除不符合条件的分区，缩窄查询范围，只对符合查询条件的分区进行读取，分区字段和分区粒度的选择很大程度上影响了查询的效率。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="13-储存结构"><h3 class="- topic/title title topictitle3" id="ariaid-title5">1.3 储存结构</h3><div class="- topic/body body"><p class="- topic/p p">目前 DolphinDB 有 TSDB 和 OLAP 两种储存引擎。OLAP 为列式存储引擎，将数据表中每个分区的每一列存为一个文件。数据在表中的存储顺序与数据写入的顺序一致，数据写入有非常高的效率。TSDB 是基于 LSM 树的存储引擎，其储存结构为行列混存。每一个分区的数据写在一个或多个 Level File 中。每一个 Level File 内部的数据按照指定的列进行排序且创建块索引。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title6" id="131-排序列"><h4 class="- topic/title title topictitle4" id="ariaid-title6">1.3.1 排序列</h4><div class="- topic/body body"><p class="- topic/p p">排序列是 TSDB 引擎特有的结构，它在 TSDB 引擎的存储和读取流程中发挥着重要作用，包括分区内数据索引和去重的双重作用。在创建表时通过参数 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 来定义排序列，<em class="+ topic/ph hi-d/i ph i">sortColumns</em> 的最后一列必须是时间类型，而除了最后一列之外的其他列被称为排序键（Sort Key），每个排序键独特值对应的数据按列顺序存储在一起。排序键字段的组合值作为索引键，为数据查询提供了入口，能够迅速定位数据块的位置，从而降低查询时间。在写入过程中，每个事务中的数据会根据 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 进行排序和去重。</p><p class="- topic/p p">TSDB 引擎的分区内索引包括每个索引键和字段组合的入口信息以及稀疏索引（最大值，最小值，个数和）信息。当索引键个数 X 字段数很大时，索引数据会很大，这对写入性能、查询性能和内存使用都会产生重大影响，可以通过对排序键进行哈希降维来减少索引数量。</p></div></article></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title7" id="2-建库建表时容易忽略的细节"><h2 class="- topic/title title topictitle2" id="ariaid-title7">2 建库建表时容易忽略的细节</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="21-使用-tsdb-引擎时单个索引键对应的数据条数过少"><h3 class="- topic/title title topictitle3" id="ariaid-title8">2.1 使用 TSDB 引擎时单个索引键对应的数据条数过少</h3><div class="- topic/body body"><p class="- topic/p p">使用 TSDB 引擎建表时要指定排序列字段，但是随意设置排序列可能会导致索引键对应的数据过少，会使查询变慢。推荐索引键对应的数据量大于一万行，当每个索引键对应很少的数据量的时候，会产生以下几个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">由于数据总量不变，导致索引键非常多，索引信息占据大量内存。</li><li class="- topic/li li">数据碎片化存储，导致数据读写效率降低。</li><li class="- topic/li li">由于数据按照 block 进行压缩，而 block 是每个索引键对应数据按照数据量进行划分的，若每个 block 数据量很少，压缩率也会降低。</li></ul></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title9" id="211-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title9">2.1.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">例子</strong>：股票数据（假设股票数量为 5000 支，每天记录 2000 万条，每天数据量为 800MB），按交易日期字段作为值分区条件。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">情况 1</strong>：只使用 TradeTime 作为排序列会导致索引键数量过多，但是每个索引键对应的数据量又特别少。</p><p class="- topic/p p">单个排序列时，该列就称为排序键，一个分区的索引键数量计算公式：索引键数量 = 每个分区内的排序键独特值数量。</p><p class="- topic/p p">以下例子中，每个分区索引键数量 = TradeTime 去重后的数量。由于 TradeTime 为股票交易时间，即使按秒级别计算一天也有 4 * 3600 = 14400 个独特值，实际上 TradeTime 为毫秒级，故索引键数量远大于 14400。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db=database("dfs://testDB1",VALUE, 2020.01.01..2021.01.01,engine="TSDB")
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt1, partitionColumns=`TradeDate, sortColumns=`TradeTime, keepDuplicates=ALL)</code></pre><p class="- topic/p p">假设交易时间为半秒级，索引键数量为 28800 个，每个索引键对应的行数为 694。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">情况 2</strong>：使用 SecurityID、TradeTime 作为 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 会导致索引键数量和股票代码数量一样。</p><p class="- topic/p p">多个 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 时索引键计算公式：索引键数量 = 每个分区内的除去最后一列外其余字段独特值组合值数量。</p><p class="- topic/p p">以下例子中，每个分区索引键的数量为 SecurityID 独特值的数量，即 5000 个。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db=database("dfs://testDB1",VALUE, 2020.01.01..2021.01.01,engine="TSDB")
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt2, partitionColumns=`TradeDate, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL)</code></pre><p class="- topic/p p">假设股票数量为 5000 只，索引键数量为 5000 个，每个索引键对应的行数为 4000。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title10" id="212-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title10">2.1.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对于上述例子中的情况可以通过以下方案解决。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">情况 1</strong>：只有一个 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 字段时不选择时间相关的或者去重后数量过多的字段。比如将 TradeTime 替换为 SecurityID 作为 <em class="+ topic/ph hi-d/i ph i">sortColumn</em>。</p><p class="- topic/p p">该方案中，每个分区索引键数量 = SecurityID 去重后的数量 = 5000。每个索引键对应的行数为 4000 和上述例子中的情况 2 一样。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db=database("dfs://testDB1",VALUE, 2020.01.01..2021.01.01,engine="TSDB")
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt3, partitionColumns=`TradeDate, sortColumns=`SecurityID, keepDuplicates=ALL)</code></pre><p class="- topic/p p">还可以对 SecurityID 排序列进行哈希降维。每个分区索引键数量 = 哈希降维后的数量（500）。每个索引键对应的行数为 40000。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db=database("dfs://testDB1",VALUE, 2020.01.01..2021.01.01,engine="TSDB")
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt4, partitionColumns=`TradeDate, sortColumns=`SecurityID keepDuplicates=ALL,sortKeyMappingFunction=[hashBucket{,500}])</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">情况 2</strong>：有多个 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 字段时，可以配置 <em class="+ topic/ph hi-d/i ph i">sortKeyMappingFunction</em> 参数进行哈希降维（会影响相关 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 字段的点查性能，但是会提升范围查询性能）。如果每个分区内除最后一个时间列外，其余字段组合数量超过 1000，可以配置 <em class="+ topic/ph hi-d/i ph i">sortKeyMappingFunction</em> 参数进行哈希降维。</p><p class="- topic/p p">使用 SecurityID、TradeTime 作为 <em class="+ topic/ph hi-d/i ph i">sortColumn</em> 并配置 <em class="+ topic/ph hi-d/i ph i">sortKeyMappingFunction</em> 参数进行哈希降维。</p><p class="- topic/p p">多个 <em class="+ topic/ph hi-d/i ph i">sortColumn</em> 时索引键计算公式：索引键数量 = 每个分区内的除去最后一列外其余字段去重（或者哈希降维）后数量相乘。</p><p class="- topic/p p">以下例子中，每个分区索引键数量 = 哈希降维后的数量（500）。每个索引键对应的行数为 40000。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db=database("dfs://testDB1",VALUE, 2020.01.01..2021.01.01,engine="TSDB")
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt5, partitionColumns=`TradeDate, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL,sortKeyMappingFunction=[hashBucket{,500}])</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="213-性能测试结果"><h4 class="- topic/title title topictitle4" id="ariaid-title11">2.1.3 性能测试结果</h4><div class="- topic/body body"><p class="- topic/p p">按照上述五种建表方案进行建表，然后导入 10 天的数据（每天 2000 万条记录）测试其查询性能。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">范围查询</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(TradePrice) from pt where TradeDate between 2020.01.04 and 2020.01.05</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__1"><strong class="+ topic/ph hi-d/b ph b">排序列</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__2"><strong class="+ topic/ph hi-d/b ph b">每个分区索引键数</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__3"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__4"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__1">TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__2">28,800</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__3">167.9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__4">215.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__1">SecurityID、TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__2">5000</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__3">46.3</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__4">68.6</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__1">SecurityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__2">5000</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__3">47.7</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__4">66.9</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__1">SecurityID（哈希降维）</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__2">500</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__3">6.6</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__4">8.5</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__1">SecurityID（哈希降维）、TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__2">500</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__3">6.7</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__4">7.9</td></tr></tbody></table></div><p class="- topic/p p">点查询 1（TradeDate + SecurityID）：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(TradePrice) from pt where TradeDate = 2020.01.04 and SecurityID=`600</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__25"><strong class="+ topic/ph hi-d/b ph b">排序列</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__26"><strong class="+ topic/ph hi-d/b ph b">每个分区索引键数</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__27"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__28"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__25">TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__26">28,800</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__27">2002.6</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__28">2562.8</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__25">SecurityID、TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__26">5000</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__27">4.0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__28">4.7</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__25">SecurityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__26">5000</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__27">3.4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__28">4.7</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__25">SecurityID（哈希降维）</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__26">500</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__27">6.5</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__28">8.5</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__25">SecurityID（哈希降维）、TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__26">500</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__27">7.7</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__28">8.3</td></tr></tbody></table></div><p class="- topic/p p">点查询 2（TradeDate + SecurityID + TradeTime）：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select TradePrice from pt where TradeDate = 2020.01.04 and SecurityID=`3740 and TradeTime =09:30:00.000</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__49"><strong class="+ topic/ph hi-d/b ph b">排序列</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__50"><strong class="+ topic/ph hi-d/b ph b">每个分区索引键数</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__51"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="213-性能测试结果__entry__52"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__49">TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__50">28,800</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__51">1.4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__52">2.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__49">SecurityID、TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__50">5000</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__51">1.5</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__52">2.6</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__49">SecurityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__50">5000</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__51">1.4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__52">2.3</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__49">SecurityID（哈希降维）</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__50">500</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__51">5.0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__52">7.3</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__49">SecurityID（哈希降维）、TradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__50">500</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__51">6.2</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="213-性能测试结果__entry__52">8.0</td></tr></tbody></table></div><p class="- topic/p p">通过上述性能测试实验结果，可以得出结论：排序列设置不合理，查询字段中没有排序列字段，查询性能将大幅下降。对于范围查询索引键对应的数据过少，会影响其性能，可以通过哈希降维大幅提升性能（点查询性能会略微下降）。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="22-值value分区字段为含特殊字符的字符串"><h3 class="- topic/title title topictitle3" id="ariaid-title12">2.2 值（VALUE）分区字段为含特殊字符的字符串</h3><div class="- topic/body body"><p class="- topic/p p">值（VALUE）分区字段为字符串类型时，追加的分区列数据不能包含空格、"/n"、 "/r"、"/t" 等特殊字符。如果后续插入的数据对应字段有特殊字符，会导致数据插入失败。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title13" id="221-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title13">2.2.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p">建表时未考虑后续将设置为值（VALUE）分区字段的列内是否包含特殊字符，导致数据插入该列时因存在特殊字符而失败。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>n=1000
ID=take(["1","2","3"], n);
x=rand(1.0, n);
t=table(ID, x);
//将 ID 列作为值分区
db=database(directory="dfs://valuedb", partitionType=VALUE, partitionScheme=["1"])
pt = db.createPartitionedTable(t, `pt, `ID);
pt.append!(t);
n=1000
ID=take(["1 12","2.12","3   12"], n);
x=rand(1.0, n);
t=table(ID, x);
pt.append!(t);</code></pre><p class="- topic/p p">上述代码会报错：A string or symbol value-partitioning column can't contain any invisible character。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title14" id="222-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title14">2.2.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对于前述例子中的错误，如果这些不可见的特殊字符无意义，可以在插入前删除。如果有意义，可以将该字段设置为哈希（HASH）分区来替代值分区方案。哈希（HASH）分区的数量需要按照具体数据量进行设置，避免分区粒度过大或者过小。或者将对应字段数据进行处理后插入。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title15" id="23-范围range分区时范围设置不合理导致插入数据丢失"><h3 class="- topic/title title topictitle3" id="ariaid-title15">2.3 范围（RANGE）分区时范围设置不合理导致插入数据丢失</h3><div class="- topic/body body"><p class="- topic/p p">采用范围（RANGE）分区策略时，如果插入数据的范围（RANGE）分区字段的值在预定义的分区范围外，那么这条记录将不会被插入到表中。<code class="+ topic/ph pr-d/codeph ph codeph">tableInsert</code> 会返回插入记录的条数以此判断是否有数据在范围（RANGE）分区外而没有存入分区表中。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title16" id="231-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title16">2.3.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p">以下例子中，第 2 行 ID 和第 6 行 <em class="+ topic/ph hi-d/i ph i">partitionScheme</em> 的设置存在范围不一致的情况。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>n=1000000
ID=rand(20, n)//数据范围是 0-20
x=rand(1.0, n)
t=table(ID, x);
//设置分区时RANGE范围是 0-5，5-10
db=database(directory="dfs://rangedb", partitionType=RANGE, partitionScheme=0 5 10)

pt = db.createPartitionedTable(t, `pt, `ID);
//tableInsert之后只有在 0-10 部分的数据才被插入，其余的都被丢弃。
tableInsert(pt,t);</code></pre><p class="- topic/p p">上述例子通过 <code class="+ topic/ph pr-d/codeph ph codeph">tableInsert</code> 插入后返回 499972 条（远小于 1000000）。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title17" id="232-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title17">2.3.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">由于 <em class="+ topic/ph hi-d/i ph i">partitionScheme</em> 设置为 0 5 10，导致只有 0-10 部分数据插入成功，其余部分数据丢失。因此应该设置合适的分区范围，考虑后续数据的范围。或者可以通过 <code class="+ topic/ph pr-d/codeph ph codeph">addRangePartitions</code> 函数后续添加分区范围。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title18" id="24-分区粒度过小"><h3 class="- topic/title title topictitle3" id="ariaid-title18">2.4 分区粒度过小</h3><div class="- topic/body body"><p class="- topic/p p">分区类型或者分区字段设置不合理会导致分区粒度过小。分区粒度过小可能会导致以下问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">如果查询范围较大，会报错 "The number of partitions relevant to the query is too large."</li><li class="- topic/li li">使用 TSDB 引擎时，Level File 索引缓存（LevelFileIndexCache）大量被占用，可能导致所有使用 TSDB 引擎的数据库的查询变慢。</li><li class="- topic/li li">查询和计算作业往往会生成大量的子任务，增加数据节点和控制节点之间及控制节点之间的通讯和调度成本。</li><li class="- topic/li li">造成很多低效的磁盘访问（小文件读写)，导致系统负荷过重。</li><li class="- topic/li li">所有分区的元数据都会驻留在控制节点的内存中，过多的分区可能会导致控制节点内存不足。</li></ul><p class="- topic/p p">因此，建议每个分区未压缩前的数据量不要小于 100MB。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title19" id="241-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title19">2.4.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">例子</strong>：股票行情数据（每天 5000 万条记录），先按日期分区然后将股票代码字段按值分区。选择使用 TradeDate、SecurityID 二级分区，而且 SecurityID 是值分区，假设全是国内股票，一天分区数量就达到 5000+。每天数据量为 3MB（内存中），每个分区大小约为 0.6MB。</p><p class="- topic/p p">1.默认最大查询分区数为 65536，假设每天 5000 个股票，查询 14 天的数据就会报错 The number of partitions relevant to the query is too large。</p><p class="- topic/p p">2.Level File 索引缓存容量默认是最大内存的 5%，虽然单个分区的 Level File 索引（LevelFileIndex）较小，但是如果查询分区数非常多，会导致马上占满 Level File 索引缓存。占满 Level File 索引缓存之后会导致查询效率大幅度下降。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db1 = database(, VALUE, 2020.01.01..2021.01.01)
db2 = database(, VALUE, `a`b)
db = database(directory="dfs://testDB1", partitionType=COMPO, partitionScheme=[db1, db2], engine="TSDB")
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title20" id="242-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title20">2.4.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对于上述例子，先按日期分区，然后将股票代码字段 HASH 分区（需要根据每天的量估计 HASH 多少个分区，一般一个分区占用内存应控制在 100MB - 1GB 之间），每天只有 25 个分区，每天数据量为 3MB（内存中），每个分区大小约为 120MB。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db1 = database(, VALUE, 2020.01.01..2021.01.01)
db2 = database(, HASH, [SYMBOL, 25])
db = database(directory="dfs://testDB2", partitionType=COMPO, partitionScheme=[db1, db2], engine="TSDB")
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID, sortColumns=`SecurityID`TradeTime, keepDuplicates=ALL)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title21" id="243-性能测试结果"><h4 class="- topic/title title topictitle4" id="ariaid-title21">2.4.3 性能测试结果</h4><div class="- topic/body body"><p class="- topic/p p">按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 5000 万条记录）测试其范围查询性能。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(TradePrice) from pt where TradeDate=2020.01.04</code></pre><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="243-性能测试结果__entry__1"><strong class="+ topic/ph hi-d/b ph b">建表方案</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="243-性能测试结果__entry__2"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="243-性能测试结果__entry__3"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="243-性能测试结果__entry__1">日期值分区 + 股票代码值分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="243-性能测试结果__entry__2">214.4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="243-性能测试结果__entry__3">378.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="243-性能测试结果__entry__1">日期值分区 + 股票代码哈希分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="243-性能测试结果__entry__2">13.6</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="243-性能测试结果__entry__3">20.5</td></tr></tbody></table></div><p class="- topic/p p">通过上述性能测试实验结果，可以得出结论：如果分区粒度过小会导致查询效率过低，建库建表时要选择合适的分区粒度。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title22" id="25-分区粒度过大"><h3 class="- topic/title title topictitle3" id="ariaid-title22">2.5 分区粒度过大</h3><div class="- topic/body body"><p class="- topic/p p">分区类型或者分区字段设置不合理会导致分区粒度过大。若分区粒度过大，可能造成：</p><ul class="- topic/ul ul"><li class="- topic/li li">多个工作线程并行时内存不足。</li><li class="- topic/li li">系统频繁地在磁盘和工作内存之间切换，影响性能。</li><li class="- topic/li li">无法有效利用 DolphinDB 多节点多分区的优势，将本可以并行计算的任务转化成了顺序计算任务。</li></ul></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title23" id="251-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title23">2.5.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p">以下例子中的股票行情数据（每天 5000 万条记录），直接按日期分区，一天数据大约有 3MB（内存中）。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//按交易日期分区
db= database("dfs://testDB1", VALUE, 2020.01.01..2021.01.01)
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
//每天只有 1 个分区，假设每天数据量为 3GB（内存中），每个分区大小约为 3GB，分区粒度过大
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title24" id="252-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title24">2.5.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对以下例子中的股票行情数据，先按日期分区然后将股票代码字段哈希分区（需要根据每天的量估计需要哈希的分区数量，一般一个分区内存中大小 100MB - 1GB 之间）。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//先按交易日期分区，然后按股票代码进行哈希分区
db1 = database(, VALUE, 2020.01.01..2021.01.01)
db2 = database(, HASH, [SYMBOL, 25])
db = database(directory="dfs://testDB2", partitionType=COMPO, partitionScheme=[db1, db2])
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
//每天只有 25 个分区，假设每天数据量为 3GB（内存中），每个分区大小约为120MB
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title25" id="253-性能测试结果"><h4 class="- topic/title title topictitle4" id="ariaid-title25">2.5.3 性能测试结果</h4><div class="- topic/body body"><p class="- topic/p p">按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 5000 万条记录）测试其点查性能。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(TradePrice) from pt where SecurityID=`600</code></pre><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="253-性能测试结果__entry__1"><strong class="+ topic/ph hi-d/b ph b">建表方案</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="253-性能测试结果__entry__2"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="253-性能测试结果__entry__3"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="253-性能测试结果__entry__1">日期值分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="253-性能测试结果__entry__2">560.4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="253-性能测试结果__entry__3">683.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="253-性能测试结果__entry__1">日期值分区 + 股票代码哈希分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="253-性能测试结果__entry__2">31.2</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="253-性能测试结果__entry__3">40.8</td></tr></tbody></table></div><p class="- topic/p p">通过上述性能测试实验结果，可以得出结论：如果分区粒度过大会导致查询效率过低，建库建表时要选择合适的分区粒度。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title26" id="26-使用维度表存储大数据量的表"><h3 class="- topic/title title topictitle3" id="ariaid-title26">2.6 使用维度表存储大数据量的表</h3><div class="- topic/body body"><p class="- topic/p p">维度表会将整个表加载入内存，并且不会自动释放（2.00.11 版本之前）。如果创建维度表时未考虑之后的大数据量，会导致查询速度随数据量增加而下降，并占用大量内存。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title27" id="261-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title27">2.6.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p">使用维度表存储超过 20 万条记录的数据或难以估算的数据。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">例子</strong>：以每天产生 2000 万条记录的股票数据为例，如果使用仅有一个分区的维度表，不到几天该表里就会有几亿条数据。假设每天的数据量为 800MB（内存中），读取维度表数据时会将整个维度表加载入内存，不到几天，内存就会被大量占用。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db= database("dfs://testDB1", VALUE, 2020.01.01..2021.01.01)
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createTable(tbSchema,`dt)</code></pre><p class="- topic/p p">所以在预估数据量明确或较少时，可以使用维度表；预估数据量较多时，应该使用分区表。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title28" id="262-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title28">2.6.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">上述例子中每天产生 2000 万条股票数据。为了处理这些数据，可以使用分区表：</p><ol class="- topic/ol ol"><li class="- topic/li li">首先按交易日期进行分区。</li><li class="- topic/li li">然后按股票代码进行哈希分区，每天只会有 25 个分区。</li></ol><p class="- topic/p p">以下代码为使用分区表方案建表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db1 = database(, VALUE, 2020.01.01..2021.01.01)
db2 = database(, HASH, [SYMBOL, 25])
db = database(directory="dfs://testDB2", partitionType=COMPO, partitionScheme=[db1, db2])
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title29" id="263-性能测试结果"><h4 class="- topic/title title topictitle4" id="ariaid-title29">2.6.3 性能测试结果</h4><div class="- topic/body body"><p class="- topic/p p">按照上述两种建表方案进行建表，然后导入一天的数据（2000 万条记录）测试其点查性能。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(TradePrice) from tb where SecurityID=`600</code></pre><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="263-性能测试结果__entry__1"><strong class="+ topic/ph hi-d/b ph b">建表方案</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="263-性能测试结果__entry__2"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="263-性能测试结果__entry__3"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="263-性能测试结果__entry__1">维度表</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="263-性能测试结果__entry__2">1385.5</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="263-性能测试结果__entry__3">1545.2</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="263-性能测试结果__entry__1">日期值分区 + 股票代码哈希分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="263-性能测试结果__entry__2">36.0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="263-性能测试结果__entry__3">60.3</td></tr></tbody></table></div><p class="- topic/p p">通过上述性能测试实验结果，可以得出结论：预估数据量明确或较少时，可以使用维度表；预估数据量较多时，应该使用分区表。如果数据量非常多时使用维度表，其查询性能将非常差。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title30" id="27-分区字段选择不合理导致查询速度慢"><h3 class="- topic/title title topictitle3" id="ariaid-title30">2.7 分区字段选择不合理导致查询速度慢</h3><div class="- topic/body body"><p class="- topic/p p">如果经常查询的字段没有设置为分区字段，而且查询语句中没有涉及分区字段，会导致数据库无法进行分区剪枝，并因扫描所有数据使查询缓慢。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title31" id="271-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title31">2.7.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">例子</strong>：对于以下例子中的股票数据，只按股票代码进行分区，如果该数据经常按交易日期和股票代码进行查询，只设置股票代码作为分区列不但会导致按交易日期进行查询时会扫描所有分区，而且会导致分区大小因为每天有数据插入不断变大。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db = database("dfs://testDB1",HASH, [SYMBOL, 25])
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`SecurityID)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title32" id="272-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title32">2.7.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对于上述例子中的股票数据，按交易日期和股票代码进行分区。如果该数据经常按交易日期和股票代码进行查询，可以设置交易日期和股票代码作为分区列。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db1 = database(, VALUE, 2020.01.01..2021.01.01)
db2 = database(, HASH, [SYMBOL, 25])
db = database("dfs://testDB2", partitionType=COMPO, partitionScheme=[db1, db2])
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title33" id="273-性能测试结果"><h4 class="- topic/title title topictitle4" id="ariaid-title33">2.7.3 性能测试结果</h4><div class="- topic/body body"><p class="- topic/p p">按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 2000 万条记录）测试其点查性能。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(TradePrice) from pt where SecurityID=`600 and TradeDate=2020.01.04</code></pre><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="273-性能测试结果__entry__1"><strong class="+ topic/ph hi-d/b ph b">建表方案</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="273-性能测试结果__entry__2"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="273-性能测试结果__entry__3"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="273-性能测试结果__entry__1">股票代码哈希分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="273-性能测试结果__entry__2">174.5</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="273-性能测试结果__entry__3">193.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="273-性能测试结果__entry__1">日期值分区 + 股票代码哈希分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="273-性能测试结果__entry__2">38.1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="273-性能测试结果__entry__3">50.4</td></tr></tbody></table></div><p class="- topic/p p">通过上述性能测试实验结果，可以得出结论：选择分区字段时，应该考虑经常查询字段以提升查询效率。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title34" id="28-分区字段选择不合理导致并发写入冲突"><h3 class="- topic/title title topictitle3" id="ariaid-title34">2.8 分区字段选择不合理导致并发写入冲突</h3><div class="- topic/body body"><p class="- topic/p p">为了最大程度优化数据仓库查询、分析、计算的性能，DolphinDB 对事务作了一些限制：</p><ul class="- topic/ul ul"><li class="- topic/li li">首先，一个事务只能包含写或者读，不能同时进行写和读。</li><li class="- topic/li li">其次，一个写事务可以跨越多个分区，但是同一个分区不能被并发写入。当一个分区被某一个事务 A 锁定之后，另一个事务 B 试图再次去锁定这个分区时，系统立刻会抛出异常导致事务 B 失败回滚。</li></ul><p class="- topic/p p">建库建表时未考虑后续可能出现的并发写入。出现并发写入时，由于分区冲突，导致并发写入失败。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title35" id="281-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title35">2.8.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p">以下例子中，由于建库建表时未考虑后续出现的并发写入，未将各个并发数据不同的字段设置为分区，导致并发写入冲突。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//假设后续并发，是按照日期进行写入，只按股票代码进行分区
db = database("dfs://testDB",HASH, [SYMBOL, 25])
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
//只按股票代码进行分区,而并发写入按照日期进行会导致并发写入冲突，报错“has been owned by transaction”
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`SecurityID)</code></pre><p class="- topic/p p">以上建库建表代码按日期并发写入时会报错：xxx has been owned by transaction。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title36" id="282-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title36">2.8.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对于上述情况有以下解决方法：</p><ol class="- topic/ol ol"><li class="- topic/li li">建库建表时可以按照按日期分区的方式进行建库建表，并行写入程序也按日期划分写入数据。</li><li class="- topic/li li">根据分区情况调整并行写入程序，避免写入分区重合。</li><li class="- topic/li li">如果使用相关 api 进行写入，可以使用 api 中的并行写入函数，自动对写入数据进行划分，比如 c++ api 和 python api 中的 PartitionedTableAppender。</li></ol><p class="- topic/p p">上述解决方法目的都是，避免同一个分区同时被多个写入事务写入的情况。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title37" id="29-数据量与日俱增的表未使用日期字段分区"><h3 class="- topic/title title topictitle3" id="ariaid-title37">2.9 数据量与日俱增的表未使用日期字段分区</h3><div class="- topic/body body"><p class="- topic/p p">一些数据量随日期不断增加的表，没有使用日期字段作为分区字段。数据量随时间增加会导致分区过大，影响查询性能。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title38" id="291-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title38">2.9.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p">数据量随日期不断增加的表中，没有把日期字段设为分区列。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">例子</strong>：对于以下例子中的股票数据，只按股票代码分区，导致按交易日期进行查询时会扫描所有分区，并且分区随每天的数据插入不断变大。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db = database("dfs://testDB1",HASH, [SYMBOL, 25])
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`SecurityID)</code></pre><p class="- topic/p p">对于数据量随日期不断增加的表，应将日期字段设为分区列。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title39" id="292-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title39">2.9.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对于上述例子中的股票数据，按照交易日期和股票代码进行了分区。</p><p class="- topic/p p">这样每个分区不会因为每天的数据插入而不断变大。由于按照交易日期进行了分区，新的分区会随着日期变化而生成。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db1 = database(, VALUE, 2020.01.01..2021.01.01)
db2 = database(, HASH, [SYMBOL, 25])
db = database("dfs://testDB2", partitionType=COMPO, partitionScheme=[db1, db2])
colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`TradeDate`SecurityID)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title40" id="293-性能测试结果"><h4 class="- topic/title title topictitle4" id="ariaid-title40">2.9.3 性能测试结果</h4><div class="- topic/body body"><p class="- topic/p p">按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 2000 万条记录）测试其点查性能。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(TradePrice) from pt where SecurityID=`600 and TradeDate=2020.01.04</code></pre><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="293-性能测试结果__entry__1"><strong class="+ topic/ph hi-d/b ph b">建表方案</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="293-性能测试结果__entry__2"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="293-性能测试结果__entry__3"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="293-性能测试结果__entry__1">股票代码哈希分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="293-性能测试结果__entry__2">174.5</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="293-性能测试结果__entry__3">193.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="293-性能测试结果__entry__1">日期值分区 + 股票代码哈希分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="293-性能测试结果__entry__2">38.1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="293-性能测试结果__entry__3">50.4</td></tr></tbody></table></div><p class="- topic/p p">通过上述性能测试实验结果，可以得出结论：对于数据量与日俱增的表应使用日期字段作为分区字段，提升查询效率。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title41" id="210-使用-olap-引擎存储宽表"><h3 class="- topic/title title topictitle3" id="ariaid-title41">2.10 使用 OLAP 引擎存储宽表</h3><div class="- topic/body body"><p class="- topic/p p">因为 OLAP 引擎采用列式存储，每个分区的每一列数据都存储为一个文件。列文件过多时，会出现读写时的性能瓶颈，因此 OLAP 引擎不适于存储列数过多的宽表。如果使用 OLAP 引擎存储数据，表的列数应低于 100。</p><p class="- topic/p p">由于 TSDB 引擎采用行列混存的存储策略，在存储宽表数据时，其产生的物理文件数量少于 OLAP 引擎。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title42" id="2101-错误例子"><h4 class="- topic/title title topictitle4" id="ariaid-title42">2.10.1 错误例子</h4><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">例子</strong>：每个 ID 有 200 个因子，每个因子为一列，该表一共 203 列。使用 OLAP 引擎存储该表。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db= database("dfs://testDB1", VALUE, 2020.01.01..2021.01.01)
//202行的宽表，使用OLAP引擎（默认为OLAP）
colName = `ID`Date`Time
colName.append!(take("factor"+string(0..200),200))
colType = `SYMBOL`DATE
colType.append!(take(["DOUBLE"],200))
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`Date)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title43" id="2102-解决方案"><h4 class="- topic/title title topictitle4" id="ariaid-title43">2.10.2 解决方案</h4><div class="- topic/body body"><p class="- topic/p p">对于上述例子中表列数为 203，采用 TSDB 引擎存储该表能够避免读写时可能出现的性能瓶颈。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db= database("dfs://testDB2", VALUE, 2020.01.01..2021.01.01,engine="TSDB")
//203行的宽表，使用TSDB引擎
colName = `ID`Date`Time
colName.append!(take("factor"+string(0..200),200))
colType = `SYMBOL`DATE`TIME
colType.append!(take(["DOUBLE"],200))
tbSchema = table(1:0, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=`pt, partitionColumns=`Date,sortColumns=`ID`Time)</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title44" id="2103-性能测试结果"><h4 class="- topic/title title topictitle4" id="ariaid-title44">2.10.3 性能测试结果</h4><div class="- topic/body body"><p class="- topic/p p">按照上述两种建表方案进行建表，然后导入 10 天的数据（每天 200 万条记录）测试其点查性能。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select avg(factor2) from pt where ID=`60 and Date=2020.01.04</code></pre><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="2103-性能测试结果__entry__1"><strong class="+ topic/ph hi-d/b ph b">引擎</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="2103-性能测试结果__entry__2"><strong class="+ topic/ph hi-d/b ph b">平均耗时（ms）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="2103-性能测试结果__entry__3"><strong class="+ topic/ph hi-d/b ph b">最大耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="2103-性能测试结果__entry__1">OLAP 引擎</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="2103-性能测试结果__entry__2">62.6</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="2103-性能测试结果__entry__3">95.9</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="2103-性能测试结果__entry__1">TSDB 引擎</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="2103-性能测试结果__entry__2">1.2</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="2103-性能测试结果__entry__3">1.3</td></tr></tbody></table></div><p class="- topic/p p">通过上述性能测试实验结果，可以得出结论：对于列数大于 100 列的表可以使用 TSDB 引擎，提升查询效率。</p></div></article></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title45" id="3-总结"><h2 class="- topic/title title topictitle2" id="ariaid-title45">3 总结</h2><div class="- topic/body body"><p class="- topic/p p">本文介绍了使用 DolphinDB 进行建库建表时，最容易忽略的 10 个细节。这些错误用法的产生，是因为用户对于 DolphinDB 分区机制和数据库引擎原理不了解导致的。阅读了上面的最容易忽略的 10 个细节，如果还想进一步了解 DolphinDB 原理层面细节，可以浏览以下网址：<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/tutorials/tsdb_explained.html" target="_blank" rel="external noopener">TSDB 存储引擎详解 (dolphindb.cn)</a>、<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/tutorials/database.html" target="_blank" rel="external noopener">数据库分区 (dolphindb.cn)</a>、<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/tutorials/dolphindb_update.html" target="_blank" rel="external noopener">分布式表数据更新原理和性能 (dolphindb.cn)</a>。</p><p class="- topic/p p">最后归纳建库建表的要点：建库建表需要结合业务，首先根据业务特点选择合适的引擎（比如宽表选择 TSDB 引擎），其次根据业务特点选择分区字段和类型，然后根据分区大小在 100MB - 1GB 的原则设计分区粒度，最后根据业务特点完善对应引擎独有的参数（比如 TSDB 引擎特有的排序列）。</p></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E5%88%86%E5%8C%BA%E4%B8%8E%E5%82%A8%E5%AD%98%E7%BB%93%E6%9E%84%E7%AE%80%E4%BB%8B" data-tocid="1-分区与储存结构简介">1 分区与储存结构简介</a><ul><li class="topic-item"><a href="#11-%E5%88%86%E5%8C%BA%E7%B1%BB%E5%9E%8B" data-tocid="11-分区类型">1.1 分区类型</a></li><li class="topic-item"><a href="#12-%E5%88%86%E5%8C%BA%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99%E7%9A%84%E5%85%B3%E7%B3%BB" data-tocid="12-分区与数据读写的关系">1.2 分区与数据读写的关系</a></li><li class="topic-item"><a href="#13-%E5%82%A8%E5%AD%98%E7%BB%93%E6%9E%84" data-tocid="13-储存结构">1.3 储存结构</a><ul><li class="topic-item"><a href="#131-%E6%8E%92%E5%BA%8F%E5%88%97" data-tocid="131-排序列">1.3.1 排序列</a></li></ul></li></ul></li><li class="topic-item"><a href="#2-%E5%BB%BA%E5%BA%93%E5%BB%BA%E8%A1%A8%E6%97%B6%E5%AE%B9%E6%98%93%E5%BF%BD%E7%95%A5%E7%9A%84%E7%BB%86%E8%8A%82" data-tocid="2-建库建表时容易忽略的细节">2 建库建表时容易忽略的细节</a><ul><li class="topic-item"><a href="#21-%E4%BD%BF%E7%94%A8-tsdb-%E5%BC%95%E6%93%8E%E6%97%B6%E5%8D%95%E4%B8%AA%E7%B4%A2%E5%BC%95%E9%94%AE%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9D%A1%E6%95%B0%E8%BF%87%E5%B0%91" data-tocid="21-使用-tsdb-引擎时单个索引键对应的数据条数过少">2.1 使用 TSDB 引擎时单个索引键对应的数据条数过少</a><ul><li class="topic-item"><a href="#211-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="211-错误例子">2.1.1 错误例子</a></li><li class="topic-item"><a href="#212-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="212-解决方案">2.1.2 解决方案</a></li><li class="topic-item"><a href="#213-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" data-tocid="213-性能测试结果">2.1.3 性能测试结果</a></li></ul></li><li class="topic-item"><a href="#22-%E5%80%BCvalue%E5%88%86%E5%8C%BA%E5%AD%97%E6%AE%B5%E4%B8%BA%E5%90%AB%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2" data-tocid="22-值value分区字段为含特殊字符的字符串">2.2 值（VALUE）分区字段为含特殊字符的字符串</a><ul><li class="topic-item"><a href="#221-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="221-错误例子">2.2.1 错误例子</a></li><li class="topic-item"><a href="#222-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="222-解决方案">2.2.2 解决方案</a></li></ul></li><li class="topic-item"><a href="#23-%E8%8C%83%E5%9B%B4range%E5%88%86%E5%8C%BA%E6%97%B6%E8%8C%83%E5%9B%B4%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%90%88%E7%90%86%E5%AF%BC%E8%87%B4%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1" data-tocid="23-范围range分区时范围设置不合理导致插入数据丢失">2.3 范围（RANGE）分区时范围设置不合理导致插入数据丢失</a><ul><li class="topic-item"><a href="#231-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="231-错误例子">2.3.1 错误例子</a></li><li class="topic-item"><a href="#232-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="232-解决方案">2.3.2 解决方案</a></li></ul></li><li class="topic-item"><a href="#24-%E5%88%86%E5%8C%BA%E7%B2%92%E5%BA%A6%E8%BF%87%E5%B0%8F" data-tocid="24-分区粒度过小">2.4 分区粒度过小</a><ul><li class="topic-item"><a href="#241-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="241-错误例子">2.4.1 错误例子</a></li><li class="topic-item"><a href="#242-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="242-解决方案">2.4.2 解决方案</a></li><li class="topic-item"><a href="#243-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" data-tocid="243-性能测试结果">2.4.3 性能测试结果</a></li></ul></li><li class="topic-item"><a href="#25-%E5%88%86%E5%8C%BA%E7%B2%92%E5%BA%A6%E8%BF%87%E5%A4%A7" data-tocid="25-分区粒度过大">2.5 分区粒度过大</a><ul><li class="topic-item"><a href="#251-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="251-错误例子">2.5.1 错误例子</a></li><li class="topic-item"><a href="#252-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="252-解决方案">2.5.2 解决方案</a></li><li class="topic-item"><a href="#253-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" data-tocid="253-性能测试结果">2.5.3 性能测试结果</a></li></ul></li><li class="topic-item"><a href="#26-%E4%BD%BF%E7%94%A8%E7%BB%B4%E5%BA%A6%E8%A1%A8%E5%AD%98%E5%82%A8%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%87%8F%E7%9A%84%E8%A1%A8" data-tocid="26-使用维度表存储大数据量的表">2.6 使用维度表存储大数据量的表</a><ul><li class="topic-item"><a href="#261-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="261-错误例子">2.6.1 错误例子</a></li><li class="topic-item"><a href="#262-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="262-解决方案">2.6.2 解决方案</a></li><li class="topic-item"><a href="#263-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" data-tocid="263-性能测试结果">2.6.3 性能测试结果</a></li></ul></li><li class="topic-item"><a href="#27-%E5%88%86%E5%8C%BA%E5%AD%97%E6%AE%B5%E9%80%89%E6%8B%A9%E4%B8%8D%E5%90%88%E7%90%86%E5%AF%BC%E8%87%B4%E6%9F%A5%E8%AF%A2%E9%80%9F%E5%BA%A6%E6%85%A2" data-tocid="27-分区字段选择不合理导致查询速度慢">2.7 分区字段选择不合理导致查询速度慢</a><ul><li class="topic-item"><a href="#271-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="271-错误例子">2.7.1 错误例子</a></li><li class="topic-item"><a href="#272-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="272-解决方案">2.7.2 解决方案</a></li><li class="topic-item"><a href="#273-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" data-tocid="273-性能测试结果">2.7.3 性能测试结果</a></li></ul></li><li class="topic-item"><a href="#28-%E5%88%86%E5%8C%BA%E5%AD%97%E6%AE%B5%E9%80%89%E6%8B%A9%E4%B8%8D%E5%90%88%E7%90%86%E5%AF%BC%E8%87%B4%E5%B9%B6%E5%8F%91%E5%86%99%E5%85%A5%E5%86%B2%E7%AA%81" data-tocid="28-分区字段选择不合理导致并发写入冲突">2.8 分区字段选择不合理导致并发写入冲突</a><ul><li class="topic-item"><a href="#281-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="281-错误例子">2.8.1 错误例子</a></li><li class="topic-item"><a href="#282-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="282-解决方案">2.8.2 解决方案</a></li></ul></li><li class="topic-item"><a href="#29-%E6%95%B0%E6%8D%AE%E9%87%8F%E4%B8%8E%E6%97%A5%E4%BF%B1%E5%A2%9E%E7%9A%84%E8%A1%A8%E6%9C%AA%E4%BD%BF%E7%94%A8%E6%97%A5%E6%9C%9F%E5%AD%97%E6%AE%B5%E5%88%86%E5%8C%BA" data-tocid="29-数据量与日俱增的表未使用日期字段分区">2.9 数据量与日俱增的表未使用日期字段分区</a><ul><li class="topic-item"><a href="#291-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="291-错误例子">2.9.1 错误例子</a></li><li class="topic-item"><a href="#292-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="292-解决方案">2.9.2 解决方案</a></li><li class="topic-item"><a href="#293-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" data-tocid="293-性能测试结果">2.9.3 性能测试结果</a></li></ul></li><li class="topic-item"><a href="#210-%E4%BD%BF%E7%94%A8-olap-%E5%BC%95%E6%93%8E%E5%AD%98%E5%82%A8%E5%AE%BD%E8%A1%A8" data-tocid="210-使用-olap-引擎存储宽表">2.10 使用 OLAP 引擎存储宽表</a><ul><li class="topic-item"><a href="#2101-%E9%94%99%E8%AF%AF%E4%BE%8B%E5%AD%90" data-tocid="2101-错误例子">2.10.1 错误例子</a></li><li class="topic-item"><a href="#2102-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" data-tocid="2102-解决方案">2.10.2 解决方案</a></li><li class="topic-item"><a href="#2103-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" data-tocid="2103-性能测试结果">2.10.3 性能测试结果</a></li></ul></li></ul></li><li class="topic-item"><a href="#3-%E6%80%BB%E7%BB%93" data-tocid="3-总结">3 总结</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>