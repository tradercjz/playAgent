<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="Level-2 高频行情数据包含大量有价值的信息，利用这些数据生成交易信号和获取收益已经成为量化研究中的一种主流策略。作为一个高性能时序数据库，DolphinDB 非常适合存储、处理 GB 级别甚至 PB 级别的海量数据集，包括 Level-2 高频行情数据的存储、因子计算、建模、回测和实盘交易等。 本文基于国内 A 股市场 Level-2 ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="处理-level-2-行情数据实例"/><title>处理 Level-2 行情数据实例</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ..?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;处理-level-2-行情数据实例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;处理 Level-2 行情数据实例&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Level-2 高频行情数据包含大量有价值的信息，利用这些数据生成交易信号和获取收益已经成为量化研究中的一种主流策略。作为一个高性能时序数据库，DolphinDB 非常适合存储、处理 GB 级别甚至 PB 级别的海量数据集，包括 Level-2 高频行情数据的存储、因子计算、建模、回测和实盘交易等。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;本文基于国内 A 股市场 Level-2 高频行情数据的特点来展示高频行情数据存储和因子计算实例。根据历史批量因子计算、实时因子计算两个场景，以及针对不同的高频数据源，本文总结出了在 DolphinDB 中处理 Level-2 行情数据实例。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;本文涉及的脚本见附件，DolphinDB server 版本为 2.00.9。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:100;135:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-level-2-行情数据介绍&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;1. Level-2 行情数据介绍&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;11-数据概况&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;1.1. 数据概况&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Level-2 行情数据是目前国内证券市场上最为完整，颗粒度最为精细的交易信息数据。其涵盖了在沪深两市上市的股票、可交易型基金、沪深交易所指数等大量品种。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Level-2 行情数据分类表如下:&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:1;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;数据类型&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;20:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;数据频率&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:3;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;分钟 K 线&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;22:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;1分钟&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:5;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;盘口快照&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:6;23:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3秒&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:7;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托队列&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:8;24:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3秒&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:9;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;逐笔成交&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:10;25:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;0.01秒&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:11;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;逐笔委托&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:12;26:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;0.01秒&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;分钟K线：即当日全天的分钟K线行情。相比传统K线，包含了分钟成交笔数信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;盘口快照：即常用的每3秒一个切片的十档委托行情。其中，也包括该时刻的委托总量和平均委托价格信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托队列：即买一、卖一的总委托单数，以及前50笔委托的明细信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交明细：即两个3秒快照之间，详细的逐笔成交与逐笔委托信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;需要注意的是，沪深交易所的 Level-2 行情数据存在一定的差异，主要体现在成交明细数据方面。深交所的逐笔成交数据中，包括了逐笔委托数据，其中有详细的挂撤单信息，和标记为撤单的逐笔成交。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;12-数据结构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;1.2. 数据结构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;上交所提供的1分钟数据是 Level-2 行情数据中数据字段最少、频率最低的数据。其主要包含昨日收盘价、开盘价、最高价、最低价、收盘价、成交量和成交额等数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;A股票行情快照数据每3秒钟记录一次，包括前后两个时刻的盘口变化数据。每天的数据量约为15G。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;股票行情快照数据原始字段说明对照表（表中的空字段，说明当前市场的行情数据中没有该字段）&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:2;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:3;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:4;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:5;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:13;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;深交所数据&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:14;46:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;上交所数据&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:15;46:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;字段含义&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:16;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;security_id&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:17;48:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:18;48:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;证券代码&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:19;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;orig_time&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:20;49:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;DateTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:21;49:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;时间戳：2021-03-01 12:45:00.000&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;50:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:22;50:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;preclose_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:23;50:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;PreClosePx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:24;50:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;昨日收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:25;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;open_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:26;51:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OpenPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:27;51:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;开盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;52:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:28;52:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;high_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:29;52:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;HighPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:30;52:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;最高价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:31;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;low_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:32;53:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;LowPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:33;53:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;最低价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;54:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:34;54:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;last_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:35;54:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;LastPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:36;54:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:37;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;up_limit_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:38;55:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:39;55:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;涨停&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:40;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;down_limit_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:41;56:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:42;56:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;跌停&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:43;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;trading_phase_code&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:44;57:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;InstrumentStatus&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:45;57:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;交易状态&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:46;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;num_trades&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:47;58:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;NumTrades&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:48;58:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:49;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;total_volume_trade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:50;59:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TotalVolumeTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:51;59:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交总量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:52;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;total_value_trade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:53;60:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TotalValueTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:54;60:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交总金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:55;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;total_bid_qty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:56;61:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TotalBidQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:57;61:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托买入总量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;62:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:58;62:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;total_offer_qty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:59;62:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TotalOfferQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:60;62:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托卖出总量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:61;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:62;63:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;WithdrawBuyNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:63;63:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;买入撤单笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;64:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:64;64:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:65;64:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;WithdrawSellNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:66;64:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;卖出撤单笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:67;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:68;65:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;WithdrawBuyAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:69;65:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;买入撤单数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;66:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:70;66:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:71;66:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;WithdrawSellAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:72;66:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;卖出撤单数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;21&#34; xtrc=&#34;entry:73;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;21&#34; xtrc=&#34;entry:74;67:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;WithdrawBuyMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;21&#34; xtrc=&#34;entry:75;67:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;买入撤单金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;22&#34; xtrc=&#34;entry:76;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;22&#34; xtrc=&#34;entry:77;68:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;WithdrawSellMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;22&#34; xtrc=&#34;entry:78;68:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;卖出撤单金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;23&#34; xtrc=&#34;entry:79;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;weighted_avg_bid_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;23&#34; xtrc=&#34;entry:80;69:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;WeightedAvgBidPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;23&#34; xtrc=&#34;entry:81;69:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;加权平均委买价格&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;70:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;24&#34; xtrc=&#34;entry:82;70:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;bid_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;24&#34; xtrc=&#34;entry:83;70:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;BidPrice[10]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;24&#34; xtrc=&#34;entry:84;70:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委买价格10&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;25&#34; xtrc=&#34;entry:85;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;offer_px&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;25&#34; xtrc=&#34;entry:86;71:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OfferPrice[10]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;25&#34; xtrc=&#34;entry:87;71:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委卖价格10&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;72:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;26&#34; xtrc=&#34;entry:88;72:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;bid_size&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;26&#34; xtrc=&#34;entry:89;72:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;BidOrderQty[10]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;26&#34; xtrc=&#34;entry:90;72:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;买10量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;27&#34; xtrc=&#34;entry:91;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;offer_size&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;27&#34; xtrc=&#34;entry:92;73:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OfferOrderQty[10]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;27&#34; xtrc=&#34;entry:93;73:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;卖10量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;74:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;28&#34; xtrc=&#34;entry:94;74:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;order_qty_b1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;28&#34; xtrc=&#34;entry:95;74:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;BidOrders[50]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;28&#34; xtrc=&#34;entry:96;74:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委买订单50&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;29&#34; xtrc=&#34;entry:97;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;order_qty_s1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;29&#34; xtrc=&#34;entry:98;75:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OfferOrders[50]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;29&#34; xtrc=&#34;entry:99;75:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委卖订单50&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;股票逐笔委托数据记录的最小时间间隔为0.01秒，每个0.01秒内有可能有多笔委托，Level-2 行情数据对0.01秒内的委托时点进行模糊处理，不进行区分。 股票逐笔委托数据的单日数据量在 12GB 左右，由于交易活跃度不同，不同标的之间的单日数据量会有很大差异。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;股票逐笔委托原始数据字段说明对照表（表中的空字段，说明当前市场的行情数据中没有该字段）&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:3;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:6;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:7;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:8;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:100;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;深交所数据&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:101;81:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;上交所数据&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:102;81:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;字段含义&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:37;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:103;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:104;83:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:105;83:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;证券代码&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:38;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:106;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrigTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:107;84:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TransactTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:108;84:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;时间戳：2021-03-01 12:45:00.000&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:39;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:109;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Price&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:110;85:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Price&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:111;85:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托价格&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:40;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:112;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrderQty&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:113;86:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Balance&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:114;86:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:41;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:115;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Side&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:116;87:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrderBSFlag&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:117;87:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;买卖方向：沪市为B – 买单；S – 卖深市为1 - 买；2 - 卖&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:42;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:118;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:119;88:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrderNo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:120;88:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托订单号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:43;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:121;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;ApplSeqNum&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:122;89:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:123;89:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托索引（仅深交所）&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:44;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:124;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;ChannelNo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:125;90:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;ChannelNo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:126;90:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;频道代码&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:45;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:127;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrderType&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:128;91:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrdType&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:129;91:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托类别：沪市为A – 委托订单（增加）；D – 委托订单（删除）深市为1-市价；2-限价；U - 本方最优&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:46;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:130;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:131;92:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;BizIndex&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:132;92:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;业务序列号，与逐笔成交统一编号，从 1 开始按 Channel 连续&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:47;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:133;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:134;93:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrderIndex&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:135;93:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托序号， NUMBER 从 1 开始，按 Channel 连续&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;与股票逐笔委托数据相似，股票逐笔成交数据记录了股票交易的每一笔成交信息。每笔成交包含价格、成交量、成交金额、成交时间等信息。单日数据量在 6GB 左右，与不同标的的交易活跃度有关。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;股票逐笔成交数据原始字段说明对照表（表中的空字段，说明当前市场的行情数据中没有该字段）&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:4;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:9;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:10;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:11;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:48;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:136;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;深交所数据&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:137;99:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;上交所数据&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:138;99:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;数据说明&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:49;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:139;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:140;101:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:141;101:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;证券代码&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:50;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:142;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;ExecType&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:143;102:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TradeBSFlag&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:144;102:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交类别：沪市为B – 外盘，主动买；S – 内盘，主动卖；N – 未知深市为4 - 撤销；F - 成交&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:51;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:145;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OrigTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:146;103:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TradeTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:147;103:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:52;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:148;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Price&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:149;104:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TradePrice&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:150;104:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交价格&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:53;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:151;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TradeQty&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:152;105:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TradeQty&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:153;105:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:54;106:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:154;106:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:155;106:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TradeAmount&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:156;106:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:55;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:157;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;BidApplSeqNum&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:158;107:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;BuyNo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:159;107:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;买方序号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:56;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:160;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;OfferApplSeqNum&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:161;108:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SellNo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:162;108:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;卖方序号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:57;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:163;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:164;109:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;TradeIndex&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:165;109:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交序号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:58;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:166;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:167;110:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;BizIndex&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:168;110:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;业务序列号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:59;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:169;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;ChannelNo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:170;111:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;ChannelNo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:171;111:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;频道代码&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-dolphindb-高效存储-level-2-行情数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;2. DolphinDB 高效存储 Level-2 行情数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;A股股票高频数据每日数据增量在30+G，基金债券等标的每日数据量在45+G。历史数据和每日增量数据数据量在 10TB 级别以上。面对如此庞大的数据量， 如何保证高效的数据写入、数据压缩和快速的数据查询计算是高频数据存储的一大挑战。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;为解决这一挑战，我们将 DolphinDB 的存储特性组合使用，提供了灵活的存储解决方案。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-分区方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;2.1. 分区方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;为了实现行情数据的灵活分区存储，可以采用”时间+标的“的方式进行数据分区。DolphinDB 支持对不同分区数据进行多线程并行操作。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-分区内分组排序&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;2.2. 分区内分组排序&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;DolphinDB 的 TSDB 引擎提供了排序键设置，可以为每个数据分区设置一个排序键，以便在数据随机读取时更准确地定位数据。例如，通过设置 SortColumn=[“SecurityID”, “TradeTime”]，数据可以按照 SecurityID 字段分组，并在每个组内按照时间字段 TradeTime 排序。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-level-2-行情数据存储方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;2.3. Level-2 行情数据存储方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;在上交所股票 Level-2 行情数据中，市价单信息只存储于逐笔成交表中，而逐笔委托表中没有市价单的记录，因此计算委托量和委托金额等指标时需要对两个表进行关联。在深交所 Level-2 行情数据中，逐笔委托表中的市价单价格标记为0；而撤单记录在逐笔成交表中，撤单记录中价格也标记为0；因此在计算委托金额、撤单金额等指标时都需要对两个表进行关联再计算。此外，在计算其他因子指标时，也需要对逐笔成交表和行情快照数据表进行关联。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;根据业务需求，这里对沪深股票 Level-2 高频数据采用一库三表的建库建表方案，即把两个交易所相同的行情数据存入同一张表，使用 market 字段标识不同的交易所，且将 market 设置在索引列（SortColumn）中。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:5;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:12;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:13;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:14;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:15;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:16;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:60;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:172;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;数据源&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:173;133:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;数据量&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:174;133:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;分区方案（组合分区）&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:175;133:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;库、表名称&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:176;133:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SortColumn 字段&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:61;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:177;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;行情快照&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:178;135:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;15G+&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:179;135:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;交易日按值分区+标的哈希20分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:180;135:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&#34;dfs://level_2&#34;，&#34;snapshot&#34;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:181;135:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;market，SecurityID，TradeTime&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:62;136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:182;136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;逐笔委托&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:183;136:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;11G+&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:184;136:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;交易日值分区+标的哈希20分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:185;136:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&#34;dfs://level_2&#34;，&#34;entrust&#34;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:186;136:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;market，SecurityID，TradeTime&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:63;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:187;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;逐笔成交&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:188;137:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;6G+&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:189;137:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;交易日值分区+标的哈希20分区&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:190;137:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&#34;dfs://level_2&#34;，&#34;trade&#34;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:191;137:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;market，SecurityID，TradeTime&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;库表创建之后，数据的导入教程可以参考 DolphinDB 的数据导入相关教程，如&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;LoadDataForPoc.md&#34; xtrc=&#34;xref:1;139:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;金融 PoC 用户历史数据导入指导手册之股票 level2 逐笔篇&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-基于历史数据的批量因子计算&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3. 基于历史数据的批量因子计算&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;本章节介绍 DolphinDB 对 Level-2 行情数据的处理。DolphinDB 不仅提供了高速存取时序数据的基本功能，还内置了向量化的多范式编程语言和强大的计算引擎，可高效用于量化金融的因子开发，包括基于历史数据的批量高频因子计算和基于实时 Level-2 行情的流式计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;本章基于 Level-2 历史行情数据中的行情快照、逐笔成交和逐笔委托中的几个高频因子，介绍 DolphinDB 向量化的多范式编程语言的强大功能。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-快照数据的因子计算&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.1. 快照数据的因子计算&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Level-2 行情快照数据包含 10 档价位上的委卖价格、委托量和委托买卖总量等指标，主要用于分析订单簿所提供的信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;行情快照中的大部分高频因子基于限价订单簿的静态指标，例如价差、深度、宽度、斜率、订单不平衡等，研究市场的交易行为，进而预测股票的短期价格走势。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;本节介绍基于 Level-2 行情快照中十档买卖价格和买卖数量数据计算的时间加权订单斜率、十档平均委卖订单斜率、成交价加权净委买比例、十档委买增额和十档买卖委托均价线性回归斜率等高频因子。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;以下是 Level-2 行情快照数据十档部分字段的样例：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_1.png&#34; xtrc=&#34;image:1;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;974&#34; dita-ot:image-height=&#34;133&#34;/&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;311-时间加权订单斜率&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.1.1. 时间加权订单斜率&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;订单斜率因子衡量订单价差对订单量差的敏感度。其计算公式如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_2.png&#34; xtrc=&#34;image:2;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;432&#34; dita-ot:image-height=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_2_1.png&#34; t=&#34;&#34; xtrc=&#34;image:3;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;104&#34; dita-ot:image-height=&#34;14&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:1;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;logQuoteSlope_&lt;/alt&gt;&lt;/image&gt;衡量 t 时刻的订单斜率。其中，&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_2_2.png&#34; t=&#34;&#34; xtrc=&#34;image:4;165:87&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;24&#34; dita-ot:image-height=&#34;14&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:2;165:87&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;bid_&lt;/alt&gt;&lt;/image&gt; 和 &lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_2_3.png&#34; t=&#34;&#34; xtrc=&#34;image:5;165:150&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;27&#34; dita-ot:image-height=&#34;14&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:3;165:150&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;ask&lt;/alt&gt;&lt;/image&gt; 分别表示买一价和卖一价，&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_2_4.png&#34; t=&#34;&#34; xtrc=&#34;image:6;165:222&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;49&#34; dita-ot:image-height=&#34;14&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:4;165:222&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;bidQty_&lt;/alt&gt;&lt;/image&gt; 和&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_2_5.png&#34; t=&#34;&#34; xtrc=&#34;image:7;165:287&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;53&#34; dita-ot:image-height=&#34;14&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:5;165:287&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;askQty_&lt;/alt&gt;&lt;/image&gt; 分别表示买一量和卖一量。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; @state def timeWeightedOrderSlope(bid,bidQty,ask,askQty,lag=20){ return (log(iif(ask==0,bid,ask))-log(iif(bid==0,ask,bid)))\(log(askQty)-log(bidQty)).ffill().mavg(lag, 1).nullFill(0) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;使用函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;174:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;mavg&lt;/codeph&gt;计算过去 20 行的移动平均时间加权订单斜率，其中 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;174:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;@state&lt;/codeph&gt; 表示用户自定义的状态函数。状态算子计算时需要用到历史状态，DolphinDB 在流式计算中对自定义状态函数，通过增量的方式实现，性能有很大的提升。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;312-加权平均订单失衡率因子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;176:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;176:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.1.2. 加权平均订单失衡率因子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;176:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;178:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;订单失衡率（SOIR）因子衡量买卖委托量在总量中的不均衡程度。其计算公式如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_3.png&#34; xtrc=&#34;image:8;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;313&#34; dita-ot:image-height=&#34;67&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;表示 t时刻第 i 档的订单失衡率因子。其中 &lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_3_1.png&#34; i_t=&#34;&#34; xtrc=&#34;image:9;182:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;56&#34; dita-ot:image-height=&#34;16&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:6;182:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;bidQty_&lt;/alt&gt;&lt;/image&gt; ，&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_3_2.png&#34; xtrc=&#34;image:10;182:91&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;60&#34; dita-ot:image-height=&#34;16&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:7;182:91&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;askQty_{i,t}&lt;/alt&gt;&lt;/image&gt; 表示第 i 档买方委托量和卖方委托量。为了充分利用各档数据信息，计算各档位加权和订单失衡率因子时，根据买卖压力的影响力赋予不同档位相应的权重。通常，靠近交易价格的档位被赋予更高的权重。计算公式如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_4.png&#34; xtrc=&#34;image:11;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;387&#34; dita-ot:image-height=&#34;77&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;SOIR 反应盘口各档综合的买卖委托量不均衡程度。如果 SOIR 为正，则说明市场买压大于卖压，未来价格趋势上涨的概率较高。此外，SOIR 值越大，上涨的概率越高，反之亦然。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;@state def wavgSOIR(bidQty,askQty,lag=20){ imbalance= rowWavg((bidQty - askQty)\(bidQty + askQty), 10 9 8 7 6 5 4 3 2 1).ffill().nullFill(0) mean = mavg(prev(imbalance), (lag-1), 2) std = mstdp(prev(imbalance) * 1000000, (lag-1), 2) \ 1000000 return iif(std &amp;gt;= 0.0000001,(imbalance - mean) \ std, NULL).ffill().nullFill(0) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;198:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;bidQty, askQty 为数组向量数据类型，分别为买方十档委托量和卖方十档委托数量。使用数组向量进行加减运算非常便捷，而使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;198:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;rowWavg&lt;/codeph&gt;函数则可轻松计算加权平均值。在本例中，我们使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;198:99&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;rowWavg&lt;/codeph&gt; 函数计算各档加权平均的买卖委托量不均衡程度因子，即订单失衡率因子。最后对一段时间的指标进行移动标准化处理。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;313-成交价加权净委买比例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.1.3. 成交价加权净委买比例&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;202:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;净委买比率是衡量一段时间内买盘相对强度的指标，计算公式为：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;204:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;(盘口买一变化量－盘口卖一变化量)/ (abs（盘口买一变化量)+abs(盘口卖一变化量))×100%&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;当净委买比率为正值数值较大时，说明市场买盘强劲。当委比值为负值且数值较大时，说明市场卖盘强劲。数值从-100%逐步增加到+100%表示买盘逐渐增强，卖盘逐渐减弱；而从+100%逐步减少到-100%则表示买盘逐渐减弱，卖盘逐渐增强的过程。其计算公式如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_5.png&#34; xtrc=&#34;image:12;208:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;604&#34; dita-ot:image-height=&#34;102&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_5_1.png&#34; xtrc=&#34;image:13;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;84&#34; dita-ot:image-height=&#34;16&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:8;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;chg(bidQty_)&lt;/alt&gt;&lt;/image&gt; 和&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_5_2.png&#34; t=&#34;&#34; xtrc=&#34;image:14;212:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;88&#34; dita-ot:image-height=&#34;16&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:9;212:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;chg(askQty&lt;/alt&gt;&lt;/image&gt; 分别表示在 i 时刻盘口买一和卖一变化量，而 &lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_5_3.png&#34; xtrc=&#34;image:15;212:161&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;66&#34; dita-ot:image-height=&#34;14&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt; 表示在 i-1 时刻到 i 时刻成交的平均价格。&lt;/image&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; @state def traPriceWeightedNetBuyQuoteVolumeRatio(bid,bidQty,ask,askQty,TotalValTrd,TotalVolTrd,lag=20){ prevbid = prev(bid) prevbidQty = prev(bidQty) prevask = prev(ask) prevaskQty = prev(askQty) bidchg = iif(round(bid-prevbid,2)&amp;gt;0, bidQty, iif(round(bid-prevbid,2)&amp;lt;0, -prevbidQty, bidQty-prevbidQty)) offerchg = iif(iif(ask==0,iif(prevask&amp;gt;0,1,0), ask-prevask)&amp;gt;0, prevaskQty, iif(iif(prevask==0, iif(ask&amp;gt;0,-1,0), iif(ask&amp;gt;0,ask-prevask,1))&amp;lt;0, askQty, askQty-prevaskQty)) avgprice = deltas(TotalValTrd)\deltas(TotalVolTrd) factorValue = (bidchg-offerchg)\(abs(bidchg)+abs(offerchg))*avgprice return nullFill(msum(factorValue,lag,1)\msum(avgprice,lag,1), 0) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;以上代码，首先通过计算买卖一档前后价格的变化，得到盘口买卖一委托量的绝对变化量；然后利用净委买比率公式，计算过去一段时间的成交价加权净委买比例。&lt;/p&gt;&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;314-十档净委买增额&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.1.4. 十档净委买增额&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;十档净委买增额因子指的是在有效十档范围内买方资金总体增加量，即所有买价变化量的总和，计算公式如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_6.png&#34; xtrc=&#34;image:16;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;735&#34; dita-ot:image-height=&#34;95&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;有效十档范围内表示不考虑已不在十档范围内的档位，即表示只考虑以下区间的档位：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_7.png&#34; xtrc=&#34;image:17;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;397&#34; dita-ot:image-height=&#34;43&#34;/&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;@state def level10_Diff(price, qty, buy, lag=20){ prevPrice = price.prev() left, right = rowAlign(price, prevPrice, how=iif(buy, &#34;bid&#34;, &#34;ask&#34;)) qtyDiff = (qty.rowAt(left).nullFill(0) - qty.prev().rowAt(right).nullFill(0)) amtDiff = rowSum(nullFill(price.rowAt(left), prevPrice.rowAt(right)) * qtyDiff) return msum(amtDiff, lag, 1).nullFill(0) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;253:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;以上代码，首先通过行对齐函数&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;253:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;rowAlign&lt;/codeph&gt;实现当前十档价格和前一个一十档价格进行行对齐，然后通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;253:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;rowAt&lt;/codeph&gt;和&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;253:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;nullFill&lt;/codeph&gt;函数分别获取对应档位的委托量和实现价格进行对齐，最后计算总的变化额。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;315-十档买卖委托均价线性回归斜率&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.1.5. 十档买卖委托均价线性回归斜率&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;257:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;十档买卖委托均价即为十档买卖委托额之和除以十档买卖委托量之和：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_8.png&#34; xtrc=&#34;image:18;259:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;545&#34; dita-ot:image-height=&#34;106&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;261:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;十档买卖委托均价线性回归斜率为十档买卖委托均价对时间t的线性回归的斜率。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;@state def level10_InferPriceTrend(bid, ask, bidQty, askQty, lag1=60, lag2=20){ inferPrice = (rowSum(bid*bidQty)+rowSum(ask*askQty))\(rowSum(bidQty)+rowSum(askQty)) price = iif(bid[0] &amp;lt;=0 or ask[0]&amp;lt;=0, NULL, inferPrice) return price.ffill().linearTimeTrend(lag1).at(1).nullFill(0).mavg(lag2, 1).nullFill(0) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;以上代码，bid, ask, bidQty 和 askQty 均为数组向量数据类型，分别为买卖十档价格和十档委托数量。通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;272:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;linearTimeTrend&lt;/codeph&gt;函数获取因子值对时间 t 的滑动线性回归斜率，该函数返回线性回归的截距和斜率。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;272:118&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;linearTimeTrend(price_,lag1)[1]&lt;/codeph&gt; 表示获取十档买卖委托均价对时间t的线性回归的斜率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;316-性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.1.6. 性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;A 股 Level-2 行情快照数据一天的数据量超过 10G，因此金融量化工程师们非常关注 Level-2 行情快照数据的高频因子计算性能。本节将展示 5 个受到关注的高频因子的计算性能，包括：加权时间订单斜率、加权平均订单失衡率、成交价加权净委买比率、十档委买增额和十档买卖委托均价线性回归斜率。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;timer { res=select SecurityID,DateTime,timeWeightedOrderSlope(bidPrice[0],bidOrderQty[0],OfferPrice[0],OfferOrderQty[0]) as TimeWeightedOrderSlope, level10_InferPriceTrend(bidPrice,OfferPrice,bidOrderQty,OfferOrderQty,60,20) as Level10_InferPriceTrend, level10_Diff(bidPrice, bidOrderQty, true,20) as Level10_Diff, traPriceWeightedNetBuyQuoteVolumeRatio(bidPrice[0],bidOrderQty[0],OfferPrice[0],OfferOrderQty[0],TotalValueTrade, totalVolumeTrade) as TraPriceWeightedNetBuyQuoteVolumeRatio, wavgSOIR( bidOrderQty,OfferOrderQty,20) as HeightImbalance from loadTable(dbName,snapshotTBname) where date(DateTime)=idate context by SecurityID csort DateTime map }&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;290:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;计算结果展示&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_9.png&#34; width=&#34;70%&#34; xtrc=&#34;image:19;292:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;901&#34; dita-ot:image-height=&#34;276&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;294:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;计算耗时展示&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;296:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;以下为基于快照数据计算一天全市场所有股票的 5 个因子的耗时，可以发现耗时基本与 CPU 数量成正比。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;298:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:6;298:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:17;298:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:18;298:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;298:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:64;298:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:192;298:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;CPU 数量&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:193;298:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;5个因子计算耗时&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;300:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:65;300:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:194;300:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:195;300:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;35.51s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:66;301:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:196;301:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;8&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:197;301:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;19.27s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:67;302:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:198;302:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;16&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:199;302:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;11.91s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:68;303:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:200;303:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;32&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:201;303:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;8.11s&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;307:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;与 Python 计算性能的对比&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;309:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;在 Python 中实现上面5个因子的计算逻辑。获取一天中两只股票的数据进行对比测试。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;311:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;下表为 DolphinDB 和 Python 计算性能的对比，可以发现，DolphinDB 显著优于 Python。代码见附件。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:7;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:19;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:20;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:21;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:22;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:69;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:202;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;313:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;因子名&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:203;313:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;313:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Python 耗时&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:204;313:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;313:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;DolphinDB 耗时&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:205;313:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;313:83&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;耗时比&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;315:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:70;315:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:206;315:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;timeWeightedOrderSlope&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:207;315:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;136.726ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:208;315:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;7.745ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:209;315:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;17.6&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:71;316:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:210;316:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;wavgSOIR&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:211;316:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;432.329ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:212;316:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;11.805ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:213;316:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;36.6&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:72;317:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:214;317:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;traPriceWeightedNetBuyQuoteVolumeRatio&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:215;317:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;144.154ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:216;317:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;8.339ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:217;317:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;17.3&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:73;318:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:218;318:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;level10_Diff&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:219;318:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;34.120026s&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:220;318:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;13.025ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:221;318:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;2619.2&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:74;319:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:222;319:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;level10_InferPriceTrend&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:223;319:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;1.267870s&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:224;319:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;20.324ms&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:225;319:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;73.7&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-逐笔成交数据的因子计算&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.2. 逐笔成交数据的因子计算&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;323:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;逐笔成交数据包含的信息很丰富，可以构建很多中高频因子。以下为逐笔成交的样例数据：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_10.png&#34; width=&#34;500&#34; xtrc=&#34;image:20;325:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;1010&#34; dita-ot:image-height=&#34;206&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;利用逐笔成交数据中的买卖订单号，可以将其合并为单笔订单成交数据，并从单笔订单的角度区分大小单和主买卖方向等。本节从单笔订单和主买卖角度出发，计算主动买入和卖出的单笔订单均价，并统计成交时间与开始委托下单时长超过1分钟的订单数量。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;321-单笔订单主动买入卖出均价&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;329:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;329:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.2.1. 单笔订单主动买入卖出均价&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;329:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;331:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;单笔订单主动买入、卖出均价为单笔主买、主卖订单的成交均价价格之和除以订单数量。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_11.png&#34; xtrc=&#34;image:21;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;305&#34; dita-ot:image-height=&#34;52&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;n表示截至 t 时刻主买、主卖订单数量，&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_11_1.png&#34; xtrc=&#34;image:22;335:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;105&#34; dita-ot:image-height=&#34;14&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:10;335:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;AnyTradePrice&lt;/alt&gt;&lt;/image&gt;表示单笔订单主买、主卖的成交均价。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;def singleOrderAveragePrice(buyNo,sellNo,tradePrice,tradeQty,BSFlag=&#34;B&#34;){ if(BSFlag==&#34;B&#34;){ totolMoney=groupby(sum,iif(buyNo&amp;gt;sellNo,tradePrice*tradeQty,0),buyNo).values()[1] totolqty=groupby(sum,iif(buyNo&amp;gt;sellNo,tradeQty,0),buyNo).values()[1] } else{ totolMoney=groupby(sum,iif(buyNo&amp;lt;sellNo,tradePrice*tradeQty,0),sellNo).values()[1] totolqty=groupby(sum,iif(buyNo&amp;lt;sellNo,tradeQty,0),sellNo).values()[1] } return totolMoney\totolqty } res=select avg(singleOrderAveragePrice(BidApplSeqNum,OfferApplSeqNum,TradePrice,TradeQty,&#34;B&#34;)) as ActBuySingleOrderAveragePriceFactor, avg(singleOrderAveragePrice(BidApplSeqNum,OfferApplSeqNum,TradePrice,TradeQty,&#34;S&#34;)) as ActSellSingleOrderAveragePriceFactor from tradeTB where TradePrice&amp;gt;0 group by SecurityID cgroup by minute(DateTime) as minute order by minute;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;这里首先通过自定义函数实现单笔订单的成交均价，然后再计算单笔订单的成交均价。自定义函数中使用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;354:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;groupby&lt;/codeph&gt;函数分别计算单笔订单的成交金额和成交数量。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;最后通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;356:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;group by&lt;/codeph&gt;和&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;356:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;cgroup by&lt;/codeph&gt;计算每只股票当日最新一分钟单笔订单主动买入、卖出均价。计算结果如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_12.png&#34; width=&#34;500&#34; xtrc=&#34;image:23;358:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;520&#34; dita-ot:image-height=&#34;256&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;322-股票延时成交订单因子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.2.2. 股票延时成交订单因子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;延时成交挂单数和成交量，一定程度上能反应大单或者机构成交情况。本节统计从下单到成交的时间间隔超过1分钟的订单数和成交量。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;@state def delayedTradeNum(bsFlag, flag, side){ return iif(bsFlag==side &amp;amp;&amp;amp; flag&amp;lt;=1, flag, 0).cumsum() } @state def delayedTradeQty(bsFlag, flag, tradeQty, cumTradeQty, side){ return iif(bsFlag==side &amp;amp;&amp;amp; flag&amp;gt;1, tradeQty, iif(bsFlag==side &amp;amp;&amp;amp; flag==1, cumTradeQty, 0)).cumsum() } ///买方 ///step 1,标记延时状态，计算笔订单的累计成交量 t1 = select SecurityID,DateTime,entrust.DateTime as time,&#34;B&#34; as bsFlag,tradeQty, cumsum(iif(DateTime-entrust.DateTime&amp;gt;60000,1,0)) as delayedTraderflag, cumsum(tradeQty) as cumTradeQty from lsj(trade, entrust, ['SecurityID', 'BidApplSeqNum'], ['SecurityID', 'ApplSeqNum']) where tradePrice&amp;gt;0 context by SecurityID,BidApplSeqNum /////step 2,统计每只股票累计的延时成交订单数，和延时成交订单量 tt2 = select SecurityID,DateTime,delayedTradeNum(bsFlag, delayedTraderflag, &#34;B&#34;) as DelayedTraderBuyOrderNum , delayedTradeQty(bsFlag,delayedTraderflag, tradeQty, cumTradeQty, &#34;B&#34;) as DelayedTraderBuyOrderQty from t1 context by SecurityID limit -1 ///卖方 ///step 1,标记延时状态，计算笔订单的累计成交量 t1 = select SecurityID,DateTime,&#34;S&#34; as bsFlag,tradeQty, cumsum(iif(DateTime-entrust.DateTime&amp;gt;60000,1,0)) as delayedTraderflag, cumsum(tradeQty) as cumTradeQty from lsj(trade, entrust, ['SecurityID', 'OfferApplSeqNum'], ['SecurityID', 'ApplSeqNum']) where tradePrice&amp;gt;0 context by SecurityID, OfferApplSeqNum /////step 2,统计每只股票累计的延时成交订单数，和延时成交订单量 t3 = select SecurityID,DateTime,delayedTradeNum(bsFlag, delayedTraderflag, &#34;S&#34;) as DelayedTraderSellOrderNum , delayedTradeQty(bsFlag,delayedTraderflag , tradeQty, cumTradeQty, &#34;S&#34;) as DelayedTraderSellOrderQty from t1 context by SecurityID limit -1 t2=lsj(t2,t3,`SecurityID`DateTime) &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;下单信息记录在逐笔委托表里，如果统计下单到成交之间的时间间隔，则需要把逐笔成交表和逐笔委托表进行关联。这里首先通过左半连接(&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;391:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;lsj&lt;/codeph&gt;) 返回逐笔成交表中所有与逐笔委托表匹配的记录，如果逐笔委托表中有多条匹配记录（如上交所的下单和撤单记录），&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;391:122&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;lsj&lt;/codeph&gt; 将会取第一条（下单时的订单记录）匹配记录。因此，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;391:152&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;lsj&lt;/codeph&gt; 可以把订单委托下单的时间以及下单量准确关联到成交记录中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;393:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;计算股票延时成交订单因子的步骤为，首先根据成交表的买卖单号与委托表的订单委托号建立连接，并计算改订单的累计延时成交次数和订单的累计成交量；其次通过自定义函数，计算股票的延时成交订单数以及延时成交的订单量。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-逐笔委托数据的因子计算&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;395:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;395:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.3. 逐笔委托数据的因子计算&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;395:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;397:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;Level-2 行情逐笔委托数据包含所有的委托订单信息（除了上交所的市价单（即时成交）和部分撤单，深交所的撤单），本节根据买卖订单的委托信息，计算深交所股票的委买委卖金额和撤单金额指标数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;399:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;逐笔委托数据数据样例如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/3_13.png&#34; width=&#34;400&#34; xtrc=&#34;image:24;401:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;658&#34; dita-ot:image-height=&#34;233&#34;/&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;331-委买委卖金额&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.3.1. 委买委卖金额&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;405:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;委托买卖金额是对一段时间内委托订单的买卖方向的资金总量进行统计。由于深交所的市价订单的价格在逐笔委托表里的价格不是一个成交价格（一般标记为0）。因此统计计算委托金额时，我们需要在逐笔成交记录中找到最近的成交价格来作为其近似值。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;defg calcSZOrderValue(side,price,orderQty,tradePrice,orderType,bsFlag){ price_=iif(orderType ==&#34;50&#34;,price,NULL).nullFill(tradePrice) return sum(iif(side==bsFlag,price_*orderQty,NULL)).nullFill(0) } res=select calcSZOrderValue(side,price,orderQty,tradePrice,orderType,&#34;B&#34;) as BuyOrderValue, calcSZOrderValue(side,price,orderQty,tradePrice,orderType,&#34;S&#34;) as SellOrderValue from aj(entrustTB,tradeTB,`SecurityID`ApplSeqNum) group by SecurityID,bar(DateTime,1m) as DateTime&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;417:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;这里通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;417:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;aj&lt;/codeph&gt; （asof join）把逐笔成交里的最新价格关联到逐笔成交中；对市价订单，以获取最新的成交价格作为当前市价委托单的委托价格，最后计算股票每分钟内的买卖委托金额。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;332-买卖撤单金额&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;3.3.2. 买卖撤单金额&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;深交所的撤单标记记录在逐笔成交表中，撤单时的价格一般标记为0，而委托价格记录在逐笔委托表中，因此计算买卖方撤单金额时需要将逐笔成交表和逐笔委托表进行关联。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;trade = select SecurityID,DateTime, max(BidApplSeqNum,OfferApplSeqNum) as ApplSeqNum,TradeQty from tradeTB where ExecType=52 entrust = select SecurityID,ApplSeqNum, Price,Side from entrustTB res = select sum(iif(side==&#34;B&#34;,Price*TradeQty,NULL)).nullFill(0) as buywithdrawOrderValue, sum(iif(side==&#34;S&#34;,Price*TradeQty,NULL)).nullFill(0) as sellwithdrawOrderValue from lsj(trade,entrust,`SecurityID`ApplSeqNum) group by SecurityID,bar(DateTime,1m) as DateTime&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;431:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;这里通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;431:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;lj&lt;/codeph&gt;（left join)分别把买卖撤单的委托价格关联到撤单信息表中，然后计算每只股票每分钟的买卖撤单金额。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-基于-level-2-实时行情数据的流式实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;433:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;433:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;4. 基于 Level-2 实时行情数据的流式实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;433:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;本章节介绍基于 DolphinDB 实时计算 Level-2 的行情数据。DolphinDB 的计算引擎不仅可以用于量化金融基于历史数据的批量开发计算，也大量用于生产环境的实时计算。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-快照实时行情数据的高频因子流批一体实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;4.1. 快照实时行情数据的高频因子流批一体实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;DolphinDB 的响应式状态引擎（Reactive State Engine），接收一个在历史数据上经过验证的 DolphinDB 因子代码，应用于实时行情数据，输出实时因子值，实现了高频因子流批一体的解决方案。具体教程请参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;reactive_state_engine.md&#34; xtrc=&#34;xref:2;439:116&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 响应式状态引擎介绍&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;如上“快照数据的因子计算”节中基于快照历史行情数据计算的时间加权订单斜率、成交价加权净委买比例、十档委买增额和十档买卖委托均价线性回归斜率因子表达式，将这些因子直接代入响应式状态引擎，以实现对流数据的实时因子计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;在基于历史数据批量计算加权平均订单失衡率因子的表达式中，在进行因子标准化处理时，使用了迭代的算法（当前标准差很小时，使用上一标准化的因子值），这类因子在流式计算时需要改为流式引擎计算支持的表达式。而其它的高频因子计算中没有涉及迭代算法，可以直接代入流式表达式进行实时因子计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;十档平均委卖订单斜率因子流式计算实现如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;447:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;@state def wavgSOIRStream(bidQty,askQty,lag=20){ Imbalance_=rowWavg((bidQty-askQty)\(bidQty+askQty), 10 9 8 7 6 5 4 3 2 1) Imbalance= ffill(Imbalance_).nullFill(0) mean = mavg(prev(Imbalance), (lag-1), 2) std = mstdp(prev(Imbalance) *1000000, (lag-1),2) \ 1000000 factorValue = conditionalIterate(std &amp;gt;= 0.0000001, (Imbalance - mean) \ std, cumlastNot) return ffill(factorValue).nullFill(0) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;把批计算中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;461:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt; iif(std &amp;gt;= 0.0000001,(Imbalance - mean) \ std, NULL)&lt;/codeph&gt; 改为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;461:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;conditionalIterate(std &amp;gt;= 0.0000001,(Imbalance - mean) \ std, cumlastNot)&lt;/codeph&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;conditionalIterate&lt;/codeph&gt; 函数只适用于响应式状态引擎，通过条件迭代实现因子中的递归逻辑。假设该函数计算结果对应输出表的列为 factor，且迭代仅基于前一个值，对于第 k 条记录（k = 0, 1, 2 …），其计算逻辑为：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;cond[k] == true：factor[k] = trueValue&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;cond[k] == false：factor[k] = falseIterFunc(factor)[k-1]&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;基于Level-2 行情快照数据的高频因子流式计算脚本如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;470:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;metrics = array(ANY, 5) metrics[0]=&amp;lt;DateTime&amp;gt; metrics[1] = &amp;lt;timeWeightedOrderSlope(BidPrice[0],BidOrderQty[0],OfferPrice[0],OfferOrderQty[0],20)&amp;gt; metrics[2] =&amp;lt;level10_InferPriceTrend(BidPrice,OfferPrice,BidOrderQty,OfferOrderQty,60,20)&amp;gt; metrics[3] =&amp;lt;traPriceWeightedNetBuyQuoteVolumeRatio(BidPrice[0],BidOrderQty[0],OfferPrice[0],OfferOrderQty[0],TotalValueTrade,TotalVolumeTrade,20)&amp;gt; metrics[4] =&amp;lt;wavgSOIRStream( BidOrderQty,OfferOrderQty,20)&amp;gt; share streamTable(1:0, `SecurityID`DateTime`BidPrice`OfferPrice`BidOrderQty`OfferOrderQty`TotalValueTrade`TotalVolumeTrade, [STRING,TIMESTAMP,DOUBLE[],DOUBLE[],DOUBLE[],DOUBLE[],INT,INT]) as Streamdata result = table(1000:0, `SecurityID`DateTime`TimeWeightedOrderSlope`Level10_InferPriceTrend`TraPriceWeightedNetBuyQuoteVolumeRatio`height_Imbalance, [STRING,TIMESTAMP,DOUBLE,DOUBLE,DOUBLE,DOUBLE]) rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=Streamdata, outputTable=result, keyColumn=&#34;SecurityID&#34;) subscribeTable(tableName=`Streamdata, actionName=&#34;factors&#34;, handler=tableInsert{rse}) snapshotTB=select* from loadTable(&#34;dfs://TSDB_snapshot&#34;,&#34;snapshot&#34;) where date(TradeTime)=2022.04.14 and SecurityID in [`600000,`000001] data1=select SecurityID,TradeTime as DateTime,BidPrice,OfferPrice,BidOrderQty,OfferOrderQty,TotalValueTrade,TotalVolumeTrade from snapshotTB Streamdata.append!(data1) &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;489:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;流式计算输出结果展示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Level-2_stock_data_processing/4_1.png&#34; width=&#34;400&#34; xtrc=&#34;image:25;491:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;808&#34; dita-ot:image-height=&#34;260&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-延时成交订单因子的流式实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;493:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;493:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;4.2. 延时成交订单因子的流式实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;493:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;DolphinDB 内置的流计算引擎除了响应式状态引擎外，还有时间序列聚合引擎、横截面引擎、异常检测引擎和各种连接引擎。这些引擎均实现了数据表（table）的接口，因此使得多个引擎间的流水线处理变得异常简单。只要将后一个引擎作为前一个引擎的输出即可。引入流水线处理，可以解决更为复杂的因子计算问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;497:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;本节通过流数据引擎的级联构建计算模型，以实现实时计算延时成交订单因子,详细代码见附件。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;421-实现思路&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;4.2.1. 实现思路&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;501:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;整体计算流程如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/stk_data_proc_1.png&#34; width=&#34;400&#34; xtrc=&#34;image:26;503:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34; dita-ot:image-width=&#34;1693&#34; dita-ot:image-height=&#34;1276&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;505:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;涉及到的流数据引擎有：左半等值连接引擎、响应式状态引擎和时间序列引擎。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;流程说明：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;左半等值连接引擎，把逐笔成交与逐笔委托数据关联，并计算延时成交订单的累计值和订单累计成交量；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;510:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;用响应式状态引擎，计算每只股票延时订单因子和延时订单成交量；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;511:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;用时间序列引擎 获取最新一分钟的延时订单因子和延时订单成交量，并输出结果。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;各引擎间直接级联，无需通过中间表。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;422-实时计算延时成交订单因子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;4.2.2. 实时计算延时成交订单因子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;517:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;517:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;517:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;第一步：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;519:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;tradeTable 和 entrustTable 分别为逐笔成交表和逐笔委托流数据表。通过创建两个左半等值连接引擎把两个表基于买卖订单进行等值关联。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;521:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;metrics = [ &amp;lt;tradeTable.DateTime&amp;gt;, &amp;lt;entrustTable.DateTime&amp;gt;, &amp;lt;TradePrice&amp;gt;, &amp;lt;TradeQty&amp;gt;, &amp;lt;cumsum(iif((tradeTable.DateTime-entrustTable.DateTime)&amp;gt;60000,1,0)) as DelayedTraderflag&amp;gt;, &amp;lt;Side&amp;gt;, &amp;lt;cumsum(TradeQty)&amp;gt;] lsjEngineBid=createLeftSemiJoinEngine(&#34;lsjEngineBid&#34;, tradeTable, entrustTable, lsjoutput, metrics,[[`SecurityID,`BidApplSeqNum],[`SecurityID,`ApplSeqNum]],50000000,true) subscribeTable(tableName=&#34;tradeTable&#34;, actionName=&#34;Bid&#34;, offset=0, handler=appendForJoin{lsjEngineBid, true}, msgAsTable=true) subscribeTable(tableName=&#34;entrustTable&#34;, actionName=&#34;Bid&#34;, offset=0, handler=appendForJoin{lsjEngineBid, false}, msgAsTable=true) lsjEngineOffer=createLeftSemiJoinEngine(&#34;lsjEngineOffer&#34;, tradeTable, entrustTable, lsjoutput, metrics,[[`SecurityID,`OfferApplSeqNum],[`SecurityID,`ApplSeqNum]],50000000,true) subscribeTable(tableName=&#34;tradeTable&#34;, actionName=&#34;Offer&#34;, offset=0, handler=appendForJoin{lsjEngineOffer, true}, msgAsTable=true) subscribeTable(tableName=&#34;entrustTable&#34;, actionName=&#34;Offer&#34;, offset=0, handler=appendForJoin{lsjEngineOffer, false}, msgAsTable=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;539:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;左半等值连接引擎返回一个左、右表关联后的表对象。对于左表每一条数据，都去匹配右表相同 matchingColumn 的数据，若无匹配的右表记录，则不输出。若匹配多条右表记录，则由 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;539:95&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;updateRightTable&lt;/i&gt; 参数决定连接右表的第一条记录还是最后一条记录。&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;539:137&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;updateRightTable&lt;/i&gt; 为可选参数，默认为 false，表示右表存在多条相同 matchingColumn 的记录时，是保留第一条（false）还是最后一条记录（true）。这里订单成交时间需要与订单的最早委托时间关联，所以 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;539:257&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;updateRightTable&lt;/i&gt; 取默认值即可。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;541:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;metrics 中计算订单的成交量、订单的累计成交量，成交时间和委托时间差是否大于1分钟的累计次数和订单的买卖方向等指标。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;543:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;543:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;第二步：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;545:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;通过响应式状态引擎，计算每一只股票的买卖延时订单数量和买卖延时订单成交量指标。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;547:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;@state def delayedTradeNum(bsFlag, flag, side){ return iif(bsFlag==side &amp;amp;&amp;amp; flag&amp;lt;=1, flag, 0).cumsum() } @state def delayedTradeQty(bsFlag, flag, tradeQty, cumTradeQty, side){ return iif(bsFlag==side &amp;amp;&amp;amp; flag&amp;gt;1, tradeQty, iif(bsFlag==side &amp;amp;&amp;amp; flag==1, cumTradeQty, 0)).cumsum() } metrics = array(ANY, 5) metrics[0]=&amp;lt;TradeTime&amp;gt; metrics[1]=&amp;lt;delayedTradeNum(BuySellFlag,DelayedTradeFlag,&#34;B&#34;)&amp;gt; metrics[2]=&amp;lt;delayedTradeNum(BuySellFlag,DelayedTradeFlag,&#34;S&#34;)&amp;gt; metrics[3]=&amp;lt;delayedTradeQty(BuySellFlag,DelayedTradeFlag,TradeQty,cumTradeQty,&#34;B&#34;)&amp;gt; metrics[4]=&amp;lt;delayedTradeQty(BuySellFlag,DelayedTradeFlag,TradeQty,cumTradeQty,&#34;S&#34;)&amp;gt; secondrse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=lsjoutput, outputTable=RSEresult, keyColumn=[&#34;code&#34;],filter=&amp;lt;TradePrice&amp;gt;0&amp;gt;) subscribeTable(tableName=`lsjoutput, actionName=&#34;DelayedTrader&#34;, handler=tableInsert{secondrse})&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;568:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;DelayedTradeFlag 指标为订单延时成交累计记录。统计股票的延时订单数时，对每笔订单只需统计一次，计算股票的延时成交订单数只需计算 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;568:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;iif(bsFlag==side&amp;amp;&amp;amp;flag&amp;lt;=1,flag,0)&lt;/codeph&gt; 的累计值。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;570:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;iif((BuySellFlag==&#34;B&#34;)&amp;amp;&amp;amp;(DelayedTraderFlag&amp;gt;1),TradeQty,iif((BuySellFlag==&#34;B&#34;)&amp;amp;&amp;amp;(DelayedTraderFlag==1),DelayedTraderFlag*cumTradeQty,0))&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;574:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;使用订单延时成交累计记录指标 DelayedTradeFlag 来计算延时订单的成交量。当首次记录为延时成交时，成交量为订单的累计成交量，当 DelayedTradeFlag&amp;gt;1 时，成交量只需加上当前的交易量。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;576:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;576:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;第三步：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;578:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;通过时间序列引擎引擎，计算每一分钟每只股票最新的买卖延时订单数量和买卖延时订单成交量指标。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;580:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;tsengine = createTimeSeriesEngine(name=&#34;TSengine&#34;, windowSize=60000, step=60000, metrics=&amp;lt;[last(DelayedTradeBuyOrderNum),last(DelayedTradeSellOrderNum),last(DelayedTradeBuyOrderQty),last(DelayedTradeSellOrderQty)]&amp;gt;, dummyTable=RSEresult, outputTable=result, timeColumn=`TradeTime, useSystemTime=false, keyColumn=`code, garbageSize=50, useWindowStartTime=false) subscribeTable(tableName=&#34;RSEresult&#34;, actionName=&#34;TSengine&#34;, offset=0, handler=append!{tsengine}, msgAsTable=true);&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-附件&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:28;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:28;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;5. 附件&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:28;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;588:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;588:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;快照批处理脚本： &lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/Level-2_stock_data_processing/shapshot数据处理.dos&#34; xtrc=&#34;xref:3;588:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;?ditaot usertext?&gt;shapshot数据处理.dos&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;589:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;逐笔数据批计算脚本： &lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/Level-2_stock_data_processing/entrust数据处理.dos&#34; xtrc=&#34;xref:4;589:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;?ditaot usertext?&gt;entrust数据处理.dos&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;590:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;成交表数据批计算脚本： &lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/Level-2_stock_data_processing/trade数据处理.dos&#34; xtrc=&#34;xref:5;590:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;?ditaot usertext?&gt;trade数据处理.dos&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;591:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;快照流式计算脚本： &lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/Level-2_stock_data_processing/shapshot数据流式计算.dos&#34; xtrc=&#34;xref:6;591:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;?ditaot usertext?&gt;shapshot数据流式计算.dos&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;592:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;延时订单因子流式实现： &lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/Level-2_stock_data_processing/延时订单因子流式实现.dos&#34; xtrc=&#34;xref:7;592:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;?ditaot usertext?&gt;延时订单因子流式实现.dos&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;593:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;与python性能比对： &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;script/Level-2_stock_data_processing/与python性能比对&#34; xtrc=&#34;xref:8;593:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;?ditaot usertext?&gt;与python性能比对&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;594:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;python实现脚本： &lt;xref class=&#34;- topic/xref &#34; format=&#34;py&#34; href=&#34;script/Level-2_stock_data_processing/python实现脚本.py&#34; xtrc=&#34;xref:9;594:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/l2_stk_data_proc.md&#34;&gt;&lt;?ditaot usertext?&gt;python实现脚本.py&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/l2_stk_data_proc.md"/><meta name="wh-out-relpath" content="tutorials/l2_stk_data_proc_2.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="处理-level-2-行情数据实例" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/OHLC_2.html">金融场景案例</a></div></div></li><li class="active"><div class="topicref" data-id="处理-level-2-行情数据实例"><div class="title"><a href="../tutorials/l2_stk_data_proc_2.html">处理 Level-2 行情数据实例</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="k-线计算-d9713e102569" class="topicref" data-id="k-线计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="k-线计算-d9713e102569-link">K 线计算</a></div></div></li><li role="treeitem"><div data-tocid="使用-klinechart-展示-dolphindb-k-线-d9713e102615" class="topicref" data-id="使用-klinechart-展示-dolphindb-k-线" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/displaying_the_dolphindb_k-line_with_klinechart.html" id="使用-klinechart-展示-dolphindb-k-线-d9713e102615-link">使用 KLineChart 展示 DolphinDB K 线</a></div></div></li><li role="treeitem"><div data-tocid="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661" class="topicref" data-id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_HDF5_vs_DolphinDB.html" id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661-link">Python + HDF5 因子计算与 DolphinDB 一体化因子计算方案对比</a></div></div></li><li role="treeitem"><div data-tocid="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707" class="topicref" data-id="python--文件存储与-dolphindb-因子计算性能比较" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_VS_PythonFile_Storage.html" id="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707-link">Python + 文件存储与 DolphinDB 因子计算性能比较</a></div></div></li><li role="treeitem"><div data-tocid="python-parser-在金融量化分析场景的应用入门-d9713e102753" class="topicref" data-id="python-parser-在金融量化分析场景的应用入门" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/py_parser__quant_fin.html" id="python-parser-在金融量化分析场景的应用入门-d9713e102753-link">Python Parser 在金融量化分析场景的应用入门</a></div></div></li><li role="treeitem" class="active"><div data-tocid="处理-level-2-行情数据实例-d9713e102799" class="topicref" data-id="处理-level-2-行情数据实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_stk_data_proc_2.html" id="处理-level-2-行情数据实例-d9713e102799-link">处理 Level-2 行情数据实例</a></div></div></li><li role="treeitem"><div data-tocid="存储金融数据的分区方案最佳实践-d9713e102845" class="topicref" data-id="存储金融数据的分区方案最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_partitioned_storage.html" id="存储金融数据的分区方案最佳实践-d9713e102845-link">存储金融数据的分区方案最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="公募基金历史数据基础分析教程-d9713e102891" class="topicref" data-id="公募基金历史数据基础分析教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/public_fund_basic_analysis.html" id="公募基金历史数据基础分析教程-d9713e102891-link">公募基金历史数据基础分析教程</a></div></div></li><li role="treeitem"><div data-tocid="股票行情回放-d9713e102937" class="topicref" data-id="股票行情回放" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_market_replay_2.html" id="股票行情回放-d9713e102937-link">股票行情回放</a></div></div></li><li role="treeitem"><div data-tocid="搭建行情回放服务的最佳实践-d9713e102983" class="topicref" data-id="搭建行情回放服务的最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/appendices_market_replay_bp.html" id="搭建行情回放服务的最佳实践-d9713e102983-link">搭建行情回放服务的最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="国内股票行情数据导入实例-d9713e103029" class="topicref" data-id="国内股票行情数据导入实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stockdata_csv_import_demo.html" id="国内股票行情数据导入实例-d9713e103029-link">国内股票行情数据导入实例</a></div></div></li><li role="treeitem"><div data-tocid="基金份额参考价值-iopv-计算-d9713e103076" class="topicref" data-id="基金份额参考价值-iopv-计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_IOPV_2.html" id="基金份额参考价值-iopv-计算-d9713e103076-link">基金份额参考价值 IOPV 计算</a></div></div></li><li role="treeitem"><div data-tocid="基于快照行情的股票和基金-k-线合成-d9713e103122" class="topicref" data-id="基于快照行情的股票和基金-k-线合成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k.html" id="基于快照行情的股票和基金-k-线合成-d9713e103122-link">基于快照行情的股票和基金 K 线合成</a></div></div></li><li role="treeitem"><div data-tocid="计算基金日频因子-d9713e103168" class="topicref" data-id="计算基金日频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/fund_factor_contrasted_by_py.html" id="计算基金日频因子-d9713e103168-link">计算基金日频因子</a></div></div></li><li role="treeitem"><div data-tocid="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214" class="topicref" data-id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/orderBookSnapshotEngine.html" id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214-link">基于逐笔数据合成高频 Orderbook：DolphinDB Orderbook 引擎</a></div></div></li><li role="treeitem"><div data-tocid="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260" class="topicref" data-id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/LoadDataForPoc.html" id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260-link">金融 PoC 用户历史数据导入指导手册之股票 Level-2 逐笔篇</a></div></div></li><li role="treeitem"><div data-tocid="金融实时实际波动率预测-d9713e103306" class="topicref" data-id="金融实时实际波动率预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ml_volatility_2.html" id="金融实时实际波动率预测-d9713e103306-link">金融实时实际波动率预测</a></div></div></li><li role="treeitem"><div data-tocid="金融因子流式实现-d9713e103352" class="topicref" data-id="金融因子流式实现" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/str_comp_fin_quant_2.html" id="金融因子流式实现-d9713e103352-link">金融因子流式实现</a></div></div></li><li role="treeitem"><div data-tocid="开发股票波动率预测模型的-676-个输入特征-d9713e103398" class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/metacode_derived_features_2.html" id="开发股票波动率预测模型的-676-个输入特征-d9713e103398-link">开发股票波动率预测模型的 676 个输入特征</a></div></div></li><li role="treeitem"><div data-tocid="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444" class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_snapshot_factor_calc_2.html" id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444-link">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="量化金融范例-d9713e103490" class="topicref" data-id="量化金融范例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/quant_finance_examples.html" id="量化金融范例-d9713e103490-link">量化金融范例</a></div></div></li><li role="treeitem"><div data-tocid="流式计算中证-1000-指数主买主卖交易量-d9713e103536" class="topicref" data-id="流式计算中证-1000-指数主买主卖交易量" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/CSI_1000_2.html" id="流式计算中证-1000-指数主买主卖交易量-d9713e103536-link">流式计算中证 1000 指数主买/主卖交易量</a></div></div></li><li role="treeitem"><div data-tocid="深度不平衡买卖压力指标波动率计算-d9713e103583" class="topicref" data-id="深度不平衡买卖压力指标波动率计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/sql_performance_optimization_wap_di_rv.html" id="深度不平衡买卖压力指标波动率计算-d9713e103583-link">深度不平衡、买卖压力指标、波动率计算</a></div></div></li><li role="treeitem"><div data-tocid="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629" class="topicref" data-id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/insight_plugin_orderbook_engine_application.html" id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629-link">实时合成自定义频订单簿快照：DolphinDB INSIGHT 行情插件与订单簿引擎应用</a></div></div></li><li role="treeitem"><div data-tocid="实时计算分钟资金流-d9713e103675" class="topicref" data-id="实时计算分钟资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_order_by_order_2.html" id="实时计算分钟资金流-d9713e103675-link">实时计算分钟资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算高频因子-d9713e103721" class="topicref" data-id="实时计算高频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hf_factor_streaming_2.html" id="实时计算高频因子-d9713e103721-link">实时计算高频因子</a></div></div></li><li role="treeitem"><div data-tocid="实时计算日累计逐单资金流-d9713e103767" class="topicref" data-id="实时计算日累计逐单资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_daily_2.html" id="实时计算日累计逐单资金流-d9713e103767-link">实时计算日累计逐单资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算涨幅榜-d9713e103813" class="topicref" data-id="实时计算涨幅榜" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/rt_stk_price_inc_calc_2.html" id="实时计算涨幅榜-d9713e103813-link">实时计算涨幅榜</a></div></div></li><li role="treeitem"><div data-tocid="实时选取外汇行情多价源最优价-d9713e103859" class="topicref" data-id="实时选取外汇行情多价源最优价" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_price_selection.html" id="实时选取外汇行情多价源最优价-d9713e103859-link">实时选取外汇行情多价源最优价</a></div></div></li><li role="treeitem"><div data-tocid="外汇掉期估值计算-d9713e103905" class="topicref" data-id="外汇掉期估值计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/FxSwapValuation.html" id="外汇掉期估值计算-d9713e103905-link">外汇掉期估值计算</a></div></div></li><li role="treeitem"><div data-tocid="因子计算平台构建-d9713e103951" class="topicref" data-id="因子计算平台构建" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_Celery.html" id="因子计算平台构建-d9713e103951-link">因子计算平台构建</a></div></div></li><li role="treeitem"><div data-tocid="因子计算最佳实践-d9713e103997" class="topicref" data-id="因子计算最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_factor_calculation.html" id="因子计算最佳实践-d9713e103997-link">因子计算最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="mvo_tutorial-d9713e104043" class="topicref" data-id="mvo_tutorial" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/MVO.html" id="mvo_tutorial-d9713e104043-link">优化投资组合：DolphinDB 最优化求解系列函数应用指南</a></div></div></li><li role="treeitem"><div data-tocid="中高频多因子库存储最佳实践-d9713e104090" class="topicref" data-id="中高频多因子库存储最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_multi_factor.html" id="中高频多因子库存储最佳实践-d9713e104090-link">中高频多因子库存储最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136" class="topicref" data-id="alphalens-在-dolphindb-中的应用因子分析建模实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Practical_Factor_Analysis_Modeling.html" id="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136-link">Alphalens 在 DolphinDB 中的应用：因子分析建模实践</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-dolphinscheduler-的集成-d9713e104182" class="topicref" data-id="dolphindb-与-dolphinscheduler-的集成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="dolphindb-与-dolphinscheduler-的集成-d9713e104182-link">DolphinDB 与 DolphinScheduler 的集成</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-python-airflow-最佳实践-d9713e104228" class="topicref" data-id="dolphindb-与-python-airflow-最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_airflow.html" id="dolphindb-与-python-airflow-最佳实践-d9713e104228-link">DolphinDB 与 Python AirFlow 最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="gplearn-d9713e104274" class="topicref" data-id="gplearn" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/gplearn.html" id="gplearn-d9713e104274-link">Shark GPLearn 快速上手</a></div></div></li><li role="treeitem"><div data-tocid="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320" class="topicref" data-id="利用jit加速计算-etf-期权隐含波动率和希腊值" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/IV_Greeks_Calculation_for_ETF_Options_Using_JIT.html" id="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320-link">利用JIT加速计算 ETF 期权隐含波动率和希腊值</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366" class="topicref" data-id="基于-dolphindb-的-brinson-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/brinson.html" id="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366-link">基于 DolphinDB 的 Brinson 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412" class="topicref" data-id="基于-dolphindb-的-campisi-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/campisi.html" id="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412-link">基于 DolphinDB 的 Campisi 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="期货分钟频cta策略回测案例-d9713e104458" class="topicref" data-id="期货分钟频cta策略回测案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/futures_minute_frequency_cta_strategy_backtest_example.html" id="期货分钟频cta策略回测案例-d9713e104458-link">期货分钟频CTA策略回测案例</a></div></div></li><li role="treeitem"><div data-tocid="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504" class="topicref" data-id="exchdata-交易所历史股票数据自动化导入功能模块使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/exchdata_exchange_historical_stock_data_auto_import_module_tutorial.html" id="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504-link">ExchData 交易所历史股票数据自动化导入功能模块使用教程</a></div></div></li><li role="treeitem"><div data-tocid="ficc_func_uasge_and_performance-d9713e104550" class="topicref" data-id="ficc_func_uasge_and_performance" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_func_uasge_and_performance.html" id="ficc_func_uasge_and_performance-d9713e104550-link">FICC 固收系列函数使用示例及性能</a></div></div></li><li role="treeitem"><div data-tocid="title1-d9713e104597" class="topicref" data-id="title1" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_funcs_application.html" id="title1-d9713e104597-link">FICC 固收系列函数应用场景</a></div></div></li><li role="treeitem"><div data-tocid="最优化函数_socp_的使用及转化案例-d9713e104643" class="topicref" data-id="最优化函数_socp_的使用及转化案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/socp_usage_case.html" id="最优化函数_socp_的使用及转化案例-d9713e104643-link">最优化函数 socp 的使用及转化案例</a></div></div></li><li role="treeitem"><div data-tocid="k_line_calculation-d9713e104689" class="topicref" data-id="k_line_calculation" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k_line_calculation%20.html" id="k_line_calculation-d9713e104689-link">基于期货快照行情数据计算合约 K 线以及主连行情</a></div></div></li><li role="treeitem"><div data-tocid="backtest_introduction_usage-d9713e104735" class="topicref" data-id="backtest_introduction_usage" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backtest_introduction_usage.html" id="backtest_introduction_usage-d9713e104735-link">融资融券策略回测使用说明及回测案例</a></div></div></li><li role="treeitem"><div data-tocid="stock_backtest-d9713e104781" class="topicref" data-id="stock_backtest" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_backtest.html" id="stock_backtest-d9713e104781-link">股票中低频投资组合回测案例实现</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">处理 Level-2 行情数据实例</h1><div class="- topic/body body"><p class="- topic/p p">Level-2 高频行情数据包含大量有价值的信息，利用这些数据生成交易信号和获取收益已经成为量化研究中的一种主流策略。作为一个高性能时序数据库，DolphinDB 非常适合存储、处理 GB 级别甚至 PB 级别的海量数据集，包括 Level-2 高频行情数据的存储、因子计算、建模、回测和实盘交易等。</p><p class="- topic/p p">本文基于国内 A 股市场 Level-2 高频行情数据的特点来展示高频行情数据存储和因子计算实例。根据历史批量因子计算、实时因子计算两个场景，以及针对不同的高频数据源，本文总结出了在 DolphinDB 中处理 Level-2 行情数据实例。</p><p class="- topic/p p">本文涉及的脚本见附件，DolphinDB server 版本为 2.00.9。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-level-2-行情数据介绍"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. Level-2 行情数据介绍</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="11-数据概况"><h3 class="- topic/title title topictitle3" id="ariaid-title3">1.1. 数据概况</h3><div class="- topic/body body"><p class="- topic/p p">Level-2 行情数据是目前国内证券市场上最为完整，颗粒度最为精细的交易信息数据。其涵盖了在沪深两市上市的股票、可交易型基金、沪深交易所指数等大量品种。</p><p class="- topic/p p">Level-2 行情数据分类表如下:</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="11-数据概况__entry__1">数据类型</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="11-数据概况__entry__2">数据频率</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__1">分钟 K 线</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__2">1分钟</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__1">盘口快照</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__2">3秒</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__1">委托队列</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__2">3秒</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__1">逐笔成交</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__2">0.01秒</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__1">逐笔委托</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="11-数据概况__entry__2">0.01秒</td></tr></tbody></table></div><p class="- topic/p p">分钟K线：即当日全天的分钟K线行情。相比传统K线，包含了分钟成交笔数信息。</p><p class="- topic/p p">盘口快照：即常用的每3秒一个切片的十档委托行情。其中，也包括该时刻的委托总量和平均委托价格信息。</p><p class="- topic/p p">委托队列：即买一、卖一的总委托单数，以及前50笔委托的明细信息。</p><p class="- topic/p p">成交明细：即两个3秒快照之间，详细的逐笔成交与逐笔委托信息。</p><p class="- topic/p p">需要注意的是，沪深交易所的 Level-2 行情数据存在一定的差异，主要体现在成交明细数据方面。深交所的逐笔成交数据中，包括了逐笔委托数据，其中有详细的挂撤单信息，和标记为撤单的逐笔成交。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="12-数据结构"><h3 class="- topic/title title topictitle3" id="ariaid-title4">1.2. 数据结构</h3><div class="- topic/body body"><p class="- topic/p p">上交所提供的1分钟数据是 Level-2 行情数据中数据字段最少、频率最低的数据。其主要包含昨日收盘价、开盘价、最高价、最低价、收盘价、成交量和成交额等数据。</p><p class="- topic/p p">A股票行情快照数据每3秒钟记录一次，包括前后两个时刻的盘口变化数据。每天的数据量约为15G。</p><p class="- topic/p p">股票行情快照数据原始字段说明对照表（表中的空字段，说明当前市场的行情数据中没有该字段）</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__1">深交所数据</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__2">上交所数据</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__3">字段含义</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">security_id</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">SecurityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">证券代码</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">orig_time</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">DateTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">时间戳：2021-03-01 12:45:00.000</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">preclose_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">PreClosePx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">昨日收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">open_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">OpenPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">开盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">high_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">HighPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">最高价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">low_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">LowPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">最低价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">last_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">LastPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">up_limit_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">涨停</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">down_limit_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">跌停</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">trading_phase_code</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">InstrumentStatus</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">交易状态</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">num_trades</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">NumTrades</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">成交笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">total_volume_trade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">TotalVolumeTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">成交总量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">total_value_trade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">TotalValueTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">成交总金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">total_bid_qty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">TotalBidQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">委托买入总量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">total_offer_qty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">TotalOfferQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">委托卖出总量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">WithdrawBuyNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">买入撤单笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">WithdrawSellNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">卖出撤单笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">WithdrawBuyAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">买入撤单数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">WithdrawSellAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">卖出撤单数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">WithdrawBuyMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">买入撤单金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1"> </td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">WithdrawSellMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">卖出撤单金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">weighted_avg_bid_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">WeightedAvgBidPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">加权平均委买价格</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">bid_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">BidPrice[10]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">委买价格10</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">offer_px</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">OfferPrice[10]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">委卖价格10</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">bid_size</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">BidOrderQty[10]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">买10量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">offer_size</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">OfferOrderQty[10]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">卖10量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">order_qty_b1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">BidOrders[50]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">委买订单50</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">order_qty_s1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">OfferOrders[50]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">委卖订单50</td></tr></tbody></table></div><p class="- topic/p p">股票逐笔委托数据记录的最小时间间隔为0.01秒，每个0.01秒内有可能有多笔委托，Level-2 行情数据对0.01秒内的委托时点进行模糊处理，不进行区分。 股票逐笔委托数据的单日数据量在 12GB 左右，由于交易活跃度不同，不同标的之间的单日数据量会有很大差异。</p><p class="- topic/p p">股票逐笔委托原始数据字段说明对照表（表中的空字段，说明当前市场的行情数据中没有该字段）</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="12-数据结构__entry__88">深交所数据</th><th class="- topic/entry entry colsep-0 rowsep-0" id="12-数据结构__entry__89">上交所数据</th><th class="- topic/entry entry colsep-0 rowsep-0" id="12-数据结构__entry__90">字段含义</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">SecurityID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">SecurityID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">证券代码</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">OrigTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">TransactTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">时间戳：2021-03-01 12:45:00.000</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">Price</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">Price</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">委托价格</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">OrderQty</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">Balance</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">委托数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">Side</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">OrderBSFlag</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">买卖方向：沪市为B – 买单；S – 卖深市为1 - 买；2 - 卖</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">OrderNo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">委托订单号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">ApplSeqNum</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">委托索引（仅深交所）</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">ChannelNo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">ChannelNo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">频道代码</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88">OrderType</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">OrdType</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">委托类别：沪市为A – 委托订单（增加）；D – 委托订单（删除）深市为1-市价；2-限价；U - 本方最优</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">BizIndex</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">业务序列号，与逐笔成交统一编号，从 1 开始按 Channel 连续</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__88"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__89">OrderIndex</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__90">委托序号， NUMBER 从 1 开始，按 Channel 连续</td></tr></tbody></table></div><p class="- topic/p p">与股票逐笔委托数据相似，股票逐笔成交数据记录了股票交易的每一笔成交信息。每笔成交包含价格、成交量、成交金额、成交时间等信息。单日数据量在 6GB 左右，与不同标的的交易活跃度有关。</p><p class="- topic/p p">股票逐笔成交数据原始字段说明对照表（表中的空字段，说明当前市场的行情数据中没有该字段）</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="12-数据结构__entry__124">深交所数据</th><th class="- topic/entry entry colsep-0 rowsep-0" id="12-数据结构__entry__125">上交所数据</th><th class="- topic/entry entry colsep-0 rowsep-0" id="12-数据结构__entry__126">数据说明</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">SecurityID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">SecurityID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">证券代码</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">ExecType</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">TradeBSFlag</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">成交类别：沪市为B – 外盘，主动买；S – 内盘，主动卖；N – 未知深市为4 - 撤销；F - 成交</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">OrigTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">TradeTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">Price</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">TradePrice</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">成交价格</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">TradeQty</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">TradeQty</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">成交数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">TradeAmount</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">成交金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">BidApplSeqNum</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">BuyNo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">买方序号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">OfferApplSeqNum</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">SellNo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">卖方序号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">TradeIndex</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">成交序号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124"> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">BizIndex</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">业务序列号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__124">ChannelNo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__125">ChannelNo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="12-数据结构__entry__126">频道代码</td></tr></tbody></table></div></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title5" id="2-dolphindb-高效存储-level-2-行情数据"><h2 class="- topic/title title topictitle2" id="ariaid-title5">2. DolphinDB 高效存储 Level-2 行情数据</h2><div class="- topic/body body"><p class="- topic/p p">A股股票高频数据每日数据增量在30+G，基金债券等标的每日数据量在45+G。历史数据和每日增量数据数据量在 10TB 级别以上。面对如此庞大的数据量， 如何保证高效的数据写入、数据压缩和快速的数据查询计算是高频数据存储的一大挑战。</p><p class="- topic/p p">为解决这一挑战，我们将 DolphinDB 的存储特性组合使用，提供了灵活的存储解决方案。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="21-分区方案"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.1. 分区方案</h3><div class="- topic/body body"><p class="- topic/p p">为了实现行情数据的灵活分区存储，可以采用”时间+标的“的方式进行数据分区。DolphinDB 支持对不同分区数据进行多线程并行操作。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="22-分区内分组排序"><h3 class="- topic/title title topictitle3" id="ariaid-title7">2.2. 分区内分组排序</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 的 TSDB 引擎提供了排序键设置，可以为每个数据分区设置一个排序键，以便在数据随机读取时更准确地定位数据。例如，通过设置 SortColumn=[“SecurityID”, “TradeTime”]，数据可以按照 SecurityID 字段分组，并在每个组内按照时间字段 TradeTime 排序。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="23-level-2-行情数据存储方案"><h3 class="- topic/title title topictitle3" id="ariaid-title8">2.3. Level-2 行情数据存储方案</h3><div class="- topic/body body"><p class="- topic/p p">在上交所股票 Level-2 行情数据中，市价单信息只存储于逐笔成交表中，而逐笔委托表中没有市价单的记录，因此计算委托量和委托金额等指标时需要对两个表进行关联。在深交所 Level-2 行情数据中，逐笔委托表中的市价单价格标记为0；而撤单记录在逐笔成交表中，撤单记录中价格也标记为0；因此在计算委托金额、撤单金额等指标时都需要对两个表进行关联再计算。此外，在计算其他因子指标时，也需要对逐笔成交表和行情快照数据表进行关联。</p><p class="- topic/p p">根据业务需求，这里对沪深股票 Level-2 高频数据采用一库三表的建库建表方案，即把两个交易所相同的行情数据存入同一张表，使用 market 字段标识不同的交易所，且将 market 设置在索引列（SortColumn）中。</p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-level-2-行情数据存储方案__entry__1">数据源</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-level-2-行情数据存储方案__entry__2">数据量</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-level-2-行情数据存储方案__entry__3">分区方案（组合分区）</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-level-2-行情数据存储方案__entry__4">库、表名称</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-level-2-行情数据存储方案__entry__5">SortColumn 字段</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__1">行情快照</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__2">15G+</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__3">交易日按值分区+标的哈希20分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__4">"dfs://level_2"，"snapshot"</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__5">market，SecurityID，TradeTime</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__1">逐笔委托</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__2">11G+</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__3">交易日值分区+标的哈希20分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__4">"dfs://level_2"，"entrust"</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__5">market，SecurityID，TradeTime</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__1">逐笔成交</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__2">6G+</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__3">交易日值分区+标的哈希20分区</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__4">"dfs://level_2"，"trade"</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-level-2-行情数据存储方案__entry__5">market，SecurityID，TradeTime</td></tr></tbody></table></div><p class="- topic/p p">库表创建之后，数据的导入教程可以参考 DolphinDB 的数据导入相关教程，如<a class="- topic/xref xref" href="LoadDataForPoc.html">金融 PoC 用户历史数据导入指导手册之股票 level2 逐笔篇</a>。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title9" id="3-基于历史数据的批量因子计算"><h2 class="- topic/title title topictitle2" id="ariaid-title9">3. 基于历史数据的批量因子计算</h2><div class="- topic/body body"><p class="- topic/p p">本章节介绍 DolphinDB 对 Level-2 行情数据的处理。DolphinDB 不仅提供了高速存取时序数据的基本功能，还内置了向量化的多范式编程语言和强大的计算引擎，可高效用于量化金融的因子开发，包括基于历史数据的批量高频因子计算和基于实时 Level-2 行情的流式计算。</p><p class="- topic/p p">本章基于 Level-2 历史行情数据中的行情快照、逐笔成交和逐笔委托中的几个高频因子，介绍 DolphinDB 向量化的多范式编程语言的强大功能。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="31-快照数据的因子计算"><h3 class="- topic/title title topictitle3" id="ariaid-title10">3.1. 快照数据的因子计算</h3><div class="- topic/body body"><p class="- topic/p p">Level-2 行情快照数据包含 10 档价位上的委卖价格、委托量和委托买卖总量等指标，主要用于分析订单簿所提供的信息。</p><p class="- topic/p p">行情快照中的大部分高频因子基于限价订单簿的静态指标，例如价差、深度、宽度、斜率、订单不平衡等，研究市场的交易行为，进而预测股票的短期价格走势。</p><p class="- topic/p p">本节介绍基于 Level-2 行情快照中十档买卖价格和买卖数量数据计算的时间加权订单斜率、十档平均委卖订单斜率、成交价加权净委买比例、十档委买增额和十档买卖委托均价线性回归斜率等高频因子。</p><p class="- topic/p p">以下是 Level-2 行情快照数据十档部分字段的样例：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_1.png"/><br/></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="311-时间加权订单斜率"><h4 class="- topic/title title topictitle4" id="ariaid-title11">3.1.1. 时间加权订单斜率</h4><div class="- topic/body body"><p class="- topic/p p">订单斜率因子衡量订单价差对订单量差的敏感度。其计算公式如下：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_2.png"/><br/><p class="- topic/p p"><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_2_1.png" alt="logQuoteSlope_"/><br/>衡量 t 时刻的订单斜率。其中，<img class="- topic/image image" src="images/Level-2_stock_data_processing/3_2_2.png" alt="bid_"/><br/> 和 <img class="- topic/image image" src="images/Level-2_stock_data_processing/3_2_3.png" alt="ask"/><br/> 分别表示买一价和卖一价，<img class="- topic/image image" src="images/Level-2_stock_data_processing/3_2_4.png" alt="bidQty_"/><br/> 和<img class="- topic/image image" src="images/Level-2_stock_data_processing/3_2_5.png" alt="askQty_"/><br/> 分别表示买一量和卖一量。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code> @state
def timeWeightedOrderSlope(bid,bidQty,ask,askQty,lag=20){
	return (log(iif(ask==0,bid,ask))-log(iif(bid==0,ask,bid)))\(log(askQty)-log(bidQty)).ffill().mavg(lag, 1).nullFill(0)
}</code></pre><p class="- topic/p p">使用函数<code class="+ topic/ph pr-d/codeph ph codeph">mavg</code>计算过去 20 行的移动平均时间加权订单斜率，其中 <code class="+ topic/ph pr-d/codeph ph codeph">@state</code> 表示用户自定义的状态函数。状态算子计算时需要用到历史状态，DolphinDB 在流式计算中对自定义状态函数，通过增量的方式实现，性能有很大的提升。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title12" id="312-加权平均订单失衡率因子"><h4 class="- topic/title title topictitle4" id="ariaid-title12">3.1.2. 加权平均订单失衡率因子</h4><div class="- topic/body body"><p class="- topic/p p">订单失衡率（SOIR）因子衡量买卖委托量在总量中的不均衡程度。其计算公式如下：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_3.png"/><br/><p class="- topic/p p">表示 t时刻第 i 档的订单失衡率因子。其中 <img class="- topic/image image" src="images/Level-2_stock_data_processing/3_3_1.png" alt="bidQty_"/><br/> ，<img class="- topic/image image" src="images/Level-2_stock_data_processing/3_3_2.png" alt="askQty_{i,t}"/><br/> 表示第 i 档买方委托量和卖方委托量。为了充分利用各档数据信息，计算各档位加权和订单失衡率因子时，根据买卖压力的影响力赋予不同档位相应的权重。通常，靠近交易价格的档位被赋予更高的权重。计算公式如下：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_4.png"/><br/><p class="- topic/p p">SOIR 反应盘口各档综合的买卖委托量不均衡程度。如果 SOIR 为正，则说明市场买压大于卖压，未来价格趋势上涨的概率较高。此外，SOIR 值越大，上涨的概率越高，反之亦然。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def wavgSOIR(bidQty,askQty,lag=20){
	imbalance= rowWavg((bidQty - askQty)\(bidQty + askQty), 10 9 8 7 6 5 4 3 2 1).ffill().nullFill(0)
	mean = mavg(prev(imbalance), (lag-1), 2)
	std = mstdp(prev(imbalance) * 1000000, (lag-1), 2) \ 1000000
	return iif(std &gt;= 0.0000001,(imbalance - mean) \ std, NULL).ffill().nullFill(0)
}</code></pre><p class="- topic/p p">bidQty, askQty 为数组向量数据类型，分别为买方十档委托量和卖方十档委托数量。使用数组向量进行加减运算非常便捷，而使用<code class="+ topic/ph pr-d/codeph ph codeph">rowWavg</code>函数则可轻松计算加权平均值。在本例中，我们使用 <code class="+ topic/ph pr-d/codeph ph codeph">rowWavg</code> 函数计算各档加权平均的买卖委托量不均衡程度因子，即订单失衡率因子。最后对一段时间的指标进行移动标准化处理。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title13" id="313-成交价加权净委买比例"><h4 class="- topic/title title topictitle4" id="ariaid-title13">3.1.3. 成交价加权净委买比例</h4><div class="- topic/body body"><p class="- topic/p p">净委买比率是衡量一段时间内买盘相对强度的指标，计算公式为：</p><p class="- topic/p p">(盘口买一变化量－盘口卖一变化量)/ (abs（盘口买一变化量)+abs(盘口卖一变化量))×100%</p><p class="- topic/p p">当净委买比率为正值数值较大时，说明市场买盘强劲。当委比值为负值且数值较大时，说明市场卖盘强劲。数值从-100%逐步增加到+100%表示买盘逐渐增强，卖盘逐渐减弱；而从+100%逐步减少到-100%则表示买盘逐渐减弱，卖盘逐渐增强的过程。其计算公式如下：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_5.png"/><br/><div class="- topic/p p"><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_5_1.png" alt="chg(bidQty_)"/><br/> 和<img class="- topic/image image" src="images/Level-2_stock_data_processing/3_5_2.png" alt="chg(askQty"/><br/> 分别表示在 i 时刻盘口买一和卖一变化量，而 <img class="- topic/image image" src="images/Level-2_stock_data_processing/3_5_3.png"/><br/><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>  @state
def traPriceWeightedNetBuyQuoteVolumeRatio(bid,bidQty,ask,askQty,TotalValTrd,TotalVolTrd,lag=20){
	prevbid = prev(bid)
	prevbidQty = prev(bidQty)
	prevask = prev(ask)
	prevaskQty = prev(askQty)
	bidchg = iif(round(bid-prevbid,2)&gt;0, bidQty, iif(round(bid-prevbid,2)&lt;0, -prevbidQty, bidQty-prevbidQty))
	offerchg = iif(iif(ask==0,iif(prevask&gt;0,1,0), ask-prevask)&gt;0, prevaskQty, iif(iif(prevask==0,
		iif(ask&gt;0,-1,0), iif(ask&gt;0,ask-prevask,1))&lt;0, askQty, askQty-prevaskQty))
	avgprice = deltas(TotalValTrd)\deltas(TotalVolTrd)
	factorValue = (bidchg-offerchg)\(abs(bidchg)+abs(offerchg))*avgprice
	return nullFill(msum(factorValue,lag,1)\msum(avgprice,lag,1), 0)
}</code></pre><p class="- topic/p p">以上代码，首先通过计算买卖一档前后价格的变化，得到盘口买卖一委托量的绝对变化量；然后利用净委买比率公式，计算过去一段时间的成交价加权净委买比例。</p></div></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title14" id="314-十档净委买增额"><h5 class="- topic/title title topictitle5" id="ariaid-title14">3.1.4. 十档净委买增额</h5><div class="- topic/body body"><p class="- topic/p p">十档净委买增额因子指的是在有效十档范围内买方资金总体增加量，即所有买价变化量的总和，计算公式如下：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_6.png"/><br/><p class="- topic/p p">有效十档范围内表示不考虑已不在十档范围内的档位，即表示只考虑以下区间的档位：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_7.png"/><br/><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def level10_Diff(price, qty, buy, lag=20){
        prevPrice = price.prev()
        left, right = rowAlign(price, prevPrice, how=iif(buy, "bid", "ask"))
        qtyDiff = (qty.rowAt(left).nullFill(0) - qty.prev().rowAt(right).nullFill(0)) 
        amtDiff = rowSum(nullFill(price.rowAt(left), prevPrice.rowAt(right)) * qtyDiff)
        return msum(amtDiff, lag, 1).nullFill(0)
}</code></pre><p class="- topic/p p">以上代码，首先通过行对齐函数<code class="+ topic/ph pr-d/codeph ph codeph">rowAlign</code>实现当前十档价格和前一个一十档价格进行行对齐，然后通过<code class="+ topic/ph pr-d/codeph ph codeph">rowAt</code>和<code class="+ topic/ph pr-d/codeph ph codeph">nullFill</code>函数分别获取对应档位的委托量和实现价格进行对齐，最后计算总的变化额。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title15" id="315-十档买卖委托均价线性回归斜率"><h5 class="- topic/title title topictitle5" id="ariaid-title15">3.1.5. 十档买卖委托均价线性回归斜率</h5><div class="- topic/body body"><p class="- topic/p p">十档买卖委托均价即为十档买卖委托额之和除以十档买卖委托量之和：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_8.png"/><br/><p class="- topic/p p">十档买卖委托均价线性回归斜率为十档买卖委托均价对时间t的线性回归的斜率。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def level10_InferPriceTrend(bid, ask, bidQty, askQty, lag1=60, lag2=20){
	inferPrice = (rowSum(bid*bidQty)+rowSum(ask*askQty))\(rowSum(bidQty)+rowSum(askQty))
	price = iif(bid[0] &lt;=0 or ask[0]&lt;=0, NULL, inferPrice)
	return price.ffill().linearTimeTrend(lag1).at(1).nullFill(0).mavg(lag2, 1).nullFill(0)
}</code></pre><p class="- topic/p p">以上代码，bid, ask, bidQty 和 askQty 均为数组向量数据类型，分别为买卖十档价格和十档委托数量。通过<code class="+ topic/ph pr-d/codeph ph codeph">linearTimeTrend</code>函数获取因子值对时间 t 的滑动线性回归斜率，该函数返回线性回归的截距和斜率。<code class="+ topic/ph pr-d/codeph ph codeph">linearTimeTrend(price_,lag1)[1]</code> 表示获取十档买卖委托均价对时间t的线性回归的斜率。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title16" id="316-性能测试"><h5 class="- topic/title title topictitle5" id="ariaid-title16">3.1.6. 性能测试</h5><div class="- topic/body body"><p class="- topic/p p">A 股 Level-2 行情快照数据一天的数据量超过 10G，因此金融量化工程师们非常关注 Level-2 行情快照数据的高频因子计算性能。本节将展示 5 个受到关注的高频因子的计算性能，包括：加权时间订单斜率、加权平均订单失衡率、成交价加权净委买比率、十档委买增额和十档买卖委托均价线性回归斜率。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>timer {
	res=select SecurityID,DateTime,timeWeightedOrderSlope(bidPrice[0],bidOrderQty[0],OfferPrice[0],OfferOrderQty[0])  as TimeWeightedOrderSlope,
	level10_InferPriceTrend(bidPrice,OfferPrice,bidOrderQty,OfferOrderQty,60,20) as Level10_InferPriceTrend,
	level10_Diff(bidPrice, bidOrderQty, true,20) as Level10_Diff,
	traPriceWeightedNetBuyQuoteVolumeRatio(bidPrice[0],bidOrderQty[0],OfferPrice[0],OfferOrderQty[0],TotalValueTrade,
	totalVolumeTrade) as TraPriceWeightedNetBuyQuoteVolumeRatio,
	wavgSOIR( bidOrderQty,OfferOrderQty,20) as HeightImbalance
	from  loadTable(dbName,snapshotTBname) where date(DateTime)=idate context by SecurityID csort DateTime map 
}</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">计算结果展示</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_9.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">计算耗时展示</p><p class="- topic/p p">以下为基于快照数据计算一天全市场所有股票的 5 个因子的耗时，可以发现耗时基本与 CPU 数量成正比。</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="316-性能测试__entry__1">CPU 数量</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="316-性能测试__entry__2">5个因子计算耗时</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__1">4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__2">35.51s</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__1">8</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__2">19.27s</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__1">16</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__2">11.91s</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__1">32</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__2">8.11s</td></tr></tbody></table></div></li><li class="- topic/li li"><p class="- topic/p p">与 Python 计算性能的对比</p><p class="- topic/p p">在 Python 中实现上面5个因子的计算逻辑。获取一天中两只股票的数据进行对比测试。</p><p class="- topic/p p">下表为 DolphinDB 和 Python 计算性能的对比，可以发现，DolphinDB 显著优于 Python。代码见附件。</p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="316-性能测试__entry__11"><strong class="+ topic/ph hi-d/b ph b">因子名</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="316-性能测试__entry__12"><strong class="+ topic/ph hi-d/b ph b">Python 耗时</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="316-性能测试__entry__13"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 耗时</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="316-性能测试__entry__14"><strong class="+ topic/ph hi-d/b ph b">耗时比</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__11">timeWeightedOrderSlope</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__12">136.726ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__13">7.745ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__14">17.6</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__11">wavgSOIR</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__12">432.329ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__13">11.805ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__14">36.6</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__11">traPriceWeightedNetBuyQuoteVolumeRatio</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__12">144.154ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__13">8.339ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__14">17.3</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__11">level10_Diff</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__12">34.120026s</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__13">13.025ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__14">2619.2</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__11">level10_InferPriceTrend</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__12">1.267870s</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__13">20.324ms</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="316-性能测试__entry__14">73.7</td></tr></tbody></table></div></li></ul></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title17" id="32-逐笔成交数据的因子计算"><h4 class="- topic/title title topictitle4" id="ariaid-title17">3.2. 逐笔成交数据的因子计算</h4><div class="- topic/body body"><p class="- topic/p p">逐笔成交数据包含的信息很丰富，可以构建很多中高频因子。以下为逐笔成交的样例数据：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_10.png" width="500"/><br/><p class="- topic/p p">利用逐笔成交数据中的买卖订单号，可以将其合并为单笔订单成交数据，并从单笔订单的角度区分大小单和主买卖方向等。本节从单笔订单和主买卖角度出发，计算主动买入和卖出的单笔订单均价，并统计成交时间与开始委托下单时长超过1分钟的订单数量。</p></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title18" id="321-单笔订单主动买入卖出均价"><h5 class="- topic/title title topictitle5" id="ariaid-title18">3.2.1. 单笔订单主动买入卖出均价</h5><div class="- topic/body body"><p class="- topic/p p">单笔订单主动买入、卖出均价为单笔主买、主卖订单的成交均价价格之和除以订单数量。</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_11.png"/><br/><p class="- topic/p p">n表示截至 t 时刻主买、主卖订单数量，<img class="- topic/image image" src="images/Level-2_stock_data_processing/3_11_1.png" alt="AnyTradePrice"/><br/>表示单笔订单主买、主卖的成交均价。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def singleOrderAveragePrice(buyNo,sellNo,tradePrice,tradeQty,BSFlag="B"){
	if(BSFlag=="B"){
		 totolMoney=groupby(sum,iif(buyNo&gt;sellNo,tradePrice*tradeQty,0),buyNo).values()[1]
		 totolqty=groupby(sum,iif(buyNo&gt;sellNo,tradeQty,0),buyNo).values()[1]
	}
	else{
		 totolMoney=groupby(sum,iif(buyNo&lt;sellNo,tradePrice*tradeQty,0),sellNo).values()[1]
		 totolqty=groupby(sum,iif(buyNo&lt;sellNo,tradeQty,0),sellNo).values()[1]
		}
	 return totolMoney\totolqty
}
res=select avg(singleOrderAveragePrice(BidApplSeqNum,OfferApplSeqNum,TradePrice,TradeQty,"B")) as ActBuySingleOrderAveragePriceFactor,
avg(singleOrderAveragePrice(BidApplSeqNum,OfferApplSeqNum,TradePrice,TradeQty,"S")) as ActSellSingleOrderAveragePriceFactor from 
tradeTB where  TradePrice&gt;0 group by SecurityID cgroup by minute(DateTime) as minute order by  minute;</code></pre><p class="- topic/p p">这里首先通过自定义函数实现单笔订单的成交均价，然后再计算单笔订单的成交均价。自定义函数中使用<code class="+ topic/ph pr-d/codeph ph codeph">groupby</code>函数分别计算单笔订单的成交金额和成交数量。</p><p class="- topic/p p">最后通过<code class="+ topic/ph pr-d/codeph ph codeph">group by</code>和<code class="+ topic/ph pr-d/codeph ph codeph">cgroup by</code>计算每只股票当日最新一分钟单笔订单主动买入、卖出均价。计算结果如下：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_12.png" width="500"/><br/></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title19" id="322-股票延时成交订单因子"><h5 class="- topic/title title topictitle5" id="ariaid-title19">3.2.2. 股票延时成交订单因子</h5><div class="- topic/body body"><p class="- topic/p p">延时成交挂单数和成交量，一定程度上能反应大单或者机构成交情况。本节统计从下单到成交的时间间隔超过1分钟的订单数和成交量。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def delayedTradeNum(bsFlag, flag, side){
      return iif(bsFlag==side &amp;&amp; flag&lt;=1, flag, 0).cumsum()

}

@state
def delayedTradeQty(bsFlag, flag, tradeQty, cumTradeQty, side){
        return iif(bsFlag==side &amp;&amp; flag&gt;1, tradeQty, iif(bsFlag==side &amp;&amp; flag==1, cumTradeQty, 0)).cumsum()
}
///买方
///step 1,标记延时状态，计算笔订单的累计成交量
t1 = select SecurityID,DateTime,entrust.DateTime as time,"B" as bsFlag,tradeQty, cumsum(iif(DateTime-entrust.DateTime&gt;60000,1,0)) as delayedTraderflag, cumsum(tradeQty) as cumTradeQty from lsj(trade, entrust, ['SecurityID', 'BidApplSeqNum'], ['SecurityID', 'ApplSeqNum']) where tradePrice&gt;0 context by  SecurityID,BidApplSeqNum 
/////step 2,统计每只股票累计的延时成交订单数，和延时成交订单量
tt2 = select SecurityID,DateTime,delayedTradeNum(bsFlag, delayedTraderflag, "B") as DelayedTraderBuyOrderNum ,
 delayedTradeQty(bsFlag,delayedTraderflag, tradeQty, cumTradeQty, "B") as DelayedTraderBuyOrderQty from t1 context by SecurityID limit -1
 ///卖方
///step 1,标记延时状态，计算笔订单的累计成交量
t1 = select SecurityID,DateTime,"S" as bsFlag,tradeQty, cumsum(iif(DateTime-entrust.DateTime&gt;60000,1,0)) as delayedTraderflag, cumsum(tradeQty) as cumTradeQty from lsj(trade, entrust, ['SecurityID', 'OfferApplSeqNum'], ['SecurityID', 'ApplSeqNum']) where tradePrice&gt;0 context by SecurityID, OfferApplSeqNum
/////step 2,统计每只股票累计的延时成交订单数，和延时成交订单量
t3 = select SecurityID,DateTime,delayedTradeNum(bsFlag, delayedTraderflag, "S") as DelayedTraderSellOrderNum ,
 delayedTradeQty(bsFlag,delayedTraderflag , tradeQty, cumTradeQty, "S") as DelayedTraderSellOrderQty from t1 context  by SecurityID limit -1
 t2=lsj(t2,t3,`SecurityID`DateTime)
</code></pre><p class="- topic/p p">下单信息记录在逐笔委托表里，如果统计下单到成交之间的时间间隔，则需要把逐笔成交表和逐笔委托表进行关联。这里首先通过左半连接(<code class="+ topic/ph pr-d/codeph ph codeph">lsj</code>) 返回逐笔成交表中所有与逐笔委托表匹配的记录，如果逐笔委托表中有多条匹配记录（如上交所的下单和撤单记录），<code class="+ topic/ph pr-d/codeph ph codeph">lsj</code> 将会取第一条（下单时的订单记录）匹配记录。因此，<code class="+ topic/ph pr-d/codeph ph codeph">lsj</code> 可以把订单委托下单的时间以及下单量准确关联到成交记录中。</p><p class="- topic/p p">计算股票延时成交订单因子的步骤为，首先根据成交表的买卖单号与委托表的订单委托号建立连接，并计算改订单的累计延时成交次数和订单的累计成交量；其次通过自定义函数，计算股票的延时成交订单数以及延时成交的订单量。</p></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title20" id="33-逐笔委托数据的因子计算"><h4 class="- topic/title title topictitle4" id="ariaid-title20">3.3. 逐笔委托数据的因子计算</h4><div class="- topic/body body"><p class="- topic/p p">Level-2 行情逐笔委托数据包含所有的委托订单信息（除了上交所的市价单（即时成交）和部分撤单，深交所的撤单），本节根据买卖订单的委托信息，计算深交所股票的委买委卖金额和撤单金额指标数据。</p><p class="- topic/p p">逐笔委托数据数据样例如下：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/3_13.png" width="400"/><br/></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title21" id="331-委买委卖金额"><h5 class="- topic/title title topictitle5" id="ariaid-title21">3.3.1. 委买委卖金额</h5><div class="- topic/body body"><p class="- topic/p p">委托买卖金额是对一段时间内委托订单的买卖方向的资金总量进行统计。由于深交所的市价订单的价格在逐笔委托表里的价格不是一个成交价格（一般标记为0）。因此统计计算委托金额时，我们需要在逐笔成交记录中找到最近的成交价格来作为其近似值。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg calcSZOrderValue(side,price,orderQty,tradePrice,orderType,bsFlag){
	price_=iif(orderType =="50",price,NULL).nullFill(tradePrice)
	return sum(iif(side==bsFlag,price_*orderQty,NULL)).nullFill(0)
}
res=select calcSZOrderValue(side,price,orderQty,tradePrice,orderType,"B") as BuyOrderValue, 
calcSZOrderValue(side,price,orderQty,tradePrice,orderType,"S") as SellOrderValue
from aj(entrustTB,tradeTB,`SecurityID`ApplSeqNum) group by SecurityID,bar(DateTime,1m) as DateTime</code></pre><p class="- topic/p p">这里通过<code class="+ topic/ph pr-d/codeph ph codeph">aj</code> （asof join）把逐笔成交里的最新价格关联到逐笔成交中；对市价订单，以获取最新的成交价格作为当前市价委托单的委托价格，最后计算股票每分钟内的买卖委托金额。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title22" id="332-买卖撤单金额"><h5 class="- topic/title title topictitle5" id="ariaid-title22">3.3.2. 买卖撤单金额</h5><div class="- topic/body body"><p class="- topic/p p">深交所的撤单标记记录在逐笔成交表中，撤单时的价格一般标记为0，而委托价格记录在逐笔委托表中，因此计算买卖方撤单金额时需要将逐笔成交表和逐笔委托表进行关联。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>trade = select SecurityID,DateTime, max(BidApplSeqNum,OfferApplSeqNum) as ApplSeqNum,TradeQty from tradeTB where  ExecType=52
entrust = select  SecurityID,ApplSeqNum, Price,Side from entrustTB
res = select  sum(iif(side=="B",Price*TradeQty,NULL)).nullFill(0) as buywithdrawOrderValue,
sum(iif(side=="S",Price*TradeQty,NULL)).nullFill(0) as sellwithdrawOrderValue 
from lsj(trade,entrust,`SecurityID`ApplSeqNum) group by SecurityID,bar(DateTime,1m) as DateTime</code></pre><p class="- topic/p p">这里通过 <code class="+ topic/ph pr-d/codeph ph codeph">lj</code>（left join)分别把买卖撤单的委托价格关联到撤单信息表中，然后计算每只股票每分钟的买卖撤单金额。</p></div></article></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title23" id="4-基于-level-2-实时行情数据的流式实现"><h3 class="- topic/title title topictitle3" id="ariaid-title23">4. 基于 Level-2 实时行情数据的流式实现</h3><div class="- topic/body body"><p class="- topic/p p">本章节介绍基于 DolphinDB 实时计算 Level-2 的行情数据。DolphinDB 的计算引擎不仅可以用于量化金融基于历史数据的批量开发计算，也大量用于生产环境的实时计算。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title24" id="41-快照实时行情数据的高频因子流批一体实现"><h4 class="- topic/title title topictitle4" id="ariaid-title24">4.1. 快照实时行情数据的高频因子流批一体实现</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 的响应式状态引擎（Reactive State Engine），接收一个在历史数据上经过验证的 DolphinDB 因子代码，应用于实时行情数据，输出实时因子值，实现了高频因子流批一体的解决方案。具体教程请参考<a class="- topic/xref xref" href="reactive_state_engine.html">DolphinDB 响应式状态引擎介绍</a></p><p class="- topic/p p">如上“快照数据的因子计算”节中基于快照历史行情数据计算的时间加权订单斜率、成交价加权净委买比例、十档委买增额和十档买卖委托均价线性回归斜率因子表达式，将这些因子直接代入响应式状态引擎，以实现对流数据的实时因子计算。</p><p class="- topic/p p">在基于历史数据批量计算加权平均订单失衡率因子的表达式中，在进行因子标准化处理时，使用了迭代的算法（当前标准差很小时，使用上一标准化的因子值），这类因子在流式计算时需要改为流式引擎计算支持的表达式。而其它的高频因子计算中没有涉及迭代算法，可以直接代入流式表达式进行实时因子计算。</p><p class="- topic/p p">十档平均委卖订单斜率因子流式计算实现如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def wavgSOIRStream(bidQty,askQty,lag=20){
	Imbalance_=rowWavg((bidQty-askQty)\(bidQty+askQty),
	 10 9 8 7 6 5 4 3 2 1)
	Imbalance= ffill(Imbalance_).nullFill(0)
	mean = mavg(prev(Imbalance), (lag-1), 2)
	std = mstdp(prev(Imbalance) *1000000, (lag-1),2) \ 1000000
	factorValue = conditionalIterate(std &gt;= 0.0000001,
	(Imbalance - mean) \ std, cumlastNot)
	return ffill(factorValue).nullFill(0)
}</code></pre><p class="- topic/p p">把批计算中的 <code class="+ topic/ph pr-d/codeph ph codeph"> iif(std &gt;= 0.0000001,(Imbalance - mean) \ std, NULL)</code> 改为 <code class="+ topic/ph pr-d/codeph ph codeph">conditionalIterate(std &gt;= 0.0000001,(Imbalance - mean) \ std, cumlastNot)</code>。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">conditionalIterate</code> 函数只适用于响应式状态引擎，通过条件迭代实现因子中的递归逻辑。假设该函数计算结果对应输出表的列为 factor，且迭代仅基于前一个值，对于第 k 条记录（k = 0, 1, 2 …），其计算逻辑为：</p><ul class="- topic/ul ul"><li class="- topic/li li">cond[k] == true：factor[k] = trueValue</li><li class="- topic/li li">cond[k] == false：factor[k] = falseIterFunc(factor)[k-1]</li></ul><p class="- topic/p p">基于Level-2 行情快照数据的高频因子流式计算脚本如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>metrics = array(ANY, 5)	
metrics[0]=&lt;DateTime&gt;
metrics[1] = &lt;timeWeightedOrderSlope(BidPrice[0],BidOrderQty[0],OfferPrice[0],OfferOrderQty[0],20)&gt;
metrics[2] =&lt;level10_InferPriceTrend(BidPrice,OfferPrice,BidOrderQty,OfferOrderQty,60,20)&gt;
metrics[3] =&lt;traPriceWeightedNetBuyQuoteVolumeRatio(BidPrice[0],BidOrderQty[0],OfferPrice[0],OfferOrderQty[0],TotalValueTrade,TotalVolumeTrade,20)&gt; 
metrics[4] =&lt;wavgSOIRStream( BidOrderQty,OfferOrderQty,20)&gt;

share streamTable(1:0, `SecurityID`DateTime`BidPrice`OfferPrice`BidOrderQty`OfferOrderQty`TotalValueTrade`TotalVolumeTrade, [STRING,TIMESTAMP,DOUBLE[],DOUBLE[],DOUBLE[],DOUBLE[],INT,INT]) as Streamdata

result = table(1000:0, `SecurityID`DateTime`TimeWeightedOrderSlope`Level10_InferPriceTrend`TraPriceWeightedNetBuyQuoteVolumeRatio`height_Imbalance, [STRING,TIMESTAMP,DOUBLE,DOUBLE,DOUBLE,DOUBLE])
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=Streamdata, outputTable=result, keyColumn="SecurityID")
subscribeTable(tableName=`Streamdata, actionName="factors", handler=tableInsert{rse})
snapshotTB=select* from loadTable("dfs://TSDB_snapshot","snapshot") where date(TradeTime)=2022.04.14 and SecurityID in [`600000,`000001]
data1=select SecurityID,TradeTime as DateTime,BidPrice,OfferPrice,BidOrderQty,OfferOrderQty,TotalValueTrade,TotalVolumeTrade from snapshotTB 
Streamdata.append!(data1)
</code></pre><p class="- topic/p p">流式计算输出结果展示：</p><img class="- topic/image image" src="images/Level-2_stock_data_processing/4_1.png" width="400"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title25" id="42-延时成交订单因子的流式实现"><h4 class="- topic/title title topictitle4" id="ariaid-title25">4.2. 延时成交订单因子的流式实现</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 内置的流计算引擎除了响应式状态引擎外，还有时间序列聚合引擎、横截面引擎、异常检测引擎和各种连接引擎。这些引擎均实现了数据表（table）的接口，因此使得多个引擎间的流水线处理变得异常简单。只要将后一个引擎作为前一个引擎的输出即可。引入流水线处理，可以解决更为复杂的因子计算问题。</p><p class="- topic/p p">本节通过流数据引擎的级联构建计算模型，以实现实时计算延时成交订单因子,详细代码见附件。</p></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title26" id="421-实现思路"><h5 class="- topic/title title topictitle5" id="ariaid-title26">4.2.1. 实现思路</h5><div class="- topic/body body"><p class="- topic/p p">整体计算流程如下图所示：</p><img class="- topic/image image" src="../stream/images/stk_data_proc_1.png" width="400"/><br/><p class="- topic/p p">涉及到的流数据引擎有：左半等值连接引擎、响应式状态引擎和时间序列引擎。</p><p class="- topic/p p">流程说明：</p><ul class="- topic/ul ul"><li class="- topic/li li">左半等值连接引擎，把逐笔成交与逐笔委托数据关联，并计算延时成交订单的累计值和订单累计成交量；</li><li class="- topic/li li">用响应式状态引擎，计算每只股票延时订单因子和延时订单成交量；</li><li class="- topic/li li">用时间序列引擎 获取最新一分钟的延时订单因子和延时订单成交量，并输出结果。</li></ul><p class="- topic/p p">各引擎间直接级联，无需通过中间表。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title27" id="422-实时计算延时成交订单因子"><h5 class="- topic/title title topictitle5" id="ariaid-title27">4.2.2. 实时计算延时成交订单因子</h5><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">第一步：</p><p class="- topic/p p">tradeTable 和 entrustTable 分别为逐笔成交表和逐笔委托流数据表。通过创建两个左半等值连接引擎把两个表基于买卖订单进行等值关联。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>metrics = [
&lt;tradeTable.DateTime&gt;,
&lt;entrustTable.DateTime&gt;,
&lt;TradePrice&gt;,
&lt;TradeQty&gt;,
&lt;cumsum(iif((tradeTable.DateTime-entrustTable.DateTime)&gt;60000,1,0)) as DelayedTraderflag&gt;,
&lt;Side&gt;,
&lt;cumsum(TradeQty)&gt;]
lsjEngineBid=createLeftSemiJoinEngine("lsjEngineBid", tradeTable, entrustTable, lsjoutput, metrics,[[`SecurityID,`BidApplSeqNum],[`SecurityID,`ApplSeqNum]],50000000,true)
subscribeTable(tableName="tradeTable", actionName="Bid", offset=0, handler=appendForJoin{lsjEngineBid, true}, msgAsTable=true)
subscribeTable(tableName="entrustTable", actionName="Bid", offset=0, handler=appendForJoin{lsjEngineBid, false}, msgAsTable=true)

lsjEngineOffer=createLeftSemiJoinEngine("lsjEngineOffer", tradeTable, entrustTable, lsjoutput, metrics,[[`SecurityID,`OfferApplSeqNum],[`SecurityID,`ApplSeqNum]],50000000,true)
subscribeTable(tableName="tradeTable", actionName="Offer", offset=0, handler=appendForJoin{lsjEngineOffer, true}, msgAsTable=true)
subscribeTable(tableName="entrustTable", actionName="Offer", offset=0, handler=appendForJoin{lsjEngineOffer, false}, msgAsTable=true)</code></pre><p class="- topic/p p">左半等值连接引擎返回一个左、右表关联后的表对象。对于左表每一条数据，都去匹配右表相同 matchingColumn 的数据，若无匹配的右表记录，则不输出。若匹配多条右表记录，则由 <em class="+ topic/ph hi-d/i ph i">updateRightTable</em> 参数决定连接右表的第一条记录还是最后一条记录。<em class="+ topic/ph hi-d/i ph i">updateRightTable</em> 为可选参数，默认为 false，表示右表存在多条相同 matchingColumn 的记录时，是保留第一条（false）还是最后一条记录（true）。这里订单成交时间需要与订单的最早委托时间关联，所以 <em class="+ topic/ph hi-d/i ph i">updateRightTable</em> 取默认值即可。</p><p class="- topic/p p">metrics 中计算订单的成交量、订单的累计成交量，成交时间和委托时间差是否大于1分钟的累计次数和订单的买卖方向等指标。</p></li><li class="- topic/li li"><p class="- topic/p p">第二步：</p><p class="- topic/p p">通过响应式状态引擎，计算每一只股票的买卖延时订单数量和买卖延时订单成交量指标。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def delayedTradeNum(bsFlag, flag, side){
      return iif(bsFlag==side &amp;&amp; flag&lt;=1, flag, 0).cumsum()

}
@state
def delayedTradeQty(bsFlag, flag, tradeQty, cumTradeQty, side){
        return iif(bsFlag==side &amp;&amp; flag&gt;1, tradeQty, iif(bsFlag==side &amp;&amp; flag==1, cumTradeQty, 0)).cumsum()
}
metrics = array(ANY, 5)	
metrics[0]=&lt;TradeTime&gt;
metrics[1]=&lt;delayedTradeNum(BuySellFlag,DelayedTradeFlag,"B")&gt;
metrics[2]=&lt;delayedTradeNum(BuySellFlag,DelayedTradeFlag,"S")&gt;
metrics[3]=&lt;delayedTradeQty(BuySellFlag,DelayedTradeFlag,TradeQty,cumTradeQty,"B")&gt;
metrics[4]=&lt;delayedTradeQty(BuySellFlag,DelayedTradeFlag,TradeQty,cumTradeQty,"S")&gt;

secondrse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=lsjoutput, outputTable=RSEresult, keyColumn=["code"],filter=&lt;TradePrice&gt;0&gt;)
subscribeTable(tableName=`lsjoutput, actionName="DelayedTrader", handler=tableInsert{secondrse})</code></pre><p class="- topic/p p">DelayedTradeFlag 指标为订单延时成交累计记录。统计股票的延时订单数时，对每笔订单只需统计一次，计算股票的延时成交订单数只需计算 <code class="+ topic/ph pr-d/codeph ph codeph">iif(bsFlag==side&amp;&amp;flag&lt;=1,flag,0)</code> 的累计值。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>iif((BuySellFlag=="B")&amp;&amp;(DelayedTraderFlag&gt;1),TradeQty,iif((BuySellFlag=="B")&amp;&amp;(DelayedTraderFlag==1),DelayedTraderFlag*cumTradeQty,0))</code></pre><p class="- topic/p p">使用订单延时成交累计记录指标 DelayedTradeFlag 来计算延时订单的成交量。当首次记录为延时成交时，成交量为订单的累计成交量，当 DelayedTradeFlag&gt;1 时，成交量只需加上当前的交易量。</p></li><li class="- topic/li li"><p class="- topic/p p">第三步：</p><p class="- topic/p p">通过时间序列引擎引擎，计算每一分钟每只股票最新的买卖延时订单数量和买卖延时订单成交量指标。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>tsengine = createTimeSeriesEngine(name="TSengine", windowSize=60000, step=60000, metrics=&lt;[last(DelayedTradeBuyOrderNum),last(DelayedTradeSellOrderNum),last(DelayedTradeBuyOrderQty),last(DelayedTradeSellOrderQty)]&gt;, dummyTable=RSEresult, outputTable=result, timeColumn=`TradeTime, useSystemTime=false, keyColumn=`code, garbageSize=50, useWindowStartTime=false)
subscribeTable(tableName="RSEresult", actionName="TSengine", offset=0, handler=append!{tsengine}, msgAsTable=true);</code></pre></li></ul></div></article></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title28" id="5-附件"><h3 class="- topic/title title topictitle3" id="ariaid-title28">5. 附件</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">快照批处理脚本：   <a class="- topic/xref xref" href="script/Level-2_stock_data_processing/shapshot%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86.dos">shapshot数据处理.dos</a></li><li class="- topic/li li">逐笔数据批计算脚本：  <a class="- topic/xref xref" href="script/Level-2_stock_data_processing/entrust%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86.dos">entrust数据处理.dos</a></li><li class="- topic/li li">成交表数据批计算脚本：  <a class="- topic/xref xref" href="script/Level-2_stock_data_processing/trade%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86.dos">trade数据处理.dos</a></li><li class="- topic/li li">快照流式计算脚本：  <a class="- topic/xref xref" href="script/Level-2_stock_data_processing/shapshot%E6%95%B0%E6%8D%AE%E6%B5%81%E5%BC%8F%E8%AE%A1%E7%AE%97.dos">shapshot数据流式计算.dos</a></li><li class="- topic/li li">延时订单因子流式实现：   <a class="- topic/xref xref" href="script/Level-2_stock_data_processing/%E5%BB%B6%E6%97%B6%E8%AE%A2%E5%8D%95%E5%9B%A0%E5%AD%90%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0.dos">延时订单因子流式实现.dos</a></li><li class="- topic/li li">与python性能比对：  <a class="- topic/xref xref" href="script/Level-2_stock_data_processing/%E4%B8%8Epython%E6%80%A7%E8%83%BD%E6%AF%94%E5%AF%B9">与python性能比对</a></li><li class="- topic/li li">python实现脚本：  <a class="- topic/xref xref" href="script/Level-2_stock_data_processing/python%E5%AE%9E%E7%8E%B0%E8%84%9A%E6%9C%AC.py">python实现脚本.py</a></li></ul></div></article></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-level-2-%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D" data-tocid="1-level-2-行情数据介绍">1. Level-2 行情数据介绍</a><ul><li class="topic-item"><a href="#11-%E6%95%B0%E6%8D%AE%E6%A6%82%E5%86%B5" data-tocid="11-数据概况">1.1. 数据概况</a></li><li class="topic-item"><a href="#12-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" data-tocid="12-数据结构">1.2. 数据结构</a></li></ul></li><li class="topic-item"><a href="#2-dolphindb-%E9%AB%98%E6%95%88%E5%AD%98%E5%82%A8-level-2-%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE" data-tocid="2-dolphindb-高效存储-level-2-行情数据">2. DolphinDB 高效存储 Level-2 行情数据</a><ul><li class="topic-item"><a href="#21-%E5%88%86%E5%8C%BA%E6%96%B9%E6%A1%88" data-tocid="21-分区方案">2.1. 分区方案</a></li><li class="topic-item"><a href="#22-%E5%88%86%E5%8C%BA%E5%86%85%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F" data-tocid="22-分区内分组排序">2.2. 分区内分组排序</a></li><li class="topic-item"><a href="#23-level-2-%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88" data-tocid="23-level-2-行情数据存储方案">2.3. Level-2 行情数据存储方案</a></li></ul></li><li class="topic-item"><a href="#3-%E5%9F%BA%E4%BA%8E%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE%E7%9A%84%E6%89%B9%E9%87%8F%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97" data-tocid="3-基于历史数据的批量因子计算">3. 基于历史数据的批量因子计算</a><ul><li class="topic-item"><a href="#31-%E5%BF%AB%E7%85%A7%E6%95%B0%E6%8D%AE%E7%9A%84%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97" data-tocid="31-快照数据的因子计算">3.1. 快照数据的因子计算</a><ul><li class="topic-item"><a href="#311-%E6%97%B6%E9%97%B4%E5%8A%A0%E6%9D%83%E8%AE%A2%E5%8D%95%E6%96%9C%E7%8E%87" data-tocid="311-时间加权订单斜率">3.1.1. 时间加权订单斜率</a></li><li class="topic-item"><a href="#312-%E5%8A%A0%E6%9D%83%E5%B9%B3%E5%9D%87%E8%AE%A2%E5%8D%95%E5%A4%B1%E8%A1%A1%E7%8E%87%E5%9B%A0%E5%AD%90" data-tocid="312-加权平均订单失衡率因子">3.1.2. 加权平均订单失衡率因子</a></li><li class="topic-item"><a href="#313-%E6%88%90%E4%BA%A4%E4%BB%B7%E5%8A%A0%E6%9D%83%E5%87%80%E5%A7%94%E4%B9%B0%E6%AF%94%E4%BE%8B" data-tocid="313-成交价加权净委买比例">3.1.3. 成交价加权净委买比例</a><ul><li class="topic-item"><a href="#314-%E5%8D%81%E6%A1%A3%E5%87%80%E5%A7%94%E4%B9%B0%E5%A2%9E%E9%A2%9D" data-tocid="314-十档净委买增额">3.1.4. 十档净委买增额</a></li><li class="topic-item"><a href="#315-%E5%8D%81%E6%A1%A3%E4%B9%B0%E5%8D%96%E5%A7%94%E6%89%98%E5%9D%87%E4%BB%B7%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E6%96%9C%E7%8E%87" data-tocid="315-十档买卖委托均价线性回归斜率">3.1.5. 十档买卖委托均价线性回归斜率</a></li><li class="topic-item"><a href="#316-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="316-性能测试">3.1.6. 性能测试</a></li></ul></li><li class="topic-item"><a href="#32-%E9%80%90%E7%AC%94%E6%88%90%E4%BA%A4%E6%95%B0%E6%8D%AE%E7%9A%84%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97" data-tocid="32-逐笔成交数据的因子计算">3.2. 逐笔成交数据的因子计算</a><ul><li class="topic-item"><a href="#321-%E5%8D%95%E7%AC%94%E8%AE%A2%E5%8D%95%E4%B8%BB%E5%8A%A8%E4%B9%B0%E5%85%A5%E5%8D%96%E5%87%BA%E5%9D%87%E4%BB%B7" data-tocid="321-单笔订单主动买入卖出均价">3.2.1. 单笔订单主动买入卖出均价</a></li><li class="topic-item"><a href="#322-%E8%82%A1%E7%A5%A8%E5%BB%B6%E6%97%B6%E6%88%90%E4%BA%A4%E8%AE%A2%E5%8D%95%E5%9B%A0%E5%AD%90" data-tocid="322-股票延时成交订单因子">3.2.2. 股票延时成交订单因子</a></li></ul></li><li class="topic-item"><a href="#33-%E9%80%90%E7%AC%94%E5%A7%94%E6%89%98%E6%95%B0%E6%8D%AE%E7%9A%84%E5%9B%A0%E5%AD%90%E8%AE%A1%E7%AE%97" data-tocid="33-逐笔委托数据的因子计算">3.3. 逐笔委托数据的因子计算</a><ul><li class="topic-item"><a href="#331-%E5%A7%94%E4%B9%B0%E5%A7%94%E5%8D%96%E9%87%91%E9%A2%9D" data-tocid="331-委买委卖金额">3.3.1. 委买委卖金额</a></li><li class="topic-item"><a href="#332-%E4%B9%B0%E5%8D%96%E6%92%A4%E5%8D%95%E9%87%91%E9%A2%9D" data-tocid="332-买卖撤单金额">3.3.2. 买卖撤单金额</a></li></ul></li></ul></li><li class="topic-item"><a href="#4-%E5%9F%BA%E4%BA%8E-level-2-%E5%AE%9E%E6%97%B6%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E7%9A%84%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0" data-tocid="4-基于-level-2-实时行情数据的流式实现">4. 基于 Level-2 实时行情数据的流式实现</a><ul><li class="topic-item"><a href="#41-%E5%BF%AB%E7%85%A7%E5%AE%9E%E6%97%B6%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E7%9A%84%E9%AB%98%E9%A2%91%E5%9B%A0%E5%AD%90%E6%B5%81%E6%89%B9%E4%B8%80%E4%BD%93%E5%AE%9E%E7%8E%B0" data-tocid="41-快照实时行情数据的高频因子流批一体实现">4.1. 快照实时行情数据的高频因子流批一体实现</a></li><li class="topic-item"><a href="#42-%E5%BB%B6%E6%97%B6%E6%88%90%E4%BA%A4%E8%AE%A2%E5%8D%95%E5%9B%A0%E5%AD%90%E7%9A%84%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0" data-tocid="42-延时成交订单因子的流式实现">4.2. 延时成交订单因子的流式实现</a><ul><li class="topic-item"><a href="#421-%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF" data-tocid="421-实现思路">4.2.1. 实现思路</a></li><li class="topic-item"><a href="#422-%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97%E5%BB%B6%E6%97%B6%E6%88%90%E4%BA%A4%E8%AE%A2%E5%8D%95%E5%9B%A0%E5%AD%90" data-tocid="422-实时计算延时成交订单因子">4.2.2. 实时计算延时成交订单因子</a></li></ul></li></ul></li><li class="topic-item"><a href="#5-%E9%99%84%E4%BB%B6" data-tocid="5-附件">5. 附件</a></li></ul></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>