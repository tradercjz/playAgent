<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="DolphinDB 是一款高性能分布式时序数据库。与传统的关系数据库和常见的时序数据库不同，DolphinDB 不仅提供了高速存取时序数据的基本功能，而且内置了向量化的多范式编程语言与强大的计算引擎。DolphinDB 的计算引擎不仅可以用于量化金融的回测和研发，也可以用于生产环境的实时计算，譬如各种频率的金融量化因子的流式实时计算。 DolphinDB ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="dita"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../stream/str_intro.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="金融因子流式实现"/><title>金融因子流式实现</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;dita xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; ditaarch:DITAArchVersion=&#34;2.0&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34;&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;金融因子流式实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;金融因子流式实现&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 是一款高性能分布式时序数据库。与传统的关系数据库和常见的时序数据库不同，DolphinDB 不仅提供了高速存取时序数据的基本功能，而且内置了向量化的多范式编程语言与强大的计算引擎。DolphinDB 的计算引擎不仅可以用于量化金融的回测和研发，也可以用于生产环境的实时计算，譬如各种频率的金融量化因子的流式实时计算。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:60;97:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_stream.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../stream/str_intro.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_stream.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;流数据&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 流数据引擎及流数据计算的基本概念&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-概述&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;6:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;6:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1. 概述&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;6:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;11-dolphindb-流计算框架&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.1. DolphinDB 流计算框架&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 内置的流数据框架支持流数据的发布，订阅，预处理，实时内存计算，复杂指标的滚动窗口计算、滑动窗口计算、累计窗口计算等，是一个运行高效、使用便捷的流数据处理框架。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/str_comp_fin_quant_1.png&#34; width=&#34;60%&#34; xtrc=&#34;image:1;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; dita-ot:image-width=&#34;1872&#34; dita-ot:image-height=&#34;1774&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;本教程主要介绍如何在 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;14:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;“流数据表 ——&amp;gt; 订阅者(内置流计算引擎) ——&amp;gt; 计算结果”&lt;/b&gt; 这段过程中，利用内置流计算引擎实现金融量化因子并优化之。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 内置流数据引擎详情可见： &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/themes/streamingEngine.dita&#34; xtrc=&#34;xref:1;16:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;流数据引擎&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;12-数据结构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.2. 数据结构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;本教程中的代码基于上交所 level 2 行情的日 K 线，逐笔成交，快照数据进行调试。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试数据在 DolphinDB 中存储的表结构如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;（1）日 K 线&lt;/b&gt;&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:4;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;26:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;字段名称&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;26:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;26:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;数据说明&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;26:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;26:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;字段&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:4;26:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;26:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;含义&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;securityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;28:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;证券代码&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:7;28:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lastPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:8;28:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;收盘价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;dateTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:10;29:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;日期时间&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:11;29:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;volume&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:12;29:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:13;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;preClosePx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:14;30:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;昨收价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:15;30:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;amount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:16;30:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:17;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;openPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:18;31:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;开始价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:19;31:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iopv&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:20;31:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;净值估值&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:21;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;highPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:22;32:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;最高价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:23;32:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;fp_Volume&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:24;32:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;盘后固定价格交易成交量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:25;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lowPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:26;33:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;最低价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:27;33:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;fp_Amount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:28;33:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;盘后固定价格交易成交金额&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;（2）逐笔成交&lt;/b&gt;&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:2;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:5;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:6;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:7;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:8;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:29;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;37:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;字段名称&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:30;37:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;37:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;数据说明&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:31;37:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;37:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;字段&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:32;37:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;37:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;含义&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:33;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;securityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:34;39:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;证券代码&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:35;39:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;buyNo&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:36;39:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买方订单号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:37;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradeTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:38;40:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;日期时间&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:39;40:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;sellNo&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:40;40:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;卖方订单号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:41;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradePrice&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:42;41:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交价格&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:43;41:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradeBSFlag&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:44;41:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;内外盘标志&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:45;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradeQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:46;42:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交量&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:47;42:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradeIndex&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:48;42:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交序号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:49;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradeAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:50;43:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交金额&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:51;43:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;channelNo&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:52;43:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交通道&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;（3）行情快照&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 提供了存储可变长二维数组的数据类型 array vector。在数据存储时，可以选择将数据类型相同且含义相近的多列存为一列。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因此，level 2 快照行情的多档数据可以选择：(1)多列存储；(2) 用 array vector 存为一列。&lt;/p&gt;&lt;fig align=&#34;left&#34; class=&#34;- topic/fig &#34; xtrc=&#34;fig:1;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档多列存储，共194列&lt;/b&gt;&lt;/title&gt; &lt;image class=&#34;- topic/image &#34; href=&#34;images/Streaming_computing_of_financial_quantifiers/1_2.png&#34; width=&#34;75%&#34; xtrc=&#34;image:2;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; dita-ot:image-width=&#34;1921&#34; dita-ot:image-height=&#34;167&#34;/&gt; &lt;/fig&gt;&lt;fig align=&#34;left&#34; class=&#34;- topic/fig &#34; xtrc=&#34;fig:2;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;array vector 存储，共42列&lt;/b&gt;&lt;/title&gt; &lt;image class=&#34;- topic/image &#34; href=&#34;images/Streaming_computing_of_financial_quantifiers/1_3.png&#34; width=&#34;75%&#34; xtrc=&#34;image:3;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; dita-ot:image-width=&#34;1920&#34; dita-ot:image-height=&#34;166&#34;/&gt; &lt;/fig&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:3;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:9;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:10;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:11;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:53;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;63:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;字段名称（多档多列）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:54;63:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;63:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;字段名称（array vector）&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:55;63:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;63:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;数据说明&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:56;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;securityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:57;65:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;securityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:58;65:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;证券代码&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;66:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:59;66:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;dateTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:60;66:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;dateTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:61;66:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;日期时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:62;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;preClosePx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:63;67:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;preClosePx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:64;67:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;昨收价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:65;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;openPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:66;68:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;openPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:67;68:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;开始价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:68;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;highPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:69;69:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;highPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:70;69:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;最高价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;70:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:71;70:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lowPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:72;70:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lowPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:73;70:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;最低价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:74;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lastPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:75;71:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lastPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:76;71:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;最新价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;72:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:77;72:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalVolumeTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:78;72:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalVolumeTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:79;72:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交总量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:80;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalValueTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:81;73:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalValueTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:82;73:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交总金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;74:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:83;74:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;instrumentStatus&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:84;74:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;instrumentStatus&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:85;74:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;交易状态&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:86;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice0 .. bidPrice9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:87;75:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:88;75:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申买十价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:89;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidOrderQty0 .. bidOrderQty0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:90;76:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidOrderQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:91;76:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申买十量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:92;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidNumOrders0 .. bidNumOrders9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:93;77:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidNumOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:94;77:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申买十实际总委托笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:95;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidOrders0 .. bidOrders49&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:96;78:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:97;78:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申买一前 50 笔订单&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:98;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerPrice0 .. offerPrice9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:99;79:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerPrice&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:100;79:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申卖十价&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:101;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerOrderQty0 .. offerOrderQty9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:102;80:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerOrderQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:103;80:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申卖十量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:104;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerNumOrders0 .. offerNumOrders9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:105;81:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerNumOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:106;81:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申卖十实际总委托笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:107;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerOrders0 .. offerOrders49&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:108;82:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:109;82:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;申卖一前 50 笔订单&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:110;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;numTrades&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:111;83:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;numTrades&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:112;83:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;成交笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;21&#34; xtrc=&#34;entry:113;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iopv&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;21&#34; xtrc=&#34;entry:114;84:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iopv&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;21&#34; xtrc=&#34;entry:115;84:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ETF 净值估值&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;22&#34; xtrc=&#34;entry:116;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalBidQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;22&#34; xtrc=&#34;entry:117;85:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalBidQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;22&#34; xtrc=&#34;entry:118;85:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;委托买入总量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;23&#34; xtrc=&#34;entry:119;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalOfferQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;23&#34; xtrc=&#34;entry:120;86:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalOfferQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;23&#34; xtrc=&#34;entry:121;86:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;委托卖出总量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:37;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;24&#34; xtrc=&#34;entry:122;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAvgBidPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;24&#34; xtrc=&#34;entry:123;87:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAvgBidPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;24&#34; xtrc=&#34;entry:124;87:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;加权平均委买价格&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:38;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;25&#34; xtrc=&#34;entry:125;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAvgOfferPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;25&#34; xtrc=&#34;entry:126;88:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAvgOfferPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;25&#34; xtrc=&#34;entry:127;88:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;加权平均委卖价格&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:39;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;26&#34; xtrc=&#34;entry:128;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalBidNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;26&#34; xtrc=&#34;entry:129;89:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalBidNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;26&#34; xtrc=&#34;entry:130;89:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买入总笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:40;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;27&#34; xtrc=&#34;entry:131;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalOfferNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;27&#34; xtrc=&#34;entry:132;90:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;totalOfferNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;27&#34; xtrc=&#34;entry:133;90:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;卖出总笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:41;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;28&#34; xtrc=&#34;entry:134;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidTradeMaxDuration&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;28&#34; xtrc=&#34;entry:135;91:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidTradeMaxDuration&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;28&#34; xtrc=&#34;entry:136;91:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买入成交最大等待时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:42;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;29&#34; xtrc=&#34;entry:137;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerTradeMaxDuration&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;29&#34; xtrc=&#34;entry:138;92:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;offerTradeMaxDuration&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;29&#34; xtrc=&#34;entry:139;92:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买入成交最大等待时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:43;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;30&#34; xtrc=&#34;entry:140;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;numBidOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;30&#34; xtrc=&#34;entry:141;93:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;numBidOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;30&#34; xtrc=&#34;entry:142;93:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买方委托价位数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:44;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;31&#34; xtrc=&#34;entry:143;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;numOfferOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;31&#34; xtrc=&#34;entry:144;94:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;numOfferOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;31&#34; xtrc=&#34;entry:145;94:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;卖方委托价位数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:45;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;32&#34; xtrc=&#34;entry:146;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawBuyNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;32&#34; xtrc=&#34;entry:147;95:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawBuyNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;32&#34; xtrc=&#34;entry:148;95:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买入撤单笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:46;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;33&#34; xtrc=&#34;entry:149;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawBuyAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;33&#34; xtrc=&#34;entry:150;96:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawBuyAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;33&#34; xtrc=&#34;entry:151;96:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买入撤单数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:47;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;34&#34; xtrc=&#34;entry:152;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawBuyMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;34&#34; xtrc=&#34;entry:153;97:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawBuyMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;34&#34; xtrc=&#34;entry:154;97:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;买入撤单金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:48;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;35&#34; xtrc=&#34;entry:155;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawSellNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;35&#34; xtrc=&#34;entry:156;98:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawSellNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;35&#34; xtrc=&#34;entry:157;98:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;卖出撤单笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:49;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;36&#34; xtrc=&#34;entry:158;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawSellAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;36&#34; xtrc=&#34;entry:159;99:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawSellAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;36&#34; xtrc=&#34;entry:160;99:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;卖出撤单数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:50;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;37&#34; xtrc=&#34;entry:161;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawSellMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;37&#34; xtrc=&#34;entry:162;100:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;withdrawSellMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;37&#34; xtrc=&#34;entry:163;100:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;卖出撤单金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:51;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;38&#34; xtrc=&#34;entry:164;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfBuyNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;38&#34; xtrc=&#34;entry:165;101:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfBuyNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;38&#34; xtrc=&#34;entry:166;101:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ETF 申购笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:52;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;39&#34; xtrc=&#34;entry:167;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfBuyAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;39&#34; xtrc=&#34;entry:168;102:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfBuyAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;39&#34; xtrc=&#34;entry:169;102:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ETF 申购数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:53;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;40&#34; xtrc=&#34;entry:170;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfBuyMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;40&#34; xtrc=&#34;entry:171;103:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfBuyMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;40&#34; xtrc=&#34;entry:172;103:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ETF 申购金额&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:54;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;41&#34; xtrc=&#34;entry:173;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfSellNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;41&#34; xtrc=&#34;entry:174;104:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfSellNumber&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;41&#34; xtrc=&#34;entry:175;104:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ETF 赎回笔数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:55;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;42&#34; xtrc=&#34;entry:176;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfSellAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;42&#34; xtrc=&#34;entry:177;105:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfSellAmount&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;42&#34; xtrc=&#34;entry:178;105:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ETF 赎回数量&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:56;106:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;43&#34; xtrc=&#34;entry:179;106:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfSellMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;43&#34; xtrc=&#34;entry:180;106:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;etfSellMoney&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;43&#34; xtrc=&#34;entry:181;106:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ETF 赎回金额&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2--日频因子流式实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2. 日频因子流式实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 内置的流计算引擎有时间序列引擎，响应式状态引擎，横截面引擎等。在实际场景下，复杂的因子可能涉及横截面、历史状态、时序窗口三种逻辑，需要多个引擎级联才能实现因子逻辑。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;为了提高转写效率，DolphinDB 提供了一个引擎流水线解析器（Stream Engine Parser）可以自动解析并创建引擎流水线，使得用户无需编写复杂的级联代码。因此复杂日频因子的实时流计算一般考虑使用 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;114:107&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;引擎流水线解析器&lt;/b&gt; 来实现。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;116:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 目前已经实现了 &lt;xref class=&#34;- topic/xref &#34; format=&#34;md&#34; href=&#34;https://gitee.com/dolphindb/DolphinDBModules/blob/master/wq101alpha/README_CN.md#worldquant-101-alpha-因子指标库-&#34; scope=&#34;external&#34; xtrc=&#34;xref:2;116:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;WorldQuant 101 Alpha 因子库&lt;/xref&gt; 和 &lt;xref class=&#34;- topic/xref &#34; format=&#34;md&#34; href=&#34;https://gitee.com/dolphindb/DolphinDBModules/blob/master/gtja191Alpha/README_CN.md#/dolphindb/DolphinDBModules/blob/master/gtja191Alpha/src/gtja191Alpha.dos&#34; scope=&#34;external&#34; xtrc=&#34;xref:3;116:158&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;国泰君安 191 Alphas 因子库&lt;/xref&gt; 两个因子库内的函数，分别封装在 wq101alpha.dos 和 gtja191Alpha.dos 模块中。这两个模块实现了批流一体，用户可以方便地通过函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;116:417&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;streamEngineParser&lt;/codeph&gt; 实现模块中日频因子的流式计算。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-实现示例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.1. 实现示例&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;以 WorldQuant Alpha 101 和国泰君安 191 中的因子为例，说明日频因子流式实现方法。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;211-worldquant-alpha-1&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.1.1. WorldQuant Alpha 1&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;124:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;124:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:19;124:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑（&lt;/b&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.joinquant.com/data/dict/alpha101#alpha001&#34; scope=&#34;external&#34; xtrc=&#34;xref:4;124:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:20;124:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;Alpha001&lt;/b&gt;&lt;/xref&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:21;124:83&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;）&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(rank(Ts_ArgMax(SignedPower(((returns &amp;lt; 0) ? stddev(returns, 20) : close), 2.), 5)) - 0.5)&lt;/i&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:22;128:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 实现代码&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;130:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def wqAlpha1(close){ ts = mimax(pow(iif(ratios(close) - 1 &amp;lt; 0, mstd(ratios(close) - 1, 20), close), 2.0), 5) return rowRank(X=ts, percent=true) - 0.5 }&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:23;137:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;实时流计算&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 colName = `securityID`dateTime`preClosePx`openPx`highPx`lowPx`lastPx`volume`amount`iopv`fp_Volume`fp_Amount colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;] inputTable = table(1:0, colName, colType) resultTable = table(10000:0, [&#34;dateTime&#34;, &#34;securityID&#34;, &#34;factor&#34;], [TIMESTAMP, SYMBOL, DOUBLE]) // 使用 streamEngineParser 创建引擎流水线 try{ dropStreamEngine(&#34;alpha1Parser0&#34;)} catch(ex){ print(ex) } try{ dropStreamEngine(&#34;alpha1Parser1&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[securityid, wqAlpha1(preClosePx)]&amp;gt; streamEngine = streamEngineParser(name=&#34;alpha1Parser&#34;, metrics=metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;, timeColumn=`dateTime, triggeringPattern='keyCount', triggeringInterval=3000) // 查看引擎 getStreamEngineStat() /* ReactiveStreamEngine-&amp;gt; name user status lastErrMsg numGroups numRows numMetrics memoryInUsed snapshotDir ... ------------- ----- ------ ---------- --------- ------- ---------- ------------ ----------- alpha1Parser0 admin OK 0 0 2 13392 ... CrossSectionalEngine-&amp;gt; name user status lastErrMsg numRows numMetrics metrics triggering...triggering...... ------------ ----- ------ ---------- ------- ---------- ------------ --------------- --------------- --- alpha1Parser1admin OK 0 2 securityid...keyCount 3000 ... */&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;上述代码创建了一个名为 “alpha1Parser” 的引擎流水线。通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;167:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;getStreamEngineStat&lt;/codeph&gt; 函数可以观察到，该引擎流水线由一个名为 “alpha1Parser0” 的响应式状态引擎和一个名为 “alpha1Parser1” 的横截面引擎组成。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;其中 securityID 作为分组键，dateTime 是时间列，输入的消息格式同内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;169:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;inputTable&lt;/codeph&gt;，需要计算的指标定义在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;169:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;metrics&lt;/codeph&gt; 里，结果输出到内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;169:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;resultTable&lt;/codeph&gt; 中。横截面数据计算的触发方式是 keyCount，即当前时间的数据累积超过 3000 条或者新时间点的数据到来才会触发一次计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 向引擎添加数据 insert into streamEngine values(`000001, 2023.01.01, 30.85, 30.90, 31.65, 30.55, 31.45, 100, 3085, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.01, 30.86, 30.55, 31.35, 29.85, 30.75, 120, 3703.2, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.02, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.02, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.03, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.03, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.04, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.04, 30.85, 30.95, 31.65, 30.55, 31.45, 270, 8329.5, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.05, 30.86, 30.55, 31.35, 29.85, 30.75, 360, 11109.6, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.05, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.06, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.06, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.07, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.07, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.08, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.08, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0) // 查看结果 select factor from resultTable pivot by dateTime, securityID /* dateTime 000001 000002 ----------------------- ------ ------ 2023.01.01T00:00:00.000 2023.01.02T00:00:00.000 2023.01.03T00:00:00.000 2023.01.04T00:00:00.000 2023.01.05T00:00:00.000 0.5 0 2023.01.06T00:00:00.000 0.5 0 2023.01.07T00:00:00.000 0 0.5 */&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;212-国泰君安-001-因子&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.1.2. 国泰君安 001 因子&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;**因子计算逻辑（&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.joinquant.com/data/dict/alpha191#alpha001&#34; scope=&#34;external&#34; xtrc=&#34;xref:5;211:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;国泰君安001因子&lt;/xref&gt;）：&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(-1 * CORR(RANK(DELTA(LOG(VOLUME),1)),RANK(((CLOSE-OPEN)/OPEN)),6)&lt;/i&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:24;215:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 实现代码&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def gtjaAlpha1(open, close, vol){ delta = deltas(log(vol)) return -1 * (mcorr(rowRank(delta, percent=true), rowRank((close - open) \ open, percent=true), 6)) }&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:25;224:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;实时流计算&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 colName = `securityID`dateTime`preClosePx`openPx`highPx`lowPx`lastPx`volume`amount`iopv`fp_Volume`fp_Amount colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;] inputTable = table(1:0, colName, colType) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 streamEngineParser 创建引擎流水线 try{ dropStreamEngine(&#34;gtja1Parser0&#34;)} catch(ex){ print(ex) } try{ dropStreamEngine(&#34;gtja1Parser1&#34;)} catch(ex){ print(ex) } try{ dropStreamEngine(&#34;gtja1Parser2&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[gtjaAlpha1(openPx, preClosePx, volume)]&amp;gt; streamEngine = streamEngineParser(name=&#34;gtja1Parser&#34;, metrics=metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;, timeColumn=`dateTime, triggeringPattern='keyCount', triggeringInterval=3000) // 查看引擎 getStreamEngineStat() /* ReactiveStreamEngine-&amp;gt; name user status lastErrMsg numGroups numRows numMetrics memoryInUsed snapshotDir ... ------------ ----- ------ ---------- --------- ------- ---------- ------------ ----------- gtja1Parser0 admin OK 0 0 4 808 ... gtja1Parser2 admin OK 0 0 2 872 ... CrossSectionalEngine-&amp;gt; name user status lastErrMsg numRows numMetrics metrics triggering...triggering...... ------------ ----- ------ ---------- ------- ---------- ------------ --------------- --------------- --- gtja1Parser1 admin OK 0 3 securityID...keyCount 3000 ... */&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;上述代码创建了一个名为 “gtja1Parser” 的引擎流水线。通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;256:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;getStreamEngineStat&lt;/codeph&gt; 函数可以观察到，该引擎流水线由一个名为 “gtja1Parser0” 的响应式状态引擎，一个名为 “gtja1Parser1” 的横截面引擎和一个名为 “gtja1Parser2” 的响应式状态引擎组成。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;258:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;其中 securityID 作为分组键，dateTime 是时间列，输入的消息格式同内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;258:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;inputTable&lt;/codeph&gt;，需要计算的指标定义在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;258:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;metrics&lt;/codeph&gt; 里，结果输出到内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;258:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;resultTable&lt;/codeph&gt; 中。横截面数据计算的触发方式是 keyCount，即当前时间的数据累积超过 3000 条或者新时间点的数据到来才会触发一次计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;262:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 向引擎添加数据 insert into streamEngine values(`000001, 2023.01.01, 30.85, 30.90, 31.65, 30.55, 31.45, 100, 3085, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.01, 30.86, 30.55, 31.35, 29.85, 30.75, 120, 3703.2, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.02, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.02, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.03, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.03, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.04, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.04, 30.85, 30.95, 31.65, 30.55, 31.45, 270, 8329.5, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.05, 30.86, 30.55, 31.35, 29.85, 30.75, 360, 11109.6, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.05, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.06, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.06, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.07, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.07, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0) insert into streamEngine values(`000001, 2023.01.08, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0) insert into streamEngine values(`000002, 2023.01.08, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0) // 查看结果 select factor from resultTable pivot by dateTime, securityID /* dateTime 000001 000002 ----------------------- ------ ------------------ 2023.01.01T00:00:00.000 2023.01.02T00:00:00.000 2023.01.03T00:00:00.000 2023.01.04T00:00:00.000 2023.01.05T00:00:00.000 2023.01.06T00:00:00.000 -1 -1 2023.01.07T00:00:00.000 -1 -1 */&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-改写规则&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.2. 改写规则&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;300:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;在 DolphinDB 中，内置了各种流计算引擎来实现因子的流式计算。其中很重要的一步就是将因子计算逻辑转写成引擎能够正确解析并执行的函数，即改写成引擎能够识别分解的 metrics。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;302:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;302:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;302:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:26;302:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;streamEngineParser 的 metrics 的解析规则如下&lt;/b&gt;：&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;304:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;304:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;行计算系列（row 系列）函数会被分发给横截面引擎进行计算，所以涉及横截面计算的逻辑需要使用 row 系列函数。如果没有对应的 row 系列的函数，用户可以通过高阶函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;304:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;byRow&lt;/codeph&gt; 自行实现逐行计算的逻辑。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;305:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;305:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;305:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rolling&lt;/codeph&gt;函数会被分发给时序聚合引擎进行计算，所以涉及时序窗口的计算需要使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;305:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rolling&lt;/codeph&gt; 函数。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;306:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;306:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;其余所有计算会被分发给响应式状态引擎进行计算。响应式状态引擎因子的具体转写注意事项，见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#高频因子流式实现&#34; xtrc=&#34;xref:6;306:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;高频因子流式实现&lt;/xref&gt;。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;308:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;以 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#国泰君安-001-因子&#34; xtrc=&#34;xref:7;308:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;国泰君安-001-因子&lt;/xref&gt;的国泰君安 191 的 1 号因子为例说明上述解析规则。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;310:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def gtjaAlpha1(open, close, vol){ delta = deltas(log(vol)) return -1 * (mcorr(rowRank(delta, percent=true), rowRank((close - open) \ open, percent=true), 6)) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;其中 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;317:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;delta = deltas(log(vol))&lt;/codeph&gt; 不属于 row 系列函数，也不是调用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;317:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rolling&lt;/codeph&gt; 函数，会被分发到响应式状态引擎进行计算；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;317:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowRank(delta, percent=true)&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;317:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowRank((close - open) \ open, percent=true)&lt;/codeph&gt; 调用了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;317:164&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowRank&lt;/codeph&gt; 函数，会被分发到横截面引擎进行计算；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;317:192&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;-1 * (mcorr(..., ..., 6))&lt;/codeph&gt; 不属于 row 系列函数，也不是调用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;317:239&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rolling&lt;/codeph&gt; 函数，会被分发到响应式状态引擎进行计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;319:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;结合 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;319:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;getStreamEngineStat()&lt;/codeph&gt; 函数返回的结果可以得出整个引擎流水线的计算过程如下：输入数据首先传入名为 “gtja1Parser0” 的响应式状态引擎；“gtja1Parser0” 计算 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;319:107&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;delta = deltas(log(vol))&lt;/codeph&gt; 后将计算结果输出到名为 “gtja1Parser1” 的横截面引擎；“gtja1Parser1” 计算 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;319:187&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowRank(delta, percent=true)&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;319:220&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowRank((close - open) \ open, percent=true)&lt;/codeph&gt; 后将计算结果输出到名为 “gtja1Parser2” 的响应式状态引擎；“gtja1Parser2” 计算 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;319:321&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;-1 * (mcorr(..., ..., 6))&lt;/codeph&gt; 后将计算结果输出到结果表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;319:362&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;resultTable&lt;/codeph&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-注意事项&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.3. 注意事项&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;323:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;（1）横截面引擎的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;323:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;timeColumn&lt;/i&gt; 参数只支持 TIMESTAMP 类型。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;325:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;（2）因为不同引擎的输出表的各列顺序不同，所以输出表结构的定义需要根据因子的最后一步逻辑来决定。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;时序聚合引擎：输出表的各列的顺序为：时间列，分组列，计算结果列。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;响应式状态引擎：输出表的各列的顺序为：分组列，时间列，计算结果列。（响应式状态引擎的输出表中时间列不是必须的，但是因为时间序列聚合引擎以及横截面引擎的输入输出表需包含时间列，所以流水线中的响应式状态引擎输出时会自动增加时间列。）&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;329:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;横截面引擎：输出表的各列的顺序为：时间列，分组列 (contextByColumn)，计算结果列。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;331:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;以 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#worldquant-alpha-1&#34; xtrc=&#34;xref:8;331:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;worldquant-alpha-1&lt;/xref&gt;的 WorldQuant Alpha 101 的 1 号因子为例，最后一步计算是 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;331:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowRank(...) - 0.5&lt;/codeph&gt; 会被分发到横截面引擎内进行计算，所以结果输出表的各列的顺序为：时间列，分组列，计算结果列，即需要定义为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;331:158&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;[&#34;dateTime&#34;, &#34;securityID&#34;, &#34;factor&#34;]&lt;/codeph&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;以国泰君安191的 1 号因子为例，最后一步计算是 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;333:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;-1 * mcorr(...)&lt;/codeph&gt; 会被分发到响应式状态引擎内计算，所以结果输出表的各列的顺序应该为：分组列，时间列，计算结果列，即定义为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;333:97&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;[&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;]&lt;/codeph&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-高频因子流式实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3. 高频因子流式实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;337:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;响应式状态引擎里注入的每一条数据都会触发一次计算，产生一条结果。高频因子的实时流计算一般可以考虑使用响应式状态引擎（createReactiveStateEngine）来实现。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-实现示例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;339:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;339:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.1. 实现示例&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;339:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;311-价格涨跌幅&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;341:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;341:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.1.1. 价格涨跌幅&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;341:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;343:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;下面以基于逐笔成交数据计算价格涨跌幅为例，说明高频因子流式实现方法。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;345:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;345:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:27;345:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑（价格涨跌幅）&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;347:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;347:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradePrice[i] / tradePrice0[i-lag] - 1&lt;/i&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;349:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;349:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:28;349:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 实现代码&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;351:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;@state def pricePercentChange(price, lag){ return price \ move(price, lag) - 1 }&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;358:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;358:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:29;358:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;实时流计算&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 inputTable = table(1:0, `securityID`tradeTime`tradePrice`tradeQty`tradeAmount`buyNo`sellNo`tradeBSFlag`tradeIndex`channelNo, [SYMBOL,DATETIME,DOUBLE,INT,DOUBLE,LONG,LONG,SYMBOL,INT,INT]) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;tradeTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[tradeTime, pricePercentChange(tradePrice, 1)]&amp;gt; rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;371:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;上述代码创建了一个名为 “reactiveDemo” 响应式状态引擎，其中 securityID 作为分组键，输入的消息格式同内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;371:68&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;inputTable&lt;/codeph&gt;，需要计算的指标定义在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;371:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;metrics&lt;/codeph&gt; 里，结果输出到内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;371:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;resultTable&lt;/codeph&gt; 中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;373:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;375:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 输入数据 insert into rse values(`000155, 2020.01.01T09:30:00, 30.85, 100, 3085, 4951, 0, `B, 1, 1) insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 100, 3086, 4951, 1, `B, 2, 1) insert into rse values(`000155, 2020.01.01T09:30:02, 30.80, 200, 6160, 5501, 5600, `S, 3, 1) // 查看结果 select * from resultTable /* securityID tradeTime factor ---------- ----------------------- ------------------ 000155 2020.01.01T09:30:00.000 000155 2020.01.01T09:30:01.000 0.0003 000155 2020.01.01T09:30:02.000 -0.001944 */&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;312-加权平均价格&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.1.2. 加权平均价格&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;下面以基于快照行情数据计算加权平均价格为例，说明高频因子流式实现方法。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:30;396:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑（加权平均价格）&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;398:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;398:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) / (offerOrderQty0+bidOrderQty0)&lt;/i&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;400:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;400:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:31;400:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 实现代码&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;402:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){ return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0) }&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:32;408:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;实时流计算&lt;/b&gt;：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;410:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 colName = [&#34;securityID&#34;,&#34;dateTime&#34;,&#34;preClosePx&#34;,&#34;openPx&#34;,&#34;highPx&#34;,&#34;lowPx&#34;,&#34;lastPx&#34;,&#34;totalVolumeTrade&#34;,&#34;totalValueTrade&#34;,&#34;instrumentStatus&#34;] &amp;lt;- flatten(eachLeft(+, [&#34;bidPrice&#34;,&#34;bidOrderQty&#34;,&#34;bidNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;bidOrders&#34;+string(0..49)) &amp;lt;- flatten(eachLeft(+, [&#34;offerPrice&#34;,&#34;offerOrderQty&#34;,&#34;offerNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;offerOrders&#34;+string(0..49)) &amp;lt;- [&#34;numTrades&#34;,&#34;iopv&#34;,&#34;totalBidQty&#34;,&#34;totalOfferQty&#34;,&#34;weightedAvgBidPx&#34;,&#34;weightedAvgOfferPx&#34;,&#34;totalBidNumber&#34;,&#34;totalOfferNumber&#34;,&#34;bidTradeMaxDuration&#34;,&#34;offerTradeMaxDuration&#34;,&#34;numBidOrders&#34;,&#34;numOfferOrders&#34;,&#34;withdrawBuyNumber&#34;,&#34;withdrawBuyAmount&#34;,&#34;withdrawBuyMoney&#34;,&#34;withdrawSellNumber&#34;,&#34;withdrawSellAmount&#34;,&#34;withdrawSellMoney&#34;,&#34;etfBuyNumber&#34;,&#34;etfBuyAmount&#34;,&#34;etfBuyMoney&#34;,&#34;etfSellNumber&#34;,&#34;etfSellAmount&#34;,&#34;etfSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;] &amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70)&amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70) &amp;lt;- [&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;] resultTable = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) inputTable = table(1:0, colName, colType) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&amp;gt; rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;上述代码创建了一个名为 “reactiveDemo” 响应式状态引擎，其中 securityID 作为分组键，输入的消息格式同内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;423:68&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;inputTable&lt;/codeph&gt;，需要计算的指标定义在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;423:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;metrics&lt;/codeph&gt; 里，结果输出到内存表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;423:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;resultTable&lt;/codeph&gt; 中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 输入数据 tableInsert(rse, {&#34;securityID&#34;:&#34;000001&#34;, &#34;dateTime&#34;:2023.01.01T09:30:00.000, &#34;bidPrice0&#34;:19.98, &#34;bidOrderQty0&#34;:100, &#34;offerPrice0&#34;:19.99, &#34;offerOrderQty0&#34;:120}) tableInsert(rse, {&#34;securityID&#34;:&#34;000001&#34;, &#34;dateTime&#34;:2023.01.01T09:30:03.000, &#34;bidPrice0&#34;:19.95, &#34;bidOrderQty0&#34;:130, &#34;offerPrice0&#34;:19.93, &#34;offerOrderQty0&#34;:120}) tableInsert(rse, {&#34;securityID&#34;:&#34;000001&#34;, &#34;dateTime&#34;:2023.01.01T09:30:06.000, &#34;bidPrice0&#34;:19.97, &#34;bidOrderQty0&#34;:120, &#34;offerPrice0&#34;:19.98, &#34;offerOrderQty0&#34;:130}) // 查看结果 select * from resultTable /* securityID dateTime factor ---------- ----------------------- ------------------ 000001 2023.01.01T09:30:00.000 19.9845 000001 2023.01.01T09:30:03.000 19.9396 000001 2023.01.01T09:30:06.000 19.9748 */&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;从上面的实现示例可以发现，通过响应式状态引擎可以方便快速地实现高频因子的流式计算。其中很重要的一步就是将因子计算逻辑转写成引擎能够正确解析并执行的函数，即改写成引擎能够识别分解的 metrics。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;下面将重点介绍如何将 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:33;446:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;“因子计算逻辑”&lt;/b&gt; 转写为适配响应式状态引擎 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:34;446:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;“DDB 实现代码”&lt;/b&gt;，以及转写过程中的一些注意事项。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-无状态函数和状态函数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.2. 无状态函数和状态函数&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;321-无状态函数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.2.1. 无状态函数&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;450:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;无状态函数是指不需要回溯历史数据，仅根据当前时刻传入的参数即可获得计算结果的函数。适合封装不依赖历史数据的计算逻辑。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:35;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;注意&lt;/b&gt;：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;456:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;如果在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;456:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;createReactiveStateEngine&lt;/codeph&gt; 里面指定了 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;456:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;keyColumn&lt;/i&gt; 参数，则响应式状态引擎内会进行分组计算。以 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:37;456:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;keyColumn=&#34;securityID&#34;&lt;/codeph&gt; 为例，引擎内会根据股票代码分组计算。那么对于同一个股票代码的数据，引擎内会逐条计算；但对于不同股票代码的数据，无状态函数在引擎内会采取向量化计算。所以传入无状态函数的参数都是向量。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;458:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;下面在前述的加权平均价格的基础上说明这个情况：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;460:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;修改因子函数，增加 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:38;460:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;print&lt;/codeph&gt; 语句，观察传入的变量 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;460:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice0&lt;/i&gt;。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;462:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){ print(typestr(bidPrice0)) // 查看 bidPrice0 的数据类型 print(bidPrice0) // 查看 bidPrice0 值 return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0) } metrics = &amp;lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&amp;gt;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;构造一批输入引擎的数据。（这批数据总共 10 条，包含 7 个不同的标的，3个重复的标的）&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;474:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;setRandomSeed(9) n = 10 securityID = take(lpad(string(1..7), 6, &#34;0&#34;), n) dateTime = 2023.01.01T09:30:00.000 + 1..n bidPrice0 = round(rand(20.0, n), 2) bidOrderQty0 = rand(200, n) offerPrice0 = round(rand(20.0, n), 2) offerOrderQty0 = rand(200, n) testData = table(securityID, dateTime, bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Streaming_computing_of_financial_quantifiers/3_1.png&#34; xtrc=&#34;image:4;486:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; dita-ot:image-width=&#34;523&#34; dita-ot:image-height=&#34;221&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;构建响应式状态引擎，并输入这批数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;490:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 colName = [&#34;securityID&#34;,&#34;dateTime&#34;,&#34;preClosePx&#34;,&#34;openPx&#34;,&#34;highPx&#34;,&#34;lowPx&#34;,&#34;lastPx&#34;,&#34;totalVolumeTrade&#34;,&#34;totalValueTrade&#34;,&#34;instrumentStatus&#34;] &amp;lt;- flatten(eachLeft(+, [&#34;bidPrice&#34;,&#34;bidOrderQty&#34;,&#34;bidNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;bidOrders&#34;+string(0..49)) &amp;lt;- flatten(eachLeft(+, [&#34;offerPrice&#34;,&#34;offerOrderQty&#34;,&#34;offerNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;offerOrders&#34;+string(0..49)) &amp;lt;- [&#34;numTrades&#34;,&#34;iopv&#34;,&#34;totalBidQty&#34;,&#34;totalOfferQty&#34;,&#34;weightedAvgBidPx&#34;,&#34;weightedAvgOfferPx&#34;,&#34;totalBidNumber&#34;,&#34;totalOfferNumber&#34;,&#34;bidTradeMaxDuration&#34;,&#34;offerTradeMaxDuration&#34;,&#34;numBidOrders&#34;,&#34;numOfferOrders&#34;,&#34;withdrawBuyNumber&#34;,&#34;withdrawBuyAmount&#34;,&#34;withdrawBuyMoney&#34;,&#34;withdrawSellNumber&#34;,&#34;withdrawSellAmount&#34;,&#34;withdrawSellMoney&#34;,&#34;etfBuyNumber&#34;,&#34;etfBuyAmount&#34;,&#34;etfBuyMoney&#34;,&#34;etfSellNumber&#34;,&#34;etfSellAmount&#34;,&#34;etfSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;] &amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70)&amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70) &amp;lt;- [&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] inputTable = table(1:0, colName, colType) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;) // 输入数据 tableInsert(rse, testData.flip())&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Streaming_computing_of_financial_quantifiers/3_2.png&#34; xtrc=&#34;image:5;505:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; dita-ot:image-width=&#34;373&#34; dita-ot:image-height=&#34;177&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;如上所示，传入的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;507:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice0&lt;/i&gt; 是向量，并且这一批的 10 条数据会分两次计算（前 7 条不同股票代码的数据计算一次，后 3 条数据计算一次）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因此，转写因子的时候需要&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:36;509:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;注意参数的数据类型和函数支持的数据类型是否匹配&lt;/b&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;511:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;比如计算加权平均价格时，增加一层判断逻辑：若 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:9;511:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice0&lt;/i&gt; &amp;gt; 0，则计算 wap；否则返回默认值 default。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, default){ if(bidPrice0 &amp;gt; 0){ return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)} return default } metrics = &amp;lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, 0.0)]&amp;gt;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;522:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;如果在响应式状态引擎的 metrics 里直接调用上面的自定义函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:39;522:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAveragedPrice&lt;/codeph&gt;，会报错。因为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:40;522:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if(condition){}else{}&lt;/codeph&gt; 里面，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:10;522:93&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;condition&lt;/i&gt; 要求必须是一个标量，而传参 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:11;522:119&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice0&lt;/i&gt; 是向量，所以会报错 “A scalar object is expected. But the actual object is a vector.”&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;524:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;针对这个问题，通用的解决方案是：使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:41;524:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;each&lt;/codeph&gt;/&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:42;524:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;loop&lt;/codeph&gt; 把函数应用到向量的每个元素上。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;526:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;对于上面的例子就是：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:43;526:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAveragedPrice&lt;/codeph&gt; 的写法不变，在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:44;526:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factorWeightedAveragedPrice&lt;/codeph&gt; 里调用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:45;526:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;each&lt;/codeph&gt; 函数把函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:46;526:90&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAveragedPrice&lt;/codeph&gt; 应用到指定参数的每个元素上，使得传入函数的参数是标量。在 metrics 里则调用最外层的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:47;526:160&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factorWeightedAveragedPrice&lt;/codeph&gt; 函数。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;528:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){ return each(weightedAveragedPrice{default=0.0}, bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0) } metrics = &amp;lt;[dateTime, factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&amp;gt;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;536:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;上述处理方法是通用方法。但对于 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:48;536:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt;， DolphinDB 里有函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:49;536:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif&lt;/codeph&gt; 可以替代，并且更推荐使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:50;536:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif&lt;/codeph&gt;。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;538:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){ default = 0.0 return iif(bidPrice0 &amp;gt; 0, (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0), default) } metrics = &amp;lt;[dateTime, factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&amp;gt;&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;322-状态函数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;547:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;547:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.2.2. 状态函数&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;547:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;549:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态函数是指计算中不仅用到当前数据，还会用到历史数据的函数。比如 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#价格涨跌幅&#34; xtrc=&#34;xref:9;549:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;价格涨跌幅&lt;/xref&gt;中的价格涨跌幅，不仅需要当前的价格数据，还需要前 lag 条的历史价格数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;551:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:37;551:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;注意&lt;/b&gt;：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;553:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(1)状态函数需要用 @state 声明。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;555:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(2)状态函数内只支持赋值语句，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:51;555:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;return&lt;/codeph&gt; 语句和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:52;555:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 语句。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;557:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;其中 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:53;557:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 语句只支持 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:12;557:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;condition&lt;/i&gt; 是一个无关上游表格数据的标量。以 3.1.1 章节中的价格涨跌幅为例：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:54;557:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;pricePercentChange(price, lag)&lt;/codeph&gt; 的参数中 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:13;557:105&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;price&lt;/i&gt; 是上游数据表中的一列， &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:14;557:125&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lag&lt;/i&gt; 是另外指定的窗口大小。所以状态函数里 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:55;557:150&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if(lag&amp;gt;30){}&lt;/codeph&gt; 的判断是可以的；但是 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:56;557:176&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if(price&amp;gt;0){}&lt;/codeph&gt; 的判断是不行的，需要转化成 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:57;557:206&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif&lt;/codeph&gt; 语句 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:58;557:215&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif(price&amp;gt;0, , )&lt;/codeph&gt;。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;559:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 以下写法中 price 来自上游表格，所以 price &amp;gt; 0 实时更新，不会是标量，这样的 if-else 暂时不支持 @state def pricePercentChange(price, lag){ if(price&amp;gt;0){ return price \ move(price, lag) - 1 }else{ return 0 } } // 以下写法中 lag 来自引擎定义时的额外指定，所以 lag&amp;gt;30 是个固定结果，是个标量，这样的 if-else 可以支持 @state def pricePercentChange(price, lag){ if(lag&amp;gt;30){ return price \ move(price, lag) - 1 }else{ return price \ move(price, 30) - 1 } }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;581:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(3)状态函数支持 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:59;581:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowSum&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:60;581:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowMax&lt;/codeph&gt; 等 row 系列函数和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:61;581:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;cumSum&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:62;581:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;cumMax&lt;/codeph&gt; 等 cum 系列函数，但不支持 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:63;581:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;sum&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:64;581:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;max&lt;/codeph&gt; 等聚合函数。如果要在状态函数里面调用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:65;581:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;sum&lt;/codeph&gt; 等聚合函数，可以用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:66;581:122&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowSum&lt;/codeph&gt; 等 row 系列函数替代。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;583:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;比如：求当前价格和倒数第 lag 条数据的价格的最大值。（&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:15;583:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;max(tradePrice[i], tradePrice[i-lag])&lt;/i&gt;）&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;585:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 因子实现 @state def maxPrice(price, lag){ return rowMax([price, move(price, lag)]) } // 定义输入输出的表结构 inputTable = table(1:0, `securityID`tradeTime`tradePrice`TradeQty`TradeAmount`BuyNo`SellNo`TradeBSFlag`TradeIndex`ChannelNo, [SYMBOL,DATETIME,DOUBLE,INT,DOUBLE,LONG,LONG,SYMBOL,INT,INT]) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;tradeTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[tradeTime, maxPrice(tradePrice, 2)]&amp;gt; rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;) // 输入数据 insert into rse values(`000155, 2020.01.01T09:30:00, 30.85, 100, 3085, 4951, 0, `B, 1, 1) insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 100, 3086, 4951, 1, `B, 2, 1) insert into rse values(`000155, 2020.01.01T09:30:02, 30.80, 200, 6160, 5501, 5600, `S, 3, 1) // 查看结果 select * from resultTable /* securityID tradeTime factor ---------- ----------------------- ------------------ 000155 2020.01.01T09:30:00.000 30.85 000155 2020.01.01T09:30:01.000 30.86 000155 2020.01.01T09:30:02.000 30.85 */&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(4) 调用状态函数的自定义函数也必须是状态函数。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;323-状态和无状态的拆分&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.2.3. 状态和无状态的拆分&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;622:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;响应式状态引擎因子都可以用&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:38;622:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;无状态函数&lt;/b&gt;和&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:39;622:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态函数&lt;/b&gt;组合实现，其中状态和无状态的拆分是最重要的一步。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;624:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;虽然有些无状态的计算在状态函数里也可以支持，比如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:67;624:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowSum&lt;/codeph&gt; 等。但是因为无状态函数实现向量化计算，且不用保存函数和变量的状态，性能表现更好。所以不建议将所有计算都写在一个状态函数里，而是要将复杂的截面计算拆分到无状态函数中，在状态函数里只保留一些自定义函数的调用和有关历史数据的操作（比如 m 系列，tm系列， fill 相关，迭代等）。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3231-移动平均买卖压力&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;626:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;626:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.2.3.1. 移动平均买卖压力&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;626:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:40;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑&lt;/b&gt;：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;630:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;Step1：计算买卖压力指标（&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;sql_performance_optimization_wap_di_rv.md&#34; xtrc=&#34;xref:10;630:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;买卖压力指标&lt;/xref&gt;）&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Streaming_computing_of_financial_quantifiers/3_3.png&#34; xtrc=&#34;image:6;632:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; dita-ot:image-width=&#34;503&#34; dita-ot:image-height=&#34;419&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;634:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;Step2：使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:68;634:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;mavg&lt;/codeph&gt; 计算过去 lag 行的移动平均买卖压力指标&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;636:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:16;636:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(press[i-lag+1]+…+press[i]) / lag&lt;/i&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;638:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:41;638:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 实现代码&lt;/b&gt;：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;640:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;640:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;640:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;用一个状态函数实现【&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:42;640:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;不建议&lt;/b&gt;】&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;642:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;@state def averagePress1(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){ bidPrice = fixedLengthArrayVector(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9) bidOrderQty = fixedLengthArrayVector(bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9) offerPrice = fixedLengthArrayVector(offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9) offerOrderQty = fixedLengthArrayVector(offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9) wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0) bidPress = rowWavg(bidOrderQty, wap \ (bidPrice - wap)) askPress = rowWavg(offerOrderQty, wap \ (offerPrice - wap)) press = log(bidPress \ askPress) return mavg(press, lag, 1) }&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;657:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;657:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;无状态函数+状态函数【&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:43;657:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;推荐&lt;/b&gt;】&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;659:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def calPress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9){ bidPrice = fixedLengthArrayVector(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9) bidOrderQty = fixedLengthArrayVector(bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9) offerPrice = fixedLengthArrayVector(offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9) offerOrderQty = fixedLengthArrayVector(offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9) wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0) bidPress = rowWavg(bidOrderQty, wap \ (bidPrice - wap)) askPress = rowWavg(offerOrderQty, wap \ (offerPrice - wap)) press = log(bidPress \ askPress) return press } @state def averagePress2(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){ press = calPress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9) return mavg(press, lag, 1) }&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3232-性能对比&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;679:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;679:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.2.3.2. 性能对比&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;679:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;681:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:44;681:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;server 版本&lt;/b&gt;：2.00.9.2 2023.03.10 JIT&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;683:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:45;683:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试数据量&lt;/b&gt;：上交所 100 只股票的某日的 Level2 快照数据，372,208 * 194 (319 M)&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;685:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:46;685:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试方案&lt;/b&gt;：通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:69;685:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;timer&lt;/codeph&gt; 函数，统计从数据灌入引擎开始到所有指标计算结束的总共耗时。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;687:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:47;687:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试结果&lt;/b&gt;：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:4;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:12;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:13;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:57;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:182;689:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:48;689:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子转写方式&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:183;689:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:49;689:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;691:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:58;691:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:184;691:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态与无状态不拆分&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:185;691:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1492.224&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:59;692:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:186;692:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态与无状态拆分&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:187;692:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;577.651&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;694:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:50;694:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试脚本&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;696:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 导入测试数据 csvPath = &#34;/hdd/hdd0/jit200ssd/server/testdata/&#34; colName = [&#34;securityID&#34;,&#34;dateTime&#34;,&#34;preClosePx&#34;,&#34;openPx&#34;,&#34;highPx&#34;,&#34;lowPx&#34;,&#34;lastPx&#34;,&#34;totalVolumeTrade&#34;,&#34;totalValueTrade&#34;,&#34;instrumentStatus&#34;] &amp;lt;- flatten(eachLeft(+, [&#34;bidPrice&#34;,&#34;bidOrderQty&#34;,&#34;bidNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;bidOrders&#34;+string(0..49)) &amp;lt;- flatten(eachLeft(+, [&#34;offerPrice&#34;,&#34;offerOrderQty&#34;,&#34;offerNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;offerOrders&#34;+string(0..49)) &amp;lt;- [&#34;numTrades&#34;,&#34;iopv&#34;,&#34;totalBidQty&#34;,&#34;totalOfferQty&#34;,&#34;weightedAvgBidPx&#34;,&#34;weightedAvgOfferPx&#34;,&#34;totalBidNumber&#34;,&#34;totalOfferNumber&#34;,&#34;bidTradeMaxDuration&#34;,&#34;offerTradeMaxDuration&#34;,&#34;numBidOrders&#34;,&#34;numOfferOrders&#34;,&#34;withdrawBuyNumber&#34;,&#34;withdrawBuyAmount&#34;,&#34;withdrawBuyMoney&#34;,&#34;withdrawSellNumber&#34;,&#34;withdrawSellAmount&#34;,&#34;withdrawSellMoney&#34;,&#34;etfBuyNumber&#34;,&#34;etfBuyAmount&#34;,&#34;etfBuyMoney&#34;,&#34;etfSellNumber&#34;,&#34;etfSellAmount&#34;,&#34;etfSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;] &amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70)&amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70) &amp;lt;- [&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] data = select * from loadText(csvPath + &#34;snapshot_100stocks_multi.csv&#34;, schema=table(colName, colType)) order by dateTime // 定义输入输出的表结构 inputTable = table(1:0, colName, colType) resultTable1 = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) resultTable2 = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 // 状态函数和无状态函数不拆分 try{ dropStreamEngine(&#34;reactiveDemo1&#34;)} catch(ex){ print(ex) } metrics1 = &amp;lt;[dateTime, averagePress1(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&amp;gt; rse1 = createReactiveStateEngine(name=&#34;reactiveDemo1&#34;, metrics =metrics1, dummyTable=inputTable, outputTable=resultTable1, keyColumn=&#34;securityID&#34;) //状态函数和无状态函数拆分 try{ dropStreamEngine(&#34;reactiveDemo2&#34;)} catch(ex){ print(ex) } metrics2 = &amp;lt;[dateTime, averagePress2(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&amp;gt; rse2 = createReactiveStateEngine(name=&#34;reactiveDemo2&#34;, metrics =metrics2, dummyTable=inputTable, outputTable=resultTable2, keyColumn=&#34;securityID&#34;) // 输入数据 timer rse1.append!(data) timer rse2.append!(data) // 计算结果正确性验证 each(eqObj, resultTable1.values(), resultTable2.values()).all()&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3233-注意事项&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;726:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;726:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.2.3.3. 注意事项&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;726:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;728:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(1) 因为响应式状态引擎计算时的特殊处理，所以不是所有数据类型的变量都可以作为参数和返回值在状态函数和无状态函数之间传递的。状态函数和无状态函数间的参数可以是标量、向量或者数组向量 (Array Vector)，不能是元组 (ANY Vector) 等数据类型。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;730:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;下面通过 print 打印从状态函数到无状态函数的参数的数据类型和数据值来说明这个现象。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;732:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 因子实现 def typeTestNonStateFunc(scalar, vector, arrayVector, anyVector){ print(&#34;---------------------------------------&#34;) print(typestr(scalar)) print(scalar) print(typestr(vector)) print(vector) print(typestr(arrayVector)) print(arrayVector) print(typestr(anyVector)) print(anyVector) return fixedLengthArrayVector(rowSum(arrayVector), rowAvg(arrayVector)) } @state def typeTestStateFunc(price1, price2, price3, lag){ scalar = lag vector = price1 arrayVector = fixedLengthArrayVector(price1, price2, price3) anyVector = [price1, price2, price3] res = typeTestNonStateFunc(scalar, vector, arrayVector, anyVector) sumRes = res[0] avgRes = res[1] return sumRes, avgRes, res, anyVector }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;760:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;其中 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:17;760:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lag&lt;/i&gt; 是外部指定的一个定值，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:18;760:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;price1&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:19;760:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;price2&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:20;760:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;price3&lt;/i&gt; 是上游表中的三列，通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:70;760:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;fixedLengthArrayVector&lt;/codeph&gt; 可以将多个向量组装成 arrayVector，通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:71;760:111&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;[price1, price2, price3]&lt;/codeph&gt; 可以拼装出元组（tuple）。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;762:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 inputTable = table(1:0, `securityID`tradeTime`price1`price2`price3, [SYMBOL,DATETIME,DOUBLE,DOUBLE,DOUBLE]) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;tradeTime&#34;, &#34;sum&#34;, &#34;avg&#34;, &#34;sum_avg&#34;, &#34;anyVector&#34;], [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE,DOUBLE[], DOUBLE[]]) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[tradeTime, typeTestStateFunc(price1, price2, price3, 10) as `sum`avg`sum_avg`anyVector]&amp;gt; rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;) // 输入数据 insert into rse values(`000155, 2020.01.01T09:30:00, 30.81, 30.82, 30.83) insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 30.87, 30.88) insert into rse values(`000155, 2020.01.01T09:30:02, 30.80, 30.81, 30.82) // 查看结果 select * from resultTable /* securityID tradeTime sum avg sum_avg anyVector ---------- ----------------------- ------ ------ ----------------------- --------- 000155 2020.01.01T09:30:00.000 92.46 30.82 [92.46,30.82] [00F] 000155 2020.01.01T09:30:01.000 92.61 30.87 [92.61,30.87] [00F] 000155 2020.01.01T09:30:02.000 92.43 30.81 [92.43,30.81] [00F] */&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Streaming_computing_of_financial_quantifiers/3_4.png&#34; xtrc=&#34;image:7;788:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; dita-ot:image-width=&#34;309&#34; dita-ot:image-height=&#34;366&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;790:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(2) 状态函数内调用自定义函数时，不支持用多个变量接收函数多个返回值（即 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:72;790:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;a,b = foo(...)&lt;/codeph&gt; 的写法）。如果无状态函数需要返回多个值，则需要用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:73;790:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;fixedLengthArrayVector&lt;/codeph&gt; 将返回结果组装成 array Vector 返回。在状态函数内，用一个变量接收，之后可以用 res[index] 的方式将返回的多个结果拆分。（可以参考上面注意事项(1) 中的例子）&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;792:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(3) 当数据组装成 array vector 后，计算函数需要改为对应的 row 系列函数或者 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:74;792:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;byRow&lt;/codeph&gt; 高阶函数。（可以参考上面注意事项(1) 中的例子，计算三个价格之和使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:75;792:94&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowSum&lt;/codeph&gt; 函数，计算三个价格的平均数使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:76;792:119&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowAvg&lt;/codeph&gt; 函数）&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-if-else&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;794:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;794:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.3. if-else&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;794:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;796:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;796:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;796:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:51;796:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;无状态函数&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;798:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;无状态函数支持 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:77;798:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 语句。但是 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:78;798:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:21;798:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;condition&lt;/i&gt; 结果必须是标量；否则需要使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:79;798:68&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif&lt;/codeph&gt; 函数替代。(可以参考上文&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#无状态函数&#34; xtrc=&#34;xref:11;798:86&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;无状态函数&lt;/xref&gt;章节中注意事项中的例子)&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;800:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;800:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:52;800:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态函数&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;802:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态函数的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:80;802:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 只支持 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:22;802:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;condition&lt;/i&gt; 是一个无关上游表格数据的标量；否则需要使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:81;802:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif&lt;/codeph&gt; 函数替代或者把 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:82;802:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 的逻辑封装成自定义的无状态函数。(可以参考上文&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#状态函数&#34; xtrc=&#34;xref:12;802:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;状态函数&lt;/xref&gt;章节中注意事项第二部分)&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:53;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;注意事项&lt;/b&gt;：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:83;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif&lt;/codeph&gt; 函数的计算是把 trueResult 和 falseResult 的结果都计算出来，再根据 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:23;806:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;condition&lt;/i&gt; 拼装结果。所以需要保证，trueResult 和 falseResult 的两个式子在所有输入下都可以执行不报错。比如：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:84;806:125&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;y=iif(size(x) &amp;gt; 0, sum(x), 0.0)&lt;/codeph&gt;，如果输入的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:85;806:165&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;x=[]&lt;/codeph&gt; ，虽然 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:86;806:176&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;size(x) &amp;gt; 0&lt;/codeph&gt; 不满足条件应该直接返回 0.0，但是 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:87;806:209&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iif&lt;/codeph&gt; 会把两种情况的式子都计算一遍，所以 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:88;806:233&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;sum(x)&lt;/codeph&gt; 还是会被计算。而 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:89;806:251&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;sum(x)&lt;/codeph&gt; 的输入不允许是空向量，所以这个式子在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:90;806:279&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;x=[]&lt;/codeph&gt; 的情况下会报错。这时就需要换成 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:91;806:302&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 语句：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:92;806:315&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if(size(x)&amp;gt;0){y=sum(x)}else{y=0}&lt;/codeph&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;34-历史数据访问窗口计算和迭代&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;808:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;808:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.4. 历史数据访问（窗口计算和迭代）&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;808:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;810:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 内置了丰富的计算函数来帮助用户在状态函数里面实现各种涉及历史数据的计算。比如：滑动窗口系列（m 系列）、时序滑动窗口系列（tm 系列）、累计窗口系列（cum 系列）、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:93;810:94&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;ffill&lt;/codeph&gt;等函数。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;812:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;除此之外，还有 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:94;812:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;movingWindowData&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:95;812:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tmovingWindowData&lt;/codeph&gt; 可以直接返回变量历史值组成的向量，方便用户实现更多的自定义计算。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;814:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;虽然状态函数内不支持函数自身调用的写法，但是 DolphinDB 提供了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:96;814:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;conditionalIterate&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:97;814:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;stateIterate&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:98;814:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;genericStateIterate&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:99;814:96&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;genericTStateIterate&lt;/codeph&gt; 等函数来支持迭代逻辑的实现以及其他对函数结果历史值的复杂处理。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;816:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;下面以一个自定义的复杂因子为例。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;818:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;818:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;818:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:54;818:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑&lt;/b&gt;：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;820:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;step1：对最近 lag 条快照的第一档量价数据按照指定的权重做加权平均得到新的量价数据【使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:100;820:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;moving&lt;/codeph&gt;】&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;822:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:24;822:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice = bidPrice0[i-lag+1]*weight[0] + … + bidPrice0[i]*weight[lag-1]&lt;/i&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;824:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:25;824:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;askPrice = offerPrice0[i-lag+1]*weight[0] + … + offerPrice0[i]*weight[lag-1]&lt;/i&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;826:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:26;826:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidVolume = bidOrderQty0[i-lag+1]*weight[0] + … + bidOrderQty0[i]*weight[lag-1]&lt;/i&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;828:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:27;828:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;askVolume = offerOrderQty0[i-lag+1]*weight[0] + … + offerOrderQty0[i]*weight[lag-1]&lt;/i&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;830:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;step2：使用 Step1 的结果计算移动平均加权价格 maWAP【使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:101;830:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;mavg&lt;/codeph&gt;】&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;832:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;step3：因子结果是最近 lag-1 个因子值和当前 maWAP 的加权平均【使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:102;832:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;genericStateIterate&lt;/codeph&gt;】&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;834:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;834:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;其中权重由最近 lag 个 bidVolume / askVolume 的值确定【使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:103;834:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;movingWindowData&lt;/codeph&gt;】&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;835:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;835:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:28;835:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;w[i] = bidVolume[i-lag]/askVolume[i-lag]&lt;/i&gt;&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;836:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;836:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:29;836:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factor[i]=(factor[i-lag+1]*w[i-lag+1] +…+ factor[i-1]*w[i-1] + maWAP[i]*w[i]) / (w[i-lag+1] +…+ w[i])&lt;/i&gt;&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;838:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;838:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:55;838:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DDB 实现代码&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;840:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;defg myWavg(x){ weight = 1..size(x) return wavg(x, weight) } def iterateFunc(historyFactors, currentValue, weight){ return wavg(historyFactors join currentValue, weight) } @state def myFactor(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, lag){ // step1: 使用 moving bidPrice, askPrice, bidVolume, askVolume = moving(myWavg, bidPrice0, lag, 1), moving(myWavg, offerPrice0, lag, 1), moving(myWavg, bidOrderQty0, lag, 1), moving(myWavg, offerOrderQty0, lag, 1) // step2: 使用 mavg wap = (bidPrice*askVolume + askPrice*bidVolume) \ (bidVolume + askVolume) maWap = mavg(wap, lag, 1) // step3: 使用 movingWindowData w = movingWindowData(bidVolume \ askVolume, lag) // 使用 genericStateIterate factorValue = genericStateIterate(X=[maWap, w], initial=maWap, window=lag-1, func=iterateFunc{ , , }) return factorValue }&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;867:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;867:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:56;867:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;实时流计算&lt;/b&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:28;869:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 colName = [&#34;securityID&#34;,&#34;dateTime&#34;,&#34;preClosePx&#34;,&#34;openPx&#34;,&#34;highPx&#34;,&#34;lowPx&#34;,&#34;lastPx&#34;,&#34;totalVolumeTrade&#34;,&#34;totalValueTrade&#34;,&#34;instrumentStatus&#34;] &amp;lt;- flatten(eachLeft(+, [&#34;bidPrice&#34;,&#34;bidOrderQty&#34;,&#34;bidNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;bidOrders&#34;+string(0..49)) &amp;lt;- flatten(eachLeft(+, [&#34;offerPrice&#34;,&#34;offerOrderQty&#34;,&#34;offerNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;offerOrders&#34;+string(0..49)) &amp;lt;- [&#34;numTrades&#34;,&#34;iopv&#34;,&#34;totalBidQty&#34;,&#34;totalOfferQty&#34;,&#34;weightedAvgBidPx&#34;,&#34;weightedAvgOfferPx&#34;,&#34;totalBidNumber&#34;,&#34;totalOfferNumber&#34;,&#34;bidTradeMaxDuration&#34;,&#34;offerTradeMaxDuration&#34;,&#34;numBidOrders&#34;,&#34;numOfferOrders&#34;,&#34;withdrawBuyNumber&#34;,&#34;withdrawBuyAmount&#34;,&#34;withdrawBuyMoney&#34;,&#34;withdrawSellNumber&#34;,&#34;withdrawSellAmount&#34;,&#34;withdrawSellMoney&#34;,&#34;etfBuyNumber&#34;,&#34;etfBuyAmount&#34;,&#34;etfBuyMoney&#34;,&#34;etfSellNumber&#34;,&#34;etfSellAmount&#34;,&#34;etfSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;] &amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70)&amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70) &amp;lt;- [&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] inputTable = table(1:0, colName, colType) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[dateTime, myFactor(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, 3)]&amp;gt; rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;) // 输入数据 tableInsert(rse, {&#34;securityID&#34;:&#34;000001&#34;, &#34;dateTime&#34;:2023.01.01T09:30:00.000, &#34;bidPrice0&#34;:19.98, &#34;bidOrderQty0&#34;:100, &#34;offerPrice0&#34;:19.99, &#34;offerOrderQty0&#34;:120}) tableInsert(rse, {&#34;securityID&#34;:&#34;000001&#34;, &#34;dateTime&#34;:2023.01.01T09:30:03.000, &#34;bidPrice0&#34;:19.95, &#34;bidOrderQty0&#34;:130, &#34;offerPrice0&#34;:19.93, &#34;offerOrderQty0&#34;:120}) tableInsert(rse, {&#34;securityID&#34;:&#34;000001&#34;, &#34;dateTime&#34;:2023.01.01T09:30:06.000, &#34;bidPrice0&#34;:19.97, &#34;bidOrderQty0&#34;:120, &#34;offerPrice0&#34;:19.98, &#34;offerOrderQty0&#34;:130}) tableInsert(rse, {&#34;securityID&#34;:&#34;000001&#34;, &#34;dateTime&#34;:2023.01.01T09:30:09.000, &#34;bidPrice0&#34;:20.00, &#34;bidOrderQty0&#34;:130, &#34;offerPrice0&#34;:19.97, &#34;offerOrderQty0&#34;:140}) // 查看结果 select * from resultTable /* securityID dateTime factor ---------- ----------------------- ------------------ 000001 2023.01.01T09:30:00.000 19.9845 000001 2023.01.01T09:30:03.000 19.9698 000001 2023.01.01T09:30:06.000 19.9736 000001 2023.01.01T09:30:09.000 19.9694 */&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;900:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:57;900:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;注意&lt;/b&gt;：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:18;902:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;902:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;高阶函数 moving(func, …)中的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:30;902:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;func&lt;/i&gt; 是一个聚合函数，需要用 defg 定义 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:104;902:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;func&lt;/codeph&gt; 函数。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;903:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态函数不支持函数自身调用的写法，所以遇到需要历史因子值的逻辑时（比如当前计算值为空，就用上一个因子值填充）会很难表示。为此，DolphinDB 提供了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:105;903:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;conditionalIterate&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:106;903:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;genericStateIterate&lt;/codeph&gt; 等函数。但是，这些函数记录的不是因子函数最终 return 的结果，而是截至该函数所在当前行代码运行后计算的结果。所以，为了正确的取到因子函数的历史结果，逻辑上需要把 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:107;903:207&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;conditionalIterate&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:108;903:228&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;genericStateIterate&lt;/codeph&gt; 等函数放在整个状态函数的最后一步。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;905:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;用下面的例子说明具体情况。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:29;907:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;@state def iterateTestFunc(tradePrice){ // 计算交易价格涨跌幅 change = tradePrice \ prev(tradePrice) - 1 // 如果计算结果是空值，则用上一个非空因子值填充 factor = conditionalIterate(change != NULL, change, cumlastNot) // 返回 factor+1 作为最终因子值 return factor + 1 }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:113;919:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;创建响应式状态引擎并输入几条数据观察结果。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:30;921:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 inputTable = table(1:0, `securityID`tradeTime`tradePrice`tradeQty`tradeAmount`buyNo`sellNo`tradeBSFlag`tradeIndex`channelNo, [SYMBOL,DATETIME,DOUBLE,INT,DOUBLE,LONG,LONG,SYMBOL,INT,INT]) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;tradeTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[tradeTime, iterateTestFunc(tradePrice)]&amp;gt; rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;) // 输入数据 insert into rse values(`000155, 2020.01.01T09:30:00, 30.85, 100, 3085, 4951, 0, `B, 1, 1) insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 100, 3086, 4951, 1, `B, 2, 1) insert into rse values(`000155, 2020.01.01T09:30:02, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL) insert into rse values(`000155, 2020.01.01T09:30:03, 30.80, 200, 6160, 5501, 5600, `S, 3, 1) // 查看结果 select * from resultTable /* securityID tradeTime factor ---------- ----------------------- ---------------- 000155 2020.01.01T09:30:00.000 000155 2020.01.01T09:30:01.000 1.0003 000155 2020.01.01T09:30:02.000 1.0003 000155 2020.01.01T09:30:03.000 1.0003 */&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;6&#34; xtrc=&#34;tgroup:5;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:14;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:15;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:16;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:17;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:18;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:19;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:60;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:188;949:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:58;949:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradeTime&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:189;949:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:59;949:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradePrice&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:190;949:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:60;949:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;change&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:191;949:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:61;949:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;cumlastNot&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:192;949:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:62;949:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factor=conditionalIterate(…)&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:193;949:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:63;949:107&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iterateTestFunc(tradePrice)&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;951:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:61;951:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:194;951:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:00&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:195;951:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;30.85&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:196;951:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:197;951:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:198;951:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:199;951:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:62;952:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:200;952:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:01&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:201;952:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;30.86&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:202;952:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:203;952:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:204;952:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:205;952:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.0003&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:63;953:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:206;953:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:02&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:207;953:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:208;953:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:209;953:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:210;953:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:211;953:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.0003&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:64;954:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:212;954:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:03&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:213;954:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;30.80&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:214;954:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:215;954:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:216;954:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:217;954:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.0003&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:114;956:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;可以发现，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:109;956:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factor = conditionalIterate(change != NULL, change, cumlastNot)&lt;/codeph&gt; 这一行中的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:31;956:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;cumlastNot&lt;/i&gt; 找的不是因子函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:110;956:100&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iterateTestFunc(tradePrice)&lt;/codeph&gt; 的上一个非空值，而是 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:111;956:141&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factor&lt;/codeph&gt; 的上一个非空值，最后 return 中的 factor+1 这一步操作并不会被 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:112;956:190&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;conditionalIterate&lt;/codeph&gt; 函数记录。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:115;958:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;如果对历史因子值有后续操作，可以考虑使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:113;958:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;stateIterate&lt;/codeph&gt;、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:114;958:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;genericStateIterate&lt;/codeph&gt; 等函数。比如上面的例子可以改写为：（&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:115;958:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;genericStateIterate&lt;/codeph&gt; 函数的 window 有限制，window &amp;gt;= 2；目前已经开发新功能支持 window = 1，该功能会加在后续版本中）&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:31;960:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 当前要求 window &amp;gt;= 2，所以回看上一个数据也需要 window=2 def processFunc(historyFactor, change){ lastFactor = last(historyFactor) factor = iif(change != NULL, change, lastFactor) return factor+1 } @state def iterateTestFunc(tradePrice){ // 计算交易价格涨跌幅 change = tradePrice \ prev(tradePrice) - 1 // 如果计算结果是空值，则用上一个因子值填充，返回 factor+1 作为最终因子值 factor = genericStateIterate(X=[change], initial=change, window=2, func=processFunc) return factor } // 后续支持 window=1，则可以用以下代码替换 /* def processFunc(lastFactor, change){ factor = iif(change != NULL, change, lastFactor) return factor+1 } @state def iterateTestFunc(tradePrice){ // 计算交易价格涨跌幅 change = tradePrice \ prev(tradePrice) - 1 // 如果计算结果是空值，则用上一个因子值填充，返回 factor+1 作为最终因子值 factor = genericStateIterate(X=[change], initial=change, window=1, func=processFunc) return factor } */&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;6&#34; xtrc=&#34;tgroup:6;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:20;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:21;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:22;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:23;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:24;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:25;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:65;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:218;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:64;993:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradeTime&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:219;993:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:65;993:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;tradePrice&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:220;993:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:66;993:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;change&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:221;993:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:67;993:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;lastFactor&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:222;993:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:68;993:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factor=iif(..)&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:223;993:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:69;993:93&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;iterateTestFunc(tradePrice)&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;995:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:66;995:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:224;995:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:00&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:225;995:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;30.85&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:226;995:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:227;995:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:228;995:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:229;995:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:67;996:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:230;996:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:01&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:231;996:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;30.86&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:232;996:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:233;996:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:234;996:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;0.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:235;996:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.0003&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:68;997:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:236;997:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:02&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:237;997:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:238;997:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:239;997:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:240;997:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;1.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:241;997:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.0003&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:69;998:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:242;998:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2020.01.01T09:30:03&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:243;998:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;30.80&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:244;998:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;NULL&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:245;998:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:246;998:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;2.0003&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:247;998:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.0003&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;35-循环&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;1000:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;1000:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3.5. 循环&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;1000:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:116;1002:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态函数不支持 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:116;1002:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;for&lt;/codeph&gt;/&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:117;1002:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;while&lt;/codeph&gt; 等循环语句，支持使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:118;1002:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;each&lt;/codeph&gt;/&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:119;1002:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;loop&lt;/codeph&gt; 等函数实现循环逻辑。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:117;1004:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;下面以一个 python 代码实现的因子逻辑为例，说明如何在响应式状态引擎内实现循环逻辑。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:118;1006:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:70;1006:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑&lt;/b&gt;：(python 代码来源：&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://zhuanlan.zhihu.com/p/566912024&#34; scope=&#34;external&#34; xtrc=&#34;xref:13;1006:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:71;1006:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;高频因子是怎么回事 —— 正确的、错误的、与瞎编的&lt;/b&gt;&lt;/xref&gt;)&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:32;1008:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def _bid_withdraws_volume(l, n, levels=10): withdraws = 0 for price_index in range(0,4*levels, 4): now_p = n[price_index] for price_last_index in range(0,4*levels,4): if l[price_last_index] == now_p: withdraws -= min(n[price_index+1] - l[price_last_index + 1], 0) return withdraws def bid_withdraws(depth, trade): ob_values = depth.values flows = np.zeros(len(ob_values)) for i in range(1, len(ob_values)): flows[i] = _bid_withdraws_volume(ob_values[i-1], ob_values[i]) return pd.Series(flows)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:119;1026:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子代码中有两层循环，其中内层循环可以转化为向量化计算；外层循环可以使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:120;1026:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;each&lt;/codeph&gt; 函数。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:120;1028:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:72;1028:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 实现代码&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:33;1030:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 对应内层循环 def withdrawsVolumeTmp(lastPrices, lastVolumes, nowPrice, nowVolume){ withdraws = lastVolumes[lastPrices == nowPrice] - nowVolume return sum(withdraws * (withdraws &amp;gt; 0)) } // 对应外层循环 defg withdrawsVolume(prices, Volumes){ lastPrices, nowPrices = prices[0], prices[1] lastVolumes, nowVolumes = Volumes[0], Volumes[1] withdraws = each(withdrawsVolumeTmp{lastPrices, lastVolumes}, nowPrices, nowVolumes) return sum(withdraws) } @state def bidWithdrawsVolume(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9,bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, levels=10){ bidPrice = fixedLengthArrayVector(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9) bidOrderQty = fixedLengthArrayVector(bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9) return moving(withdrawsVolume, [bidPrice[0:levels], bidOrderQty[0:levels]], 2) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:121;1055:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:73;1055:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;实时流计算&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:34;1057:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 定义输入输出的表结构 colName = [&#34;securityID&#34;,&#34;dateTime&#34;,&#34;preClosePx&#34;,&#34;openPx&#34;,&#34;highPx&#34;,&#34;lowPx&#34;,&#34;lastPx&#34;,&#34;totalVolumeTrade&#34;,&#34;totalValueTrade&#34;,&#34;instrumentStatus&#34;] &amp;lt;- flatten(eachLeft(+, [&#34;bidPrice&#34;,&#34;bidOrderQty&#34;,&#34;bidNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;bidOrders&#34;+string(0..49)) &amp;lt;- flatten(eachLeft(+, [&#34;offerPrice&#34;,&#34;offerOrderQty&#34;,&#34;offerNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;offerOrders&#34;+string(0..49)) &amp;lt;- [&#34;numTrades&#34;,&#34;iopv&#34;,&#34;totalBidQty&#34;,&#34;totalOfferQty&#34;,&#34;weightedAvgBidPx&#34;,&#34;weightedAvgOfferPx&#34;,&#34;totalBidNumber&#34;,&#34;totalOfferNumber&#34;,&#34;bidTradeMaxDuration&#34;,&#34;offerTradeMaxDuration&#34;,&#34;numBidOrders&#34;,&#34;numOfferOrders&#34;,&#34;withdrawBuyNumber&#34;,&#34;withdrawBuyAmount&#34;,&#34;withdrawBuyMoney&#34;,&#34;withdrawSellNumber&#34;,&#34;withdrawSellAmount&#34;,&#34;withdrawSellMoney&#34;,&#34;etfBuyNumber&#34;,&#34;etfBuyAmount&#34;,&#34;etfBuyMoney&#34;,&#34;etfSellNumber&#34;,&#34;etfSellAmount&#34;,&#34;etfSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;] &amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70)&amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70) &amp;lt;- [&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] inputTable = table(1:0, colName, colType) resultTable = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 try{ dropStreamEngine(&#34;reactiveDemo&#34;)} catch(ex){ print(ex) } metrics = &amp;lt;[dateTime, bidWithdrawsVolume(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9,bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, levels=3)]&amp;gt; rse = createReactiveStateEngine(name=&#34;reactiveDemo&#34;, metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn=&#34;securityID&#34;) // 构造数据 setRandomSeed(9) n = 5 securityID = take(`000001, n) dateTime = 2023.01.01T09:30:00.000 + 1..n*3*1000 bidPrice0 = rand(10, n) \ 100 + 19.5 bidPrice1, bidPrice2 = bidPrice0+0.01, bidPrice0+0.02 bidOrderQty0, bidOrderQty1, bidOrderQty2 = rand(200, n), rand(200, n), rand(200, n) offerPrice0 = rand(10, n) \ 100 + 19.5 offerPrice1, offerPrice2 = offerPrice0+0.01, offerPrice0+0.02 offerOrderQty0, offerOrderQty1, offerOrderQty2 = rand(200, n), rand(200, n), rand(200, n) testdata = table(securityID, dateTime, bidPrice0, bidPrice1, bidPrice2, bidOrderQty0, bidOrderQty1, bidOrderQty2, offerPrice0, offerPrice1, offerPrice2, offerOrderQty0, offerOrderQty1, offerOrderQty2) // 输入数据 tableInsert(rse, testdata.flip()) // 查看结果 select * from resultTable /* securityID dateTime factor ---------- ----------------------- ------ 000001 2023.01.01T09:30:03.000 000001 2023.01.01T09:30:06.000 000001 2023.01.01T09:30:09.000 0 000001 2023.01.01T09:30:12.000 36 000001 2023.01.01T09:30:15.000 26 */&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-进阶高频因子流式实现优化&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;1099:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;1099:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;4. 进阶：高频因子流式实现优化&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;1099:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-数组向量-array-vector&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;1101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:28;1101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;4.1. 数组向量 (array vector)&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;1101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:122;1103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 中的数组向量 (array vector) 是一种特殊的向量，用于存储可变长度的二维数组。这种存储方式可显著简化某些常用的查询与计算。若不同列中含有大量重复数据，使用数组向量存储亦可提高数据压缩比，提升查询速度。数组向量可以与标量、向量或另一个数组向量进行二元运算，能够方便因子计算逻辑的向量化实现。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:123;1105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;level 2 高频因子往往需要对十档量价数据进行频繁的操作。从&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#高频因子流式实现&#34; xtrc=&#34;xref:14;1105:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;高频因子流式实现&lt;/xref&gt;的例子中也可以发现，为了让十档量价数据能够方便地实现向量化计算，往往需要通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:121;1105:93&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;fixedLengthArrayVector&lt;/codeph&gt; 函数组合十档数据。针对这个特点，可以选择直接使用数组向量 (array vector) 来存储原始的 level 2 快照行情数据，省去函数内组装十档数据的步骤，降低流式计算延时。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:124;1107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;比如 “&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#移动平均买卖压力&#34; xtrc=&#34;xref:15;1107:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;移动平均买卖压力&lt;/xref&gt;” 章节中的复杂因子，其 arrayVector 的实现代码如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:19;1109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;1109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:125;1109:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:74;1109:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DDB 实现代码&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:35;1111:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def pressArrayVector(bidPrice, bidOrderQty, offerPrice, offerOrderQty){ wap = (bidPrice[0]*offerOrderQty[0] + offerPrice[0]*bidOrderQty[0]) \ (offerOrderQty[0]+bidOrderQty[0]) bidPress = rowWavg(bidOrderQty, wap \ (bidPrice - wap)) askPress = rowWavg(offerOrderQty, wap \ (offerPrice - wap)) press = log(bidPress \ askPress) return press } @state def averagePress3(bidPrice, bidOrderQty, offerPrice, offerOrderQty, lag){ press = pressArrayVector(bidPrice, bidOrderQty, offerPrice, offerOrderQty) return mavg(press, lag, 1) }&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;1127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:126;1127:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:75;1127:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;注意事项&lt;/b&gt;：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:127;1129:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(1) 对 array vector 类型的数据进行操作时，往往需要使用 row 系列函数或者 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:122;1129:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;byRow&lt;/codeph&gt; 高阶函数。比如，对十档买方价格求和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:123;1129:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;rowSum(bidPrice)&lt;/codeph&gt; 。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:128;1131:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(2) array vector 类型的列在数据插入时要求数据类型的强一致性。比如，引擎里 dummyTable 定义了 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:32;1131:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidOrderQty&lt;/i&gt; 的数据类型是 INT[]，则上游输入数据表中对应列的数据类型必须也是 INT[]。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:129;1133:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(3) 因为对 array vector 的切片索引也是有开销的，所以并不是所有因子转化为 array vector 的形式都会有性能提升。如果因子涉及对十档数据的大量复杂操作，则使用 array vector 作为输入会有明显的性能提升；如果因子只是对某档数据进行计算，比如计算中只会使用到的第一档数据，那么更适合多档多列的存储方式。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-即时编译jit&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;1136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:29;1136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;4.2. 即时编译(JIT)&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;1136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:130;1138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 底层由 C++ 实现，脚本中的一次函数调用会转化为多次 C++ 内的虚拟函数调用。在不能使用向量化的情况下，解释成本会比较高。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:131;1140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 中的即时编译功能，在运行时将代码翻译为机器码，能够显著提高了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:124;1140:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;for&lt;/codeph&gt; 循环，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:125;1140:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;while&lt;/codeph&gt; 循环和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:126;1140:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 等语句的运行速度，特别适合于无法使用向量化运算但又对运行速度有极高要求的场景，例如高频因子计算、实时流数据处理等。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:132;1142:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;JIT 的详细使用方法可以参考教程：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;jit.md&#34; xtrc=&#34;xref:16;1142:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB JIT教程&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:133;1144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;本章节主要介绍响应式状态引擎中 JIT 版本因子转写时的注意事项。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:134;1146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;响应式状态引擎因子是&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:76;1146:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;状态函数&lt;/b&gt;和&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:77;1146:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;无状态函数&lt;/b&gt;的组合。JIT 版本的因子和非 JIT 版本的因子转写的主要区别在&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:78;1146:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;无状态函数&lt;/b&gt;，状态函数的转写没有区别。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:20;1148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;1148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:135;1148:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:79;1148:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;区别 1&lt;/b&gt;：jit 函数需要 @jit 标识。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;1149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:136;1149:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:80;1149:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;区别 2&lt;/b&gt;：普通的无状态函数没有函数使用限制；JIT 版本目前仅支持部分函数。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:137;1151:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;JIT 中不支持的函数，需要用户通过公式展开、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:127;1151:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;for&lt;/codeph&gt;/&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:128;1151:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;while&lt;/codeph&gt;循环语句、&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:129;1151:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 语句等方式自己手动实现。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:138;1153:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(1) 下面以计算买方十档成交额之和为例，说明如何使用公式展开的方法实现 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:130;1153:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;sum&lt;/codeph&gt; 函数。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:139;1155:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:81;1155:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑&lt;/b&gt;： &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:33;1155:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;bidPrice0*bidOrderQty0 + … + bidPrice9*bidOrderQty9&lt;/i&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:140;1157:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:82;1157:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DDB 实现代码(公式展开)&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:36;1159:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;@jit def calAmount(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9){ return bidPrice0*bidOrderQty0+bidPrice1*bidOrderQty1+bidPrice2*bidOrderQty2+bidPrice3*bidOrderQty3+bidPrice4*bidOrderQty4+bidPrice5*bidOrderQty5+bidPrice6*bidOrderQty6+bidPrice7*bidOrderQty7+bidPrice8*bidOrderQty8+bidPrice9*bidOrderQty9 }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:141;1166:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;(2) 下面以计算买方十档成交额中的最大值为例，说明如何使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:131;1166:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;for&lt;/codeph&gt;/&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:132;1166:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;while&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:133;1166:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt; 语句实现 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:134;1166:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;max&lt;/codeph&gt; 函数&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:142;1168:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:83;1168:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子计算逻辑&lt;/b&gt;： &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:34;1168:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;max(bidPrice0*bidOrderQty0, …, bidPrice9*bidOrderQty9)&lt;/i&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:143;1170:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:84;1170:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;DolphinDB 实现代码 (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:135;1170:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;for&lt;/codeph&gt; 循环+&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:136;1170:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;if-else&lt;/codeph&gt;)&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:37;1172:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;@jit def calAmountMax(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9){ amount = [bidPrice0*bidOrderQty0, bidPrice1*bidOrderQty1, bidPrice2*bidOrderQty2, bidPrice3*bidOrderQty3, bidPrice4*bidOrderQty4, bidPrice5*bidOrderQty5, bidPrice6*bidOrderQty6, bidPrice7*bidOrderQty7, bidPrice8*bidOrderQty8, bidPrice9*bidOrderQty9] maxRes = -1.0 for(i in 0:10){ if(amount[i] &amp;gt; maxRes) maxRes = amount[i] } return maxRes }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:144;1183:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;注意事项：在给变量设置初始值或者默认值的时候，需要注意变量数据类型的前后一致性。比如这个例子中，变量 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:137;1183:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;maxRes&lt;/codeph&gt; 是 DOUBLE 类型的，则设置初始值的时候需要 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:138;1183:90&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;maxRes=-1.0&lt;/codeph&gt; ，而不能 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:139;1183:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;maxRes=-1&lt;/codeph&gt; 。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;1185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:145;1185:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:85;1185:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;区别 3&lt;/b&gt;：普通的无状态函数多标情况下，传参是向量（详情见“&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#无状态函数&#34; xtrc=&#34;xref:17;1185:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;无状态函数&lt;/xref&gt;” 章节中的注意事项）；JIT 版本中，传参是标量，所以不需要再用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:140;1185:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;each&lt;/codeph&gt;/&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:141;1185:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;loop&lt;/codeph&gt; 多一层额外的处理。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:146;1187:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;以 “无状态函数” 章节的注意事项中的例子为例。可以直接在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:142;1187:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;weightedAveragedPrice&lt;/codeph&gt; 函数外面加 @jit 标识，而不需要在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:143;1187:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;factorWeightedAveragedPrice&lt;/codeph&gt; 函数里多一层 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:144;1187:116&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;each&lt;/codeph&gt; 的处理&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:38;1189:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 因子实现 @jit def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, default){ if(bidPrice0 &amp;gt; 0){ return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)} return default } metrics = &amp;lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, 0.0)]&amp;gt;&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;1200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:147;1200:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:86;1200:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;区别 4&lt;/b&gt;：JIT 版本中可以通过 vector[index] 的方式来获取向量中指定位置的数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:148;1202:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;但是其中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:145;1202:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;index&lt;/codeph&gt; 只能是标量（index = 0）或者是向量（index=0..5），不能是数据对（index = 0:5）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:149;1204:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;（上述写法中，index=0..5 左闭右闭；index=0:5 左闭右开）&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;1206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:150;1206:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:87;1206:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;区别 5&lt;/b&gt;：JIT 版本中函数定义里不能设置默认参数。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:151;1208:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;比如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:146;1208:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def foo(x, y){}&lt;/codeph&gt; 是可以的，但 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:147;1208:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def foo(x, y=1){}&lt;/codeph&gt; 不可以。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;43-性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:28;1211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:30;1211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;4.3. 性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:28;1211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:152;1213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:88;1213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;server 版本&lt;/b&gt;：2.00.9.2 2023.03.10 JIT&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:153;1215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:89;1215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试数据量&lt;/b&gt;：上交所 100 只股票的某日的 Level2 快照数据 (372,208 条数据)&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:154;1217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:90;1217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试方案&lt;/b&gt;：通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:148;1217:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;timer&lt;/codeph&gt; 函数，统计从数据灌入引擎开始到所有指标计算结束的总共耗时。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:155;1219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:91;1219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试结果&lt;/b&gt;：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;1221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:7;1221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:26;1221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:27;1221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;1221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:70;1221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:248;1221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:92;1221:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;因子转写方式&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:249;1221:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:93;1221:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;1223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:71;1223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:250;1223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档多列&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:251;1223:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;6368.81&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:72;1224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:252;1224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档 array vector&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:253;1224:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;3727.03&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:73;1225:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:254;1225:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档多列 + JIT&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:255;1225:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;771.13&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:74;1226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:256;1226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档 array vector + JIT&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:257;1226:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;458.56&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:156;1228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:94;1228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试因子&lt;/b&gt;：十档量价数据除去空档数据后，计算移动平均买卖压力（公式见 “移动平均买卖压力”章节）&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:157;1230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档多列&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:39;1232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def calPress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9){ bidPrice = [bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9] bidOrderQty = [bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9] offerPrice = [offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9] offerOrderQty = [offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9] // 除去空档数据 bidPrice, bidOrderQty = bidPrice[bidPrice &amp;gt; 0], bidOrderQty[bidPrice &amp;gt; 0] offerPrice, offerOrderQty = offerPrice[offerPrice &amp;gt; 0], offerOrderQty[offerPrice &amp;gt; 0] // 计算买卖压力指标 wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0) bidPress = wavg(bidOrderQty, wap \ (bidPrice - wap)) askPress = wavg(offerOrderQty, wap \ (offerPrice - wap)) press = log(bidPress \ askPress) return press.nullFill(0.0) } @state def averagePress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){ press = each(calPress, bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9) return mavg(press, lag, 1) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:158;1256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档 array vector&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:40;1258:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;def calPressArray(bidPrices, bidOrderQtys, offerPrices, offerOrderQtys){ // 除去空档数据 bidPrice, bidOrderQty = bidPrices[bidPrices &amp;gt; 0], bidOrderQtys[bidPrices &amp;gt; 0] offerPrice, offerOrderQty = offerPrices[offerPrices &amp;gt; 0], offerOrderQtys[offerPrices &amp;gt; 0] // 计算买卖压力指标 wap = (bidPrice[0]*offerOrderQty[0] + offerPrice[0]*bidOrderQty[0]) \ (offerOrderQty[0]+bidOrderQty[0]) bidPress = wavg(bidOrderQty, wap \ (bidPrice - wap)) askPress = wavg(offerOrderQty, wap \ (offerPrice - wap)) press = log(bidPress \ askPress) return press.nullFill(0.0) } @state def averagePressArray(bidPrice, bidOrderQty, offerPrice, offerOrderQty, lag){ press = each(calPressArray, bidPrice, bidOrderQty, offerPrice, offerOrderQty) return mavg(press, lag, 1) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:159;1278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档多列 + JIT&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:41;1280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;@jit def calPressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9){ bidPrice = [bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9] bidOrderQty = [bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9] offerPrice = [offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9] offerOrderQty = [offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9] wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0) bidPress = 0.0 bidWeightSum = 0.0 askPress = 0.0 askWeightSum = 0.0 for(i in 0:10){ if(bidPrice[i] &amp;gt; 0){ weight = wap \ (bidPrice[i] - wap) bidWeightSum += weight bidPress += bidOrderQty[i] * weight } if(offerPrice[i] &amp;gt; 0){ weight = wap \ (offerPrice[i] - wap) askWeightSum += weight askPress += offerOrderQty[i] * weight } } bidPress = bidPress \ bidWeightSum askPress = askPress \ askWeightSum press = log(bidPress \ askPress) return press } @state def averagePressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){ press = calPressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9) return mavg(press.nullFill(0.0), lag, 1) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:160;1318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档 array vector + JIT&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:42;1320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;@jit def calPressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty){ // 计算买卖压力指标 wap = (bidPrice[0]*offerOrderQty[0] + offerPrice[0]*bidOrderQty[0]) \ (offerOrderQty[0]+bidOrderQty[0]) bidPress = 0.0 bidWeightSum = 0.0 askPress = 0.0 askWeightSum = 0.0 for(i in 0:10){ if(bidPrice[i] &amp;gt; 0){ weight = wap \ (bidPrice[i] - wap) bidWeightSum += weight bidPress += bidOrderQty[i] * weight } if(offerPrice[i] &amp;gt; 0){ weight = wap \ (offerPrice[i] - wap) askWeightSum += weight askPress += offerOrderQty[i] * weight } } bidPress = bidPress \ bidWeightSum askPress = askPress \ askWeightSum press = log(bidPress \ askPress) return press } @state def averagePressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty, lag){ press = calPressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty) return mavg(press.nullFill(0.0), lag, 1) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:161;1354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:95;1354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;测试脚本&lt;/b&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:43;1356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;// 导入测试数据 csvPath = &#34;/hdd/hdd0/jit200ssd/server/testdata/&#34; // 快照多档多列 colName = [&#34;securityID&#34;,&#34;dateTime&#34;,&#34;preClosePx&#34;,&#34;openPx&#34;,&#34;highPx&#34;,&#34;lowPx&#34;,&#34;lastPx&#34;,&#34;totalVolumeTrade&#34;,&#34;totalValueTrade&#34;,&#34;instrumentStatus&#34;] &amp;lt;- flatten(eachLeft(+, [&#34;bidPrice&#34;,&#34;bidOrderQty&#34;,&#34;bidNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;bidOrders&#34;+string(0..49)) &amp;lt;- flatten(eachLeft(+, [&#34;offerPrice&#34;,&#34;offerOrderQty&#34;,&#34;offerNumOrders&#34;], string(0..9))) &amp;lt;- (&#34;offerOrders&#34;+string(0..49)) &amp;lt;- [&#34;numTrades&#34;,&#34;iopv&#34;,&#34;totalBidQty&#34;,&#34;totalOfferQty&#34;,&#34;weightedAvgBidPx&#34;,&#34;weightedAvgOfferPx&#34;,&#34;totalBidNumber&#34;,&#34;totalOfferNumber&#34;,&#34;bidTradeMaxDuration&#34;,&#34;offerTradeMaxDuration&#34;,&#34;numBidOrders&#34;,&#34;numOfferOrders&#34;,&#34;withdrawBuyNumber&#34;,&#34;withdrawBuyAmount&#34;,&#34;withdrawBuyMoney&#34;,&#34;withdrawSellNumber&#34;,&#34;withdrawSellAmount&#34;,&#34;withdrawSellMoney&#34;,&#34;etfBuyNumber&#34;,&#34;etfBuyAmount&#34;,&#34;etfBuyMoney&#34;,&#34;etfSellNumber&#34;,&#34;etfSellAmount&#34;,&#34;etfSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;] &amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70)&amp;lt;- take(&#34;DOUBLE&#34;, 10) &amp;lt;- take(&#34;INT&#34;, 70) &amp;lt;- [&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] data = select * from loadText(csvPath + &#34;snapshot_100stocks_multi.csv&#34;, schema=table(colName, colType)) order by dateTime, securityID // 快照多档 array vector colName = [&#34;securityID&#34;,&#34;dateTime&#34;,&#34;preClosePx&#34;,&#34;openPx&#34;,&#34;highPx&#34;,&#34;lowPx&#34;,&#34;lastPx&#34;,&#34;totalVolumeTrade&#34;,&#34;totalValueTrade&#34;,&#34;instrumentStatus&#34;,&#34;bidPrice&#34;,&#34;bidOrderQty&#34;,&#34;bidNumOrders&#34;,&#34;bidOrders&#34;,&#34;offerPrice&#34;,&#34;offerOrderQty&#34;,&#34;offerNumOrders&#34;,&#34;offerOrders&#34;,&#34;numTrades&#34;,&#34;iopv&#34;,&#34;totalBidQty&#34;,&#34;totalOfferQty&#34;,&#34;weightedAvgBidPx&#34;,&#34;weightedAvgOfferPx&#34;,&#34;totalBidNumber&#34;,&#34;totalOfferNumber&#34;,&#34;bidTradeMaxDuration&#34;,&#34;offerTradeMaxDuration&#34;,&#34;numBidOrders&#34;,&#34;numOfferOrders&#34;,&#34;withdrawBuyNumber&#34;,&#34;withdrawBuyAmount&#34;,&#34;withdrawBuyMoney&#34;,&#34;withdrawSellNumber&#34;,&#34;withdrawSellAmount&#34;,&#34;withdrawSellMoney&#34;,&#34;etfBuyNumber&#34;,&#34;etfBuyAmount&#34;,&#34;etfBuyMoney&#34;,&#34;etfSellNumber&#34;,&#34;etfSellAmount&#34;,&#34;etfSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;,&#34;DOUBLE[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;DOUBLE[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] dataArrayVector = select * from loadText(csvPath + &#34;snapshot_100stocks_arrayvector.csv&#34;, schema=table(colName, colType)) order by dateTime, securityID // 定义输入输出的表结构 inputTable = table(1:0, data.schema().colDefs.name, data.schema().colDefs.typeString) inputTableArrayVector = table(1:0, dataArrayVector.schema().colDefs.name, dataArrayVector.schema().colDefs.typeString) resultTable1 = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) resultTable2 = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) resultTable3 = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) resultTable4 = table(10000:0, [&#34;securityID&#34;, &#34;dateTime&#34;, &#34;factor&#34;], [SYMBOL, TIMESTAMP, DOUBLE]) // 使用 createReactiveStateEngine 创建响应式状态引擎 // 多档多列 try{ dropStreamEngine(&#34;reactiveDemo1&#34;)} catch(ex){ print(ex) } metrics1 = &amp;lt;[dateTime, averagePress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&amp;gt; rse1 = createReactiveStateEngine(name=&#34;reactiveDemo1&#34;, metrics =metrics1, dummyTable=inputTable, outputTable=resultTable1, keyColumn=&#34;securityID&#34;, keepOrder=true) // 多档 arrayvector try{ dropStreamEngine(&#34;reactiveDemo2&#34;)} catch(ex){ print(ex) } metrics2 = &amp;lt;[dateTime, averagePressArray(bidPrice, bidOrderQty, offerPrice, offerOrderQty, 60)]&amp;gt; rse2 = createReactiveStateEngine(name=&#34;reactiveDemo2&#34;, metrics =metrics2, dummyTable=inputTableArrayVector, outputTable=resultTable2, keyColumn=&#34;securityID&#34;, keepOrder=true) // 多档多列 + jit try{ dropStreamEngine(&#34;reactiveDemo3&#34;)} catch(ex){ print(ex) } metrics3 = &amp;lt;[dateTime, averagePressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&amp;gt; rse3 = createReactiveStateEngine(name=&#34;reactiveDemo3&#34;, metrics =metrics3, dummyTable=inputTable, outputTable=resultTable3, keyColumn=&#34;securityID&#34;, keepOrder=true) // 多档 arrayvector + jit try{ dropStreamEngine(&#34;reactiveDemo4&#34;)} catch(ex){ print(ex) } metrics4 = &amp;lt;[dateTime, averagePressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty, 60)]&amp;gt; rse4 = createReactiveStateEngine(name=&#34;reactiveDemo4&#34;, metrics =metrics4, dummyTable=inputTableArrayVector, outputTable=resultTable4, keyColumn=&#34;securityID&#34;, keepOrder=true) // 输入数据 timer rse1.append!(data) timer rse2.append!(dataArrayVector) timer rse3.append!(data) timer rse4.append!(dataArrayVector) // 计算结果正确性验证 assert each(eqObj, resultTable1.factor, resultTable2.factor).all() assert each(eqObj, resultTable1.factor, resultTable3.factor).all() assert each(eqObj, resultTable1.factor, resultTable4.factor).all()&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;附件&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:29;1409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:31;1409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;附件&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:29;1409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:162;1411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;多档多列与多档 array vector 的快照见以下附件：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:21;1413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;1413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;https://www.dolphindb.cn/downloads/docs/Streaming_computing_of_financial_quantifiers.zip&#34; scope=&#34;external&#34; xtrc=&#34;xref:18;1413:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;snapshot_100stocks_arrayvector.zip&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;1414:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;https://www.dolphindb.cn/downloads/docs/Streaming_computing_of_financial_quantifiers.zip&#34; scope=&#34;external&#34; xtrc=&#34;xref:19;1414:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md&#34;&gt;&lt;?ditaot usertext?&gt;snapshot_100stocks_multi.zip&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/dita&gt;"/><meta name="wh-source-relpath" content="tutorials/str_comp_fin_quant.md file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/str_comp_fin_quant.md"/><meta name="wh-out-relpath" content="tutorials/str_comp_fin_quant.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="chap7_tutorials_streaming"><div class="title"><a href="../stream/str_intro.html"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/streaming_auto_sub.html">金融场景应用案例</a></div></div></li><li class="active"><div class="topicref" data-id="金融因子流式实现"><div class="title"><a href="../tutorials/str_comp_fin_quant.html">金融因子流式实现</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="streamfunctions-d9713e3813" class="topicref" data-id="streamfunctions" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action streamfunctions-d9713e3813-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_funcs.html" id="streamfunctions-d9713e3813-link">功能简介</a></div></div></li><li role="treeitem"><div data-tocid="入门示例-01实时计算买卖价差-d9713e4044" class="topicref" data-id="入门示例-01实时计算买卖价差" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/try_example1.html" id="入门示例-01实时计算买卖价差-d9713e4044-link">入门示例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="内置流式计算算子-d9713e4090" class="topicref" data-id="内置流式计算算子" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 内置流式计算算子-d9713e4090-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_operator.html" id="内置流式计算算子-d9713e4090-link"><span class="keyword label">流式计算算子</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="streamingEngineTopic-d9713e4229" class="topicref" data-id="streamingEngineTopic" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action streamingEngineTopic-d9713e4229-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/themes/streamingEngine.html" id="streamingEngineTopic-d9713e4229-link"><span class="keyword label">流计算引擎</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e4506" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e4506-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_join_engine.html" id="chap7_tutorials_streaming-d9713e4506-link"><span class="keyword label">内置多数据源流式关联引擎</span></a></div></div></li><li role="treeitem"><div data-tocid="streamha-d9713e4783" class="topicref" data-id="streamha" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_ha.html" id="streamha-d9713e4783-link"><span class="keyword label">流数据高可用</span></a></div></div></li><li role="treeitem"><div data-tocid="流计算状态监控-d9713e4830" class="topicref" data-id="流计算状态监控" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_monitor.html" id="流计算状态监控-d9713e4830-link">流计算状态监控</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="replay-d9713e4876" class="topicref" data-id="replay" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action replay-d9713e4876-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_replay.html" id="replay-d9713e4876-link"><span class="keyword label">历史数据回放</span></a></div></div></li><li role="treeitem"><div data-tocid="流批一体功能-d9713e5061" class="topicref" data-id="流批一体功能" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_batch.html" id="流批一体功能-d9713e5061-link"><span class="keyword label">流批一体</span></a></div></div></li><li role="treeitem"><div data-tocid="streamengineparser-解析原理介绍-d9713e5108" class="topicref" data-id="streamengineparser-解析原理介绍" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_eng_parser.html" id="streamengineparser-解析原理介绍-d9713e5108-link">StreamEngineParser 解析原理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="realtime_data_acces-d9713e5155" class="topicref" data-id="realtime_data_acces" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action realtime_data_acces-d9713e5155-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/realtime_data_acces.html" id="realtime_data_acces-d9713e5155-link">实时流数据接入</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="cep-d9713e5617" class="topicref" data-id="cep" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action cep-d9713e5617-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/cep.html" id="cep-d9713e5617-link">复杂事件处理（CEP）引擎</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e6123" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e6123-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/local_sub.html" id="tocId-d9713e6123-link">流处理结果交互方式</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e6312" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e6312-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_altair.html" id="tocId-d9713e6312-link">数据可视化工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e6405" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e6405-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_auto_sub.html" id="tocId-d9713e6405-link">金融场景应用案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="节点启动时的流计算自动订阅-d9713e6406" class="topicref" data-id="节点启动时的流计算自动订阅" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_auto_sub.html" id="节点启动时的流计算自动订阅-d9713e6406-link">节点启动时的流计算自动订阅</a></div></div></li><li role="treeitem"><div data-tocid="k-线计算-d9713e6452" class="topicref" data-id="k-线计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC.html" id="k-线计算-d9713e6452-link">K 线计算</a></div></div></li><li role="treeitem" class="active"><div data-tocid="金融因子流式实现-d9713e6498" class="topicref" data-id="金融因子流式实现" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/str_comp_fin_quant.html" id="金融因子流式实现-d9713e6498-link">金融因子流式实现</a></div></div></li><li role="treeitem"><div data-tocid="多数据源流式实时关联处理-d9713e6544" class="topicref" data-id="多数据源流式实时关联处理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing.html" id="多数据源流式实时关联处理-d9713e6544-link">多数据源流式实时关联处理</a></div></div></li><li role="treeitem"><div data-tocid="实时计算高频因子-d9713e6590" class="topicref" data-id="实时计算高频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hf_factor_streaming.html" id="实时计算高频因子-d9713e6590-link">实时计算高频因子</a></div></div></li><li role="treeitem"><div data-tocid="股票行情回放-d9713e6636" class="topicref" data-id="股票行情回放" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_market_replay.html" id="股票行情回放-d9713e6636-link">股票行情回放</a></div></div></li><li role="treeitem"><div data-tocid="金融实时实际波动率预测-d9713e6682" class="topicref" data-id="金融实时实际波动率预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ml_volatility.html" id="金融实时实际波动率预测-d9713e6682-link">金融实时实际波动率预测</a></div></div></li><li role="treeitem"><div data-tocid="开发股票波动率预测模型的-676-个输入特征-d9713e6728" class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/metacode_derived_features.html" id="开发股票波动率预测模型的-676-个输入特征-d9713e6728-link">开发股票波动率预测模型的 676 个输入特征</a></div></div></li><li role="treeitem"><div data-tocid="实时计算日累计逐单资金流-d9713e6774" class="topicref" data-id="实时计算日累计逐单资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_daily.html" id="实时计算日累计逐单资金流-d9713e6774-link">实时计算日累计逐单资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算分钟资金流-d9713e6820" class="topicref" data-id="实时计算分钟资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_order_by_order.html" id="实时计算分钟资金流-d9713e6820-link">实时计算分钟资金流</a></div></div></li><li role="treeitem"><div data-tocid="流式计算中证-1000-指数主买主卖交易量-d9713e6866" class="topicref" data-id="流式计算中证-1000-指数主买主卖交易量" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/CSI_1000.html" id="流式计算中证-1000-指数主买主卖交易量-d9713e6866-link">流式计算中证 1000 指数主买/主卖交易量</a></div></div></li><li role="treeitem"><div data-tocid="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e6913" class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_snapshot_factor_calc.html" id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e6913-link">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="处理-level-2-行情数据实例-d9713e6959" class="topicref" data-id="处理-level-2-行情数据实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_stk_data_proc.html" id="处理-level-2-行情数据实例-d9713e6959-link">处理 Level-2 行情数据实例</a></div></div></li><li role="treeitem"><div data-tocid="实时计算涨幅榜-d9713e7005" class="topicref" data-id="实时计算涨幅榜" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/rt_stk_price_inc_calc.html" id="实时计算涨幅榜-d9713e7005-link">实时计算涨幅榜</a></div></div></li><li role="treeitem"><div data-tocid="基金份额参考价值-iopv-计算-d9713e7051" class="topicref" data-id="基金份额参考价值-iopv-计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_IOPV.html" id="基金份额参考价值-iopv-计算-d9713e7051-link">基金份额参考价值 IOPV 计算</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7097" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7097-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_str_app_iot.html" id="tocId-d9713e7097-link">物联网场景应用案例</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="" role="article" aria-labelledby="ariaid-title1"><article class="nested0" aria-labelledby="ariaid-title1" id="金融因子流式实现"><h1 class="- topic/title title topictitle1" id="ariaid-title1">金融因子流式实现</h1><div class="- topic/body body"><p class="- topic/p p">DolphinDB 是一款高性能分布式时序数据库。与传统的关系数据库和常见的时序数据库不同，DolphinDB 不仅提供了高速存取时序数据的基本功能，而且内置了向量化的多范式编程语言与强大的计算引擎。DolphinDB 的计算引擎不仅可以用于量化金融的回测和研发，也可以用于生产环境的实时计算，譬如各种频率的金融量化因子的流式实时计算。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-概述"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 概述</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="11-dolphindb-流计算框架"><h3 class="- topic/title title topictitle3" id="ariaid-title3">1.1. DolphinDB 流计算框架</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 内置的流数据框架支持流数据的发布，订阅，预处理，实时内存计算，复杂指标的滚动窗口计算、滑动窗口计算、累计窗口计算等，是一个运行高效、使用便捷的流数据处理框架。</p><img class="- topic/image image" src="../stream/images/str_comp_fin_quant_1.png"/><br/><p class="- topic/p p">本教程主要介绍如何在 <strong class="+ topic/ph hi-d/b ph b">“流数据表 ——&gt; 订阅者(内置流计算引擎) ——&gt; 计算结果”</strong> 这段过程中，利用内置流计算引擎实现金融量化因子并优化之。</p><p class="- topic/p p">DolphinDB 内置流数据引擎详情可见： <a class="- topic/xref xref" href="../funcs/themes/streamingEngine.html">流数据引擎</a></p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="12-数据结构"><h3 class="- topic/title title topictitle3" id="ariaid-title4">1.2. 数据结构</h3><div class="- topic/body body"><p class="- topic/p p">本教程中的代码基于上交所 level 2 行情的日 K 线，逐笔成交，快照数据进行调试。</p><p class="- topic/p p">测试数据在 DolphinDB 中存储的表结构如下：</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（1）日 K 线</strong></p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__1"><strong class="+ topic/ph hi-d/b ph b">字段名称</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__2"><strong class="+ topic/ph hi-d/b ph b">数据说明</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__3"><strong class="+ topic/ph hi-d/b ph b">字段</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__4"><strong class="+ topic/ph hi-d/b ph b">含义</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">securityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">证券代码</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">lastPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__4">收盘价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">dateTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">日期时间</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">volume</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__4">成交量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">preClosePx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">昨收价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">amount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__4">成交金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">openPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">开始价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">iopv</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__4">净值估值</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">highPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">最高价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">fp_Volume</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__4">盘后固定价格交易成交量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__1">lowPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__2">最低价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__3">fp_Amount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__4">盘后固定价格交易成交金额</td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（2）逐笔成交</strong></p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__29"><strong class="+ topic/ph hi-d/b ph b">字段名称</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__30"><strong class="+ topic/ph hi-d/b ph b">数据说明</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__31"><strong class="+ topic/ph hi-d/b ph b">字段</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__32"><strong class="+ topic/ph hi-d/b ph b">含义</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__29">securityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__30">证券代码</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__31">buyNo</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__32">买方订单号</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__29">tradeTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__30">日期时间</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__31">sellNo</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__32">卖方订单号</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__29">tradePrice</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__30">成交价格</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__31">tradeBSFlag</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__32">内外盘标志</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__29">tradeQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__30">成交量</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__31">tradeIndex</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__32">成交序号</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__29">tradeAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__30">成交金额</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__31">channelNo</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__32">成交通道</td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（3）行情快照</strong></p><p class="- topic/p p">DolphinDB 提供了存储可变长二维数组的数据类型 array vector。在数据存储时，可以选择将数据类型相同且含义相近的多列存为一列。</p><p class="- topic/p p">因此，level 2 快照行情的多档数据可以选择：(1)多列存储；(2) 用 array vector 存为一列。</p><figure class="- topic/fig fig fignone"><figcaption data-caption-side="top" class="- topic/title title figcap"><span class="figtitleprefix fig--title-label">图<span class="fig--title-label-number"> 1</span><span class="fig--title-label-punctuation">. </span></span><span class="fig--title"><strong class="+ topic/ph hi-d/b ph b">多档多列存储，共194列</strong></span></figcaption>
<img class="- topic/image image" src="images/Streaming_computing_of_financial_quantifiers/1_2.png"/><br/>  
    
</figure><figure class="- topic/fig fig fignone"><figcaption data-caption-side="top" class="- topic/title title figcap"><span class="figtitleprefix fig--title-label">图<span class="fig--title-label-number"> 2</span><span class="fig--title-label-punctuation">. </span></span><span class="fig--title"><strong class="+ topic/ph hi-d/b ph b">array vector 存储，共42列</strong></span></figcaption>
<img class="- topic/image image" src="images/Streaming_computing_of_financial_quantifiers/1_3.png"/><br/>  
    
</figure><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__53"><strong class="+ topic/ph hi-d/b ph b">字段名称（多档多列）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__54"><strong class="+ topic/ph hi-d/b ph b">字段名称（array vector）</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="12-数据结构__entry__55"><strong class="+ topic/ph hi-d/b ph b">数据说明</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">securityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">securityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">证券代码</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">dateTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">dateTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">日期时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">preClosePx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">preClosePx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">昨收价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">openPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">openPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">开始价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">highPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">highPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">最高价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">lowPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">lowPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">最低价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">lastPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">lastPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">最新价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">totalVolumeTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">totalVolumeTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">成交总量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">totalValueTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">totalValueTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">成交总金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">instrumentStatus</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">instrumentStatus</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">交易状态</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">bidPrice0 .. bidPrice9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">bidPrice</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申买十价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">bidOrderQty0 .. bidOrderQty0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">bidOrderQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申买十量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">bidNumOrders0 .. bidNumOrders9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">bidNumOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申买十实际总委托笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">bidOrders0 .. bidOrders49</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">bidOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申买一前 50 笔订单</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">offerPrice0 .. offerPrice9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">offerPrice</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申卖十价</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">offerOrderQty0 .. offerOrderQty9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">offerOrderQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申卖十量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">offerNumOrders0 .. offerNumOrders9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">offerNumOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申卖十实际总委托笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">offerOrders0 .. offerOrders49</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">offerOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">申卖一前 50 笔订单</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">numTrades</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">numTrades</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">成交笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">iopv</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">iopv</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">ETF 净值估值</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">totalBidQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">totalBidQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">委托买入总量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">totalOfferQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">totalOfferQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">委托卖出总量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">weightedAvgBidPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">weightedAvgBidPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">加权平均委买价格</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">weightedAvgOfferPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">weightedAvgOfferPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">加权平均委卖价格</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">totalBidNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">totalBidNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">买入总笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">totalOfferNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">totalOfferNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">卖出总笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">bidTradeMaxDuration</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">bidTradeMaxDuration</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">买入成交最大等待时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">offerTradeMaxDuration</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">offerTradeMaxDuration</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">买入成交最大等待时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">numBidOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">numBidOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">买方委托价位数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">numOfferOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">numOfferOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">卖方委托价位数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">withdrawBuyNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">withdrawBuyNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">买入撤单笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">withdrawBuyAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">withdrawBuyAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">买入撤单数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">withdrawBuyMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">withdrawBuyMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">买入撤单金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">withdrawSellNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">withdrawSellNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">卖出撤单笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">withdrawSellAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">withdrawSellAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">卖出撤单数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">withdrawSellMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">withdrawSellMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">卖出撤单金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">etfBuyNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">etfBuyNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">ETF 申购笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">etfBuyAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">etfBuyAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">ETF 申购数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">etfBuyMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">etfBuyMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">ETF 申购金额</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">etfSellNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">etfSellNumber</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">ETF 赎回笔数</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">etfSellAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">etfSellAmount</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">ETF 赎回数量</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__53">etfSellMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__54">etfSellMoney</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="12-数据结构__entry__55">ETF 赎回金额</td></tr></tbody></table></div></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title5" id="2--日频因子流式实现"><h2 class="- topic/title title topictitle2" id="ariaid-title5">2.  日频因子流式实现</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 内置的流计算引擎有时间序列引擎，响应式状态引擎，横截面引擎等。在实际场景下，复杂的因子可能涉及横截面、历史状态、时序窗口三种逻辑，需要多个引擎级联才能实现因子逻辑。</p><p class="- topic/p p">为了提高转写效率，DolphinDB 提供了一个引擎流水线解析器（Stream Engine Parser）可以自动解析并创建引擎流水线，使得用户无需编写复杂的级联代码。因此复杂日频因子的实时流计算一般考虑使用 <strong class="+ topic/ph hi-d/b ph b">引擎流水线解析器</strong> 来实现。</p><p class="- topic/p p">DolphinDB 目前已经实现了 <a class="- topic/xref xref" href="https://gitee.com/dolphindb/DolphinDBModules/blob/master/wq101alpha/README_CN.md#worldquant-101-alpha-%E5%9B%A0%E5%AD%90%E6%8C%87%E6%A0%87%E5%BA%93-" target="_blank" rel="external noopener">WorldQuant 101 Alpha 因子库</a> 和 <a class="- topic/xref xref" href="https://gitee.com/dolphindb/DolphinDBModules/blob/master/gtja191Alpha/README_CN.md#/dolphindb/DolphinDBModules/blob/master/gtja191Alpha/src/gtja191Alpha.dos" target="_blank" rel="external noopener">国泰君安 191 Alphas 因子库</a> 两个因子库内的函数，分别封装在 wq101alpha.dos 和 gtja191Alpha.dos 模块中。这两个模块实现了批流一体，用户可以方便地通过函数 <code class="+ topic/ph pr-d/codeph ph codeph">streamEngineParser</code> 实现模块中日频因子的流式计算。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="21-实现示例"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.1. 实现示例</h3><div class="- topic/body body"><p class="- topic/p p">以 WorldQuant Alpha 101 和国泰君安 191 中的因子为例，说明日频因子流式实现方法。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title7" id="211-worldquant-alpha-1"><h4 class="- topic/title title topictitle4" id="ariaid-title7">2.1.1. WorldQuant Alpha 1</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑（</strong><a class="- topic/xref xref" href="https://www.joinquant.com/data/dict/alpha101#alpha001" target="_blank" rel="external noopener"><strong class="+ topic/ph hi-d/b ph b">Alpha001</strong></a><strong class="+ topic/ph hi-d/b ph b">）</strong>：</li></ul><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">(rank(Ts_ArgMax(SignedPower(((returns &lt; 0) ? stddev(returns, 20) : close), 2.), 5)) - 0.5)</em></p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 实现代码</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def wqAlpha1(close){
    ts = mimax(pow(iif(ratios(close) - 1 &lt; 0, mstd(ratios(close) - 1, 20), close), 2.0), 5)
    return rowRank(X=ts, percent=true) - 0.5
}</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">实时流计算</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
colName = `securityID`dateTime`preClosePx`openPx`highPx`lowPx`lastPx`volume`amount`iopv`fp_Volume`fp_Amount
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","DOUBLE","INT","DOUBLE"]
inputTable = table(1:0, colName, colType)
resultTable = table(10000:0, ["dateTime", "securityID", "factor"], [TIMESTAMP, SYMBOL, DOUBLE])

// 使用 streamEngineParser 创建引擎流水线
try{ dropStreamEngine("alpha1Parser0")} catch(ex){ print(ex) }
try{ dropStreamEngine("alpha1Parser1")} catch(ex){ print(ex) }
metrics = &lt;[securityid, wqAlpha1(preClosePx)]&gt;
streamEngine = streamEngineParser(name="alpha1Parser", metrics=metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID", timeColumn=`dateTime, triggeringPattern='keyCount', triggeringInterval=3000)

// 查看引擎
getStreamEngineStat()
/*
ReactiveStreamEngine-&gt;
name          user  status lastErrMsg numGroups numRows numMetrics memoryInUsed snapshotDir ...
------------- ----- ------ ---------- --------- ------- ---------- ------------ ----------- 
alpha1Parser0 admin OK                0         0       2          13392                    ...

CrossSectionalEngine-&gt;
name         user  status lastErrMsg numRows numMetrics metrics      triggering...triggering......
------------ ----- ------ ---------- ------- ---------- ------------ --------------- --------------- ---
alpha1Parser1admin OK                0       2          securityid...keyCount     3000         ...
*/</code></pre><p class="- topic/p p">上述代码创建了一个名为 “alpha1Parser” 的引擎流水线。通过 <code class="+ topic/ph pr-d/codeph ph codeph">getStreamEngineStat</code> 函数可以观察到，该引擎流水线由一个名为 “alpha1Parser0” 的响应式状态引擎和一个名为 “alpha1Parser1” 的横截面引擎组成。</p><p class="- topic/p p">其中 securityID 作为分组键，dateTime 是时间列，输入的消息格式同内存表 <code class="+ topic/ph pr-d/codeph ph codeph">inputTable</code>，需要计算的指标定义在 <code class="+ topic/ph pr-d/codeph ph codeph">metrics</code> 里，结果输出到内存表 <code class="+ topic/ph pr-d/codeph ph codeph">resultTable</code> 中。横截面数据计算的触发方式是 keyCount，即当前时间的数据累积超过 3000 条或者新时间点的数据到来才会触发一次计算。</p><p class="- topic/p p">创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 向引擎添加数据
insert into streamEngine values(`000001, 2023.01.01, 30.85, 30.90, 31.65, 30.55, 31.45, 100, 3085, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.01, 30.86, 30.55, 31.35, 29.85, 30.75, 120, 3703.2, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.02, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.02, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.03, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.03, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.04, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.04, 30.85, 30.95, 31.65, 30.55, 31.45, 270, 8329.5, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.05, 30.86, 30.55, 31.35, 29.85, 30.75, 360, 11109.6, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.05, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.06, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.06, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.07, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.07, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.08, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.08, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0)

// 查看结果
select factor from resultTable pivot by dateTime, securityID
/*
dateTime                000001 000002
----------------------- ------ ------
2023.01.01T00:00:00.000              
2023.01.02T00:00:00.000              
2023.01.03T00:00:00.000              
2023.01.04T00:00:00.000              
2023.01.05T00:00:00.000 0.5    0     
2023.01.06T00:00:00.000 0.5    0     
2023.01.07T00:00:00.000 0      0.5   
*/</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title8" id="212-国泰君安-001-因子"><h4 class="- topic/title title topictitle4" id="ariaid-title8">2.1.2. 国泰君安 001 因子</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">**因子计算逻辑（<a class="- topic/xref xref" href="https://www.joinquant.com/data/dict/alpha191#alpha001" target="_blank" rel="external noopener">国泰君安001因子</a>）：</li></ul><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">(-1 * CORR(RANK(DELTA(LOG(VOLUME),1)),RANK(((CLOSE-OPEN)/OPEN)),6)</em></p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 实现代码</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def gtjaAlpha1(open, close, vol){
	delta = deltas(log(vol)) 
    return -1 * (mcorr(rowRank(delta, percent=true), rowRank((close - open) \ open, percent=true), 6))
}</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">实时流计算</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
colName = `securityID`dateTime`preClosePx`openPx`highPx`lowPx`lastPx`volume`amount`iopv`fp_Volume`fp_Amount
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","DOUBLE","INT","DOUBLE"]
inputTable = table(1:0, colName, colType)
resultTable = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 streamEngineParser 创建引擎流水线
try{ dropStreamEngine("gtja1Parser0")} catch(ex){ print(ex) }
try{ dropStreamEngine("gtja1Parser1")} catch(ex){ print(ex) }
try{ dropStreamEngine("gtja1Parser2")} catch(ex){ print(ex) }
metrics = &lt;[gtjaAlpha1(openPx, preClosePx, volume)]&gt;
streamEngine = streamEngineParser(name="gtja1Parser", metrics=metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID", timeColumn=`dateTime, triggeringPattern='keyCount', triggeringInterval=3000)

// 查看引擎
getStreamEngineStat()
/*
ReactiveStreamEngine-&gt;
name         user  status lastErrMsg numGroups numRows numMetrics memoryInUsed snapshotDir ...
------------ ----- ------ ---------- --------- ------- ---------- ------------ ----------- 
gtja1Parser0 admin OK                0         0       4          808                      ...
gtja1Parser2 admin OK                0         0       2          872                      ...

CrossSectionalEngine-&gt;
name         user  status lastErrMsg numRows numMetrics metrics      triggering...triggering......
------------ ----- ------ ---------- ------- ---------- ------------ --------------- --------------- ---
gtja1Parser1 admin OK                0       3          securityID...keyCount     3000         ...
*/</code></pre><p class="- topic/p p">上述代码创建了一个名为 “gtja1Parser” 的引擎流水线。通过 <code class="+ topic/ph pr-d/codeph ph codeph">getStreamEngineStat</code> 函数可以观察到，该引擎流水线由一个名为 “gtja1Parser0” 的响应式状态引擎，一个名为 “gtja1Parser1” 的横截面引擎和一个名为 “gtja1Parser2” 的响应式状态引擎组成。</p><p class="- topic/p p">其中 securityID 作为分组键，dateTime 是时间列，输入的消息格式同内存表 <code class="+ topic/ph pr-d/codeph ph codeph">inputTable</code>，需要计算的指标定义在 <code class="+ topic/ph pr-d/codeph ph codeph">metrics</code> 里，结果输出到内存表 <code class="+ topic/ph pr-d/codeph ph codeph">resultTable</code> 中。横截面数据计算的触发方式是 keyCount，即当前时间的数据累积超过 3000 条或者新时间点的数据到来才会触发一次计算。</p><p class="- topic/p p">创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 向引擎添加数据
insert into streamEngine values(`000001, 2023.01.01, 30.85, 30.90, 31.65, 30.55, 31.45, 100, 3085, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.01, 30.86, 30.55, 31.35, 29.85, 30.75, 120, 3703.2, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.02, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.02, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.03, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.03, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.04, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.04, 30.85, 30.95, 31.65, 30.55, 31.45, 270, 8329.5, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.05, 30.86, 30.55, 31.35, 29.85, 30.75, 360, 11109.6, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.05, 30.80, 30.95, 31.05, 30.05, 30.85, 200, 6160, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.06, 30.81, 30.99, 31.55, 30.15, 30.65, 180, 5545.8, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.06, 30.83, 31.00, 31.35, 30.35, 30.55, 230, 7090.9, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.07, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.07, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0)
insert into streamEngine values(`000001, 2023.01.08, 30.89, 30.85, 31.10, 30.00, 30.45, 250, 7722.5, 0, 0, 0)
insert into streamEngine values(`000002, 2023.01.08, 30.90, 30.86, 31.10, 30.40, 30.75, 300, 9270, 0, 0, 0)

// 查看结果
select factor from resultTable pivot by dateTime, securityID
/*
dateTime                000001 000002            
----------------------- ------ ------------------
2023.01.01T00:00:00.000                          
2023.01.02T00:00:00.000                          
2023.01.03T00:00:00.000                          
2023.01.04T00:00:00.000                          
2023.01.05T00:00:00.000                          
2023.01.06T00:00:00.000 -1     -1
2023.01.07T00:00:00.000 -1     -1          
*/</code></pre></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="22-改写规则"><h3 class="- topic/title title topictitle3" id="ariaid-title9">2.2. 改写规则</h3><div class="- topic/body body"><p class="- topic/p p">在 DolphinDB 中，内置了各种流计算引擎来实现因子的流式计算。其中很重要的一步就是将因子计算逻辑转写成引擎能够正确解析并执行的函数，即改写成引擎能够识别分解的 metrics。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">streamEngineParser 的 metrics 的解析规则如下</strong>：</p></li><li class="- topic/li li"><p class="- topic/p p">行计算系列（row 系列）函数会被分发给横截面引擎进行计算，所以涉及横截面计算的逻辑需要使用 row 系列函数。如果没有对应的 row 系列的函数，用户可以通过高阶函数 <code class="+ topic/ph pr-d/codeph ph codeph">byRow</code> 自行实现逐行计算的逻辑。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">rolling</code>函数会被分发给时序聚合引擎进行计算，所以涉及时序窗口的计算需要使用 <code class="+ topic/ph pr-d/codeph ph codeph">rolling</code> 函数。</p></li><li class="- topic/li li"><p class="- topic/p p">其余所有计算会被分发给响应式状态引擎进行计算。响应式状态引擎因子的具体转写注意事项，见<a class="- topic/xref xref" href="#%E9%AB%98%E9%A2%91%E5%9B%A0%E5%AD%90%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0">高频因子流式实现</a>。</p></li></ul><p class="- topic/p p">以 <a class="- topic/xref xref" href="#%E5%9B%BD%E6%B3%B0%E5%90%9B%E5%AE%89-001-%E5%9B%A0%E5%AD%90">国泰君安-001-因子</a>的国泰君安 191 的 1 号因子为例说明上述解析规则。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def gtjaAlpha1(open, close, vol){
	delta = deltas(log(vol)) 
    return -1 * (mcorr(rowRank(delta, percent=true), rowRank((close - open) \ open, percent=true), 6))
}</code></pre><p class="- topic/p p">其中 <code class="+ topic/ph pr-d/codeph ph codeph">delta = deltas(log(vol))</code> 不属于 row 系列函数，也不是调用 <code class="+ topic/ph pr-d/codeph ph codeph">rolling</code> 函数，会被分发到响应式状态引擎进行计算；<code class="+ topic/ph pr-d/codeph ph codeph">rowRank(delta, percent=true)</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">rowRank((close - open) \ open, percent=true)</code> 调用了 <code class="+ topic/ph pr-d/codeph ph codeph">rowRank</code> 函数，会被分发到横截面引擎进行计算；<code class="+ topic/ph pr-d/codeph ph codeph">-1 * (mcorr(..., ..., 6))</code> 不属于 row 系列函数，也不是调用 <code class="+ topic/ph pr-d/codeph ph codeph">rolling</code> 函数，会被分发到响应式状态引擎进行计算。</p><p class="- topic/p p">结合 <code class="+ topic/ph pr-d/codeph ph codeph">getStreamEngineStat()</code> 函数返回的结果可以得出整个引擎流水线的计算过程如下：输入数据首先传入名为 “gtja1Parser0” 的响应式状态引擎；“gtja1Parser0” 计算 <code class="+ topic/ph pr-d/codeph ph codeph">delta = deltas(log(vol))</code> 后将计算结果输出到名为 “gtja1Parser1” 的横截面引擎；“gtja1Parser1”  计算 <code class="+ topic/ph pr-d/codeph ph codeph">rowRank(delta, percent=true)</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">rowRank((close - open) \ open, percent=true)</code> 后将计算结果输出到名为 “gtja1Parser2” 的响应式状态引擎；“gtja1Parser2” 计算 <code class="+ topic/ph pr-d/codeph ph codeph">-1 * (mcorr(..., ..., 6))</code> 后将计算结果输出到结果表 <code class="+ topic/ph pr-d/codeph ph codeph">resultTable</code>。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="23-注意事项"><h3 class="- topic/title title topictitle3" id="ariaid-title10">2.3. 注意事项</h3><div class="- topic/body body"><p class="- topic/p p">（1）横截面引擎的 <em class="+ topic/ph hi-d/i ph i">timeColumn</em> 参数只支持 TIMESTAMP 类型。</p><p class="- topic/p p">（2）因为不同引擎的输出表的各列顺序不同，所以输出表结构的定义需要根据因子的最后一步逻辑来决定。</p><ul class="- topic/ul ul"><li class="- topic/li li">时序聚合引擎：输出表的各列的顺序为：时间列，分组列，计算结果列。</li><li class="- topic/li li">响应式状态引擎：输出表的各列的顺序为：分组列，时间列，计算结果列。（响应式状态引擎的输出表中时间列不是必须的，但是因为时间序列聚合引擎以及横截面引擎的输入输出表需包含时间列，所以流水线中的响应式状态引擎输出时会自动增加时间列。）</li><li class="- topic/li li">横截面引擎：输出表的各列的顺序为：时间列，分组列 (contextByColumn)，计算结果列。</li></ul><p class="- topic/p p">以 <a class="- topic/xref xref" href="#worldquant-alpha-1">worldquant-alpha-1</a>的 WorldQuant Alpha 101 的 1 号因子为例，最后一步计算是 <code class="+ topic/ph pr-d/codeph ph codeph">rowRank(...) - 0.5</code> 会被分发到横截面引擎内进行计算，所以结果输出表的各列的顺序为：时间列，分组列，计算结果列，即需要定义为 <code class="+ topic/ph pr-d/codeph ph codeph">["dateTime", "securityID", "factor"]</code>。</p><p class="- topic/p p">以国泰君安191的 1 号因子为例，最后一步计算是 <code class="+ topic/ph pr-d/codeph ph codeph">-1 * mcorr(...)</code> 会被分发到响应式状态引擎内计算，所以结果输出表的各列的顺序应该为：分组列，时间列，计算结果列，即定义为 <code class="+ topic/ph pr-d/codeph ph codeph">["securityID", "dateTime", "factor"]</code>。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title11" id="3-高频因子流式实现"><h2 class="- topic/title title topictitle2" id="ariaid-title11">3. 高频因子流式实现</h2><div class="- topic/body body"><p class="- topic/p p">响应式状态引擎里注入的每一条数据都会触发一次计算，产生一条结果。高频因子的实时流计算一般可以考虑使用响应式状态引擎（createReactiveStateEngine）来实现。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="31-实现示例"><h3 class="- topic/title title topictitle3" id="ariaid-title12">3.1. 实现示例</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title13" id="311-价格涨跌幅"><h4 class="- topic/title title topictitle4" id="ariaid-title13">3.1.1. 价格涨跌幅</h4><div class="- topic/body body"><p class="- topic/p p">下面以基于逐笔成交数据计算价格涨跌幅为例，说明高频因子流式实现方法。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑（价格涨跌幅）</strong>：</li></ul><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">tradePrice[i] / tradePrice0[i-lag] - 1</em></p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 实现代码</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def pricePercentChange(price, lag){
    return price \ move(price, lag) - 1
}</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">实时流计算</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
inputTable = table(1:0, `securityID`tradeTime`tradePrice`tradeQty`tradeAmount`buyNo`sellNo`tradeBSFlag`tradeIndex`channelNo, [SYMBOL,DATETIME,DOUBLE,INT,DOUBLE,LONG,LONG,SYMBOL,INT,INT])
resultTable = table(10000:0, ["securityID", "tradeTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
metrics = &lt;[tradeTime, pricePercentChange(tradePrice, 1)]&gt;
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")</code></pre><p class="- topic/p p">上述代码创建了一个名为 “reactiveDemo” 响应式状态引擎，其中 securityID 作为分组键，输入的消息格式同内存表 <code class="+ topic/ph pr-d/codeph ph codeph">inputTable</code>，需要计算的指标定义在 <code class="+ topic/ph pr-d/codeph ph codeph">metrics</code> 里，结果输出到内存表 <code class="+ topic/ph pr-d/codeph ph codeph">resultTable</code> 中。</p><p class="- topic/p p">创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 输入数据
insert into rse values(`000155, 2020.01.01T09:30:00, 30.85, 100, 3085, 4951, 0, `B, 1, 1)
insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 100, 3086, 4951, 1, `B, 2, 1)
insert into rse values(`000155, 2020.01.01T09:30:02, 30.80, 200, 6160, 5501, 5600, `S, 3, 1)

// 查看结果
select * from resultTable
/*
securityID tradeTime               factor            
---------- ----------------------- ------------------
000155     2020.01.01T09:30:00.000                   
000155     2020.01.01T09:30:01.000 0.0003
000155     2020.01.01T09:30:02.000 -0.001944
*/</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title14" id="312-加权平均价格"><h4 class="- topic/title title topictitle4" id="ariaid-title14">3.1.2. 加权平均价格</h4><div class="- topic/body body"><p class="- topic/p p">下面以基于快照行情数据计算加权平均价格为例，说明高频因子流式实现方法。</p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑（加权平均价格）</strong>：</li></ul><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) / (offerOrderQty0+bidOrderQty0)</em></p><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 实现代码</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){
    return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)
}</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">实时流计算</strong>：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
colName = ["securityID","dateTime","preClosePx","openPx","highPx","lowPx","lastPx","totalVolumeTrade","totalValueTrade","instrumentStatus"] &lt;- flatten(eachLeft(+, ["bidPrice","bidOrderQty","bidNumOrders"], string(0..9))) &lt;- ("bidOrders"+string(0..49)) &lt;- flatten(eachLeft(+, ["offerPrice","offerOrderQty","offerNumOrders"], string(0..9))) &lt;- ("offerOrders"+string(0..49)) &lt;- ["numTrades","iopv","totalBidQty","totalOfferQty","weightedAvgBidPx","weightedAvgOfferPx","totalBidNumber","totalOfferNumber","bidTradeMaxDuration","offerTradeMaxDuration","numBidOrders","numOfferOrders","withdrawBuyNumber","withdrawBuyAmount","withdrawBuyMoney","withdrawSellNumber","withdrawSellAmount","withdrawSellMoney","etfBuyNumber","etfBuyAmount","etfBuyMoney","etfSellNumber","etfSellAmount","etfSellMoney"]
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL"] &lt;- take("DOUBLE", 10) &lt;- take("INT", 70)&lt;- take("DOUBLE", 10) &lt;- take("INT", 70) &lt;- ["INT","DOUBLE","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","DOUBLE"]
resultTable = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])
inputTable = table(1:0, colName, colType)

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
metrics = &lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&gt;
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")</code></pre><p class="- topic/p p">上述代码创建了一个名为 “reactiveDemo” 响应式状态引擎，其中 securityID 作为分组键，输入的消息格式同内存表 <code class="+ topic/ph pr-d/codeph ph codeph">inputTable</code>，需要计算的指标定义在 <code class="+ topic/ph pr-d/codeph ph codeph">metrics</code> 里，结果输出到内存表 <code class="+ topic/ph pr-d/codeph ph codeph">resultTable</code> 中。</p><p class="- topic/p p">创建完引擎之后，即可往引擎中插入几条数据，并观察计算结果。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 输入数据
tableInsert(rse, {"securityID":"000001", "dateTime":2023.01.01T09:30:00.000, "bidPrice0":19.98, "bidOrderQty0":100, "offerPrice0":19.99, "offerOrderQty0":120})
tableInsert(rse, {"securityID":"000001", "dateTime":2023.01.01T09:30:03.000, "bidPrice0":19.95, "bidOrderQty0":130, "offerPrice0":19.93, "offerOrderQty0":120})
tableInsert(rse, {"securityID":"000001", "dateTime":2023.01.01T09:30:06.000, "bidPrice0":19.97, "bidOrderQty0":120, "offerPrice0":19.98, "offerOrderQty0":130})

// 查看结果
select * from resultTable
/*
securityID dateTime                factor            
---------- ----------------------- ------------------
000001     2023.01.01T09:30:00.000 19.9845 
000001     2023.01.01T09:30:03.000 19.9396
000001     2023.01.01T09:30:06.000 19.9748
*/</code></pre><p class="- topic/p p">从上面的实现示例可以发现，通过响应式状态引擎可以方便快速地实现高频因子的流式计算。其中很重要的一步就是将因子计算逻辑转写成引擎能够正确解析并执行的函数，即改写成引擎能够识别分解的 metrics。</p><p class="- topic/p p">下面将重点介绍如何将 <strong class="+ topic/ph hi-d/b ph b">“因子计算逻辑”</strong> 转写为适配响应式状态引擎 <strong class="+ topic/ph hi-d/b ph b">“DDB 实现代码”</strong>，以及转写过程中的一些注意事项。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title15" id="32-无状态函数和状态函数"><h3 class="- topic/title title topictitle3" id="ariaid-title15">3.2. 无状态函数和状态函数</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title16" id="321-无状态函数"><h4 class="- topic/title title topictitle4" id="ariaid-title16">3.2.1. 无状态函数</h4><div class="- topic/body body"><p class="- topic/p p">无状态函数是指不需要回溯历史数据，仅根据当前时刻传入的参数即可获得计算结果的函数。适合封装不依赖历史数据的计算逻辑。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：</p><p class="- topic/p p">如果在  <code class="+ topic/ph pr-d/codeph ph codeph">createReactiveStateEngine</code> 里面指定了 <em class="+ topic/ph hi-d/i ph i">keyColumn</em> 参数，则响应式状态引擎内会进行分组计算。以 <code class="+ topic/ph pr-d/codeph ph codeph">keyColumn="securityID"</code> 为例，引擎内会根据股票代码分组计算。那么对于同一个股票代码的数据，引擎内会逐条计算；但对于不同股票代码的数据，无状态函数在引擎内会采取向量化计算。所以传入无状态函数的参数都是向量。</p><p class="- topic/p p">下面在前述的加权平均价格的基础上说明这个情况：</p><p class="- topic/p p">修改因子函数，增加 <code class="+ topic/ph pr-d/codeph ph codeph">print</code> 语句，观察传入的变量 <em class="+ topic/ph hi-d/i ph i">bidPrice0</em>。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){
    print(typestr(bidPrice0))   // 查看 bidPrice0 的数据类型
    print(bidPrice0)            // 查看 bidPrice0 值
    return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)
}

metrics = &lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&gt;</code></pre><p class="- topic/p p">构造一批输入引擎的数据。（这批数据总共 10 条，包含 7 个不同的标的，3个重复的标的）</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>setRandomSeed(9)
n = 10
securityID = take(lpad(string(1..7), 6, "0"), n)
dateTime = 2023.01.01T09:30:00.000 + 1..n
bidPrice0 = round(rand(20.0, n), 2)
bidOrderQty0 = rand(200, n)
offerPrice0 = round(rand(20.0, n), 2)
offerOrderQty0 = rand(200, n)
testData = table(securityID, dateTime, bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)</code></pre><img class="- topic/image image" src="images/Streaming_computing_of_financial_quantifiers/3_1.png"/><br/><p class="- topic/p p">构建响应式状态引擎，并输入这批数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
colName = ["securityID","dateTime","preClosePx","openPx","highPx","lowPx","lastPx","totalVolumeTrade","totalValueTrade","instrumentStatus"] &lt;- flatten(eachLeft(+, ["bidPrice","bidOrderQty","bidNumOrders"], string(0..9))) &lt;- ("bidOrders"+string(0..49)) &lt;- flatten(eachLeft(+, ["offerPrice","offerOrderQty","offerNumOrders"], string(0..9))) &lt;- ("offerOrders"+string(0..49)) &lt;- ["numTrades","iopv","totalBidQty","totalOfferQty","weightedAvgBidPx","weightedAvgOfferPx","totalBidNumber","totalOfferNumber","bidTradeMaxDuration","offerTradeMaxDuration","numBidOrders","numOfferOrders","withdrawBuyNumber","withdrawBuyAmount","withdrawBuyMoney","withdrawSellNumber","withdrawSellAmount","withdrawSellMoney","etfBuyNumber","etfBuyAmount","etfBuyMoney","etfSellNumber","etfSellAmount","etfSellMoney"]
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL"] &lt;- take("DOUBLE", 10) &lt;- take("INT", 70)&lt;- take("DOUBLE", 10) &lt;- take("INT", 70) &lt;- ["INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
inputTable = table(1:0, colName, colType)
resultTable = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")

// 输入数据
tableInsert(rse, testData.flip())</code></pre><img class="- topic/image image" src="images/Streaming_computing_of_financial_quantifiers/3_2.png"/><br/><p class="- topic/p p">如上所示，传入的 <em class="+ topic/ph hi-d/i ph i">bidPrice0</em> 是向量，并且这一批的 10 条数据会分两次计算（前 7 条不同股票代码的数据计算一次，后 3 条数据计算一次）。</p><p class="- topic/p p">因此，转写因子的时候需要<strong class="+ topic/ph hi-d/b ph b">注意参数的数据类型和函数支持的数据类型是否匹配</strong>。</p><p class="- topic/p p">比如计算加权平均价格时，增加一层判断逻辑：若 <em class="+ topic/ph hi-d/i ph i">bidPrice0</em> &gt; 0，则计算 wap；否则返回默认值 default。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, default){
    if(bidPrice0 &gt; 0){  return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)}
    return default
}

metrics = &lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, 0.0)]&gt;</code></pre><p class="- topic/p p">如果在响应式状态引擎的 metrics 里直接调用上面的自定义函数 <code class="+ topic/ph pr-d/codeph ph codeph">weightedAveragedPrice</code>，会报错。因为 <code class="+ topic/ph pr-d/codeph ph codeph">if(condition){}else{}</code> 里面，<em class="+ topic/ph hi-d/i ph i">condition</em> 要求必须是一个标量，而传参 <em class="+ topic/ph hi-d/i ph i">bidPrice0</em> 是向量，所以会报错 “A scalar object is expected. But the actual object is a vector.”</p><p class="- topic/p p">针对这个问题，通用的解决方案是：使用 <code class="+ topic/ph pr-d/codeph ph codeph">each</code>/<code class="+ topic/ph pr-d/codeph ph codeph">loop</code> 把函数应用到向量的每个元素上。</p><p class="- topic/p p">对于上面的例子就是：<code class="+ topic/ph pr-d/codeph ph codeph">weightedAveragedPrice</code> 的写法不变，在 <code class="+ topic/ph pr-d/codeph ph codeph">factorWeightedAveragedPrice</code> 里调用 <code class="+ topic/ph pr-d/codeph ph codeph">each</code> 函数把函数 <code class="+ topic/ph pr-d/codeph ph codeph">weightedAveragedPrice</code> 应用到指定参数的每个元素上，使得传入函数的参数是标量。在 metrics 里则调用最外层的 <code class="+ topic/ph pr-d/codeph ph codeph">factorWeightedAveragedPrice</code> 函数。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){
    return each(weightedAveragedPrice{default=0.0}, bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)
}

metrics = &lt;[dateTime, factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&gt;</code></pre><p class="- topic/p p">上述处理方法是通用方法。但对于 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code>， DolphinDB 里有函数 <code class="+ topic/ph pr-d/codeph ph codeph">iif</code> 可以替代，并且更推荐使用 <code class="+ topic/ph pr-d/codeph ph codeph">iif</code>。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0){
    default = 0.0
    return iif(bidPrice0 &gt; 0, (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0), default)
}

metrics = &lt;[dateTime, factorWeightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0)]&gt;</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title17" id="322-状态函数"><h4 class="- topic/title title topictitle4" id="ariaid-title17">3.2.2. 状态函数</h4><div class="- topic/body body"><p class="- topic/p p">状态函数是指计算中不仅用到当前数据，还会用到历史数据的函数。比如 <a class="- topic/xref xref" href="#%E4%BB%B7%E6%A0%BC%E6%B6%A8%E8%B7%8C%E5%B9%85">价格涨跌幅</a>中的价格涨跌幅，不仅需要当前的价格数据，还需要前 lag 条的历史价格数据。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：</p><p class="- topic/p p">(1)状态函数需要用 @state 声明。</p><p class="- topic/p p">(2)状态函数内只支持赋值语句，<code class="+ topic/ph pr-d/codeph ph codeph">return</code> 语句和 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 语句。</p><p class="- topic/p p">其中 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 语句只支持 <em class="+ topic/ph hi-d/i ph i">condition</em> 是一个无关上游表格数据的标量。以 3.1.1 章节中的价格涨跌幅为例：<code class="+ topic/ph pr-d/codeph ph codeph">pricePercentChange(price, lag)</code> 的参数中 <em class="+ topic/ph hi-d/i ph i">price</em> 是上游数据表中的一列， <em class="+ topic/ph hi-d/i ph i">lag</em> 是另外指定的窗口大小。所以状态函数里 <code class="+ topic/ph pr-d/codeph ph codeph">if(lag&gt;30){}</code> 的判断是可以的；但是 <code class="+ topic/ph pr-d/codeph ph codeph">if(price&gt;0){}</code> 的判断是不行的，需要转化成 <code class="+ topic/ph pr-d/codeph ph codeph">iif</code> 语句 <code class="+ topic/ph pr-d/codeph ph codeph">iif(price&gt;0, , )</code>。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 以下写法中 price 来自上游表格，所以 price &gt; 0 实时更新，不会是标量，这样的 if-else 暂时不支持
@state
def pricePercentChange(price, lag){
    if(price&gt;0){
        return price \ move(price, lag) - 1
    }else{
        return 0
    }
}

// 以下写法中 lag 来自引擎定义时的额外指定，所以 lag&gt;30 是个固定结果，是个标量，这样的 if-else 可以支持
@state
def pricePercentChange(price, lag){
    if(lag&gt;30){
        return price \ move(price, lag) - 1
    }else{
        return price \ move(price, 30) - 1
    }
}</code></pre><p class="- topic/p p">(3)状态函数支持 <code class="+ topic/ph pr-d/codeph ph codeph">rowSum</code>、<code class="+ topic/ph pr-d/codeph ph codeph">rowMax</code> 等 row 系列函数和 <code class="+ topic/ph pr-d/codeph ph codeph">cumSum</code>、<code class="+ topic/ph pr-d/codeph ph codeph">cumMax</code> 等 cum 系列函数，但不支持 <code class="+ topic/ph pr-d/codeph ph codeph">sum</code>、<code class="+ topic/ph pr-d/codeph ph codeph">max</code> 等聚合函数。如果要在状态函数里面调用 <code class="+ topic/ph pr-d/codeph ph codeph">sum</code> 等聚合函数，可以用 <code class="+ topic/ph pr-d/codeph ph codeph">rowSum</code> 等 row 系列函数替代。</p><p class="- topic/p p">比如：求当前价格和倒数第 lag 条数据的价格的最大值。（<em class="+ topic/ph hi-d/i ph i">max(tradePrice[i], tradePrice[i-lag])</em>）</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 因子实现
@state
def maxPrice(price, lag){
    return rowMax([price, move(price, lag)])
}

// 定义输入输出的表结构
inputTable = table(1:0, `securityID`tradeTime`tradePrice`TradeQty`TradeAmount`BuyNo`SellNo`TradeBSFlag`TradeIndex`ChannelNo, [SYMBOL,DATETIME,DOUBLE,INT,DOUBLE,LONG,LONG,SYMBOL,INT,INT])
resultTable = table(10000:0, ["securityID", "tradeTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
metrics = &lt;[tradeTime, maxPrice(tradePrice, 2)]&gt;
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")

// 输入数据
insert into rse values(`000155, 2020.01.01T09:30:00, 30.85, 100, 3085, 4951, 0, `B, 1, 1)
insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 100, 3086, 4951, 1, `B, 2, 1)
insert into rse values(`000155, 2020.01.01T09:30:02, 30.80, 200, 6160, 5501, 5600, `S, 3, 1)


// 查看结果
select * from resultTable
/*
securityID tradeTime               factor            
---------- ----------------------- ------------------
000155     2020.01.01T09:30:00.000 30.85
000155     2020.01.01T09:30:01.000 30.86
000155     2020.01.01T09:30:02.000 30.85
*/</code></pre><p class="- topic/p p">(4) 调用状态函数的自定义函数也必须是状态函数。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title18" id="323-状态和无状态的拆分"><h4 class="- topic/title title topictitle4" id="ariaid-title18">3.2.3. 状态和无状态的拆分</h4><div class="- topic/body body"><p class="- topic/p p">响应式状态引擎因子都可以用<strong class="+ topic/ph hi-d/b ph b">无状态函数</strong>和<strong class="+ topic/ph hi-d/b ph b">状态函数</strong>组合实现，其中状态和无状态的拆分是最重要的一步。</p><p class="- topic/p p">虽然有些无状态的计算在状态函数里也可以支持，比如 <code class="+ topic/ph pr-d/codeph ph codeph">rowSum</code> 等。但是因为无状态函数实现向量化计算，且不用保存函数和变量的状态，性能表现更好。所以不建议将所有计算都写在一个状态函数里，而是要将复杂的截面计算拆分到无状态函数中，在状态函数里只保留一些自定义函数的调用和有关历史数据的操作（比如 m 系列，tm系列， fill 相关，迭代等）。</p></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title19" id="3231-移动平均买卖压力"><h5 class="- topic/title title topictitle5" id="ariaid-title19">3.2.3.1. 移动平均买卖压力</h5><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑</strong>：</p><p class="- topic/p p">Step1：计算买卖压力指标（<a class="- topic/xref xref" href="sql_performance_optimization_wap_di_rv.html">买卖压力指标</a>）</p><img class="- topic/image image" src="images/Streaming_computing_of_financial_quantifiers/3_3.png"/><br/><p class="- topic/p p">Step2：使用 <code class="+ topic/ph pr-d/codeph ph codeph">mavg</code> 计算过去 lag 行的移动平均买卖压力指标</p><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">(press[i-lag+1]+…+press[i]) / lag</em></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 实现代码</strong>：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">用一个状态函数实现【<strong class="+ topic/ph hi-d/b ph b">不建议</strong>】</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def averagePress1(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){
	bidPrice = fixedLengthArrayVector(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9)
	bidOrderQty = fixedLengthArrayVector(bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9)
	offerPrice = fixedLengthArrayVector(offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9)
	offerOrderQty = fixedLengthArrayVector(offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9)
	wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)
	bidPress = rowWavg(bidOrderQty, wap \ (bidPrice - wap))
	askPress = rowWavg(offerOrderQty, wap \ (offerPrice - wap))
	press = log(bidPress \ askPress)
	return mavg(press, lag, 1)
}</code></pre></li><li class="- topic/li li"><p class="- topic/p p">无状态函数+状态函数【<strong class="+ topic/ph hi-d/b ph b">推荐</strong>】</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def calPress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9){
	bidPrice = fixedLengthArrayVector(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9)
	bidOrderQty = fixedLengthArrayVector(bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9)
	offerPrice = fixedLengthArrayVector(offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9)
	offerOrderQty = fixedLengthArrayVector(offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9)
	wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)
	bidPress = rowWavg(bidOrderQty, wap \ (bidPrice - wap))
	askPress = rowWavg(offerOrderQty, wap \ (offerPrice - wap))
	press = log(bidPress \ askPress)
	return press
}

@state
def averagePress2(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){
	press = calPress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9)
	return mavg(press, lag, 1)
}</code></pre></li></ul></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title20" id="3232-性能对比"><h5 class="- topic/title title topictitle5" id="ariaid-title20">3.2.3.2. 性能对比</h5><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">server 版本</strong>：2.00.9.2 2023.03.10 JIT</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试数据量</strong>：上交所 100 只股票的某日的 Level2 快照数据，372,208 * 194 (319 M)</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试方案</strong>：通过 <code class="+ topic/ph pr-d/codeph ph codeph">timer</code> 函数，统计从数据灌入引擎开始到所有指标计算结束的总共耗时。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试结果</strong>：</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="3232-性能对比__entry__1"><strong class="+ topic/ph hi-d/b ph b">因子转写方式</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="3232-性能对比__entry__2"><strong class="+ topic/ph hi-d/b ph b">耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="3232-性能对比__entry__1">状态与无状态不拆分</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="3232-性能对比__entry__2">1492.224</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="3232-性能对比__entry__1">状态与无状态拆分</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="3232-性能对比__entry__2">577.651</td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试脚本</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 导入测试数据
csvPath = "/hdd/hdd0/jit200ssd/server/testdata/"
colName = ["securityID","dateTime","preClosePx","openPx","highPx","lowPx","lastPx","totalVolumeTrade","totalValueTrade","instrumentStatus"] &lt;- flatten(eachLeft(+, ["bidPrice","bidOrderQty","bidNumOrders"], string(0..9))) &lt;- ("bidOrders"+string(0..49)) &lt;- flatten(eachLeft(+, ["offerPrice","offerOrderQty","offerNumOrders"], string(0..9))) &lt;- ("offerOrders"+string(0..49)) &lt;- ["numTrades","iopv","totalBidQty","totalOfferQty","weightedAvgBidPx","weightedAvgOfferPx","totalBidNumber","totalOfferNumber","bidTradeMaxDuration","offerTradeMaxDuration","numBidOrders","numOfferOrders","withdrawBuyNumber","withdrawBuyAmount","withdrawBuyMoney","withdrawSellNumber","withdrawSellAmount","withdrawSellMoney","etfBuyNumber","etfBuyAmount","etfBuyMoney","etfSellNumber","etfSellAmount","etfSellMoney"]
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL"] &lt;- take("DOUBLE", 10) &lt;- take("INT", 70)&lt;- take("DOUBLE", 10) &lt;- take("INT", 70) &lt;- ["INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
data = select * from loadText(csvPath + "snapshot_100stocks_multi.csv", schema=table(colName, colType)) order by dateTime

// 定义输入输出的表结构
inputTable = table(1:0, colName, colType)
resultTable1 = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])
resultTable2 = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
// 状态函数和无状态函数不拆分
try{ dropStreamEngine("reactiveDemo1")} catch(ex){ print(ex) }
metrics1 = &lt;[dateTime, averagePress1(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&gt;
rse1 = createReactiveStateEngine(name="reactiveDemo1", metrics =metrics1, dummyTable=inputTable, outputTable=resultTable1, keyColumn="securityID")
//状态函数和无状态函数拆分
try{ dropStreamEngine("reactiveDemo2")} catch(ex){ print(ex) }
metrics2 = &lt;[dateTime, averagePress2(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&gt;
rse2 = createReactiveStateEngine(name="reactiveDemo2", metrics =metrics2, dummyTable=inputTable, outputTable=resultTable2, keyColumn="securityID")

// 输入数据
timer rse1.append!(data)
timer rse2.append!(data)

// 计算结果正确性验证
each(eqObj, resultTable1.values(), resultTable2.values()).all()</code></pre></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title21" id="3233-注意事项"><h5 class="- topic/title title topictitle5" id="ariaid-title21">3.2.3.3. 注意事项</h5><div class="- topic/body body"><p class="- topic/p p">(1) 因为响应式状态引擎计算时的特殊处理，所以不是所有数据类型的变量都可以作为参数和返回值在状态函数和无状态函数之间传递的。状态函数和无状态函数间的参数可以是标量、向量或者数组向量 (Array Vector)，不能是元组 (ANY Vector) 等数据类型。</p><p class="- topic/p p">下面通过 print 打印从状态函数到无状态函数的参数的数据类型和数据值来说明这个现象。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 因子实现
def typeTestNonStateFunc(scalar, vector, arrayVector, anyVector){
	print("---------------------------------------")
	print(typestr(scalar))
	print(scalar)
	print(typestr(vector))
	print(vector)
	print(typestr(arrayVector))
	print(arrayVector)
	print(typestr(anyVector))
	print(anyVector)
	return fixedLengthArrayVector(rowSum(arrayVector), rowAvg(arrayVector))
}

@state
def typeTestStateFunc(price1, price2, price3, lag){
	scalar = lag
	vector = price1
	arrayVector = fixedLengthArrayVector(price1, price2, price3)
	anyVector = [price1, price2, price3]
	res = typeTestNonStateFunc(scalar, vector, arrayVector, anyVector)
	sumRes = res[0]
	avgRes = res[1]
	return sumRes, avgRes, res, anyVector
}</code></pre><p class="- topic/p p">其中 <em class="+ topic/ph hi-d/i ph i">lag</em> 是外部指定的一个定值，<em class="+ topic/ph hi-d/i ph i">price1</em>、<em class="+ topic/ph hi-d/i ph i">price2</em>、<em class="+ topic/ph hi-d/i ph i">price3</em> 是上游表中的三列，通过 <code class="+ topic/ph pr-d/codeph ph codeph">fixedLengthArrayVector</code> 可以将多个向量组装成 arrayVector，通过 <code class="+ topic/ph pr-d/codeph ph codeph">[price1, price2, price3]</code> 可以拼装出元组（tuple）。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
inputTable = table(1:0, `securityID`tradeTime`price1`price2`price3, [SYMBOL,DATETIME,DOUBLE,DOUBLE,DOUBLE])
resultTable = table(10000:0, ["securityID", "tradeTime", "sum", "avg", "sum_avg", "anyVector"], [SYMBOL, TIMESTAMP, DOUBLE, DOUBLE,DOUBLE[], DOUBLE[]])

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
metrics = &lt;[tradeTime, typeTestStateFunc(price1, price2, price3, 10) as `sum`avg`sum_avg`anyVector]&gt;
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")

// 输入数据
insert into rse values(`000155, 2020.01.01T09:30:00, 30.81, 30.82, 30.83)
insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 30.87, 30.88)
insert into rse values(`000155, 2020.01.01T09:30:02, 30.80, 30.81, 30.82)

// 查看结果
select * from resultTable
/*
securityID tradeTime               sum    avg    sum_avg                 anyVector
---------- ----------------------- ------ ------ ----------------------- ---------
000155     2020.01.01T09:30:00.000 92.46  30.82  [92.46,30.82]           [00F]    
000155     2020.01.01T09:30:01.000 92.61  30.87  [92.61,30.87]           [00F]    
000155     2020.01.01T09:30:02.000 92.43  30.81  [92.43,30.81]           [00F]    
*/</code></pre><img class="- topic/image image" src="images/Streaming_computing_of_financial_quantifiers/3_4.png"/><br/><p class="- topic/p p">(2) 状态函数内调用自定义函数时，不支持用多个变量接收函数多个返回值（即 <code class="+ topic/ph pr-d/codeph ph codeph">a,b = foo(...)</code> 的写法）。如果无状态函数需要返回多个值，则需要用 <code class="+ topic/ph pr-d/codeph ph codeph">fixedLengthArrayVector</code> 将返回结果组装成 array Vector 返回。在状态函数内，用一个变量接收，之后可以用 res[index] 的方式将返回的多个结果拆分。（可以参考上面注意事项(1) 中的例子）</p><p class="- topic/p p">(3) 当数据组装成 array vector 后，计算函数需要改为对应的 row 系列函数或者 <code class="+ topic/ph pr-d/codeph ph codeph">byRow</code> 高阶函数。（可以参考上面注意事项(1) 中的例子，计算三个价格之和使用 <code class="+ topic/ph pr-d/codeph ph codeph">rowSum</code> 函数，计算三个价格的平均数使用 <code class="+ topic/ph pr-d/codeph ph codeph">rowAvg</code> 函数）</p></div></article></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title22" id="33-if-else"><h3 class="- topic/title title topictitle3" id="ariaid-title22">3.3. if-else</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">无状态函数</strong></p><p class="- topic/p p">无状态函数支持 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 语句。但是 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 的 <em class="+ topic/ph hi-d/i ph i">condition</em> 结果必须是标量；否则需要使用 <code class="+ topic/ph pr-d/codeph ph codeph">iif</code> 函数替代。(可以参考上文<a class="- topic/xref xref" href="#%E6%97%A0%E7%8A%B6%E6%80%81%E5%87%BD%E6%95%B0">无状态函数</a>章节中注意事项中的例子)</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">状态函数</strong></p><p class="- topic/p p">状态函数的 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 只支持 <em class="+ topic/ph hi-d/i ph i">condition</em> 是一个无关上游表格数据的标量；否则需要使用 <code class="+ topic/ph pr-d/codeph ph codeph">iif</code> 函数替代或者把 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 的逻辑封装成自定义的无状态函数。(可以参考上文<a class="- topic/xref xref" href="#%E7%8A%B6%E6%80%81%E5%87%BD%E6%95%B0">状态函数</a>章节中注意事项第二部分)</p></li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意事项</strong>：</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">iif</code> 函数的计算是把 trueResult 和 falseResult 的结果都计算出来，再根据 <em class="+ topic/ph hi-d/i ph i">condition</em> 拼装结果。所以需要保证，trueResult 和 falseResult 的两个式子在所有输入下都可以执行不报错。比如：<code class="+ topic/ph pr-d/codeph ph codeph">y=iif(size(x) &gt; 0, sum(x), 0.0)</code>，如果输入的 <code class="+ topic/ph pr-d/codeph ph codeph">x=[]</code> ，虽然 <code class="+ topic/ph pr-d/codeph ph codeph">size(x) &gt; 0</code> 不满足条件应该直接返回 0.0，但是 <code class="+ topic/ph pr-d/codeph ph codeph">iif</code> 会把两种情况的式子都计算一遍，所以 <code class="+ topic/ph pr-d/codeph ph codeph">sum(x)</code> 还是会被计算。而 <code class="+ topic/ph pr-d/codeph ph codeph">sum(x)</code> 的输入不允许是空向量，所以这个式子在 <code class="+ topic/ph pr-d/codeph ph codeph">x=[]</code> 的情况下会报错。这时就需要换成 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 语句：<code class="+ topic/ph pr-d/codeph ph codeph">if(size(x)&gt;0){y=sum(x)}else{y=0}</code></p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title23" id="34-历史数据访问窗口计算和迭代"><h3 class="- topic/title title topictitle3" id="ariaid-title23">3.4. 历史数据访问（窗口计算和迭代）</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 内置了丰富的计算函数来帮助用户在状态函数里面实现各种涉及历史数据的计算。比如：滑动窗口系列（m 系列）、时序滑动窗口系列（tm 系列）、累计窗口系列（cum 系列）、<code class="+ topic/ph pr-d/codeph ph codeph">ffill</code>等函数。</p><p class="- topic/p p">除此之外，还有 <code class="+ topic/ph pr-d/codeph ph codeph">movingWindowData</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">tmovingWindowData</code> 可以直接返回变量历史值组成的向量，方便用户实现更多的自定义计算。</p><p class="- topic/p p">虽然状态函数内不支持函数自身调用的写法，但是 DolphinDB 提供了 <code class="+ topic/ph pr-d/codeph ph codeph">conditionalIterate</code>、<code class="+ topic/ph pr-d/codeph ph codeph">stateIterate</code>、<code class="+ topic/ph pr-d/codeph ph codeph">genericStateIterate</code>、<code class="+ topic/ph pr-d/codeph ph codeph">genericTStateIterate</code> 等函数来支持迭代逻辑的实现以及其他对函数结果历史值的复杂处理。</p><p class="- topic/p p">下面以一个自定义的复杂因子为例。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑</strong>：</p><p class="- topic/p p">step1：对最近 lag 条快照的第一档量价数据按照指定的权重做加权平均得到新的量价数据【使用 <code class="+ topic/ph pr-d/codeph ph codeph">moving</code>】</p><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">bidPrice = bidPrice0[i-lag+1]*weight[0] + … + bidPrice0[i]*weight[lag-1]</em></p><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">askPrice = offerPrice0[i-lag+1]*weight[0] + … + offerPrice0[i]*weight[lag-1]</em></p><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">bidVolume = bidOrderQty0[i-lag+1]*weight[0] + … + bidOrderQty0[i]*weight[lag-1]</em></p><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">askVolume = offerOrderQty0[i-lag+1]*weight[0] + … + offerOrderQty0[i]*weight[lag-1]</em></p><p class="- topic/p p">step2：使用 Step1 的结果计算移动平均加权价格 maWAP【使用 <code class="+ topic/ph pr-d/codeph ph codeph">mavg</code>】</p><p class="- topic/p p">step3：因子结果是最近 lag-1 个因子值和当前 maWAP 的加权平均【使用 <code class="+ topic/ph pr-d/codeph ph codeph">genericStateIterate</code>】</p></li><li class="- topic/li li"><p class="- topic/p p">其中权重由最近 lag 个 bidVolume / askVolume 的值确定【使用 <code class="+ topic/ph pr-d/codeph ph codeph">movingWindowData</code>】</p></li><li class="- topic/li li"><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">w[i] = bidVolume[i-lag]/askVolume[i-lag]</em></p></li><li class="- topic/li li"><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">factor[i]=(factor[i-lag+1]*w[i-lag+1] +…+ factor[i-1]*w[i-1] + maWAP[i]*w[i]) / (w[i-lag+1] +…+ w[i])</em></p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DDB 实现代码</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>defg myWavg(x){
	weight = 1..size(x)
	return wavg(x, weight)
}

def iterateFunc(historyFactors, currentValue, weight){
	return wavg(historyFactors join currentValue, weight)
}

@state
def myFactor(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, lag){
	// step1: 使用 moving
	bidPrice, askPrice, bidVolume, askVolume = moving(myWavg, bidPrice0, lag, 1), moving(myWavg, offerPrice0, lag, 1), moving(myWavg, bidOrderQty0, lag, 1), moving(myWavg, offerOrderQty0, lag, 1)

	// step2: 使用 mavg
	wap = (bidPrice*askVolume + askPrice*bidVolume) \ (bidVolume + askVolume)
	maWap = mavg(wap, lag, 1)

	// step3: 使用 movingWindowData 
	w = movingWindowData(bidVolume \ askVolume, lag)
	//	 使用 genericStateIterate
	factorValue = genericStateIterate(X=[maWap, w], initial=maWap, window=lag-1, func=iterateFunc{ , , })
	return factorValue
}</code></pre></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">实时流计算</strong></p></li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
colName = ["securityID","dateTime","preClosePx","openPx","highPx","lowPx","lastPx","totalVolumeTrade","totalValueTrade","instrumentStatus"] &lt;- flatten(eachLeft(+, ["bidPrice","bidOrderQty","bidNumOrders"], string(0..9))) &lt;- ("bidOrders"+string(0..49)) &lt;- flatten(eachLeft(+, ["offerPrice","offerOrderQty","offerNumOrders"], string(0..9))) &lt;- ("offerOrders"+string(0..49)) &lt;- ["numTrades","iopv","totalBidQty","totalOfferQty","weightedAvgBidPx","weightedAvgOfferPx","totalBidNumber","totalOfferNumber","bidTradeMaxDuration","offerTradeMaxDuration","numBidOrders","numOfferOrders","withdrawBuyNumber","withdrawBuyAmount","withdrawBuyMoney","withdrawSellNumber","withdrawSellAmount","withdrawSellMoney","etfBuyNumber","etfBuyAmount","etfBuyMoney","etfSellNumber","etfSellAmount","etfSellMoney"]
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL"] &lt;- take("DOUBLE", 10) &lt;- take("INT", 70)&lt;- take("DOUBLE", 10) &lt;- take("INT", 70) &lt;- ["INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
inputTable = table(1:0, colName, colType)
resultTable = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
metrics = &lt;[dateTime, myFactor(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, 3)]&gt;
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")

// 输入数据
tableInsert(rse, {"securityID":"000001", "dateTime":2023.01.01T09:30:00.000, "bidPrice0":19.98, "bidOrderQty0":100, "offerPrice0":19.99, "offerOrderQty0":120})
tableInsert(rse, {"securityID":"000001", "dateTime":2023.01.01T09:30:03.000, "bidPrice0":19.95, "bidOrderQty0":130, "offerPrice0":19.93, "offerOrderQty0":120})
tableInsert(rse, {"securityID":"000001", "dateTime":2023.01.01T09:30:06.000, "bidPrice0":19.97, "bidOrderQty0":120, "offerPrice0":19.98, "offerOrderQty0":130})
tableInsert(rse, {"securityID":"000001", "dateTime":2023.01.01T09:30:09.000, "bidPrice0":20.00, "bidOrderQty0":130, "offerPrice0":19.97, "offerOrderQty0":140})


// 查看结果
select * from resultTable
/*
 securityID dateTime                factor            
---------- ----------------------- ------------------
000001     2023.01.01T09:30:00.000 19.9845 
000001     2023.01.01T09:30:03.000 19.9698
000001     2023.01.01T09:30:06.000 19.9736
000001     2023.01.01T09:30:09.000 19.9694
*/</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：</p><ul class="- topic/ul ul"><li class="- topic/li li">高阶函数 moving(func, …)中的 <em class="+ topic/ph hi-d/i ph i">func</em> 是一个聚合函数，需要用 defg 定义 <code class="+ topic/ph pr-d/codeph ph codeph">func</code> 函数。</li><li class="- topic/li li">状态函数不支持函数自身调用的写法，所以遇到需要历史因子值的逻辑时（比如当前计算值为空，就用上一个因子值填充）会很难表示。为此，DolphinDB 提供了 <code class="+ topic/ph pr-d/codeph ph codeph">conditionalIterate</code>、<code class="+ topic/ph pr-d/codeph ph codeph">genericStateIterate</code> 等函数。但是，这些函数记录的不是因子函数最终 return 的结果，而是截至该函数所在当前行代码运行后计算的结果。所以，为了正确的取到因子函数的历史结果，逻辑上需要把 <code class="+ topic/ph pr-d/codeph ph codeph">conditionalIterate</code>、<code class="+ topic/ph pr-d/codeph ph codeph">genericStateIterate</code> 等函数放在整个状态函数的最后一步。</li></ul><p class="- topic/p p">用下面的例子说明具体情况。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@state
def iterateTestFunc(tradePrice){
	// 计算交易价格涨跌幅
	change = tradePrice \ prev(tradePrice) - 1
	// 如果计算结果是空值，则用上一个非空因子值填充
	factor = conditionalIterate(change != NULL, change, cumlastNot)
	// 返回 factor+1 作为最终因子值
	return factor + 1
}</code></pre><p class="- topic/p p">创建响应式状态引擎并输入几条数据观察结果。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
inputTable = table(1:0, `securityID`tradeTime`tradePrice`tradeQty`tradeAmount`buyNo`sellNo`tradeBSFlag`tradeIndex`channelNo, [SYMBOL,DATETIME,DOUBLE,INT,DOUBLE,LONG,LONG,SYMBOL,INT,INT])
resultTable = table(10000:0, ["securityID", "tradeTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
metrics = &lt;[tradeTime, iterateTestFunc(tradePrice)]&gt;
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")

// 输入数据
insert into rse values(`000155, 2020.01.01T09:30:00, 30.85, 100, 3085, 4951, 0, `B, 1, 1)
insert into rse values(`000155, 2020.01.01T09:30:01, 30.86, 100, 3086, 4951, 1, `B, 2, 1)
insert into rse values(`000155, 2020.01.01T09:30:02, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)
insert into rse values(`000155, 2020.01.01T09:30:03, 30.80, 200, 6160, 5501, 5600, `S, 3, 1)

// 查看结果
select * from resultTable
/*
securityID tradeTime               factor          
---------- ----------------------- ----------------
000155     2020.01.01T09:30:00.000                 
000155     2020.01.01T09:30:01.000 1.0003
000155     2020.01.01T09:30:02.000 1.0003
000155     2020.01.01T09:30:03.000 1.0003
*/</code></pre><div class="table-container"><table class="- topic/table table" data-cols="6"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__1"><strong class="+ topic/ph hi-d/b ph b">tradeTime</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__2"><strong class="+ topic/ph hi-d/b ph b">tradePrice</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__3"><strong class="+ topic/ph hi-d/b ph b">change</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__4"><strong class="+ topic/ph hi-d/b ph b">cumlastNot</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__5"><strong class="+ topic/ph hi-d/b ph b">factor=conditionalIterate(…)</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__6"><strong class="+ topic/ph hi-d/b ph b">iterateTestFunc(tradePrice)</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__1">2020.01.01T09:30:00</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__2">30.85</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__3">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__4">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__5">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__6">NULL</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__1">2020.01.01T09:30:01</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__2">30.86</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__3">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__4">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__5">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__6">1.0003</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__1">2020.01.01T09:30:02</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__2">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__3">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__4">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__5">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__6">1.0003</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__1">2020.01.01T09:30:03</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__2">30.80</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__3">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__4">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__5">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__6">1.0003</td></tr></tbody></table></div><p class="- topic/p p">可以发现，<code class="+ topic/ph pr-d/codeph ph codeph">factor = conditionalIterate(change != NULL, change, cumlastNot)</code> 这一行中的 <em class="+ topic/ph hi-d/i ph i">cumlastNot</em> 找的不是因子函数 <code class="+ topic/ph pr-d/codeph ph codeph">iterateTestFunc(tradePrice)</code> 的上一个非空值，而是 <code class="+ topic/ph pr-d/codeph ph codeph">factor</code> 的上一个非空值，最后 return 中的 factor+1 这一步操作并不会被 <code class="+ topic/ph pr-d/codeph ph codeph">conditionalIterate</code> 函数记录。</p><p class="- topic/p p">如果对历史因子值有后续操作，可以考虑使用 <code class="+ topic/ph pr-d/codeph ph codeph">stateIterate</code>、<code class="+ topic/ph pr-d/codeph ph codeph">genericStateIterate</code> 等函数。比如上面的例子可以改写为：（<code class="+ topic/ph pr-d/codeph ph codeph">genericStateIterate</code> 函数的 window 有限制，window &gt;= 2；目前已经开发新功能支持 window = 1，该功能会加在后续版本中）</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 当前要求 window &gt;= 2，所以回看上一个数据也需要 window=2
def processFunc(historyFactor, change){
	lastFactor = last(historyFactor)
	factor = iif(change != NULL, change, lastFactor)
	return factor+1
}
@state
def iterateTestFunc(tradePrice){
	// 计算交易价格涨跌幅
	change = tradePrice \ prev(tradePrice) - 1
	// 如果计算结果是空值，则用上一个因子值填充，返回 factor+1 作为最终因子值
	factor = genericStateIterate(X=[change], initial=change, window=2, func=processFunc)
	return factor
}

// 后续支持 window=1，则可以用以下代码替换
/*
def processFunc(lastFactor, change){
	factor = iif(change != NULL, change, lastFactor)
	return factor+1
}
@state
def iterateTestFunc(tradePrice){
	// 计算交易价格涨跌幅
	change = tradePrice \ prev(tradePrice) - 1
	// 如果计算结果是空值，则用上一个因子值填充，返回 factor+1 作为最终因子值
	factor = genericStateIterate(X=[change], initial=change, window=1, func=processFunc)
	return factor
}
*/</code></pre><div class="table-container"><table class="- topic/table table" data-cols="6"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__31"><strong class="+ topic/ph hi-d/b ph b">tradeTime</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__32"><strong class="+ topic/ph hi-d/b ph b">tradePrice</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__33"><strong class="+ topic/ph hi-d/b ph b">change</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__34"><strong class="+ topic/ph hi-d/b ph b">lastFactor</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__35"><strong class="+ topic/ph hi-d/b ph b">factor=iif(..)</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="34-历史数据访问窗口计算和迭代__entry__36"><strong class="+ topic/ph hi-d/b ph b">iterateTestFunc(tradePrice)</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__31">2020.01.01T09:30:00</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__32">30.85</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__33">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__34">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__35">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__36">NULL</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__31">2020.01.01T09:30:01</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__32">30.86</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__33">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__34">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__35">0.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__36">1.0003</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__31">2020.01.01T09:30:02</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__32">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__33">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__34">1.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__35">1.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__36">2.0003</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__31">2020.01.01T09:30:03</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__32">30.80</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__33">NULL</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__34">2.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__35">2.0003</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="34-历史数据访问窗口计算和迭代__entry__36">3.0003</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title24" id="35-循环"><h3 class="- topic/title title topictitle3" id="ariaid-title24">3.5. 循环</h3><div class="- topic/body body"><p class="- topic/p p">状态函数不支持 <code class="+ topic/ph pr-d/codeph ph codeph">for</code>/<code class="+ topic/ph pr-d/codeph ph codeph">while</code> 等循环语句，支持使用 <code class="+ topic/ph pr-d/codeph ph codeph">each</code>/<code class="+ topic/ph pr-d/codeph ph codeph">loop</code> 等函数实现循环逻辑。</p><p class="- topic/p p">下面以一个 python 代码实现的因子逻辑为例，说明如何在响应式状态引擎内实现循环逻辑。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑</strong>：(python 代码来源：<a class="- topic/xref xref" href="https://zhuanlan.zhihu.com/p/566912024" target="_blank" rel="external noopener"><strong class="+ topic/ph hi-d/b ph b">高频因子是怎么回事 —— 正确的、错误的、与瞎编的</strong></a>)</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def _bid_withdraws_volume(l, n, levels=10):
    withdraws = 0
    for price_index in range(0,4*levels, 4):
        now_p = n[price_index]
        for price_last_index in range(0,4*levels,4):
            if l[price_last_index] == now_p:
                withdraws -= min(n[price_index+1] - l[price_last_index + 1], 0)     
    return withdraws

def bid_withdraws(depth, trade):
    ob_values = depth.values
    flows = np.zeros(len(ob_values))
    for i in range(1, len(ob_values)):
        flows[i] = _bid_withdraws_volume(ob_values[i-1], ob_values[i])
    return pd.Series(flows)</code></pre><p class="- topic/p p">因子代码中有两层循环，其中内层循环可以转化为向量化计算；外层循环可以使用 <code class="+ topic/ph pr-d/codeph ph codeph">each</code> 函数。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 实现代码</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 对应内层循环
def withdrawsVolumeTmp(lastPrices, lastVolumes, nowPrice, nowVolume){ 
	withdraws = lastVolumes[lastPrices == nowPrice] - nowVolume
	return sum(withdraws * (withdraws &gt; 0))
}

// 对应外层循环
defg withdrawsVolume(prices, Volumes){ 
	lastPrices, nowPrices = prices[0], prices[1]
	lastVolumes, nowVolumes = Volumes[0], Volumes[1]

	withdraws = each(withdrawsVolumeTmp{lastPrices, lastVolumes}, nowPrices, nowVolumes)
	return sum(withdraws)
}


@state
def bidWithdrawsVolume(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9,bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, levels=10){
	bidPrice = fixedLengthArrayVector(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9)
	bidOrderQty = fixedLengthArrayVector(bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9)
	return moving(withdrawsVolume, [bidPrice[0:levels], bidOrderQty[0:levels]], 2)
}</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">实时流计算</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 定义输入输出的表结构
colName = ["securityID","dateTime","preClosePx","openPx","highPx","lowPx","lastPx","totalVolumeTrade","totalValueTrade","instrumentStatus"] &lt;- flatten(eachLeft(+, ["bidPrice","bidOrderQty","bidNumOrders"], string(0..9))) &lt;- ("bidOrders"+string(0..49)) &lt;- flatten(eachLeft(+, ["offerPrice","offerOrderQty","offerNumOrders"], string(0..9))) &lt;- ("offerOrders"+string(0..49)) &lt;- ["numTrades","iopv","totalBidQty","totalOfferQty","weightedAvgBidPx","weightedAvgOfferPx","totalBidNumber","totalOfferNumber","bidTradeMaxDuration","offerTradeMaxDuration","numBidOrders","numOfferOrders","withdrawBuyNumber","withdrawBuyAmount","withdrawBuyMoney","withdrawSellNumber","withdrawSellAmount","withdrawSellMoney","etfBuyNumber","etfBuyAmount","etfBuyMoney","etfSellNumber","etfSellAmount","etfSellMoney"]
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL"] &lt;- take("DOUBLE", 10) &lt;- take("INT", 70)&lt;- take("DOUBLE", 10) &lt;- take("INT", 70) &lt;- ["INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
inputTable = table(1:0, colName, colType)
resultTable = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
try{ dropStreamEngine("reactiveDemo")} catch(ex){ print(ex) }
metrics = &lt;[dateTime, bidWithdrawsVolume(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9,bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, levels=3)]&gt;
rse = createReactiveStateEngine(name="reactiveDemo", metrics =metrics, dummyTable=inputTable, outputTable=resultTable, keyColumn="securityID")

// 构造数据
setRandomSeed(9)
n = 5
securityID = take(`000001, n)
dateTime = 2023.01.01T09:30:00.000 + 1..n*3*1000
bidPrice0 = rand(10, n) \ 100 + 19.5
bidPrice1, bidPrice2 = bidPrice0+0.01, bidPrice0+0.02
bidOrderQty0, bidOrderQty1, bidOrderQty2 = rand(200, n), rand(200, n), rand(200, n)
offerPrice0 = rand(10, n) \ 100 + 19.5
offerPrice1, offerPrice2 = offerPrice0+0.01, offerPrice0+0.02
offerOrderQty0, offerOrderQty1, offerOrderQty2 = rand(200, n), rand(200, n), rand(200, n)
testdata = table(securityID, dateTime, bidPrice0, bidPrice1, bidPrice2, bidOrderQty0, bidOrderQty1, bidOrderQty2, offerPrice0, offerPrice1, offerPrice2, offerOrderQty0, offerOrderQty1, offerOrderQty2)
// 输入数据
tableInsert(rse, testdata.flip())

// 查看结果
select * from resultTable
/*
securityID dateTime                factor
---------- ----------------------- ------
000001     2023.01.01T09:30:03.000       
000001     2023.01.01T09:30:06.000       
000001     2023.01.01T09:30:09.000 0     
000001     2023.01.01T09:30:12.000 36    
000001     2023.01.01T09:30:15.000 26    
*/</code></pre></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title25" id="4-进阶高频因子流式实现优化"><h2 class="- topic/title title topictitle2" id="ariaid-title25">4. 进阶：高频因子流式实现优化</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title26" id="41-数组向量-array-vector"><h3 class="- topic/title title topictitle3" id="ariaid-title26">4.1. 数组向量 (array vector)</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 中的数组向量 (array vector) 是一种特殊的向量，用于存储可变长度的二维数组。这种存储方式可显著简化某些常用的查询与计算。若不同列中含有大量重复数据，使用数组向量存储亦可提高数据压缩比，提升查询速度。数组向量可以与标量、向量或另一个数组向量进行二元运算，能够方便因子计算逻辑的向量化实现。</p><p class="- topic/p p">level 2 高频因子往往需要对十档量价数据进行频繁的操作。从<a class="- topic/xref xref" href="#%E9%AB%98%E9%A2%91%E5%9B%A0%E5%AD%90%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0">高频因子流式实现</a>的例子中也可以发现，为了让十档量价数据能够方便地实现向量化计算，往往需要通过 <code class="+ topic/ph pr-d/codeph ph codeph">fixedLengthArrayVector</code> 函数组合十档数据。针对这个特点，可以选择直接使用数组向量 (array vector) 来存储原始的 level 2 快照行情数据，省去函数内组装十档数据的步骤，降低流式计算延时。</p><p class="- topic/p p">比如 “<a class="- topic/xref xref" href="#%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E4%B9%B0%E5%8D%96%E5%8E%8B%E5%8A%9B">移动平均买卖压力</a>” 章节中的复杂因子，其 arrayVector 的实现代码如下：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DDB 实现代码</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def pressArrayVector(bidPrice, bidOrderQty, offerPrice, offerOrderQty){
	wap = (bidPrice[0]*offerOrderQty[0] + offerPrice[0]*bidOrderQty[0]) \ (offerOrderQty[0]+bidOrderQty[0])
	bidPress = rowWavg(bidOrderQty, wap \ (bidPrice - wap))
	askPress = rowWavg(offerOrderQty, wap \ (offerPrice - wap))
	press = log(bidPress \ askPress)
	return press
}

@state
def averagePress3(bidPrice, bidOrderQty, offerPrice, offerOrderQty, lag){
	press = pressArrayVector(bidPrice, bidOrderQty, offerPrice, offerOrderQty)
	return mavg(press, lag, 1)
}</code></pre></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意事项</strong>：</p><p class="- topic/p p">(1) 对 array vector 类型的数据进行操作时，往往需要使用 row 系列函数或者 <code class="+ topic/ph pr-d/codeph ph codeph">byRow</code> 高阶函数。比如，对十档买方价格求和 <code class="+ topic/ph pr-d/codeph ph codeph">rowSum(bidPrice)</code> 。</p><p class="- topic/p p">(2) array vector 类型的列在数据插入时要求数据类型的强一致性。比如，引擎里 dummyTable 定义了 <em class="+ topic/ph hi-d/i ph i">bidOrderQty</em> 的数据类型是 INT[]，则上游输入数据表中对应列的数据类型必须也是 INT[]。</p><p class="- topic/p p">(3) 因为对 array vector 的切片索引也是有开销的，所以并不是所有因子转化为 array vector 的形式都会有性能提升。如果因子涉及对十档数据的大量复杂操作，则使用 array vector 作为输入会有明显的性能提升；如果因子只是对某档数据进行计算，比如计算中只会使用到的第一档数据，那么更适合多档多列的存储方式。</p></li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title27" id="42-即时编译jit"><h3 class="- topic/title title topictitle3" id="ariaid-title27">4.2. 即时编译(JIT)</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 底层由 C++ 实现，脚本中的一次函数调用会转化为多次 C++ 内的虚拟函数调用。在不能使用向量化的情况下，解释成本会比较高。</p><p class="- topic/p p">DolphinDB 中的即时编译功能，在运行时将代码翻译为机器码，能够显著提高了 <code class="+ topic/ph pr-d/codeph ph codeph">for</code> 循环，<code class="+ topic/ph pr-d/codeph ph codeph">while</code> 循环和 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 等语句的运行速度，特别适合于无法使用向量化运算但又对运行速度有极高要求的场景，例如高频因子计算、实时流数据处理等。</p><p class="- topic/p p">JIT 的详细使用方法可以参考教程：<a class="- topic/xref xref" href="jit.html">DolphinDB JIT教程</a>。</p><p class="- topic/p p">本章节主要介绍响应式状态引擎中 JIT 版本因子转写时的注意事项。</p><p class="- topic/p p">响应式状态引擎因子是<strong class="+ topic/ph hi-d/b ph b">状态函数</strong>和<strong class="+ topic/ph hi-d/b ph b">无状态函数</strong>的组合。JIT 版本的因子和非 JIT 版本的因子转写的主要区别在<strong class="+ topic/ph hi-d/b ph b">无状态函数</strong>，状态函数的转写没有区别。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">区别 1</strong>：jit 函数需要 @jit 标识。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">区别 2</strong>：普通的无状态函数没有函数使用限制；JIT 版本目前仅支持部分函数。</p><p class="- topic/p p">JIT 中不支持的函数，需要用户通过公式展开、<code class="+ topic/ph pr-d/codeph ph codeph">for</code>/<code class="+ topic/ph pr-d/codeph ph codeph">while</code>循环语句、<code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 语句等方式自己手动实现。</p><p class="- topic/p p">(1) 下面以计算买方十档成交额之和为例，说明如何使用公式展开的方法实现 <code class="+ topic/ph pr-d/codeph ph codeph">sum</code> 函数。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑</strong>： <em class="+ topic/ph hi-d/i ph i">bidPrice0*bidOrderQty0 + … + bidPrice9*bidOrderQty9</em></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DDB 实现代码(公式展开)</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@jit
def calAmount(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9){
	return bidPrice0*bidOrderQty0+bidPrice1*bidOrderQty1+bidPrice2*bidOrderQty2+bidPrice3*bidOrderQty3+bidPrice4*bidOrderQty4+bidPrice5*bidOrderQty5+bidPrice6*bidOrderQty6+bidPrice7*bidOrderQty7+bidPrice8*bidOrderQty8+bidPrice9*bidOrderQty9
}</code></pre><p class="- topic/p p">(2) 下面以计算买方十档成交额中的最大值为例，说明如何使用 <code class="+ topic/ph pr-d/codeph ph codeph">for</code>/<code class="+ topic/ph pr-d/codeph ph codeph">while</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">if-else</code> 语句实现 <code class="+ topic/ph pr-d/codeph ph codeph">max</code> 函数</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">因子计算逻辑</strong>： <em class="+ topic/ph hi-d/i ph i">max(bidPrice0*bidOrderQty0, …,  bidPrice9*bidOrderQty9)</em></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDB 实现代码 (<code class="+ topic/ph pr-d/codeph ph codeph">for</code> 循环+<code class="+ topic/ph pr-d/codeph ph codeph">if-else</code>)</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@jit def calAmountMax(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9){
	amount = [bidPrice0*bidOrderQty0, bidPrice1*bidOrderQty1, bidPrice2*bidOrderQty2, bidPrice3*bidOrderQty3, bidPrice4*bidOrderQty4, bidPrice5*bidOrderQty5, bidPrice6*bidOrderQty6, bidPrice7*bidOrderQty7, bidPrice8*bidOrderQty8, bidPrice9*bidOrderQty9]
	maxRes = -1.0
	for(i in 0:10){
		if(amount[i] &gt; maxRes) maxRes = amount[i]
	}
	return maxRes
}</code></pre><p class="- topic/p p">注意事项：在给变量设置初始值或者默认值的时候，需要注意变量数据类型的前后一致性。比如这个例子中，变量 <code class="+ topic/ph pr-d/codeph ph codeph">maxRes</code> 是 DOUBLE 类型的，则设置初始值的时候需要 <code class="+ topic/ph pr-d/codeph ph codeph">maxRes=-1.0</code> ，而不能 <code class="+ topic/ph pr-d/codeph ph codeph">maxRes=-1</code> 。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">区别 3</strong>：普通的无状态函数多标情况下，传参是向量（详情见“<a class="- topic/xref xref" href="#%E6%97%A0%E7%8A%B6%E6%80%81%E5%87%BD%E6%95%B0">无状态函数</a>” 章节中的注意事项）；JIT 版本中，传参是标量，所以不需要再用 <code class="+ topic/ph pr-d/codeph ph codeph">each</code>/<code class="+ topic/ph pr-d/codeph ph codeph">loop</code> 多一层额外的处理。</p><p class="- topic/p p">以 “无状态函数” 章节的注意事项中的例子为例。可以直接在 <code class="+ topic/ph pr-d/codeph ph codeph">weightedAveragedPrice</code> 函数外面加 @jit 标识，而不需要在 <code class="+ topic/ph pr-d/codeph ph codeph">factorWeightedAveragedPrice</code> 函数里多一层 <code class="+ topic/ph pr-d/codeph ph codeph">each</code> 的处理</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 因子实现
@jit
def weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, default){
    if(bidPrice0 &gt; 0){  return (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)}
    return default
}

metrics = &lt;[dateTime, weightedAveragedPrice(bidPrice0, bidOrderQty0, offerPrice0, offerOrderQty0, 0.0)]&gt;</code></pre></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">区别 4</strong>：JIT 版本中可以通过 vector[index] 的方式来获取向量中指定位置的数据。</p><p class="- topic/p p">但是其中的 <code class="+ topic/ph pr-d/codeph ph codeph">index</code> 只能是标量（index = 0）或者是向量（index=0..5），不能是数据对（index = 0:5）。</p><p class="- topic/p p">（上述写法中，index=0..5 左闭右闭；index=0:5 左闭右开）</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">区别 5</strong>：JIT 版本中函数定义里不能设置默认参数。</p><p class="- topic/p p">比如 <code class="+ topic/ph pr-d/codeph ph codeph">def foo(x, y){}</code> 是可以的，但 <code class="+ topic/ph pr-d/codeph ph codeph">def foo(x, y=1){}</code> 不可以。</p></li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title28" id="43-性能测试"><h3 class="- topic/title title topictitle3" id="ariaid-title28">4.3. 性能测试</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">server 版本</strong>：2.00.9.2 2023.03.10 JIT</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试数据量</strong>：上交所 100 只股票的某日的 Level2 快照数据 (372,208 条数据)</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试方案</strong>：通过 <code class="+ topic/ph pr-d/codeph ph codeph">timer</code> 函数，统计从数据灌入引擎开始到所有指标计算结束的总共耗时。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试结果</strong>：</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="43-性能测试__entry__1"><strong class="+ topic/ph hi-d/b ph b">因子转写方式</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="43-性能测试__entry__2"><strong class="+ topic/ph hi-d/b ph b">耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__1">多档多列</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__2">6368.81</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__1">多档 array vector</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__2">3727.03</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__1">多档多列 + JIT</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__2">771.13</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__1">多档 array vector + JIT</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-性能测试__entry__2">458.56</td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试因子</strong>：十档量价数据除去空档数据后，计算移动平均买卖压力（公式见 “移动平均买卖压力”章节）</p><p class="- topic/p p">多档多列</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def calPress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9){
	bidPrice = [bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9]
	bidOrderQty = [bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9]
	offerPrice = [offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9]
	offerOrderQty = [offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9]
	// 除去空档数据
	bidPrice, bidOrderQty = bidPrice[bidPrice &gt; 0], bidOrderQty[bidPrice &gt; 0]
	offerPrice, offerOrderQty = offerPrice[offerPrice &gt; 0], offerOrderQty[offerPrice &gt; 0]
	// 计算买卖压力指标
	wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)
	bidPress = wavg(bidOrderQty, wap \ (bidPrice - wap))
	askPress = wavg(offerOrderQty, wap \ (offerPrice - wap))
	press = log(bidPress \ askPress)
	return press.nullFill(0.0)
}

@state
def averagePress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){
	press = each(calPress, bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9)
	return mavg(press, lag, 1)
}</code></pre><p class="- topic/p p">多档 array vector</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def calPressArray(bidPrices, bidOrderQtys, offerPrices, offerOrderQtys){
	// 除去空档数据
	bidPrice, bidOrderQty = bidPrices[bidPrices &gt; 0], bidOrderQtys[bidPrices &gt; 0]
	offerPrice, offerOrderQty = offerPrices[offerPrices &gt; 0], offerOrderQtys[offerPrices &gt; 0]
	// 计算买卖压力指标
	wap = (bidPrice[0]*offerOrderQty[0] + offerPrice[0]*bidOrderQty[0]) \ (offerOrderQty[0]+bidOrderQty[0])
	bidPress = wavg(bidOrderQty, wap \ (bidPrice - wap))
	askPress = wavg(offerOrderQty, wap \ (offerPrice - wap))
	press = log(bidPress \ askPress)
	return press.nullFill(0.0)
}

@state
def averagePressArray(bidPrice, bidOrderQty, offerPrice, offerOrderQty, lag){
	press = each(calPressArray, bidPrice, bidOrderQty, offerPrice, offerOrderQty)
	return mavg(press, lag, 1)
}</code></pre><p class="- topic/p p">多档多列 + JIT</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@jit
def calPressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9){
	bidPrice = [bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9]
	bidOrderQty = [bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9]
	offerPrice = [offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9]
	offerOrderQty = [offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9]

	wap = (bidPrice0*offerOrderQty0 + offerPrice0*bidOrderQty0) \ (offerOrderQty0+bidOrderQty0)
	bidPress = 0.0
	bidWeightSum = 0.0
	askPress = 0.0
	askWeightSum = 0.0
	for(i in 0:10){
		if(bidPrice[i] &gt; 0){
			weight = wap \ (bidPrice[i] - wap)
			bidWeightSum += weight
			bidPress += bidOrderQty[i] * weight
		}
		if(offerPrice[i] &gt; 0){
			weight = wap \ (offerPrice[i] - wap)
			askWeightSum += weight
			askPress += offerOrderQty[i] * weight
		}
	}
	bidPress = bidPress \ bidWeightSum
	askPress = askPress \ askWeightSum
	press = log(bidPress \ askPress)
	return press
}

@state
def averagePressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, lag){
	press = calPressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9)
	return mavg(press.nullFill(0.0), lag, 1)
}</code></pre><p class="- topic/p p">多档 array vector + JIT</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>@jit
def calPressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty){
	// 计算买卖压力指标
	wap = (bidPrice[0]*offerOrderQty[0] + offerPrice[0]*bidOrderQty[0]) \ (offerOrderQty[0]+bidOrderQty[0])
	bidPress = 0.0
	bidWeightSum = 0.0
	askPress = 0.0
	askWeightSum = 0.0
	for(i in 0:10){
		if(bidPrice[i] &gt; 0){
			weight = wap \ (bidPrice[i] - wap)
			bidWeightSum += weight
			bidPress += bidOrderQty[i] * weight
		}
		if(offerPrice[i] &gt; 0){
			weight = wap \ (offerPrice[i] - wap)
			askWeightSum += weight
			askPress += offerOrderQty[i] * weight
		}
	}
	bidPress = bidPress \ bidWeightSum
	askPress = askPress \ askWeightSum
	press = log(bidPress \ askPress)
	return press
}

@state
def averagePressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty, lag){
	press = calPressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty)
	return mavg(press.nullFill(0.0), lag, 1)
}</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试脚本</strong>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 导入测试数据
csvPath = "/hdd/hdd0/jit200ssd/server/testdata/"
// 快照多档多列
colName = ["securityID","dateTime","preClosePx","openPx","highPx","lowPx","lastPx","totalVolumeTrade","totalValueTrade","instrumentStatus"] &lt;- flatten(eachLeft(+, ["bidPrice","bidOrderQty","bidNumOrders"], string(0..9))) &lt;- ("bidOrders"+string(0..49)) &lt;- flatten(eachLeft(+, ["offerPrice","offerOrderQty","offerNumOrders"], string(0..9))) &lt;- ("offerOrders"+string(0..49)) &lt;- ["numTrades","iopv","totalBidQty","totalOfferQty","weightedAvgBidPx","weightedAvgOfferPx","totalBidNumber","totalOfferNumber","bidTradeMaxDuration","offerTradeMaxDuration","numBidOrders","numOfferOrders","withdrawBuyNumber","withdrawBuyAmount","withdrawBuyMoney","withdrawSellNumber","withdrawSellAmount","withdrawSellMoney","etfBuyNumber","etfBuyAmount","etfBuyMoney","etfSellNumber","etfSellAmount","etfSellMoney"]
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL"] &lt;- take("DOUBLE", 10) &lt;- take("INT", 70)&lt;- take("DOUBLE", 10) &lt;- take("INT", 70) &lt;- ["INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
data = select * from loadText(csvPath + "snapshot_100stocks_multi.csv", schema=table(colName, colType)) order by dateTime, securityID
// 快照多档 array vector
colName = ["securityID","dateTime","preClosePx","openPx","highPx","lowPx","lastPx","totalVolumeTrade","totalValueTrade","instrumentStatus","bidPrice","bidOrderQty","bidNumOrders","bidOrders","offerPrice","offerOrderQty","offerNumOrders","offerOrders","numTrades","iopv","totalBidQty","totalOfferQty","weightedAvgBidPx","weightedAvgOfferPx","totalBidNumber","totalOfferNumber","bidTradeMaxDuration","offerTradeMaxDuration","numBidOrders","numOfferOrders","withdrawBuyNumber","withdrawBuyAmount","withdrawBuyMoney","withdrawSellNumber","withdrawSellAmount","withdrawSellMoney","etfBuyNumber","etfBuyAmount","etfBuyMoney","etfSellNumber","etfSellAmount","etfSellMoney"]
colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL","DOUBLE[]","INT[]","INT[]","INT[]","DOUBLE[]","INT[]","INT[]","INT[]","INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
dataArrayVector = select * from loadText(csvPath + "snapshot_100stocks_arrayvector.csv", schema=table(colName, colType)) order by dateTime, securityID


// 定义输入输出的表结构
inputTable = table(1:0, data.schema().colDefs.name, data.schema().colDefs.typeString)
inputTableArrayVector = table(1:0, dataArrayVector.schema().colDefs.name, dataArrayVector.schema().colDefs.typeString)
resultTable1 = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])
resultTable2 = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])
resultTable3 = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])
resultTable4 = table(10000:0, ["securityID", "dateTime", "factor"], [SYMBOL, TIMESTAMP, DOUBLE])

// 使用 createReactiveStateEngine 创建响应式状态引擎
// 多档多列
try{ dropStreamEngine("reactiveDemo1")} catch(ex){ print(ex) }
metrics1 = &lt;[dateTime, averagePress(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&gt;
rse1 = createReactiveStateEngine(name="reactiveDemo1", metrics =metrics1, dummyTable=inputTable, outputTable=resultTable1, keyColumn="securityID", keepOrder=true)
// 多档 arrayvector
try{ dropStreamEngine("reactiveDemo2")} catch(ex){ print(ex) }
metrics2 = &lt;[dateTime, averagePressArray(bidPrice, bidOrderQty, offerPrice, offerOrderQty, 60)]&gt;
rse2 = createReactiveStateEngine(name="reactiveDemo2", metrics =metrics2, dummyTable=inputTableArrayVector, outputTable=resultTable2, keyColumn="securityID", keepOrder=true)
// 多档多列 + jit
try{ dropStreamEngine("reactiveDemo3")} catch(ex){ print(ex) }
metrics3 = &lt;[dateTime, averagePressJIT(bidPrice0, bidPrice1, bidPrice2, bidPrice3, bidPrice4, bidPrice5, bidPrice6, bidPrice7, bidPrice8, bidPrice9, bidOrderQty0, bidOrderQty1, bidOrderQty2, bidOrderQty3, bidOrderQty4, bidOrderQty5, bidOrderQty6, bidOrderQty7, bidOrderQty8, bidOrderQty9, offerPrice0, offerPrice1, offerPrice2, offerPrice3, offerPrice4, offerPrice5, offerPrice6, offerPrice7, offerPrice8, offerPrice9, offerOrderQty0, offerOrderQty1, offerOrderQty2, offerOrderQty3, offerOrderQty4, offerOrderQty5, offerOrderQty6, offerOrderQty7, offerOrderQty8, offerOrderQty9, 60)]&gt;
rse3 = createReactiveStateEngine(name="reactiveDemo3", metrics =metrics3, dummyTable=inputTable, outputTable=resultTable3, keyColumn="securityID", keepOrder=true)
// 多档 arrayvector + jit
try{ dropStreamEngine("reactiveDemo4")} catch(ex){ print(ex) }
metrics4 = &lt;[dateTime, averagePressArrayJIT(bidPrice, bidOrderQty, offerPrice, offerOrderQty, 60)]&gt;
rse4 = createReactiveStateEngine(name="reactiveDemo4", metrics =metrics4, dummyTable=inputTableArrayVector, outputTable=resultTable4, keyColumn="securityID", keepOrder=true)

// 输入数据
timer rse1.append!(data)
timer rse2.append!(dataArrayVector)
timer rse3.append!(data)
timer rse4.append!(dataArrayVector)

// 计算结果正确性验证
assert each(eqObj, resultTable1.factor, resultTable2.factor).all()
assert each(eqObj, resultTable1.factor, resultTable3.factor).all()
assert each(eqObj, resultTable1.factor, resultTable4.factor).all()</code></pre></div></article></article></article><article class="- topic/topic topic nested0" aria-labelledby="ariaid-title29" id="附件"><h1 class="- topic/title title topictitle1" id="ariaid-title29">附件</h1><div class="- topic/body body"><p class="- topic/p p">多档多列与多档 array vector 的快照见以下附件：</p><ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads/docs/Streaming_computing_of_financial_quantifiers.zip" target="_blank" rel="external noopener">snapshot_100stocks_arrayvector.zip</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads/docs/Streaming_computing_of_financial_quantifiers.zip" target="_blank" rel="external noopener">snapshot_100stocks_multi.zip</a></li></ul></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E6%A6%82%E8%BF%B0" data-tocid="1-概述">1. 概述</a><ul><li class="topic-item"><a href="#11-dolphindb-%E6%B5%81%E8%AE%A1%E7%AE%97%E6%A1%86%E6%9E%B6" data-tocid="11-dolphindb-流计算框架">1.1. DolphinDB 流计算框架</a></li><li class="topic-item"><a href="#12-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" data-tocid="12-数据结构">1.2. 数据结构</a></li></ul></li><li class="topic-item"><a href="#2--%E6%97%A5%E9%A2%91%E5%9B%A0%E5%AD%90%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0" data-tocid="2--日频因子流式实现">2.  日频因子流式实现</a><ul><li class="topic-item"><a href="#21-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B" data-tocid="21-实现示例">2.1. 实现示例</a><ul><li class="topic-item"><a href="#211-worldquant-alpha-1" data-tocid="211-worldquant-alpha-1">2.1.1. WorldQuant Alpha 1</a></li><li class="topic-item"><a href="#212-%E5%9B%BD%E6%B3%B0%E5%90%9B%E5%AE%89-001-%E5%9B%A0%E5%AD%90" data-tocid="212-国泰君安-001-因子">2.1.2. 国泰君安 001 因子</a></li></ul></li><li class="topic-item"><a href="#22-%E6%94%B9%E5%86%99%E8%A7%84%E5%88%99" data-tocid="22-改写规则">2.2. 改写规则</a></li><li class="topic-item"><a href="#23-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" data-tocid="23-注意事项">2.3. 注意事项</a></li></ul></li><li class="topic-item"><a href="#3-%E9%AB%98%E9%A2%91%E5%9B%A0%E5%AD%90%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0" data-tocid="3-高频因子流式实现">3. 高频因子流式实现</a><ul><li class="topic-item"><a href="#31-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B" data-tocid="31-实现示例">3.1. 实现示例</a><ul><li class="topic-item"><a href="#311-%E4%BB%B7%E6%A0%BC%E6%B6%A8%E8%B7%8C%E5%B9%85" data-tocid="311-价格涨跌幅">3.1.1. 价格涨跌幅</a></li><li class="topic-item"><a href="#312-%E5%8A%A0%E6%9D%83%E5%B9%B3%E5%9D%87%E4%BB%B7%E6%A0%BC" data-tocid="312-加权平均价格">3.1.2. 加权平均价格</a></li></ul></li><li class="topic-item"><a href="#32-%E6%97%A0%E7%8A%B6%E6%80%81%E5%87%BD%E6%95%B0%E5%92%8C%E7%8A%B6%E6%80%81%E5%87%BD%E6%95%B0" data-tocid="32-无状态函数和状态函数">3.2. 无状态函数和状态函数</a><ul><li class="topic-item"><a href="#321-%E6%97%A0%E7%8A%B6%E6%80%81%E5%87%BD%E6%95%B0" data-tocid="321-无状态函数">3.2.1. 无状态函数</a></li><li class="topic-item"><a href="#322-%E7%8A%B6%E6%80%81%E5%87%BD%E6%95%B0" data-tocid="322-状态函数">3.2.2. 状态函数</a></li><li class="topic-item"><a href="#323-%E7%8A%B6%E6%80%81%E5%92%8C%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84%E6%8B%86%E5%88%86" data-tocid="323-状态和无状态的拆分">3.2.3. 状态和无状态的拆分</a><ul><li class="topic-item"><a href="#3231-%E7%A7%BB%E5%8A%A8%E5%B9%B3%E5%9D%87%E4%B9%B0%E5%8D%96%E5%8E%8B%E5%8A%9B" data-tocid="3231-移动平均买卖压力">3.2.3.1. 移动平均买卖压力</a></li><li class="topic-item"><a href="#3232-%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94" data-tocid="3232-性能对比">3.2.3.2. 性能对比</a></li><li class="topic-item"><a href="#3233-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" data-tocid="3233-注意事项">3.2.3.3. 注意事项</a></li></ul></li></ul></li><li class="topic-item"><a href="#33-if-else" data-tocid="33-if-else">3.3. if-else</a></li><li class="topic-item"><a href="#34-%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E7%AA%97%E5%8F%A3%E8%AE%A1%E7%AE%97%E5%92%8C%E8%BF%AD%E4%BB%A3" data-tocid="34-历史数据访问窗口计算和迭代">3.4. 历史数据访问（窗口计算和迭代）</a></li><li class="topic-item"><a href="#35-%E5%BE%AA%E7%8E%AF" data-tocid="35-循环">3.5. 循环</a></li></ul></li><li class="topic-item"><a href="#4-%E8%BF%9B%E9%98%B6%E9%AB%98%E9%A2%91%E5%9B%A0%E5%AD%90%E6%B5%81%E5%BC%8F%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%8C%96" data-tocid="4-进阶高频因子流式实现优化">4. 进阶：高频因子流式实现优化</a><ul><li class="topic-item"><a href="#41-%E6%95%B0%E7%BB%84%E5%90%91%E9%87%8F-array-vector" data-tocid="41-数组向量-array-vector">4.1. 数组向量 (array vector)</a></li><li class="topic-item"><a href="#42-%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91jit" data-tocid="42-即时编译jit">4.2. 即时编译(JIT)</a></li><li class="topic-item"><a href="#43-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="43-性能测试">4.3. 性能测试</a></li></ul></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>