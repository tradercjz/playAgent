<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="DolphinDB 支持使用元编程来动态创建表达式，包括函数调用的表达式与 SQL 查询表达式等。DolphinDB 中有3种方法实现元编程，本文将展开说明如何在 DolphinDB 中基于函数编写元代码。如需了解宏变量元编程方法，请参考 基于宏变量的元编程应用 。 基于函数的元编程实现，是指通过内置元编程函数的组合调用生成元代码。以 select 查询语句为例，一个 select ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="基于函数的元编程应用"/><title>基于函数的元编程应用</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;基于函数的元编程应用&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;基于函数的元编程应用&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;DolphinDB 支持使用元编程来动态创建表达式，包括函数调用的表达式与 SQL 查询表达式等。DolphinDB 中有3种方法实现元编程，本文将展开说明如何在 DolphinDB 中基于函数编写元代码。如需了解宏变量元编程方法，请参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;macro_var_based_metaprogramming.md&#34; xtrc=&#34;xref:1;3:120&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;基于宏变量的元编程应用&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:39;57:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-基于函数生成元代码&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;1. 基于函数生成元代码&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;基于函数的元编程实现，是指通过内置元编程函数的组合调用生成元代码。以 select 查询语句为例，一个 select 语句通常可以拆分为以下几个部分：select 查询主体，表对象，分组字段，排序字段，过滤条件，返回记录数约束等（参考下图标红部分）。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/macro_var_based_metaprogr/a.png&#34; width=&#34;500&#34; xtrc=&#34;image:1;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34; dita-ot:image-width=&#34;723&#34; dita-ot:image-height=&#34;214&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;为了适用于各种 SQL 语句的生成，DolphinDB 设计了用于 SQL 语句的组装的函数 sql（select 语句）， sqlUpdate（update 语句）， sqlDelete（delete 语句），或者也可以通过 parseExpr + SQL 字符串生成 SQL 元代码。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;以 sql 函数为例，其语法为：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql(select, from, [where], [groupBy], [groupFlag], [csort], [ascSort], [having], [orderBy], [ascOrder], [limit], [hint], [exec=false])&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql 函数的每个参数都对应 SQL 的一个子句，通过变量传入即可动态生成对应的 SQL 元代码。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/macro_var_based_metaprogr/b.png&#34; width=&#34;500&#34; xtrc=&#34;image:2;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34; dita-ot:image-width=&#34;446&#34; dita-ot:image-height=&#34;625&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;下面将详细介绍在 DolphinDB 中如何使用函数生成元代码。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;25:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;expr&lt;/codeph&gt; 函数根据输入的对象、运算符或其他元代码生成元代码。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;a=6 expr(a,+,1); &amp;lt; 6 + 1 &amp;gt;&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;34:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;parseExpr&lt;/codeph&gt; 函数把字符串转换为元代码。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;t=table(1 2 3 4 as id, 5 6 7 8 as value, `IBM`MSFT`IBM`GOOG as name) parseExpr(&#34;select * from t where name='IBM'&#34;).eval(); id value name -- ----- ---- 1 5 IBM 3 7 IBM&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;46:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;binaryExpr&lt;/codeph&gt; 生成一个二元运算的元代码。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;binaryExpr(1, 1, +).eval() 2 binaryExpr(1 2.2 3, 1 2 3, *).eval() [1 4.4 9] binaryExpr(`id`st`nm, `fff, +).eval() [&#34;idfff&#34;,&#34;stfff&#34;,&#34;nmfff&#34;]&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;59:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;unifiedExpr&lt;/codeph&gt; 生成一个多元运算表达式的元代码。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;t=table(1..3 as price1, 4..6 as price2, 5..7 as price3) a=sqlColAlias(unifiedExpr((sqlCol(&#34;price1&#34;), sqlCol(&#34;price2&#34;), sqlCol(&#34;price3&#34;)), take(add, 2))) sql(select=(sqlCol(`price1),sqlCol(`price2),sqlCol(`price3),a), from=t) &amp;lt; select price1,price2,price3,price1 + price2 + price3 as price1_add from tc0ccbd6a00000000 &amp;gt;&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;68:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;partial&lt;/codeph&gt; 函数固定一个函数的部分参数，产生一个参数较少的函数。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;70:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;partial(add,1)(2); 3 def f(a,b):a pow b g=partial(f, 2) g(3); 8&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;80:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlCol&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;80:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlColAlias&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;80:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql&lt;/codeph&gt; 函数用于动态生成 SQL 表达式。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;80:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlCol&lt;/codeph&gt; 函数将列名转换为可带有计算内容的表达式，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;80:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlColAlias&lt;/codeph&gt; 常用于生成计算列的元代码，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;80:108&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql&lt;/codeph&gt; 函数可以动态地生成SQL语句。&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;symbol = take(`GE,6) join take(`MSFT,6) join take(`F,6) date=take(take(2017.01.03,2) join take(2017.01.04,4), 18) price=31.82 31.69 31.92 31.8 31.75 31.76 63.12 62.58 63.12 62.77 61.86 62.3 12.46 12.59 13.24 13.41 13.36 13.17 volume=2300 3500 3700 2100 1200 4600 1800 3800 6400 4200 2300 6800 4200 5600 8900 2300 6300 9600 t1 = table(symbol, date, price, volume); x=5000 whereConditions = [&amp;lt;symbol=`MSFT&amp;gt;,&amp;lt;volume&amp;gt;x&amp;gt;] havingCondition = &amp;lt;sum(volume)&amp;gt;200&amp;gt;; sql(sqlCol(&#34;*&#34;), t1); &amp;lt; select * from t1 &amp;gt; sql(sqlCol(&#34;*&#34;), t1, whereConditions); &amp;lt; select * from t1 where symbol == &#34;MSFT&#34;,volume &amp;gt; x &amp;gt; sql(select=sqlColAlias(&amp;lt;avg(price)&amp;gt;), from=t1, where=whereConditions, groupBy=sqlCol(`date)); &amp;lt; select avg(price) as avg_price from t1 where symbol == &#34;MSFT&#34;,volume &amp;gt; x group by date &amp;gt; sql(select=sqlColAlias(&amp;lt;avg(price)&amp;gt;), from=t1, groupBy=[sqlCol(`date),sqlCol(`symbol)]); &amp;lt; select avg(price) as avg_price from t1 group by date,symbol &amp;gt; sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&amp;lt;cumsum(volume)&amp;gt;, `cumVol)), from=t1, groupBy=sqlCol(`date`symbol), groupFlag=0); &amp;lt; select symbol,date,cumsum(volume) as cumVol from t1 context by date,symbol &amp;gt; sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&amp;lt;cumsum(volume)&amp;gt;, `cumVol)), from=t1, where=whereConditions, groupBy=sqlCol(`date), groupFlag=0); &amp;lt; select symbol,date,cumsum(volume) as cumVol from t1 where symbol == &#34;MSFT&#34;,volume &amp;gt; x context by date &amp;gt; sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&amp;lt;cumsum(volume)&amp;gt;, `cumVol)), from=t1, where=whereConditions, groupBy=sqlCol(`date), groupFlag=0, csort=sqlCol(`volume), ascSort=0); &amp;lt; select symbol,date,cumsum(volume) as cumVol from t1 where symbol == &#34;MSFT&#34;,volume &amp;gt; x context by date csort volume desc &amp;gt; sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&amp;lt;cumsum(volume)&amp;gt;, `cumVol)), from=t1, where=whereConditions, groupBy=sqlCol(`date), groupFlag=0, having=havingCondition); &amp;lt; select symbol,date,cumsum(volume) as cumVol from t1 where symbol == &#34;MSFT&#34;,volume &amp;gt; x context by date having sum(volume) &amp;gt; 200 &amp;gt; sql(select=sqlCol(&#34;*&#34;), from=t1, where=whereConditions, orderBy=sqlCol(`date), ascOrder=0); &amp;lt; select * from t1 where symbol == &#34;MSFT&#34;,volume &amp;gt; x order by date desc &amp;gt; sql(select=sqlCol(&#34;*&#34;), from=t1, limit=1); &amp;lt; select top 1 * from t1 &amp;gt; sql(select=sqlCol(&#34;*&#34;), from=t1, groupBy=sqlCol(`symbol), groupFlag=0, limit=1); &amp;lt; select top 1 * from t1 context by symbol &amp;gt;&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;127:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;eval&lt;/codeph&gt; 函数执行元代码。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;a = &amp;lt;1 + 2 * 3&amp;gt; eval(a); 7 sql(sqlColAlias(&amp;lt;avg(vol)&amp;gt;,&#34;avg_vol&#34;),t1,,sqlCol([&#34;sym&#34;,&#34;date&#34;])).eval(); sym date avg_vol ---- ---------- ------- F 2017.01.03 4900 F 2017.01.04 6775 GE 2017.01.03 2900 GE 2017.01.04 2900 MSFT 2017.01.03 8300 MSFT 2017.01.04 4925 //这里使用的t1是上一个例子中的t1&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;146:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlUpdate&lt;/codeph&gt; 函数动态生成 SQL update 语句的元代码。执行生成的元代码需要配合使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;146:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;eval&lt;/codeph&gt; 函数。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;t1=table(`A`A`B`B as symbol, 2021.04.15 2021.04.16 2021.04.15 2021.04.16 as date, 12 13 21 22 as price) t2=table(`A`A`B`B as symbol, 2021.04.15 2021.04.16 2021.04.15 2021.04.16 as date, 10 20 30 40 as volume); sqlUpdate(t1, &amp;lt;price*2 as updatedPrice&amp;gt;).eval() t1;&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:1;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:4;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;symbol&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;156:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;date&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;156:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;price&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:4;156:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;updatedPrice&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;A&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;158:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2021.04.15&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:7;158:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;12&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:8;158:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;24&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;A&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:10;159:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2021.04.16&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:11;159:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;13&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:12;159:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;26&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:13;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;B&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:14;160:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2021.04.15&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:15;160:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;21&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:16;160:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;42&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:17;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;B&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:18;161:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2021.04.16&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:19;161:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;22&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:20;161:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;44&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;163:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlDelete&lt;/codeph&gt; 函数动态生成 SQL delete 语句的元代码。执行生成的元代码需要配合使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;163:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;eval&lt;/codeph&gt; 函数。例如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;t1=table(`A`B`C as symbol, 10 20 30 as x) sqlDelete(t1, &amp;lt;symbol=`C&amp;gt;).eval() t1;&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:2;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:5;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:6;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:21;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;symbol&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:22;171:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;x&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:23;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;A&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:24;173:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;10&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:25;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;B&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:26;174:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;20&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;176:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;176:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;176:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;makeCall&lt;/codeph&gt; 函数和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;176:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;makeUnifiedCall&lt;/codeph&gt; 根据指定的函数与参数生成元代码。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;178:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;例如，查询表 t1 时，把 date 列输出为字符串，并以类似于03/01/2017的形式显示：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql([sqlColAlias(makeCall(temporalFormat,sqlCol(`date),&#34;dd/MM/yyyy&#34;),&#34;date&#34;),sqlCol(`sym),sqlCol(`PRC),sqlCol(`vol)],t1) &amp;lt; select temporalFormat(date, &#34;dd/MM/yyyy&#34;) as date,sym,PRC,vol from t1 &amp;gt;&lt;/codeblock&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;makeUnifiedCall(matrix, (1 2 3, 4 5 6)); &amp;lt; matrix([1,2,3], [4,5,6]) &amp;gt;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;在了解了相关的生成元代码的函数后，我们利用这些函数生成第一节的图中展示的查询语句：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sel=sqlColAlias(makeUnifiedCall(cumsum, sqlCol(&#34;price&#34;)), &#34;cum_price&#34;) fm=&#34;t&#34; wre=parseExpr(&#34;time between 09:00:00 and 15:00:00&#34;) ctxBy=sqlCol(&#34;securityID&#34;) cs=sqlCol(&#34;time&#34;) lim=-1 sql(select=sel, from=fm, where=wre, groupby=ctxBy, groupFlag=0, csort=cs, limit=lim) // output: &amp;lt; select cumsum(price) as cum_price from objByName(&#34;t&#34;) where time between pair(09:00:00, 15:00:00) context by securityID csort time asc limit -1 &amp;gt;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;通过以上代码，可以总结出出 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;203:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql&lt;/codeph&gt; 函数生成元代码的规则：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;查询字段须以 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;205:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlCol&lt;/codeph&gt; 或者 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;205:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlColAlias&lt;/codeph&gt; 声明。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;206:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;对表字段计算的元代码：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;207:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;207:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;单字段参与计算：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;207:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlCol&lt;/codeph&gt; 函数指定 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;207:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;func&lt;/i&gt; 参数。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;208:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;多字段参与计算：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;208:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlColAlias&lt;/codeph&gt; 函数 搭配 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;208:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;makeCall&lt;/codeph&gt; 或者 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;208:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;makeUnifiedCall&lt;/codeph&gt; 函数。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;表对象可以是一个表变量名字符串、表变量如 t 或 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;209:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;loadTable&lt;/codeph&gt; 返回的句柄。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;具体的参数说明请参考：&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/s/sql.dita&#34; xtrc=&#34;xref:2;211:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;sql&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;进一步可以发现 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;213:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql&lt;/codeph&gt; 函数生成的元代码是基于一些小的元代码片段组装的，即通过一些元代码生成函数组装而成。为了进一步理解这个规则，下面介绍一下组装涉及到的相关函数及其作用：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;215:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlCol&lt;/codeph&gt;：支持生成单字段或多字段应用同一函数的表达式，支持指定别名；生成的表达式形如：&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;(1) sqlCol(&#34;col&#34;) --&amp;gt; &amp;lt;col&amp;gt; (2) sqlCol([&#34;col0&#34;,&#34;col1&#34;,&#34;col2&#34;]) --&amp;gt; [&amp;lt;col0&amp;gt;, &amp;lt;col1&amp;gt;, …, &amp;lt;colN&amp;gt;] (3) sqlCol(&#34;col&#34;, func=sum, alias=&#34;newCol&#34;) --&amp;gt; &amp;lt;sum(col) as newCol&amp;gt; (4) sqlCol([&#34;col0&#34;,&#34;col1&#34;,&#34;col2&#34;], func=sum, alias=[&#34;newCol0&#34;,&#34;newCol1&#34;,&#34;newCol2&#34;]) --&amp;gt; [&amp;lt;sum(col0) as newCol0&amp;gt;, &amp;lt;sum(col1) as newCol1&amp;gt;, &amp;lt;sum(col2) as newCol2&amp;gt;]&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;228:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sqlColAlias&lt;/codeph&gt;：为复杂的列字段计算元代码指定别名；&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;229:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;229:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;229:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;229:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;makeCall&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;229:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;makeUnifiedCall&lt;/codeph&gt;：用于生成 &amp;lt;func(cols.., args…)&amp;gt; 的元代码表达式。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;231:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;231:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;231:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;expr&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;231:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;unifiedExpr&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;231:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;binaryExpr&lt;/codeph&gt;：生成多元算术表达式，例如 &amp;lt;a+b+c&amp;gt;, &amp;lt;a1&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;231:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;b1+a2&lt;/i&gt;b2+… +an*bn&amp;gt;。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;233:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;生成的表达式形如：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;235:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;(1) sqlColAlias(sqlCol(&#34;col&#34;), &#34;newCol&#34;) --&amp;gt; &amp;lt;col as newCol&amp;gt; (2) sqlColAlias(makeCall(sum, sqlCol(&#34;col&#34;)), &#34;newCol&#34;) --&amp;gt; &amp;lt;func(col) as newCol&amp;gt; (3) sqlColAlias(makeCall(corr, sqlCol(&#34;col0&#34;), sqlCol(&#34;col1&#34;)), &#34;newCol&#34;) --&amp;gt; &amp;lt;func(col1, col2, …, colN) as newCol&amp;gt;&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;245:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;245:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;245:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;parseExpr&lt;/codeph&gt;：从字符串生成元代码，将拼接、 API 上传或脚本读取的字符串，生成可执行的脚本。例如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;245:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;parseExpr(&#34;select * from t&#34;)&lt;/codeph&gt; 即可生成 &amp;lt;select * from t&amp;gt; 的元代码；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:37;245:118&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;parseExpr(&#34;where vol&amp;gt;1000&#34;)&lt;/codeph&gt; 生成 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:38;245:151&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sql&lt;/codeph&gt; 函数 where 参数部分的元代码等。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;247:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;以一个更复杂的场景为例：基于函数生成 select 部分的元代码 &amp;lt; nullFill(price, quantile(price, 0.5)) as price &amp;gt;，其中 price 是动态传入的一个字段名：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;249:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;colName=`price sqlColAlias(makeCall(nullFill, sqlCol(colName), makeUnifiedCall(quantile, (sqlCol(colName), 0.5))), colName)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-dolphindb-元编程应用&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2. DolphinDB 元编程应用&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-更新内存表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.1. 更新内存表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;258:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;内存表的更新、删除等操作不仅可以通过SQL语句完成，也可以通过元编程完成。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;创建内存表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;262:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;n=1000000 sym=rand(`IBM`MSFT`GOOG`FB`IBM`MSFT,n) date=rand(2018.01.02 2018.01.02 2018.01.02 2018.01.03 2018.01.03 2018.01.03,n) price=rand(1000.0,n) qty=rand(10000,n) trades=table(sym,date,price,qty)&lt;/codeblock&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;211-更新数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.1.1. 更新数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;273:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;例如，更新 IBM 的交易量：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;trades[`qty,&amp;lt;sym=`IBM&amp;gt;]=&amp;lt;qty+100&amp;gt; //等价于 update trades set qty=qty+100 where sym=`IBM&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;212-新增一个列&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.1.2. 新增一个列&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;例如，添加一个新的列 volume，用于保存交易量：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;trades[`volume]=&amp;lt;price*qty&amp;gt; //等价于 update trades set volume=price*qty&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;213-删除数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.1.3. 删除数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;291:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;例如，删除 qty 为 0 的数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;trades.erase!(&amp;lt;qty=0&amp;gt;) //等价于 delete from trades where qty=0&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;214-动态生成过滤条件并更新数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.1.4. 动态生成过滤条件并更新数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;298:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;300:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;本例使用了以下数据表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;302:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;ind1=rand(100,10) ind2=rand(100,10) ind3=rand(100,10) ind4=rand(100,10) ind5=rand(100,10) ind6=rand(100,10) ind7=rand(100,10) ind8=rand(100,10) ind9=rand(100,10) ind10=rand(100,10) indNum=1..10 t=table(ind1,ind2,ind3,ind4,ind5,ind6,ind7,ind8,ind9,ind10,indNum)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;使用以下 SQL 语句对该数据表进行更新操作：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;319:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;update t set ind1=1 where indNum=1 update t set ind2=1 where indNum=2 update t set ind3=1 where indNum=3 update t set ind4=1 where indNum=4 update t set ind5=1 where indNum=5 update t set ind6=1 where indNum=6 update t set ind7=1 where indNum=7 update t set ind8=1 where indNum=8 update t set ind9=1 where indNum=9 update t set ind10=1 where indNum=10&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;如果数据表的列数非常多，需要手工编写非常多的 SQL 语句。使用元编程可以非常简便地完成以上操作。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;334:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;for(i in 1..10){ t[&#34;ind&#34;+i,&amp;lt;indNum=i&amp;gt;]=1 }&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-在内置函数中使用元编程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.2. 在内置函数中使用元编程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;DolphinDB 的一些内置函数的参数中需要使用元编程。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;221-窗口连接&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.2.1. 窗口连接&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;在窗口连接（window join）中，需要为右表的窗口数据集指定一个或多个聚合函数以及这些函数运行时需要的参数。由于问题的描述和执行在两个不同的阶段，必须使用元编程以实现延后执行。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;348:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;t = table(take(`ibm, 3) as sym, 10:01:01 10:01:04 10:01:07 as time, 100 101 105 as price) q = table(take(`ibm, 8) as sym, 10:01:01+ 0..7 as time, 101 103 103 104 104 107 108 107 as ask, 98 99 102 103 103 104 106 106 as bid) wj(t, q, -2:1, &amp;lt; [max(ask), min(bid), avg((bid+ask)*0.5) as avg_mid]&amp;gt;, `time) sym time price max_ask min_bid avg_mid --- -------- ----- ------- ------- ------- ibm 10:01:01 100 103 98 100.25 ibm 10:01:04 101 104 99 102.625 ibm 10:01:07 105 108 103 105.625 &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;222-流计算引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.2.2. 流计算引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;363:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;DolphinDB 提供多种流计算引擎。在使用这些流计算引擎时，需要为数据窗口中的数据指定函数或表达式以及所需参数，这些都需要使用元编程。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;365:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;以时间序列引擎的应用为例：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;367:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;share streamTable(1000:0, `time`sym`qty, [DATETIME, SYMBOL, INT]) as trades output1 = table(10000:0, `time`sym`sumQty, [DATETIME, SYMBOL, INT]) agg1 = createTimeSeriesEngine(name=&#34;engine1&#34;, windowSize=60, step=60, metrics=&amp;lt;[sum(qty)]&amp;gt;, dummyTable=trades, outputTable=output1, timeColumn=`time, useSystemTime=false, keyColumn=`sym, garbageSize=50, useWindowStartTime=false) subscribeTable(tableName=&#34;trades&#34;, actionName=&#34;tableName&#34;, offset=0, handler=append!{agg1}, msgAsTable=true) insert into trades values(2018.10.08T01:01:01,`A,10) insert into trades values(2018.10.08T01:01:02,`B,26) insert into trades values(2018.10.08T01:01:10,`B,14) insert into trades values(2018.10.08T01:01:12,`A,28) insert into trades values(2018.10.08T01:02:10,`A,15) insert into trades values(2018.10.08T01:02:12,`B,9) insert into trades values(2018.10.08T01:02:30,`A,10) insert into trades values(2018.10.08T01:04:02,`A,29) insert into trades values(2018.10.08T01:04:04,`B,32) insert into trades values(2018.10.08T01:04:05,`B,23) select * from output1 time sym sumQty ------------------- --- ------ 2018.10.08T01:02:00 A 38 2018.10.08T01:03:00 A 25 2018.10.08T01:02:00 B 40 2018.10.08T01:03:00 B 9 &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-定制报表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.3. 定制报表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;下例定义了一个用于生成报表的自定义函数，用户只需要输入数据表、字段名称以及字段相应的格式字符串，即可按指定格式输出报表。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;398:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;def generateReport(tbl, colNames, colFormat, filter){ colCount = colNames.size() colDefs = array(ANY, colCount) for(i in 0:colCount){ if(colFormat[i] == &#34;&#34;) colDefs[i] = sqlCol(colNames[i]) else colDefs[i] = sqlCol(colNames[i], format{,colFormat[i]}) } return sql(colDefs, tbl, filter).eval() }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;创建模拟的历史数据库：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;415:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;n=31 date=2020.09.30+1..n sym=take(`A,n) join take(`B,n) t=table(take(date,2*n) as date, sym, 100+rand(1.0,2*n) as price, rand(1000..10000,2*n) as volume) select * from t where date=2020.10.16 and sym=`B; date sym price volume ---------- --- ------------------- ------ 2020.10.16 B 100.324969965266063 6657&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;为2020年10月16日的 B 生成指定格式的报表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:28;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;generateReport(t,`date`sym`price`volume,[&#34;MM/dd/yyyy&#34;,&#34;&#34;,&#34;###.00&#34;,&#34;#,###&#34;],&amp;lt;date=2020.10.16 and sym=`B &amp;gt;); date sym price volume ---------- --- ------ ------ 10/16/2020 B 100.32 6,657&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;436:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;以上语句等价于以下 SQL 语句：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:29;438:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;select format(date,&#34;MM/dd/yyyy&#34;) as date, sym, format(price,&#34;###.00&#34;) as price, format(volume,&#34;#,###&#34;) as volume from t where date=2020.10.16 and sym=`B&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-物联网应用中动态生成计算指标&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.4. 物联网应用中动态生成计算指标&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;在物联网的实时流计算中，数据源包含 tag, timestamp 和 value 三个字段，需要对输入的原始数据进行实时计算。由于每次收到的原始数据的 tag 数量和种类有可能不同，并且每次计算的指标也可能不同，我们无法将计算指标固定下来。这种情况下可以采用元编程的方法。定义一个配置表，将计算的指标放到该表中，可以后续增加、删除或修改计算指标。每次实时计算时，从配置表中动态地读取需要计算的指标，并把计算的结果输出到另外一个表中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;以下是示例代码。pubTable 是流数据的发布表。config 表是存储计算指标的配置表，由于计算指标有可能每次都不相同，config 表是并发版本控制表（mvccTable）。subTable 通过订阅 pubTable，对流数据进行实时计算。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:30;448:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;t1=streamTable(1:0,`tag`value`time,[STRING,DOUBLE,DATETIME]) share t1 as pubTable config = mvccTable(`index1`index2`index3`index4 as targetTag, [&#34;tag1 + tag2&#34;, &#34;sqrt(tag3)&#34;, &#34;floor(tag4)&#34;, &#34;abs(tag5)&#34;] as formular) subTable = streamTable(100:0, `targetTag`value, [STRING, FLOAT]) def calculateTag(mutable subTable,config,msg){ pmsg = select value from msg pivot by time, tag for(row in config){ try{ insert into subTable values(row.targetTag, sql(sqlColAlias(parseExpr(row.formular), &#34;value&#34;), pmsg).eval().value) } catch(ex){print ex} } } subscribeTable(,`pubTable,`calculateTag,-1,calculateTag{subTable,config},true) //模拟写入数据 tmp = table(`tag1`tag2`tag3`tag4 as tag, 1.2 1.3 1.4 1.5 as value, take(2019.01.01T12:00:00, 4) as time) pubTable.append!(tmp) select * from subTable targetTag value --------- -------- index1 2.5 index2 1.183216 index3 1 &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;25-执行一组查询合并查询结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2.5. 执行一组查询，合并查询结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;484:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;在数据分析中，有时我们需要对同一个数据集执行多个相似的查询。我们可以使用元编程动态生成 SQL 语句，以简化大量查询语句的编写。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;486:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;本例使用的数据集结构如下（以第一行为例）：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;16&#34; xtrc=&#34;tgroup:3;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:7;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:8;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:9;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:10;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:11;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:12;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:13;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col8&#34; colnum=&#34;8&#34; xtrc=&#34;colspec:14;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col9&#34; colnum=&#34;9&#34; xtrc=&#34;colspec:15;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col10&#34; colnum=&#34;10&#34; xtrc=&#34;colspec:16;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col11&#34; colnum=&#34;11&#34; xtrc=&#34;colspec:17;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col12&#34; colnum=&#34;12&#34; xtrc=&#34;colspec:18;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col13&#34; colnum=&#34;13&#34; xtrc=&#34;colspec:19;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col14&#34; colnum=&#34;14&#34; xtrc=&#34;colspec:20;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col15&#34; colnum=&#34;15&#34; xtrc=&#34;colspec:21;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col16&#34; colnum=&#34;16&#34; xtrc=&#34;colspec:22;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:27;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;mt&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:28;488:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;vn&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:29;488:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;bc&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:30;488:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;cc&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:31;488:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;stt&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:32;488:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;vt&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:33;488:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;gn&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col8&#34; dita-ot:x=&#34;8&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:34;488:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;bk&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col9&#34; dita-ot:x=&#34;9&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:35;488:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;sc&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col10&#34; dita-ot:x=&#34;10&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:36;488:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;vas&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col11&#34; dita-ot:x=&#34;11&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:37;488:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;pm&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col12&#34; dita-ot:x=&#34;12&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:38;488:87&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;dls&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col13&#34; dita-ot:x=&#34;13&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:39;488:100&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;dt&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col14&#34; dita-ot:x=&#34;14&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:40;488:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;ts&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col15&#34; dita-ot:x=&#34;15&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:41;488:122&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;val&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col16&#34; dita-ot:x=&#34;16&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:42;488:130&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;vol&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;490:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;490:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:43;490:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;52354955&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:44;490:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;50982208&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:45;490:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;25&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:46;490:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;814&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:47;490:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;11&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:48;490:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:49;490:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col8&#34; dita-ot:x=&#34;8&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:50;490:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;4194&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col9&#34; dita-ot:x=&#34;9&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:51;490:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;0&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col10&#34; dita-ot:x=&#34;10&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:52;490:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;0&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col11&#34; dita-ot:x=&#34;11&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:53;490:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;0&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col12&#34; dita-ot:x=&#34;12&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:54;490:87&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2020.02.05&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col13&#34; dita-ot:x=&#34;13&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:55;490:100&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;2020.02.05&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col14&#34; dita-ot:x=&#34;14&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:56;490:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;153234&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col15&#34; dita-ot:x=&#34;15&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:57;490:122&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;5.374&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col16&#34; dita-ot:x=&#34;16&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:58;490:130&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;18600&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;492:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;需要对每天的数据都执行一组查询。为了便于理解，这里我们使用了以下4个查询。实际应用中可能会有几千个查询。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:31;494:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;select * from t where vn=50982208,bc=25,cc=814,stt=11,vt=2, dls=2020.02.05, mt&amp;lt;52355979 order by mt desc limit 1 select * from t where vn=50982208,bc=25,cc=814,stt=12,vt=2, dls=2020.02.05, mt&amp;lt;52355979 order by mt desc limit 1 select * from t where vn=51180116,bc=25,cc=814,stt=12,vt=2, dls=2020.02.05, mt&amp;lt;52354979 order by mt desc limit 1 select * from t where vn=41774759,bc=1180,cc=333,stt=3,vt=116, dsl=2020.02.05, mt&amp;lt;52355979 order by mt desc limit 1&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;501:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;可以观察到，这一组查询中，过滤条件包含的列和排序列都相同，部分过滤条件的值相同，并且都是取排序后的第一行记录。为此，我们编写了自定义函数 bundleQuery：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:32;503:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;def bundleQuery(tbl, dt, dtColName, mt, mtColName, filterColValues, filterColNames){ cnt = filterColValues[0].size() filterColCnt =filterColValues.size() orderByCol = sqlCol(mtColName) selCol = sqlCol(&#34;*&#34;) filters = array(ANY, filterColCnt + 2) filters[filterColCnt] = expr(sqlCol(dtColName), ==, dt) filters[filterColCnt+1] = expr(sqlCol(mtColName), &amp;lt;, mt) queries = array(ANY, cnt) for(i in 0:cnt) { for(j in 0:filterColCnt){ filters[j] = expr(sqlCol(filterColNames[j]), ==, filterColValues[j][i]) } queries.append!(sql(select=selCol, from=tbl, where=filters, orderBy=orderByCol, ascOrder=false, limit=1)) } return loop(eval, queries).unionAll(false) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;524:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;bundleQuery 中各个参数的含义如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;526:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;526:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;tbl 是数据表。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;527:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;dt 是过滤条件中日期列的值。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;528:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;dtColName 是过滤条件中日期列的名称。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;529:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;mt 是过滤条件中 mt 的值。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;530:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;mtColName 是过滤条件中 mt 列的名称。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;531:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;filterColValues 是其他过滤条件中的值，用元组表示，其中的每个向量表示在所有查询语句中的一个过滤条件的值。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;532:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;filterColNames 是其他过滤条件中的列名，用向量表示。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;534:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;上面一组 SQL 语句，相当于执行以下代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:33;536:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;dt = 2020.02.05 dtColName = &#34;dls&#34; mt = 52355979 mtColName = &#34;mt&#34; colNames = `vn`bc`cc`stt`vt colValues = [50982208 50982208 51180116 41774759, 25 25 25 1180, 814 814 814 333, 11 12 12 3, 2 2 2 116] bundleQuery(t, dt, dtColName, mt, mtColName, colValues, colNames)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;547:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;可以执行以下脚本把 bundleQuery 函数定义为函数视图。这样，在集群中的其他数据节点上或者重启系统后，无需重新定义，可以直接调用该函数。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:34;549:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;//please login as admin first addFunctionView(bundleQuery)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-小结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;554:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;554:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;3. 小结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;554:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;556:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/meta_programming.md&#34;&gt;DolphinDB 的元编程功能强大，使用简单，能够极大地提高程序开发效率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/meta_programming.md"/><meta name="wh-out-relpath" content="tutorials/meta_programming.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="基于函数的元编程应用" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/std_sql_ddb.html">编程</a></div></div></li><li class="active"><div class="topicref" data-id="基于函数的元编程应用"><div class="title"><a href="../tutorials/meta_programming.html">基于函数的元编程应用</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="sql-标准化-d9713e99112" class="topicref" data-id="sql-标准化" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="sql-标准化-d9713e99112-link">SQL 标准化</a></div></div></li><li role="treeitem"><div data-tocid="topn-系列函数-d9713e99158" class="topicref" data-id="topn-系列函数" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_TopN.html" id="topn-系列函数-d9713e99158-link">TopN 系列函数</a></div></div></li><li role="treeitem"><div data-tocid="使用-summary-函数生成大规模数据统计信息-d9713e99204" class="topicref" data-id="使用-summary-函数生成大规模数据统计信息" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/generate_large_scale_statistics_with_summary.html" id="使用-summary-函数生成大规模数据统计信息-d9713e99204-link">使用 summary 函数生成大规模数据统计信息</a></div></div></li><li role="treeitem"><div data-tocid="decimal-类型之于-dolphindb-d9713e99250" class="topicref" data-id="decimal-类型之于-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DECIMAL.html" id="decimal-类型之于-dolphindb-d9713e99250-link">DECIMAL 类型之于 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="计算精度问题与-decimal-类型-d9713e99296" class="topicref" data-id="计算精度问题与-decimal-类型" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DECIMAL_Calculation_Characteristics.html" id="计算精度问题与-decimal-类型-d9713e99296-link">计算精度问题与 DECIMAL 类型</a></div></div></li><li role="treeitem"><div data-tocid="机器学习-d9713e99342" class="topicref" data-id="机器学习" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/machine_learning.html" id="机器学习-d9713e99342-link">机器学习</a></div></div></li><li role="treeitem"><div data-tocid="面板数据处理-d9713e99388" class="topicref" data-id="面板数据处理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/panel_data.html" id="面板数据处理-d9713e99388-link">面板数据处理</a></div></div></li><li role="treeitem"><div data-tocid="时区处理-d9713e99434" class="topicref" data-id="时区处理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/timezone.html" id="时区处理-d9713e99434-link">时区处理</a></div></div></li><li role="treeitem"><div data-tocid="pip-降采样算法-d9713e99480" class="topicref" data-id="pip-降采样算法" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/pip_ddb.html" id="pip-降采样算法-d9713e99480-link">PIP 降采样算法</a></div></div></li><li role="treeitem"><div data-tocid="动态增加字段和计算指标-d9713e99526" class="topicref" data-id="动态增加字段和计算指标" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/add_Column.html" id="动态增加字段和计算指标-d9713e99526-link">动态增加字段和计算指标</a></div></div></li><li role="treeitem"><div data-tocid="利用-dolphindb-高效清洗数据-d9713e99572" class="topicref" data-id="利用-dolphindb-高效清洗数据" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_ETL.html" id="利用-dolphindb-高效清洗数据-d9713e99572-link">利用 DolphinDB 高效清洗数据</a></div></div></li><li role="treeitem"><div data-tocid="array-vector-的最佳实践指南-d9713e99619" class="topicref" data-id="array-vector-的最佳实践指南" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Array_Vector.html" id="array-vector-的最佳实践指南-d9713e99619-link">Array Vector 的最佳实践指南</a></div></div></li><li role="treeitem"><div data-tocid="python-到-dolphindb-的函数映射-d9713e99665" class="topicref" data-id="python-到-dolphindb-的函数映射" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/function_mapping_py.html" id="python-到-dolphindb-的函数映射-d9713e99665-link">Python 到 DolphinDB 的函数映射</a></div></div></li><li role="treeitem"><div data-tocid="sql-编写案例-d9713e99711" class="topicref" data-id="sql-编写案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_sql_cases.html" id="sql-编写案例-d9713e99711-link">SQL 编写案例</a></div></div></li><li role="treeitem"><div data-tocid="sql-执行计划-d9713e99757" class="topicref" data-id="sql-执行计划" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_Explain.html" id="sql-执行计划-d9713e99757-link">SQL 执行计划</a></div></div></li><li role="treeitem"><div data-tocid="启动脚本-d9713e99803" class="topicref" data-id="启动脚本" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Startup.html" id="启动脚本-d9713e99803-link">启动脚本</a></div></div></li><li role="treeitem"><div data-tocid="窗口计算-d9713e99849" class="topicref" data-id="窗口计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/window_cal.html" id="窗口计算-d9713e99849-link">窗口计算</a></div></div></li><li role="treeitem"><div data-tocid="多范式编程-d9713e99895" class="topicref" data-id="多范式编程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hybrid_programming_paradigms.html" id="多范式编程-d9713e99895-link">多范式编程</a></div></div></li><li role="treeitem"><div data-tocid="函数化编程案例-d9713e99941" class="topicref" data-id="函数化编程案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/func_progr_cases.html" id="函数化编程案例-d9713e99941-link">函数化编程案例</a></div></div></li><li role="treeitem" class="active"><div data-tocid="基于函数的元编程应用-d9713e99987" class="topicref" data-id="基于函数的元编程应用" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/meta_programming.html" id="基于函数的元编程应用-d9713e99987-link">基于函数的元编程应用</a></div></div></li><li role="treeitem"><div data-tocid="基于-sql-的元编程-d9713e100033" class="topicref" data-id="基于-sql-的元编程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/macro_var_based_metaprogramming.html" id="基于-sql-的元编程-d9713e100033-link">基于 SQL 的元编程</a></div></div></li><li role="treeitem"><div data-tocid="即时编译jit-d9713e100079" class="topicref" data-id="即时编译jit" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/jit.html" id="即时编译jit-d9713e100079-link">即时编译（JIT）</a></div></div></li><li role="treeitem"><div data-tocid="矩阵运算-d9713e100126" class="topicref" data-id="矩阵运算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/matrix.html" id="矩阵运算-d9713e100126-link">矩阵运算</a></div></div></li><li role="treeitem"><div data-tocid="通用计算-d9713e100172" class="topicref" data-id="通用计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/general_computing.html" id="通用计算-d9713e100172-link">通用计算</a></div></div></li><li role="treeitem"><div data-tocid="自定义聚合函数-d9713e100218" class="topicref" data-id="自定义聚合函数" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/udaf.html" id="自定义聚合函数-d9713e100218-link">自定义聚合函数</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-时间类型比较规则-d9713e100264" class="topicref" data-id="dolphindb-时间类型比较规则" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_comparison_rules_of_time_types.html" id="dolphindb-时间类型比较规则-d9713e100264-link">DolphinDB 时间类型比较规则</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-教程概率统计分析-d9713e100310" class="topicref" data-id="dolphindb-教程概率统计分析" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/probabilistic_and_statistical_analysis.html" id="dolphindb-教程概率统计分析-d9713e100310-link">DolphinDB 教程：概率统计分析</a></div></div></li><li role="treeitem"><div data-tocid="编程最容易忽略的十个细节-d9713e100356" class="topicref" data-id="编程最容易忽略的十个细节" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/the_ten_most_overlooked_details_of_programming.html" id="编程最容易忽略的十个细节-d9713e100356-link">编程最容易忽略的十个细节</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-数据访问接口开发教程-d9713e100402" class="topicref" data-id="dolphindb-数据访问接口开发教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/interface_development.html" id="dolphindb-数据访问接口开发教程-d9713e100402-link">DolphinDB 数据访问接口开发教程</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">基于函数的元编程应用</h1><div class="- topic/body body"><p class="- topic/p p">DolphinDB 支持使用元编程来动态创建表达式，包括函数调用的表达式与 SQL 查询表达式等。DolphinDB 中有3种方法实现元编程，本文将展开说明如何在 DolphinDB 中基于函数编写元代码。如需了解宏变量元编程方法，请参考<a class="- topic/xref xref" href="macro_var_based_metaprogramming.html">基于宏变量的元编程应用</a>。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-基于函数生成元代码"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 基于函数生成元代码</h2><div class="- topic/body body"><p class="- topic/p p">基于函数的元编程实现，是指通过内置元编程函数的组合调用生成元代码。以 select 查询语句为例，一个 select  语句通常可以拆分为以下几个部分：select 查询主体，表对象，分组字段，排序字段，过滤条件，返回记录数约束等（参考下图标红部分）。</p><img class="- topic/image image" src="images/macro_var_based_metaprogr/a.png" width="500"/><br/><p class="- topic/p p">为了适用于各种 SQL 语句的生成，DolphinDB 设计了用于 SQL 语句的组装的函数 sql（select 语句）， sqlUpdate（update 语句）， sqlDelete（delete 语句），或者也可以通过 parseExpr + SQL 字符串生成 SQL 元代码。</p><p class="- topic/p p">以 sql 函数为例，其语法为：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>sql(select, from, [where], [groupBy], [groupFlag], [csort], [ascSort], [having], [orderBy], [ascOrder], [limit], [hint], [exec=false])</code></pre><p class="- topic/p p">sql 函数的每个参数都对应 SQL 的一个子句，通过变量传入即可动态生成对应的 SQL 元代码。</p><img class="- topic/image image" src="images/macro_var_based_metaprogr/b.png" width="500"/><br/><p class="- topic/p p">下面将详细介绍在 DolphinDB 中如何使用函数生成元代码。</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">expr</code> 函数根据输入的对象、运算符或其他元代码生成元代码。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>a=6
expr(a,+,1);

&lt; 6 + 1 &gt;</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">parseExpr</code> 函数把字符串转换为元代码。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t=table(1 2 3 4 as id, 5 6 7 8 as value, `IBM`MSFT`IBM`GOOG as name)
parseExpr("select * from t where name='IBM'").eval();

id value name
-- ----- ----
1  5     IBM
3  7     IBM</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">binaryExpr</code> 生成一个二元运算的元代码。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>binaryExpr(1, 1, +).eval()
2

binaryExpr(1 2.2 3, 1 2 3, *).eval()
[1 4.4 9]

binaryExpr(`id`st`nm, `fff, +).eval()
["idfff","stfff","nmfff"]</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">unifiedExpr</code> 生成一个多元运算表达式的元代码。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t=table(1..3 as price1, 4..6 as price2, 5..7 as price3)
a=sqlColAlias(unifiedExpr((sqlCol("price1"), sqlCol("price2"), sqlCol("price3")), take(add, 2)))
sql(select=(sqlCol(`price1),sqlCol(`price2),sqlCol(`price3),a), from=t)
&lt; select price1,price2,price3,price1 + price2 + price3 as price1_add from tc0ccbd6a00000000 &gt;</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">partial</code> 函数固定一个函数的部分参数，产生一个参数较少的函数。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>partial(add,1)(2);
3

def f(a,b):a pow b
g=partial(f, 2)
g(3);
8</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">sqlCol</code>, <code class="+ topic/ph pr-d/codeph ph codeph">sqlColAlias</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">sql</code> 函数用于动态生成 SQL 表达式。<code class="+ topic/ph pr-d/codeph ph codeph">sqlCol</code> 函数将列名转换为可带有计算内容的表达式，<code class="+ topic/ph pr-d/codeph ph codeph">sqlColAlias</code> 常用于生成计算列的元代码，<code class="+ topic/ph pr-d/codeph ph codeph">sql</code> 函数可以动态地生成SQL语句。</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>symbol = take(`GE,6) join take(`MSFT,6) join take(`F,6)
date=take(take(2017.01.03,2) join take(2017.01.04,4), 18)
price=31.82 31.69 31.92 31.8  31.75 31.76 63.12 62.58 63.12 62.77 61.86 62.3 12.46 12.59 13.24 13.41 13.36 13.17
volume=2300 3500 3700 2100 1200 4600 1800 3800 6400 4200 2300 6800 4200 5600 8900 2300 6300 9600
t1 = table(symbol, date, price, volume);

x=5000
whereConditions = [&lt;symbol=`MSFT&gt;,&lt;volume&gt;x&gt;]
havingCondition = &lt;sum(volume)&gt;200&gt;;

sql(sqlCol("*"), t1);
&lt; select * from t1 &gt;

sql(sqlCol("*"), t1, whereConditions);
&lt; select * from t1 where symbol == "MSFT",volume &gt; x &gt;

sql(select=sqlColAlias(&lt;avg(price)&gt;), from=t1, where=whereConditions, groupBy=sqlCol(`date));
&lt; select avg(price) as avg_price from t1 where symbol == "MSFT",volume &gt; x group by date &gt;

sql(select=sqlColAlias(&lt;avg(price)&gt;), from=t1, groupBy=[sqlCol(`date),sqlCol(`symbol)]);
&lt; select avg(price) as avg_price from t1 group by date,symbol &gt;

sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&lt;cumsum(volume)&gt;, `cumVol)), from=t1, groupBy=sqlCol(`date`symbol), groupFlag=0);
&lt; select symbol,date,cumsum(volume) as cumVol from t1 context by date,symbol &gt;

sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&lt;cumsum(volume)&gt;, `cumVol)), from=t1, where=whereConditions, groupBy=sqlCol(`date), groupFlag=0);
&lt; select symbol,date,cumsum(volume) as cumVol from t1 where symbol == "MSFT",volume &gt; x context by date &gt;

sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&lt;cumsum(volume)&gt;, `cumVol)), from=t1, where=whereConditions, groupBy=sqlCol(`date), groupFlag=0, csort=sqlCol(`volume), ascSort=0);
&lt; select symbol,date,cumsum(volume) as cumVol from t1 where symbol == "MSFT",volume &gt; x context by date csort volume desc &gt;

sql(select=(sqlCol(`symbol),sqlCol(`date),sqlColAlias(&lt;cumsum(volume)&gt;, `cumVol)), from=t1, where=whereConditions, groupBy=sqlCol(`date), groupFlag=0, having=havingCondition);
&lt; select symbol,date,cumsum(volume) as cumVol from t1 where symbol == "MSFT",volume &gt; x context by date having sum(volume) &gt; 200 &gt;

sql(select=sqlCol("*"), from=t1, where=whereConditions, orderBy=sqlCol(`date), ascOrder=0);
&lt; select * from t1 where symbol == "MSFT",volume &gt; x order by date desc &gt;

sql(select=sqlCol("*"), from=t1, limit=1);
&lt; select top 1 * from t1 &gt;

sql(select=sqlCol("*"), from=t1, groupBy=sqlCol(`symbol), groupFlag=0, limit=1);
&lt; select top 1 * from t1 context by symbol &gt;</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">eval</code> 函数执行元代码。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>a = &lt;1 + 2 * 3&gt;
eval(a);
7

sql(sqlColAlias(&lt;avg(vol)&gt;,"avg_vol"),t1,,sqlCol(["sym","date"])).eval();
sym  date       avg_vol
---- ---------- -------
F    2017.01.03 4900   
F    2017.01.04 6775   
GE   2017.01.03 2900   
GE   2017.01.04 2900   
MSFT 2017.01.03 8300   
MSFT 2017.01.04 4925   
//这里使用的t1是上一个例子中的t1</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">sqlUpdate</code> 函数动态生成 SQL update 语句的元代码。执行生成的元代码需要配合使用 <code class="+ topic/ph pr-d/codeph ph codeph">eval</code> 函数。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t1=table(`A`A`B`B as symbol, 2021.04.15 2021.04.16 2021.04.15 2021.04.16 as date, 12 13 21 22 as price)
t2=table(`A`A`B`B as symbol, 2021.04.15 2021.04.16 2021.04.15 2021.04.16 as date, 10 20 30 40 as volume);

sqlUpdate(t1, &lt;price*2 as updatedPrice&gt;).eval()
t1;</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="1-基于函数生成元代码__entry__1">symbol</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-基于函数生成元代码__entry__2">date</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-基于函数生成元代码__entry__3">price</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-基于函数生成元代码__entry__4">updatedPrice</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__1">A</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__2">2021.04.15</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__3">12</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__4">24</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__1">A</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__2">2021.04.16</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__3">13</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__4">26</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__1">B</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__2">2021.04.15</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__3">21</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__4">42</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__1">B</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__2">2021.04.16</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__3">22</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__4">44</td></tr></tbody></table></div><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">sqlDelete</code> 函数动态生成 SQL delete 语句的元代码。执行生成的元代码需要配合使用 <code class="+ topic/ph pr-d/codeph ph codeph">eval</code> 函数。例如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t1=table(`A`B`C as symbol, 10 20 30 as x)
sqlDelete(t1, &lt;symbol=`C&gt;).eval()
t1;</code></pre><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="1-基于函数生成元代码__entry__21">symbol</th><th class="- topic/entry entry colsep-0 rowsep-0" id="1-基于函数生成元代码__entry__22">x</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__21">A</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__22">10</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__21">B</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="1-基于函数生成元代码__entry__22">20</td></tr></tbody></table></div><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">makeCall</code> 函数和 <code class="+ topic/ph pr-d/codeph ph codeph">makeUnifiedCall</code> 根据指定的函数与参数生成元代码。</li></ul><p class="- topic/p p">例如，查询表 t1 时，把 date 列输出为字符串，并以类似于03/01/2017的形式显示：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>sql([sqlColAlias(makeCall(temporalFormat,sqlCol(`date),"dd/MM/yyyy"),"date"),sqlCol(`sym),sqlCol(`PRC),sqlCol(`vol)],t1)
&lt; select temporalFormat(date, "dd/MM/yyyy") as date,sym,PRC,vol from t1 &gt;</code></pre><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>makeUnifiedCall(matrix, (1 2 3, 4 5 6));
&lt; matrix([1,2,3], [4,5,6]) &gt;</code></pre><p class="- topic/p p">在了解了相关的生成元代码的函数后，我们利用这些函数生成第一节的图中展示的查询语句：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>sel=sqlColAlias(makeUnifiedCall(cumsum, sqlCol("price")), "cum_price")
fm="t"
wre=parseExpr("time between 09:00:00 and 15:00:00")
ctxBy=sqlCol("securityID")
cs=sqlCol("time")
lim=-1
sql(select=sel, from=fm, where=wre, groupby=ctxBy, groupFlag=0, csort=cs, limit=lim)
// output:
&lt; select cumsum(price) as cum_price from objByName("t") where time between pair(09:00:00, 15:00:00) context by securityID csort time asc limit -1 &gt;</code></pre><p class="- topic/p p">通过以上代码，可以总结出出 <code class="+ topic/ph pr-d/codeph ph codeph">sql</code> 函数生成元代码的规则：</p><ul class="- topic/ul ul"><li class="- topic/li li">查询字段须以 <code class="+ topic/ph pr-d/codeph ph codeph">sqlCol</code> 或者 <code class="+ topic/ph pr-d/codeph ph codeph">sqlColAlias</code> 声明。</li><li class="- topic/li li">对表字段计算的元代码：<ul class="- topic/ul ul"><li class="- topic/li li">单字段参与计算：<code class="+ topic/ph pr-d/codeph ph codeph">sqlCol</code> 函数指定 <em class="+ topic/ph hi-d/i ph i">func</em> 参数。</li><li class="- topic/li li">多字段参与计算：<code class="+ topic/ph pr-d/codeph ph codeph">sqlColAlias</code> 函数 搭配 <code class="+ topic/ph pr-d/codeph ph codeph">makeCall</code> 或者 <code class="+ topic/ph pr-d/codeph ph codeph">makeUnifiedCall</code> 函数。</li></ul></li><li class="- topic/li li">表对象可以是一个表变量名字符串、表变量如 t 或 <code class="+ topic/ph pr-d/codeph ph codeph">loadTable</code> 返回的句柄。</li></ul><p class="- topic/p p">具体的参数说明请参考：<a class="- topic/xref xref" href="../funcs/s/sql.html">sql</a></p><p class="- topic/p p">进一步可以发现 <code class="+ topic/ph pr-d/codeph ph codeph">sql</code> 函数生成的元代码是基于一些小的元代码片段组装的，即通过一些元代码生成函数组装而成。为了进一步理解这个规则，下面介绍一下组装涉及到的相关函数及其作用：</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">sqlCol</code>：支持生成单字段或多字段应用同一函数的表达式，支持指定别名；生成的表达式形如：</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>(1) sqlCol("col") --&gt; &lt;col&gt;

(2) sqlCol(["col0","col1","col2"]) --&gt; [&lt;col0&gt;, &lt;col1&gt;, …, &lt;colN&gt;]

(3) sqlCol("col", func=sum, alias="newCol") --&gt; &lt;sum(col) as newCol&gt;

(4) sqlCol(["col0","col1","col2"], func=sum, alias=["newCol0","newCol1","newCol2"]) 
--&gt; [&lt;sum(col0) as newCol0&gt;, &lt;sum(col1) as newCol1&gt;, &lt;sum(col2) as newCol2&gt;]</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">sqlColAlias</code>：为复杂的列字段计算元代码指定别名；<ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">makeCall</code>, <code class="+ topic/ph pr-d/codeph ph codeph">makeUnifiedCall</code>：用于生成 &lt;func(cols.., args…)&gt; 的元代码表达式。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">expr</code>, <code class="+ topic/ph pr-d/codeph ph codeph">unifiedExpr</code>, <code class="+ topic/ph pr-d/codeph ph codeph">binaryExpr</code>：生成多元算术表达式，例如 &lt;a+b+c&gt;, &lt;a1<em class="+ topic/ph hi-d/i ph i">b1+a2</em>b2+… +an*bn&gt;。</p></li></ul></li></ul><p class="- topic/p p">生成的表达式形如：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>(1) sqlColAlias(sqlCol("col"), "newCol") --&gt; &lt;col as newCol&gt;

(2) sqlColAlias(makeCall(sum, sqlCol("col")), "newCol") 
--&gt; &lt;func(col) as newCol&gt;

(3) sqlColAlias(makeCall(corr, sqlCol("col0"), sqlCol("col1")), "newCol")
--&gt; &lt;func(col1, col2, …, colN) as newCol&gt;</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">parseExpr</code>：从字符串生成元代码，将拼接、 API 上传或脚本读取的字符串，生成可执行的脚本。例如 <code class="+ topic/ph pr-d/codeph ph codeph">parseExpr("select * from t")</code> 即可生成 &lt;select * from t&gt; 的元代码；<code class="+ topic/ph pr-d/codeph ph codeph">parseExpr("where vol&gt;1000")</code> 生成 <code class="+ topic/ph pr-d/codeph ph codeph">sql</code> 函数 where 参数部分的元代码等。</li></ul><p class="- topic/p p">以一个更复杂的场景为例：基于函数生成 select 部分的元代码 &lt; nullFill(price, quantile(price, 0.5)) as price &gt;，其中 price 是动态传入的一个字段名：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>colName=`price
sqlColAlias(makeCall(nullFill, sqlCol(colName), makeUnifiedCall(quantile, (sqlCol(colName), 0.5))), colName)</code></pre></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-dolphindb-元编程应用"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. DolphinDB 元编程应用</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-更新内存表"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1. 更新内存表</h3><div class="- topic/body body"><p class="- topic/p p">内存表的更新、删除等操作不仅可以通过SQL语句完成，也可以通过元编程完成。</p><p class="- topic/p p">创建内存表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>n=1000000
sym=rand(`IBM`MSFT`GOOG`FB`IBM`MSFT,n)
date=rand(2018.01.02 2018.01.02 2018.01.02 2018.01.03 2018.01.03 2018.01.03,n)
price=rand(1000.0,n)
qty=rand(10000,n)
trades=table(sym,date,price,qty)</code></pre></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title5" id="211-更新数据"><h4 class="- topic/title title topictitle4" id="ariaid-title5">2.1.1. 更新数据</h4><div class="- topic/body body"><p class="- topic/p p">例如，更新 IBM 的交易量：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>trades[`qty,&lt;sym=`IBM&gt;]=&lt;qty+100&gt;
//等价于 update trades set qty=qty+100 where sym=`IBM</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title6" id="212-新增一个列"><h4 class="- topic/title title topictitle4" id="ariaid-title6">2.1.2. 新增一个列</h4><div class="- topic/body body"><p class="- topic/p p">例如，添加一个新的列 volume，用于保存交易量：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>trades[`volume]=&lt;price*qty&gt;
//等价于 update trades set volume=price*qty</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title7" id="213-删除数据"><h4 class="- topic/title title topictitle4" id="ariaid-title7">2.1.3. 删除数据</h4><div class="- topic/body body"><p class="- topic/p p">例如，删除 qty 为 0 的数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>trades.erase!(&lt;qty=0&gt;)
//等价于 delete from trades where qty=0</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title8" id="214-动态生成过滤条件并更新数据"><h4 class="- topic/title title topictitle4" id="ariaid-title8">2.1.4. 动态生成过滤条件并更新数据</h4><div class="- topic/body body"><p class="- topic/p p">本例使用了以下数据表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>ind1=rand(100,10)
ind2=rand(100,10)
ind3=rand(100,10)
ind4=rand(100,10)
ind5=rand(100,10)
ind6=rand(100,10)
ind7=rand(100,10)
ind8=rand(100,10)
ind9=rand(100,10)
ind10=rand(100,10)
indNum=1..10
t=table(ind1,ind2,ind3,ind4,ind5,ind6,ind7,ind8,ind9,ind10,indNum)</code></pre><p class="- topic/p p">使用以下 SQL 语句对该数据表进行更新操作：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>update t set ind1=1 where indNum=1
update t set ind2=1 where indNum=2
update t set ind3=1 where indNum=3
update t set ind4=1 where indNum=4
update t set ind5=1 where indNum=5
update t set ind6=1 where indNum=6
update t set ind7=1 where indNum=7
update t set ind8=1 where indNum=8
update t set ind9=1 where indNum=9
update t set ind10=1 where indNum=10</code></pre><p class="- topic/p p">如果数据表的列数非常多，需要手工编写非常多的 SQL 语句。使用元编程可以非常简便地完成以上操作。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>for(i in 1..10){
	t["ind"+i,&lt;indNum=i&gt;]=1
}</code></pre></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="22-在内置函数中使用元编程"><h3 class="- topic/title title topictitle3" id="ariaid-title9">2.2. 在内置函数中使用元编程</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB 的一些内置函数的参数中需要使用元编程。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title10" id="221-窗口连接"><h4 class="- topic/title title topictitle4" id="ariaid-title10">2.2.1. 窗口连接</h4><div class="- topic/body body"><p class="- topic/p p">在窗口连接（window join）中，需要为右表的窗口数据集指定一个或多个聚合函数以及这些函数运行时需要的参数。由于问题的描述和执行在两个不同的阶段，必须使用元编程以实现延后执行。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t = table(take(`ibm, 3) as sym, 10:01:01 10:01:04 10:01:07 as time, 100 101 105 as price)
q = table(take(`ibm, 8) as sym, 10:01:01+ 0..7 as time, 101 103 103 104 104 107 108 107 as ask, 98 99 102 103 103 104 106 106 as bid)
wj(t, q, -2:1, &lt; [max(ask), min(bid), avg((bid+ask)*0.5) as avg_mid]&gt;, `time)

sym time     price max_ask min_bid avg_mid
--- -------- ----- ------- ------- -------
ibm 10:01:01 100   103     98      100.25
ibm 10:01:04 101   104     99      102.625
ibm 10:01:07 105   108     103     105.625
</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="222-流计算引擎"><h4 class="- topic/title title topictitle4" id="ariaid-title11">2.2.2. 流计算引擎</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 提供多种流计算引擎。在使用这些流计算引擎时，需要为数据窗口中的数据指定函数或表达式以及所需参数，这些都需要使用元编程。</p><p class="- topic/p p">以时间序列引擎的应用为例：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>share streamTable(1000:0, `time`sym`qty, [DATETIME, SYMBOL, INT]) as trades
output1 = table(10000:0, `time`sym`sumQty, [DATETIME, SYMBOL, INT])
agg1 = createTimeSeriesEngine(name="engine1", windowSize=60, step=60, metrics=&lt;[sum(qty)]&gt;, dummyTable=trades, outputTable=output1, timeColumn=`time, useSystemTime=false, keyColumn=`sym, garbageSize=50, useWindowStartTime=false)
subscribeTable(tableName="trades", actionName="tableName", offset=0, handler=append!{agg1}, msgAsTable=true)

insert into trades values(2018.10.08T01:01:01,`A,10)
insert into trades values(2018.10.08T01:01:02,`B,26)
insert into trades values(2018.10.08T01:01:10,`B,14)
insert into trades values(2018.10.08T01:01:12,`A,28)
insert into trades values(2018.10.08T01:02:10,`A,15)
insert into trades values(2018.10.08T01:02:12,`B,9)
insert into trades values(2018.10.08T01:02:30,`A,10)
insert into trades values(2018.10.08T01:04:02,`A,29)
insert into trades values(2018.10.08T01:04:04,`B,32)
insert into trades values(2018.10.08T01:04:05,`B,23)

select * from output1

time                sym sumQty
------------------- --- ------
2018.10.08T01:02:00 A   38    
2018.10.08T01:03:00 A   25    
2018.10.08T01:02:00 B   40    
2018.10.08T01:03:00 B   9  </code></pre></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="23-定制报表"><h3 class="- topic/title title topictitle3" id="ariaid-title12">2.3. 定制报表</h3><div class="- topic/body body"><p class="- topic/p p">下例定义了一个用于生成报表的自定义函数，用户只需要输入数据表、字段名称以及字段相应的格式字符串，即可按指定格式输出报表。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def generateReport(tbl, colNames, colFormat, filter){
	colCount = colNames.size()
	colDefs = array(ANY, colCount)
	for(i in 0:colCount){
		if(colFormat[i] == "") 
			colDefs[i] = sqlCol(colNames[i])
		else
			colDefs[i] = sqlCol(colNames[i], format{,colFormat[i]})
	}
	return sql(colDefs, tbl, filter).eval()
}</code></pre><p class="- topic/p p">创建模拟的历史数据库：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>n=31
date=2020.09.30+1..n
sym=take(`A,n) join take(`B,n)
t=table(take(date,2*n) as date, sym, 100+rand(1.0,2*n) as price, rand(1000..10000,2*n) as volume)
select * from t where date=2020.10.16 and sym=`B;

date       sym price               volume
---------- --- ------------------- ------
2020.10.16 B   100.324969965266063 6657</code></pre><p class="- topic/p p">为2020年10月16日的 B 生成指定格式的报表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>generateReport(t,`date`sym`price`volume,["MM/dd/yyyy","","###.00","#,###"],&lt;date=2020.10.16 and sym=`B &gt;);

date       sym price  volume
---------- --- ------ ------
10/16/2020 B   100.32 6,657</code></pre><p class="- topic/p p">以上语句等价于以下 SQL 语句：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select format(date,"MM/dd/yyyy") as date, sym, format(price,"###.00") as price, format(volume,"#,###") as volume from t where date=2020.10.16 and sym=`B</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title13" id="24-物联网应用中动态生成计算指标"><h3 class="- topic/title title topictitle3" id="ariaid-title13">2.4. 物联网应用中动态生成计算指标</h3><div class="- topic/body body"><p class="- topic/p p">在物联网的实时流计算中，数据源包含 tag, timestamp 和 value 三个字段，需要对输入的原始数据进行实时计算。由于每次收到的原始数据的 tag 数量和种类有可能不同，并且每次计算的指标也可能不同，我们无法将计算指标固定下来。这种情况下可以采用元编程的方法。定义一个配置表，将计算的指标放到该表中，可以后续增加、删除或修改计算指标。每次实时计算时，从配置表中动态地读取需要计算的指标，并把计算的结果输出到另外一个表中。</p><p class="- topic/p p">以下是示例代码。pubTable 是流数据的发布表。config 表是存储计算指标的配置表，由于计算指标有可能每次都不相同，config 表是并发版本控制表（mvccTable）。subTable 通过订阅 pubTable，对流数据进行实时计算。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>t1=streamTable(1:0,`tag`value`time,[STRING,DOUBLE,DATETIME])
share t1 as pubTable

config = mvccTable(`index1`index2`index3`index4 as targetTag, ["tag1 + tag2", "sqrt(tag3)", "floor(tag4)", "abs(tag5)"] as formular)

subTable = streamTable(100:0, `targetTag`value, [STRING, FLOAT])

def calculateTag(mutable subTable,config,msg){
	pmsg = select value from msg pivot by time, tag
	for(row in config){
		try{
			insert into subTable values(row.targetTag, sql(sqlColAlias(parseExpr(row.formular), "value"), pmsg).eval().value)
		}
			catch(ex){print ex}
	}
}

subscribeTable(,`pubTable,`calculateTag,-1,calculateTag{subTable,config},true)

//模拟写入数据
tmp = table(`tag1`tag2`tag3`tag4 as tag, 1.2 1.3 1.4 1.5 as value, take(2019.01.01T12:00:00, 4) as time)
pubTable.append!(tmp)

select * from subTable

targetTag value   
--------- --------
index1    2.5     
index2    1.183216
index3    1       
</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title14" id="25-执行一组查询合并查询结果"><h3 class="- topic/title title topictitle3" id="ariaid-title14">2.5. 执行一组查询，合并查询结果</h3><div class="- topic/body body"><p class="- topic/p p">在数据分析中，有时我们需要对同一个数据集执行多个相似的查询。我们可以使用元编程动态生成 SQL 语句，以简化大量查询语句的编写。</p><p class="- topic/p p">本例使用的数据集结构如下（以第一行为例）：</p><div class="table-container"><table class="- topic/table table" data-cols="16"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__1">mt</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__2">vn</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__3">bc</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__4">cc</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__5">stt</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__6">vt</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__7">gn</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__8">bk</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__9">sc</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__10">vas</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__11">pm</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__12">dls</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__13">dt</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__14">ts</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__15">val</th><th class="- topic/entry entry colsep-0 rowsep-0" id="25-执行一组查询合并查询结果__entry__16">vol</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__1">52354955</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__2">50982208</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__3">25</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__4">814</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__5">11</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__6">2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__7">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__8">4194</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__9">0</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__10">0</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__11">0</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__12">2020.02.05</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__13">2020.02.05</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__14">153234</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__15">5.374</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="25-执行一组查询合并查询结果__entry__16">18600</td></tr></tbody></table></div><p class="- topic/p p">需要对每天的数据都执行一组查询。为了便于理解，这里我们使用了以下4个查询。实际应用中可能会有几千个查询。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from t where vn=50982208,bc=25,cc=814,stt=11,vt=2, dls=2020.02.05, mt&lt;52355979 order by mt desc limit 1
select * from t where vn=50982208,bc=25,cc=814,stt=12,vt=2, dls=2020.02.05, mt&lt;52355979 order by mt desc limit 1
select * from t where vn=51180116,bc=25,cc=814,stt=12,vt=2, dls=2020.02.05, mt&lt;52354979 order by mt desc limit 1
select * from t where vn=41774759,bc=1180,cc=333,stt=3,vt=116, dsl=2020.02.05, mt&lt;52355979 order by mt desc limit 1</code></pre><p class="- topic/p p">可以观察到，这一组查询中，过滤条件包含的列和排序列都相同，部分过滤条件的值相同，并且都是取排序后的第一行记录。为此，我们编写了自定义函数 bundleQuery：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def bundleQuery(tbl, dt, dtColName, mt, mtColName, filterColValues, filterColNames){
	cnt = filterColValues[0].size()
	filterColCnt =filterColValues.size()
	orderByCol = sqlCol(mtColName)
	selCol = sqlCol("*")
	filters = array(ANY, filterColCnt + 2)
	filters[filterColCnt] = expr(sqlCol(dtColName), ==, dt)
	filters[filterColCnt+1] = expr(sqlCol(mtColName), &lt;, mt)
	
	queries = array(ANY, cnt)
	for(i in 0:cnt)	{
		for(j in 0:filterColCnt){
			filters[j] = expr(sqlCol(filterColNames[j]), ==, filterColValues[j][i])
		}
		queries.append!(sql(select=selCol, from=tbl, where=filters, orderBy=orderByCol, ascOrder=false, limit=1))
	}
	return loop(eval, queries).unionAll(false)
}</code></pre><p class="- topic/p p">bundleQuery 中各个参数的含义如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">tbl 是数据表。</li><li class="- topic/li li">dt 是过滤条件中日期列的值。</li><li class="- topic/li li">dtColName 是过滤条件中日期列的名称。</li><li class="- topic/li li">mt 是过滤条件中 mt 的值。</li><li class="- topic/li li">mtColName 是过滤条件中 mt 列的名称。</li><li class="- topic/li li">filterColValues 是其他过滤条件中的值，用元组表示，其中的每个向量表示在所有查询语句中的一个过滤条件的值。</li><li class="- topic/li li">filterColNames 是其他过滤条件中的列名，用向量表示。</li></ul><p class="- topic/p p">上面一组 SQL 语句，相当于执行以下代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>dt = 2020.02.05 
dtColName = "dls" 
mt = 52355979 
mtColName = "mt"
colNames = `vn`bc`cc`stt`vt
colValues = [50982208 50982208 51180116 41774759, 25 25 25 1180, 814 814 814 333, 11 12 12 3, 2 2 2 116]

bundleQuery(t, dt, dtColName, mt, mtColName, colValues, colNames)</code></pre><p class="- topic/p p">可以执行以下脚本把 bundleQuery 函数定义为函数视图。这样，在集群中的其他数据节点上或者重启系统后，无需重新定义，可以直接调用该函数。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//please login as admin first
addFunctionView(bundleQuery)</code></pre></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title15" id="3-小结"><h2 class="- topic/title title topictitle2" id="ariaid-title15">3. 小结</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 的元编程功能强大，使用简单，能够极大地提高程序开发效率。</p></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E5%9F%BA%E4%BA%8E%E5%87%BD%E6%95%B0%E7%94%9F%E6%88%90%E5%85%83%E4%BB%A3%E7%A0%81" data-tocid="1-基于函数生成元代码">1. 基于函数生成元代码</a></li><li class="topic-item"><a href="#2-dolphindb-%E5%85%83%E7%BC%96%E7%A8%8B%E5%BA%94%E7%94%A8" data-tocid="2-dolphindb-元编程应用">2. DolphinDB 元编程应用</a><ul><li class="topic-item"><a href="#21-%E6%9B%B4%E6%96%B0%E5%86%85%E5%AD%98%E8%A1%A8" data-tocid="21-更新内存表">2.1. 更新内存表</a><ul><li class="topic-item"><a href="#211-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE" data-tocid="211-更新数据">2.1.1. 更新数据</a></li><li class="topic-item"><a href="#212-%E6%96%B0%E5%A2%9E%E4%B8%80%E4%B8%AA%E5%88%97" data-tocid="212-新增一个列">2.1.2. 新增一个列</a></li><li class="topic-item"><a href="#213-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE" data-tocid="213-删除数据">2.1.3. 删除数据</a></li><li class="topic-item"><a href="#214-%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E8%BF%87%E6%BB%A4%E6%9D%A1%E4%BB%B6%E5%B9%B6%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE" data-tocid="214-动态生成过滤条件并更新数据">2.1.4. 动态生成过滤条件并更新数据</a></li></ul></li><li class="topic-item"><a href="#22-%E5%9C%A8%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%85%83%E7%BC%96%E7%A8%8B" data-tocid="22-在内置函数中使用元编程">2.2. 在内置函数中使用元编程</a><ul><li class="topic-item"><a href="#221-%E7%AA%97%E5%8F%A3%E8%BF%9E%E6%8E%A5" data-tocid="221-窗口连接">2.2.1. 窗口连接</a></li><li class="topic-item"><a href="#222-%E6%B5%81%E8%AE%A1%E7%AE%97%E5%BC%95%E6%93%8E" data-tocid="222-流计算引擎">2.2.2. 流计算引擎</a></li></ul></li><li class="topic-item"><a href="#23-%E5%AE%9A%E5%88%B6%E6%8A%A5%E8%A1%A8" data-tocid="23-定制报表">2.3. 定制报表</a></li><li class="topic-item"><a href="#24-%E7%89%A9%E8%81%94%E7%BD%91%E5%BA%94%E7%94%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E8%AE%A1%E7%AE%97%E6%8C%87%E6%A0%87" data-tocid="24-物联网应用中动态生成计算指标">2.4. 物联网应用中动态生成计算指标</a></li><li class="topic-item"><a href="#25-%E6%89%A7%E8%A1%8C%E4%B8%80%E7%BB%84%E6%9F%A5%E8%AF%A2%E5%90%88%E5%B9%B6%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C" data-tocid="25-执行一组查询合并查询结果">2.5. 执行一组查询，合并查询结果</a></li></ul></li><li class="topic-item"><a href="#3-%E5%B0%8F%E7%BB%93" data-tocid="3-小结">3. 小结</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>