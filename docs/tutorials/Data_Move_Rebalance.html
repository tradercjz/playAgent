<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="数据迁移再平衡的目标是保证分区副本尽可能均衡分布，副本位置影响着 IO 性能、节点负载，对于数据访问延迟有着较大的影响。近来，越来越多的客户对于数据容量或计算性能提出了更高要求，因而进行了集群扩展，扩展之后如何在新的拓扑之中平衡数据，这是客户必然面临的问题。为此，我们撰写了本文，总结数据迁移再平衡的常见场景与方法。 本教程适用于1.30.17、2.00.5及以上版本。 DolphinDB ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="数据再平衡"/><title>数据再平衡</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;数据再平衡&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;数据再平衡&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;数据迁移再平衡的目标是保证分区副本尽可能均衡分布，副本位置影响着 IO 性能、节点负载，对于数据访问延迟有着较大的影响。近来，越来越多的客户对于数据容量或计算性能提出了更高要求，因而进行了集群扩展，扩展之后如何在新的拓扑之中平衡数据，这是客户必然面临的问题。为此，我们撰写了本文，总结数据迁移再平衡的常见场景与方法。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;本教程适用于1.30.17、2.00.5及以上版本。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:65;93:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-概述&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;1. 概述&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;DolphinDB 集群支持扩展节点与存储，以便增强计算能力与数据容量，那么新增的节点与磁盘是没有存储任何数据的，所有数据依旧存储在旧的节点与磁盘。也就是说，不同节点或不同磁盘上的数据分布可能会存在较为严重的倾斜，这样可能会带来几个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;分布式查询计算子任务无法分配到新增的节点，导致该节点计算资源无法被充分利用；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;旧的磁盘 IO 压力过大，新增的磁盘 IO 无法被充分利用。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;再者，数据依旧存储在旧的磁盘，如果旧的数据库分区存在数据写入或更新，那么旧的磁盘空间占满的几率相对较大，一旦满了会引发多种问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;所以，节点与存储变更之后的数据迁移与平衡便显得非常必要。后面章节中，将会重点介绍节点与磁盘变更之后的数据迁移与平衡。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-环境配置与数据模拟&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;2. 环境配置与数据模拟&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-硬件配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;2.1. 硬件配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;测试总共使用三台配置相同的服务器，分别命名为 P1、P2、P3，具体硬件配置如表所示。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:4;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:5;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;处理器&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;24:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;核数&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;24:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;内存&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:4;24:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;操作系统&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:5;24:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;硬盘&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:7;26:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;64&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:8;26:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;512 GB&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:9;26:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;CentOS Linux release 7.9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:10;26:90&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;SSD&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-集群配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;2.2. 集群配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;DolphinDB Server版本为2.00.9。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;基于两台服务器搭建双副本普通集群，假设两台服务器名称分别为 P1、P2，P1 部署一个控制节点、一个代理节点、一个数据节点，P2部署一个代理节点、一个数据节点，如表所示。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:2;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:6;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:7;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:8;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:9;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:10;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:11;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;服务器&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:12;34:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;IP&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:13;34:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;端口&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:14;34:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;节点别名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:15;34:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;节点类型&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:16;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:17;36:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;192.168.100.4X&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:18;36:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;8110&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:19;36:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;ctl1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:20;36:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;控制节点&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:21;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:22;37:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;192.168.100.4X&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:23;37:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;8111&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:24;37:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-agent&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:25;37:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;代理节点&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:26;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:27;38:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;192.168.100.4X&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:28;38:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;8112&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:29;38:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:30;38:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;数据节点&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:31;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:32;39:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;192.168.100.4X&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:33;39:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;8111&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:34;39:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-agent&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:35;39:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;代理节点&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:36;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:37;40:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;192.168.100.4X&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:38;40:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;8112&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:39;40:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:40;40:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;数据节点&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;节点别名中，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;42:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;ctl&lt;/codeph&gt; 为英文单词 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;42:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;controller&lt;/codeph&gt; 的缩写，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;42:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;dn&lt;/codeph&gt; 为英文单词 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;42:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;datanode&lt;/codeph&gt; 的缩写。详细配置情况请参照附件。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-模拟数据&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;2.3. 模拟数据&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;模拟数据为上交所 Level-1 快照数据，基于真实数据结构模拟2000只股票快照数据，基于 OLAP 与 TSDB 存储引擎的建库建表、数据模拟、数据插入脚本如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;model = table(1:0, `SecurityID`DateTime`PreClosePx`OpenPx`HighPx`LowPx`LastPx`Volume`Amount`BidPrice1`BidPrice2`BidPrice3`BidPrice4`BidPrice5`BidOrderQty1`BidOrderQty2`BidOrderQty3`BidOrderQty4`BidOrderQty5`OfferPrice1`OfferPrice2`OfferPrice3`OfferPrice4`OfferPrice5`OfferQty1`OfferQty2`OfferQty3`OfferQty4`OfferQty5, [SYMBOL, DATETIME, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, LONG, LONG, LONG, LONG, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, LONG, LONG, LONG, LONG]) // OLAP存储引擎建库建表 dbDate = database(&#34;&#34;, VALUE, 2020.06.01..2020.06.07) dbSecurityID = database(&#34;&#34;, HASH, [SYMBOL, 10]) db = database(&#34;dfs://Level1&#34;, COMPO, [dbDate, dbSecurityID]) createPartitionedTable(db, model, `Snapshot, `DateTime`SecurityID) // TSDB存储引擎建库建表 dbDate = database(&#34;&#34;, VALUE, 2020.06.01..2020.06.07) dbSymbol = database(&#34;&#34;, HASH, [SYMBOL, 10]) db = database(&#34;dfs://Level1_TSDB&#34;, COMPO, [dbDate, dbSymbol], engine=&#34;TSDB&#34;) createPartitionedTable(db, model, `Snapshot, `DateTime`SecurityID, sortColumns=`SecurityID`DateTime) def mockHalfDayData(Date, StartTime) { t_SecurityID = table(format(600001..602000, &#34;000000&#34;) + &#34;.SH&#34; as SecurityID) t_DateTime = table(concatDateTime(Date, StartTime + 1..2400 * 3) as DateTime) t = cj(t_SecurityID, t_DateTime) size = t.size() return  table(t.SecurityID as SecurityID, t.DateTime as DateTime, rand(100.0, size) as PreClosePx, rand(100.0, size) as OpenPx, rand(100.0, size) as HighPx, rand(100.0, size) as LowPx, rand(100.0, size) as LastPx, rand(10000, size) as Volume, rand(100000.0, size) as Amount, rand(100.0, size) as BidPrice1, rand(100.0, size) as BidPrice2, rand(100.0, size) as BidPrice3, rand(100.0, size) as BidPrice4, rand(100.0, size) as BidPrice5, rand(100000, size) as BidOrderQty1, rand(100000, size) as BidOrderQty2, rand(100000, size) as BidOrderQty3, rand(100000, size) as BidOrderQty4, rand(100000, size) as BidOrderQty5, rand(100.0, size) as OfferPrice1, rand(100.0, size) as OfferPrice2, rand(100.0, size) as OfferPrice3, rand(100.0, size) as OfferPrice4, rand(100.0, size) as OfferPrice5, rand(100000, size) as OfferQty1, rand(100000, size) as OfferQty2, rand(100000, size) as OfferQty3, rand(100000, size) as OfferQty4, rand(100000, size) as OfferQty5) } def mockData(DateVector, StartTimeVector) { for(Date in DateVector) { for(StartTime in StartTimeVector) { data = mockHalfDayData(Date, StartTime) // OLAP存储引擎分布式表插入模拟数据 loadTable(&#34;dfs://Level1&#34;, &#34;Snapshot&#34;).append!(data) // TSDB存储引擎分布式表插入模拟数据 loadTable(&#34;dfs://Level1_TSDB&#34;, &#34;Snapshot&#34;).append!(data) } } } mockData(2020.06.01..2020.06.10, 09:30:00 13:00:00)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;上述脚本中，我们模拟了2020.06.01至2020.06.10共计十天的数据。基于 OLAP 与 TSDB 两种存储引擎的分区方案是一致的，均采用两级分区，分区粒度为表级分区，一级按天作了 VALUE 分区，二级按 SYMBOL 类型作了10个 HASH 分区。各个数据节点分区数量统计如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;select count(*) from pnodeRun(getAllChunks) where dfsPath like &#34;/Level1%&#34; group by site, type&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回结果：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:3;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:11;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:12;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:13;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:41;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;site&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:42;96:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;type&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:43;96:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;count&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:44;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:45;98:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:46;98:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:47;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:48;99:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:49;99:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;200&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:50;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:51;100:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:52;100:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:53;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:54;101:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:55;101:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;200&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;其中，type 字段表示分区类别，0表示 File Chunk，1表示 Tablet Chunk。File Chunk 包含 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;103:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;domain&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;103:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&amp;lt;Table Name&amp;gt;.tbl&lt;/i&gt; 等文件，一个库对应一个 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;103:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;domain&lt;/i&gt; 文件，一个表对应一个 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;103:126&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;tbl&lt;/i&gt; 文件，存储库表结构相关的信息；真正存储数据的区块我们称之为 Tablet Chunk。因为配置了双副本，且在资源允许情况下，副本优先部署在多台物理服务器，所以上述结果符合预期，两个库共计包含408个分区。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-注意事项&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;2.4. 注意事项&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;107:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;由于数据迁移再平衡任务比较耗费物理资源，且对于正在写入、修改、删除操作的分区，由于分区锁的占用，会出现迁移失败的情况；对于耗时较长的查询计算任务，由于缓存指向旧的分区路径，可能会出现中途抛出异常。这些属于预期内的正常现象。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;109:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;109:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;因此，建议无写入、无查询任务执行时进行数据迁移再平衡操作。&lt;/b&gt;&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;111:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;本教程所述的数据迁移方法均为异步操作，并非同步操作。数据迁移任务提交后使用其他工具方法如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;111:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;getRecoveryTaskStatus&lt;/codeph&gt; 查询迁移进度，确认完成后才可执行其他后续操作 (例如缩容)，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;111:103&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;切勿在迁移过程中进行扩缩容操作&lt;/b&gt;。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-函数介绍&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;3. 函数介绍&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;本教程使用到的再平衡与数据迁移相关函数介绍如下，以下所有函数均须在控制节点执行，仅管理员用户拥有权限。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-rebalancechunksamongdatanodes&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;3.1. rebalanceChunksAmongDataNodes&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;函数定义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rebalanceChunksAmongDataNodes([exec=false])&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;功能描述&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;集群之中所有数据节点之间的分区再平衡。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;参数含义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;exec：默认值为 false，仅根据再平衡算法预估分区迁移结果，并不真正执行；为 true，才会执行迁移。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;平衡算法&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;平衡算法存在一些假定条件，诸如：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;旧盘所有已使用空间均是被分区数据占用；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;每个分区大小一致，而实际可能存在偏差；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;新盘所有空间均是用来存储分区数据用的；&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;实际情况与假定条件存在一定的误差，如：磁盘除了存放 DolphinDB 数据外存了不少其它内容，分区大小倾斜严重等，可能会导致再平衡结果不够理想。初次执行再平衡后，旧盘、新盘磁盘空间、分区大小等均发生了变化，多次执行再平衡，可以在一定程度上优化再平衡效果。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-rebalancechunkswithindatanode&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;3.2. rebalanceChunksWithinDataNode&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;函数定义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rebalanceChunksWithinDataNode(nodeAlias, [exec=false])&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;功能描述&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;集群之中某个数据节点内部、不同磁盘之间的数据再平衡。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;参数含义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;153:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;nodeAlias：字符串，表示节点别名。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;exec：默认值为 false，仅根据再平衡算法预估分区迁移结果，并不真正执行；为 true，才会执行迁移。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;平衡算法&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;同上一小节。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-restoredislocatedtablet&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;3.3. restoreDislocatedTablet&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;函数定义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;restoreDislocatedTablet()&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;功能描述&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;当配置分区粒度为表级分区时，同一个分区的所有表将分布在相同的节点下。当调用函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;169:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rebalanceChunksAmongDataNodes&lt;/codeph&gt; 进行数据平衡时，若出现节点宕机或离线，可能出现同一个分区里部分表的数据转移成功，部分表的数据转移失败的情况，即同一个分区下的不同表会分布在不同的节点。该函数可以修复此问题，将同一个分区里的表转移到同一个节点下。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;34-movereplicas&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;3.4. moveReplicas&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;函数定义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;moveReplicas(srcNode, destNode, chunkId)&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;功能描述&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;将源节点上一个或多个分区副本迁移至目标节点。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;参数含义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;srcNode：字符串，表示源节点别名。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;destNode：字符串，表示目标节点别名。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;chunkId：字符串/UUID 标量或向量，表示分区 ID。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;35-movechunksacrossvolume&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;3.5. moveChunksAcrossVolume&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;函数定义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;moveChunksAcrossVolume(srcPath, destPath, chunkIds, [isDelSrc=true])&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;功能描述&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;将磁盘卷源路径下一个或多个分区文件转移至目标路径。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;参数含义&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;srcPath：源分区文件路径。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;destPath：目标分区文件路径。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;chunkIds：分区 ID。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;isDelSrc：拷贝成功后是否删除源分区。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-节点变更场景下的数据迁移&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4. 节点变更场景下的数据迁移&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;本章节针对节点扩容、缩容场景下的分区平衡或数据迁移以示例的形式展开介绍。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-节点扩容&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4.1. 节点扩容&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;215:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;增加一台服务器，名称为 P3，部署一个代理节点、一个数据节点，如表所示。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:4;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:14;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:15;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:16;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:17;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:18;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:56;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;服务器&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:57;217:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;IP&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:58;217:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;端口&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:59;217:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;节点别名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:60;217:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;节点类型&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:61;219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P3&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:62;219:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;192.168.100.4X&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:63;219:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;8111&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:64;219:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P3-agent&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:65;219:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;代理节点&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:66;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P3&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:67;220:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;192.168.100.4X&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:68;220:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;8112&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:69;220:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P3-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:70;220:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;数据节点&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;首先，在数据节点上执行以下命令：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), rebalanceChunksAmongDataNodes{ false })&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回预估分区迁移结果，如图所示，预估 P1-dn1、P2-dn1 共有114个分区迁移至 P3-dn1。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/data_move_rebalance/4_1.png&#34; xtrc=&#34;image:1;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34; dita-ot:image-width=&#34;901&#34; dita-ot:image-height=&#34;437&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;然后，在数据节点上执行以下命令，真正地执行分区再平衡。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), rebalanceChunksAmongDataNodes{ true })&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，查看再平衡任务执行进度与任务并发度。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), getRecoveryTaskStatus) rpc(getControllerAlias(), getConfigure{ `dfsRebalanceConcurrency }) pnodeRun(getRecoveryWorkerNum)&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/data_move_rebalance/4_2.png&#34; xtrc=&#34;image:2;246:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34; dita-ot:image-width=&#34;1443&#34; dita-ot:image-height=&#34;406&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;248:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;任务执行进度如图所示。可以看到，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;248:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;DeleteSource&lt;/codeph&gt; 字段全部为 True，该参数表示是否会删除源数据节点副本。原因在于，对于数据节点之间的分区再平衡，从源数据节点到目的数据节点复制完成后，源数据节点会删除相应副本信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;Status&lt;/codeph&gt;字段为 In-Progress 的任务数目表示控制节点发起任务时的并发度，通过 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;250:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;dfsRebalanceConcurrency&lt;/i&gt; 参数配置，默认为数据节点个数的两倍。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;250:93&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;recoveryWorkers&lt;/codeph&gt; 参数表示数据节点执行任务时的并发度，默认为1。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;252:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;252:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;Status&lt;/codeph&gt; 字段为 Finished，表示该任务已经完成。等待所有任务执行完毕后，在数据节点上执行以下命令，查看再平衡后各个数据节点分区数量统计。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;select count(*) from pnodeRun(getAllChunks) group by site&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;258:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回结果：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:5;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:19;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:20;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:71;260:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;site&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:72;260:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;count&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;262:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;262:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:73;262:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:74;262:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;196&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:75;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:76;263:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;98&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;264:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:77;264:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P3-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:78;264:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;114&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-节点扩容时数据迁移性能&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;266:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;266:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4.2. 节点扩容时数据迁移性能&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;266:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;268:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，统计再平衡整体耗时。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;270:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;select max(FinishTime - StartTime) as maxDiffTime from rpc(getControllerAlias(), getRecoveryTaskStatus)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回结果：89秒。114个分区占用磁盘空间约17GB，节点之间再平衡时数据迁移速度约为200MB/s。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;7&#34; xtrc=&#34;tgroup:6;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:21;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:22;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:23;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:24;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:25;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:26;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:27;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:79;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;场景&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:80;276:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;是否跨服务器&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:81;276:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;网络&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:82;276:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;硬盘&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:83;276:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;任务发起并发度&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:84;276:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;任务执行并发度&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:85;276:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;迁移速率（MB/s）&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:86;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;节点之间分区迁移&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:87;278:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;是&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:88;278:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;万兆&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:89;278:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;SSD&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:90;278:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;6&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:91;278:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;6&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:92;278:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;200&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;43-节点缩容&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4.3. 节点缩容&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;我们将缩减上一小节中增加的服务器 P3，缩减之前，需要将 P3-dn1 数据节点上的分区副本迁移至集群中其它数据节点上。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;自定义 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;284:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;moveChunks&lt;/codeph&gt; 函数，入参为一个源节点名称，内部实现依赖 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;284:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;moveReplicas&lt;/codeph&gt; 函数，迁移源节点上所有分区副本至其它节点上。在数据节点上执行以下命令，执行迁移操作。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;286:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;def moveChunks(srcNode) { chunks = exec chunkId from pnodeRun(getAllChunks) where site = srcNode allNodes = pnodeRun(getNodeAlias).node for(chunk in chunks) { destNode = allNodes[at(not allNodes in (exec site from pnodeRun(getAllChunks) where chunkId = chunk))].rand(1)[0] print(&#34;From &#34; + srcNode + &#34;, to &#34; + destNode + &#34;, moving &#34; + chunk) rpc(getControllerAlias(), moveReplicas, srcNode, destNode, chunk) } } srcNode = &#34;P3-dn1&#34; moveChunks(srcNode)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，查看迁移进度。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;303:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), getRecoveryTaskStatus)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;等待所有任务执行完毕后，在数据节点上执行以下命令，查看迁移后各个数据节点分区数量统计。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;select count(*) from pnodeRun(getAllChunks) group by site&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;313:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回结果：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:7;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:28;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:29;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:93;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;site&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:94;315:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;count&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:95;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:96;317:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;204&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:97;318:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:98;318:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;204&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;320:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;此时，P3-dn1 数据节点上已不包含任何分区副本，可以进行节点缩减。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-磁盘变更场景下的数据迁移&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;5. 磁盘变更场景下的数据迁移&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;本章节针对磁盘扩容、缩容场景下的分区平衡或数据迁移以示例的形式展开介绍。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;51-磁盘扩容&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;326:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;326:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;5.1. 磁盘扩容&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;326:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;对于每个数据节点增加一块磁盘。配置文件中 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;328:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;volumes&lt;/codeph&gt; 参数由&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;330:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;volumes=/ssd/ssd0/jtwang/chunkData&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;334:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;更改为：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;volumes=/ssd/ssd0/jtwang/chunkData,/ssd/ssd1/jtwang/chunkData&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，对于 P1-dn1 数据节点上各块磁盘之间进行分区再平衡。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ &#34;P1-dn1&#34;, false }) rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ &#34;P1-dn1&#34;, true })&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;347:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，查看迁移进度。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;349:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), getRecoveryTaskStatus)&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/data_move_rebalance/5_1.png&#34; xtrc=&#34;image:3;353:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34; dita-ot:image-width=&#34;1466&#34; dita-ot:image-height=&#34;408&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;355:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;同样地，在数据节点上执行以下命令，对于 P2-dn1 数据节点上各块磁盘之间进行分区再平衡。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;357:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ &#34;P2-dn1&#34;, false }) rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ &#34;P2-dn1&#34;, true })&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，查看迁移进度。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;rpc(getControllerAlias(), getRecoveryTaskStatus)&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/data_move_rebalance/5_2.png&#34; xtrc=&#34;image:4;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34; dita-ot:image-width=&#34;1468&#34; dita-ot:image-height=&#34;439&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;370:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;从图中看，两次再平衡共计迁移189个分区。可以看到，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;370:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;DeleteSource&lt;/codeph&gt; 字段全部为 False，原因为对于数据节点内部分区迁移，从旧盘到新盘，分区仍然是在同一个数据节点，所以该参数一直为 False。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;372:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;等待所有任务执行完毕后，在数据节点上执行以下命令，查看迁移后各个数据节点各块磁盘的分区数量统计。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;374:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;def getDiskNo(path) { size = path.size() result = array(STRING, 0, size) for(i in 0 : size) { append!(result, concat(split(path[i], &#34;/&#34;)[0:5], &#34;/&#34;)) } return result } select count(*) from pnodeRun(getAllChunks) group by site, getDiskNo(path) as disk&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;385:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回结果：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:8;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:8;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:30;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:31;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:32;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:8;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:99;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;site&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:100;387:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;disk&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:101;387:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;count&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:8;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:102;389:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:103;389:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;/ssd/ssd0/jtwang/chunkData&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:104;389:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;108&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;390:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:105;390:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:106;390:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;/ssd/ssd1/jtwang/chunkData&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:107;390:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;96&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:108;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:109;391:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;/ssd/ssd0/jtwang/chunkData&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:110;391:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;111&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:111;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:112;392:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;/ssd/ssd1/jtwang/chunkData&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:113;392:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;93&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;52-磁盘扩容时数据迁移性能&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;5.2. 磁盘扩容时数据迁移性能&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1 数据节点上各块磁盘之间分区再平衡之后，在数据节点上执行以下命令，统计再平衡整体耗时。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;398:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;select max(FinishTime - StartTime) as maxDiffTime from rpc(getControllerAlias(), getRecoveryTaskStatus)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;402:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回结果：56秒。96个分区占用磁盘空间约14GB，节点内部再平衡时数据迁移速度约为250MB/s。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:9;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;7&#34; xtrc=&#34;tgroup:9;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:33;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:34;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:35;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:36;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:37;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:38;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:39;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:9;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:114;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;场景&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:115;404:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;是否跨服务器&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:116;404:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;网络&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:117;404:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;硬盘&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:118;404:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;任务发起并发度&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:119;404:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;任务执行并发度&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:120;404:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;迁移速率（MB/s）&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:9;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:121;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;磁盘之间分区迁移&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:122;406:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;否&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:123;406:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;万兆&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:124;406:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;SSD&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:125;406:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:126;406:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:127;406:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;250&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;53-磁盘缩容&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;5.3. 磁盘缩容&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;410:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;我们将缩减上一小节中增加的磁盘，缩减之前，需要将各个数据节点新增的磁盘上的分区副本迁移至其它磁盘。请注意，删除指定的第一个磁盘卷涉及更复杂的操作，因此不建议进行此操作。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，将 P1-dn1、P2-dn1 数据节点 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;412:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;ssd1&lt;/codeph&gt; 盘上的分区迁移至 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;412:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;ssd0&lt;/codeph&gt; 盘。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;414:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;srcPath = &#34;/ssd/ssd1/jtwang/chunkData/CHUNKS&#34; destPath = &#34;/ssd/ssd0/jtwang/chunkData/CHUNKS&#34; node = &#34;P1-dn1&#34; chunkIds = exec chunkId from pnodeRun(getAllChunks) where site = node, path like (srcPath + &#34;%&#34;) rpc(node, moveChunksAcrossVolume{ srcPath, destPath, chunkIds, isDelSrc=true }) node = &#34;P2-dn1&#34; chunkIds = exec chunkId from pnodeRun(getAllChunks) where site = node, path like (srcPath + &#34;%&#34;) rpc(node, moveChunksAcrossVolume{ srcPath, destPath, chunkIds, isDelSrc=true })&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;在数据节点上执行以下命令，查看迁移后各个数据节点各块磁盘的分区数量统计。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;429:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;select count(*) from pnodeRun(getAllChunks) group by site, getDiskNo(path) as disk&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;433:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;返回结果：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:10;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:10;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:40;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:41;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:42;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:10;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:128;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;site&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:129;435:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;disk&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:130;435:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;count&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:10;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:131;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P1-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:132;437:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;/ssd/ssd0/jtwang/chunkData&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:133;437:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;204&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;438:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:134;438:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;P2-dn1&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:135;438:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;/ssd/ssd0/jtwang/chunkData&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:136;438:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;204&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;440:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;此时，各个数据节点 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;440:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;ssd1&lt;/codeph&gt; 盘上已不包含任何分区副本，可以进行磁盘缩容。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-小结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;6. 小结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;节点与磁盘的扩容和缩容，是生产环境中比较常见的场景。通过对此类场景的模拟和解决方案的实现，我们展示了 DolphinDB 强大、便捷的数据迁移与平衡能力，解决了集群扩展之后如何优化资源使用的问题。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;7-附件&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;7. 附件&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;448:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;script/data_move_rebalance/config.zip&#34; xtrc=&#34;xref:1;448:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/Data_Move_Rebalance.md&#34;&gt;&lt;?ditaot usertext?&gt;data_move_rebalance&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/Data_Move_Rebalance.md"/><meta name="wh-out-relpath" content="tutorials/Data_Move_Rebalance.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="数据再平衡" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/scheduledJob_2.html">系统运维</a></div></div></li><li class="active"><div class="topicref" data-id="数据再平衡"><div class="title"><a href="../tutorials/Data_Move_Rebalance.html">数据再平衡</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="定时作业-d9713e100956" class="topicref" data-id="定时作业" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="定时作业-d9713e100956-link">定时作业</a></div></div></li><li role="treeitem"><div data-tocid="作业管理-d9713e101002" class="topicref" data-id="作业管理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/job_management_tutorial_2.html" id="作业管理-d9713e101002-link">作业管理</a></div></div></li><li role="treeitem"><div data-tocid="用户权限管理-d9713e101048" class="topicref" data-id="用户权限管理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ACL_and_Security_2.html" id="用户权限管理-d9713e101048-link">用户权限管理</a></div></div></li><li role="treeitem"><div data-tocid="数据备份以及恢复-130202008及之后版本-d9713e101094" class="topicref" data-id="数据备份以及恢复-130202008及之后版本" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backup-restore-new.html" id="数据备份以及恢复-130202008及之后版本-d9713e101094-link">数据备份以及恢复 （1.30.20/2.00.8及之后版本）</a></div></div></li><li role="treeitem"><div data-tocid="数据备份以及恢复-130202008以前版本-d9713e101140" class="topicref" data-id="数据备份以及恢复-130202008以前版本" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backup_restore_before_208.html" id="数据备份以及恢复-130202008以前版本-d9713e101140-link">数据备份以及恢复 （1.30.20/2.00.8以前版本）</a></div></div></li><li role="treeitem" class="active"><div data-tocid="数据再平衡-d9713e101186" class="topicref" data-id="数据再平衡" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Data_Move_Rebalance.html" id="数据再平衡-d9713e101186-link">数据再平衡</a></div></div></li><li role="treeitem"><div data-tocid="集群间数据库同步-d9713e101232" class="topicref" data-id="集群间数据库同步" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_sync_among_clusters.html" id="集群间数据库同步-d9713e101232-link">集群间数据库同步</a></div></div></li><li role="treeitem"><div data-tocid="集群间异步复制-d9713e101278" class="topicref" data-id="集群间异步复制" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/async_replication.html" id="集群间异步复制-d9713e101278-link">集群间异步复制</a></div></div></li><li role="treeitem"><div data-tocid="数据导入最容易忽略的十个细节-d9713e101324" class="topicref" data-id="数据导入最容易忽略的十个细节" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_import_details.html" id="数据导入最容易忽略的十个细节-d9713e101324-link">数据导入最容易忽略的十个细节</a></div></div></li><li role="treeitem"><div data-tocid="线程模型-d9713e101370" class="topicref" data-id="线程模型" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/threading_model.html" id="线程模型-d9713e101370-link">线程模型</a></div></div></li><li role="treeitem"><div data-tocid="线程简介-d9713e101416" class="topicref" data-id="线程简介" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/thread_intro_2.html" id="线程简介-d9713e101416-link">线程简介</a></div></div></li><li role="treeitem"><div data-tocid="内存管理-d9713e101463" class="topicref" data-id="内存管理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/memory_management.html" id="内存管理-d9713e101463-link">内存管理</a></div></div></li><li role="treeitem"><div data-tocid="out-of-memory-d9713e101509" class="topicref" data-id="out-of-memory" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/oom_settlement_2.html" id="out-of-memory-d9713e101509-link">Out of Memory</a></div></div></li><li role="treeitem"><div data-tocid="非标权限管理-d9713e101555" class="topicref" data-id="非标权限管理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/non-standard_permission_management.html" id="非标权限管理-d9713e101555-link">非标权限管理</a></div></div></li><li role="treeitem"><div data-tocid="节点启动流程简析与常见问题-d9713e101601" class="topicref" data-id="节点启动流程简析与常见问题" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/node_startup_process_and_questions.html" id="节点启动流程简析与常见问题-d9713e101601-link">节点启动流程简析与常见问题</a></div></div></li><li role="treeitem"><div data-tocid="用户级别的资源跟踪详解-d9713e101647" class="topicref" data-id="用户级别的资源跟踪详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/user_level_resource_tracking.html" id="用户级别的资源跟踪详解-d9713e101647-link">用户级别的资源跟踪详解</a></div></div></li><li role="treeitem"><div data-tocid="使用-prometheus-监控告警-d9713e101693" class="topicref" data-id="使用-prometheus-监控告警" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/promethues2.html" id="使用-prometheus-监控告警-d9713e101693-link">使用 Prometheus 监控告警</a></div></div></li><li role="treeitem"><div data-tocid="redash-连接-dolphindb-数据源-d9713e101739" class="topicref" data-id="redash-连接-dolphindb-数据源" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_interface_for_redash.html" id="redash-连接-dolphindb-数据源-d9713e101739-link">Redash 连接 DolphinDB 数据源</a></div></div></li><li role="treeitem"><div data-tocid="使用-chart-组件展示数据-d9713e101785" class="topicref" data-id="使用-chart-组件展示数据" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/web_chart_integration.html" id="使用-chart-组件展示数据-d9713e101785-link">使用 chart 组件展示数据</a></div></div></li><li role="treeitem"><div data-tocid="debezium--kafka-实时同步-oracle-11g-数据到-dolphindb-运维手册-d9713e101831" class="topicref" data-id="debezium--kafka-实时同步-oracle-11g-数据到-dolphindb-运维手册" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/debezium_kafka_real_time_synchronization_of_oracle_11g_data.html" id="debezium--kafka-实时同步-oracle-11g-数据到-dolphindb-运维手册-d9713e101831-link">Debezium + Kafka 实时同步 Oracle 11g 数据到 DolphinDB 运维手册</a></div></div></li><li role="treeitem"><div data-tocid="基于_zabbix_的_dolphindb_集群运维监控-d9713e101877" class="topicref" data-id="基于_zabbix_的_dolphindb_集群运维监控" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/zabbix_cluster_monitoring.html" id="基于_zabbix_的_dolphindb_集群运维监控-d9713e101877-link">基于 Zabbix 的 DolphinDB 集群运维监控</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">数据再平衡</h1><div class="- topic/body body"><p class="- topic/p p">数据迁移再平衡的目标是保证分区副本尽可能均衡分布，副本位置影响着 IO 性能、节点负载，对于数据访问延迟有着较大的影响。近来，越来越多的客户对于数据容量或计算性能提出了更高要求，因而进行了集群扩展，扩展之后如何在新的拓扑之中平衡数据，这是客户必然面临的问题。为此，我们撰写了本文，总结数据迁移再平衡的常见场景与方法。</p><p class="- topic/p p">本教程适用于1.30.17、2.00.5及以上版本。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-概述"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 概述</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 集群支持扩展节点与存储，以便增强计算能力与数据容量，那么新增的节点与磁盘是没有存储任何数据的，所有数据依旧存储在旧的节点与磁盘。也就是说，不同节点或不同磁盘上的数据分布可能会存在较为严重的倾斜，这样可能会带来几个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">分布式查询计算子任务无法分配到新增的节点，导致该节点计算资源无法被充分利用；</li><li class="- topic/li li">旧的磁盘 IO 压力过大，新增的磁盘 IO 无法被充分利用。</li></ul><p class="- topic/p p">再者，数据依旧存储在旧的磁盘，如果旧的数据库分区存在数据写入或更新，那么旧的磁盘空间占满的几率相对较大，一旦满了会引发多种问题。</p><p class="- topic/p p">所以，节点与存储变更之后的数据迁移与平衡便显得非常必要。后面章节中，将会重点介绍节点与磁盘变更之后的数据迁移与平衡。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-环境配置与数据模拟"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. 环境配置与数据模拟</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-硬件配置"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1. 硬件配置</h3><div class="- topic/body body"><p class="- topic/p p">测试总共使用三台配置相同的服务器，分别命名为 P1、P2、P3，具体硬件配置如表所示。</p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="21-硬件配置__entry__1">处理器</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="21-硬件配置__entry__2">核数</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="21-硬件配置__entry__3">内存</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="21-硬件配置__entry__4">操作系统</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="21-硬件配置__entry__5">硬盘</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="21-硬件配置__entry__1">Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="21-硬件配置__entry__2">64</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="21-硬件配置__entry__3">512 GB</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="21-硬件配置__entry__4">CentOS Linux release 7.9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="21-硬件配置__entry__5">SSD</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="22-集群配置"><h3 class="- topic/title title topictitle3" id="ariaid-title5">2.2. 集群配置</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDB Server版本为2.00.9。</p><p class="- topic/p p">基于两台服务器搭建双副本普通集群，假设两台服务器名称分别为 P1、P2，P1 部署一个控制节点、一个代理节点、一个数据节点，P2部署一个代理节点、一个数据节点，如表所示。</p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-集群配置__entry__1">服务器</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-集群配置__entry__2">IP</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-集群配置__entry__3">端口</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-集群配置__entry__4">节点别名</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-集群配置__entry__5">节点类型</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__1">P1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__2">192.168.100.4X</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__3">8110</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__4">ctl1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__5">控制节点</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__1">P1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__2">192.168.100.4X</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__3">8111</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__4">P1-agent</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__5">代理节点</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__1">P1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__2">192.168.100.4X</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__3">8112</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__4">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__5">数据节点</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__1">P2</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__2">192.168.100.4X</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__3">8111</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__4">P2-agent</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__5">代理节点</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__1">P2</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__2">192.168.100.4X</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__3">8112</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__4">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-集群配置__entry__5">数据节点</td></tr></tbody></table></div><p class="- topic/p p">节点别名中，<code class="+ topic/ph pr-d/codeph ph codeph">ctl</code> 为英文单词 <code class="+ topic/ph pr-d/codeph ph codeph">controller</code> 的缩写，<code class="+ topic/ph pr-d/codeph ph codeph">dn</code> 为英文单词 <code class="+ topic/ph pr-d/codeph ph codeph">datanode</code> 的缩写。详细配置情况请参照附件。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="23-模拟数据"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.3. 模拟数据</h3><div class="- topic/body body"><p class="- topic/p p">模拟数据为上交所 Level-1 快照数据，基于真实数据结构模拟2000只股票快照数据，基于 OLAP 与 TSDB 存储引擎的建库建表、数据模拟、数据插入脚本如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>model = table(1:0, `SecurityID`DateTime`PreClosePx`OpenPx`HighPx`LowPx`LastPx`Volume`Amount`BidPrice1`BidPrice2`BidPrice3`BidPrice4`BidPrice5`BidOrderQty1`BidOrderQty2`BidOrderQty3`BidOrderQty4`BidOrderQty5`OfferPrice1`OfferPrice2`OfferPrice3`OfferPrice4`OfferPrice5`OfferQty1`OfferQty2`OfferQty3`OfferQty4`OfferQty5, [SYMBOL, DATETIME, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, LONG, LONG, LONG, LONG, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, LONG, LONG, LONG, LONG])

// OLAP存储引擎建库建表
dbDate = database("", VALUE, 2020.06.01..2020.06.07)
dbSecurityID = database("", HASH, [SYMBOL, 10])
db = database("dfs://Level1", COMPO, [dbDate, dbSecurityID])
createPartitionedTable(db, model, `Snapshot, `DateTime`SecurityID)

// TSDB存储引擎建库建表
dbDate = database("", VALUE, 2020.06.01..2020.06.07)
dbSymbol = database("", HASH, [SYMBOL, 10])
db = database("dfs://Level1_TSDB", COMPO, [dbDate, dbSymbol], engine="TSDB")
createPartitionedTable(db, model, `Snapshot, `DateTime`SecurityID, sortColumns=`SecurityID`DateTime)

def mockHalfDayData(Date, StartTime) {
    t_SecurityID = table(format(600001..602000, "000000") + ".SH" as SecurityID)
    t_DateTime = table(concatDateTime(Date, StartTime + 1..2400 * 3) as DateTime)
    t = cj(t_SecurityID, t_DateTime)
    size = t.size()
    return  table(t.SecurityID as SecurityID, t.DateTime as DateTime, rand(100.0, size) as PreClosePx, rand(100.0, size) as OpenPx, rand(100.0, size) as HighPx, rand(100.0, size) as LowPx, rand(100.0, size) as LastPx, rand(10000, size) as Volume, rand(100000.0, size) as Amount, rand(100.0, size) as BidPrice1, rand(100.0, size) as BidPrice2, rand(100.0, size) as BidPrice3, rand(100.0, size) as BidPrice4, rand(100.0, size) as BidPrice5, rand(100000, size) as BidOrderQty1, rand(100000, size) as BidOrderQty2, rand(100000, size) as BidOrderQty3, rand(100000, size) as BidOrderQty4, rand(100000, size) as BidOrderQty5, rand(100.0, size) as OfferPrice1, rand(100.0, size) as OfferPrice2, rand(100.0, size) as OfferPrice3, rand(100.0, size) as OfferPrice4, rand(100.0, size) as OfferPrice5, rand(100000, size) as OfferQty1, rand(100000, size) as OfferQty2, rand(100000, size) as OfferQty3, rand(100000, size) as OfferQty4, rand(100000, size) as OfferQty5)
}

def mockData(DateVector, StartTimeVector) {
    for(Date in DateVector) {
        for(StartTime in StartTimeVector) {
            data = mockHalfDayData(Date, StartTime)
 
            // OLAP存储引擎分布式表插入模拟数据
            loadTable("dfs://Level1", "Snapshot").append!(data)
  
            // TSDB存储引擎分布式表插入模拟数据
            loadTable("dfs://Level1_TSDB", "Snapshot").append!(data)
        }   
    }
}

mockData(2020.06.01..2020.06.10, 09:30:00 13:00:00)</code></pre><p class="- topic/p p">上述脚本中，我们模拟了2020.06.01至2020.06.10共计十天的数据。基于 OLAP 与 TSDB 两种存储引擎的分区方案是一致的，均采用两级分区，分区粒度为表级分区，一级按天作了 VALUE 分区，二级按 SYMBOL 类型作了10个 HASH 分区。各个数据节点分区数量统计如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select count(*) from pnodeRun(getAllChunks) where dfsPath like "/Level1%" group by site, type</code></pre><p class="- topic/p p">返回结果：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-模拟数据__entry__1">site</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-模拟数据__entry__2">type</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-模拟数据__entry__3">count</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__1">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__2">0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__3">4</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__1">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__2">1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__3">200</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__1">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__2">0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__3">4</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__1">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__2">1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-模拟数据__entry__3">200</td></tr></tbody></table></div><p class="- topic/p p">其中，type 字段表示分区类别，0表示 File Chunk，1表示 Tablet Chunk。File Chunk 包含 <em class="+ topic/ph hi-d/i ph i">domain</em>、<em class="+ topic/ph hi-d/i ph i">&lt;Table Name&gt;.tbl</em> 等文件，一个库对应一个 <em class="+ topic/ph hi-d/i ph i">domain</em> 文件，一个表对应一个 <em class="+ topic/ph hi-d/i ph i">tbl</em> 文件，存储库表结构相关的信息；真正存储数据的区块我们称之为 Tablet Chunk。因为配置了双副本，且在资源允许情况下，副本优先部署在多台物理服务器，所以上述结果符合预期，两个库共计包含408个分区。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="24-注意事项"><h3 class="- topic/title title topictitle3" id="ariaid-title7">2.4. 注意事项</h3><div class="- topic/body body"><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">由于数据迁移再平衡任务比较耗费物理资源，且对于正在写入、修改、删除操作的分区，由于分区锁的占用，会出现迁移失败的情况；对于耗时较长的查询计算任务，由于缓存指向旧的分区路径，可能会出现中途抛出异常。这些属于预期内的正常现象。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">因此，建议无写入、无查询任务执行时进行数据迁移再平衡操作。</strong></p></li><li class="- topic/li li"><p class="- topic/p p">本教程所述的数据迁移方法均为异步操作，并非同步操作。数据迁移任务提交后使用其他工具方法如 <code class="+ topic/ph pr-d/codeph ph codeph">getRecoveryTaskStatus</code> 查询迁移进度，确认完成后才可执行其他后续操作 (例如缩容)，<strong class="+ topic/ph hi-d/b ph b">切勿在迁移过程中进行扩缩容操作</strong>。</p></li></ol></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title8" id="3-函数介绍"><h2 class="- topic/title title topictitle2" id="ariaid-title8">3. 函数介绍</h2><div class="- topic/body body"><p class="- topic/p p">本教程使用到的再平衡与数据迁移相关函数介绍如下，以下所有函数均须在控制节点执行，仅管理员用户拥有权限。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="31-rebalancechunksamongdatanodes"><h3 class="- topic/title title topictitle3" id="ariaid-title9">3.1. rebalanceChunksAmongDataNodes</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">函数定义</strong></p><p class="- topic/p p">rebalanceChunksAmongDataNodes([exec=false])</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">功能描述</strong></p><p class="- topic/p p">集群之中所有数据节点之间的分区再平衡。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">参数含义</strong></p><p class="- topic/p p">exec：默认值为 false，仅根据再平衡算法预估分区迁移结果，并不真正执行；为 true，才会执行迁移。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">平衡算法</strong></p><p class="- topic/p p">平衡算法存在一些假定条件，诸如：</p><ul class="- topic/ul ul"><li class="- topic/li li">旧盘所有已使用空间均是被分区数据占用；</li><li class="- topic/li li">每个分区大小一致，而实际可能存在偏差；</li><li class="- topic/li li">新盘所有空间均是用来存储分区数据用的；</li></ul><p class="- topic/p p">实际情况与假定条件存在一定的误差，如：磁盘除了存放 DolphinDB 数据外存了不少其它内容，分区大小倾斜严重等，可能会导致再平衡结果不够理想。初次执行再平衡后，旧盘、新盘磁盘空间、分区大小等均发生了变化，多次执行再平衡，可以在一定程度上优化再平衡效果。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="32-rebalancechunkswithindatanode"><h3 class="- topic/title title topictitle3" id="ariaid-title10">3.2. rebalanceChunksWithinDataNode</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">函数定义</strong></p><p class="- topic/p p">rebalanceChunksWithinDataNode(nodeAlias, [exec=false])</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">功能描述</strong></p><p class="- topic/p p">集群之中某个数据节点内部、不同磁盘之间的数据再平衡。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">参数含义</strong></p><p class="- topic/p p">nodeAlias：字符串，表示节点别名。</p><p class="- topic/p p">exec：默认值为 false，仅根据再平衡算法预估分区迁移结果，并不真正执行；为 true，才会执行迁移。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">平衡算法</strong></p><p class="- topic/p p">同上一小节。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title11" id="33-restoredislocatedtablet"><h3 class="- topic/title title topictitle3" id="ariaid-title11">3.3. restoreDislocatedTablet</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">函数定义</strong></p><p class="- topic/p p">restoreDislocatedTablet()</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">功能描述</strong></p><p class="- topic/p p">当配置分区粒度为表级分区时，同一个分区的所有表将分布在相同的节点下。当调用函数 <code class="+ topic/ph pr-d/codeph ph codeph">rebalanceChunksAmongDataNodes</code> 进行数据平衡时，若出现节点宕机或离线，可能出现同一个分区里部分表的数据转移成功，部分表的数据转移失败的情况，即同一个分区下的不同表会分布在不同的节点。该函数可以修复此问题，将同一个分区里的表转移到同一个节点下。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="34-movereplicas"><h3 class="- topic/title title topictitle3" id="ariaid-title12">3.4. moveReplicas</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">函数定义</strong></p><p class="- topic/p p">moveReplicas(srcNode, destNode, chunkId)</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">功能描述</strong></p><p class="- topic/p p">将源节点上一个或多个分区副本迁移至目标节点。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">参数含义</strong></p><p class="- topic/p p">srcNode：字符串，表示源节点别名。</p><p class="- topic/p p">destNode：字符串，表示目标节点别名。</p><p class="- topic/p p">chunkId：字符串/UUID 标量或向量，表示分区 ID。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title13" id="35-movechunksacrossvolume"><h3 class="- topic/title title topictitle3" id="ariaid-title13">3.5. moveChunksAcrossVolume</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">函数定义</strong></p><p class="- topic/p p">moveChunksAcrossVolume(srcPath, destPath, chunkIds, [isDelSrc=true])</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">功能描述</strong></p><p class="- topic/p p">将磁盘卷源路径下一个或多个分区文件转移至目标路径。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">参数含义</strong></p><p class="- topic/p p">srcPath：源分区文件路径。</p><p class="- topic/p p">destPath：目标分区文件路径。</p><p class="- topic/p p">chunkIds：分区 ID。</p><p class="- topic/p p">isDelSrc：拷贝成功后是否删除源分区。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title14" id="4-节点变更场景下的数据迁移"><h2 class="- topic/title title topictitle2" id="ariaid-title14">4. 节点变更场景下的数据迁移</h2><div class="- topic/body body"><p class="- topic/p p">本章节针对节点扩容、缩容场景下的分区平衡或数据迁移以示例的形式展开介绍。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title15" id="41-节点扩容"><h3 class="- topic/title title topictitle3" id="ariaid-title15">4.1. 节点扩容</h3><div class="- topic/body body"><p class="- topic/p p">增加一台服务器，名称为 P3，部署一个代理节点、一个数据节点，如表所示。</p><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="41-节点扩容__entry__1">服务器</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="41-节点扩容__entry__2">IP</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="41-节点扩容__entry__3">端口</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="41-节点扩容__entry__4">节点别名</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="41-节点扩容__entry__5">节点类型</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__1">P3</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__2">192.168.100.4X</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__3">8111</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__4">P3-agent</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__5">代理节点</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__1">P3</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__2">192.168.100.4X</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__3">8112</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__4">P3-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__5">数据节点</td></tr></tbody></table></div><p class="- topic/p p">首先，在数据节点上执行以下命令：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), rebalanceChunksAmongDataNodes{ false })</code></pre><p class="- topic/p p">返回预估分区迁移结果，如图所示，预估 P1-dn1、P2-dn1 共有114个分区迁移至 P3-dn1。</p><img class="- topic/image image" src="images/data_move_rebalance/4_1.png"/><br/><p class="- topic/p p">然后，在数据节点上执行以下命令，真正地执行分区再平衡。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), rebalanceChunksAmongDataNodes{ true })</code></pre><p class="- topic/p p">在数据节点上执行以下命令，查看再平衡任务执行进度与任务并发度。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getRecoveryTaskStatus)
rpc(getControllerAlias(), getConfigure{ `dfsRebalanceConcurrency })
pnodeRun(getRecoveryWorkerNum)</code></pre><img class="- topic/image image" src="images/data_move_rebalance/4_2.png"/><br/><p class="- topic/p p">任务执行进度如图所示。可以看到，<code class="+ topic/ph pr-d/codeph ph codeph">DeleteSource</code> 字段全部为 True，该参数表示是否会删除源数据节点副本。原因在于，对于数据节点之间的分区再平衡，从源数据节点到目的数据节点复制完成后，源数据节点会删除相应副本信息。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Status</code>字段为 In-Progress 的任务数目表示控制节点发起任务时的并发度，通过 <em class="+ topic/ph hi-d/i ph i">dfsRebalanceConcurrency</em> 参数配置，默认为数据节点个数的两倍。<code class="+ topic/ph pr-d/codeph ph codeph">recoveryWorkers</code> 参数表示数据节点执行任务时的并发度，默认为1。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Status</code> 字段为 Finished，表示该任务已经完成。等待所有任务执行完毕后，在数据节点上执行以下命令，查看再平衡后各个数据节点分区数量统计。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select count(*) from pnodeRun(getAllChunks) group by site</code></pre><p class="- topic/p p">返回结果：</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="41-节点扩容__entry__16">site</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="41-节点扩容__entry__17">count</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__16">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__17">196</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__16">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__17">98</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__16">P3-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="41-节点扩容__entry__17">114</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title16" id="42-节点扩容时数据迁移性能"><h3 class="- topic/title title topictitle3" id="ariaid-title16">4.2. 节点扩容时数据迁移性能</h3><div class="- topic/body body"><p class="- topic/p p">在数据节点上执行以下命令，统计再平衡整体耗时。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select max(FinishTime - StartTime) as maxDiffTime from rpc(getControllerAlias(), getRecoveryTaskStatus)</code></pre><p class="- topic/p p">返回结果：89秒。114个分区占用磁盘空间约17GB，节点之间再平衡时数据迁移速度约为200MB/s。</p><div class="table-container"><table class="- topic/table table" data-cols="7"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="42-节点扩容时数据迁移性能__entry__1">场景</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="42-节点扩容时数据迁移性能__entry__2">是否跨服务器</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="42-节点扩容时数据迁移性能__entry__3">网络</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="42-节点扩容时数据迁移性能__entry__4">硬盘</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="42-节点扩容时数据迁移性能__entry__5">任务发起并发度</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="42-节点扩容时数据迁移性能__entry__6">任务执行并发度</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="42-节点扩容时数据迁移性能__entry__7">迁移速率（MB/s）</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="42-节点扩容时数据迁移性能__entry__1">节点之间分区迁移</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="42-节点扩容时数据迁移性能__entry__2">是</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="42-节点扩容时数据迁移性能__entry__3">万兆</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="42-节点扩容时数据迁移性能__entry__4">SSD</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="42-节点扩容时数据迁移性能__entry__5">6</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="42-节点扩容时数据迁移性能__entry__6">6</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="42-节点扩容时数据迁移性能__entry__7">200</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title17" id="43-节点缩容"><h3 class="- topic/title title topictitle3" id="ariaid-title17">4.3. 节点缩容</h3><div class="- topic/body body"><p class="- topic/p p">我们将缩减上一小节中增加的服务器 P3，缩减之前，需要将 P3-dn1 数据节点上的分区副本迁移至集群中其它数据节点上。</p><p class="- topic/p p">自定义 <code class="+ topic/ph pr-d/codeph ph codeph">moveChunks</code> 函数，入参为一个源节点名称，内部实现依赖 <code class="+ topic/ph pr-d/codeph ph codeph">moveReplicas</code> 函数，迁移源节点上所有分区副本至其它节点上。在数据节点上执行以下命令，执行迁移操作。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def moveChunks(srcNode) {
    chunks = exec chunkId from pnodeRun(getAllChunks) where site = srcNode
    allNodes = pnodeRun(getNodeAlias).node
    for(chunk in chunks) {
        destNode = allNodes[at(not allNodes in (exec site from pnodeRun(getAllChunks) where chunkId = chunk))].rand(1)[0]
        print("From " + srcNode + ", to " + destNode + ", moving " + chunk)
        rpc(getControllerAlias(), moveReplicas, srcNode, destNode, chunk)
    }
}

srcNode = "P3-dn1"
moveChunks(srcNode)</code></pre><p class="- topic/p p">在数据节点上执行以下命令，查看迁移进度。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getRecoveryTaskStatus)</code></pre><p class="- topic/p p">等待所有任务执行完毕后，在数据节点上执行以下命令，查看迁移后各个数据节点分区数量统计。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select count(*) from pnodeRun(getAllChunks) group by site</code></pre><p class="- topic/p p">返回结果：</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="43-节点缩容__entry__1">site</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="43-节点缩容__entry__2">count</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-节点缩容__entry__1">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-节点缩容__entry__2">204</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-节点缩容__entry__1">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="43-节点缩容__entry__2">204</td></tr></tbody></table></div><p class="- topic/p p">此时，P3-dn1 数据节点上已不包含任何分区副本，可以进行节点缩减。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title18" id="5-磁盘变更场景下的数据迁移"><h2 class="- topic/title title topictitle2" id="ariaid-title18">5. 磁盘变更场景下的数据迁移</h2><div class="- topic/body body"><p class="- topic/p p">本章节针对磁盘扩容、缩容场景下的分区平衡或数据迁移以示例的形式展开介绍。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title19" id="51-磁盘扩容"><h3 class="- topic/title title topictitle3" id="ariaid-title19">5.1. 磁盘扩容</h3><div class="- topic/body body"><p class="- topic/p p">对于每个数据节点增加一块磁盘。配置文件中 <code class="+ topic/ph pr-d/codeph ph codeph">volumes</code> 参数由</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>volumes=/ssd/ssd0/jtwang/chunkData</code></pre><p class="- topic/p p">更改为：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>volumes=/ssd/ssd0/jtwang/chunkData,/ssd/ssd1/jtwang/chunkData</code></pre><p class="- topic/p p">在数据节点上执行以下命令，对于 P1-dn1 数据节点上各块磁盘之间进行分区再平衡。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ "P1-dn1", false })
rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ "P1-dn1", true })</code></pre><p class="- topic/p p">在数据节点上执行以下命令，查看迁移进度。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getRecoveryTaskStatus)</code></pre><img class="- topic/image image" src="images/data_move_rebalance/5_1.png"/><br/><p class="- topic/p p">同样地，在数据节点上执行以下命令，对于 P2-dn1 数据节点上各块磁盘之间进行分区再平衡。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ "P2-dn1", false })
rpc(getControllerAlias(), rebalanceChunksWithinDataNode{ "P2-dn1", true })</code></pre><p class="- topic/p p">在数据节点上执行以下命令，查看迁移进度。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getRecoveryTaskStatus)</code></pre><img class="- topic/image image" src="images/data_move_rebalance/5_2.png"/><br/><p class="- topic/p p">从图中看，两次再平衡共计迁移189个分区。可以看到，<code class="+ topic/ph pr-d/codeph ph codeph">DeleteSource</code> 字段全部为 False，原因为对于数据节点内部分区迁移，从旧盘到新盘，分区仍然是在同一个数据节点，所以该参数一直为 False。</p><p class="- topic/p p">等待所有任务执行完毕后，在数据节点上执行以下命令，查看迁移后各个数据节点各块磁盘的分区数量统计。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def getDiskNo(path) {
    size = path.size()
    result = array(STRING, 0, size)
    for(i in 0 : size) { append!(result, concat(split(path[i], "/")[0:5], "/")) }
    return result
}

select count(*) from pnodeRun(getAllChunks) group by site, getDiskNo(path) as disk</code></pre><p class="- topic/p p">返回结果：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="51-磁盘扩容__entry__1">site</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="51-磁盘扩容__entry__2">disk</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="51-磁盘扩容__entry__3">count</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__1">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__2">/ssd/ssd0/jtwang/chunkData</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__3">108</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__1">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__2">/ssd/ssd1/jtwang/chunkData</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__3">96</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__1">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__2">/ssd/ssd0/jtwang/chunkData</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__3">111</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__1">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__2">/ssd/ssd1/jtwang/chunkData</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="51-磁盘扩容__entry__3">93</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title20" id="52-磁盘扩容时数据迁移性能"><h3 class="- topic/title title topictitle3" id="ariaid-title20">5.2. 磁盘扩容时数据迁移性能</h3><div class="- topic/body body"><p class="- topic/p p">P1-dn1 数据节点上各块磁盘之间分区再平衡之后，在数据节点上执行以下命令，统计再平衡整体耗时。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select max(FinishTime - StartTime) as maxDiffTime from rpc(getControllerAlias(), getRecoveryTaskStatus)</code></pre><p class="- topic/p p">返回结果：56秒。96个分区占用磁盘空间约14GB，节点内部再平衡时数据迁移速度约为250MB/s。</p><div class="table-container"><table class="- topic/table table" data-cols="7"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="52-磁盘扩容时数据迁移性能__entry__1">场景</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="52-磁盘扩容时数据迁移性能__entry__2">是否跨服务器</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="52-磁盘扩容时数据迁移性能__entry__3">网络</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="52-磁盘扩容时数据迁移性能__entry__4">硬盘</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="52-磁盘扩容时数据迁移性能__entry__5">任务发起并发度</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="52-磁盘扩容时数据迁移性能__entry__6">任务执行并发度</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="52-磁盘扩容时数据迁移性能__entry__7">迁移速率（MB/s）</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="52-磁盘扩容时数据迁移性能__entry__1">磁盘之间分区迁移</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="52-磁盘扩容时数据迁移性能__entry__2">否</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="52-磁盘扩容时数据迁移性能__entry__3">万兆</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="52-磁盘扩容时数据迁移性能__entry__4">SSD</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="52-磁盘扩容时数据迁移性能__entry__5">4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="52-磁盘扩容时数据迁移性能__entry__6">4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="52-磁盘扩容时数据迁移性能__entry__7">250</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title21" id="53-磁盘缩容"><h3 class="- topic/title title topictitle3" id="ariaid-title21">5.3. 磁盘缩容</h3><div class="- topic/body body"><p class="- topic/p p">我们将缩减上一小节中增加的磁盘，缩减之前，需要将各个数据节点新增的磁盘上的分区副本迁移至其它磁盘。请注意，删除指定的第一个磁盘卷涉及更复杂的操作，因此不建议进行此操作。</p><p class="- topic/p p">在数据节点上执行以下命令，将 P1-dn1、P2-dn1 数据节点 <code class="+ topic/ph pr-d/codeph ph codeph">ssd1</code> 盘上的分区迁移至 <code class="+ topic/ph pr-d/codeph ph codeph">ssd0</code> 盘。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>srcPath = "/ssd/ssd1/jtwang/chunkData/CHUNKS"
destPath = "/ssd/ssd0/jtwang/chunkData/CHUNKS"

node = "P1-dn1"
chunkIds = exec chunkId from pnodeRun(getAllChunks) where site = node, path like (srcPath + "%")
rpc(node, moveChunksAcrossVolume{ srcPath, destPath, chunkIds, isDelSrc=true })

node = "P2-dn1"
chunkIds = exec chunkId from pnodeRun(getAllChunks) where site = node, path like (srcPath + "%")
rpc(node, moveChunksAcrossVolume{ srcPath, destPath, chunkIds, isDelSrc=true })</code></pre><p class="- topic/p p">在数据节点上执行以下命令，查看迁移后各个数据节点各块磁盘的分区数量统计。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select count(*) from pnodeRun(getAllChunks) group by site, getDiskNo(path) as disk</code></pre><p class="- topic/p p">返回结果：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="53-磁盘缩容__entry__1">site</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="53-磁盘缩容__entry__2">disk</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="53-磁盘缩容__entry__3">count</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="53-磁盘缩容__entry__1">P1-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="53-磁盘缩容__entry__2">/ssd/ssd0/jtwang/chunkData</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="53-磁盘缩容__entry__3">204</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="53-磁盘缩容__entry__1">P2-dn1</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="53-磁盘缩容__entry__2">/ssd/ssd0/jtwang/chunkData</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="53-磁盘缩容__entry__3">204</td></tr></tbody></table></div><p class="- topic/p p">此时，各个数据节点 <code class="+ topic/ph pr-d/codeph ph codeph">ssd1</code> 盘上已不包含任何分区副本，可以进行磁盘缩容。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title22" id="6-小结"><h2 class="- topic/title title topictitle2" id="ariaid-title22">6. 小结</h2><div class="- topic/body body"><p class="- topic/p p">节点与磁盘的扩容和缩容，是生产环境中比较常见的场景。通过对此类场景的模拟和解决方案的实现，我们展示了 DolphinDB 强大、便捷的数据迁移与平衡能力，解决了集群扩展之后如何优化资源使用的问题。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title23" id="7-附件"><h2 class="- topic/title title topictitle2" id="ariaid-title23">7. 附件</h2><div class="- topic/body body"><p class="- topic/p p"><a class="- topic/xref xref" href="script/data_move_rebalance/config.zip">data_move_rebalance</a></p></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E6%A6%82%E8%BF%B0" data-tocid="1-概述">1. 概述</a></li><li class="topic-item"><a href="#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%A8%A1%E6%8B%9F" data-tocid="2-环境配置与数据模拟">2. 环境配置与数据模拟</a><ul><li class="topic-item"><a href="#21-%E7%A1%AC%E4%BB%B6%E9%85%8D%E7%BD%AE" data-tocid="21-硬件配置">2.1. 硬件配置</a></li><li class="topic-item"><a href="#22-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE" data-tocid="22-集群配置">2.2. 集群配置</a></li><li class="topic-item"><a href="#23-%E6%A8%A1%E6%8B%9F%E6%95%B0%E6%8D%AE" data-tocid="23-模拟数据">2.3. 模拟数据</a></li><li class="topic-item"><a href="#24-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" data-tocid="24-注意事项">2.4. 注意事项</a></li></ul></li><li class="topic-item"><a href="#3-%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D" data-tocid="3-函数介绍">3. 函数介绍</a><ul><li class="topic-item"><a href="#31-rebalancechunksamongdatanodes" data-tocid="31-rebalancechunksamongdatanodes">3.1. rebalanceChunksAmongDataNodes</a></li><li class="topic-item"><a href="#32-rebalancechunkswithindatanode" data-tocid="32-rebalancechunkswithindatanode">3.2. rebalanceChunksWithinDataNode</a></li><li class="topic-item"><a href="#33-restoredislocatedtablet" data-tocid="33-restoredislocatedtablet">3.3. restoreDislocatedTablet</a></li><li class="topic-item"><a href="#34-movereplicas" data-tocid="34-movereplicas">3.4. moveReplicas</a></li><li class="topic-item"><a href="#35-movechunksacrossvolume" data-tocid="35-movechunksacrossvolume">3.5. moveChunksAcrossVolume</a></li></ul></li><li class="topic-item"><a href="#4-%E8%8A%82%E7%82%B9%E5%8F%98%E6%9B%B4%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB" data-tocid="4-节点变更场景下的数据迁移">4. 节点变更场景下的数据迁移</a><ul><li class="topic-item"><a href="#41-%E8%8A%82%E7%82%B9%E6%89%A9%E5%AE%B9" data-tocid="41-节点扩容">4.1. 节点扩容</a></li><li class="topic-item"><a href="#42-%E8%8A%82%E7%82%B9%E6%89%A9%E5%AE%B9%E6%97%B6%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%80%A7%E8%83%BD" data-tocid="42-节点扩容时数据迁移性能">4.2. 节点扩容时数据迁移性能</a></li><li class="topic-item"><a href="#43-%E8%8A%82%E7%82%B9%E7%BC%A9%E5%AE%B9" data-tocid="43-节点缩容">4.3. 节点缩容</a></li></ul></li><li class="topic-item"><a href="#5-%E7%A3%81%E7%9B%98%E5%8F%98%E6%9B%B4%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB" data-tocid="5-磁盘变更场景下的数据迁移">5. 磁盘变更场景下的数据迁移</a><ul><li class="topic-item"><a href="#51-%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9" data-tocid="51-磁盘扩容">5.1. 磁盘扩容</a></li><li class="topic-item"><a href="#52-%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9%E6%97%B6%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%80%A7%E8%83%BD" data-tocid="52-磁盘扩容时数据迁移性能">5.2. 磁盘扩容时数据迁移性能</a></li><li class="topic-item"><a href="#53-%E7%A3%81%E7%9B%98%E7%BC%A9%E5%AE%B9" data-tocid="53-磁盘缩容">5.3. 磁盘缩容</a></li></ul></li><li class="topic-item"><a href="#6-%E5%B0%8F%E7%BB%93" data-tocid="6-小结">6. 小结</a></li><li class="topic-item"><a href="#7-%E9%99%84%E4%BB%B6" data-tocid="7-附件">7. 附件</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>