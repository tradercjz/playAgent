<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="DolphinDB 节点启动失败时，最明显的现象是启动节点后，对应的 web 界面无法访问，如果是集群在 web 管理界面会看到节点状态为红色。启动问题主要可以分为三类： 启动异常关闭 启动异常卡住 启动慢 首先需要先确认是哪类问题，在启动节点后，通过如下命令查看节点进程是否存在： ps -ef | grep dolphindb // 如果修改了可执行文件名，需要修改 dolphindb ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="dita"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../error_codes/troubleshooting.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="节点启动异常"/><title>节点启动异常</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;dita xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; ditaarch:DITAArchVersion=&#34;2.0&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34;&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;节点启动异常&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;节点启动异常&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:3;7:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_troubleshooting.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../error_codes/troubleshooting.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_troubleshooting.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot gentext?&gt;故障排查&lt;/linktext&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-启动问题定位思路&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;1. 启动问题定位思路&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 节点启动失败时，最明显的现象是启动节点后，对应的 web 界面无法访问，如果是集群在 web 管理界面会看到节点状态为红色。启动问题主要可以分为三类：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动异常关闭&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动异常卡住&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动慢&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;首先需要先确认是哪类问题，在启动节点后，通过如下命令查看节点进程是否存在：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;ps -ef | grep dolphindb // 如果修改了可执行文件名，需要修改 dolphindb 为相应可执行文件名&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;若进程不存在则是启动异常关闭；若进程存在，通过如下命令搜索日志确定节点是否启动完成：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;grep &#34;Job scheduler initialization completed.&#34; dolphindb.log&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;若有执行启动后的时间的日志输出则节点已正常启动，可以去 web 界面刷新确认节点状态是否已为绿色；否则是启动异常卡住或启动慢。通过如下命令搜索节点运行日志中的 ERROR：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;grep &#34;ERROR&#34; dolphindb.log&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;若在执行启动后的时间一直重复刷某段 ERROR 日志，且节点进程一直在，则为启动异常卡在某个阶段；否则为正常启动，只是比较慢还没启动成功，需要继续等待观察启动结果。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;具体问题需要分析&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html#topic_rjh_gfk_gcc&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;31:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;节点运行日志&lt;/xref&gt;，节点运行日志存储位置由命令行参数 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;31:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;logFile&lt;/i&gt; 决定。另外集群环境下可以通过 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;31:154&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;logFile&lt;/i&gt; 配置项指定节点运行日志存储位置。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意&lt;/b&gt;：若使用 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;33:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startSingle.sh&lt;/i&gt; 启动单节点，节点运行日志默认存储在安装目录的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;33:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;dolphindb.log&lt;/i&gt;。若使用 clusterDemo 文件夹下的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;33:90&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startController.sh&lt;/i&gt; 和 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;33:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startAgent.sh&lt;/i&gt; 来启动集群，节点运行日志默认存储在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;33:147&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;clusterDemo/log&lt;/i&gt;，文件名为 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;33:170&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;nodealias class=&#34;- topic/nodealias &#34; xtrc=&#34;nodealias:1;33:171&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;.log&lt;/nodealias&gt;。&lt;/i&gt;&lt;/p&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;11-启动异常关闭&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;1.1 启动异常关闭&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;首先需要区分节点是启动成功后的运行过程中异常宕机，还是启动过程中异常关闭。需要参照&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/tutorials/node_startup_process_and_questions.html#%E8%8A%82%E7%82%B9%E6%95%B4%E4%BD%93%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B&#34; scope=&#34;external&#34; xtrc=&#34;xref:2;39:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;节点整体启动流程&lt;/xref&gt;一节查看是否有节点启动完成的日志 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;39:222&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;Job scheduler initialization completed.&lt;/codeph&gt;，有则是节点启动成功后运行过程中异常宕机，需要根据 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/tutorials/how_to_handle_crash.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:3;39:289&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;排查节点宕机的原因&lt;/xref&gt; 来定位节点宕机问题；否则是启动过程中异常关闭问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;需要查看节点最新运行日志中启动阶段的 ERROR 日志。注意要查看启动阶段的 ERROR 日志而不是启动失败后关机阶段的 ERROR 日志。DolphinDB 在关机时打印如下 ERROR 日志是预期的：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;... &amp;lt;ERROR&amp;gt; : The socket server ended. ... &amp;lt;ERROR&amp;gt; : AsynchronousSubscriberImp::run Shut down the subscription daemon. ...&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;如果存在关机日志，需要继续往上搜索 ERROR 查看启动阶段的日志，结合前文的启动流程分析和后文的常见启动问题来分析失败原因。另外需要注意是否在启动过程中宕机，若宕机节点进程会直接被杀死，而不会走关机流程，此时需要查看 coredump 里的堆栈信息：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;cd /path/to/dolphindb gdb dolphindb /path/to/corefile bt&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;堆栈信息需要发给 DolphinDB 技术支持来分析定位。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;12-启动异常卡住&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;1.2 启动异常卡住&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;需要查看节点最新运行日志中的 ERROR 日志，结合前文的启动流程分析、后文的常见启动问题来确定当前节点正在启动什么模块、执行什么动作失败。一般会重复打印某段 ERROR 日志以尝试启动，可以使用如下命令实时查看节点刷的日志：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;tail -f dolphindb.log&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;另外可以使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;69:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;pstack&lt;/codeph&gt; 命令来查看启动时节点内部各个线程的堆栈信息，以确定线程具体执行的动作：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;pstack dolphindb_pid &amp;gt; /tmp/pstack.log // 替换 dolphindb_pid 为 DolphinDB 进程号&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;或使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;75:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;gdb&lt;/codeph&gt; 命令获取线程的堆栈信息。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;gdb -p dolphindb_pid -batch -ex 'thread apply all bt' -ex 'quit' &amp;gt; /tmp/gdb_stacks.log // 替换 dolphindb_pid 为 DolphinDB 进程号&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;堆栈信息需要发给 DolphinDB 技术支持来分析定位。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;13-启动慢&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;1.3 启动慢&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;需要查看节点最新运行日志，结合前文的启动流程分析、后文的常见启动问题来确定当前节点正在启动什么模块、执行什么动作。启动慢时，一般不会有 ERROR 日志。常见的启动慢原因是回滚事务或回放 redo log，详见 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/tutorials/node_startup_process_and_questions.html#%E5%90%AF%E5%8A%A8%E6%85%A2&#34; scope=&#34;external&#34; xtrc=&#34;xref:4;86:107&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;节点启动流程简析与常见问题&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;另外可以使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;88:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;pstack&lt;/codeph&gt; 命令来查看启动时节点内部各个线程的堆栈信息，以确定线程具体执行的动作：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;pstack dolphindb_pid &amp;gt; /tmp/pstack.log // 替换 dolphindb_pid 为 dolphindb 进程号&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;或使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;94:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;gdb&lt;/codeph&gt; 命令获取线程的堆栈信息。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;gdb -p dolphindb_pid -batch -ex 'thread apply all bt' -ex 'quit' &amp;gt; /tmp/gdb_stacks.log // 替换 dolphindb_pid 为 DolphinDB 进程号&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;堆栈信息需要发给 DolphinDB 技术支持来分析定位。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;列出 DolphinDB 常见的启动问题和解决方案。若问题现象不属于常见问题，请联系 DolphinDB 技术支持定位处理。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-常见问题&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2. 常见问题&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;本章节将详细列举并解释节点启动异常的常见问题及其相应的解决方案，以帮助快速定位并解决问题。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-启动异常关闭&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1 启动异常关闭&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;211-license-过期&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.1 license 过期&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;116:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 会在 license 过期前 15 天在 web 或 gui 提示 license 即将过期，而过期后如果节点还在线则能够继续使用 15 天，到第 15 天时会自动关机。License 过期后启动 DolphinDB 会失败，节点运行日志中会有如下 WARNING 和 ERROR 日志：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-13 09:52:30.007743 &amp;lt;WARNING&amp;gt; : The license has expired. Please renew the license and restart the server. 2023-10-13 09:52:30.163238 &amp;lt;ERROR&amp;gt; : The license has expired.&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;需要联系销售获取更新 license。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;212-端口冲突&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.2 端口冲突&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 启动时会绑定一个端口用来做网络传输，由配置文件的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:9;129:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;localSite&lt;/i&gt; 配置项指定。若配置的端口被其他程序占用，或上一次关闭节点还没有完全关闭，则会导致节点启动时绑定端口失败而启动失败。查看节点运行日志有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-26 09:01:31.349118 &amp;lt;ERROR&amp;gt; :Failed to bind the socket on port 8848 with error code 98 2023-10-26 09:01:31.349273 &amp;lt;ERROR&amp;gt; :Failed to bind the socket on port 8848. Shutting down the server. Please try again in a couple of minutes.&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;运行如下命令查看占用指定端口的程序：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;netstat -nlp | grep 端口号&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;解决方案是停止占用端口的程序后再启动。若为上一次关闭的节点还没有完全关闭，需要等待节点关闭或使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;144:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;kill -9&lt;/codeph&gt; 强行停止节点再启动，强行停止节点可能会导致关机前未完成的写入的数据丢失。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;213-redo-log-文件损坏&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.3 redo log 文件损坏&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;数据节点启动时会回放 redo log，如果上次运行时出现磁盘满、宕机或 bug，可能导致 redo log 文件损坏，可能导致节点启动时回放 redo log 失败抛出异常而启动失败。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;redo log 的存储路径按存储引擎不同，可分别由以下参数进行配置，详见&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=redoLogDir&#34; scope=&#34;external&#34; xtrc=&#34;xref:5;150:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;功能配置&lt;/xref&gt;：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:1;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;配置参数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;152:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;存储引擎&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;152:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;默认值&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;154:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;redoLogDir=/redoLog&lt;/codeph&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;154:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;OLAP 引擎&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;154:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;154:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;/log/redoLog&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:7;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;155:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;TSDBRedoLogDir=/TSDBRedo&lt;/codeph&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:8;155:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;TSDB 引擎&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;155:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;155:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;/log/TSDBRedo&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:10;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;156:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;PKEYRedoLogDir=/PKEYRedo&lt;/codeph&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:11;156:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;PKEY 引擎&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:12;156:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;156:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;ALIAS&amp;gt;/log/PKEYRedo&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;例如查看节点运行日志有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-12-11 15:18:58.888865 &amp;lt;INFO&amp;gt; :applyTidRedoLog : 2853,c686664b-d020-429a-1746-287d670099e9, /hdd/hdd7/hanyang/server/clusterDemo/data/P1-datanode/storage/CHUNKS/multiValueTypeDb1/20231107/Key0/g z,pt_2,32054400,1046013,0 2023-12-11 15:18:58.895064 &amp;lt;ERROR&amp;gt; :VectorUnmarshall::start Invalid data form 0 type 0 2023-12-11 15:18:58.895233 &amp;lt;ERROR&amp;gt; :The redo log for transaction [2853] comes across error: Failed to unmarshall data.. Invalid message format 2023-12-11 15:18:58.895476 &amp;lt;ERROR&amp;gt; :The ChunkNode failed to initialize with exception [Failed to unmarshall data.. Invalid message format]. 2023-12-11 15:18:58.895555 &amp;lt;ERROR&amp;gt; :ChunkNode service comes up with the error message: Failed to unmarshall data.. Invalid message format&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;日志含义为回放 redo log 时发现 tid 为 2853 的 redo log 文件格式错误导致回放失败。此时需要通过如下步骤跳过 redo log 回放：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;mv 移走 redoLogDir 和 TSDBRedoLogDir 文件夹下的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:10;179:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;head.log&lt;/i&gt; 文件，cp 备份报错对应的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:11;179:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2853.log&lt;/i&gt; 文件；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动节点，观察是否正常启动，启动后检查重启前正在写入的数据完整性，是否要补数据等。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;如果不是磁盘满导致，需要将 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:12;182:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;head.log&lt;/i&gt; 和报错对应的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:13;182:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2853.log&lt;/i&gt; 发给 DolphinDB 技术支持定位问题。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;214-函数视图或定时任务包含不存在的方法&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.4 函数视图或定时任务包含不存在的方法&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;节点启动时会反序列化函数视图和定时任务文件，若反序列化的方法定义中包含不存在于内存的方法，将会导致相关函数视图和定时任务反序列化失败。常见情况如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;使用了未配置自动加载的插件和模块的方法&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;更新插件或模块后相关方法名变更&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;例如，定义定时任务 myTest 调用 rabbitmq 插件的方法：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;loadPlugin(&#34;plugins/rabbitmq/PluginRabbitMQ.txt&#34;) def myTest() { HOST=&#34;192.168.0.53&#34; PORT=5672 USERNAME=&#34;guest&#34; PASSWORD=&#34;guest&#34; conn = rabbitmq::connection(HOST, PORT, USERNAME, PASSWORD); } scheduleJob(&#34;myTest&#34;, &#34;myTest&#34;, myTest, 15:50m, startDate=today(), endDate=today()+3, frequency='D')&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;208:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;如果未配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:14;208:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;preloadModules=plugins::rabbitmq&lt;/i&gt;，则节点启动时不会加载 rabbitmq 插件的函数定义到内存，节点启动反序列化定时任务会失败，运行日志会有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;210:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-13 09:55:30.166268 &amp;lt;ERROR&amp;gt; :CodeUnmarshall::start readObjectAndDependency exception: Can't recognize function: rabbitmq::connection 2023-10-13 09:55:30.166338 &amp;lt;ERROR&amp;gt; :Failed to unmarshall the job [myTest]. Can't recognize function: rabbitmq::connection. Invalid message format&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;217:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;解决方案是添加报错方法对应的插件或模块到 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:15;217:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;preloadModules&lt;/i&gt; 配置项，即配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:16;217:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;preloadModules=plugins::rabbitmq&lt;/i&gt;，然后再启动节点。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;219:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;若为更新插件或模块后相关方法名变更，需要回退插件或模块再启动，删除对应的视图或定时任务后，再升级插件或模块。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;215-函数视图或定时任务包含不存在的共享表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.5 函数视图或定时任务包含不存在的共享表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;221:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意&lt;/b&gt;：该问题已在 1.30.23.1/2.00.11.1 或以上版本修复。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;225:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;节点启动时会反序列化函数视图和定时任务文件，若反序列化的方法定义中包含不存在于内存的共享表，将会导致相关函数视图和定时任务反序列化失败。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;问题 1&lt;/b&gt;：&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;227:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;定时任务反序列化失败&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;229:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;例如，定时任务 myTest 的定义如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;231:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;share table(1 2 3 as id, 1 2 3 as val) as t def myTest() { update t set val = val + 1 } scheduleJob(&#34;myTest&#34;, &#34;myTest&#34;, myTest, minute(now())+5, today(), today(), 'D')&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;241:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;其中第 4 行的 update 语句用于更新共享表 t。如果在启动脚本 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:17;241:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startup.dos&lt;/i&gt; 中未创建共享表 t，则节点启动时反序列化定时任务会失败，运行日志会有如下 WARNING 和 ERROR 日志：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;243:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-23 09:38:27.746184 &amp;lt;WARNING&amp;gt; :Failed to recognize shared variable t 2023-10-23 09:38:27.746343 &amp;lt;ERROR&amp;gt; :CodeUnmarshall::start readObjectAndDependency exception: Failed to deserialize update statement 2023-10-23 09:38:27.746404 &amp;lt;ERROR&amp;gt; :Failed to deserialize update statement. Invalid message format&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;251:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;原因：定时任务的定义中使用了未创建的表。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;253:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;解决方法：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:2;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;在报错的定时任务 myTest 中检查是否使用了未创建的表，例如前述的共享表 t。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;在定时任务所在节点的启动脚本 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:18;256:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startup.dos&lt;/i&gt; 中添加相应的建表语句。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;257:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动节点。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;259:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;259:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;问题 2：函数视图反序列化失败&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;261:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;如果将前述问题 1 中的定时任务 myTest 添加到函数视图，例如：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;261:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;addFunctionView(myTest)&lt;/codeph&gt;，也会导致节点启动时反序列化函数视图失败，运行日志中会出现相同的报错。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;原因：函数视图反序列化先于节点启动，因此在控制节点的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:19;263:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startup.dos&lt;/i&gt; 中定义共享表 t 也不会有效。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;265:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;解决方法：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;267:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;267:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;对于普通集群：&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:3;268:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;268:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;移除 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:20;268:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;server/clusterDemo/data/dnode1/sysmgmt&lt;/i&gt; 下的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:21;268:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;aclEditlog.meta&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:22;268:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;aclCheckPoint.meta&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:23;268:96&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;aclCheckPoint.tmp&lt;/i&gt;。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;269:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;重新启动节点。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;270:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;270:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动后重新添加所有权限和函数视图定义。&lt;/b&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;对于高可用集群，如果未重启，或存在半数以上控制节点存活：&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:4;272:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;272:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;删除相关函数视图：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;272:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;dropFunctionView(&#34;myTest&#34;)&lt;/codeph&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;273:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;生成权限与函数视图的 checkpoint 文件以避免启动时回放 RAFT 日志执行之前的函数视图定义。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;273:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;rpc(getControllerAlias(), aclCheckPoint, true)&lt;/codeph&gt; // 参数 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:24;273:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;force&lt;/i&gt; = true 表示强制生成 checkpoint。&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;对于高可用集群，如果已重启：&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:5;275:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;275:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;移除所有控制节点的 &amp;lt;HOME_DIR&amp;gt;/&amp;lt;NodeAlias&amp;gt;/raft 目录下的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:25;275:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftHardstate&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:26;275:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftWAL&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:27;275:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftSnapshot&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:28;275:94&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftWAL.old&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:29;275:108&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftSnapshot.tmp&lt;/i&gt;。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;275:127&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意：这会导致集群元数据全部失效。&lt;/b&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;276:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;重新启动节点。&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;必然存在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:30;278:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;aclEditlog.meta&lt;/i&gt; ，可能存在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:31;278:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;aclCheckPoint.meta&lt;/i&gt;，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:32;278:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;aclCheckPoint.tmp&lt;/i&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;必然存在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:33;280:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftHardstate&lt;/i&gt;，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:34;280:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftWAL&lt;/i&gt; ，可能存在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:35;280:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftSnapshot&lt;/i&gt;，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:36;280:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftWAL.old&lt;/i&gt;，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:37;280:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;raftSnapshot.tmp&lt;/i&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;后续版本会优化添加函数视图的功能以避免需要删除元数据来解决该问题。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;216-函数视图方法名与预加载的模块或插件的方法名冲突&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.6 函数视图方法名与预加载的模块或插件的方法名冲突&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;286:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;节点启动时会反序列化函数视图文件，若反序列化的函数视图方法名与已通过 preloadModule 加载的方法名冲突，将会导致函数视图反序列化失败。例如，直接添加 ops 模块的 cancelJobEx 方法到函数视图：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;288:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;use ops addFunctionView(ops::cancelJobEx)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;若同时配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:38;293:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;preloadModules=ops&lt;/i&gt;，启动时运行日志会有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-20 08:46:15.733365 &amp;lt;ERROR&amp;gt; :CodeUnmarshall::start readObjectAndDependency exception: Not allowed to overwrite existing functions/procedures [ops::cancelJobEx] by system users. 2023-10-20 08:46:15.733422 &amp;lt;ERROR&amp;gt; :Not allowed to overwrite existing functions/procedures [ops::cancelJobEx] by system users.. Invalid message format&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;302:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;解决方案是去掉 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:39;302:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;preloadModules=ops&lt;/i&gt; 配置项，然后再启动节点。不建议先定义模块再将模块内的方法添加到函数视图，而应该直接定义方法再添加到函数视图。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;217-定时任务文件损坏&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;304:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;304:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.7 定时任务文件损坏&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;304:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;306:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 序列化定时任务到文件时，如果上次运行时出现磁盘满、宕机或 bug，可能导致定时任务文件损坏，可能导致节点启动时反序列化失败抛出异常而启动失败。例如查看节点运行日志有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;308:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-13 09:57:30.456789 &amp;lt;ERROR&amp;gt; :CodeUnmarshall::start readObjectAndDependency exception: Failed to deserialize update statement 2023-10-13 09:57:30.456789 &amp;lt;ERROR&amp;gt; :Failed to unmarshall the job [myTest]. Failed to deserialize update statement. Invalid message format&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;此时如果希望尽快启动节点，可以移走 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:40;315:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;server/clusterDemo/data/dnode1/sysmgmt&lt;/i&gt; 下的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:41;315:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;jobEditlog.meta&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:42;315:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;jobCheckPoint.meta&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:43;315:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;jobCheckPoint.tmp&lt;/i&gt; 文件以跳过启动时的定时任务反序列化，再启动节点。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意&lt;/b&gt;：必然存在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:44;317:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;jobEditlog.meta&lt;/i&gt;，可能存在&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:45;317:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;jobCheckPoint.meta&lt;/i&gt;、&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:46;317:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;jobCheckPoint.tmp&lt;/i&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;319:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;请打包定时任务文件、日志里报错的定时任务脚本和节点运行日志，联系 DolphinDB 技术支持排查问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;321:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;节点启动后，需要重新提交所有定时任务。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;218-权限与函数视图文件损坏&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;323:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;323:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.8 权限与函数视图文件损坏&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;323:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;325:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 序列化权限操作和函数视图定义到文件时，如果上次运行时出现磁盘满、宕机或 bug，可能导致权限和函数视图文件损坏，可能导致节点启动时反序列化失败抛出异常而启动失败。例如查看节点运行日志有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;327:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-13 09:59:35.786438 &amp;lt;ERROR&amp;gt; :CodeUnmarshall::start readObjectAndDependency exception: Failed to deserialize sql query object 2023-10-13 09:59:35.786438 &amp;lt;ERROR&amp;gt; :Failed to unmarshall the job [myTest1]. Failed to deserialize sql query object. Invalid message format&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;334:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;此时如果希望尽快启动节点，可以参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;node_startup_process_and_questions.md#函数视图或定时任务包含不存在的共享表&#34; xtrc=&#34;xref:6;334:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;函数视图或定时任务包含不存在的共享表&lt;/xref&gt;中的 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;334:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;问题 2：函数视图反序列化失败&lt;/b&gt; 小节的解决方法移走权限与函数视图文件以跳过反序列化。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;请打包权限和函数视图文件、日志里报错的函数视图脚本和节点运行日志，联系 DolphinDB 技术支持排查问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;节点启动后，需要重新添加所有权限和函数视图定义。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;219-raft-文件损坏&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.1.9 RAFT 文件损坏&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;342:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意&lt;/b&gt;：下面介绍的操作需要确保已经有另一个节点成为 RAFT 集群 leader 才可以进行。DolphinDB 写 RAFT 元数据和日志时，如果上次运行时出现磁盘满、宕机或 bug，可能导致 RAFT 元数据或日志文件损坏，可能导致控制节点启动时恢复 RAFT 数据失败抛出异常而启动失败。例如查看节点运行日志有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-13 09:59:35.786438 &amp;lt;WARNING&amp;gt; :[Raft] incomplete hardstate file [/data/server/data/controllerl/raft/raftHardstatel] 2023-10-13 09:59:35.786438 &amp;lt;INFO&amp;gt; :[Raft] Group DFSMaster RaftWAL::reconstruct: read new file with 83213 entries 2023-10-13 09:59:35.786438 &amp;lt;ERROR&amp;gt; :[Raft] Group DFSMaster RawNode::init: failed to initialize with exception [basic_string::_S_create]. 2023-10-13 09:59:35.786438 &amp;lt;ERROR&amp;gt; :Failed to start DFSMaster with the error message: basic_string::_S_create &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;355:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;此时如果希望尽快启动节点，可以移走问题节点的 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=dfsmetadir&#34; scope=&#34;external&#34; xtrc=&#34;xref:7;355:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;dfsMetaDir 配置项&lt;/xref&gt;文件夹和 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:47;355:135&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;HOME_DIR&amp;gt;/&amp;lt;NodeAlias&amp;gt;/raft&lt;/i&gt; 文件夹以跳过启动时的 DFS 和 RAFT 元数据初始化，再启动节点。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;357:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;请打包 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=dfsmetadir&#34; scope=&#34;external&#34; xtrc=&#34;xref:8;357:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;dfsMetaDir 配置项&lt;/xref&gt;文件夹、 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:48;357:116&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;HOME_DIR&amp;gt;/&amp;lt;NodeAlias&amp;gt;/raft&lt;/i&gt; 文件夹和节点运行日志，联系 DolphinDB 技术支持排查问题。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;359:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;节点启动后，会自动同步 leader 节点的元数据。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-启动异常卡住&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.2 启动异常卡住&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;361:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;221-集群间网络不通&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;363:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;363:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.2.1 集群间网络不通&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;363:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;365:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;在多台机器上部署 DolphinDB 时，需要确保集群间各个节点的 IP:端口号互通，否则会导致节点启动失败。常见原因和现象是调整了机器网络配置后重启高可用集群，进入控制节点 web 管理界面白屏，查看控制节点日志中有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;367:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-11-01 16:00:34.992500 &amp;lt;INFO&amp;gt; :New connection from ip = 192.168.0.44 port = 35416 2023-11-01 16:00:35.459220 &amp;lt;INFO&amp;gt; :DomainSiteSocketPool::closeConnection: Close connection to ctl1 #44 with error: epoll-thread: Read/Write failed. Connection timed out. siteIndex 0, withinSiteIndex 44&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;374:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;或在 web 启动数据节点时报错 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;374:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;IO error type 1&lt;/codeph&gt;（含义为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;374:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;Socket is disconnected/closed or file is closed&lt;/codeph&gt;，即网络连接断开）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;需要联系运维调通网络。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;222-rsa-密钥校验文件损坏&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;378:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;378:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.2.2 RSA 密钥校验文件损坏&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;378:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;380:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 生成 RSA 密钥校验文件时，如果上次运行时出现磁盘满、宕机或 bug，可能导致 RSA 密钥校验文件损坏，使节点无法正常通过 RSA 密钥来通信，进而导致启动流程卡住。查看节点运行日志有如下报错：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;382:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2023-10-25 11:55:04.987161 &amp;lt;ERROR&amp;gt; :Failed to decrypt the message by RSA public key.&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;386:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;解决方案是删除所有控制节点的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:49;386:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;HOME_DIR&amp;gt;/&amp;lt;NodeAlias&amp;gt;/keys&lt;/i&gt; 目录并重启集群，以触发 RSA 密钥校验文件重新生成。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;386:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意删除 keys 文件夹后需要重新提交集群的所有定时任务。&lt;/b&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-启动慢&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;388:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;388:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.3 启动慢&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;388:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;231-正在回滚事务如何查看进度如何删除事务-log-以跳过&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;390:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;390:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.3.1 正在回滚事务，如何查看进度，如何删除事务 log 以跳过&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;390:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;392:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 启动时，如果日志里有 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;392:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;Will process pending transactions.&lt;/codeph&gt; 而没有 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;392:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;ChunkMgmt initialization completed.&lt;/codeph&gt; 说明正在回滚事务。如果节点宕机时的写入事务涉及的分区过多或数据量过大，可能导致事务回滚时间较长。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;查看回滚进度的方法如下，其中，&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:50;394:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;chunkMetaDir&lt;/i&gt; 是 OLAP 引擎节点的元数据文件的存储路径，具体可查看&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=chunkMetaDir&#34; scope=&#34;external&#34; xtrc=&#34;xref:9;394:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;功能配置&lt;/xref&gt;：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:6;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;查看 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:51;396:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;chunkMetaDir&amp;gt;/LOG&lt;/i&gt; 目录下以 tid 命名的文件夹数目是否减少，这里只能根据文件夹减少速度估计回滚速度；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;397:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;若关机前有删除事务，查看 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:52;397:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;Alias&amp;gt;/&amp;lt;volumes&amp;gt;/LOG&lt;/i&gt; 目录下以 tid 命名的文件夹数目是否减少，文件夹数目为 0 时回滚完毕。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;399:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;399:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意&lt;/b&gt;：统计文件数目可以使用 Linux 命令： &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;399:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;ll -hrt &amp;lt;chunkMetaDir&amp;gt;/LOG | wc -l&lt;/codeph&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;401:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;401:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;强烈建议等待事务回滚完成&lt;/b&gt;，跳过事务回滚会使原本应该回滚的事务不回滚，导致事务相关的数据或元数据错误。若客户希望尽快启动节点且&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;401:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;不需要保证节点宕机前正在写入的数据完整性&lt;/b&gt;，可以通过如下步骤跳过事务回滚：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:7;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;403:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;403:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;kill -15 pid&lt;/codeph&gt; 安全关闭节点，若正在启动时无法关闭则使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;403:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;kill -9&lt;/codeph&gt; 强制关闭节点，因为正在启动所以不会有新的写入；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;mv 移走 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:53;404:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;chunkMetaDir&amp;gt;/LOG&lt;/i&gt; 和 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:54;404:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&amp;lt;Alias&amp;gt;/&amp;lt;volumes&amp;gt;/LOG&lt;/i&gt; 文件夹；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;405:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动节点，观察是否正常启动，启动后检查重启前正在写入的数据完整性，是否要补数据等。&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;232-正在回放-redo-log如何查看进度如何删除-redo-log-以跳过&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.3.2 正在回放 redo log，如何查看进度，如何删除 redo log 以跳过&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;DolphinDB 启动时，如果日志里有 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;409:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;Start recovering from redo log. This may take a few minutes.&lt;/codeph&gt; 而没有&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;409:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;Completed CacheEngine GC and RedoLog GC after applying all redo logs and engine is &amp;lt;engineType&amp;gt;&lt;/codeph&gt; ，说明正在回放 redo log。期间会刷带“RedoLog”的日志例如：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&#34;applyTidRedoLog : 20716,f7dbaef9-05bc-10b6-f042-a14bc0e9c897, /home/DolphinDB/server/clusterDemo/data/node2/storage/CHUNKS/snapshotDB /20220803/Key17/5o7,shfe_5,166259,107,0&#34;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;417:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意：如果是 DolphinDB 2.0 版本，会有两次 redo log 回放，对应 OLAP 和 TSDB 存储引擎，故对应的日志也有两份；如果是 DolphinDB 1.0 版本，只会有一次 OLAP 存储引擎的 redo log 回放。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;查看回放进度的方法：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;统计 redoLogDir 和 TSDBRedoLogDir 下的 tid.log 文件数目，为 0 时回放完毕；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;422:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;统计 redoLogDir 和 TSDBRedoLogDir 文件夹大小，除以硬盘的读速率，可估计最快的回放完成时间。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;424:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;424:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;注意&lt;/b&gt;：统计文件夹大小可以使用 Linux 命令：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;424:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;du -sh &amp;lt;redoLogDir&amp;gt;&lt;/codeph&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;强烈建议等待 redo log 回放完成&lt;/b&gt;，跳过 redo log 回放会使原本应该回放的事务不回放，会导致事务相关的数据或元数据错误。若客户希望尽快启动节点且&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;426:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;不需要保证节点宕机前正在写入的数据完整性&lt;/b&gt;，可以通过如下步骤跳过 redo log 回放：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:8;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;428:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;kill -15 pid&lt;/codeph&gt; 安全关闭节点，若正在启动时无法关闭则使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;428:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;kill -9&lt;/codeph&gt; 强制关闭节点，因为正在启动所以不会有新的写入；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;429:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;mv 移走 redoLogDir 和 TSDBRedoLogDir 文件夹下的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:55;429:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;head.log&lt;/i&gt; 文件；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;430:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动节点，观察是否正常启动，启动后检查重启前正在写入的数据完整性，是否要补数据等。&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-其他问题&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;432:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;432:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.4 其他问题&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;432:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;241-启动脚本运行慢或失败&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;2.4.1 启动脚本运行慢或失败&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;436:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动脚本 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:56;436:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startup.dos&lt;/i&gt; 运行慢会导致启动流程走不到初始化定时任务一步，但由于节点在 redo log 回放完成后即在 web 集群管理界面转变状态为绿色，已经可以访问，故会导致定时任务相关功能在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:57;436:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startup.dos&lt;/i&gt; 执行完前无法使用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;438:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;启动脚本 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:58;438:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startup.dos&lt;/i&gt; 或 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:59;438:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;postStart.dos&lt;/i&gt; 运行失败会在节点运行日志里打印错误日志，然后跳过启动脚本报错行后的执行，不会导致节点启动失败，也不会回滚执行失败的动作，需要客户自行考虑启动脚本运行失败的情况。注意在&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;438:121&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;集群模式下，执行启动脚本时无法保证分布式数据库已初始化完毕&lt;/b&gt;，在启动脚本访问分布式库表可能会报错。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;440:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;故不建议在启动脚本执行太慢的操作或涉及分布式库表的操作，而只做一些比较简单的操作如建共享表、加载插件等。启动脚本详细介绍见 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/tutorials/Startup.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:10;440:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;&lt;?ditaot usertext?&gt;启动脚本&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;可以参考如下脚本在 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:60;442:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;startup.dos&lt;/i&gt; 或 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:61;442:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;postStart.dos&lt;/i&gt; 等待分布式模块准备完毕：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/node_startup_exception.md&#34;&gt;def isClusterOk() { do { try { meta = rpc(getControllerAlias(), getClusterChunksStatus) configReplicaCount = 2 // 需要修改为 dfsReplicationFactor 配置项值 cnt1 = exec count(*) from meta where state != &#34;COMPLETE&#34; cnt2 = exec count(*) from meta where replicaCount != configReplicaCount if (cnt1 == 0 and cnt2 == 0) { break } else { writeLog(&#34;startup isClusterOk: state != 'COMPLETE' cnt: &#34; + string(cnt1) + &#34;, &#34; + &#34;replicaCount != &#34; + string(configReplicaCount) + &#34; cnt: &#34; + string(cnt2)) } } catch (err) { writeLog(&#34;startup isClusterOk: &#34; + err) } sleep(3*1000) } while(1) return true } res = isClusterOk() writeLog(&#34;startup isClusterOk: &#34;, string(res))&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/dita&gt;"/><meta name="wh-source-relpath" content="tutorials/node_startup_exception.md"/><meta name="wh-out-relpath" content="tutorials/node_startup_exception.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="troubleshooting"><div class="title"><a href="../error_codes/troubleshooting.html">故障排查</a></div></div></li><li class="active"><div class="topicref" data-id="节点启动异常"><div class="title"><a href="../tutorials/node_startup_exception.html">节点启动异常</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="无法连接服务器-d9713e8826" class="topicref" data-id="无法连接服务器" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../omc/omc_connection_lost_guidelines.html" id="无法连接服务器-d9713e8826-link">无法连接服务器</a></div></div></li><li role="treeitem" class="active"><div data-tocid="节点启动异常-d9713e8872" class="topicref" data-id="节点启动异常" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/node_startup_exception.html" id="节点启动异常-d9713e8872-link">节点启动异常</a></div></div></li><li role="treeitem"><div data-tocid="节点宕机-d9713e8918" class="topicref" data-id="节点宕机" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/how_to_handle_crash.html" id="节点宕机-d9713e8918-link">节点宕机</a></div></div></li><li role="treeitem"><div data-tocid="系统卡死-d9713e8964" class="topicref" data-id="系统卡死" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../omc/omc_server_hang_guidelines.html" id="系统卡死-d9713e8964-link">系统卡死</a></div></div></li><li role="treeitem"><div data-tocid="查询写入慢-d9713e9010" class="topicref" data-id="查询写入慢" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../omc/omc_slow_io_guidelines.html" id="查询写入慢-d9713e9010-link">查询/写入慢</a></div></div></li><li role="treeitem"><div data-tocid="out-of-memory-d9713e9056" class="topicref" data-id="out-of-memory" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/oom_settlement.html" id="out-of-memory-d9713e9056-link">Out of Memory</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="error_code_list-d9713e9102" class="topicref" data-id="error_code_list" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action error_code_list-d9713e9102-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/err_codes.html" id="error_code_list-d9713e9102-link"><span class="keyword label">错误代码</span></a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="" role="article" aria-labelledby="ariaid-title1"><article class="nested0" aria-labelledby="ariaid-title1" id="节点启动异常"><h1 class="- topic/title title topictitle1" id="ariaid-title1">节点启动异常</h1><div class="- topic/body body"></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-启动问题定位思路"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 启动问题定位思路</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 节点启动失败时，最明显的现象是启动节点后，对应的 web 界面无法访问，如果是集群在 web 管理界面会看到节点状态为红色。启动问题主要可以分为三类：</p><ul class="- topic/ul ul"><li class="- topic/li li">启动异常关闭</li><li class="- topic/li li">启动异常卡住</li><li class="- topic/li li">启动慢</li></ul><p class="- topic/p p">首先需要先确认是哪类问题，在启动节点后，通过如下命令查看节点进程是否存在：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>ps -ef | grep dolphindb // 如果修改了可执行文件名，需要修改 dolphindb 为相应可执行文件名</code></pre><p class="- topic/p p">若进程不存在则是启动异常关闭；若进程存在，通过如下命令搜索日志确定节点是否启动完成：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>grep "Job scheduler initialization completed." dolphindb.log</code></pre><p class="- topic/p p">若有执行启动后的时间的日志输出则节点已正常启动，可以去 web 界面刷新确认节点状态是否已为绿色；否则是启动异常卡住或启动慢。通过如下命令搜索节点运行日志中的 ERROR：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>grep "ERROR" dolphindb.log</code></pre><p class="- topic/p p">若在执行启动后的时间一直重复刷某段 ERROR 日志，且节点进程一直在，则为启动异常卡在某个阶段；否则为正常启动，只是比较慢还没启动成功，需要继续等待观察启动结果。</p><p class="- topic/p p">具体问题需要分析<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html#topic_rjh_gfk_gcc" target="_blank" rel="external noopener">节点运行日志</a>，节点运行日志存储位置由命令行参数 <em class="+ topic/ph hi-d/i ph i">logFile</em> 决定。另外集群环境下可以通过 <em class="+ topic/ph hi-d/i ph i">logFile</em> 配置项指定节点运行日志存储位置。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：若使用 <em class="+ topic/ph hi-d/i ph i">startSingle.sh</em> 启动单节点，节点运行日志默认存储在安装目录的 <em class="+ topic/ph hi-d/i ph i">dolphindb.log</em>。若使用 clusterDemo 文件夹下的 <em class="+ topic/ph hi-d/i ph i">startController.sh</em> 和 <em class="+ topic/ph hi-d/i ph i">startAgent.sh</em> 来启动集群，节点运行日志默认存储在 <em class="+ topic/ph hi-d/i ph i">clusterDemo/log</em>，文件名为 <em class="+ topic/ph hi-d/i ph i"><span class="undefined_element">.log</span>。</em></p><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="11-启动异常关闭"><h3 class="- topic/title title topictitle3" id="ariaid-title3">1.1 启动异常关闭</h3><div class="- topic/body body"><p class="- topic/p p">首先需要区分节点是启动成功后的运行过程中异常宕机，还是启动过程中异常关闭。需要参照<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/tutorials/node_startup_process_and_questions.html#%E8%8A%82%E7%82%B9%E6%95%B4%E4%BD%93%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B" target="_blank" rel="external noopener">节点整体启动流程</a>一节查看是否有节点启动完成的日志 <code class="+ topic/ph pr-d/codeph ph codeph">Job scheduler initialization completed.</code>，有则是节点启动成功后运行过程中异常宕机，需要根据 <a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/tutorials/how_to_handle_crash.html" target="_blank" rel="external noopener">排查节点宕机的原因</a> 来定位节点宕机问题；否则是启动过程中异常关闭问题。</p><p class="- topic/p p">需要查看节点最新运行日志中启动阶段的 ERROR 日志。注意要查看启动阶段的 ERROR 日志而不是启动失败后关机阶段的 ERROR 日志。DolphinDB 在关机时打印如下 ERROR 日志是预期的：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>...
&lt;ERROR&gt; : The socket server ended.
...
&lt;ERROR&gt; : AsynchronousSubscriberImp::run Shut down the subscription daemon.
...</code></pre><p class="- topic/p p">如果存在关机日志，需要继续往上搜索 ERROR 查看启动阶段的日志，结合前文的启动流程分析和后文的常见启动问题来分析失败原因。另外需要注意是否在启动过程中宕机，若宕机节点进程会直接被杀死，而不会走关机流程，此时需要查看 coredump 里的堆栈信息：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>cd /path/to/dolphindb
gdb dolphindb /path/to/corefile
bt</code></pre><p class="- topic/p p">堆栈信息需要发给 DolphinDB 技术支持来分析定位。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="12-启动异常卡住"><h3 class="- topic/title title topictitle3" id="ariaid-title4">1.2 启动异常卡住</h3><div class="- topic/body body"><p class="- topic/p p">需要查看节点最新运行日志中的 ERROR 日志，结合前文的启动流程分析、后文的常见启动问题来确定当前节点正在启动什么模块、执行什么动作失败。一般会重复打印某段 ERROR 日志以尝试启动，可以使用如下命令实时查看节点刷的日志：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>tail -f dolphindb.log</code></pre><p class="- topic/p p">另外可以使用 <code class="+ topic/ph pr-d/codeph ph codeph">pstack</code> 命令来查看启动时节点内部各个线程的堆栈信息，以确定线程具体执行的动作：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>pstack dolphindb_pid &gt; /tmp/pstack.log // 替换 dolphindb_pid 为 DolphinDB 进程号</code></pre><p class="- topic/p p">或使用 <code class="+ topic/ph pr-d/codeph ph codeph">gdb</code> 命令获取线程的堆栈信息。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>gdb -p dolphindb_pid -batch -ex 'thread apply all bt' -ex 'quit' &gt; /tmp/gdb_stacks.log 
// 替换 dolphindb_pid 为 DolphinDB 进程号</code></pre><p class="- topic/p p">堆栈信息需要发给 DolphinDB 技术支持来分析定位。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="13-启动慢"><h3 class="- topic/title title topictitle3" id="ariaid-title5">1.3 启动慢</h3><div class="- topic/body body"><p class="- topic/p p">需要查看节点最新运行日志，结合前文的启动流程分析、后文的常见启动问题来确定当前节点正在启动什么模块、执行什么动作。启动慢时，一般不会有 ERROR 日志。常见的启动慢原因是回滚事务或回放 redo log，详见 <a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/tutorials/node_startup_process_and_questions.html#%E5%90%AF%E5%8A%A8%E6%85%A2" target="_blank" rel="external noopener">节点启动流程简析与常见问题</a>。</p><p class="- topic/p p">另外可以使用 <code class="+ topic/ph pr-d/codeph ph codeph">pstack</code> 命令来查看启动时节点内部各个线程的堆栈信息，以确定线程具体执行的动作：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>pstack dolphindb_pid &gt; /tmp/pstack.log // 替换 dolphindb_pid 为 dolphindb 进程号</code></pre><p class="- topic/p p">或使用 <code class="+ topic/ph pr-d/codeph ph codeph">gdb</code> 命令获取线程的堆栈信息。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>gdb -p dolphindb_pid -batch -ex 'thread apply all bt' -ex 'quit' &gt; /tmp/gdb_stacks.log 
// 替换 dolphindb_pid 为 DolphinDB 进程号</code></pre><p class="- topic/p p">堆栈信息需要发给 DolphinDB 技术支持来分析定位。</p><p class="- topic/p p">列出 DolphinDB 常见的启动问题和解决方案。若问题现象不属于常见问题，请联系 DolphinDB 技术支持定位处理。</p></div></article></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title6" id="2-常见问题"><h2 class="- topic/title title topictitle2" id="ariaid-title6">2. 常见问题</h2><div class="- topic/body body"><p class="- topic/p p">本章节将详细列举并解释节点启动异常的常见问题及其相应的解决方案，以帮助快速定位并解决问题。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="21-启动异常关闭"><h3 class="- topic/title title topictitle3" id="ariaid-title7">2.1 启动异常关闭</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title8" id="211-license-过期"><h4 class="- topic/title title topictitle4" id="ariaid-title8">2.1.1 license 过期</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 会在 license 过期前 15 天在 web 或 gui 提示 license 即将过期，而过期后如果节点还在线则能够继续使用 15 天，到第 15 天时会自动关机。License 过期后启动 DolphinDB 会失败，节点运行日志中会有如下 WARNING 和 ERROR 日志：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-13 09:52:30.007743 &lt;WARNING&gt; :
    The license has expired. Please renew the license and restart the server.
2023-10-13 09:52:30.163238 &lt;ERROR&gt; : 
    The license has expired.</code></pre><p class="- topic/p p">需要联系销售获取更新 license。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title9" id="212-端口冲突"><h4 class="- topic/title title topictitle4" id="ariaid-title9">2.1.2 端口冲突</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 启动时会绑定一个端口用来做网络传输，由配置文件的 <em class="+ topic/ph hi-d/i ph i">localSite</em> 配置项指定。若配置的端口被其他程序占用，或上一次关闭节点还没有完全关闭，则会导致节点启动时绑定端口失败而启动失败。查看节点运行日志有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-26 09:01:31.349118 &lt;ERROR&gt; :Failed to bind the socket on port 8848 with error code 98
2023-10-26 09:01:31.349273 &lt;ERROR&gt; :Failed to bind the socket on port 8848. Shutting down the server. 
    Please try again in a couple of
 minutes.</code></pre><p class="- topic/p p">运行如下命令查看占用指定端口的程序：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>netstat -nlp | grep 端口号</code></pre><p class="- topic/p p">解决方案是停止占用端口的程序后再启动。若为上一次关闭的节点还没有完全关闭，需要等待节点关闭或使用 <code class="+ topic/ph pr-d/codeph ph codeph">kill -9</code> 强行停止节点再启动，强行停止节点可能会导致关机前未完成的写入的数据丢失。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title10" id="213-redo-log-文件损坏"><h4 class="- topic/title title topictitle4" id="ariaid-title10">2.1.3 redo log 文件损坏</h4><div class="- topic/body body"><p class="- topic/p p">数据节点启动时会回放 redo log，如果上次运行时出现磁盘满、宕机或 bug，可能导致 redo log 文件损坏，可能导致节点启动时回放 redo log 失败抛出异常而启动失败。</p><p class="- topic/p p">redo log 的存储路径按存储引擎不同，可分别由以下参数进行配置，详见<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=redoLogDir" target="_blank" rel="external noopener">功能配置</a>：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="213-redo-log-文件损坏__entry__1">配置参数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="213-redo-log-文件损坏__entry__2">存储引擎</th><th class="- topic/entry entry colsep-0 rowsep-0" id="213-redo-log-文件损坏__entry__3">默认值</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__1"><code class="+ topic/ph pr-d/codeph ph codeph">redoLogDir=/redoLog</code></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__2">OLAP 引擎</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__3"><code class="+ topic/ph pr-d/codeph ph codeph">/log/redoLog</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__1"><code class="+ topic/ph pr-d/codeph ph codeph">TSDBRedoLogDir=/TSDBRedo</code></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__2">TSDB 引擎</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__3"><code class="+ topic/ph pr-d/codeph ph codeph">/log/TSDBRedo</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__1"><code class="+ topic/ph pr-d/codeph ph codeph">PKEYRedoLogDir=/PKEYRedo</code></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__2">PKEY 引擎</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="213-redo-log-文件损坏__entry__3"><code class="+ topic/ph pr-d/codeph ph codeph">&lt;ALIAS&gt;/log/PKEYRedo</code></td></tr></tbody></table></div><p class="- topic/p p">例如查看节点运行日志有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-12-11 15:18:58.888865 &lt;INFO&gt; :applyTidRedoLog : 
    2853,c686664b-d020-429a-1746-287d670099e9,
        /hdd/hdd7/hanyang/server/clusterDemo/data/P1-datanode/storage/CHUNKS/multiValueTypeDb1/20231107/Key0/g
z,pt_2,32054400,1046013,0
2023-12-11 15:18:58.895064 &lt;ERROR&gt; :VectorUnmarshall::start Invalid data form 0 type 0
2023-12-11 15:18:58.895233 &lt;ERROR&gt; :The redo log for transaction [2853] comes across error: 
    Failed to unmarshall data.. Invalid message format
2023-12-11 15:18:58.895476 &lt;ERROR&gt; :The ChunkNode failed to initialize with exception 
    [Failed to unmarshall data.. Invalid message format].
2023-12-11 15:18:58.895555 &lt;ERROR&gt; :ChunkNode service comes up with the error message: 
    Failed to unmarshall data.. Invalid message format</code></pre><p class="- topic/p p">日志含义为回放 redo log 时发现 tid 为 2853 的 redo log 文件格式错误导致回放失败。此时需要通过如下步骤跳过 redo log 回放：</p><ol class="- topic/ol ol"><li class="- topic/li li">mv 移走 redoLogDir 和 TSDBRedoLogDir 文件夹下的 <em class="+ topic/ph hi-d/i ph i">head.log</em> 文件，cp 备份报错对应的 <em class="+ topic/ph hi-d/i ph i">2853.log</em> 文件；</li><li class="- topic/li li">启动节点，观察是否正常启动，启动后检查重启前正在写入的数据完整性，是否要补数据等。</li></ol><p class="- topic/p p">如果不是磁盘满导致，需要将 <em class="+ topic/ph hi-d/i ph i">head.log</em> 和报错对应的 <em class="+ topic/ph hi-d/i ph i">2853.log</em> 发给 DolphinDB 技术支持定位问题。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="214-函数视图或定时任务包含不存在的方法"><h4 class="- topic/title title topictitle4" id="ariaid-title11">2.1.4 函数视图或定时任务包含不存在的方法</h4><div class="- topic/body body"><p class="- topic/p p">节点启动时会反序列化函数视图和定时任务文件，若反序列化的方法定义中包含不存在于内存的方法，将会导致相关函数视图和定时任务反序列化失败。常见情况如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">使用了未配置自动加载的插件和模块的方法</li><li class="- topic/li li">更新插件或模块后相关方法名变更</li></ul><p class="- topic/p p">例如，定义定时任务 myTest 调用 rabbitmq 插件的方法：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>loadPlugin("plugins/rabbitmq/PluginRabbitMQ.txt")

def myTest() {
	HOST="192.168.0.53"
    PORT=5672
    USERNAME="guest"
    PASSWORD="guest"

    conn = rabbitmq::connection(HOST, PORT, USERNAME, PASSWORD);
}

scheduleJob("myTest", "myTest", myTest, 15:50m, startDate=today(), endDate=today()+3, frequency='D')</code></pre><p class="- topic/p p">如果未配置 <em class="+ topic/ph hi-d/i ph i">preloadModules=plugins::rabbitmq</em>，则节点启动时不会加载 rabbitmq 插件的函数定义到内存，节点启动反序列化定时任务会失败，运行日志会有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-13 09:55:30.166268 &lt;ERROR&gt; :CodeUnmarshall::start readObjectAndDependency exception: 
    Can't recognize function: rabbitmq::connection
2023-10-13 09:55:30.166338 &lt;ERROR&gt; :Failed to unmarshall the job [myTest]. Can't recognize function: 
    rabbitmq::connection. Invalid message format</code></pre><p class="- topic/p p">解决方案是添加报错方法对应的插件或模块到 <em class="+ topic/ph hi-d/i ph i">preloadModules</em> 配置项，即配置 <em class="+ topic/ph hi-d/i ph i">preloadModules=plugins::rabbitmq</em>，然后再启动节点。</p><p class="- topic/p p">若为更新插件或模块后相关方法名变更，需要回退插件或模块再启动，删除对应的视图或定时任务后，再升级插件或模块。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title12" id="215-函数视图或定时任务包含不存在的共享表"><h4 class="- topic/title title topictitle4" id="ariaid-title12">2.1.5 函数视图或定时任务包含不存在的共享表</h4><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：该问题已在 1.30.23.1/2.00.11.1 或以上版本修复。</p><p class="- topic/p p">节点启动时会反序列化函数视图和定时任务文件，若反序列化的方法定义中包含不存在于内存的共享表，将会导致相关函数视图和定时任务反序列化失败。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">问题 1</strong>：<strong class="+ topic/ph hi-d/b ph b">定时任务反序列化失败</strong></p><p class="- topic/p p">例如，定时任务 myTest 的定义如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>share table(1 2 3 as id, 1 2 3 as val) as t

def myTest() {
	update t set val = val + 1
}

scheduleJob("myTest", "myTest", myTest, minute(now())+5, today(), today(), 'D')</code></pre><p class="- topic/p p">其中第 4 行的 update 语句用于更新共享表 t。如果在启动脚本 <em class="+ topic/ph hi-d/i ph i">startup.dos</em> 中未创建共享表 t，则节点启动时反序列化定时任务会失败，运行日志会有如下 WARNING 和 ERROR 日志：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-23 09:38:27.746184 &lt;WARNING&gt; :Failed to recognize shared variable t
2023-10-23 09:38:27.746343 &lt;ERROR&gt; :CodeUnmarshall::start readObjectAndDependency exception: 
    Failed to deserialize update statement
2023-10-23 09:38:27.746404 &lt;ERROR&gt; :Failed to deserialize update statement. 
    Invalid message format</code></pre><p class="- topic/p p">原因：定时任务的定义中使用了未创建的表。</p><p class="- topic/p p">解决方法：</p><ol class="- topic/ol ol"><li class="- topic/li li">在报错的定时任务 myTest 中检查是否使用了未创建的表，例如前述的共享表 t。</li><li class="- topic/li li">在定时任务所在节点的启动脚本 <em class="+ topic/ph hi-d/i ph i">startup.dos</em> 中添加相应的建表语句。</li><li class="- topic/li li">启动节点。</li></ol><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">问题 2：函数视图反序列化失败</strong></p><p class="- topic/p p">如果将前述问题 1 中的定时任务 myTest 添加到函数视图，例如：<code class="+ topic/ph pr-d/codeph ph codeph">addFunctionView(myTest)</code>，也会导致节点启动时反序列化函数视图失败，运行日志中会出现相同的报错。</p><p class="- topic/p p">原因：函数视图反序列化先于节点启动，因此在控制节点的 <em class="+ topic/ph hi-d/i ph i">startup.dos</em> 中定义共享表 t 也不会有效。</p><p class="- topic/p p">解决方法：</p><ul class="- topic/ul ul"><li class="- topic/li li">对于普通集群：<ol class="- topic/ol ol"><li class="- topic/li li">移除 <em class="+ topic/ph hi-d/i ph i">server/clusterDemo/data/dnode1/sysmgmt</em> 下的 <em class="+ topic/ph hi-d/i ph i">aclEditlog.meta</em>、<em class="+ topic/ph hi-d/i ph i">aclCheckPoint.meta</em>、<em class="+ topic/ph hi-d/i ph i">aclCheckPoint.tmp</em>。</li><li class="- topic/li li">重新启动节点。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">启动后重新添加所有权限和函数视图定义。</strong></li></ol></li><li class="- topic/li li">对于高可用集群，如果未重启，或存在半数以上控制节点存活：<ol class="- topic/ol ol"><li class="- topic/li li">删除相关函数视图：<code class="+ topic/ph pr-d/codeph ph codeph">dropFunctionView("myTest")</code></li><li class="- topic/li li">生成权限与函数视图的 checkpoint 文件以避免启动时回放 RAFT 日志执行之前的函数视图定义。<code class="+ topic/ph pr-d/codeph ph codeph">rpc(getControllerAlias(), aclCheckPoint, true)</code> // 参数 <em class="+ topic/ph hi-d/i ph i">force</em> = true 表示强制生成 checkpoint。</li></ol></li><li class="- topic/li li">对于高可用集群，如果已重启：<ol class="- topic/ol ol"><li class="- topic/li li">移除所有控制节点的 &lt;HOME_DIR&gt;/&lt;NodeAlias&gt;/raft 目录下的 <em class="+ topic/ph hi-d/i ph i">raftHardstate</em>、<em class="+ topic/ph hi-d/i ph i">raftWAL</em>、<em class="+ topic/ph hi-d/i ph i">raftSnapshot</em>、<em class="+ topic/ph hi-d/i ph i">raftWAL.old</em>、<em class="+ topic/ph hi-d/i ph i">raftSnapshot.tmp</em>。<strong class="+ topic/ph hi-d/b ph b">注意：这会导致集群元数据全部失效。</strong></li><li class="- topic/li li">重新启动节点。</li></ol></li></ul><p class="- topic/p p">必然存在 <em class="+ topic/ph hi-d/i ph i">aclEditlog.meta</em> ，可能存在 <em class="+ topic/ph hi-d/i ph i">aclCheckPoint.meta</em>，<em class="+ topic/ph hi-d/i ph i">aclCheckPoint.tmp</em>。</p><p class="- topic/p p">必然存在 <em class="+ topic/ph hi-d/i ph i">raftHardstate</em>，<em class="+ topic/ph hi-d/i ph i">raftWAL</em> ，可能存在 <em class="+ topic/ph hi-d/i ph i">raftSnapshot</em>，<em class="+ topic/ph hi-d/i ph i">raftWAL.old</em>，<em class="+ topic/ph hi-d/i ph i">raftSnapshot.tmp</em>。</p><p class="- topic/p p">后续版本会优化添加函数视图的功能以避免需要删除元数据来解决该问题。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title13" id="216-函数视图方法名与预加载的模块或插件的方法名冲突"><h4 class="- topic/title title topictitle4" id="ariaid-title13">2.1.6 函数视图方法名与预加载的模块或插件的方法名冲突</h4><div class="- topic/body body"><p class="- topic/p p">节点启动时会反序列化函数视图文件，若反序列化的函数视图方法名与已通过 preloadModule 加载的方法名冲突，将会导致函数视图反序列化失败。例如，直接添加 ops 模块的 cancelJobEx 方法到函数视图：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>use ops
addFunctionView(ops::cancelJobEx)</code></pre><p class="- topic/p p">若同时配置 <em class="+ topic/ph hi-d/i ph i">preloadModules=ops</em>，启动时运行日志会有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-20 08:46:15.733365 &lt;ERROR&gt; :CodeUnmarshall::start readObjectAndDependency exception: 
    Not allowed to overwrite existing functions/procedures [ops::cancelJobEx] by system users.
2023-10-20 08:46:15.733422 &lt;ERROR&gt; :Not allowed to overwrite existing functions/procedures
    [ops::cancelJobEx] by system users.. Invalid message format</code></pre><p class="- topic/p p">解决方案是去掉 <em class="+ topic/ph hi-d/i ph i">preloadModules=ops</em> 配置项，然后再启动节点。不建议先定义模块再将模块内的方法添加到函数视图，而应该直接定义方法再添加到函数视图。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title14" id="217-定时任务文件损坏"><h4 class="- topic/title title topictitle4" id="ariaid-title14">2.1.7 定时任务文件损坏</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 序列化定时任务到文件时，如果上次运行时出现磁盘满、宕机或 bug，可能导致定时任务文件损坏，可能导致节点启动时反序列化失败抛出异常而启动失败。例如查看节点运行日志有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-13 09:57:30.456789 &lt;ERROR&gt; :CodeUnmarshall::start readObjectAndDependency exception: 
    Failed to deserialize update statement
2023-10-13 09:57:30.456789 &lt;ERROR&gt; :Failed to unmarshall the job [myTest].
    Failed to deserialize update statement. Invalid message format</code></pre><p class="- topic/p p">此时如果希望尽快启动节点，可以移走 <em class="+ topic/ph hi-d/i ph i">server/clusterDemo/data/dnode1/sysmgmt</em> 下的 <em class="+ topic/ph hi-d/i ph i">jobEditlog.meta</em>、<em class="+ topic/ph hi-d/i ph i">jobCheckPoint.meta</em>、<em class="+ topic/ph hi-d/i ph i">jobCheckPoint.tmp</em> 文件以跳过启动时的定时任务反序列化，再启动节点。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：必然存在 <em class="+ topic/ph hi-d/i ph i">jobEditlog.meta</em>，可能存在<em class="+ topic/ph hi-d/i ph i">jobCheckPoint.meta</em>、<em class="+ topic/ph hi-d/i ph i">jobCheckPoint.tmp</em>。</p><p class="- topic/p p">请打包定时任务文件、日志里报错的定时任务脚本和节点运行日志，联系 DolphinDB 技术支持排查问题。</p><p class="- topic/p p">节点启动后，需要重新提交所有定时任务。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title15" id="218-权限与函数视图文件损坏"><h4 class="- topic/title title topictitle4" id="ariaid-title15">2.1.8 权限与函数视图文件损坏</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 序列化权限操作和函数视图定义到文件时，如果上次运行时出现磁盘满、宕机或 bug，可能导致权限和函数视图文件损坏，可能导致节点启动时反序列化失败抛出异常而启动失败。例如查看节点运行日志有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-13 09:59:35.786438 &lt;ERROR&gt; :CodeUnmarshall::start readObjectAndDependency exception:
    Failed to deserialize sql query object
2023-10-13 09:59:35.786438 &lt;ERROR&gt; :Failed to unmarshall the job [myTest1].
    Failed to deserialize sql query object. Invalid message format</code></pre><p class="- topic/p p">此时如果希望尽快启动节点，可以参考<a class="- topic/xref xref" href="node_startup_process_and_questions.html#%E5%87%BD%E6%95%B0%E8%A7%86%E5%9B%BE%E6%88%96%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%8C%85%E5%90%AB%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%85%B1%E4%BA%AB%E8%A1%A8">函数视图或定时任务包含不存在的共享表</a>中的 <strong class="+ topic/ph hi-d/b ph b">问题 2：函数视图反序列化失败</strong> 小节的解决方法移走权限与函数视图文件以跳过反序列化。</p><p class="- topic/p p">请打包权限和函数视图文件、日志里报错的函数视图脚本和节点运行日志，联系 DolphinDB 技术支持排查问题。</p><p class="- topic/p p">节点启动后，需要重新添加所有权限和函数视图定义。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title16" id="219-raft-文件损坏"><h4 class="- topic/title title topictitle4" id="ariaid-title16">2.1.9 RAFT 文件损坏</h4><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：下面介绍的操作需要确保已经有另一个节点成为 RAFT 集群 leader 才可以进行。DolphinDB 写 RAFT 元数据和日志时，如果上次运行时出现磁盘满、宕机或 bug，可能导致 RAFT 元数据或日志文件损坏，可能导致控制节点启动时恢复 RAFT 数据失败抛出异常而启动失败。例如查看节点运行日志有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-13 09:59:35.786438 &lt;WARNING&gt; :[Raft] incomplete hardstate file 
    [/data/server/data/controllerl/raft/raftHardstatel]
2023-10-13 09:59:35.786438 &lt;INFO&gt; :[Raft] Group DFSMaster RaftWAL::reconstruct: 
    read new file with 83213 entries 
2023-10-13 09:59:35.786438 &lt;ERROR&gt; :[Raft] Group DFSMaster RawNode::init: 
    failed to initialize with exception [basic_string::_S_create].
2023-10-13 09:59:35.786438 &lt;ERROR&gt; :Failed to start DFSMaster with the error message:
    basic_string::_S_create </code></pre><p class="- topic/p p">此时如果希望尽快启动节点，可以移走问题节点的 <a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=dfsmetadir" target="_blank" rel="external noopener">dfsMetaDir 配置项</a>文件夹和 <em class="+ topic/ph hi-d/i ph i">&lt;HOME_DIR&gt;/&lt;NodeAlias&gt;/raft</em> 文件夹以跳过启动时的 DFS 和 RAFT 元数据初始化，再启动节点。</p><p class="- topic/p p">请打包 <a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=dfsmetadir" target="_blank" rel="external noopener">dfsMetaDir 配置项</a>文件夹、 <em class="+ topic/ph hi-d/i ph i">&lt;HOME_DIR&gt;/&lt;NodeAlias&gt;/raft</em> 文件夹和节点运行日志，联系 DolphinDB 技术支持排查问题。</p><p class="- topic/p p">节点启动后，会自动同步 leader 节点的元数据。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title17" id="22-启动异常卡住"><h3 class="- topic/title title topictitle3" id="ariaid-title17">2.2 启动异常卡住</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title18" id="221-集群间网络不通"><h4 class="- topic/title title topictitle4" id="ariaid-title18">2.2.1 集群间网络不通</h4><div class="- topic/body body"><p class="- topic/p p">在多台机器上部署 DolphinDB 时，需要确保集群间各个节点的 IP:端口号互通，否则会导致节点启动失败。常见原因和现象是调整了机器网络配置后重启高可用集群，进入控制节点 web 管理界面白屏，查看控制节点日志中有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-11-01 16:00:34.992500 &lt;INFO&gt; :New connection from ip = 192.168.0.44 port = 35416
2023-11-01 16:00:35.459220 &lt;INFO&gt; :DomainSiteSocketPool::closeConnection: 
    Close connection to ctl1 #44 with error: epoll-thread: Read/Write failed.
    Connection timed out. siteIndex 0, withinSiteIndex 44</code></pre><p class="- topic/p p">或在 web 启动数据节点时报错 <code class="+ topic/ph pr-d/codeph ph codeph">IO error type 1</code>（含义为 <code class="+ topic/ph pr-d/codeph ph codeph">Socket is disconnected/closed or file is closed</code>，即网络连接断开）。</p><p class="- topic/p p">需要联系运维调通网络。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title19" id="222-rsa-密钥校验文件损坏"><h4 class="- topic/title title topictitle4" id="ariaid-title19">2.2.2 RSA 密钥校验文件损坏</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 生成 RSA 密钥校验文件时，如果上次运行时出现磁盘满、宕机或 bug，可能导致 RSA 密钥校验文件损坏，使节点无法正常通过 RSA 密钥来通信，进而导致启动流程卡住。查看节点运行日志有如下报错：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>2023-10-25 11:55:04.987161 &lt;ERROR&gt; :Failed to decrypt the message by RSA public key.</code></pre><p class="- topic/p p">解决方案是删除所有控制节点的 <em class="+ topic/ph hi-d/i ph i">&lt;HOME_DIR&gt;/&lt;NodeAlias&gt;/keys</em> 目录并重启集群，以触发 RSA 密钥校验文件重新生成。<strong class="+ topic/ph hi-d/b ph b">注意删除 keys 文件夹后需要重新提交集群的所有定时任务。</strong></p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title20" id="23-启动慢"><h3 class="- topic/title title topictitle3" id="ariaid-title20">2.3 启动慢</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title21" id="231-正在回滚事务如何查看进度如何删除事务-log-以跳过"><h4 class="- topic/title title topictitle4" id="ariaid-title21">2.3.1 正在回滚事务，如何查看进度，如何删除事务 log 以跳过</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 启动时，如果日志里有 <code class="+ topic/ph pr-d/codeph ph codeph">Will process pending transactions.</code> 而没有 <code class="+ topic/ph pr-d/codeph ph codeph">ChunkMgmt initialization completed.</code> 说明正在回滚事务。如果节点宕机时的写入事务涉及的分区过多或数据量过大，可能导致事务回滚时间较长。</p><p class="- topic/p p">查看回滚进度的方法如下，其中，<em class="+ topic/ph hi-d/i ph i">chunkMetaDir</em> 是 OLAP 引擎节点的元数据文件的存储路径，具体可查看<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/db_distr_comp/cfg/function_configuration.html?hl=chunkMetaDir" target="_blank" rel="external noopener">功能配置</a>：</p><ol class="- topic/ol ol"><li class="- topic/li li">查看 <em class="+ topic/ph hi-d/i ph i">&lt;chunkMetaDir&gt;/LOG</em> 目录下以 tid 命名的文件夹数目是否减少，这里只能根据文件夹减少速度估计回滚速度；</li><li class="- topic/li li">若关机前有删除事务，查看 <em class="+ topic/ph hi-d/i ph i">&lt;Alias&gt;/&lt;volumes&gt;/LOG</em> 目录下以 tid 命名的文件夹数目是否减少，文件夹数目为 0 时回滚完毕。</li></ol><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：统计文件数目可以使用 Linux 命令： <code class="+ topic/ph pr-d/codeph ph codeph">ll -hrt &lt;chunkMetaDir&gt;/LOG | wc -l</code></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">强烈建议等待事务回滚完成</strong>，跳过事务回滚会使原本应该回滚的事务不回滚，导致事务相关的数据或元数据错误。若客户希望尽快启动节点且<strong class="+ topic/ph hi-d/b ph b">不需要保证节点宕机前正在写入的数据完整性</strong>，可以通过如下步骤跳过事务回滚：</p><ol class="- topic/ol ol"><li class="- topic/li li">使用 <code class="+ topic/ph pr-d/codeph ph codeph">kill -15 pid</code> 安全关闭节点，若正在启动时无法关闭则使用 <code class="+ topic/ph pr-d/codeph ph codeph">kill -9</code> 强制关闭节点，因为正在启动所以不会有新的写入；</li><li class="- topic/li li">mv 移走 <em class="+ topic/ph hi-d/i ph i">&lt;chunkMetaDir&gt;/LOG</em> 和 <em class="+ topic/ph hi-d/i ph i">&lt;Alias&gt;/&lt;volumes&gt;/LOG</em> 文件夹；</li><li class="- topic/li li">启动节点，观察是否正常启动，启动后检查重启前正在写入的数据完整性，是否要补数据等。</li></ol></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title22" id="232-正在回放-redo-log如何查看进度如何删除-redo-log-以跳过"><h4 class="- topic/title title topictitle4" id="ariaid-title22">2.3.2 正在回放 redo log，如何查看进度，如何删除 redo log 以跳过</h4><div class="- topic/body body"><p class="- topic/p p">DolphinDB 启动时，如果日志里有 <code class="+ topic/ph pr-d/codeph ph codeph">Start recovering from redo log. This may take a few minutes.</code> 而没有<code class="+ topic/ph pr-d/codeph ph codeph">Completed CacheEngine GC and RedoLog GC after applying all redo logs and engine is &lt;engineType&gt;</code> ，说明正在回放 redo log。期间会刷带“RedoLog”的日志例如：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>"applyTidRedoLog : 20716,f7dbaef9-05bc-10b6-f042-a14bc0e9c897,
    /home/DolphinDB/server/clusterDemo/data/node2/storage/CHUNKS/snapshotDB
    /20220803/Key17/5o7,shfe_5,166259,107,0"</code></pre><p class="- topic/p p">注意：如果是 DolphinDB 2.0 版本，会有两次 redo log 回放，对应 OLAP 和 TSDB 存储引擎，故对应的日志也有两份；如果是 DolphinDB 1.0 版本，只会有一次 OLAP 存储引擎的 redo log 回放。</p><p class="- topic/p p">查看回放进度的方法：</p><ul class="- topic/ul ul"><li class="- topic/li li">统计 redoLogDir 和 TSDBRedoLogDir 下的 tid.log 文件数目，为 0 时回放完毕；</li><li class="- topic/li li">统计 redoLogDir 和 TSDBRedoLogDir 文件夹大小，除以硬盘的读速率，可估计最快的回放完成时间。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：统计文件夹大小可以使用 Linux 命令：<code class="+ topic/ph pr-d/codeph ph codeph">du -sh &lt;redoLogDir&gt;</code></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">强烈建议等待 redo log 回放完成</strong>，跳过 redo log 回放会使原本应该回放的事务不回放，会导致事务相关的数据或元数据错误。若客户希望尽快启动节点且<strong class="+ topic/ph hi-d/b ph b">不需要保证节点宕机前正在写入的数据完整性</strong>，可以通过如下步骤跳过 redo log 回放：</p><ol class="- topic/ol ol"><li class="- topic/li li">使用 <code class="+ topic/ph pr-d/codeph ph codeph">kill -15 pid</code> 安全关闭节点，若正在启动时无法关闭则使用 <code class="+ topic/ph pr-d/codeph ph codeph">kill -9</code> 强制关闭节点，因为正在启动所以不会有新的写入；</li><li class="- topic/li li">mv 移走 redoLogDir 和 TSDBRedoLogDir 文件夹下的 <em class="+ topic/ph hi-d/i ph i">head.log</em> 文件；</li><li class="- topic/li li">启动节点，观察是否正常启动，启动后检查重启前正在写入的数据完整性，是否要补数据等。</li></ol></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title23" id="24-其他问题"><h3 class="- topic/title title topictitle3" id="ariaid-title23">2.4 其他问题</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title24" id="241-启动脚本运行慢或失败"><h4 class="- topic/title title topictitle4" id="ariaid-title24">2.4.1 启动脚本运行慢或失败</h4><div class="- topic/body body"><p class="- topic/p p">启动脚本 <em class="+ topic/ph hi-d/i ph i">startup.dos</em> 运行慢会导致启动流程走不到初始化定时任务一步，但由于节点在 redo log 回放完成后即在 web 集群管理界面转变状态为绿色，已经可以访问，故会导致定时任务相关功能在 <em class="+ topic/ph hi-d/i ph i">startup.dos</em> 执行完前无法使用。</p><p class="- topic/p p">启动脚本 <em class="+ topic/ph hi-d/i ph i">startup.dos</em> 或 <em class="+ topic/ph hi-d/i ph i">postStart.dos</em> 运行失败会在节点运行日志里打印错误日志，然后跳过启动脚本报错行后的执行，不会导致节点启动失败，也不会回滚执行失败的动作，需要客户自行考虑启动脚本运行失败的情况。注意在<strong class="+ topic/ph hi-d/b ph b">集群模式下，执行启动脚本时无法保证分布式数据库已初始化完毕</strong>，在启动脚本访问分布式库表可能会报错。</p><p class="- topic/p p">故不建议在启动脚本执行太慢的操作或涉及分布式库表的操作，而只做一些比较简单的操作如建共享表、加载插件等。启动脚本详细介绍见 <a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/tutorials/Startup.html" target="_blank" rel="external noopener">启动脚本</a>。</p><p class="- topic/p p">可以参考如下脚本在 <em class="+ topic/ph hi-d/i ph i">startup.dos</em> 或 <em class="+ topic/ph hi-d/i ph i">postStart.dos</em> 等待分布式模块准备完毕：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def isClusterOk() {
    do {
        try {
            meta = rpc(getControllerAlias(), getClusterChunksStatus)
            configReplicaCount = 2 // 需要修改为 dfsReplicationFactor 配置项值

            cnt1 = exec count(*) from meta where state != "COMPLETE"
            cnt2 = exec count(*) from meta where replicaCount != configReplicaCount
  
            if (cnt1 == 0 and cnt2 == 0) {
                break
            } else {
                writeLog("startup isClusterOk: state != 'COMPLETE' cnt: " + string(cnt1) + ",
                " + "replicaCount != " + string(configReplicaCount) + " cnt: " + string(cnt2))
            }
        } catch (err) {
            writeLog("startup isClusterOk: " + err)
        }

        sleep(3*1000)
    } while(1)

    return true
}

res = isClusterOk()
writeLog("startup isClusterOk: ", string(res))</code></pre></div></article></article></article></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D%E6%80%9D%E8%B7%AF" data-tocid="1-启动问题定位思路">1. 启动问题定位思路</a><ul><li class="topic-item"><a href="#11-%E5%90%AF%E5%8A%A8%E5%BC%82%E5%B8%B8%E5%85%B3%E9%97%AD" data-tocid="11-启动异常关闭">1.1 启动异常关闭</a></li><li class="topic-item"><a href="#12-%E5%90%AF%E5%8A%A8%E5%BC%82%E5%B8%B8%E5%8D%A1%E4%BD%8F" data-tocid="12-启动异常卡住">1.2 启动异常卡住</a></li><li class="topic-item"><a href="#13-%E5%90%AF%E5%8A%A8%E6%85%A2" data-tocid="13-启动慢">1.3 启动慢</a></li></ul></li><li class="topic-item"><a href="#2-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" data-tocid="2-常见问题">2. 常见问题</a><ul><li class="topic-item"><a href="#21-%E5%90%AF%E5%8A%A8%E5%BC%82%E5%B8%B8%E5%85%B3%E9%97%AD" data-tocid="21-启动异常关闭">2.1 启动异常关闭</a><ul><li class="topic-item"><a href="#211-license-%E8%BF%87%E6%9C%9F" data-tocid="211-license-过期">2.1.1 license 过期</a></li><li class="topic-item"><a href="#212-%E7%AB%AF%E5%8F%A3%E5%86%B2%E7%AA%81" data-tocid="212-端口冲突">2.1.2 端口冲突</a></li><li class="topic-item"><a href="#213-redo-log-%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F" data-tocid="213-redo-log-文件损坏">2.1.3 redo log 文件损坏</a></li><li class="topic-item"><a href="#214-%E5%87%BD%E6%95%B0%E8%A7%86%E5%9B%BE%E6%88%96%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%8C%85%E5%90%AB%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E6%96%B9%E6%B3%95" data-tocid="214-函数视图或定时任务包含不存在的方法">2.1.4 函数视图或定时任务包含不存在的方法</a></li><li class="topic-item"><a href="#215-%E5%87%BD%E6%95%B0%E8%A7%86%E5%9B%BE%E6%88%96%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%8C%85%E5%90%AB%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%85%B1%E4%BA%AB%E8%A1%A8" data-tocid="215-函数视图或定时任务包含不存在的共享表">2.1.5 函数视图或定时任务包含不存在的共享表</a></li><li class="topic-item"><a href="#216-%E5%87%BD%E6%95%B0%E8%A7%86%E5%9B%BE%E6%96%B9%E6%B3%95%E5%90%8D%E4%B8%8E%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%A8%A1%E5%9D%97%E6%88%96%E6%8F%92%E4%BB%B6%E7%9A%84%E6%96%B9%E6%B3%95%E5%90%8D%E5%86%B2%E7%AA%81" data-tocid="216-函数视图方法名与预加载的模块或插件的方法名冲突">2.1.6 函数视图方法名与预加载的模块或插件的方法名冲突</a></li><li class="topic-item"><a href="#217-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F" data-tocid="217-定时任务文件损坏">2.1.7 定时任务文件损坏</a></li><li class="topic-item"><a href="#218-%E6%9D%83%E9%99%90%E4%B8%8E%E5%87%BD%E6%95%B0%E8%A7%86%E5%9B%BE%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F" data-tocid="218-权限与函数视图文件损坏">2.1.8 权限与函数视图文件损坏</a></li><li class="topic-item"><a href="#219-raft-%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F" data-tocid="219-raft-文件损坏">2.1.9 RAFT 文件损坏</a></li></ul></li><li class="topic-item"><a href="#22-%E5%90%AF%E5%8A%A8%E5%BC%82%E5%B8%B8%E5%8D%A1%E4%BD%8F" data-tocid="22-启动异常卡住">2.2 启动异常卡住</a><ul><li class="topic-item"><a href="#221-%E9%9B%86%E7%BE%A4%E9%97%B4%E7%BD%91%E7%BB%9C%E4%B8%8D%E9%80%9A" data-tocid="221-集群间网络不通">2.2.1 集群间网络不通</a></li><li class="topic-item"><a href="#222-rsa-%E5%AF%86%E9%92%A5%E6%A0%A1%E9%AA%8C%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F" data-tocid="222-rsa-密钥校验文件损坏">2.2.2 RSA 密钥校验文件损坏</a></li></ul></li><li class="topic-item"><a href="#23-%E5%90%AF%E5%8A%A8%E6%85%A2" data-tocid="23-启动慢">2.3 启动慢</a><ul><li class="topic-item"><a href="#231-%E6%AD%A3%E5%9C%A8%E5%9B%9E%E6%BB%9A%E4%BA%8B%E5%8A%A1%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E8%BF%9B%E5%BA%A6%E5%A6%82%E4%BD%95%E5%88%A0%E9%99%A4%E4%BA%8B%E5%8A%A1-log-%E4%BB%A5%E8%B7%B3%E8%BF%87" data-tocid="231-正在回滚事务如何查看进度如何删除事务-log-以跳过">2.3.1 正在回滚事务，如何查看进度，如何删除事务 log 以跳过</a></li><li class="topic-item"><a href="#232-%E6%AD%A3%E5%9C%A8%E5%9B%9E%E6%94%BE-redo-log%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E8%BF%9B%E5%BA%A6%E5%A6%82%E4%BD%95%E5%88%A0%E9%99%A4-redo-log-%E4%BB%A5%E8%B7%B3%E8%BF%87" data-tocid="232-正在回放-redo-log如何查看进度如何删除-redo-log-以跳过">2.3.2 正在回放 redo log，如何查看进度，如何删除 redo log 以跳过</a></li></ul></li><li class="topic-item"><a href="#24-%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98" data-tocid="24-其他问题">2.4 其他问题</a><ul><li class="topic-item"><a href="#241-%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C%E6%85%A2%E6%88%96%E5%A4%B1%E8%B4%A5" data-tocid="241-启动脚本运行慢或失败">2.4.1 启动脚本运行慢或失败</a></li></ul></li></ul></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>