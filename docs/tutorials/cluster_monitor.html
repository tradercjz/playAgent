<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="在读写、查询等高并发场景中，了解资源的使用情况能快速定位性能的瓶颈所在。本教程提供对多（或单）服务器及 DolphinDB 高可用集群（或单节点）资源的监控、告警、预警方案。本教程使用开源软件 Prometheus, Grafana 及对应的 dolphindb-datasource 插件来实现监控方案。如果读者对这些软件非常了解并已经部署好相应的软件，可跳过前两章的安装教程，直接使用第三章的 ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../sys_man/perf_man.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="集群运维监控"/><title>集群运维监控</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;集群运维监控&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;集群运维监控&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在读写、查询等高并发场景中，了解资源的使用情况能快速定位性能的瓶颈所在。本教程提供对多（或单）服务器及 DolphinDB 高可用集群（或单节点）资源的监控、告警、预警方案。本教程使用开源软件 Prometheus, Grafana 及对应的 dolphindb-datasource 插件来实现监控方案。如果读者对这些软件非常了解并已经部署好相应的软件，可跳过前两章的安装教程，直接使用第三章的 json 文件监控集群。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;本教程假定读者已经搭建好 DolphinDB 服务。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:15;29:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_om.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../sys_man/perf_man.dita&#34; mapclass=&#34;- map/topicref &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:14;28:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_om.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot gentext?&gt;运维监控&lt;/linktext&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;监控方案概述&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;监控方案概述&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;本套教程实现了以下三套监控方案：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;12:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第一套：NodeExporter + Prometheus + Grafana 监控服务器资源&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/1-1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:1;14:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;573&#34; dita-ot:image-height=&#34;251&#34;/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;本方案主要用于监控服务器资源使用情况，如 CPU 频率信息、内存占用信息、磁盘 IO 信息、网络 IO 信息等。本方案由 NodeExporter 采集服务器指标，Prometheus 定时抓取，再由 Grafana 对 Prometheus 采集的资源信息进行可视化展示。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;18:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第二套：DolphinDB + Prometheus + Grafana 监控 DolphinDB 资源&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/1-2.png&#34; placement=&#34;break&#34; xtrc=&#34;image:2;20:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;572&#34; dita-ot:image-height=&#34;249&#34;/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;本方案主要用于监控 DolphinDB 进程对服务器资源的使用情况及 DolphinDB 性能，如 DolphinDB 进程 CPU 占用情况、DolphinDB 进程内存占用情况、DolphinDB 进程磁盘资源使用情况等。DolphinDB 内置了相应的运维函数以获取当前节点的资源使用情况，Prometheus 可以抓取到这些指标。本方案中 Prometheus 定时从 DolphinDB 抓取相关指标，再由 Grafana 对 Prometheus 采集的指标信息进行可视化展示。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;24:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第三套：dolphindb-datasource 插件+ Grafana 监控 DolphinDB 集群节点状态&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/1-3.png&#34; placement=&#34;break&#34; xtrc=&#34;image:3;26:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;520&#34; dita-ot:image-height=&#34;254&#34;/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;本方案主要用于监控 DolphinDB 集群的节点状态、流数据表状态以及订阅状态。DolphinDB 开发了 Grafana 数据源插件 (dolphindb-datasource)，让用户在 Grafana 面板 (dashboard) 上通过编写查询脚本，与 DolphinDB 进行交互 (基于 WebSocket)，实现 DolphinDB 数据的可视化。本方案中，Grafana 直接连接 DolphinDB 服务，使用查询脚本直接展示数据库信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上述三套方案互不依赖，可以根据需要安装必须的软件。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;软件安装部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;软件安装部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;nodeexporter-部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;NodeExporter 部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;NodeExporter 是 Prometheus 提供的一个可以采集到服务器信息的应用程序，它能采集到服务器的 CPU、内存、磁盘、网络等信息，&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://prometheus.io/download/&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;36:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;点击官网链接&lt;/xref&gt;下载对应版本软件包：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:4;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1146&#34; dita-ot:image-height=&#34;240&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;将其拖拽到服务器上解压，解压后进入对应的安装目录运行 NodeExporter,可通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;40:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;web.listen-address&lt;/codeph&gt; 指定端口：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;$ nohup ./node_exporter --web.listen-address IP:Port &amp;amp;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;46:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;访问 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;46:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;http://IP:Port/metrics&lt;/codeph&gt;,可看到当前 NodeExporter 获取到的当前服务器的所有监控数据，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-2.png&#34; placement=&#34;break&#34; xtrc=&#34;image:5;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;611&#34; dita-ot:image-height=&#34;365&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;50:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;其中，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;50:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;HELP&lt;/codeph&gt; 用于解释当前指标的含义，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;50:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;TYPE&lt;/codeph&gt; 则用于说明指标名称及指标类型，比如：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;52:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;# TYPE node_cpu_seconds_total counter&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;说明 node_cpu_seconds_total 的数据类型是计数器（counter）。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;prometheus-部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus 部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;60:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在上述监控方案中，Prometheus 负责从数据源定时抓取数据。安装 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://prometheus.io/download/&#34; scope=&#34;external&#34; xtrc=&#34;xref:2;60:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;Prometheus Server&lt;/xref&gt;，下载对应版本的软件包：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-3.png&#34; placement=&#34;break&#34; xtrc=&#34;image:6;62:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1199&#34; dita-ot:image-height=&#34;320&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;64:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;64:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;将其拖拽到服务器上解压，可看到如下目录结构：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-4.png&#34; placement=&#34;break&#34; xtrc=&#34;image:7;66:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;307&#34; dita-ot:image-height=&#34;231&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;68:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;其中，data 是数据的存储路径，prometheus.yml 是 Prometheus 的配置文件，启动 Prometheus 服务时，会默认加载当前路径下的 prometheus.yml 文件，若配置文件不在当前目录下，可通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;68:121&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;--config.file&lt;/codeph&gt; 指定。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;进入 Prometheus 安装目录，通过以下命令后台启动 Prometheus 服务：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;72:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;$ nohup ./prometheus --config.file=prometheus.yml &amp;amp;&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;76:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在浏览器地址栏输入 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;76:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;http://IP:Port&lt;/codeph&gt; 可进入 prometheus UI 界面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-5.png&#34; xtrc=&#34;image:8;78:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;910&#34; dita-ot:image-height=&#34;362&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;80:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图中1为命令行，可在其中输入 PromQL 语句进行查询，不仅支持简单的指标查询，还可以对指标进行运算；2为指标的展示形式，可将指标展示为图或表，所有指标都可以以表的形式展示，部分指标可以以图的方式展示；3为展示指标的的时间范围。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;82:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB 服务、Prometheus 服务和 NodeExporter 服务已启动，但此时 Prometheus 抓取不到数据，还需配置 prometheus.yml 文件，将服务器中部署的 NodeExporter 和 DolphinDB 连接到 Prometheus 上，让其定时拉取 NodeExporter 的数据和 DolphinDB 暴露的指标。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;84:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;编辑 prometheus.yml 并在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;84:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;scrape_configs&lt;/codeph&gt; 模块下添加 NodeExporter 的端口信息，用于 Prometheus 定时抓取 NodeExporter 中的数据:&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;86:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt; # 用于抓取服务器资源使用信息 对应第一套方案 - job_name: &#34;服务器名称&#34; static_configs: - targets: [&#34;xxxxxxxx:xxx&#34;] #IP:NodeExporter端口&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;93:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;对于 DolphinDB 集群的监控，不论是高可用集群还是普通集群，亦或是单节点，需将所有节点的端口信息添加到 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;93:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;scrape_configs&lt;/codeph&gt; 中，以3个控制节点、3个代理节点、3个数据节点的高可用集群为例，在 prometheus.yml 中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;93:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;scrape_configs&lt;/codeph&gt; 模块下添加以下内容:&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;95:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt; # 用于抓取 DolphinDB 集群对服务器资源的使用情况 对应第二套方案 - job_name: &#34;controlnode1&#34; static_configs: - targets: [&#34;xxxxxxxx:xxx&#34;]#IP:controlnode1端口 - job_name: &#34;controlnode2&#34; static_configs: - targets: [&#34;xxxxxxxx:xxx&#34;]#IP:controlnode2端口 - job_name: &#34;controlnode3&#34; static_configs: - targets: [&#34;xxxxxxxx:xxx&#34;]#IP:controlnode3端口 - job_name: &#34;agentnode1&#34; static_configs: - targets: [&#34;xxxxxxxx:xxx&#34;]#IP:agentnode1端口 - job_name: &#34;agentnode2&#34; static_configs: - targets: [&#34;&#34;xxxxxxxx:xxx&#34;&#34;]#IP:agentnode2端口 - job_name: &#34;agentnode3&#34; static_configs: - targets: [&#34;&#34;xxxxxxxx:xxx&#34;&#34;]#IP:agentnode3端口 - job_name: &#34;datanode1&#34; static_configs: - targets: [&#34;&#34;xxxxxxxx:xxx&#34;&#34;]#IP:datanode1端口 - job_name: &#34;datanode2&#34; static_configs: - targets: [&#34;&#34;xxxxxxxx:xxx&#34;&#34;]#IP:datanode2端口 - job_name: &#34;datanode3&#34; static_configs: - targets: [&#34;xxxxxxxx:xxx&#34;]#IP:datanode3端口&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;134:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;134:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;注意&lt;/b&gt;：部署 Prometheus 时，要检查配置文件中默认的端口是否被占用，若端口被占用，要更改对应的设置。Prometheus 默认端口为9090，若被占用，要在 prometheus.yml 中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;134:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;scrape_configs&lt;/codeph&gt; 中找到 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;134:131&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;job_name&lt;/codeph&gt; 为 prometheus 的选项，然后再更改其下方的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;134:169&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;targets&lt;/codeph&gt; 后面的端口。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;136:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;配置完数据源后，必须重启 Prometheus 服务。重启 Prometheus 服务后，在 Prometheus UI 界面输入 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;136:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;up&lt;/codeph&gt; 命令，检查配置是否生效【1表示正常；0表示未生效，一般情形下是由于数据源未启动导致的，可检查端口是否被占用】：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-6.png&#34; placement=&#34;break&#34; xtrc=&#34;image:9;138:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1911&#34; dita-ot:image-height=&#34;408&#34;/&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;grafana-部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana 部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;142:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus 提供了快速验证 PromQL 以及临时可视化支持的功能，但其可视化功能较弱。&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://grafana.com/grafana/download&#34; scope=&#34;external&#34; xtrc=&#34;xref:3;142:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;Grafana&lt;/xref&gt; 提供了强大的可视化功能，只需配置好 Prometheus 数据源，便能实现对 Prometheus 的可视化。从官网上下载对应版本的软件包（本教程使用的版本为9.0.5）：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-7.png&#34; placement=&#34;break&#34; xtrc=&#34;image:10;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;862&#34; dita-ot:image-height=&#34;521&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;将其拖拽到服务器上解压，解压后进入对应的 bin 目录并运行 Grafana&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;$ nohup ./grafana-server web &amp;amp;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;访问 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;152:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;http://IP:Port&lt;/codeph&gt;，进入到 Grafana 登录页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-8.png&#34; xtrc=&#34;image:11;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;610&#34; dita-ot:image-height=&#34;555&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana 默认端口为3000，若要更改端口，需在 conf 文件夹下的 defaults.ini 中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;156:56&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[server]&lt;/codeph&gt; 中更改 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;156:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;http_port&lt;/codeph&gt; 选项。默认的账号密码是 admin/admin，登录成功后如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-9.png&#34; xtrc=&#34;image:12;158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1235&#34; dita-ot:image-height=&#34;823&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;登录 Grafana 后，还需两个步骤便能实现监控可视化。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;162:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;162:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;步骤1：配置数据源&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;164:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Configuration--&amp;gt;Data sources&lt;/codeph&gt;，进入数据源添加界面，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-10.png&#34; placement=&#34;break&#34; xtrc=&#34;image:13;166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1474&#34; dita-ot:image-height=&#34;321&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;168:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Add data source&lt;/codeph&gt; 添加数据源&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-11.png&#34; placement=&#34;break&#34; xtrc=&#34;image:14;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1469&#34; dita-ot:image-height=&#34;301&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;172:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;172:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/codeph&gt; 数据源，进入以下配置数据源页面&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-12.png&#34; placement=&#34;break&#34; xtrc=&#34;image:15;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1528&#34; dita-ot:image-height=&#34;359&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;176:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;176:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;URL&lt;/codeph&gt; 上配置 Prometheus 对应的IP和端口（其他选项设置默认），然后点击下方的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;176:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Save&amp;amp;test&lt;/codeph&gt;，若出现了 Data source is working 就说明数据源连接成功（若连接失败，检查Prometheus端口是否被占用）。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-13.png&#34; placement=&#34;break&#34; xtrc=&#34;image:16;178:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1626&#34; dita-ot:image-height=&#34;776&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;步骤2：配置面板&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在 Grafana 中有 Dashboard 和 Panel 的概念。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-14.png&#34; placement=&#34;break&#34; xtrc=&#34;image:17;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;310&#34; dita-ot:image-height=&#34;312&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;如上图所示，点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;186:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Dashboards --&amp;gt; New dashboard&lt;/codeph&gt; 创建一个 Dashboard，进入如下界面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-15.png&#34; xtrc=&#34;image:18;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;967&#34; dita-ot:image-height=&#34;454&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;然后点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;190:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Add a new panel&lt;/codeph&gt; 创建图表，进入如下界面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-16.png&#34; placement=&#34;break&#34; xtrc=&#34;image:19;192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1917&#34; dita-ot:image-height=&#34;780&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图中：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;196:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;196:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;1 为数据源，选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;196:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/codeph&gt;；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;2 为查询方式，建议选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;197:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;code&lt;/codeph&gt;；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;198:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;3 为查询语句，输入要查询的内容，这里不仅支持简单指标查询，也支持指标之间的运算；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;4 为时间范围；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;200:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;5 为展示方式，有 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;200:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Table&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;200:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Graph&lt;/codeph&gt; 两种选择；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;6 为运行查询，测试查询结果是否符合预期；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;202:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;7 为图表的标题；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;8 为保存按钮。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;以下以服务器 CPU 使用率为例，说明如何使查询指标并进行可视化：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;# 从 NodeExporter 获取 CPU 使用率(%) (1-sum(rate(node_cpu_seconds_total{mode=&#34;idle&#34;}[1m])) by (job) / sum(rate(node_cpu_seconds_total[1m])) by (job)) *100&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在查询语句栏中输入上述代码，点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;212:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Run queries&lt;/codeph&gt;，便可以获取 CPU 的使用率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;dolphindb-datasource-插件安装&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;dolphindb-datasource 插件安装&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;本教程的第三套方案的实现依赖 dolphindb-datasource 插件。dolphindb-datasource 插件可以连接到 DolphinDB，用户可在 dolphindb-datasource 插件上编写代码查询需要展示的数据，或者调用系统运维函数获取运维监控数据。点击&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://github.com/dolphindb/grafana-datasource/releases&#34; scope=&#34;external&#34; xtrc=&#34;xref:4;216:143&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;链接&lt;/xref&gt;，进入下载页面，下载最新版本的 dolphindb-datasource 插件：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-17.png&#34; xtrc=&#34;image:20;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;924&#34; dita-ot:image-height=&#34;354&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;下载压缩包后，将其拖拽到服务器 Grafana 安装目录下的 data/plugins/ 目录下解压，如果不存在 Plugins 目录，需手动创建该文件夹，然后将压缩包解压到此目录下。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;然后需要修改 Grafana 的配置文件，在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;222:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;/grafana/conf/&lt;/codeph&gt; 目录下找到 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;222:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;defaults.ini&lt;/codeph&gt; 文件，编辑该文件，找到 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;222:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[plugins]&lt;/codeph&gt;，做以下修改:&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;allow_loading_unsigned_plugins = dolphindb-datasource&lt;/codeblock&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-18.png&#34; xtrc=&#34;image:21;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;841&#34; dita-ot:image-height=&#34;224&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;229:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;修改配置文件之后，需要重启Grafana服务。重启后，在Grafana中添加dolphindb-datasource数据源，在搜索框输入&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;229:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB&lt;/codeph&gt;，然后点击下方出现的结果，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-20.png&#34; xtrc=&#34;image:22;231:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;936&#34; dita-ot:image-height=&#34;342&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;233:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击该数据源，进入配置页面，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-21.png&#34; xtrc=&#34;image:23;235:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;750&#34; dita-ot:image-height=&#34;614&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;其中，&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;239:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;239:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;1 为该数据源名称；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;2 为监控的 DolphinDB 节点的 IP 和端口号；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;241:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;3 和 4 分别为该 DolphinDB 节点的登录名和密码；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;5 为保存按钮。点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;242:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Save &amp;amp;test&lt;/codeph&gt; 出现如下提示，表明成功连接到 DolphinDB：&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-22.png&#34; xtrc=&#34;image:24;244:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;907&#34; dita-ot:image-height=&#34;681&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;246:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;后面就可以使用配置好的数据源，通过编写脚本对 DolphinDB 集群进行监控。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-23.png&#34; xtrc=&#34;image:25;248:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;839&#34; dita-ot:image-height=&#34;330&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;250:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Data source&lt;/codeph&gt; 里选择配置好的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;250:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB-test&lt;/codeph&gt;，之后会进入一个脚本编辑界面，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-24.png&#34; xtrc=&#34;image:26;252:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1479&#34; dita-ot:image-height=&#34;742&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在该界面输入 DolphinDB 的脚本，查询需要的指标。编辑完成之后，编写完成后按 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;254:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;ctrl + s&lt;/codeph&gt; 保存，或者点击页面中的刷新按钮 (&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:37;254:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Refresh dashboard&lt;/codeph&gt;)，可以将查询发到 DolphinDB 数据库运行并展示出图表。上述案例脚本如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;temp = getClusterPerf(includeMaster=true) t = select host,port,mode,state,name,maxMemSize,runningTasks,queuedTasks,runningJobs,queuedJobs,connectionNum from temp mapper1 = dict(0 1 2 3 4,[&#34;datanode&#34;,&#34;agentnode&#34;,&#34;controlnode&#34;,&#34;singlemode&#34;,&#34;computenode&#34;]) mapper2 = dict(0 1,[&#34;unsurvive&#34;,&#34;survive&#34;]) tempvalue1 = t.mode tempvalue2 = t.state finalvalue1 = mapper1[tempvalue1] finalvalue2 = mapper2[tempvalue2] replaceColumn!(t,`mode,finalvalue1) replaceColumn!(t,`state,finalvalue2) select * from t&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;270:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;270:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;注意&lt;/b&gt;：返回的结果的形式必须为一张表。若想将结果展示为 Graph，可以点击右侧的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:38;270:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Visualizations&lt;/codeph&gt;，点击红色方框处下拉列表，选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:39;270:78&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Time series&lt;/codeph&gt;，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/2-25.png&#34; placement=&#34;break&#34; xtrc=&#34;image:27;272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1909&#34; dita-ot:image-height=&#34;446&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;监控方案实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;监控方案实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;监控指标体系及其计算公式&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;监控指标体系及其计算公式&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;276:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;278:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第一套监控方案指标体系如下表所示：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:1;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:4;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;280:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;281:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;指标类别&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;281:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;281:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;具体指标&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;281:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;281:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana数据源&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:4;281:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;281:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus数据源&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;282:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;CPU&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;282:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;CPU使用率&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:7;282:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:8;282:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;NodeExporter&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;磁盘&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:10;283:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;磁盘容量、磁盘空间使用率、磁盘 IO&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:11;283:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:12;283:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;NodeExporter&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:13;284:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;网络&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:14;284:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;网络IO&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:15;284:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:16;284:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;NodeExporter&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:17;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;内存&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:18;285:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;内存使用率&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:19;285:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:20;285:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;NodeExporter&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;287:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第二套监控方案指标体系如下表所示：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:2;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:5;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:6;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:7;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:8;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:21;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;290:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;指标类别&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:22;290:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;290:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;具体指标&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:23;290:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;290:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana数据源&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:24;290:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;290:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus数据源&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;291:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:25;291:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;CPU&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:26;291:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;CPU 使用率&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:27;291:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:28;291:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB Server&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:29;292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;磁盘&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:30;292:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;磁盘容量、磁盘空间使用率、磁盘 IO&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:31;292:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:32;292:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB Server&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:33;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;网络&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:34;293:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;网络 IO&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:35;293:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:36;293:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB Server&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:37;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;内存&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:38;294:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;内存使用率&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:39;294:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:40;294:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB Server&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:41;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;数据库性能&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:42;295:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;正在运行的 Tasks/Jobs数、查询平均耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:43;295:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:44;295:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;DolphinDB Server&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第三套监控方案指标体系如下所示&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:3;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:9;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:10;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:11;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:12;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;300:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;300:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:45;300:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;300:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;指标类别&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:46;300:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;300:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;具体指标&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:47;300:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;300:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana数据源&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:48;300:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;300:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus数据源&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:49;301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;节点状态&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:50;301:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;节点状态、流数据表状态、订阅状态&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:51;301:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;dolphindb-datasource&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:52;301:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;————&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;303:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上述三套监控指标体系中每个指标的计算公式如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;305:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第一套监控方案指标计算公式&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;#--------------------CPU-----------------------------# #服务器cpu使用率（%） (1-sum(rate(node_cpu_seconds_total{mode=&#34;idle&#34;}[1m])) by (job) / sum(rate(node_cpu_seconds_total[1m])) by (job)) *100 #--------------------内存-----------------------------# #服务器内存使用率（%） (node_memory_MemTotal_bytes - (node_memory_MemFree_bytes + node_memory_Buffers_bytes+node_memory_Cached_bytes ))/node_memory_MemTotal_bytes * 100 #--------------------磁盘容量-----------------------------# #服务器磁盘空间使用率(%) (1 - sum(node_filesystem_free_bytes)by(job) / sum(node_filesystem_size_bytes) by(job))*100 #服务器磁盘挂载点空间使用率(%) (1-sum(node_filesystem_free_bytes{mountpoint =~&#34;/hdd.*?|/ssd.*?|/home.*?&#34;})by (job,mountpoint)/sum(node_filesystem_size_bytes{mountpoint =~&#34;/hdd.*?|/ssd.*?|/home.*?&#34;})by(job,mountpoint))*100 #--------------------磁盘 IO-----------------------------# #服务器各磁盘读速率(MB/s) irate(node_disk_read_bytes_total{device=~'sd[a-z]'}[1m])/1024/1024 #服务器各磁盘写速率(MB/s) irate(node_disk_written_bytes_total{device=~&#34;sd[a-z]&#34;}[1m])/1024/1024 #--------------------网络-----------------------------# #服务器网络发送速率(MB/s) sum(irate(node_network_transmit_bytes_total[1m]))by(job)/1024/1024 #服务器网络接收速率(MB/s) sum(irate(node_network_receive_bytes_total[1m]))by(job)/1024/102 #服务器每块网卡发送速率(MB/s) irate(node_network_transmit_bytes_total[1m])/1024/1024 #服务器每块网卡接收速率(MB/s) irate(node_network_reveive_bytes_total[1m])/1024/1024&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;344:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第二套监控方案指标计算公式&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;346:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;#--------------------CPU-----------------------------# # CPU 使用率(%) cpuUsage #--------------------内存-----------------------------# #节点内存占用(MB) memoryUsed/1024/1024 #--------------------磁盘-----------------------------# #节点所在磁盘空间使用率(%) (1-diskFreeSpace/diskCapacity)*100 #节点所在磁盘读速率(MB/s) diskReadRate/1024/1024 #节点所在磁盘写速率(MB/s) diskWriteRate/1024/1024 #--------------------网络-----------------------------# #节点网络发送速率(MB/s) networkSendRate/1024/1024 #节点网络接收速率(MB/s) networkRecvRate/1024、1024 #--------------------高可用集群性能-----------------------------# #节点前10个完成的查询执行所耗费时间的中间值（ms） maxLast10QueryTime/1000000 #节点当前正在执行的查询的最大耗时(ms) maxRunningQueryTime/1000000 #节点正在执行 Job 数 runningJobs #节点等待执行 Job 数 queuedJobs #节点 CPU 平均负载(%) avgLoad #节点作业负载(%) jobLoad #--------------------高可用集群状态-----------------------------# #节点与 Prometheus 的连接状态 up{=~&#34;[^0-9].*?[0-9]}&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;第三套监控方案指标计算公式&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;398:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;#流数据表状态 getStreamingStat().pubTables #订阅状态 getStreamingStat().subWorkers #节点状态 temp = getClusterPerf(includeMaster=true) t = select host,port,mode,state,name,maxMemSize,runningTasks,queuedTasks,runningJobs,queuedJobs,connectionNum from temp mapper1 = dict(0 1 2 3 4,[&#34;datanode&#34;,&#34;agentnode&#34;,&#34;controlnode&#34;,&#34;singlemode&#34;,&#34;computenode&#34;]) mapper2 = dict(0 1,[&#34;未存活&#34;,&#34;存活&#34;]) tempvalue1 = t.mode tempvalue2 = t.state finalvalue1 = mapper1[tempvalue1] finalvalue2 = mapper2[tempvalue2] replaceColumn!(t,`mode,finalvalue1) replaceColumn!(t,`state,finalvalue2) select * from t&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;导入-json-文件监控集群&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;导入 JSON 文件监控集群&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;为快速实现 DolphinDB 高可用集群与服务器资源的监控，我们提供了涉及指标的监控模板，在 Grafana 中导入对应的模板就可进行监控。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;json&#34; href=&#34;script/cluster_monitor/high_available_cluster_monitor.json&#34; xtrc=&#34;xref:5;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB高可用集群监控.json&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;json&#34; href=&#34;script/cluster_monitor/server_monitor.json&#34; xtrc=&#34;xref:6;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;服务器监控.json&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;具体步骤如下：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;429:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;步骤1：下载对应监控模板的 json 代码。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;431:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;步骤2：在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:40;431:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Dashboards&lt;/codeph&gt; 中选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:41;431:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Import&lt;/codeph&gt; 。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/3-1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:28;433:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;262&#34; dita-ot:image-height=&#34;295&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;435:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;步骤3：将 json 代码复制到下图所示的红框2中，然后点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:42;435:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Load&lt;/codeph&gt;，即可导入模板。或选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:43;435:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Upload JSON file&lt;/codeph&gt;，直接导入对应的 json 文件。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/3-2.png&#34; placement=&#34;break&#34; xtrc=&#34;image:29;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;984&#34; dita-ot:image-height=&#34;497&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;步骤4：为保证能够正确拉取数据，需将 dashboards 里 panel 的数据源修改为已设置好的数据源，如果数据源为 dolphindb-datasource，监控指标需要手工填入（监控指标和指标对应的数据源参考3.1节），然后点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:44;439:120&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Run queries&lt;/codeph&gt; 确认获取指标成功，即可正常开启监控 ，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/3-3.png&#34; placement=&#34;break&#34; xtrc=&#34;image:30;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1488&#34; dita-ot:image-height=&#34;608&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;邮件告警与预警&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;邮件告警与预警&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus 和 Grafana 的告警功能丰富，可以设置，邮件、钉钉、企业微信等多种方式的告警和预警。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;447:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;本章简单介绍了如何设置邮件告警，其他告警设置请参考附录章节。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;修改配置文件添加邮箱信息&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;修改配置文件添加邮箱信息&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:2;451:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;451:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;451:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;使用邮件告警功能，需修改 Grafana 的配置文件中的&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:45;451:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[smtp], [plugin.grafana-images/cluster_monitor-renderer], [unified_alerting.screenshots]&lt;/codeph&gt;。进入 defaults.ini (默认路径为/grafana/conf/defaults.ini)，找到 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:46;451:176&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[smpt]&lt;/codeph&gt;选项，做如下所示更改：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/3-4.png&#34; xtrc=&#34;image:31;453:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;853&#34; dita-ot:image-height=&#34;206&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;455:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;455:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;将 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:47;455:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;enabled&lt;/codeph&gt; 修改为 true，表示开启邮件通道。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:48;455:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;host&lt;/codeph&gt; 配置的是告警邮箱所在的服务器，例如，若以163邮箱作为告警发件邮箱，则 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:49;455:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;host&lt;/codeph&gt; 应为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:50;455:87&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;smtp.163.com:465&lt;/codeph&gt;。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:51;455:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;user&lt;/codeph&gt; 是告警的发件邮箱，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:52;455:122&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;password&lt;/codeph&gt; 处需要填写授权码，而不是 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:53;455:146&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;user&lt;/codeph&gt; 的登录密码，内网邮箱一般只需要密码即可，请按实际情况填写。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;457:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;然后修改 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:54;457:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[plugin.grafana-images/cluster_monitor-renderer]&lt;/codeph&gt; 选项下的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:55;457:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;rendering_language&lt;/codeph&gt;，将其赋值为 zh，表示告警图片中支持中文显示，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/3-5.png&#34; xtrc=&#34;image:32;459:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1296&#34; dita-ot:image-height=&#34;165&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;461:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;要在邮箱告警中显示图片，就要安装 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://grafana.com/grafana/plugins/grafana-image-renderer/&#34; scope=&#34;external&#34; xtrc=&#34;xref:7;461:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;grafana-images/cluster_monitor-renderer&lt;/xref&gt;。然后修改 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:56;461:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[unified_alerting.screenshots]&lt;/codeph&gt; 选项下的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:57;461:167&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;capture&lt;/codeph&gt;，将其赋值为 true，表示在告警邮件中加入图片，如下所示： &lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/3-6.png&#34; xtrc=&#34;image:33;462:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1030&#34; dita-ot:image-height=&#34;77&#34;/&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;告警规则建立&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;464:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;464:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;告警规则建立&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;464:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:58;466:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alert&lt;/codeph&gt; 模块提供了告警和预警功能，使用告警和预警功能时，需要在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:59;466:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alert rules&lt;/codeph&gt; 模块中建立告警规则。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:60;466:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alert rules&lt;/codeph&gt; 主要作用为：对指标进行监控，当指标触发告警条件时，进行告警处理。一个告警规则至少要包含告警条件和告警评估。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;告警条件&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;470:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:61;470:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;New alert rule&lt;/codeph&gt; 添加新的告警规则，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:34;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1744&#34; dita-ot:image-height=&#34;761&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;474:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:62;474:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alert rules&lt;/codeph&gt; 的第一组件，告警条件。告警条件的一般设置为：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:3;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;476:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;告警选择器，默认为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:63;476:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana managed alert&lt;/codeph&gt;；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;478:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;478:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:64;478:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Add query&lt;/codeph&gt; 为新增查询；选择需要监控告警的指标，如 CPU 使用率；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;480:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:65;480:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Add expression&lt;/codeph&gt; 为新增表达式；&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;482:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;为选择用于最终告警的数据。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;484:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;需要明确的是，Grafana 通过接收一个布尔值来决定是否触发告警，当接收值为 1 时，触发告警，接收值为0时，不触发告警，因此，单一的查询语句无法进行告警(单一的查询语句返回的是具体数值，不是布尔值)，还需要一个表达式来返回一系列的布尔值。表达式中一共有四种操作符，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-2.png&#34; xtrc=&#34;image:35;486:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;777&#34; dita-ot:image-height=&#34;223&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;当查询结果返回一条数据时，如查询服务器 CPU 使用率&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;490:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;(1-sum(rate(node_cpu_seconds_total{job=A,mode=&#34;idle&#34;}[1m]))/ sum(rate(node_cpu_seconds_total{job=A}[1m]))) *100&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;494:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;只返回服务器 CPU 使用率一条数据，需要选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:66;494:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Classic condition&lt;/codeph&gt; 操作符，即 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:67;494:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Classic condition&lt;/codeph&gt; 适用于单维告警条件。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;当查询结果返回多条数据时，如查询三台服务器 CPU 使用率&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;(1-sum(rate(node_cpu_seconds_total{mode=&#34;idle&#34;}[1m])) by (job) / sum(rate(node_cpu_seconds_total[1m])) by (job)) *100&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;502:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;返回三台服务器的 CPU 使用率数据，需要组合 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:68;502:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Reduce&lt;/codeph&gt; 操作和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:69;502:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Math&lt;/codeph&gt; 操作，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:70;502:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Reduce&lt;/codeph&gt; 作用将多条语句结果进行聚合分组，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:71;502:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Math&lt;/codeph&gt; 为布尔运算表达式。如下图所示，当查询返回一条数据时：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-3.png&#34; placement=&#34;break&#34; xtrc=&#34;image:36;504:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1452&#34; dita-ot:image-height=&#34;562&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;506:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图中的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:72;506:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Conditions&lt;/codeph&gt; 中的含义为，若在时间窗口中查询语句A的返回结果最后一个值大于3，返回1，否则返回0，对应的操作为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:73;506:68&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;WHEN=last()&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:74;506:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;OF=A&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:75;506:89&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;IS ABOVE=3&lt;/codeph&gt;。也可以选择其他条件，如，若在时间窗口中A的平均值小于50，触发告警，对应的操作为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:76;506:143&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;WHEN=mean()&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:77;506:157&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;OF=A&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:78;506:164&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;IS BELOW=50&lt;/codeph&gt;。此外，可供的选择有很多种，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-4.png&#34; xtrc=&#34;image:37;508:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;635&#34; dita-ot:image-height=&#34;431&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;510:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;当查询结果返回多条语句时，首先选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:79;510:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Reduce&lt;/codeph&gt; 操作符。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-5.png&#34; placement=&#34;break&#34; xtrc=&#34;image:38;512:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1443&#34; dita-ot:image-height=&#34;543&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;514:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图中的含义为，将查询语句 A 的返回结果进行分组，然后对分组结果取均值，并且若时间窗口内有 Nan 值，在求均值时将 Nan 视为 Nan，而不是剔除（其余参数含义见 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://grafana.com/docs/grafana/latest/alerting/&#34; scope=&#34;external&#34; xtrc=&#34;xref:8;514:86&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;Grafana 官方文档&lt;/xref&gt;）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;516:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在进行了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:80;516:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Reduce&lt;/codeph&gt; 操作之后，新增一个 expression，选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:81;516:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Math&lt;/codeph&gt; 操作符，进行布尔运算，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-6.png&#34; placement=&#34;break&#34; xtrc=&#34;image:39;518:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1442&#34; dita-ot:image-height=&#34;352&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:82;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;$B&amp;gt;80&lt;/codeph&gt;表示若表达式B返回的结果大于80，返回1，否则返回0。引用其他表达式或者查询的结果时，要使用一个'$'符号，比如，引用B表达式的结果，用'$B'表示。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;522:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;选择用于最终告警的数据。该数据一定为一个布尔类型的数据。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-7.png&#34; placement=&#34;break&#34; xtrc=&#34;image:40;524:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;646&#34; dita-ot:image-height=&#34;212&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;526:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图选择了 C 返回的结果作为告警触发条件。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;528:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;528:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;告警评估&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;530:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;这个组件主要功能为每隔多久评估一次指标是否触发告警条件，以及持续多久触发告警条件后进行告警。如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-8.png&#34; placement=&#34;break&#34; xtrc=&#34;image:41;532:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;946&#34; dita-ot:image-height=&#34;341&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;534:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;为每隔多久评估一次是否触发告警条件，上图选择1分钟评估一次。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;536:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;是 Pending 时间，意为为持续多久触发告警条件后进行告警，上图选择了持续5分钟触发告警后进行告警。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;538:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;为当表达式返回的值为空时，设置告警规则的状态，有 No Data, Alerting, OK 三种状态可以选择。若表达式返回的数据为空，设置为 Alerting 和 No Data 时，持续时间超过5分钟会触发告警，选择 OK 则不会触发告警。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;540:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;为当告警条件出现异常时，设置告警规则的状态，有 Error, Alerting, OK 三种状态可以选择。若前面的告警条件出现了异常，设置为 Alerting 和 No Data 时，异常持续时间超过5分钟会触发告警，选择 OK 则不会触发告警。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-9.png&#34; placement=&#34;break&#34; xtrc=&#34;image:42;542:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1209&#34; dita-ot:image-height=&#34;268&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;544:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图中红框为告警规则的状态。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:83;544:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Pending&lt;/codeph&gt; 表示该指标已经触发告警条件，但持续时间还未超过5分钟，一旦持续时间超过了5分钟，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:84;544:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Pending&lt;/codeph&gt; 就会变为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:85;544:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Firing&lt;/codeph&gt;。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:86;544:89&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;No data&lt;/codeph&gt; 表示表达式查询返回值为空。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:87;544:112&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Normal&lt;/codeph&gt; 表示指标正常。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;告警消息设置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;546:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;546:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;告警消息设置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;546:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;548:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;该组件主要为告警规则设置一些展示信息、设置告警组等等。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-10.png&#34; placement=&#34;break&#34; xtrc=&#34;image:43;550:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1299&#34; dita-ot:image-height=&#34;528&#34;/&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;552:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;552:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;1 为设置告警规则名称。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;553:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;2 为设置告警规则所在的文件夹，若不存在文件夹，输入一个要创建的文件夹名可以直接新建一个。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;554:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;3 为设置告警规则所在的组，在同一个组里的告警规则的评估间隔是相同的。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;556:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;其余的为非必选选项，可以删除。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:88;556:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Summary&lt;/codeph&gt; 为可使用模板变量，使得在告警消息中显示出具体的设备名称和值，如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:89;556:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;{{$labels.job}} 服务器cpu使用率为：{{values.B}}$&lt;/codeph&gt;，若 A 服务器的 CPU 使用率为 90.14，则使用该语句后，在告警消息中会显示出：A 服务器 CPU 使用率为：90.14。更多支持的模板变量见&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/message-templating/&#34; scope=&#34;external&#34; xtrc=&#34;xref:9;556:175&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;Grafana模板变量&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;558:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:90;558:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Dashboard UID&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:91;558:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Panel ID&lt;/codeph&gt; 是一对组合使用的选项，其作用为：当告警触发时，Grafana 会在对应的 Dashboard UID 下对应的 Panel ID 里进行 warning 标识。如图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-11.png&#34; placement=&#34;break&#34; xtrc=&#34;image:44;560:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;904&#34; dita-ot:image-height=&#34;293&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;当填入了 Dashboard UID 和 Panel ID，对应的监控指标图出现了之前没有的图示项。绿色的心表示当前监控指标处于正常状态。红框标注出来的线条表示告警触发的开始时间和告警消息发送时间，对应告警状态里的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:92;562:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Pending&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:93;562:121&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;firing&lt;/codeph&gt;。如果告警规则是直接在 panel 里创建的，告警规则会自动补全 Dashboard UID 和 Panel ID。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-12.png&#34; placement=&#34;break&#34; xtrc=&#34;image:45;564:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1444&#34; dita-ot:image-height=&#34;577&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;566:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在各节点等待执行 Job 个数这个 panel 里添加一个告警规则后，Dashboard UID 和 Panel ID 会自动补全：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-13.png&#34; placement=&#34;break&#34; xtrc=&#34;image:46;568:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;802&#34; dita-ot:image-height=&#34;244&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;570:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;预警需要用到 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:94;570:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;predict_linear(v range-vector,t scalar)&lt;/codeph&gt; 函数，该函数基于 range-vector 内指标 V 的数据，预测 t 秒后该指标的值，详情见&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://prometheus.io/docs/prometheus/latest/querying/functions/#predict_linear&#34; scope=&#34;external&#34; xtrc=&#34;xref:10;570:98&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;predict_linear&lt;/xref&gt;。示例如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-14.png&#34; placement=&#34;break&#34; xtrc=&#34;image:47;572:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1212&#34; dita-ot:image-height=&#34;825&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;设置告警方式&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;设置告警方式&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;576:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;配置文件修改后，在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:95;576:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Contact points&lt;/codeph&gt; 模块设置告警消息的接收方式以及接收者，建立告警消息的发送模板，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-15.png&#34; placement=&#34;break&#34; xtrc=&#34;image:48;578:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1448&#34; dita-ot:image-height=&#34;493&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;580:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;从 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:96;580:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;hoose Alertmanager&lt;/codeph&gt; 下拉列表中选择告警管理工具，默认选项为 Grafana。如需选择其他告警管理工具，请自行安装。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:97;580:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Message template&lt;/codeph&gt; 为告警消息模板，它主要的功能为：给告警消息提供一个格式化模板，若不创建消息模板，Grafana 将使用默认的模板。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;582:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:98;582:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Contact point&lt;/codeph&gt; 为告警消息的接收方式和接收者。点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:99;582:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;New contact point&lt;/codeph&gt; 进入如下页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-16.png&#34; placement=&#34;break&#34; xtrc=&#34;image:49;584:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1280&#34; dita-ot:image-height=&#34;728&#34;/&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;586:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:100;586:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Name&lt;/codeph&gt;，设置告警名称&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;588:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;588:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:101;588:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Contact point type&lt;/codeph&gt;，设置告警通知方式。常用项为 Email 和钉钉。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;590:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;590:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:113;590:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:102;590:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Address&lt;/codeph&gt;，当 Contact point type 设置为 Email 时可用，用于设置 Email 地址。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;592:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:114;592:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:103;592:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;URL&lt;/codeph&gt;，当 Contact point type 设置为钉钉时可用，用于填写钉钉群中告警机器人的 webhook。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;594:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:115;594:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:104;594:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Notification settings&lt;/codeph&gt;，用于在告警恢复时设置是否发送恢复通知。默认为发送。如需禁用，选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:105;594:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Disable resolved message&lt;/codeph&gt;，并点击 S 保存。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:116;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;此外，Grafana 可以根据告警标签设置更加复杂的发送策略，比如不同的告警发给不同的组员、设置特定时间段屏蔽告警等，详情请参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#grafana-告警的进阶使用&#34; xtrc=&#34;xref:11;597:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;附录-grafana告警的进阶使用&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;最终结果&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;599:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;599:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;最终结果&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;599:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:117;601:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;告警或预警邮件如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-17.png&#34; placement=&#34;break&#34; xtrc=&#34;image:50;603:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;845&#34; dita-ot:image-height=&#34;710&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:118;605:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;若收到告警消息后需要跳转到具体的 panel 页面，可以点击下方的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:106;605:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Go to Panel&lt;/codeph&gt; 跳转。若点击后无法访问页面，是因为Grafana的配置文件中设置上述邮件里的跳转的链接默认值为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:107;605:97&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;https://localhost:9094&lt;/codeph&gt;，不是指向服务器部署的 Grafana ，因此会出现拒绝访问。此时需要回到 defaults.ini中修改 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:108;605:175&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[server]&lt;/codeph&gt; 选项里的内容，&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/4-18.png&#34; xtrc=&#34;image:51;607:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;694&#34; dita-ot:image-height=&#34;302&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:119;609:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;将 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:109;609:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;http_addr、domain&lt;/codeph&gt; 改为服务器的公网IP。之后邮件里的跳转链接就变成了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:110;609:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;root_url&lt;/codeph&gt;，我们就能访问到对应告警指标的监控页面了。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;附录&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;611:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;611:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;附录&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;611:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;promql-查询语法&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;613:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;613:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;PromQL 查询语法&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;613:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:120;615:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;PromQL 是 Prometheus 的自定义查询语言，通过 PromQL 用户可以非常方便地对监控样本数据进行统计分析，PromQL 支持常见的运算操作符，同时 PromQL 中还提供了大量的内置函数用于对数据的高级处理，并且支持简单的 SQL 查询语句。下面对 PromQL 进行简单的介绍，详细的信息见&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/&#34; scope=&#34;external&#34; xtrc=&#34;xref:12;615:156&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;Prometheus官方文档&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;promql-metric-类型&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;617:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;617:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;PromQL metric 类型&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;617:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:121;619:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus 定义了4种不同的指标类型(metric type)：Counter, Gauge, Histogram, Summary:&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;621:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:4;621:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:13;621:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:14;621:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;621:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;622:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;622:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:53;622:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;类型名称&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:54;622:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;含义&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;623:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:55;623:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Counter&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:56;623:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;计数器&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;624:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:57;624:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Gauge&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:58;624:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;仪表盘&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;625:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:59;625:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Histogram&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:60;625:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;直方图&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;626:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:61;626:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Summary&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:62;626:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;摘要&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:122;628:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;通常 Counter 的总数并没有直接作用，而是需要借助于 rate, topk, increase 和 irate 等函数来生成样本数据的变化状况，如：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;630:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;rate(http_requests_total[2h])，获取2小时内，该指标下各时间序列上的 http 总请求数的增长速率 topk(3,http_requests_total)，获取该指标下http请求总数排名前3的时间序列 irate(http_requests_total[2h])，高灵敏度函数，用于计算指标的瞬时速率&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:123;638:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Gauge 用于存储其值可增可减的指标样本数据，常用于进行求和、取平均值、最小值、最大值等聚合计算。也会经常结合 PromQL 的 predict_linear 和 delta 函数使用，如：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;640:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;predict_linear(v range-vector,t,scalar)函数可以预测时间序列 v 在 t 秒后的值，他通过线性回归的方式来预测样本数据的 Gauge 变化趋势 delta(v range-vector)函数计算范围向量中的每个时间序列元素的第一个值与最后一个值之差，从而展示不同时间点上的样本值得差值。 delta(cpu_temp_celsius{host=“hostname”}[2h])，返回该服务器上的 CPU 温度与两小时之前的差异&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:124;648:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus 的内置函数请参考官方文档&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://prometheus.io/docs/prometheus/latest/querying/functions/&#34; scope=&#34;external&#34; xtrc=&#34;xref:13;648:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;PromQL 内置函数&lt;/xref&gt;.&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;promql-表达式&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;650:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;650:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;PromQL 表达式&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;650:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:125;652:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus 通过指标名称和对应的一组标签（labelset）唯一定义一条时间序列。指标名称反映了监控样本的基本标识，而 label 则在这个基本标识上为采集到的数据提供了多种特征维度。用户可以基于这些特征维度过滤，聚合，统计从而产生新的计算后的一条时间序列。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:126;654:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;以查询语句 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:111;654:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;rate(node_cpu_seconds_total{mode=&#34;idle&#34;,instance=&#34;localhost:8080&#34;}[2h])&lt;/codeph&gt; 为例， &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:112;654:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;node_cpu_seconds_total&lt;/codeph&gt; 是一个即时向量；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:113;654:118&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;{}&lt;/codeph&gt; 里的内容是筛选条件；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:114;654:133&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;mode=&#34;idle&#34;&lt;/codeph&gt; 就是筛选标签；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:115;654:154&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;[2h]&lt;/codeph&gt; 是范围向量，当不指定范围向量时，返回的是当前时刻的瞬时值。该查询语句查询的是地址为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:116;654:203&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;localhost:8080&lt;/codeph&gt; 服务器在两小时内 CPU 的闲置率。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:127;656:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;查询语句返回的是以当前时刻为基准的值，如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:117;656:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;node_cpu_seconds_total[5m]&lt;/codeph&gt;，返回以当前时间为基准5分钟内的数据。若要查询5分钟前的样本数据，则需要借助位移操作符 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:118;656:94&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;offset&lt;/codeph&gt;，如查询5分钟前至10分钟前，这5分钟的 CPU 使用时长，可使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:119;656:136&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;node_cpu_seconds_total[5m] offset 5m&lt;/codeph&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:128;658:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;当然 PromQL 也支持常见的布尔运算符，如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:120;658:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;(node_memory_bytes_total - node_memory_free_bytes_total) / node_memory_bytes_total &amp;gt; 0.95&lt;/codeph&gt; 查询的是当前内存使用率超过95%的主机。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:129;660:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;此外 PromQL 还支持常见的聚合操作,并可以通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:121;660:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;by&lt;/codeph&gt; 关键字进行分组，如 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:122;660:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;sum(http_requests_total) by (code,handler,job,method)&lt;/codeph&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;grafana-面板使用技巧&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;662:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;662:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana 面板使用技巧&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;662:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:130;664:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;默认情况下，Grafana 图形展示指标的标签会很详细，有的时候我们并不需要那么多的信息，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:52;666:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;915&#34; dita-ot:image-height=&#34;330&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:131;668:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;对于查询出来的指标，有时我们只关心它的主要信息，比如说，上图中我们只关心网卡的名称，此时我们只需要如下所示操作，点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:123;668:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Transform&lt;/codeph&gt;&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-2.png&#34; placement=&#34;break&#34; xtrc=&#34;image:53;670:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;658&#34; dita-ot:image-height=&#34;137&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:132;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;然后会跳转到如下所示页面，并在搜索栏输入 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:124;672:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Labels to fields&lt;/codeph&gt;：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-3.png&#34; placement=&#34;break&#34; xtrc=&#34;image:54;674:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1445&#34; dita-ot:image-height=&#34;230&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:133;676:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击搜索结果，会跳转到如下所示的页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-4.png&#34; placement=&#34;break&#34; xtrc=&#34;image:55;678:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;761&#34; dita-ot:image-height=&#34;308&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:134;680:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:125;680:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Labels&lt;/codeph&gt; 后面的值表明了可以用作图表的标签，下方的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:126;680:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Value field name&lt;/codeph&gt; 用于选择你希望取什么值作为图表的标签，在网卡的展示中，一般我们需要的信息是网卡的名称，所以选择 device，选择好后，指标的标签就变成如下所示的样子：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-5.png&#34; placement=&#34;break&#34; xtrc=&#34;image:56;682:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;873&#34; dita-ot:image-height=&#34;314&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:135;684:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;有的时候，不同网卡的发送速率有很大的差别，而 Grafana 在对查询到的结果进行可视化作图时，它是以最大值作为指标波动的上限范围的，导致在可视化时会出现，发送速率较小的网卡看起来几乎没有波动。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:136;686:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;如上图所示，直观上 enp0s3 网卡在三十分钟内的发送速率曲线波动很小，但实际上是有变化的，点击上图中的 enp0s3，可得到如下所示图表：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-6.png&#34; placement=&#34;break&#34; xtrc=&#34;image:57;688:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;834&#34; dita-ot:image-height=&#34;298&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:137;690:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;因此，在进行监控时，若一个 panel 中有多个指标，需要谨慎观察每一个设备的波动情况。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:138;692:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;一个 Dashboard 中可以追加多个图表：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-7.png&#34; placement=&#34;break&#34; xtrc=&#34;image:58;694:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1370&#34; dita-ot:image-height=&#34;397&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:139;696:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;如上图所示，点击右上角的符号，就可以继续追加图表。如果一个 Dashboard 中的 panel 很多，可以进行分类管理。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-8.png&#34; placement=&#34;break&#34; xtrc=&#34;image:59;698:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1532&#34; dita-ot:image-height=&#34;485&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:140;700:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图的 panel 的类别很乱，可点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:127;700:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Add a new row&lt;/codeph&gt;，创建 panel 的分类，然后将对应的 panel 拖动到类别里：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-9.png&#34; placement=&#34;break&#34; xtrc=&#34;image:60;702:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1452&#34; dita-ot:image-height=&#34;187&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;grafana-告警的进阶使用&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;704:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;704:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana 告警的进阶使用&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;704:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;alerts-标签设置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;706:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;706:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alerts 标签设置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;706:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:141;708:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;在告警规则建立时，告警组件的最后一步，可以为告警设置一些查询语句中不具有的标签，以供 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:128;708:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Notification polices&lt;/codeph&gt; 和 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:129;708:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Silence&lt;/codeph&gt; 组件使用。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-10.png&#34; placement=&#34;break&#34; xtrc=&#34;image:61;710:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1189&#34; dita-ot:image-height=&#34;697&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:142;712:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;key 和 value 都是自定义的，如令 key=rule, value=cpuUsage。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:143;714:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;以 CPU 使用率为例，完成一个告警规则配置后，此时 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:130;714:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alert rules&lt;/codeph&gt; 界面会出现如下所示内容，Labels 会显示自定义的标签：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-11.png&#34; placement=&#34;break&#34; xtrc=&#34;image:62;716:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1415&#34; dita-ot:image-height=&#34;649&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;notification-policies-模块&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;718:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;718:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:131;718:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Notification policies&lt;/codeph&gt; 模块&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;718:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:144;720:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;告警和预警的主要目的帮助相关人员了解服务器当前运行状况，当发生异常时，提醒专业的人员进行维护，但是不同的告警需要不同的部门或运维人员介入处理，因此我们需要将不同的告警消息发送给不同的人员。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:132;720:95&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Notification policies&lt;/codeph&gt; 模块的作用是将告警消息按照制定好的策略发送。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-12.png&#34; placement=&#34;break&#34; xtrc=&#34;image:63;722:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1304&#34; dita-ot:image-height=&#34;781&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:145;724:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:133;724:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Notification policies&lt;/codeph&gt; 一共有 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:134;724:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Root policy--default for all alerts, Specific routing, Mute timings&lt;/codeph&gt; 三大组件。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;726:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;726:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:146;726:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:135;726:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Root policy--default for all alerts&lt;/codeph&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:147;728:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:136;728:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Root policy--default for all alerts&lt;/codeph&gt; 组件设置的是告警消息的默认接收者，当某个告警规则未指定告警消息接收者时，告警发生后，告警消息将发送到默认接收者。点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:137;728:102&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Edit&lt;/codeph&gt; 编辑告警消息的默认接收者，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-13.png&#34; placement=&#34;break&#34; xtrc=&#34;image:64;730:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1282&#34; dita-ot:image-height=&#34;590&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:148;732:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:138;732:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Default contact point&lt;/codeph&gt; 为告警消息的默认接收者。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:149;734:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:139;734:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Group by&lt;/codeph&gt; 将告警规则按照所选择的Label进行分组。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:150;736:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:140;736:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Group wait&lt;/codeph&gt; 为新创建的告警规则所产生的新组在第一次发送告警消息前的缓冲时间。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:151;738:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:141;738:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Group interval&lt;/codeph&gt; 为属于同组的告警规则之间发送告警消息的时间间隔，举例说明：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:152;740:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;设组1有 A, B 两个告警规则，Group Interval 为 m 分钟，且他们的 Pending 时间都是 n 分钟，A 在9:45分触发了告警条件，B 在9:46分触发了告警条件，且 A 持续触发告警条件的时间大于 n，B 持续触发告警条件的时间大于 n+m，则 A 将在(9:45+n)发送告警消息，B 不是在(9:46+n)触发告警消息，而是将在(9:46+n+m)发送告警消息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:153;742:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:142;742:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Repeat interval&lt;/codeph&gt; 为前后两次发送告警消息的时间间隔。举例说明：设告警规则 A 所在组的 Repeat interval 时间为 f，A 持续触发告警的时间远远大于其 Pending 时间和f，A 在9:45首次发送告警消息，A 将在(9:45+f)再次发送告警消息，而不是在(9:45+Pending时间)发送告警消息。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;744:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:154;744:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:143;744:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Specific routing&lt;/codeph&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:155;746:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:144;746:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Specific routing&lt;/codeph&gt; 组件主要功能为将不同类型的告警消息发送给不同的人。如下所示，点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:145;746:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;New specific policy&lt;/codeph&gt;，进入如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-14.png&#34; placement=&#34;break&#34; xtrc=&#34;image:65;748:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1255&#34; dita-ot:image-height=&#34;567&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:156;750:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:146;750:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Add matcher&lt;/codeph&gt;，进入如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-15.png&#34; placement=&#34;break&#34; xtrc=&#34;image:66;752:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1256&#34; dita-ot:image-height=&#34;625&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:157;754:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:147;754:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Contact point&lt;/codeph&gt; 选择接收者。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:158;756:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:148;756:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Matching labels&lt;/codeph&gt; 通过标签及对应的值来选择该接收者要接收的告警消息。上述将有 cpuUsage 标签的告警消息发送给 test1。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:159;758:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:149;758:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Override grouping&lt;/codeph&gt; 设置该路径里告警规则的分组依据，若不开启，则从默认接收者中继承。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:160;760:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:150;760:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Override general timings&lt;/codeph&gt; 若开启，将覆盖默认接收者里设置的 timings。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:161;762:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:151;762:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Mute timings&lt;/codeph&gt; 为该接受收者选择一个要接收告警的时间。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;764:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:162;764:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:152;764:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Mute timings&lt;/codeph&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:163;766:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana 提供按特定的时间段收到告警消息的功能，由 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:153;766:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Mute timings&lt;/codeph&gt; 组件实现。点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:154;766:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Add mute timing&lt;/codeph&gt;，进入如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-16.png&#34; placement=&#34;break&#34; xtrc=&#34;image:67;768:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1333&#34; dita-ot:image-height=&#34;782&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:164;770:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;设定 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:155;770:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;name&lt;/codeph&gt; 字段为工作时间。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:156;770:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Time range&lt;/codeph&gt; 含义：只有在此时间段产生的告警消息才会发送给用户。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:157;770:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Days of week&lt;/codeph&gt; 含义：一周中的哪几天用户希望能收到告警消息。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;silences-模块&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;772:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;772:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:158;772:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Silences&lt;/codeph&gt; 模块&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;772:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:165;774:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;该模块主要作用为，设置某些告警规则为静默状态，即不让这些规则发送告警消息，即便它满足告警消息的发送条件。如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-17.png&#34; placement=&#34;break&#34; xtrc=&#34;image:68;776:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1294&#34; dita-ot:image-height=&#34;430&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:166;778:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:159;778:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;New Silence&lt;/codeph&gt; 添加静默，进入如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-18.png&#34; placement=&#34;break&#34; xtrc=&#34;image:69;780:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;839&#34; dita-ot:image-height=&#34;582&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:167;782:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:160;782:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Matching labels&lt;/codeph&gt; 模块通过标签筛选出告警规则，使所选规则在静默时间内处于静默状态。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:161;782:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Silence start and end&lt;/codeph&gt; 为静默时间。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;钉钉告警与预警&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;784:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;784:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;钉钉告警与预警&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;784:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:168;786:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;使用钉钉接收告警、预警消息时，要先在钉钉群聊里添加群聊机器人，如下所示&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-19.png&#34; placement=&#34;break&#34; xtrc=&#34;image:70;788:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1524&#34; dita-ot:image-height=&#34;805&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:169;790:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:162;790:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;群设置--&amp;gt;智能群助手&lt;/codeph&gt;，出现如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-20.png&#34; xtrc=&#34;image:71;792:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;467&#34; dita-ot:image-height=&#34;472&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:170;794:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:163;794:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;添加机器人&lt;/codeph&gt;,出现如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-21.png&#34; xtrc=&#34;image:72;796:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;686&#34; dita-ot:image-height=&#34;551&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:171;798:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;选择&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:164;798:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;自定义&lt;/codeph&gt;，跳转到如下页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-22.png&#34; xtrc=&#34;image:73;800:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;679&#34; dita-ot:image-height=&#34;546&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:172;802:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:165;802:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;安全设置&lt;/codeph&gt;选择IP地址段，输入你的 Grafana 所在的公网 IP，点击确定后出现如下所示界面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-23.png&#34; xtrc=&#34;image:74;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;672&#34; dita-ot:image-height=&#34;540&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:173;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;将&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:166;806:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Webhook&lt;/codeph&gt;复制下来，后面需要用到。然后回到 Grafana Alerting 页面，去 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:167;806:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Contact points&lt;/codeph&gt; 模块里点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:168;806:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;New contact point&lt;/codeph&gt;，进入如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-24.png&#34; placement=&#34;break&#34; xtrc=&#34;image:75;808:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1231&#34; dita-ot:image-height=&#34;753&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:174;810:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;命名为叫钉钉告警，然后 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:169;810:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;contact point type&lt;/codeph&gt; 选择 DingDing。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:170;810:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;URL&lt;/codeph&gt; 里填入你刚刚复制的 webhook。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:171;810:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Message Type&lt;/codeph&gt; 有 Link 和 ActionCard 两种选择，这里选择了 Link。选择 Link 后，告警消息将以链接的方式发送到钉钉群里，点击链接会跳转到 Grafana 界面。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-25.png&#34; xtrc=&#34;image:76;812:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;582&#34; dita-ot:image-height=&#34;167&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:175;814:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;选择 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:172;814:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;ActionCard&lt;/codeph&gt;，告警消息将以消息的样式发到钉钉群里，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-26.png&#34; xtrc=&#34;image:77;816:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;510&#34; dita-ot:image-height=&#34;611&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:176;818:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;设置好 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:173;818:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Contact point&lt;/codeph&gt; 后，还要设置 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:174;818:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Notification policies&lt;/codeph&gt;。如果之前已经设置了告警消息的默认接收者，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-27.png&#34; placement=&#34;break&#34; xtrc=&#34;image:78;820:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1330&#34; dita-ot:image-height=&#34;608&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:177;822:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上图已经将邮件作为默认接收者，需要先按照4.4节操作将钉钉设置为消息发送渠道，然后在标签匹配中将所有的告警规则都匹配上，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-28.png&#34; placement=&#34;break&#34; xtrc=&#34;image:79;824:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;835&#34; dita-ot:image-height=&#34;564&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:178;826:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;如果只是简单的在下面的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:175;826:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;New specific policy&lt;/codeph&gt; 里添加钉钉，那么邮件将收不到告警消息。此时需要将邮件也加入到消息消息发送路径里，这样钉钉群和邮件都能收到告警。如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-29.png&#34; placement=&#34;break&#34; xtrc=&#34;image:80;828:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1336&#34; dita-ot:image-height=&#34;128&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;prometheusalertmanager-企业微信告警与预警&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;830:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;830:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Prometheus+Alertmanager 企业微信告警与预警&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;830:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;alertmanager-部署与配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:28;832:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:28;832:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alertmanager 部署与配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:28;832:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:179;834:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Grafana 目前不支持企业微信告警与预警，需要部署 Prometheus 的 &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://prometheus.io/download/&#34; scope=&#34;external&#34; xtrc=&#34;xref:14;834:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;?ditaot usertext?&gt;Alertmanager&lt;/xref&gt;进行企业微信告警。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:180;836:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;先将 Alertmanager 部署到 Prometheus 所在服务器中。然后在企业微信生成一个专用于告警的应用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:181;838:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;进入企业微信管理后台，点击&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:176;838:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;应用管理--&amp;gt;创建应用&lt;/codeph&gt;如图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-30.png&#34; xtrc=&#34;image:81;840:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1197&#34; dita-ot:image-height=&#34;848&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:182;842:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;进入如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-31.png&#34; xtrc=&#34;image:82;844:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1093&#34; dita-ot:image-height=&#34;699&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:183;846:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;上传应用图片，给应用取一个名字，并选择应用可见范围（必须设置），创建完成后，进入如下所示页面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-32.png&#34; xtrc=&#34;image:83;848:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1166&#34; dita-ot:image-height=&#34;921&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:184;850:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;先将 AgentId 和 Secret 记录下来，然后再配置企业可信 IP，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-33.png&#34; xtrc=&#34;image:84;852:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1365&#34; dita-ot:image-height=&#34;889&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:185;854:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;点击：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-34.png&#34; xtrc=&#34;image:85;856:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;602&#34; dita-ot:image-height=&#34;395&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:186;858:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;填入 Prometheus 和 Aertmanager 部署的服务器的公网 IP，然后点击&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:177;858:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;通讯录&lt;/codeph&gt;，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-35.png&#34; xtrc=&#34;image:86;860:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1116&#34; dita-ot:image-height=&#34;695&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:187;862:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;获取到你要接收信息的部门的部门 ID，并记录。最后点击&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:178;862:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;我的企业&lt;/codeph&gt;，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-36.png&#34; xtrc=&#34;image:87;864:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1100&#34; dita-ot:image-height=&#34;841&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:188;866:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;获取企业 ID，并记录。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:189;868:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;获取了企业 ID，部门 ID，应用 ID，Secret 后，就可以配置 Alertmanager 了。在 Alertmanager 安装目录下找到 alertmanager.yml，将里面的内容全部删除，输入以下内容，若不存在，可以手动创建一个：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;870:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;global: resolve_timeout: 1m templates: - '/home/appadmin/monitor/alertmanager/alertmanager-0.24.0.linux-amd64/template/wechat.tmpl' #企业微信告警消息模板地址 route: receiver: 'wechat' #下面 receivers 设置的接收者名称 group_by: ['alertname'] group_wait: 30s # 这三个的概念和前面 Grafana 里的概念一样 group_interval: 1m repeat_interval: 10m receivers: - name: 'wechat' wechat_configs: - corp_id: 'ww68d468fe12810853' #企业 ID to_party: '38' #部门 ID agent_id: '1000015' #应用 ID api_secret: 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' #Secret send_resolved: true #是否发送告警恢复&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:190;895:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;然后再更改 prometheus.yml，输入以下内容：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;897:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;# Alertmanager configuration alerting: alertmanagers: - static_configs: - targets: [&#34;xxxxxxxx:xxx&#34;] #alertmanager 的 IP 地址和端口号 rule_files: - &#34;rules/node_alerts.yml&#34; #告警规则的存放路径&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:191;908:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;之后在 Prometheus 安装目录里新建一个 rules 文件夹，在 rules 文件夹里新建一个 node_alerts.yml 文件，该文件就是告警规则，需要在该文件下编写你的告警规则，以磁盘空间使用率为例：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;910:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;groups: - name: &#34;servers monitor&#34; rules: - alert: &#34;diskUsage&#34; #服务器磁盘空间使用率 expr: (1-sum(node_filesystem_avail_bytes{mountpoint =~&#34;/hdd.*?|/ssd.*?|/home.*?&#34;})by (instance,mountpoint)/sum(node_filesystem_size_bytes{mountpoint =~&#34;/hdd.*?|/ssd.*?|/home.*?&#34;})by(instance,mountpoint))*100&amp;gt;90 for: 5m labels: status: warning annotations: summary: &#34;{{$labels.instance}} {{$labels.mountpoint}}: High disk Usage Detected&#34; description: &#34;{{$labels.instance}} {{$labels.mountpoint}} disk Usage is: {{$value}}%, above 90%&#34; &lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:192;924:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;最后在 Alertmanager 安装目录下新建一个 template 文件夹，在 template 文件夹里新建一个 wechat.tmpl 文件，该文件就是消息模板，在其中输入以下内容：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;926:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;{{ define &#34;wechat.default.message&#34; }} {{- if gt (len .Alerts.Firing) 0 -}} {{- range $index, $alert := .Alerts -}} {{- if eq $index 0 }} ========= 监控报警 ========= 告警状态：{{ .Status }} 告警类型：{{ $alert.Labels.alertname }} 故障主机: {{ $alert.Labels.instance }} 告警主题: {{ $alert.Annotations.summary }} 告警详情: {{ $alert.Annotations.message }}{{ $alert.Annotations.description}} 故障时间: {{ ($alert.StartsAt.Add 28800e9).Format &#34;2006-01-02 15:04:05&#34; }} ========= = end = ========= {{- end }} {{- end }} {{- end }} {{- if gt (len .Alerts.Resolved) 0 -}} {{- range $index, $alert := .Alerts -}} {{- if eq $index 0 }} ========= 异常恢复 ========= 告警类型：{{ .Labels.alertname }} 告警状态：{{ .Status }} 告警主题: {{ $alert.Annotations.summary }} 告警详情: {{ $alert.Annotations.message }}{{ $alert.Annotations.description}} 故障时间: {{ ($alert.StartsAt.Add 28800e9).Format &#34;2006-01-02 15:04:05&#34; }} 恢复时间: {{ ($alert.EndsAt.Add 28800e9).Format &#34;2006-01-02 15:04:05&#34; }} {{- if gt (len $alert.Labels.instance) 0 }} 实例信息: {{ $alert.Labels.instance }} {{- end }} ========= = end = ========= {{- end }} {{- end }} {{- end }} {{- end }}&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:193;962:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;以上，就完成了企业微信告警的配置。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;启动企业微信告警&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:29;964:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:29;964:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;启动企业微信告警&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:29;964:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:194;966:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;重启 Prometheus，然后进入 alertmanager 安装目录，运行以下代码启动 alertmanager：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;968:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;nohup ./alertmanager --config.file=alertmanager.yml --web.listen-address=&#34;:9093&#34; --cluster.listen-address=localhost:9095 &amp;amp;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:195;972:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;其中，--config.file 指定 alertmanager 的配置文件，--web.listen-address 指定 alertmanager 的运行端口，这里设置为9093，--cluster.listen-address 指定集群端口，默认值为9094，若默认端口被占用，则需指定一个未被占用的端口。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:196;974:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;启动了 alertmanager 之后，在浏览器地址栏输入 Prometheus 的 IP 和端口，进入 prometheus，然后点击 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:179;974:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;Alerts&lt;/codeph&gt;，就会出现如下所示界面：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-37.png&#34; placement=&#34;break&#34; xtrc=&#34;image:88;976:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;1159&#34; dita-ot:image-height=&#34;319&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:197;978:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;表示告警规则创建成功了。触发告警规则后，企业微信收到的信息样式如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/cluster_monitor/5-38.png&#34; xtrc=&#34;image:89;980:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34; dita-ot:image-width=&#34;629&#34; dita-ot:image-height=&#34;326&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:198;982:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/cluster_monitor.md&#34;&gt;至此，企业微信告警部署完毕，用户可根据上述步骤开启 DolphinDB 集群监控的企业微信告警。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/cluster_monitor.md"/><meta name="wh-out-relpath" content="tutorials/cluster_monitor.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="集群运维监控" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="chap7_tutorials_system_management"><div class="title"><a href="../sys_man/om_intro.html"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li><div class="topicref" data-id="性能监控"><div class="title"><a href="../sys_man/perf_man.html"><span class="keyword label">运维监控</span></a></div></div></li><li class="active"><div class="topicref" data-id="集群运维监控"><div class="title"><a href="../tutorials/cluster_monitor.html">集群运维监控</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="cluster_manage-d9713e7993" class="topicref" data-id="cluster_manage" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action cluster_manage-d9713e7993-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/cluster_manage.html" id="cluster_manage-d9713e7993-link">集群管理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e8269" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e8269-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/thread_intro.html" id="tocId-d9713e8269-link">任务管理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="e6_97_a0_e6_a0_87_e9_a2_9810-d9713e8454" class="topicref" data-id="e6_97_a0_e6_a0_87_e9_a2_9810" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action e6_97_a0_e6_a0_87_e9_a2_9810-d9713e8454-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/e6_97_a0_e6_a0_87_e9_a2_9810.html" id="e6_97_a0_e6_a0_87_e9_a2_9810-d9713e8454-link">登录管理</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="性能监控-d9713e8546" class="topicref" data-id="性能监控" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action 性能监控-d9713e8546-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/perf_man.html" id="性能监控-d9713e8546-link"><span class="keyword label">运维监控</span></a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" class="active"><div data-tocid="集群运维监控-d9713e8593" class="topicref" data-id="集群运维监控" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cluster_monitor.html" id="集群运维监控-d9713e8593-link">集群运维监控</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e8639" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e8639-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/bak_resto.html" id="tocId-d9713e8639-link">安全与容灾</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">集群运维监控</h1><div class="- topic/body body"><p class="- topic/p p">在读写、查询等高并发场景中，了解资源的使用情况能快速定位性能的瓶颈所在。本教程提供对多（或单）服务器及 DolphinDB 高可用集群（或单节点）资源的监控、告警、预警方案。本教程使用开源软件 Prometheus, Grafana 及对应的 dolphindb-datasource 插件来实现监控方案。如果读者对这些软件非常了解并已经部署好相应的软件，可跳过前两章的安装教程，直接使用第三章的 json 文件监控集群。</p><p class="- topic/p p">本教程假定读者已经搭建好 DolphinDB 服务。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="监控方案概述"><h2 class="- topic/title title topictitle2" id="ariaid-title2">监控方案概述</h2><div class="- topic/body body"><p class="- topic/p p">本套教程实现了以下三套监控方案：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">第一套：NodeExporter + Prometheus + Grafana 监控服务器资源</p><br/><img class="- topic/image image" src="images/cluster_monitor/1-1.png"/><br/></li></ul><p class="- topic/p p">本方案主要用于监控服务器资源使用情况，如 CPU 频率信息、内存占用信息、磁盘 IO 信息、网络 IO 信息等。本方案由 NodeExporter 采集服务器指标，Prometheus 定时抓取，再由 Grafana 对 Prometheus 采集的资源信息进行可视化展示。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">第二套：DolphinDB + Prometheus + Grafana 监控 DolphinDB 资源</p><br/><img class="- topic/image image" src="images/cluster_monitor/1-2.png"/><br/></li></ul><p class="- topic/p p">本方案主要用于监控 DolphinDB 进程对服务器资源的使用情况及 DolphinDB 性能，如 DolphinDB 进程 CPU 占用情况、DolphinDB 进程内存占用情况、DolphinDB 进程磁盘资源使用情况等。DolphinDB 内置了相应的运维函数以获取当前节点的资源使用情况，Prometheus 可以抓取到这些指标。本方案中 Prometheus 定时从 DolphinDB 抓取相关指标，再由 Grafana 对 Prometheus 采集的指标信息进行可视化展示。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">第三套：dolphindb-datasource 插件+ Grafana 监控 DolphinDB 集群节点状态</p><br/><img class="- topic/image image" src="images/cluster_monitor/1-3.png"/><br/></li></ul><p class="- topic/p p">本方案主要用于监控 DolphinDB 集群的节点状态、流数据表状态以及订阅状态。DolphinDB 开发了 Grafana 数据源插件 (dolphindb-datasource)，让用户在 Grafana 面板 (dashboard) 上通过编写查询脚本，与 DolphinDB 进行交互 (基于 WebSocket)，实现 DolphinDB 数据的可视化。本方案中，Grafana 直接连接 DolphinDB 服务，使用查询脚本直接展示数据库信息。</p><p class="- topic/p p">上述三套方案互不依赖，可以根据需要安装必须的软件。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="软件安装部署"><h2 class="- topic/title title topictitle2" id="ariaid-title3">软件安装部署</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="nodeexporter-部署"><h3 class="- topic/title title topictitle3" id="ariaid-title4">NodeExporter 部署</h3><div class="- topic/body body"><p class="- topic/p p">NodeExporter 是 Prometheus 提供的一个可以采集到服务器信息的应用程序，它能采集到服务器的 CPU、内存、磁盘、网络等信息，<a class="- topic/xref xref" href="https://prometheus.io/download/" target="_blank" rel="external noopener">点击官网链接</a>下载对应版本软件包：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-1.png"/><br/><p class="- topic/p p">将其拖拽到服务器上解压，解压后进入对应的安装目录运行 NodeExporter,可通过 <code class="+ topic/ph pr-d/codeph ph codeph">web.listen-address</code> 指定端口：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>$ nohup ./node_exporter --web.listen-address IP:Port &amp;</code></pre><p class="- topic/p p">访问 <code class="+ topic/ph pr-d/codeph ph codeph">http://IP:Port/metrics</code>,可看到当前 NodeExporter 获取到的当前服务器的所有监控数据，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-2.png"/><br/><p class="- topic/p p">其中，<code class="+ topic/ph pr-d/codeph ph codeph">HELP</code> 用于解释当前指标的含义，<code class="+ topic/ph pr-d/codeph ph codeph">TYPE</code> 则用于说明指标名称及指标类型，比如：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code># TYPE node_cpu_seconds_total counter</code></pre><p class="- topic/p p">说明 node_cpu_seconds_total 的数据类型是计数器（counter）。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="prometheus-部署"><h3 class="- topic/title title topictitle3" id="ariaid-title5">Prometheus 部署</h3><div class="- topic/body body"><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">在上述监控方案中，Prometheus 负责从数据源定时抓取数据。安装 <a class="- topic/xref xref" href="https://prometheus.io/download/" target="_blank" rel="external noopener">Prometheus Server</a>，下载对应版本的软件包：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-3.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">将其拖拽到服务器上解压，可看到如下目录结构：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-4.png"/><br/><p class="- topic/p p">其中，data 是数据的存储路径，prometheus.yml 是 Prometheus 的配置文件，启动 Prometheus 服务时，会默认加载当前路径下的 prometheus.yml 文件，若配置文件不在当前目录下，可通过 <code class="+ topic/ph pr-d/codeph ph codeph">--config.file</code> 指定。</p><p class="- topic/p p">进入 Prometheus 安装目录，通过以下命令后台启动 Prometheus 服务：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>$ nohup ./prometheus --config.file=prometheus.yml &amp;</code></pre></li><li class="- topic/li li"><p class="- topic/p p">在浏览器地址栏输入 <code class="+ topic/ph pr-d/codeph ph codeph">http://IP:Port</code> 可进入 prometheus UI 界面：</p><img class="- topic/image image" src="images/cluster_monitor/2-5.png"/><br/><p class="- topic/p p">上图中1为命令行，可在其中输入 PromQL 语句进行查询，不仅支持简单的指标查询，还可以对指标进行运算；2为指标的展示形式，可将指标展示为图或表，所有指标都可以以表的形式展示，部分指标可以以图的方式展示；3为展示指标的的时间范围。</p><p class="- topic/p p">DolphinDB 服务、Prometheus 服务和 NodeExporter 服务已启动，但此时 Prometheus 抓取不到数据，还需配置 prometheus.yml 文件，将服务器中部署的 NodeExporter 和 DolphinDB 连接到 Prometheus 上，让其定时拉取 NodeExporter 的数据和 DolphinDB 暴露的指标。</p></li><li class="- topic/li li"><p class="- topic/p p">编辑 prometheus.yml 并在 <code class="+ topic/ph pr-d/codeph ph codeph">scrape_configs</code> 模块下添加 NodeExporter 的端口信息，用于 Prometheus 定时抓取 NodeExporter 中的数据:</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>  # 用于抓取服务器资源使用信息 对应第一套方案          
  - job_name: "服务器名称"
    static_configs:
      - targets: ["xxxxxxxx:xxx"] #IP:NodeExporter端口</code></pre></li><li class="- topic/li li"><p class="- topic/p p">对于 DolphinDB 集群的监控，不论是高可用集群还是普通集群，亦或是单节点，需将所有节点的端口信息添加到 <code class="+ topic/ph pr-d/codeph ph codeph">scrape_configs</code> 中，以3个控制节点、3个代理节点、3个数据节点的高可用集群为例，在 prometheus.yml 中的 <code class="+ topic/ph pr-d/codeph ph codeph">scrape_configs</code> 模块下添加以下内容:</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>  # 用于抓取 DolphinDB 集群对服务器资源的使用情况 对应第二套方案   
  - job_name: "controlnode1"
    static_configs:
      - targets: ["xxxxxxxx:xxx"]#IP:controlnode1端口

  - job_name: "controlnode2"
    static_configs:
      - targets: ["xxxxxxxx:xxx"]#IP:controlnode2端口

  - job_name: "controlnode3"
    static_configs:
      - targets: ["xxxxxxxx:xxx"]#IP:controlnode3端口

  - job_name: "agentnode1"
    static_configs:
      - targets: ["xxxxxxxx:xxx"]#IP:agentnode1端口

  - job_name: "agentnode2"
    static_configs:
      - targets: [""xxxxxxxx:xxx""]#IP:agentnode2端口

  - job_name: "agentnode3"
    static_configs:
      - targets: [""xxxxxxxx:xxx""]#IP:agentnode3端口

  - job_name: "datanode1"
    static_configs:
      - targets: [""xxxxxxxx:xxx""]#IP:datanode1端口

  - job_name: "datanode2"
    static_configs:
      - targets: [""xxxxxxxx:xxx""]#IP:datanode2端口

  - job_name: "datanode3"
    static_configs:
      - targets: ["xxxxxxxx:xxx"]#IP:datanode3端口</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：部署 Prometheus 时，要检查配置文件中默认的端口是否被占用，若端口被占用，要更改对应的设置。Prometheus 默认端口为9090，若被占用，要在 prometheus.yml 中的 <code class="+ topic/ph pr-d/codeph ph codeph">scrape_configs</code> 中找到 <code class="+ topic/ph pr-d/codeph ph codeph">job_name</code> 为 prometheus 的选项，然后再更改其下方的 <code class="+ topic/ph pr-d/codeph ph codeph">targets</code> 后面的端口。</p></li><li class="- topic/li li"><p class="- topic/p p">配置完数据源后，必须重启 Prometheus 服务。重启 Prometheus 服务后，在 Prometheus UI 界面输入 <code class="+ topic/ph pr-d/codeph ph codeph">up</code> 命令，检查配置是否生效【1表示正常；0表示未生效，一般情形下是由于数据源未启动导致的，可检查端口是否被占用】：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-6.png"/><br/></li></ol></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="grafana-部署"><h3 class="- topic/title title topictitle3" id="ariaid-title6">Grafana 部署</h3><div class="- topic/body body"><p class="- topic/p p">Prometheus 提供了快速验证 PromQL 以及临时可视化支持的功能，但其可视化功能较弱。<a class="- topic/xref xref" href="https://grafana.com/grafana/download" target="_blank" rel="external noopener">Grafana</a> 提供了强大的可视化功能，只需配置好 Prometheus 数据源，便能实现对 Prometheus 的可视化。从官网上下载对应版本的软件包（本教程使用的版本为9.0.5）：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-7.png"/><br/><p class="- topic/p p">将其拖拽到服务器上解压，解压后进入对应的 bin 目录并运行 Grafana</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>$ nohup ./grafana-server web &amp;</code></pre><p class="- topic/p p">访问 <code class="+ topic/ph pr-d/codeph ph codeph">http://IP:Port</code>，进入到 Grafana 登录页面：</p><img class="- topic/image image" src="images/cluster_monitor/2-8.png"/><br/><p class="- topic/p p">Grafana 默认端口为3000，若要更改端口，需在 conf 文件夹下的 defaults.ini 中的 <code class="+ topic/ph pr-d/codeph ph codeph">[server]</code> 中更改 <code class="+ topic/ph pr-d/codeph ph codeph">http_port</code> 选项。默认的账号密码是 admin/admin，登录成功后如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/2-9.png"/><br/><p class="- topic/p p">登录 Grafana 后，还需两个步骤便能实现监控可视化。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">步骤1：配置数据源</strong></p><p class="- topic/p p">通过 <code class="+ topic/ph pr-d/codeph ph codeph">Configuration--&gt;Data sources</code>，进入数据源添加界面，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-10.png"/><br/><p class="- topic/p p">点击 <code class="+ topic/ph pr-d/codeph ph codeph">Add data source</code> 添加数据源</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-11.png"/><br/><p class="- topic/p p">选择 <code class="+ topic/ph pr-d/codeph ph codeph">Prometheus</code> 数据源，进入以下配置数据源页面</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-12.png"/><br/><p class="- topic/p p">在 <code class="+ topic/ph pr-d/codeph ph codeph">URL</code> 上配置 Prometheus 对应的IP和端口（其他选项设置默认），然后点击下方的 <code class="+ topic/ph pr-d/codeph ph codeph">Save&amp;test</code>，若出现了 Data source is working 就说明数据源连接成功（若连接失败，检查Prometheus端口是否被占用）。</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-13.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">步骤2：配置面板</strong></p><p class="- topic/p p">在 Grafana 中有 Dashboard 和 Panel 的概念。</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-14.png"/><br/><p class="- topic/p p">如上图所示，点击 <code class="+ topic/ph pr-d/codeph ph codeph">Dashboards --&gt; New dashboard</code> 创建一个 Dashboard，进入如下界面：</p><img class="- topic/image image" src="images/cluster_monitor/2-15.png"/><br/><p class="- topic/p p">然后点击 <code class="+ topic/ph pr-d/codeph ph codeph">Add a new panel</code> 创建图表，进入如下界面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-16.png"/><br/><p class="- topic/p p">上图中：</p><ul class="- topic/ul ul"><li class="- topic/li li">1 为数据源，选择 <code class="+ topic/ph pr-d/codeph ph codeph">Prometheus</code>；</li><li class="- topic/li li">2 为查询方式，建议选择 <code class="+ topic/ph pr-d/codeph ph codeph">code</code>；</li><li class="- topic/li li">3 为查询语句，输入要查询的内容，这里不仅支持简单指标查询，也支持指标之间的运算；</li><li class="- topic/li li">4 为时间范围；</li><li class="- topic/li li">5 为展示方式，有 <code class="+ topic/ph pr-d/codeph ph codeph">Table</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">Graph</code> 两种选择；</li><li class="- topic/li li">6 为运行查询，测试查询结果是否符合预期；</li><li class="- topic/li li">7 为图表的标题；</li><li class="- topic/li li">8 为保存按钮。</li></ul><p class="- topic/p p">以下以服务器 CPU 使用率为例，说明如何使查询指标并进行可视化：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code># 从 NodeExporter 获取 CPU 使用率(%)
(1-sum(rate(node_cpu_seconds_total{mode="idle"}[1m])) by (job) / sum(rate(node_cpu_seconds_total[1m])) by (job)) *100</code></pre><p class="- topic/p p">在查询语句栏中输入上述代码，点击 <code class="+ topic/ph pr-d/codeph ph codeph">Run queries</code>，便可以获取 CPU 的使用率。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="dolphindb-datasource-插件安装"><h3 class="- topic/title title topictitle3" id="ariaid-title7">dolphindb-datasource 插件安装</h3><div class="- topic/body body"><p class="- topic/p p">本教程的第三套方案的实现依赖 dolphindb-datasource 插件。dolphindb-datasource 插件可以连接到 DolphinDB，用户可在 dolphindb-datasource 插件上编写代码查询需要展示的数据，或者调用系统运维函数获取运维监控数据。点击<a class="- topic/xref xref" href="https://github.com/dolphindb/grafana-datasource/releases" target="_blank" rel="external noopener">链接</a>，进入下载页面，下载最新版本的 dolphindb-datasource 插件：</p><img class="- topic/image image" src="images/cluster_monitor/2-17.png"/><br/><p class="- topic/p p">下载压缩包后，将其拖拽到服务器 Grafana 安装目录下的 data/plugins/ 目录下解压，如果不存在 Plugins 目录，需手动创建该文件夹，然后将压缩包解压到此目录下。</p><p class="- topic/p p">然后需要修改 Grafana 的配置文件，在 <code class="+ topic/ph pr-d/codeph ph codeph">/grafana/conf/</code> 目录下找到 <code class="+ topic/ph pr-d/codeph ph codeph">defaults.ini</code> 文件，编辑该文件，找到 <code class="+ topic/ph pr-d/codeph ph codeph">[plugins]</code>，做以下修改:</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>allow_loading_unsigned_plugins = dolphindb-datasource</code></pre><img class="- topic/image image" src="images/cluster_monitor/2-18.png"/><br/><p class="- topic/p p">修改配置文件之后，需要重启Grafana服务。重启后，在Grafana中添加dolphindb-datasource数据源，在搜索框输入<code class="+ topic/ph pr-d/codeph ph codeph">DolphinDB</code>，然后点击下方出现的结果，如下图所示：</p><img class="- topic/image image" src="images/cluster_monitor/2-20.png"/><br/><p class="- topic/p p">点击该数据源，进入配置页面，如下图所示：</p><img class="- topic/image image" src="images/cluster_monitor/2-21.png"/><br/><p class="- topic/p p">其中，</p><ul class="- topic/ul ul"><li class="- topic/li li">1 为该数据源名称；</li><li class="- topic/li li">2 为监控的 DolphinDB 节点的 IP 和端口号；</li><li class="- topic/li li">3 和 4 分别为该 DolphinDB 节点的登录名和密码；</li><li class="- topic/li li">5 为保存按钮。点击 <code class="+ topic/ph pr-d/codeph ph codeph">Save &amp;test</code> 出现如下提示，表明成功连接到 DolphinDB：</li></ul><img class="- topic/image image" src="images/cluster_monitor/2-22.png"/><br/><p class="- topic/p p">后面就可以使用配置好的数据源，通过编写脚本对 DolphinDB 集群进行监控。如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/2-23.png"/><br/><p class="- topic/p p">在 <code class="+ topic/ph pr-d/codeph ph codeph">Data source</code> 里选择配置好的 <code class="+ topic/ph pr-d/codeph ph codeph">DolphinDB-test</code>，之后会进入一个脚本编辑界面，如下图所示：</p><img class="- topic/image image" src="images/cluster_monitor/2-24.png"/><br/><p class="- topic/p p">在该界面输入 DolphinDB 的脚本，查询需要的指标。编辑完成之后，编写完成后按 <code class="+ topic/ph pr-d/codeph ph codeph">ctrl + s</code> 保存，或者点击页面中的刷新按钮 (<code class="+ topic/ph pr-d/codeph ph codeph">Refresh dashboard</code>)，可以将查询发到 DolphinDB 数据库运行并展示出图表。上述案例脚本如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>temp = getClusterPerf(includeMaster=true)
t = select  host,port,mode,state,name,maxMemSize,runningTasks,queuedTasks,runningJobs,queuedJobs,connectionNum from temp
mapper1 = dict(0 1 2 3 4,["datanode","agentnode","controlnode","singlemode","computenode"])
mapper2 = dict(0 1,["unsurvive","survive"])
tempvalue1 = t.mode
tempvalue2 = t.state
finalvalue1 = mapper1[tempvalue1]
finalvalue2 = mapper2[tempvalue2]
replaceColumn!(t,`mode,finalvalue1)
replaceColumn!(t,`state,finalvalue2)
select * from t</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：返回的结果的形式必须为一张表。若想将结果展示为 Graph，可以点击右侧的 <code class="+ topic/ph pr-d/codeph ph codeph">Visualizations</code>，点击红色方框处下拉列表，选择 <code class="+ topic/ph pr-d/codeph ph codeph">Time series</code>，如下图所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/2-25.png"/><br/></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="监控方案实现"><h3 class="- topic/title title topictitle3" id="ariaid-title8">监控方案实现</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title9" id="监控指标体系及其计算公式"><h4 class="- topic/title title topictitle4" id="ariaid-title9">监控指标体系及其计算公式</h4><div class="- topic/body body"><p class="- topic/p p">第一套监控方案指标体系如下表所示：</p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">指标类别</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">具体指标</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">Grafana数据源</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">Prometheus数据源</strong></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">CPU</td><td class="- topic/entry entry colsep-0 rowsep-0">CPU使用率</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">NodeExporter</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">磁盘</td><td class="- topic/entry entry colsep-0 rowsep-0">磁盘容量、磁盘空间使用率、磁盘 IO</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">NodeExporter</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">网络</td><td class="- topic/entry entry colsep-0 rowsep-0">网络IO</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">NodeExporter</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">内存</td><td class="- topic/entry entry colsep-0 rowsep-0">内存使用率</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">NodeExporter</td></tr></tbody></table></div><p class="- topic/p p">第二套监控方案指标体系如下表所示：</p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">指标类别</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">具体指标</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">Grafana数据源</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">Prometheus数据源</strong></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">CPU</td><td class="- topic/entry entry colsep-0 rowsep-0">CPU 使用率</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">DolphinDB Server</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">磁盘</td><td class="- topic/entry entry colsep-0 rowsep-0">磁盘容量、磁盘空间使用率、磁盘 IO</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">DolphinDB Server</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">网络</td><td class="- topic/entry entry colsep-0 rowsep-0">网络 IO</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">DolphinDB Server</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">内存</td><td class="- topic/entry entry colsep-0 rowsep-0">内存使用率</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">DolphinDB Server</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">数据库性能</td><td class="- topic/entry entry colsep-0 rowsep-0">正在运行的 Tasks/Jobs数、查询平均耗时</td><td class="- topic/entry entry colsep-0 rowsep-0">Prometheus</td><td class="- topic/entry entry colsep-0 rowsep-0">DolphinDB Server</td></tr></tbody></table></div><p class="- topic/p p">第三套监控方案指标体系如下所示</p><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">指标类别</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">具体指标</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">Grafana数据源</strong></td><td class="- topic/entry entry colsep-0 rowsep-0"><strong class="+ topic/ph hi-d/b ph b">Prometheus数据源</strong></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">节点状态</td><td class="- topic/entry entry colsep-0 rowsep-0">节点状态、流数据表状态、订阅状态</td><td class="- topic/entry entry colsep-0 rowsep-0">dolphindb-datasource</td><td class="- topic/entry entry colsep-0 rowsep-0">————</td></tr></tbody></table></div><p class="- topic/p p">上述三套监控指标体系中每个指标的计算公式如下：</p><p class="- topic/p p">第一套监控方案指标计算公式</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>#--------------------CPU-----------------------------#
#服务器cpu使用率（%）
(1-sum(rate(node_cpu_seconds_total{mode="idle"}[1m])) by (job) / sum(rate(node_cpu_seconds_total[1m])) by (job)) *100

#--------------------内存-----------------------------#
#服务器内存使用率（%）
(node_memory_MemTotal_bytes - (node_memory_MemFree_bytes + node_memory_Buffers_bytes+node_memory_Cached_bytes ))/node_memory_MemTotal_bytes * 100

#--------------------磁盘容量-----------------------------#
#服务器磁盘空间使用率(%)
(1 - sum(node_filesystem_free_bytes)by(job) / sum(node_filesystem_size_bytes) by(job))*100

#服务器磁盘挂载点空间使用率(%)
(1-sum(node_filesystem_free_bytes{mountpoint =~"/hdd.*?|/ssd.*?|/home.*?"})by (job,mountpoint)/sum(node_filesystem_size_bytes{mountpoint =~"/hdd.*?|/ssd.*?|/home.*?"})by(job,mountpoint))*100

#--------------------磁盘 IO-----------------------------#
#服务器各磁盘读速率(MB/s)
irate(node_disk_read_bytes_total{device=~'sd[a-z]'}[1m])/1024/1024

#服务器各磁盘写速率(MB/s)
irate(node_disk_written_bytes_total{device=~"sd[a-z]"}[1m])/1024/1024

#--------------------网络-----------------------------#
#服务器网络发送速率(MB/s)
sum(irate(node_network_transmit_bytes_total[1m]))by(job)/1024/1024

#服务器网络接收速率(MB/s)
sum(irate(node_network_receive_bytes_total[1m]))by(job)/1024/102

#服务器每块网卡发送速率(MB/s)
irate(node_network_transmit_bytes_total[1m])/1024/1024

#服务器每块网卡接收速率(MB/s)
irate(node_network_reveive_bytes_total[1m])/1024/1024</code></pre><p class="- topic/p p">第二套监控方案指标计算公式</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>#--------------------CPU-----------------------------#
# CPU 使用率(%)
cpuUsage

#--------------------内存-----------------------------#
#节点内存占用(MB)
memoryUsed/1024/1024

#--------------------磁盘-----------------------------#
#节点所在磁盘空间使用率(%)
(1-diskFreeSpace/diskCapacity)*100

#节点所在磁盘读速率(MB/s)
diskReadRate/1024/1024

#节点所在磁盘写速率(MB/s)
diskWriteRate/1024/1024

#--------------------网络-----------------------------#
#节点网络发送速率(MB/s)
networkSendRate/1024/1024

#节点网络接收速率(MB/s)
networkRecvRate/1024、1024

#--------------------高可用集群性能-----------------------------#
#节点前10个完成的查询执行所耗费时间的中间值（ms）
maxLast10QueryTime/1000000

#节点当前正在执行的查询的最大耗时(ms)
maxRunningQueryTime/1000000

#节点正在执行 Job 数
runningJobs

#节点等待执行 Job 数
queuedJobs

#节点 CPU 平均负载(%)
avgLoad

#节点作业负载(%)
jobLoad

#--------------------高可用集群状态-----------------------------#
#节点与 Prometheus 的连接状态
up{=~"[^0-9].*?[0-9]}</code></pre><p class="- topic/p p">第三套监控方案指标计算公式</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>#流数据表状态
getStreamingStat().pubTables

#订阅状态
getStreamingStat().subWorkers

#节点状态
temp = getClusterPerf(includeMaster=true)
t = select  host,port,mode,state,name,maxMemSize,runningTasks,queuedTasks,runningJobs,queuedJobs,connectionNum from temp
mapper1 = dict(0 1 2 3 4,["datanode","agentnode","controlnode","singlemode","computenode"])
mapper2 = dict(0 1,["未存活","存活"])
tempvalue1 = t.mode
tempvalue2 = t.state
finalvalue1 = mapper1[tempvalue1]
finalvalue2 = mapper2[tempvalue2]
replaceColumn!(t,`mode,finalvalue1)
replaceColumn!(t,`state,finalvalue2)
select * from t</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title10" id="导入-json-文件监控集群"><h4 class="- topic/title title topictitle4" id="ariaid-title10">导入 JSON 文件监控集群</h4><div class="- topic/body body"><p class="- topic/p p">为快速实现 DolphinDB 高可用集群与服务器资源的监控，我们提供了涉及指标的监控模板，在 Grafana 中导入对应的模板就可进行监控。</p><p class="- topic/p p"><a class="- topic/xref xref" href="script/cluster_monitor/high_available_cluster_monitor.json">DolphinDB高可用集群监控.json</a></p><p class="- topic/p p"><a class="- topic/xref xref" href="script/cluster_monitor/server_monitor.json">服务器监控.json</a></p><p class="- topic/p p">具体步骤如下：</p><p class="- topic/p p">步骤1：下载对应监控模板的 json 代码。</p><p class="- topic/p p">步骤2：在 <code class="+ topic/ph pr-d/codeph ph codeph">Dashboards</code> 中选择 <code class="+ topic/ph pr-d/codeph ph codeph">Import</code> 。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/3-1.png"/><br/><p class="- topic/p p">步骤3：将 json 代码复制到下图所示的红框2中，然后点击 <code class="+ topic/ph pr-d/codeph ph codeph">Load</code>，即可导入模板。或选择 <code class="+ topic/ph pr-d/codeph ph codeph">Upload JSON file</code>，直接导入对应的 json 文件。</p><br/><img class="- topic/image image" src="images/cluster_monitor/3-2.png"/><br/><p class="- topic/p p">步骤4：为保证能够正确拉取数据，需将 dashboards 里 panel 的数据源修改为已设置好的数据源，如果数据源为 dolphindb-datasource，监控指标需要手工填入（监控指标和指标对应的数据源参考3.1节），然后点击 <code class="+ topic/ph pr-d/codeph ph codeph">Run queries</code> 确认获取指标成功，即可正常开启监控 ，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/3-3.png"/><br/></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title11" id="邮件告警与预警"><h3 class="- topic/title title topictitle3" id="ariaid-title11">邮件告警与预警</h3><div class="- topic/body body"><p class="- topic/p p">Prometheus 和 Grafana 的告警功能丰富，可以设置，邮件、钉钉、企业微信等多种方式的告警和预警。</p><p class="- topic/p p">本章简单介绍了如何设置邮件告警，其他告警设置请参考附录章节。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title12" id="修改配置文件添加邮箱信息"><h4 class="- topic/title title topictitle4" id="ariaid-title12">修改配置文件添加邮箱信息</h4><div class="- topic/body body"><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">使用邮件告警功能，需修改 Grafana 的配置文件中的<code class="+ topic/ph pr-d/codeph ph codeph">[smtp], [plugin.grafana-images/cluster_monitor-renderer], [unified_alerting.screenshots]</code>。进入 defaults.ini (默认路径为/grafana/conf/defaults.ini)，找到 <code class="+ topic/ph pr-d/codeph ph codeph">[smpt]</code>选项，做如下所示更改：</p><img class="- topic/image image" src="images/cluster_monitor/3-4.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">将 <code class="+ topic/ph pr-d/codeph ph codeph">enabled</code> 修改为 true，表示开启邮件通道。<code class="+ topic/ph pr-d/codeph ph codeph">host</code> 配置的是告警邮箱所在的服务器，例如，若以163邮箱作为告警发件邮箱，则 <code class="+ topic/ph pr-d/codeph ph codeph">host</code> 应为 <code class="+ topic/ph pr-d/codeph ph codeph">smtp.163.com:465</code>。<code class="+ topic/ph pr-d/codeph ph codeph">user</code> 是告警的发件邮箱，<code class="+ topic/ph pr-d/codeph ph codeph">password</code> 处需要填写授权码，而不是 <code class="+ topic/ph pr-d/codeph ph codeph">user</code> 的登录密码，内网邮箱一般只需要密码即可，请按实际情况填写。</p></li><li class="- topic/li li"><p class="- topic/p p">然后修改 <code class="+ topic/ph pr-d/codeph ph codeph">[plugin.grafana-images/cluster_monitor-renderer]</code> 选项下的 <code class="+ topic/ph pr-d/codeph ph codeph">rendering_language</code>，将其赋值为 zh，表示告警图片中支持中文显示，如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/3-5.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">要在邮箱告警中显示图片，就要安装 <a class="- topic/xref xref" href="https://grafana.com/grafana/plugins/grafana-image-renderer/" target="_blank" rel="external noopener">grafana-images/cluster_monitor-renderer</a>。然后修改 <code class="+ topic/ph pr-d/codeph ph codeph">[unified_alerting.screenshots]</code> 选项下的 <code class="+ topic/ph pr-d/codeph ph codeph">capture</code>，将其赋值为 true，表示在告警邮件中加入图片，如下所示：
<img class="- topic/image image" src="images/cluster_monitor/3-6.png"/><br/></p></li></ol></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title13" id="告警规则建立"><h5 class="- topic/title title topictitle5" id="ariaid-title13">告警规则建立</h5><div class="- topic/body body"><p class="- topic/p p">Grafana中的 <code class="+ topic/ph pr-d/codeph ph codeph">Alert</code> 模块提供了告警和预警功能，使用告警和预警功能时，需要在 <code class="+ topic/ph pr-d/codeph ph codeph">Alert rules</code> 模块中建立告警规则。<code class="+ topic/ph pr-d/codeph ph codeph">Alert rules</code> 主要作用为：对指标进行监控，当指标触发告警条件时，进行告警处理。一个告警规则至少要包含告警条件和告警评估。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">告警条件</strong></p><p class="- topic/p p">点击 <code class="+ topic/ph pr-d/codeph ph codeph">New alert rule</code> 添加新的告警规则，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-1.png"/><br/><p class="- topic/p p">上图为 <code class="+ topic/ph pr-d/codeph ph codeph">Alert rules</code> 的第一组件，告警条件。告警条件的一般设置为：</p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">告警选择器，默认为 <code class="+ topic/ph pr-d/codeph ph codeph">Grafana managed alert</code>；</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Add query</code> 为新增查询；选择需要监控告警的指标，如 CPU 使用率；</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Add expression</code> 为新增表达式；</p></li><li class="- topic/li li"><p class="- topic/p p">为选择用于最终告警的数据。</p></li></ol><p class="- topic/p p">需要明确的是，Grafana 通过接收一个布尔值来决定是否触发告警，当接收值为 1 时，触发告警，接收值为0时，不触发告警，因此，单一的查询语句无法进行告警(单一的查询语句返回的是具体数值，不是布尔值)，还需要一个表达式来返回一系列的布尔值。表达式中一共有四种操作符，如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/4-2.png"/><br/><p class="- topic/p p">当查询结果返回一条数据时，如查询服务器 CPU 使用率</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>(1-sum(rate(node_cpu_seconds_total{job=A,mode="idle"}[1m]))/ sum(rate(node_cpu_seconds_total{job=A}[1m]))) *100</code></pre><p class="- topic/p p">只返回服务器 CPU 使用率一条数据，需要选择 <code class="+ topic/ph pr-d/codeph ph codeph">Classic condition</code> 操作符，即 <code class="+ topic/ph pr-d/codeph ph codeph">Classic condition</code> 适用于单维告警条件。</p><p class="- topic/p p">当查询结果返回多条数据时，如查询三台服务器 CPU 使用率</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>(1-sum(rate(node_cpu_seconds_total{mode="idle"}[1m])) by (job) / sum(rate(node_cpu_seconds_total[1m])) by (job)) *100</code></pre><p class="- topic/p p">返回三台服务器的 CPU 使用率数据，需要组合 <code class="+ topic/ph pr-d/codeph ph codeph">Reduce</code> 操作和 <code class="+ topic/ph pr-d/codeph ph codeph">Math</code> 操作，<code class="+ topic/ph pr-d/codeph ph codeph">Reduce</code> 作用将多条语句结果进行聚合分组，<code class="+ topic/ph pr-d/codeph ph codeph">Math</code> 为布尔运算表达式。如下图所示，当查询返回一条数据时：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-3.png"/><br/><p class="- topic/p p">上图中的 <code class="+ topic/ph pr-d/codeph ph codeph">Conditions</code> 中的含义为，若在时间窗口中查询语句A的返回结果最后一个值大于3，返回1，否则返回0，对应的操作为 <code class="+ topic/ph pr-d/codeph ph codeph">WHEN=last()</code>，<code class="+ topic/ph pr-d/codeph ph codeph">OF=A</code>，<code class="+ topic/ph pr-d/codeph ph codeph">IS ABOVE=3</code>。也可以选择其他条件，如，若在时间窗口中A的平均值小于50，触发告警，对应的操作为 <code class="+ topic/ph pr-d/codeph ph codeph">WHEN=mean()</code>，<code class="+ topic/ph pr-d/codeph ph codeph">OF=A</code>，<code class="+ topic/ph pr-d/codeph ph codeph">IS BELOW=50</code>。此外，可供的选择有很多种，如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/4-4.png"/><br/><p class="- topic/p p">当查询结果返回多条语句时，首先选择 <code class="+ topic/ph pr-d/codeph ph codeph">Reduce</code> 操作符。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-5.png"/><br/><p class="- topic/p p">上图中的含义为，将查询语句 A 的返回结果进行分组，然后对分组结果取均值，并且若时间窗口内有 Nan 值，在求均值时将 Nan 视为 Nan，而不是剔除（其余参数含义见 <a class="- topic/xref xref" href="https://grafana.com/docs/grafana/latest/alerting/" target="_blank" rel="external noopener">Grafana 官方文档</a>）。</p><p class="- topic/p p">在进行了 <code class="+ topic/ph pr-d/codeph ph codeph">Reduce</code> 操作之后，新增一个 expression，选择 <code class="+ topic/ph pr-d/codeph ph codeph">Math</code> 操作符，进行布尔运算，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-6.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">$B&gt;80</code>表示若表达式B返回的结果大于80，返回1，否则返回0。引用其他表达式或者查询的结果时，要使用一个'$'符号，比如，引用B表达式的结果，用'$B'表示。</p><p class="- topic/p p">选择用于最终告警的数据。该数据一定为一个布尔类型的数据。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-7.png"/><br/><p class="- topic/p p">上图选择了 C 返回的结果作为告警触发条件。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">告警评估</strong></p><p class="- topic/p p">这个组件主要功能为每隔多久评估一次指标是否触发告警条件，以及持续多久触发告警条件后进行告警。如下图所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-8.png"/><br/><p class="- topic/p p">为每隔多久评估一次是否触发告警条件，上图选择1分钟评估一次。</p><p class="- topic/p p">是 Pending 时间，意为为持续多久触发告警条件后进行告警，上图选择了持续5分钟触发告警后进行告警。</p><p class="- topic/p p">为当表达式返回的值为空时，设置告警规则的状态，有 No Data, Alerting, OK 三种状态可以选择。若表达式返回的数据为空，设置为 Alerting 和 No Data 时，持续时间超过5分钟会触发告警，选择 OK 则不会触发告警。</p><p class="- topic/p p">为当告警条件出现异常时，设置告警规则的状态，有 Error, Alerting, OK 三种状态可以选择。若前面的告警条件出现了异常，设置为 Alerting 和 No Data 时，异常持续时间超过5分钟会触发告警，选择 OK 则不会触发告警。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-9.png"/><br/><p class="- topic/p p">上图中红框为告警规则的状态。<code class="+ topic/ph pr-d/codeph ph codeph">Pending</code> 表示该指标已经触发告警条件，但持续时间还未超过5分钟，一旦持续时间超过了5分钟，<code class="+ topic/ph pr-d/codeph ph codeph">Pending</code> 就会变为 <code class="+ topic/ph pr-d/codeph ph codeph">Firing</code>。<code class="+ topic/ph pr-d/codeph ph codeph">No data</code> 表示表达式查询返回值为空。<code class="+ topic/ph pr-d/codeph ph codeph">Normal</code> 表示指标正常。</p></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title14" id="告警消息设置"><h4 class="- topic/title title topictitle4" id="ariaid-title14">告警消息设置</h4><div class="- topic/body body"><p class="- topic/p p">该组件主要为告警规则设置一些展示信息、设置告警组等等。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-10.png"/><br/><ul class="- topic/ul ul"><li class="- topic/li li">1 为设置告警规则名称。</li><li class="- topic/li li">2 为设置告警规则所在的文件夹，若不存在文件夹，输入一个要创建的文件夹名可以直接新建一个。</li><li class="- topic/li li">3 为设置告警规则所在的组，在同一个组里的告警规则的评估间隔是相同的。</li></ul><p class="- topic/p p">其余的为非必选选项，可以删除。<code class="+ topic/ph pr-d/codeph ph codeph">Summary</code> 为可使用模板变量，使得在告警消息中显示出具体的设备名称和值，如 <code class="+ topic/ph pr-d/codeph ph codeph">{{$labels.job}} 服务器cpu使用率为：{{values.B}}$</code>，若 A 服务器的 CPU 使用率为 90.14，则使用该语句后，在告警消息中会显示出：A 服务器 CPU 使用率为：90.14。更多支持的模板变量见<a class="- topic/xref xref" href="https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/message-templating/" target="_blank" rel="external noopener">Grafana模板变量</a>。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Dashboard UID</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">Panel ID</code> 是一对组合使用的选项，其作用为：当告警触发时，Grafana 会在对应的 Dashboard UID 下对应的 Panel ID 里进行 warning 标识。如图所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-11.png"/><br/><p class="- topic/p p">当填入了 Dashboard UID 和 Panel ID，对应的监控指标图出现了之前没有的图示项。绿色的心表示当前监控指标处于正常状态。红框标注出来的线条表示告警触发的开始时间和告警消息发送时间，对应告警状态里的 <code class="+ topic/ph pr-d/codeph ph codeph">Pending</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">firing</code>。如果告警规则是直接在 panel 里创建的，告警规则会自动补全 Dashboard UID 和 Panel ID。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-12.png"/><br/><p class="- topic/p p">在各节点等待执行 Job 个数这个 panel 里添加一个告警规则后，Dashboard UID 和 Panel ID 会自动补全：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-13.png"/><br/><p class="- topic/p p">预警需要用到 <code class="+ topic/ph pr-d/codeph ph codeph">predict_linear(v range-vector,t scalar)</code> 函数，该函数基于 range-vector 内指标 V 的数据，预测 t 秒后该指标的值，详情见<a class="- topic/xref xref" href="https://prometheus.io/docs/prometheus/latest/querying/functions/#predict_linear" target="_blank" rel="external noopener">predict_linear</a>。示例如下：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-14.png"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title15" id="设置告警方式"><h4 class="- topic/title title topictitle4" id="ariaid-title15">设置告警方式</h4><div class="- topic/body body"><p class="- topic/p p">配置文件修改后，在 <code class="+ topic/ph pr-d/codeph ph codeph">Contact points</code> 模块设置告警消息的接收方式以及接收者，建立告警消息的发送模板，如下图所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-15.png"/><br/><p class="- topic/p p">从 <code class="+ topic/ph pr-d/codeph ph codeph">hoose Alertmanager</code> 下拉列表中选择告警管理工具，默认选项为 Grafana。如需选择其他告警管理工具，请自行安装。<code class="+ topic/ph pr-d/codeph ph codeph">Message template</code> 为告警消息模板，它主要的功能为：给告警消息提供一个格式化模板，若不创建消息模板，Grafana 将使用默认的模板。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Contact point</code> 为告警消息的接收方式和接收者。点击 <code class="+ topic/ph pr-d/codeph ph codeph">New contact point</code> 进入如下页面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-16.png"/><br/><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Name</code>，设置告警名称</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Contact point type</code>，设置告警通知方式。常用项为 Email 和钉钉。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Address</code>，当 Contact point type 设置为 Email 时可用，用于设置 Email 地址。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">URL</code>，当 Contact point type 设置为钉钉时可用，用于填写钉钉群中告警机器人的 webhook。</p></li></ul></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Notification settings</code>，用于在告警恢复时设置是否发送恢复通知。默认为发送。如需禁用，选择 <code class="+ topic/ph pr-d/codeph ph codeph">Disable resolved message</code>，并点击 S 保存。</p></li></ul><p class="- topic/p p">此外，Grafana 可以根据告警标签设置更加复杂的发送策略，比如不同的告警发给不同的组员、设置特定时间段屏蔽告警等，详情请参考<a class="- topic/xref xref" href="#grafana-%E5%91%8A%E8%AD%A6%E7%9A%84%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8">附录-grafana告警的进阶使用</a>。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title16" id="最终结果"><h4 class="- topic/title title topictitle4" id="ariaid-title16">最终结果</h4><div class="- topic/body body"><p class="- topic/p p">告警或预警邮件如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/4-17.png"/><br/><p class="- topic/p p">若收到告警消息后需要跳转到具体的 panel 页面，可以点击下方的 <code class="+ topic/ph pr-d/codeph ph codeph">Go to Panel</code> 跳转。若点击后无法访问页面，是因为Grafana的配置文件中设置上述邮件里的跳转的链接默认值为 <code class="+ topic/ph pr-d/codeph ph codeph">https://localhost:9094</code>，不是指向服务器部署的 Grafana ，因此会出现拒绝访问。此时需要回到 defaults.ini中修改 <code class="+ topic/ph pr-d/codeph ph codeph">[server]</code> 选项里的内容，</p><img class="- topic/image image" src="images/cluster_monitor/4-18.png"/><br/><p class="- topic/p p">将 <code class="+ topic/ph pr-d/codeph ph codeph">http_addr、domain</code> 改为服务器的公网IP。之后邮件里的跳转链接就变成了 <code class="+ topic/ph pr-d/codeph ph codeph">root_url</code>，我们就能访问到对应告警指标的监控页面了。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title17" id="附录"><h3 class="- topic/title title topictitle3" id="ariaid-title17">附录</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title18" id="promql-查询语法"><h4 class="- topic/title title topictitle4" id="ariaid-title18">PromQL 查询语法</h4><div class="- topic/body body"><p class="- topic/p p">PromQL 是 Prometheus 的自定义查询语言，通过 PromQL 用户可以非常方便地对监控样本数据进行统计分析，PromQL 支持常见的运算操作符，同时 PromQL 中还提供了大量的内置函数用于对数据的高级处理，并且支持简单的 SQL 查询语句。下面对 PromQL 进行简单的介绍，详细的信息见<a class="- topic/xref xref" href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank" rel="external noopener">Prometheus官方文档</a>。</p></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title19" id="promql-metric-类型"><h5 class="- topic/title title topictitle5" id="ariaid-title19">PromQL metric 类型</h5><div class="- topic/body body"><p class="- topic/p p">Prometheus 定义了4种不同的指标类型(metric type)：Counter, Gauge, Histogram, Summary:</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">类型名称</td><td class="- topic/entry entry colsep-0 rowsep-0">含义</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">Counter</td><td class="- topic/entry entry colsep-0 rowsep-0">计数器</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">Gauge</td><td class="- topic/entry entry colsep-0 rowsep-0">仪表盘</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">Histogram</td><td class="- topic/entry entry colsep-0 rowsep-0">直方图</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0">Summary</td><td class="- topic/entry entry colsep-0 rowsep-0">摘要</td></tr></tbody></table></div><p class="- topic/p p">通常 Counter 的总数并没有直接作用，而是需要借助于 rate, topk, increase 和 irate 等函数来生成样本数据的变化状况，如：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rate(http_requests_total[2h])，获取2小时内，该指标下各时间序列上的 http 总请求数的增长速率

topk(3,http_requests_total)，获取该指标下http请求总数排名前3的时间序列

irate(http_requests_total[2h])，高灵敏度函数，用于计算指标的瞬时速率</code></pre><p class="- topic/p p">Gauge 用于存储其值可增可减的指标样本数据，常用于进行求和、取平均值、最小值、最大值等聚合计算。也会经常结合 PromQL 的 predict_linear 和 delta 函数使用，如：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>predict_linear(v range-vector,t,scalar)函数可以预测时间序列 v 在 t 秒后的值，他通过线性回归的方式来预测样本数据的 Gauge 变化趋势

delta(v range-vector)函数计算范围向量中的每个时间序列元素的第一个值与最后一个值之差，从而展示不同时间点上的样本值得差值。

delta(cpu_temp_celsius{host=“hostname”}[2h])，返回该服务器上的 CPU 温度与两小时之前的差异</code></pre><p class="- topic/p p">Prometheus 的内置函数请参考官方文档<a class="- topic/xref xref" href="https://prometheus.io/docs/prometheus/latest/querying/functions/" target="_blank" rel="external noopener">PromQL 内置函数</a>.</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title20" id="promql-表达式"><h5 class="- topic/title title topictitle5" id="ariaid-title20">PromQL 表达式</h5><div class="- topic/body body"><p class="- topic/p p">Prometheus 通过指标名称和对应的一组标签（labelset）唯一定义一条时间序列。指标名称反映了监控样本的基本标识，而 label 则在这个基本标识上为采集到的数据提供了多种特征维度。用户可以基于这些特征维度过滤，聚合，统计从而产生新的计算后的一条时间序列。</p><p class="- topic/p p">以查询语句 <code class="+ topic/ph pr-d/codeph ph codeph">rate(node_cpu_seconds_total{mode="idle",instance="localhost:8080"}[2h])</code> 为例， <code class="+ topic/ph pr-d/codeph ph codeph">node_cpu_seconds_total</code> 是一个即时向量；<code class="+ topic/ph pr-d/codeph ph codeph">{}</code> 里的内容是筛选条件；<code class="+ topic/ph pr-d/codeph ph codeph">mode="idle"</code> 就是筛选标签；<code class="+ topic/ph pr-d/codeph ph codeph">[2h]</code> 是范围向量，当不指定范围向量时，返回的是当前时刻的瞬时值。该查询语句查询的是地址为 <code class="+ topic/ph pr-d/codeph ph codeph">localhost:8080</code> 服务器在两小时内 CPU 的闲置率。</p><p class="- topic/p p">查询语句返回的是以当前时刻为基准的值，如 <code class="+ topic/ph pr-d/codeph ph codeph">node_cpu_seconds_total[5m]</code>，返回以当前时间为基准5分钟内的数据。若要查询5分钟前的样本数据，则需要借助位移操作符 <code class="+ topic/ph pr-d/codeph ph codeph">offset</code>，如查询5分钟前至10分钟前，这5分钟的 CPU 使用时长，可使用 <code class="+ topic/ph pr-d/codeph ph codeph">node_cpu_seconds_total[5m] offset 5m</code>。</p><p class="- topic/p p">当然 PromQL 也支持常见的布尔运算符，如 <code class="+ topic/ph pr-d/codeph ph codeph">(node_memory_bytes_total - node_memory_free_bytes_total) / node_memory_bytes_total &gt; 0.95</code> 查询的是当前内存使用率超过95%的主机。</p><p class="- topic/p p">此外 PromQL 还支持常见的聚合操作,并可以通过 <code class="+ topic/ph pr-d/codeph ph codeph">by</code> 关键字进行分组，如 <code class="+ topic/ph pr-d/codeph ph codeph">sum(http_requests_total) by (code,handler,job,method)</code>。</p></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title21" id="grafana-面板使用技巧"><h4 class="- topic/title title topictitle4" id="ariaid-title21">Grafana 面板使用技巧</h4><div class="- topic/body body"><p class="- topic/p p">默认情况下，Grafana 图形展示指标的标签会很详细，有的时候我们并不需要那么多的信息，如下图所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-1.png"/><br/><p class="- topic/p p">对于查询出来的指标，有时我们只关心它的主要信息，比如说，上图中我们只关心网卡的名称，此时我们只需要如下所示操作，点击 <code class="+ topic/ph pr-d/codeph ph codeph">Transform</code></p><br/><img class="- topic/image image" src="images/cluster_monitor/5-2.png"/><br/><p class="- topic/p p">然后会跳转到如下所示页面，并在搜索栏输入 <code class="+ topic/ph pr-d/codeph ph codeph">Labels to fields</code>：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-3.png"/><br/><p class="- topic/p p">点击搜索结果，会跳转到如下所示的页面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-4.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Labels</code> 后面的值表明了可以用作图表的标签，下方的 <code class="+ topic/ph pr-d/codeph ph codeph">Value field name</code> 用于选择你希望取什么值作为图表的标签，在网卡的展示中，一般我们需要的信息是网卡的名称，所以选择 device，选择好后，指标的标签就变成如下所示的样子：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-5.png"/><br/><p class="- topic/p p">有的时候，不同网卡的发送速率有很大的差别，而 Grafana 在对查询到的结果进行可视化作图时，它是以最大值作为指标波动的上限范围的，导致在可视化时会出现，发送速率较小的网卡看起来几乎没有波动。</p><p class="- topic/p p">如上图所示，直观上 enp0s3 网卡在三十分钟内的发送速率曲线波动很小，但实际上是有变化的，点击上图中的 enp0s3，可得到如下所示图表：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-6.png"/><br/><p class="- topic/p p">因此，在进行监控时，若一个 panel 中有多个指标，需要谨慎观察每一个设备的波动情况。</p><p class="- topic/p p">一个 Dashboard 中可以追加多个图表：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-7.png"/><br/><p class="- topic/p p">如上图所示，点击右上角的符号，就可以继续追加图表。如果一个 Dashboard 中的 panel 很多，可以进行分类管理。</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-8.png"/><br/><p class="- topic/p p">上图的 panel 的类别很乱，可点击 <code class="+ topic/ph pr-d/codeph ph codeph">Add a new row</code>，创建 panel 的分类，然后将对应的 panel 拖动到类别里：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-9.png"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title22" id="grafana-告警的进阶使用"><h4 class="- topic/title title topictitle4" id="ariaid-title22">Grafana 告警的进阶使用</h4><div class="- topic/body body"></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title23" id="alerts-标签设置"><h5 class="- topic/title title topictitle5" id="ariaid-title23">Alerts 标签设置</h5><div class="- topic/body body"><p class="- topic/p p">在告警规则建立时，告警组件的最后一步，可以为告警设置一些查询语句中不具有的标签，以供 <code class="+ topic/ph pr-d/codeph ph codeph">Notification polices</code> 和 <code class="+ topic/ph pr-d/codeph ph codeph">Silence</code> 组件使用。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-10.png"/><br/><p class="- topic/p p">key 和 value 都是自定义的，如令 key=rule, value=cpuUsage。</p><p class="- topic/p p">以 CPU 使用率为例，完成一个告警规则配置后，此时 <code class="+ topic/ph pr-d/codeph ph codeph">Alert rules</code> 界面会出现如下所示内容，Labels 会显示自定义的标签：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-11.png"/><br/></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title24" id="notification-policies-模块"><h5 class="- topic/title title topictitle5" id="ariaid-title24"><code class="+ topic/ph pr-d/codeph ph codeph">Notification policies</code> 模块</h5><div class="- topic/body body"><p class="- topic/p p">告警和预警的主要目的帮助相关人员了解服务器当前运行状况，当发生异常时，提醒专业的人员进行维护，但是不同的告警需要不同的部门或运维人员介入处理，因此我们需要将不同的告警消息发送给不同的人员。<code class="+ topic/ph pr-d/codeph ph codeph">Notification policies</code> 模块的作用是将告警消息按照制定好的策略发送。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-12.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Notification policies</code> 一共有 <code class="+ topic/ph pr-d/codeph ph codeph">Root policy--default for all alerts, Specific routing, Mute timings</code> 三大组件。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Root policy--default for all alerts</code></p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Root policy--default for all alerts</code> 组件设置的是告警消息的默认接收者，当某个告警规则未指定告警消息接收者时，告警发生后，告警消息将发送到默认接收者。点击 <code class="+ topic/ph pr-d/codeph ph codeph">Edit</code> 编辑告警消息的默认接收者，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-13.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Default contact point</code> 为告警消息的默认接收者。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Group by</code> 将告警规则按照所选择的Label进行分组。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Group wait</code> 为新创建的告警规则所产生的新组在第一次发送告警消息前的缓冲时间。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Group interval</code> 为属于同组的告警规则之间发送告警消息的时间间隔，举例说明：</p><p class="- topic/p p">设组1有 A, B 两个告警规则，Group Interval 为 m 分钟，且他们的 Pending 时间都是 n 分钟，A 在9:45分触发了告警条件，B 在9:46分触发了告警条件，且 A 持续触发告警条件的时间大于 n，B 持续触发告警条件的时间大于 n+m，则 A 将在(9:45+n)发送告警消息，B 不是在(9:46+n)触发告警消息，而是将在(9:46+n+m)发送告警消息。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Repeat interval</code> 为前后两次发送告警消息的时间间隔。举例说明：设告警规则 A 所在组的 Repeat interval 时间为 f，A 持续触发告警的时间远远大于其 Pending 时间和f，A 在9:45首次发送告警消息，A 将在(9:45+f)再次发送告警消息，而不是在(9:45+Pending时间)发送告警消息。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Specific routing</code></p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Specific routing</code> 组件主要功能为将不同类型的告警消息发送给不同的人。如下所示，点击 <code class="+ topic/ph pr-d/codeph ph codeph">New specific policy</code>，进入如下所示页面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-14.png"/><br/><p class="- topic/p p">点击 <code class="+ topic/ph pr-d/codeph ph codeph">Add matcher</code>，进入如下所示页面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-15.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Contact point</code> 选择接收者。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Matching labels</code> 通过标签及对应的值来选择该接收者要接收的告警消息。上述将有 cpuUsage 标签的告警消息发送给 test1。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Override grouping</code> 设置该路径里告警规则的分组依据，若不开启，则从默认接收者中继承。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Override general timings</code> 若开启，将覆盖默认接收者里设置的 timings。</p><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Mute timings</code> 为该接受收者选择一个要接收告警的时间。</p></li><li class="- topic/li li"><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Mute timings</code></p><p class="- topic/p p">Grafana 提供按特定的时间段收到告警消息的功能，由 <code class="+ topic/ph pr-d/codeph ph codeph">Mute timings</code> 组件实现。点击 <code class="+ topic/ph pr-d/codeph ph codeph">Add mute timing</code>，进入如下所示页面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-16.png"/><br/><p class="- topic/p p">设定 <code class="+ topic/ph pr-d/codeph ph codeph">name</code> 字段为工作时间。<code class="+ topic/ph pr-d/codeph ph codeph">Time range</code> 含义：只有在此时间段产生的告警消息才会发送给用户。<code class="+ topic/ph pr-d/codeph ph codeph">Days of week</code> 含义：一周中的哪几天用户希望能收到告警消息。</p></li></ul></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title25" id="silences-模块"><h5 class="- topic/title title topictitle5" id="ariaid-title25"><code class="+ topic/ph pr-d/codeph ph codeph">Silences</code> 模块</h5><div class="- topic/body body"><p class="- topic/p p">该模块主要作用为，设置某些告警规则为静默状态，即不让这些规则发送告警消息，即便它满足告警消息的发送条件。如下图所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-17.png"/><br/><p class="- topic/p p">点击 <code class="+ topic/ph pr-d/codeph ph codeph">New Silence</code> 添加静默，进入如下所示页面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-18.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">Matching labels</code> 模块通过标签筛选出告警规则，使所选规则在静默时间内处于静默状态。<code class="+ topic/ph pr-d/codeph ph codeph">Silence start and end</code> 为静默时间。</p></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title26" id="钉钉告警与预警"><h4 class="- topic/title title topictitle4" id="ariaid-title26">钉钉告警与预警</h4><div class="- topic/body body"><p class="- topic/p p">使用钉钉接收告警、预警消息时，要先在钉钉群聊里添加群聊机器人，如下所示</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-19.png"/><br/><p class="- topic/p p">点击<code class="+ topic/ph pr-d/codeph ph codeph">群设置--&gt;智能群助手</code>，出现如下所示页面：</p><img class="- topic/image image" src="images/cluster_monitor/5-20.png"/><br/><p class="- topic/p p">点击<code class="+ topic/ph pr-d/codeph ph codeph">添加机器人</code>,出现如下所示页面：</p><img class="- topic/image image" src="images/cluster_monitor/5-21.png"/><br/><p class="- topic/p p">选择<code class="+ topic/ph pr-d/codeph ph codeph">自定义</code>，跳转到如下页面：</p><img class="- topic/image image" src="images/cluster_monitor/5-22.png"/><br/><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">安全设置</code>选择IP地址段，输入你的 Grafana 所在的公网 IP，点击确定后出现如下所示界面：</p><img class="- topic/image image" src="images/cluster_monitor/5-23.png"/><br/><p class="- topic/p p">将<code class="+ topic/ph pr-d/codeph ph codeph">Webhook</code>复制下来，后面需要用到。然后回到 Grafana Alerting 页面，去 <code class="+ topic/ph pr-d/codeph ph codeph">Contact points</code> 模块里点击 <code class="+ topic/ph pr-d/codeph ph codeph">New contact point</code>，进入如下所示页面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-24.png"/><br/><p class="- topic/p p">命名为叫钉钉告警，然后 <code class="+ topic/ph pr-d/codeph ph codeph">contact point type</code> 选择 DingDing。<code class="+ topic/ph pr-d/codeph ph codeph">URL</code> 里填入你刚刚复制的 webhook。<code class="+ topic/ph pr-d/codeph ph codeph">Message Type</code> 有 Link 和 ActionCard 两种选择，这里选择了 Link。选择 Link 后，告警消息将以链接的方式发送到钉钉群里，点击链接会跳转到 Grafana 界面。</p><img class="- topic/image image" src="images/cluster_monitor/5-25.png"/><br/><p class="- topic/p p">选择 <code class="+ topic/ph pr-d/codeph ph codeph">ActionCard</code>，告警消息将以消息的样式发到钉钉群里，如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/5-26.png"/><br/><p class="- topic/p p">设置好 <code class="+ topic/ph pr-d/codeph ph codeph">Contact point</code> 后，还要设置 <code class="+ topic/ph pr-d/codeph ph codeph">Notification policies</code>。如果之前已经设置了告警消息的默认接收者，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-27.png"/><br/><p class="- topic/p p">上图已经将邮件作为默认接收者，需要先按照4.4节操作将钉钉设置为消息发送渠道，然后在标签匹配中将所有的告警规则都匹配上，如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-28.png"/><br/><p class="- topic/p p">如果只是简单的在下面的 <code class="+ topic/ph pr-d/codeph ph codeph">New specific policy</code> 里添加钉钉，那么邮件将收不到告警消息。此时需要将邮件也加入到消息消息发送路径里，这样钉钉群和邮件都能收到告警。如下所示：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-29.png"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title27" id="prometheusalertmanager-企业微信告警与预警"><h4 class="- topic/title title topictitle4" id="ariaid-title27">Prometheus+Alertmanager 企业微信告警与预警</h4><div class="- topic/body body"></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title28" id="alertmanager-部署与配置"><h5 class="- topic/title title topictitle5" id="ariaid-title28">Alertmanager 部署与配置</h5><div class="- topic/body body"><p class="- topic/p p">Grafana 目前不支持企业微信告警与预警，需要部署 Prometheus 的 <a class="- topic/xref xref" href="https://prometheus.io/download/" target="_blank" rel="external noopener">Alertmanager</a>进行企业微信告警。</p><p class="- topic/p p">先将 Alertmanager 部署到 Prometheus 所在服务器中。然后在企业微信生成一个专用于告警的应用。</p><p class="- topic/p p">进入企业微信管理后台，点击<code class="+ topic/ph pr-d/codeph ph codeph">应用管理--&gt;创建应用</code>如图所示：</p><img class="- topic/image image" src="images/cluster_monitor/5-30.png"/><br/><p class="- topic/p p">进入如下所示页面：</p><img class="- topic/image image" src="images/cluster_monitor/5-31.png"/><br/><p class="- topic/p p">上传应用图片，给应用取一个名字，并选择应用可见范围（必须设置），创建完成后，进入如下所示页面：</p><img class="- topic/image image" src="images/cluster_monitor/5-32.png"/><br/><p class="- topic/p p">先将 AgentId 和 Secret 记录下来，然后再配置企业可信 IP，如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/5-33.png"/><br/><p class="- topic/p p">点击：</p><img class="- topic/image image" src="images/cluster_monitor/5-34.png"/><br/><p class="- topic/p p">填入 Prometheus 和 Aertmanager 部署的服务器的公网 IP，然后点击<code class="+ topic/ph pr-d/codeph ph codeph">通讯录</code>，如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/5-35.png"/><br/><p class="- topic/p p">获取到你要接收信息的部门的部门 ID，并记录。最后点击<code class="+ topic/ph pr-d/codeph ph codeph">我的企业</code>，如下所示：</p><img class="- topic/image image" src="images/cluster_monitor/5-36.png"/><br/><p class="- topic/p p">获取企业 ID，并记录。</p><p class="- topic/p p">获取了企业 ID，部门 ID，应用 ID，Secret 后，就可以配置 Alertmanager 了。在 Alertmanager 安装目录下找到 alertmanager.yml，将里面的内容全部删除，输入以下内容，若不存在，可以手动创建一个：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>global: 
  resolve_timeout: 1m

templates:
  - '/home/appadmin/monitor/alertmanager/alertmanager-0.24.0.linux-amd64/template/wechat.tmpl'  #企业微信告警消息模板地址

route:
  receiver: 'wechat'  #下面 receivers 设置的接收者名称
  group_by: ['alertname'] 
  group_wait: 30s  # 这三个的概念和前面 Grafana 里的概念一样
  group_interval: 1m 
  repeat_interval: 10m 
  

receivers:
- name: 'wechat' 
  wechat_configs: 
    - corp_id: 'ww68d468fe12810853' #企业 ID
      to_party: '38'   #部门 ID
      agent_id: '1000015'   #应用 ID
      api_secret: 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx' #Secret
      send_resolved: true  #是否发送告警恢复</code></pre><p class="- topic/p p">然后再更改 prometheus.yml，输入以下内容：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code># Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: ["xxxxxxxx:xxx"] #alertmanager 的 IP 地址和端口号

rule_files:
  - "rules/node_alerts.yml" #告警规则的存放路径</code></pre><p class="- topic/p p">之后在 Prometheus 安装目录里新建一个 rules 文件夹，在 rules 文件夹里新建一个 node_alerts.yml 文件，该文件就是告警规则，需要在该文件下编写你的告警规则，以磁盘空间使用率为例：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>groups:
- name: "servers monitor"
  rules:  
  - alert: "diskUsage" #服务器磁盘空间使用率
    expr: (1-sum(node_filesystem_avail_bytes{mountpoint =~"/hdd.*?|/ssd.*?|/home.*?"})by (instance,mountpoint)/sum(node_filesystem_size_bytes{mountpoint =~"/hdd.*?|/ssd.*?|/home.*?"})by(instance,mountpoint))*100&gt;90
    for: 5m
    labels:
      status: warning
    annotations:
      summary: "{{$labels.instance}} {{$labels.mountpoint}}: High disk Usage Detected"
      description: "{{$labels.instance}} {{$labels.mountpoint}} disk Usage is: {{$value}}%, above 90%"   </code></pre><p class="- topic/p p">最后在 Alertmanager 安装目录下新建一个 template 文件夹，在 template 文件夹里新建一个 wechat.tmpl 文件，该文件就是消息模板，在其中输入以下内容：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>{{ define "wechat.default.message" }}
{{- if gt (len .Alerts.Firing) 0 -}}
{{- range $index, $alert := .Alerts -}}
{{- if eq $index 0 }}
========= 监控报警 =========
告警状态：{{   .Status }}
告警类型：{{ $alert.Labels.alertname }}
故障主机: {{ $alert.Labels.instance }}
告警主题: {{ $alert.Annotations.summary }}
告警详情: {{ $alert.Annotations.message }}{{ $alert.Annotations.description}}
故障时间: {{ ($alert.StartsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
========= = end =  =========
{{- end }}
{{- end }}
{{- end }}
{{- if gt (len .Alerts.Resolved) 0 -}}
{{- range $index, $alert := .Alerts -}}
{{- if eq $index 0 }}
========= 异常恢复 =========
告警类型：{{ .Labels.alertname }}
告警状态：{{   .Status }}
告警主题: {{ $alert.Annotations.summary }}
告警详情: {{ $alert.Annotations.message }}{{ $alert.Annotations.description}}
故障时间: {{ ($alert.StartsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
恢复时间: {{ ($alert.EndsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
{{- if gt (len $alert.Labels.instance) 0 }}
实例信息: {{ $alert.Labels.instance }}
{{- end }}
========= = end =  =========
{{- end }}
{{- end }}
{{- end }}
{{- end }}</code></pre><p class="- topic/p p">以上，就完成了企业微信告警的配置。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title29" id="启动企业微信告警"><h5 class="- topic/title title topictitle5" id="ariaid-title29">启动企业微信告警</h5><div class="- topic/body body"><p class="- topic/p p">重启 Prometheus，然后进入 alertmanager 安装目录，运行以下代码启动 alertmanager：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>nohup ./alertmanager --config.file=alertmanager.yml --web.listen-address=":9093" --cluster.listen-address=localhost:9095 &amp;</code></pre><p class="- topic/p p">其中，--config.file 指定 alertmanager 的配置文件，--web.listen-address 指定 alertmanager 的运行端口，这里设置为9093，--cluster.listen-address 指定集群端口，默认值为9094，若默认端口被占用，则需指定一个未被占用的端口。</p><p class="- topic/p p">启动了 alertmanager 之后，在浏览器地址栏输入 Prometheus 的 IP 和端口，进入 prometheus，然后点击 <code class="+ topic/ph pr-d/codeph ph codeph">Alerts</code>，就会出现如下所示界面：</p><br/><img class="- topic/image image" src="images/cluster_monitor/5-37.png"/><br/><p class="- topic/p p">表示告警规则创建成功了。触发告警规则后，企业微信收到的信息样式如下：</p><img class="- topic/image image" src="images/cluster_monitor/5-38.png"/><br/><p class="- topic/p p">至此，企业微信告警部署完毕，用户可根据上述步骤开启 DolphinDB 集群监控的企业微信告警。</p></div></article></article></article></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0" data-tocid="监控方案概述">监控方案概述</a></li><li class="topic-item"><a href="#%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2" data-tocid="软件安装部署">软件安装部署</a><ul><li class="topic-item"><a href="#nodeexporter-%E9%83%A8%E7%BD%B2" data-tocid="nodeexporter-部署">NodeExporter 部署</a></li><li class="topic-item"><a href="#prometheus-%E9%83%A8%E7%BD%B2" data-tocid="prometheus-部署">Prometheus 部署</a></li><li class="topic-item"><a href="#grafana-%E9%83%A8%E7%BD%B2" data-tocid="grafana-部署">Grafana 部署</a></li><li class="topic-item"><a href="#dolphindb-datasource-%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85" data-tocid="dolphindb-datasource-插件安装">dolphindb-datasource 插件安装</a></li><li class="topic-item"><a href="#%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0" data-tocid="监控方案实现">监控方案实现</a><ul><li class="topic-item"><a href="#%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB%E5%8F%8A%E5%85%B6%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F" data-tocid="监控指标体系及其计算公式">监控指标体系及其计算公式</a></li><li class="topic-item"><a href="#%E5%AF%BC%E5%85%A5-json-%E6%96%87%E4%BB%B6%E7%9B%91%E6%8E%A7%E9%9B%86%E7%BE%A4" data-tocid="导入-json-文件监控集群">导入 JSON 文件监控集群</a></li></ul></li><li class="topic-item"><a href="#%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6%E4%B8%8E%E9%A2%84%E8%AD%A6" data-tocid="邮件告警与预警">邮件告警与预警</a><ul><li class="topic-item"><a href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E9%82%AE%E7%AE%B1%E4%BF%A1%E6%81%AF" data-tocid="修改配置文件添加邮箱信息">修改配置文件添加邮箱信息</a><ul><li class="topic-item"><a href="#%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99%E5%BB%BA%E7%AB%8B" data-tocid="告警规则建立">告警规则建立</a></li></ul></li><li class="topic-item"><a href="#%E5%91%8A%E8%AD%A6%E6%B6%88%E6%81%AF%E8%AE%BE%E7%BD%AE" data-tocid="告警消息设置">告警消息设置</a></li><li class="topic-item"><a href="#%E8%AE%BE%E7%BD%AE%E5%91%8A%E8%AD%A6%E6%96%B9%E5%BC%8F" data-tocid="设置告警方式">设置告警方式</a></li><li class="topic-item"><a href="#%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C" data-tocid="最终结果">最终结果</a></li></ul></li><li class="topic-item"><a href="#%E9%99%84%E5%BD%95" data-tocid="附录">附录</a><ul><li class="topic-item"><a href="#promql-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95" data-tocid="promql-查询语法">PromQL 查询语法</a><ul><li class="topic-item"><a href="#promql-metric-%E7%B1%BB%E5%9E%8B" data-tocid="promql-metric-类型">PromQL metric 类型</a></li><li class="topic-item"><a href="#promql-%E8%A1%A8%E8%BE%BE%E5%BC%8F" data-tocid="promql-表达式">PromQL 表达式</a></li></ul></li><li class="topic-item"><a href="#grafana-%E9%9D%A2%E6%9D%BF%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7" data-tocid="grafana-面板使用技巧">Grafana 面板使用技巧</a></li><li class="topic-item"><a href="#grafana-%E5%91%8A%E8%AD%A6%E7%9A%84%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8" data-tocid="grafana-告警的进阶使用">Grafana 告警的进阶使用</a><ul><li class="topic-item"><a href="#alerts-%E6%A0%87%E7%AD%BE%E8%AE%BE%E7%BD%AE" data-tocid="alerts-标签设置">Alerts 标签设置</a></li><li class="topic-item"><a href="#notification-policies-%E6%A8%A1%E5%9D%97" data-tocid="notification-policies-模块"><code class="+ topic/ph pr-d/codeph ph codeph">Notification policies</code> 模块</a></li><li class="topic-item"><a href="#silences-%E6%A8%A1%E5%9D%97" data-tocid="silences-模块"><code class="+ topic/ph pr-d/codeph ph codeph">Silences</code> 模块</a></li></ul></li><li class="topic-item"><a href="#%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6%E4%B8%8E%E9%A2%84%E8%AD%A6" data-tocid="钉钉告警与预警">钉钉告警与预警</a></li><li class="topic-item"><a href="#prometheusalertmanager-%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%91%8A%E8%AD%A6%E4%B8%8E%E9%A2%84%E8%AD%A6" data-tocid="prometheusalertmanager-企业微信告警与预警">Prometheus+Alertmanager 企业微信告警与预警</a><ul><li class="topic-item"><a href="#alertmanager-%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE" data-tocid="alertmanager-部署与配置">Alertmanager 部署与配置</a></li><li class="topic-item"><a href="#%E5%90%AF%E5%8A%A8%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%91%8A%E8%AD%A6" data-tocid="启动企业微信告警">启动企业微信告警</a></li></ul></li></ul></li></ul></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>