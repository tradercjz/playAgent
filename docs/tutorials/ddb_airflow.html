<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="DolphinDB 作为一款高性能时序数据库，其在实际生产环境中常有数据的清洗、装换以及加载等需求，而对于该如何结构化管理好 ETL 作业，Airflow 提供了一种很好的思路。本篇教程为生产环境中 ETL 实践需求提供了一个解决方案，将 Python Airflow 引入到 DolphinDB 的高可用集群中，通过使用 Airflow 所提供的功能来实现更好管理 DolphinDB 数据 ETL ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="dolphindb-与-python-airflow-最佳实践"/><title>DolphinDB 与 Python AirFlow 最佳实践</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;dolphindb-与-python-airflow-最佳实践&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDB 与 Python AirFlow 最佳实践&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDB 作为一款高性能时序数据库，其在实际生产环境中常有数据的清洗、装换以及加载等需求，而对于该如何结构化管理好 ETL 作业，Airflow 提供了一种很好的思路。本篇教程为生产环境中 ETL 实践需求提供了一个解决方案，将 Python Airflow 引入到 DolphinDB 的高可用集群中，通过使用 Airflow 所提供的功能来实现更好管理 DolphinDB 数据 ETL 作业，整体架构如下:&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1.png&#34; xtrc=&#34;image:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;541&#34; dita-ot:image-height=&#34;391&#34;/&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:131;167:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-airflow&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;1. Airflow&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;11-airflow-简介&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;1.1. Airflow 简介&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Airflow 是一个可编程，调度和监控的工作流平台，基于有向无环图 (Directed acyclic graph, DAG)，Airflow 可以定义一组有依赖的任务，按照依赖依次执行。Airflow 提供了丰富的命令行工具用于系统管控，而其 web 管理界面同样也可以方便地管控调度任务，并且对任务运行状态进行实时监控，方便了系统的运维和管理。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;12-airflow-部分核心功能&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;1.2. Airflow 部分核心功能&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;16:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;增量加载数据&lt;/b&gt;：当表或数据集较小时，可以整体加载数据。但是随着数据的增长，以固定的时间间隔增量提取数据才是 ETL 的常态，仅加载一个小时，一天，一周数据的需求非常普遍。Airflow 可以容易地以特定的时间间隔加载增量数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;17:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;17:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;处理历史数据&lt;/b&gt;：在某些情况下，您刚刚完成一个新的工作流程并且需要回溯到将新代码投入生产的日期的数据。在这种情况下，您只需使用 DAG 中的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;17:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;start_date&lt;/i&gt; 参数以指定开始日期。然后，Airflow 将回填任务到开始日期。此外，还可以使用 DAG 的参数来处理数周、数月或数年的数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;18:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;分区提取的数据&lt;/b&gt;：通过对数据的目的地进行分区，可以并行运行 DAG，避免对提取的数据进行锁定，并在读取相同数据时优化性能。不再相关的数据可以存档并从数据库中删除。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;19:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;强制幂等约束&lt;/b&gt;：DAG 运行的结果应始终具有幂等特性。这意味着当您使用相同的参数多次运行某个流程时（即使在不同的日期），结果也将完全相同。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;20:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;有条件地执行&lt;/b&gt;：Airflow 具有一些选项，可根据之前的实例的成功来控制 DAG 中任务的运行方式。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;13-dolphindboperator&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;1.3. DolphinDBOperator&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDBOperator 是 Airflow 的 operator 一种，通过 DolphinDBOperator 可以在 Airflow 连接 DolphinDB 进行数据写入、查询、计算等操作。DolphinDBOperator 特有的参数有：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;26:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dolphindb_conn_id&lt;/codeph&gt;: 用于指定 DolphinDB 连接，可在 connection 中设置&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;27:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;sql&lt;/codeph&gt;: 指定需要运行的 DolphinDB 脚本&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;28:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;file_path&lt;/codeph&gt;: 可以指定 DolphinDB dos 文件运行脚本&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDBOperator 使用示例如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;31:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;通过 sql 参数指定任务内容运行脚本：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;33:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;//在 DolphinDB 中创建一个共享表 create_parameter_table = DolphinDBOperator( task_id='create_parameter_table', dolphindb_conn_id='dolphindb_test', sql=''' undef(`paramTable,SHARED) t = table(1:0, `param`value, [STRING, STRING]) share t as paramTable ''' )&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;45:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;通过 file_path 指定 dos 文件运行脚本：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;47:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt; //CalAlpha001.dos 为 DolphinDB 脚本 case1 = DolphinDBOperator( task_id='case1', dolphindb_conn_id='dolphindb_test', file_path=path + &#34;/StreamCalculating/CalAlpha001.dos&#34; )&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;14-airflow-安装部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;1.4. Airflow 安装部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;58:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;58:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;硬件环境&lt;/b&gt;：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:1;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;硬件名称&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;60:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;配置信息&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;62:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;62:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:3;62:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;主机名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;62:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;HostName&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;63:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:5;63:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;外网 IP&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:6;63:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;xxx.xxx.xxx.122&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;64:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:7;64:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;操作系统&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:8;64:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Linux（内核版本3.10以上）&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;65:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:9;65:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;内存&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:10;65:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;64 GB&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;66:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:11;66:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;CPU&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:12;66:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;x86_64（12核心）&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;68:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;68:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;软件环境&lt;/b&gt;：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:2;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:3;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:4;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:13;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;软件名称&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:14;70:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;版本信息&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;72:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;72:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:15;72:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDB&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:16;72:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.00.9&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;73:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:17;73:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Airflow&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:18;73:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.5.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;74:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:19;74:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;python&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:20;74:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;3.7及以上&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;注意&lt;/b&gt;：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;78:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;本教程使用 SQLite 数据库作为后端存储，如果因 SQLite 版本过低无法启动，可参考&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://airflow.apache.org/docs/apache-airflow/stable/howto/set-up-database.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;78:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;设置数据库&lt;/xref&gt;，升级 SQLlite 或更改默认数据库。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;79:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;在流程开始前建议预先构建 DolphinDB 服务。具体安装方法可以参考 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;ha_cluster_deployment.md&#34; xtrc=&#34;xref:2;79:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 高可用集群部署教程&lt;/xref&gt;。也可以参考基于 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;docker-compose_high_cluster.md&#34; xtrc=&#34;xref:3;79:96&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;Docker-Compose 的 DolphinDB 多容器集群部署&lt;/xref&gt;。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;81:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;81:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;主机环境&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;83:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;83:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;83:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;执行以下命令安装 Airflow：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;85:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;pip install airflow-provider-dolphindb&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;89:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;89:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;安装好 airflow.provider.dolphindb 插件后，启动 Airflow ：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;91:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;部署以及安装 Airflow 详情见官网：&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://airflow.apache.org/docs/apache-airflow/stable/start.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:4;91:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;airflow 快速入门&lt;/xref&gt;。以下为启动 Airflow 的核心代码:&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;93:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;#初始化数据库 airflow db init #创建用户 airflow users create --username admin --firstname Peter --lastname Parker --role Admin --email spiderman@superhero.org --password admin # 守护进程运行 webserver airflow webserver --port 8080 -D # 守护进程运行 scheduler airflow scheduler -D&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;107:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;107:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;执行以下命令验证 Airflow 是否成功启动：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;109:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ps -aux|grep airflow&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;113:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;预期输出如下图，证明 Airflow 启动成功：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_1.png&#34; xtrc=&#34;image:2;115:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1521&#34; dita-ot:image-height=&#34;201&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;117:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;117:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;启动成功后，浏览器中登录 Airflow 的 web 界面：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;119:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;119:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;默认地址：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;119:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;http://IP:8080&lt;/codeph&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;120:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;默认账户：初始化 db 中创建，本文例子中为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;120:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;admin&lt;/codeph&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;121:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;默认密码：初始化 db 中创建, 本文例子中为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;121:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;admin&lt;/codeph&gt;&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_2.png&#34; xtrc=&#34;image:3;123:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1032&#34; dita-ot:image-height=&#34;311&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;125:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;125:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;输入上述创建用户名密码即可进入 Airflow 的 UI 界面，如下所示:&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_3.png&#34; xtrc=&#34;image:4;127:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1881&#34; dita-ot:image-height=&#34;653&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;129:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;129:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;填写 DolphinDB 连接信息后连接到 DolphinDB 数据库。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_4.png&#34; xtrc=&#34;image:5;131:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1469&#34; dita-ot:image-height=&#34;293&#34;/&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_5.png&#34; xtrc=&#34;image:6;134:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1101&#34; dita-ot:image-height=&#34;695&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;136:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;连接成功后，在 DolphinDBOperator 中指定 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;136:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dolphindb_conn_id='dolphindb_test'&lt;/codeph&gt;，即可运行 DolphinDB 脚本。上述准备工作完成后，下文以一个股票快照数据的 ETL 过程为例展现 Airflow 如何和 DolphinDB 交互。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-airflow-调度对行情数据-etl&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2. Airflow 调度对行情数据 ETL&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-整体-etl-架构图&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.1. 整体 ETL 架构图&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_1.png&#34; xtrc=&#34;image:7;142:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;683&#34; dita-ot:image-height=&#34;827&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL 平台功能模块代码目录结构&lt;/b&gt;&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_2.png&#34; xtrc=&#34;image:8;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;328&#34; dita-ot:image-height=&#34;528&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;功能模块代码目录结构详解&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;151:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;151:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;add&lt;/i&gt;：增量数据 ETL&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;152:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;152:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;addLoadSnapshot：每日新增 Snapshot 原始数据导入&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;153:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;addProcessSnapshot：增量 Snapshot 处理成 ArrayVector 以及清洗数据&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;154:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;addFactor：增加合成日 K 及一分钟 K 数据并存储&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;155:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;addETL.py：构建增量数据 DAG&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;157:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;157:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;full&lt;/i&gt;：全量数据 ETL&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;158:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;158:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;loadSnapshot：Snapshot 建表与导入&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;159:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;processSnapshot：Snapshot 清洗结果建表，将数据处理成 ArrayVector 以及清洗数据并存储&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;160:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Factor：创建因子存储表，将清洗后数据加工成日 K 以及一分钟 K 数据并存储&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;161:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;fullETL.py：构建全量数据 DAG&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;163:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;外部数据源 - &amp;gt; ODS 数据源&lt;/b&gt;：将原始数据从外部数据源导入 DolphinDB&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;165:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ODS 数据源 - &amp;gt;DWD 数据明细&lt;/b&gt;：清洗原始数据，将原始数据中的多档数据清洗成 ArrayVector 并去重&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;167:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DWD 数据明细 - &amp;gt; DWB/DWS 数据汇总&lt;/b&gt;: 对清洗后的快照数据进行计算加工合成 K 线数据&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;169:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;注意&lt;/b&gt;：本教程使用 DolphinDB 中 module 功能以及 DolphinDB 客户端工具进行工程化管理 DolphinDB 脚本，详细介绍见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;module_tutorial.md&#34; xtrc=&#34;xref:5;169:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB教程: 模块&lt;/xref&gt; 以及 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../getstarted/use_clients_server.dita&#34; xtrc=&#34;xref:6;169:121&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;使用客户端&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-数据介绍&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.2. 数据介绍&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;171:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;173:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;本教程选取了 2020.01.04 - 2021.01.08 全市场所有股票的 5 天的 level 2 快照数据。以下是快照表在DolphinDB的结构。BidOrderQty，BidPrice，BidNumOrders，BidOrders，OfferPrice，OfferOrderQty，OfferNumOrders 和 OfferOrders 8个字段分别包含多档数据，在 DolphinDB 中采用 ArrayVector 数据类型来保存：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:3;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:5;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:6;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:7;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:21;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;字段名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:22;175:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;字段含义&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:23;175:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;数据类型（DolphinDB）&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:24;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;SecurityID&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:25;177:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;证券代码&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:26;177:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;SYMBOL&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;178:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:27;178:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DateTime&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:28;178:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;日期时间&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:29;178:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;TIMESTAMP&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:30;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;PreClosePx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:31;179:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;昨收价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:32;179:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:33;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;OpenPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:34;180:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;开始价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:35;180:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:36;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;HighPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:37;181:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;最高价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:38;181:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:39;182:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;LowPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:40;182:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;最低价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:41;182:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:42;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;LastPx&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:43;183:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;最新价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:44;183:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:45;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;TotalVolumeTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:46;184:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;成交总量&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:47;184:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;INT&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:48;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;TotalValueTrade&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:49;185:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;成交总金额&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:50;185:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:51;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;InstrumentStatus&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:52;186:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;交易状态&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:53;186:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;SYMBOL&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:54;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;BidPrice&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:55;187:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申买十价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:56;187:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:57;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;BidOrderQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:58;188:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申买十量&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:59;188:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;INT[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:60;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;BidNumOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:61;189:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申买十实际总委托笔 数&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:62;189:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;INT[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:63;190:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;BidOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:64;190:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申买一前 50 笔订单&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;15&#34; xtrc=&#34;entry:65;190:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;INT[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:66;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;OfferPrice&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:67;191:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申卖十价&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;16&#34; xtrc=&#34;entry:68;191:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DOUBLE[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:69;192:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;OfferOrderQty&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:70;192:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申卖十量&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;17&#34; xtrc=&#34;entry:71;192:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;INT[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:72;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;OfferNumOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:73;193:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申卖十实际总委托笔 数&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;18&#34; xtrc=&#34;entry:74;193:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;INT[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:75;194:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;OfferOrders&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:76;194:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;申卖一前 50 笔订单&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;19&#34; xtrc=&#34;entry:77;194:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;INT[]&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:78;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;……&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:79;195:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;……&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;20&#34; xtrc=&#34;entry:80;195:45&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;……&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-dolphindb-核心清洗脚本介绍&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.3. DolphinDB 核心清洗脚本介绍&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;231-创建分布式库表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.3.1. 创建分布式库表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;201:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;创建 snapshot 原始数据存储表：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;203:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;创建存储原始 snapshot 原始数据的库表，核心代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;204:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;module loadSnapshot::createSnapshotTable //创建 snapshot 原始数据存储库表 def createSnapshot(dbName, tbName){ login(&#34;admin&#34;, &#34;123456&#34;) if(existsDatabase(dbName)){ dropDatabase(dbName) } db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 50]) //按天和股票代码组合分区 db = database(dbName,COMPO,[db1,db2],engine='TSDB') colName = [&#34;SecurityID&#34;,&#34;DateTime&#34;,&#34;PreClosePx&#34;,&#34;OpenPx&#34;,&#34;HighPx&#34;,&#34;LowPx&#34;,&#34;LastPx&#34;,&#34;TotalVolumeTrade&#34;,&#34;TotalValueTrade&#34;,&#34;InstrumentStatus&#34;,&#34;BidPrice0&#34;,&#34;BidPrice1&#34;,&#34;BidPrice2&#34;,&#34;BidPrice3&#34;,&#34;BidPrice4&#34;,&#34;BidPrice5&#34;,&#34;BidPrice6&#34;,&#34;BidPrice7&#34;,&#34;BidPrice8&#34;,&#34;BidPrice9&#34;,&#34;BidOrderQty0&#34;,&#34;BidOrderQty1&#34;,&#34;BidOrderQty2&#34;,&#34;BidOrderQty3&#34;,&#34;BidOrderQty4&#34;,&#34;BidOrderQty5&#34;,&#34;BidOrderQty6&#34;,&#34;BidOrderQty7&#34;,&#34;BidOrderQty8&#34;,&#34;BidOrderQty9&#34;,&#34;BidNumOrders0&#34;,&#34;BidNumOrders1&#34;,&#34;BidNumOrders2&#34;,&#34;BidNumOrders3&#34;,&#34;BidNumOrders4&#34;,&#34;BidNumOrders5&#34;,&#34;BidNumOrders6&#34;,&#34;BidNumOrders7&#34;,&#34;BidNumOrders8&#34;,&#34;BidNumOrders9&#34;,&#34;BidOrders0&#34;,&#34;BidOrders1&#34;,&#34;BidOrders2&#34;,&#34;BidOrders3&#34;,&#34;BidOrders4&#34;,&#34;BidOrders5&#34;,&#34;BidOrders6&#34;,&#34;BidOrders7&#34;,&#34;BidOrders8&#34;,&#34;BidOrders9&#34;,&#34;BidOrders10&#34;,&#34;BidOrders11&#34;,&#34;BidOrders12&#34;,&#34;BidOrders13&#34;,&#34;BidOrders14&#34;,&#34;BidOrders15&#34;,&#34;BidOrders16&#34;,&#34;BidOrders17&#34;,&#34;BidOrders18&#34;,&#34;BidOrders19&#34;,&#34;BidOrders20&#34;,&#34;BidOrders21&#34;,&#34;BidOrders22&#34;,&#34;BidOrders23&#34;,&#34;BidOrders24&#34;,&#34;BidOrders25&#34;,&#34;BidOrders26&#34;,&#34;BidOrders27&#34;,&#34;BidOrders28&#34;,&#34;BidOrders29&#34;,&#34;BidOrders30&#34;,&#34;BidOrders31&#34;,&#34;BidOrders32&#34;,&#34;BidOrders33&#34;,&#34;BidOrders34&#34;,&#34;BidOrders35&#34;,&#34;BidOrders36&#34;,&#34;BidOrders37&#34;,&#34;BidOrders38&#34;,&#34;BidOrders39&#34;,&#34;BidOrders40&#34;,&#34;BidOrders41&#34;,&#34;BidOrders42&#34;,&#34;BidOrders43&#34;,&#34;BidOrders44&#34;,&#34;BidOrders45&#34;,&#34;BidOrders46&#34;,&#34;BidOrders47&#34;,&#34;BidOrders48&#34;,&#34;BidOrders49&#34;,&#34;OfferPrice0&#34;,&#34;OfferPrice1&#34;,&#34;OfferPrice2&#34;,&#34;OfferPrice3&#34;,&#34;OfferPrice4&#34;,&#34;OfferPrice5&#34;,&#34;OfferPrice6&#34;,&#34;OfferPrice7&#34;,&#34;OfferPrice8&#34;,&#34;OfferPrice9&#34;,&#34;OfferOrderQty0&#34;,&#34;OfferOrderQty1&#34;,&#34;OfferOrderQty2&#34;,&#34;OfferOrderQty3&#34;,&#34;OfferOrderQty4&#34;,&#34;OfferOrderQty5&#34;,&#34;OfferOrderQty6&#34;,&#34;OfferOrderQty7&#34;,&#34;OfferOrderQty8&#34;,&#34;OfferOrderQty9&#34;,&#34;OfferNumOrders0&#34;,&#34;OfferNumOrders1&#34;,&#34;OfferNumOrders2&#34;,&#34;OfferNumOrders3&#34;,&#34;OfferNumOrders4&#34;,&#34;OfferNumOrders5&#34;,&#34;OfferNumOrders6&#34;,&#34;OfferNumOrders7&#34;,&#34;OfferNumOrders8&#34;,&#34;OfferNumOrders9&#34;,&#34;OfferOrders0&#34;,&#34;OfferOrders1&#34;,&#34;OfferOrders2&#34;,&#34;OfferOrders3&#34;,&#34;OfferOrders4&#34;,&#34;OfferOrders5&#34;,&#34;OfferOrders6&#34;,&#34;OfferOrders7&#34;,&#34;OfferOrders8&#34;,&#34;OfferOrders9&#34;,&#34;OfferOrders10&#34;,&#34;OfferOrders11&#34;,&#34;OfferOrders12&#34;,&#34;OfferOrders13&#34;,&#34;OfferOrders14&#34;,&#34;OfferOrders15&#34;,&#34;OfferOrders16&#34;,&#34;OfferOrders17&#34;,&#34;OfferOrders18&#34;,&#34;OfferOrders19&#34;,&#34;OfferOrders20&#34;,&#34;OfferOrders21&#34;,&#34;OfferOrders22&#34;,&#34;OfferOrders23&#34;,&#34;OfferOrders24&#34;,&#34;OfferOrders25&#34;,&#34;OfferOrders26&#34;,&#34;OfferOrders27&#34;,&#34;OfferOrders28&#34;,&#34;OfferOrders29&#34;,&#34;OfferOrders30&#34;,&#34;OfferOrders31&#34;,&#34;OfferOrders32&#34;,&#34;OfferOrders33&#34;,&#34;OfferOrders34&#34;,&#34;OfferOrders35&#34;,&#34;OfferOrders36&#34;,&#34;OfferOrders37&#34;,&#34;OfferOrders38&#34;,&#34;OfferOrders39&#34;,&#34;OfferOrders40&#34;,&#34;OfferOrders41&#34;,&#34;OfferOrders42&#34;,&#34;OfferOrders43&#34;,&#34;OfferOrders44&#34;,&#34;OfferOrders45&#34;,&#34;OfferOrders46&#34;,&#34;OfferOrders47&#34;,&#34;OfferOrders48&#34;,&#34;OfferOrders49&#34;,&#34;NumTrades&#34;,&#34;IOPV&#34;,&#34;TotalBidQty&#34;,&#34;TotalOfferQty&#34;,&#34;WeightedAvgBidPx&#34;,&#34;WeightedAvgOfferPx&#34;,&#34;TotalBidNumber&#34;,&#34;TotalOfferNumber&#34;,&#34;BidTradeMaxDuration&#34;,&#34;OfferTradeMaxDuration&#34;,&#34;NumBidOrders&#34;,&#34;NumOfferOrders&#34;,&#34;WithdrawBuyNumber&#34;,&#34;WithdrawBuyAmount&#34;,&#34;WithdrawBuyMoney&#34;,&#34;WithdrawSellNumber&#34;,&#34;WithdrawSellAmount&#34;,&#34;WithdrawSellMoney&#34;,&#34;ETFBuyNumber&#34;,&#34;ETFBuyAmount&#34;,&#34;ETFBuyMoney&#34;,&#34;ETFSellNumber&#34;,&#34;ETFSellAmount&#34;,&#34;ETFSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] schemaTable = table(1:0,colName, colType) db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`DateTime`SecurityID, compressMethods={DateTime:&#34;delta&#34;}, sortColumns=`SecurityID`DateTime, keepDuplicates=ALL) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;225:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;对于 snapshot 数据，本文采用的数据库分区方案是组合分区，第一层按天分区，第二层对股票代码按 HASH 分50个分区。如何根据数据确定分区方案可参考 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;database.md&#34; xtrc=&#34;xref:7;225:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 分区数据库教程&lt;/xref&gt;。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;227:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;创建清洗后 snapshot 数据存储表：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;229:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;创建清洗后以 Array 格式存储 snapshot 数据的库表，核心代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;231:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;module processSnapshot::createSnapshot_array //创建清洗后的 snapshot 数据存储表 def createProcessTable(dbName, tbName){ if(existsDatabase(dbName)){ dropDatabase(dbName) } db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 50]) //按天和股票代码组合分区 db = database(dbName,COMPO,[db1,db2],engine='TSDB') colName = [&#34;SecurityID&#34;,&#34;DateTime&#34;,&#34;PreClosePx&#34;,&#34;OpenPx&#34;,&#34;HighPx&#34;,&#34;LowPx&#34;,&#34;LastPx&#34;,&#34;TotalVolumeTrade&#34;,&#34;TotalValueTrade&#34;,&#34;InstrumentStatus&#34;,&#34;BidPrice&#34;,&#34;BidOrderQty&#34;,&#34;BidNumOrders&#34;,&#34;BidOrders&#34;,&#34;OfferPrice&#34;,&#34;OfferOrderQty&#34;,&#34;OfferNumOrders&#34;,&#34;OfferOrders&#34;,&#34;NumTrades&#34;,&#34;IOPV&#34;,&#34;TotalBidQty&#34;,&#34;TotalOfferQty&#34;,&#34;WeightedAvgBidPx&#34;,&#34;WeightedAvgOfferPx&#34;,&#34;TotalBidNumber&#34;,&#34;TotalOfferNumber&#34;,&#34;BidTradeMaxDuration&#34;,&#34;OfferTradeMaxDuration&#34;,&#34;NumBidOrders&#34;,&#34;NumOfferOrders&#34;,&#34;WithdrawBuyNumber&#34;,&#34;WithdrawBuyAmount&#34;,&#34;WithdrawBuyMoney&#34;,&#34;WithdrawSellNumber&#34;,&#34;WithdrawSellAmount&#34;,&#34;WithdrawSellMoney&#34;,&#34;ETFBuyNumber&#34;,&#34;ETFBuyAmount&#34;,&#34;ETFBuyMoney&#34;,&#34;ETFSellNumber&#34;,&#34;ETFSellAmount&#34;,&#34;ETFSellMoney&#34;] colType = [&#34;SYMBOL&#34;,&#34;TIMESTAMP&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;SYMBOL&#34;,&#34;DOUBLE[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;DOUBLE[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;INT[]&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;DOUBLE&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;,&#34;INT&#34;] schemaTable = table(1:0, colName, colType) db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`DateTime`SecurityID, compressMethods={DateTime:&#34;delta&#34;}, sortColumns=`SecurityID`DateTime, keepDuplicates=ALL) }&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;250:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;250:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;创建 K 线结果存储表：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;252:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;创建分钟级 K 线结果存储表，核心代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;254:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;module Factor::createFactorOneMinute //创建分钟 k 线因子储存表 def createFactorOneMinute(dbName, tbName){ if(existsDatabase(dbName)){ dropDatabase(dbName) } //按天分区 db = database(dbName, VALUE, 2021.01.01..2021.01.03,engine = `TSDB) colName = `TradeDate`TradeTime`SecurityID`Open`High`Low`Close`Volume`Amount`Vwap colType =[DATE, MINUTE, SYMBOL, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, DOUBLE] tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema,tableName=tbName,partitionColumns=`TradeDate,sortColumns=`SecurityID`TradeTime,keepDuplicates=ALL) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;271:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;创建日级 K 线结果存储表，核心代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;273:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;module Factor::createFactorDaily //创建日 K 线储存表 def createFactorDaily(dbName, tbName){ if(existsDatabase(dbName)){ dropDatabase(dbName) } //按年分区 db = database(dbName, RANGE, datetimeAdd(2000.01M,(0..50)*12, &#34;M&#34;),engine = `TSDB) colName = `TradeDate`SecurityID`Open`High`Low`Close`Volume`Amount`Vwap colType =[DATE, SYMBOL, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, DOUBLE] tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema,tableName=tbName,partitionColumns=`TradeDate,sortColumns=`SecurityID`TradeDate,keepDuplicates=ALL) }&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;232-数据清洗&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.3.2. 数据清洗&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;本文将 snapshot 数据的清洗主要分为两个部分：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;将多档价格、委托量以 Array 形式储存&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;数据去重&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;具体的处理流程及核心代码如下:&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;module processSnapshot::processSnapshotData //将数据组合为 array、去重，并统计重复数据量 def mapProcess(mutable t, dbName, tbName){ n1 = t.size() t = select SecurityID, DateTime, PreClosePx, OpenPx, HighPx, LowPx, LastPx, TotalVolumeTrade, TotalValueTrade, InstrumentStatus, fixedLengthArrayVector(BidPrice0, BidPrice1, BidPrice2, BidPrice3, BidPrice4, BidPrice5, BidPrice6, BidPrice7, BidPrice8, BidPrice9) as BidPrice, fixedLengthArrayVector(BidOrderQty0, BidOrderQty1, BidOrderQty2, BidOrderQty3, BidOrderQty4, BidOrderQty5, BidOrderQty6, BidOrderQty7, BidOrderQty8, BidOrderQty9) as BidOrderQty, fixedLengthArrayVector(BidNumOrders0, BidNumOrders1, BidNumOrders2, BidNumOrders3, BidNumOrders4, BidNumOrders5, BidNumOrders6, BidNumOrders7, BidNumOrders8, BidNumOrders9) as BidNumOrders, fixedLengthArrayVector(BidOrders0, BidOrders1, BidOrders2, BidOrders3, BidOrders4, BidOrders5, BidOrders6, BidOrders7, BidOrders8, BidOrders9, BidOrders10, BidOrders11, BidOrders12, BidOrders13, BidOrders14, BidOrders15, BidOrders16, BidOrders17, BidOrders18, BidOrders19, BidOrders20, BidOrders21, BidOrders22, BidOrders23, BidOrders24, BidOrders25, BidOrders26, BidOrders27, BidOrders28, BidOrders29, BidOrders30, BidOrders31, BidOrders32, BidOrders33, BidOrders34, BidOrders35, BidOrders36, BidOrders37, BidOrders38, BidOrders39, BidOrders40, BidOrders41, BidOrders42, BidOrders43, BidOrders44, BidOrders45, BidOrders46, BidOrders47, BidOrders48, BidOrders49) as BidOrders, fixedLengthArrayVector(OfferPrice0, OfferPrice1, OfferPrice2, OfferPrice3, OfferPrice4, OfferPrice5, OfferPrice6, OfferPrice7, OfferPrice8, OfferPrice9) as OfferPrice, fixedLengthArrayVector(OfferOrderQty0, OfferOrderQty1, OfferOrderQty2, OfferOrderQty3, OfferOrderQty4, OfferOrderQty5, OfferOrderQty6, OfferOrderQty7, OfferOrderQty8, OfferOrderQty9) as OfferQty, fixedLengthArrayVector(OfferNumOrders0, OfferNumOrders1, OfferNumOrders2, OfferNumOrders3, OfferNumOrders4, OfferNumOrders5, OfferNumOrders6, OfferNumOrders7, OfferNumOrders8, OfferNumOrders9) as OfferNumOrders, fixedLengthArrayVector(OfferOrders0, OfferOrders1, OfferOrders2, OfferOrders3, OfferOrders4, OfferOrders5, OfferOrders6, OfferOrders7, OfferOrders8, OfferOrders9, OfferOrders10, OfferOrders11, OfferOrders12, OfferOrders13, OfferOrders14, OfferOrders15, OfferOrders16, OfferOrders17, OfferOrders18, OfferOrders19, OfferOrders20, OfferOrders21, OfferOrders22, OfferOrders23, OfferOrders24, OfferOrders25, OfferOrders26, OfferOrders27, OfferOrders28, OfferOrders29, OfferOrders30, OfferOrders31, OfferOrders32, OfferOrders33, OfferOrders34, OfferOrders35, OfferOrders36, OfferOrders37, OfferOrders38, OfferOrders39, OfferOrders40, OfferOrders41, OfferOrders42, OfferOrders43, OfferOrders44, OfferOrders45, OfferOrders46, OfferOrders47, OfferOrders48, OfferOrders49) as OfferOrders, NumTrades, IOPV, TotalBidQty, TotalOfferQty, WeightedAvgBidPx, WeightedAvgOfferPx, TotalBidNumber, TotalOfferNumber, BidTradeMaxDuration, OfferTradeMaxDuration, NumBidOrders, NumOfferOrders, WithdrawBuyNumber, WithdrawBuyAmount, WithdrawBuyMoney, WithdrawSellNumber, WithdrawSellAmount, WithdrawSellMoney, ETFBuyNumber, ETFBuyAmount, ETFBuyMoney, ETFSellNumber, ETFSellAmount, ETFSellMoney from t where isDuplicated([SecurityID, DateTime], FIRST) = false n2 = t.size() loadTable(dbName, tbName).append!(t) return n1,n2 } def process(processDate, dbName_orig, tbName_orig, dbName_process, tbName_process){ dataString = temporalFormat(processDate, &#34;yyyyMMdd&#34;) //查询处理日期的数据在数据库中是否存在 todayCount = exec count(*) from loadTable(dbName_process, tbName_process) where date(DateTime)=processDate //如果库里面已经存在当天要处理的数据，删除库里面已有数据 if(todayCount != 0){ writeLog(&#34;Start to delete the process snapshot data, the delete date is: &#34; + dataString) dropPartition(database(dbName_process), processDate, tbName_process) writeLog(&#34;Successfully deleted the process snapshot data, the delete date is: &#34; + dataString) } //开始处理数据 writeLog(&#34;Start process Snapshot Data, the datetime is &#34;+ dataString) ds = sqlDS(sql(select=sqlCol(&#34;*&#34;), from=loadTable(dbName_orig,tbName_orig),where=&amp;lt;date(DateTime)=processDate&amp;gt;)) n1,n2=mr(ds, mapProcess{, dbName_process, tbName_process}, +, , false) if(n1 != n2){ writeLog(&#34;ERROR: Duplicated datas exists in &#34; + dataString + &#34;, Successfully drop &#34; + string(n1-n2) + &#34; pieces of data&#34; ) } writeLog(&#34;Successfully process the snapshot data, the processDate is: &#34; + dataString) }&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;233-清洗行情数据合成-k-线&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.3.3. 清洗行情数据合成 K 线&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;332:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;334:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;分钟级 K 线合成并入库, 核心代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;335:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;module Factor::calFactorOneMinute //合成分钟 K 线并入库 def calFactorOneMinute(dbName, tbName, mutable factorTable){ pt = loadTable(dbName, tbName) //将数据分为10天一组计算 dayList = schema(pt).partitionSchema[0] if(dayList.size()&amp;gt;10) dayList = dayList.cut(10) for(days in dayList){ //计算分钟 K 线 res = select first(LastPX) as Open, max(LastPx) as High, min(LastPx) as Low, last(LastPx) as Close, sum(TotalVolumeTrade) as Volume, sum(LastPx*totalVolumeTrade) as Amount, wavg(LastPx, TotalVolumeTrade) as Vwap from pt where date(DateTime) in days group by date(DateTime) as TradeDate,minute(DateTime) as TradeTime, SecurityID writeLog(&#34;Start to append minute factor result , the days is: [&#34; + concat(days, &#34;,&#34;)+&#34;]&#34;) //分钟 K 线入库 factorTable.append!(res) writeLog(&#34;Successfully append the minute factor result to databse, the days is: [&#34; + concat(days, &#34;,&#34;)+&#34;]&#34;) } }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;355:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;日级 K 线合成并入库, 核心代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;module Factor::calFactorDaily1 //合成日 K 线并入库 def calFactorDaily(dbName, tbName, mutable factorTable){ pt = loadTable(dbName, tbName) //将数据分为10天一组计算 dayList = schema(pt).partitionSchema[0] if(dayList.size()&amp;gt;10) dayList = dayList.cut(10) for(days in dayList){ //计算日 K 线 res = select first(LastPX) as Open, max(LastPx) as High, min(LastPx) as Low, last(LastPx) as Close, sum(TotalVolumeTrade) as Volume, sum(LastPx*totalVolumeTrade) as Amount, wavg(LastPx, TotalVolumeTrade) as Vwap from pt where date(DateTime) in days group by date(DateTime) as TradeDate, SecurityID writeLog(&#34;Start to append daily factor result , the days is: [&#34; + concat(days, &#34;,&#34;)+&#34;]&#34;) //日 K 线入库 factorTable.append!(res) writeLog(&#34;Successfully append the daily factor result to databse, the days is: [&#34; + concat(days, &#34;,&#34;)+&#34;]&#34;) } }&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;24-增量数据清洗&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.4. 增量数据清洗&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;378:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;增量数据的导入和全量数据的导入整体逻辑相同，主要区别如下：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;380:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;380:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;全量数据批量导入，增量数据每天定时执行&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:41;381:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;全量数据导入通过 DolphinDB submitjob 异步提交任务，增量数据导入通过调用 append! 接口同步导入&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:42;382:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;数据加工 K 线全量数据批量加工，增量数据只加工当天数据&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;384:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;具体代码差别见附件。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;25-airflow-生成-dag-执行任务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;386:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;386:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.5. Airflow 生成 DAG 执行任务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;386:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;251-生成一个-dag-实例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;388:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;388:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.5.1. 生成一个 DAG 实例&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;388:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;390:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;生成全量 DAG 实例的示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;391:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;with DAG(dag_id=&#34;ETLTest&#34;, start_date=datetime(2023, 3, 10), schedule_interval=None) as dag:&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;394:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dag_id&lt;/codeph&gt; 指定了 DAG 名称，需要具有唯一性；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;394:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;start_date&lt;/codeph&gt; 设定任务开始日期；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;394:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;schedule_interval&lt;/codeph&gt; 指定两次任务的间隔；&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;394:81&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;None&lt;/codeph&gt; 表示该任务不自动执行需手动触发。 增量 DAG 示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;397:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;args = { &#34;owner&#34; : &#34;Airflow&#34;, &#34;start_date&#34; : days_ago(1), &#34;catchup&#34; : False, 'retries' : 0 } with DAG(dag_id=&#34;addETLTest&#34;, default_args = args, schedule_interval=&#34;0 12 * * *&#34;) as dag:&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;407:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;增量 DAG 中 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;407:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;catchup&lt;/codeph&gt; 表示是否进行回填任务操作，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;407:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;retries&lt;/codeph&gt; 表示任务失败重试次数，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;407:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;schedule_interval = “0 12 * * * ”&lt;/codeph&gt; 表示在每天12点 (UTC) 运行任务。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;407:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;schedule&lt;/codeph&gt; 设置详细可参考：&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://airflow.apache.org/docs/apache-airflow/1.10.10/scheduler.html#scheduling-triggers&#34; scope=&#34;external&#34; xtrc=&#34;xref:8;407:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;Scheduling &amp;amp; Triggers&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;252-获取-airflow-中的变量&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.5.2. 获取 Airflow 中的变量&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Airflow 中设定的变量值，无法直接在 DolphinDB 脚本中获取，为了在后续的任务中使用，本文通过将 Airflow 中变量写入共享表的方式，来实现后续在 DolphinDB 任务读取变量，具体代码示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;//获取变量值 variable = ['ETL_dbName_origin', &#34;ETL_tbName_origin&#34;, &#34;ETL_dbName_process&#34;, &#34;ETL_tbName_process&#34;, 'ETL_dbName_factor','ETL_tbName_factor','ETL_dbName_factor_daily', 'ETL_tbName_factor_daily',&#34;ETL_filedir&#34;, &#34;ETL_start_date&#34;,&#34;ETL_end_date&#34;] value = [] for var in variable: value.append(str(Variable.get(var))) variables = &#34;,&#34;.join(variable) values = &#34;,&#34;.join(value) //通过DolphinDBOperator创建共享表，并将变量值写入共享表中 create_parameter_table = DolphinDBOperator( task_id='create_parameter_table', dolphindb_conn_id='dolphindb_test', sql=''' undef(`paramTable,SHARED) t = table(1:0, `param`value, [STRING, STRING]) share t as paramTable ''' ) given_param = DolphinDBOperator( task_id='given_param', dolphindb_conn_id='dolphindb_test', sql=&#34;params = split('&#34; + variables + &#34;',',');&#34; + \ &#34;values = split('&#34; + values + &#34;',',');&#34; + \ &#34;for(i in 0..(params.size()-1)){&#34; + \ &#34;insert into paramTable values(params[i], values[i]);}&#34; )&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;运行该任务后可在 DolphinDB GUI 共享变量栏中看到参数表及其值，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_3.png&#34; xtrc=&#34;image:9;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;284&#34; dita-ot:image-height=&#34;167&#34;/&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_4.png&#34; xtrc=&#34;image:10;447:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;367&#34; dita-ot:image-height=&#34;263&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;每个 DAG 变量的值可以通过 AirFlow 进行修改，点击下图所示位置：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_5.png&#34; xtrc=&#34;image:11;451:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;890&#34; dita-ot:image-height=&#34;259&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;453:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DAG 生成后，在如下 Web 页面显示 DAG 使用的变量可以动态修改，如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_6.png&#34; xtrc=&#34;image:12;455:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1546&#34; dita-ot:image-height=&#34;515&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;下表为本项目中涉及的变量名称及其含义：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:4;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:8;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:9;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:10;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:81;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;459:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;变量名&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:82;459:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;459:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;变量描述&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:83;459:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;459:68&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;变量示例&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:84;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_dbName_factor&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:85;461:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储合成的分钟 k 线的库名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:86;461:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dfs://oneMinuteFactor&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;462:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:87;462:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_tbName_factor&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:88;462:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储合成的分钟 k 线的表名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:89;462:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;oneMinuteFactor&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:90;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_dbName_factor_daily&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:91;463:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储合成的分钟 k 线的库名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:92;463:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dfs://dailyFactor&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;464:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:93;464:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_tbName_factor_daily&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:94;464:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储合成的日 k 线的表名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:95;464:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dailyFactor&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:96;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_dbName_origin&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:97;465:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储未处理的原始 snapshot 数据的库名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:98;465:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dfs://TSDB_snapshot_orig&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:37;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:99;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_tbName_origin&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:100;466:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储未处理的原始 snapshot 数据的表名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:101;466:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;snapshot_orig&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:38;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:102;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_dbName_process&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:103;467:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储清洗后 snapshot 数据的库名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:104;467:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dfs://TSDB_snapshot_process&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:39;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:105;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_tbName_process&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:106;468:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;存储清洗后 snapshot 数据的表名&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:107;468:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;snapshot_process&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:40;469:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:108;469:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_filedir&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:109;469:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;原始 snapshot 数据存储路径&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:110;469:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;/home/appadmin/（根据实际存放路径修改）&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:41;470:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:111;470:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_start_date&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:112;470:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;全量 ETL 任务中需要处理的原始数据的开始日期&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:113;470:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2021.01.04&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:42;471:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:114;471:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_end_date&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:115;471:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;全量 ETL 任务中需要处理的原始数据的结束日期&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:116;471:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2021.01.04&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;253-dolphindboperator-执行任务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;475:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;475:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.5.3. DolphinDBOperator 执行任务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;475:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;477:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:43;477:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;477:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:19;477:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDBOperator 全量处理数据&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;479:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;通过 DolphinDBOperator 将上述的数据入库、清洗、计算等设置为 DAG 中的任务&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;481:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;全量处理核心代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;483:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt; loadSnapshot = DolphinDBOperator( task_id='loadSnapshot', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用 module，加载已封装好的建表及入库函数 use loadSnapshot::createSnapshotTable use loadSnapshot::loadSnapshotData //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName = params[`ETL_dbName_origin] tbName = params[`ETL_tbName_origin] startDate = date(params[`ETL_start_date]) endDate = date(params[`ETL_end_date]) fileDir = params[`ETL_filedir] //结果库表不存在则创建 if(not existsDatabase(dbName)){ loadSnapshot::createSnapshotTable::createSnapshot(dbName, tbName) } //调用清洗函数，后台多进程写入，提高写入效率 start = now() for (loadDate in startDate..endDate){ submitJob(&#34;loadSnapshot&#34;+year(loadDate)+monthOfYear(loadDate)+dayOfMonth(loadDate), &#34;loadSnapshot&#34;, loadSnapshot::loadSnapshotData::loadSnapshot{, dbName, tbName, fileDir}, loadDate) } //查看写入任务是否完成，以保证后续处理部分数据源完整 do{ cnt = exec count(*) from getRecentJobs() where jobDesc=&#34;loadSnapshot&#34; and endTime is null } while(cnt != 0) //查看导入过程中是否有异常，有异常则抛出异常 cnt = exec count(*) from pnodeRun(getRecentJobs) where jobDesc=&#34;loadSnapshot&#34; and errorMsg is not null and receivedTime &amp;gt; start if (cnt != 0){ error = exec errorMsg from pnodeRun(getRecentJobs) where jobDesc=&#34;loadSnapshot&#34; and errorMsg is not null and receivedTime &amp;gt; start throw error[0] } ''' ) processSnapshot = DolphinDBOperator( task_id='processSnapshot', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用 module，加载已封装好的建表及入库函数 use processSnapshot::createSnapshot_array use processSnapshot::processSnapshotData //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName_orig = params[`ETL_dbName_origin] tbName_orig = params[`ETL_tbName_origin] dbName_process = params[`ETL_dbName_process] tbName_process = params[`ETL_tbName_process] startDate = date(params[`ETL_start_date]) endDate = date(params[`ETL_end_date]) //结果库表不存在则创建 if(not existsDatabase(dbName_process)){ processSnapshot::createSnapshot_array::createProcessTable(dbName_process, tbName_process) } //后台多进程处理，提高处理效率 start = now() for (processDate in startDate..endDate){ submitJob(&#34;processSnapshot&#34;+year(processDate)+monthOfYear(processDate)+dayOfMonth(processDate), &#34;processSnapshot&#34;, processSnapshot::processSnapshotData::process{, dbName_orig, tbName_orig, dbName_process, tbName_process}, processDate) } //查看清洗任务是否完成，以保证后续处理部分数据源完整 do{ cnt = exec count(*) from getRecentJobs() where jobDesc=&#34;processSnapshot&#34; and endTime is null } while(cnt != 0) //查看清洗过程中是否有异常，有异常则抛出异常 cnt = exec count(*) from pnodeRun(getRecentJobs) where jobDesc=&#34;processSnapshot&#34; and errorMsg is not null and receivedTime &amp;gt; start if (cnt != 0){ error = exec errorMsg from pnodeRun(getRecentJobs) where jobDesc=&#34;processSnapshot&#34; and errorMsg is not null and receivedTime &amp;gt; start throw error[0] } ''' ) calMinuteFactor = DolphinDBOperator( task_id='calMinuteFactor', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用 module，加载已封装好的建表及入库函数 use Factor::createFactorOneMinute use Factor::calFactorOneMinute //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName = params[`ETL_dbName_process] tbName = params[`ETL_tbName_process] dbName_factor = params[`ETL_dbName_factor] tbName_factor = params[`ETL_tbName_factor] //结果库表不存在则创建 if(not existsDatabase(dbName_factor)){ createFactorOneMinute(dbName_factor, tbName_factor) } factorTable = loadTable(dbName_factor, tbName_factor) //调用计算函数 calFactorOneMinute(dbName, tbName,factorTable) ''' ) calDailyFactor = DolphinDBOperator( task_id='calDailyFactor', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用 module，加载已封装好的建表及入库函数 use Factor::createFactorDaily use Factor::calFactorDaily1 //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName = params[`ETL_dbName_process] tbName = params[`ETL_tbName_process] dbName_factor = params[`ETL_dbName_factor_daily] tbName_factor = params[`ETL_tbName_factor_daily] //结果库表不存在则创建 if(not existsDatabase(dbName_factor)){ createFactorDaily(dbName_factor, tbName_factor) } //调用计算函数 factorTable = loadTable(dbName_factor, tbName_factor) Factor::calFactorDaily1::calFactorDaily(dbName, tbName,factorTable) ''' )&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;615:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;根据任务间的依赖关系，构建 DAG，示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;616:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt; start_task &amp;gt;&amp;gt; create_parameter_table &amp;gt;&amp;gt; given_param &amp;gt;&amp;gt; loadSnapshot &amp;gt;&amp;gt; processSnapshot &amp;gt;&amp;gt; calMinuteFactor &amp;gt;&amp;gt; calDailyFactor&lt;/codeblock&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:44;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;620:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:20;620:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDBOperator 增量数据入库&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;622:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;增量数据任务构建代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;623:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;addLoadSnapshot = DolphinDBOperator( task_id='addLoadSnapshot', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用module，加载已封装好的入库函数 use addLoadSnapshot::loadSnapshotData //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName = params[`ETL_dbName_origin] tbName = params[`ETL_tbName_origin] fileDir = params[`ETL_filedir] //获取交易日历 MarketDays = getMarketCalendar(&#34;CFFEX&#34;) //是交易日则进行数据入库 if(today() in MarketDays ){ fileDir = params[`ETL_filedir] addLoadSnapshot::loadSnapshotData::loadSnapshot(today(), dbName, tbName, fileDir) } ''' ) addProcessSnapshot = DolphinDBOperator( task_id='addProcessSnapshot', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用module，加载已封装好的清洗函数 use addProcessSnapshot::processSnapshotData //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName_orig = params[`ETL_dbName_origin] tbName_orig = params[`ETL_tbName_origin] dbName_process = params[`ETL_dbName_process] tbName_process = params[`ETL_tbName_process] //获取交易日历 MarketDays = getMarketCalendar(&#34;CFFEX&#34;) //是交易日则进行数据处理 if(today() in MarketDays ){ addProcessSnapshot::processSnapshotData::process(today(), dbName_orig, tbName_orig, dbName_process, tbName_process) } ''' ) addCalMinuteFactor= DolphinDBOperator( task_id='addCalMinuteFactor', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用module，加载已封装好的计算函数 use addFactor::calFactorOneMinute //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName = params[`ETL_dbName_process] tbName = params[`ETL_tbName_process] dbName_factor = params[`ETL_dbName_factor] tbName_factor = params[`ETL_tbName_factor] factorTable = loadTable(dbName_factor, tbName_factor) //获取交易日历 MarketDays = getMarketCalendar(&#34;CFFEX&#34;) //是交易日则调用计算函数合成分钟K线 if(today() in MarketDays ){ addFactor::calFactorOneMinute::calFactorOneMinute(dbName, tbName,today(), factorTable) } ''' ) addCalDailyFactor= DolphinDBOperator( task_id='addCalDailyFactor', dolphindb_conn_id='dolphindb_test', sql=''' pnodeRun(clearAllCache) undef(all) go; //使用module，加载已封装好的计算函数 use addFactor::calFactorDaily1 //通过参数共享表获取参数 params = dict(paramTable[`param], paramTable[`value]) dbName = params[`ETL_dbName_process] tbName = params[`ETL_tbName_process] dbName_factor = params[`ETL_dbName_factor_daily] tbName_factor = params[`ETL_tbName_factor_daily] factorTable = loadTable(dbName_factor, tbName_factor) //获取交易日历 MarketDays = getMarketCalendar(&#34;CFFEX&#34;) //是交易日则调用计算函数合成日K线 if(today() in MarketDays ){ addFactor::calFactorDaily1::calFactorDaily(dbName, tbName,today(), factorTable) } ''' )&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;719:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;根据任务间的依赖关系，构建 DAG，示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;720:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt; start_task &amp;gt;&amp;gt; create_parameter_table &amp;gt;&amp;gt; given_param &amp;gt;&amp;gt; addLoadSnapshot &amp;gt;&amp;gt; addProcessSnapshot &amp;gt;&amp;gt; addCalMinuteFactor &amp;gt;&amp;gt; addCalDailyFactor&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;254-生成-dag&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;724:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;724:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;2.5.4. 生成 DAG&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;724:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;726:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;根据如下步骤部署项目：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;728:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:45;728:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;728:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:21;728:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;第一步 DolphinDB 项目部署&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;730:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;将 DolphinDB 项目中的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;730:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;addETL&lt;/i&gt; 和 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;730:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;fullETL&lt;/i&gt; 项目分别导入 DolphinDB GUI (DolphinDB 客户端工具)中：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_7.png&#34; xtrc=&#34;image:13;732:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;266&#34; dita-ot:image-height=&#34;249&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;734:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;将 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;734:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;addETL&lt;/i&gt; 及 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;734:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;fullETL&lt;/i&gt; 项目中的 module 模块上传至 Airflow 中已建立连接的 DolphinDB server 中：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_8.png&#34; xtrc=&#34;image:14;736:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;383&#34; dita-ot:image-height=&#34;464&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:46;738:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;738:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:22;738:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;第二步 python 项目部署&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;740:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;将 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;740:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;python&lt;/i&gt; 项目中的 python 脚本放置到 &amp;lt;Airflow_install_Dir/airflow/dags&amp;gt; 目录下。注意，新建的 DAG 任务并不会马上出现在界面上，默认需要等待5分钟后刷新，也可修改 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:9;740:117&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;airflow.cfg&lt;/i&gt; 文件中的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:10;740:136&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;dag_dir_list_interval&lt;/i&gt; 调整刷新间隔。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:47;742:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;742:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:23;742:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;第三步 Airflow 变量导入&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;744:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;在 Airflow 网页中进入 Admin--&amp;gt;Variables，将 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:11;744:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Variables.json&lt;/i&gt; 文件上传，将变量导入 Airflow 中，并根据实际情况调整变量值。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_9.png&#34; xtrc=&#34;image:15;746:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;649&#34; dita-ot:image-height=&#34;235&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:48;748:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;748:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:24;748:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;第四步 上传原始数据文件&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;750:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;将数据文件上传至服务器，并根据数据文件的实际存放路径，在 Airflow 中修改 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;750:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;ETL_filedir&lt;/codeph&gt; 变量。如运行增量 ETL 任务，需要将数据文件名中的日期改为当前日期，如：&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:12;750:97&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;20230330snapshot.csv&lt;/i&gt;，以避免无数据导致任务失败。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;752:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;最终实现 DAG 如下所示：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;754:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:25;754:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;全量数据入库&lt;/b&gt;：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_10.png&#34; xtrc=&#34;image:16;756:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1081&#34; dita-ot:image-height=&#34;92&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;758:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:26;758:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;增量数据入库&lt;/b&gt;：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_11.png&#34; xtrc=&#34;image:17;760:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1162&#34; dita-ot:image-height=&#34;83&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;762:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;运行任务后，任务实例为绿色代表任务运行成功；红色表示任务运行失败；橙色则表示该任务所依赖的上游任务运行失败，任务未启动。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-常见问题解答faq&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;764:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;764:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;3. 常见问题解答(FAQ)&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;764:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-如何捕获-dolphindb-脚本中的-print-函数打印的信息&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;766:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;766:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;3.1. 如何捕获 DolphinDB 脚本中的 print 函数打印的信息&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;766:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;768:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:49;768:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;768:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDB 脚本的 print 的信息为标准输出，可以在 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;768:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;airflow-scheduler.out&lt;/codeph&gt; 中找到，如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_1.png&#34; xtrc=&#34;image:18;770:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1303&#34; dita-ot:image-height=&#34;353&#34;/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-dolphindb-脚本中的异步作业-submitjob-如何检测其完成状态&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;772:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;772:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;3.2. DolphinDB 脚本中的异步作业 submitjob 如何检测其完成状态&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;772:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;774:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:50;774:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;774:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;通过 DolphinDB 的函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;774:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;getRecntJobs&lt;/codeph&gt; 获取后台作业信息, 之后在 DolphinDB DAG 中添加判断逻辑, 代码示例如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;776:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDBOperator( task_id='processSnapshot', dolphindb_conn_id='dolphindb_test', sql=''' //检查所有任务是否全部完成 do{ cnt = exec count(*) from getRecentJobs() where jobDesc=&#34;processSnapshot&#34; and endTime is null } while(cnt != 0) //检查后台任务是否成功，失败则抛出异常 cnt = exec count(*) from pnodeRun(getRecentJobs) where jobDesc=&#34;processSnapshot&#34; and errorMsg is not null and receivedTime &amp;gt; start if (cnt != 0){ error = exec errorMsg from pnodeRun(getRecentJobs) where jobDesc=&#34;processSnapshot&#34; and errorMsg is not null and receivedTime &amp;gt; start throw error[0] } ''' )&lt;/codeblock&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-执行-airflow-中经常遇到连接超时断开该如何处理&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;796:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;796:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;3.3. 执行 Airflow 中经常遇到连接超时断开，该如何处理&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;796:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_2.png&#34; xtrc=&#34;image:19;798:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1903&#34; dita-ot:image-height=&#34;909&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;800:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;当遇到如上问题，可能是网络延时导致的，可以在建立连接时设置参数，如上图，在 DolphinDB 连接中设置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:13;800:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;KeepAliveTime&lt;/i&gt; 及 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:14;800:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;reconnect&lt;/i&gt; 参数即可。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;34-将-start-date-日期设为当前日期每天运行一次为什么当天不会运行&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;802:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;802:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;3.4. 将 start_date 日期设为当前日期，每天运行一次，为什么当天不会运行&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;802:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:51;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;在 Airflow 中一个定时调度任务的最早开始时间为 start_date + scheduler_interval，例如：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;804:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;start_date = 2023.03.16&lt;/codeph&gt;，每天调用一次，则最早一次任务调度为 2023.03.17，所以当天的任务无法执行。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;35-dolphindboperator-任务运行失败如何定位失败原因&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;3.5. DolphinDBOperator 任务运行失败如何定位失败原因&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:18;808:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:52;808:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;808:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;任务失败后，DolphinDBOperator 会将具体的错误信息打印在日志中，可通过查看日志信息，定位异常代码并进行修改。查看日志信息步骤如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_3.png&#34; xtrc=&#34;image:20;810:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1070&#34; dita-ot:image-height=&#34;203&#34;/&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_4.png&#34; xtrc=&#34;image:21;812:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;617&#34; dita-ot:image-height=&#34;475&#34;/&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_5.png&#34; xtrc=&#34;image:22;814:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34; dita-ot:image-width=&#34;1743&#34; dita-ot:image-height=&#34;432&#34;/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-法律声明&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;816:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;816:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;4. 法律声明&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;816:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;818:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;基于Apache License 2.0的使用许可协议，本文中所涉及到的 Airflow 相关安装包及源代码，作为 DolphinDB Airflow 插件的组成部分而存在，但 Airflow 安装包或源代码的版权归属于 Apache Software Foundation。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-附件&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;820:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;820:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;5. 附件&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;820:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:19;822:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:53;822:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;DolphinDB 工程项目：&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;script/Best_Practices_for_DolphinDB_and_Python_AirFlow/DolphinDB_projects/addETL.zip&#34; xtrc=&#34;xref:9;822:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;addETL&lt;/xref&gt;，&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;script/Best_Practices_for_DolphinDB_and_Python_AirFlow/DolphinDB_projects/fullETL.zip&#34; xtrc=&#34;xref:10;822:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;fullETL&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:54;823:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Python 项目：&lt;xref class=&#34;- topic/xref &#34; format=&#34;py&#34; href=&#34;script/Best_Practices_for_DolphinDB_and_Python_AirFlow/Python_projects/addETL.py&#34; xtrc=&#34;xref:11;823:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;addETL.py&lt;/xref&gt;，&lt;xref class=&#34;- topic/xref &#34; format=&#34;py&#34; href=&#34;script/Best_Practices_for_DolphinDB_and_Python_AirFlow/Python_projects/fullETL.py&#34; xtrc=&#34;xref:12;823:107&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;fullETL.py&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:55;824:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;数据文件：&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;https://www.dolphindb.cn/downloads/docs/Best_Practices_for_DolphinDB_and_Python_AirFlow.zip&#34; scope=&#34;external&#34; xtrc=&#34;xref:13;824:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;20210104snapshot.csv&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:56;825:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;Airflow 变量：&lt;xref class=&#34;- topic/xref &#34; format=&#34;json&#34; href=&#34;script/Best_Practices_for_DolphinDB_and_Python_AirFlow/variables.json&#34; xtrc=&#34;xref:14;825:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/ddb_airflow.md&#34;&gt;&lt;?ditaot usertext?&gt;Variables.json&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/ddb_airflow.md"/><meta name="wh-out-relpath" content="tutorials/ddb_airflow.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="dolphindb-与-python-airflow-最佳实践" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/OHLC_2.html">金融场景案例</a></div></div></li><li class="active"><div class="topicref" data-id="dolphindb-与-python-airflow-最佳实践"><div class="title"><a href="../tutorials/ddb_airflow.html">DolphinDB 与 Python AirFlow 最佳实践</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="k-线计算-d9713e102569" class="topicref" data-id="k-线计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="k-线计算-d9713e102569-link">K 线计算</a></div></div></li><li role="treeitem"><div data-tocid="使用-klinechart-展示-dolphindb-k-线-d9713e102615" class="topicref" data-id="使用-klinechart-展示-dolphindb-k-线" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/displaying_the_dolphindb_k-line_with_klinechart.html" id="使用-klinechart-展示-dolphindb-k-线-d9713e102615-link">使用 KLineChart 展示 DolphinDB K 线</a></div></div></li><li role="treeitem"><div data-tocid="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661" class="topicref" data-id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_HDF5_vs_DolphinDB.html" id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9713e102661-link">Python + HDF5 因子计算与 DolphinDB 一体化因子计算方案对比</a></div></div></li><li role="treeitem"><div data-tocid="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707" class="topicref" data-id="python--文件存储与-dolphindb-因子计算性能比较" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_VS_PythonFile_Storage.html" id="python--文件存储与-dolphindb-因子计算性能比较-d9713e102707-link">Python + 文件存储与 DolphinDB 因子计算性能比较</a></div></div></li><li role="treeitem"><div data-tocid="python-parser-在金融量化分析场景的应用入门-d9713e102753" class="topicref" data-id="python-parser-在金融量化分析场景的应用入门" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/py_parser__quant_fin.html" id="python-parser-在金融量化分析场景的应用入门-d9713e102753-link">Python Parser 在金融量化分析场景的应用入门</a></div></div></li><li role="treeitem"><div data-tocid="处理-level-2-行情数据实例-d9713e102799" class="topicref" data-id="处理-level-2-行情数据实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_stk_data_proc_2.html" id="处理-level-2-行情数据实例-d9713e102799-link">处理 Level-2 行情数据实例</a></div></div></li><li role="treeitem"><div data-tocid="存储金融数据的分区方案最佳实践-d9713e102845" class="topicref" data-id="存储金融数据的分区方案最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_partitioned_storage.html" id="存储金融数据的分区方案最佳实践-d9713e102845-link">存储金融数据的分区方案最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="公募基金历史数据基础分析教程-d9713e102891" class="topicref" data-id="公募基金历史数据基础分析教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/public_fund_basic_analysis.html" id="公募基金历史数据基础分析教程-d9713e102891-link">公募基金历史数据基础分析教程</a></div></div></li><li role="treeitem"><div data-tocid="股票行情回放-d9713e102937" class="topicref" data-id="股票行情回放" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_market_replay_2.html" id="股票行情回放-d9713e102937-link">股票行情回放</a></div></div></li><li role="treeitem"><div data-tocid="搭建行情回放服务的最佳实践-d9713e102983" class="topicref" data-id="搭建行情回放服务的最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/appendices_market_replay_bp.html" id="搭建行情回放服务的最佳实践-d9713e102983-link">搭建行情回放服务的最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="国内股票行情数据导入实例-d9713e103029" class="topicref" data-id="国内股票行情数据导入实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stockdata_csv_import_demo.html" id="国内股票行情数据导入实例-d9713e103029-link">国内股票行情数据导入实例</a></div></div></li><li role="treeitem"><div data-tocid="基金份额参考价值-iopv-计算-d9713e103076" class="topicref" data-id="基金份额参考价值-iopv-计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_IOPV_2.html" id="基金份额参考价值-iopv-计算-d9713e103076-link">基金份额参考价值 IOPV 计算</a></div></div></li><li role="treeitem"><div data-tocid="基于快照行情的股票和基金-k-线合成-d9713e103122" class="topicref" data-id="基于快照行情的股票和基金-k-线合成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k.html" id="基于快照行情的股票和基金-k-线合成-d9713e103122-link">基于快照行情的股票和基金 K 线合成</a></div></div></li><li role="treeitem"><div data-tocid="计算基金日频因子-d9713e103168" class="topicref" data-id="计算基金日频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/fund_factor_contrasted_by_py.html" id="计算基金日频因子-d9713e103168-link">计算基金日频因子</a></div></div></li><li role="treeitem"><div data-tocid="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214" class="topicref" data-id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/orderBookSnapshotEngine.html" id="基于逐笔数据合成高频-orderbookdolphindb-orderbook-引擎-d9713e103214-link">基于逐笔数据合成高频 Orderbook：DolphinDB Orderbook 引擎</a></div></div></li><li role="treeitem"><div data-tocid="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260" class="topicref" data-id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/LoadDataForPoc.html" id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9713e103260-link">金融 PoC 用户历史数据导入指导手册之股票 Level-2 逐笔篇</a></div></div></li><li role="treeitem"><div data-tocid="金融实时实际波动率预测-d9713e103306" class="topicref" data-id="金融实时实际波动率预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ml_volatility_2.html" id="金融实时实际波动率预测-d9713e103306-link">金融实时实际波动率预测</a></div></div></li><li role="treeitem"><div data-tocid="金融因子流式实现-d9713e103352" class="topicref" data-id="金融因子流式实现" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/str_comp_fin_quant_2.html" id="金融因子流式实现-d9713e103352-link">金融因子流式实现</a></div></div></li><li role="treeitem"><div data-tocid="开发股票波动率预测模型的-676-个输入特征-d9713e103398" class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/metacode_derived_features_2.html" id="开发股票波动率预测模型的-676-个输入特征-d9713e103398-link">开发股票波动率预测模型的 676 个输入特征</a></div></div></li><li role="treeitem"><div data-tocid="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444" class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_snapshot_factor_calc_2.html" id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9713e103444-link">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="量化金融范例-d9713e103490" class="topicref" data-id="量化金融范例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/quant_finance_examples.html" id="量化金融范例-d9713e103490-link">量化金融范例</a></div></div></li><li role="treeitem"><div data-tocid="流式计算中证-1000-指数主买主卖交易量-d9713e103536" class="topicref" data-id="流式计算中证-1000-指数主买主卖交易量" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/CSI_1000_2.html" id="流式计算中证-1000-指数主买主卖交易量-d9713e103536-link">流式计算中证 1000 指数主买/主卖交易量</a></div></div></li><li role="treeitem"><div data-tocid="深度不平衡买卖压力指标波动率计算-d9713e103583" class="topicref" data-id="深度不平衡买卖压力指标波动率计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/sql_performance_optimization_wap_di_rv.html" id="深度不平衡买卖压力指标波动率计算-d9713e103583-link">深度不平衡、买卖压力指标、波动率计算</a></div></div></li><li role="treeitem"><div data-tocid="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629" class="topicref" data-id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/insight_plugin_orderbook_engine_application.html" id="实时合成自定义频订单簿快照dolphindb-insight-行情插件与订单簿引擎应用-d9713e103629-link">实时合成自定义频订单簿快照：DolphinDB INSIGHT 行情插件与订单簿引擎应用</a></div></div></li><li role="treeitem"><div data-tocid="实时计算分钟资金流-d9713e103675" class="topicref" data-id="实时计算分钟资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_order_by_order_2.html" id="实时计算分钟资金流-d9713e103675-link">实时计算分钟资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算高频因子-d9713e103721" class="topicref" data-id="实时计算高频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hf_factor_streaming_2.html" id="实时计算高频因子-d9713e103721-link">实时计算高频因子</a></div></div></li><li role="treeitem"><div data-tocid="实时计算日累计逐单资金流-d9713e103767" class="topicref" data-id="实时计算日累计逐单资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_daily_2.html" id="实时计算日累计逐单资金流-d9713e103767-link">实时计算日累计逐单资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算涨幅榜-d9713e103813" class="topicref" data-id="实时计算涨幅榜" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/rt_stk_price_inc_calc_2.html" id="实时计算涨幅榜-d9713e103813-link">实时计算涨幅榜</a></div></div></li><li role="treeitem"><div data-tocid="实时选取外汇行情多价源最优价-d9713e103859" class="topicref" data-id="实时选取外汇行情多价源最优价" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_price_selection.html" id="实时选取外汇行情多价源最优价-d9713e103859-link">实时选取外汇行情多价源最优价</a></div></div></li><li role="treeitem"><div data-tocid="外汇掉期估值计算-d9713e103905" class="topicref" data-id="外汇掉期估值计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/FxSwapValuation.html" id="外汇掉期估值计算-d9713e103905-link">外汇掉期估值计算</a></div></div></li><li role="treeitem"><div data-tocid="因子计算平台构建-d9713e103951" class="topicref" data-id="因子计算平台构建" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_Celery.html" id="因子计算平台构建-d9713e103951-link">因子计算平台构建</a></div></div></li><li role="treeitem"><div data-tocid="因子计算最佳实践-d9713e103997" class="topicref" data-id="因子计算最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_factor_calculation.html" id="因子计算最佳实践-d9713e103997-link">因子计算最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="mvo_tutorial-d9713e104043" class="topicref" data-id="mvo_tutorial" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/MVO.html" id="mvo_tutorial-d9713e104043-link">优化投资组合：DolphinDB 最优化求解系列函数应用指南</a></div></div></li><li role="treeitem"><div data-tocid="中高频多因子库存储最佳实践-d9713e104090" class="topicref" data-id="中高频多因子库存储最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_multi_factor.html" id="中高频多因子库存储最佳实践-d9713e104090-link">中高频多因子库存储最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136" class="topicref" data-id="alphalens-在-dolphindb-中的应用因子分析建模实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Practical_Factor_Analysis_Modeling.html" id="alphalens-在-dolphindb-中的应用因子分析建模实践-d9713e104136-link">Alphalens 在 DolphinDB 中的应用：因子分析建模实践</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-dolphinscheduler-的集成-d9713e104182" class="topicref" data-id="dolphindb-与-dolphinscheduler-的集成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="dolphindb-与-dolphinscheduler-的集成-d9713e104182-link">DolphinDB 与 DolphinScheduler 的集成</a></div></div></li><li role="treeitem" class="active"><div data-tocid="dolphindb-与-python-airflow-最佳实践-d9713e104228" class="topicref" data-id="dolphindb-与-python-airflow-最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_airflow.html" id="dolphindb-与-python-airflow-最佳实践-d9713e104228-link">DolphinDB 与 Python AirFlow 最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="gplearn-d9713e104274" class="topicref" data-id="gplearn" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/gplearn.html" id="gplearn-d9713e104274-link">Shark GPLearn 快速上手</a></div></div></li><li role="treeitem"><div data-tocid="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320" class="topicref" data-id="利用jit加速计算-etf-期权隐含波动率和希腊值" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/IV_Greeks_Calculation_for_ETF_Options_Using_JIT.html" id="利用jit加速计算-etf-期权隐含波动率和希腊值-d9713e104320-link">利用JIT加速计算 ETF 期权隐含波动率和希腊值</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366" class="topicref" data-id="基于-dolphindb-的-brinson-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/brinson.html" id="基于-dolphindb-的-brinson-绩效归因模型实践-d9713e104366-link">基于 DolphinDB 的 Brinson 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412" class="topicref" data-id="基于-dolphindb-的-campisi-绩效归因模型实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/campisi.html" id="基于-dolphindb-的-campisi-绩效归因模型实践-d9713e104412-link">基于 DolphinDB 的 Campisi 绩效归因模型实践</a></div></div></li><li role="treeitem"><div data-tocid="期货分钟频cta策略回测案例-d9713e104458" class="topicref" data-id="期货分钟频cta策略回测案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/futures_minute_frequency_cta_strategy_backtest_example.html" id="期货分钟频cta策略回测案例-d9713e104458-link">期货分钟频CTA策略回测案例</a></div></div></li><li role="treeitem"><div data-tocid="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504" class="topicref" data-id="exchdata-交易所历史股票数据自动化导入功能模块使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/exchdata_exchange_historical_stock_data_auto_import_module_tutorial.html" id="exchdata-交易所历史股票数据自动化导入功能模块使用教程-d9713e104504-link">ExchData 交易所历史股票数据自动化导入功能模块使用教程</a></div></div></li><li role="treeitem"><div data-tocid="ficc_func_uasge_and_performance-d9713e104550" class="topicref" data-id="ficc_func_uasge_and_performance" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_func_uasge_and_performance.html" id="ficc_func_uasge_and_performance-d9713e104550-link">FICC 固收系列函数使用示例及性能</a></div></div></li><li role="treeitem"><div data-tocid="title1-d9713e104597" class="topicref" data-id="title1" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ficc_funcs_application.html" id="title1-d9713e104597-link">FICC 固收系列函数应用场景</a></div></div></li><li role="treeitem"><div data-tocid="最优化函数_socp_的使用及转化案例-d9713e104643" class="topicref" data-id="最优化函数_socp_的使用及转化案例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/socp_usage_case.html" id="最优化函数_socp_的使用及转化案例-d9713e104643-link">最优化函数 socp 的使用及转化案例</a></div></div></li><li role="treeitem"><div data-tocid="k_line_calculation-d9713e104689" class="topicref" data-id="k_line_calculation" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k_line_calculation%20.html" id="k_line_calculation-d9713e104689-link">基于期货快照行情数据计算合约 K 线以及主连行情</a></div></div></li><li role="treeitem"><div data-tocid="backtest_introduction_usage-d9713e104735" class="topicref" data-id="backtest_introduction_usage" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backtest_introduction_usage.html" id="backtest_introduction_usage-d9713e104735-link">融资融券策略回测使用说明及回测案例</a></div></div></li><li role="treeitem"><div data-tocid="stock_backtest-d9713e104781" class="topicref" data-id="stock_backtest" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_backtest.html" id="stock_backtest-d9713e104781-link">股票中低频投资组合回测案例实现</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">DolphinDB 与 Python AirFlow 最佳实践</h1><div class="- topic/body body"><p class="- topic/p p">DolphinDB 作为一款高性能时序数据库，其在实际生产环境中常有数据的清洗、装换以及加载等需求，而对于该如何结构化管理好 ETL 作业，Airflow 提供了一种很好的思路。本篇教程为生产环境中 ETL 实践需求提供了一个解决方案，将 Python Airflow 引入到 DolphinDB 的高可用集群中，通过使用 Airflow  所提供的功能来实现更好管理 DolphinDB 数据 ETL 作业，整体架构如下:</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1.png"/><br/></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-airflow"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. Airflow</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="11-airflow-简介"><h3 class="- topic/title title topictitle3" id="ariaid-title3">1.1. Airflow 简介</h3><div class="- topic/body body"><p class="- topic/p p">Airflow 是一个可编程，调度和监控的工作流平台，基于有向无环图 (Directed acyclic graph, DAG)，Airflow 可以定义一组有依赖的任务，按照依赖依次执行。Airflow 提供了丰富的命令行工具用于系统管控，而其 web 管理界面同样也可以方便地管控调度任务，并且对任务运行状态进行实时监控，方便了系统的运维和管理。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="12-airflow-部分核心功能"><h3 class="- topic/title title topictitle3" id="ariaid-title4">1.2. Airflow 部分核心功能</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">增量加载数据</strong>：当表或数据集较小时，可以整体加载数据。但是随着数据的增长，以固定的时间间隔增量提取数据才是 ETL 的常态，仅加载一个小时，一天，一周数据的需求非常普遍。Airflow 可以容易地以特定的时间间隔加载增量数据。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">处理历史数据</strong>：在某些情况下，您刚刚完成一个新的工作流程并且需要回溯到将新代码投入生产的日期的数据。在这种情况下，您只需使用 DAG 中的 <em class="+ topic/ph hi-d/i ph i">start_date</em> 参数以指定开始日期。然后，Airflow 将回填任务到开始日期。此外，还可以使用 DAG 的参数来处理数周、数月或数年的数据。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">分区提取的数据</strong>：通过对数据的目的地进行分区，可以并行运行 DAG，避免对提取的数据进行锁定，并在读取相同数据时优化性能。不再相关的数据可以存档并从数据库中删除。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">强制幂等约束</strong>：DAG 运行的结果应始终具有幂等特性。这意味着当您使用相同的参数多次运行某个流程时（即使在不同的日期），结果也将完全相同。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">有条件地执行</strong>：Airflow 具有一些选项，可根据之前的实例的成功来控制 DAG 中任务的运行方式。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="13-dolphindboperator"><h3 class="- topic/title title topictitle3" id="ariaid-title5">1.3. DolphinDBOperator</h3><div class="- topic/body body"><p class="- topic/p p">DolphinDBOperator 是 Airflow 的 operator 一种，通过 DolphinDBOperator 可以在 Airflow 连接 DolphinDB 进行数据写入、查询、计算等操作。DolphinDBOperator 特有的参数有：</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">dolphindb_conn_id</code>: 用于指定 DolphinDB 连接，可在 connection 中设置</li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">sql</code>: 指定需要运行的 DolphinDB 脚本</li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">file_path</code>: 可以指定 DolphinDB dos 文件运行脚本</li></ul><p class="- topic/p p">DolphinDBOperator 使用示例如下：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">通过 sql 参数指定任务内容运行脚本：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//在 DolphinDB 中创建一个共享表
create_parameter_table = DolphinDBOperator(
        task_id='create_parameter_table',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            undef(`paramTable,SHARED)
            t = table(1:0, `param`value, [STRING, STRING])
            share t as paramTable
            '''
    )</code></pre></li><li class="- topic/li li"><p class="- topic/p p">通过 file_path 指定 dos 文件运行脚本：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>    //CalAlpha001.dos 为 DolphinDB 脚本
    case1 = DolphinDBOperator(
        task_id='case1',
        dolphindb_conn_id='dolphindb_test',
        file_path=path + "/StreamCalculating/CalAlpha001.dos"
    )</code></pre></li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="14-airflow-安装部署"><h3 class="- topic/title title topictitle3" id="ariaid-title6">1.4. Airflow 安装部署</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">硬件环境</strong>：</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="14-airflow-安装部署__entry__1">硬件名称</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="14-airflow-安装部署__entry__2">配置信息</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__1">主机名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__2">HostName</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__1">外网 IP</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__2">xxx.xxx.xxx.122</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__1">操作系统</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__2">Linux（内核版本3.10以上）</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__1">内存</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__2">64 GB</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__1">CPU</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__2">x86_64（12核心）</td></tr></tbody></table></div></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">软件环境</strong>：</p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="14-airflow-安装部署__entry__13">软件名称</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="14-airflow-安装部署__entry__14">版本信息</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__13">DolphinDB</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__14">2.00.9</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__13">Airflow</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__14">2.5.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__13">python</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="14-airflow-安装部署__entry__14">3.7及以上</td></tr></tbody></table></div></li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">本教程使用 SQLite 数据库作为后端存储，如果因 SQLite 版本过低无法启动，可参考<a class="- topic/xref xref" href="https://airflow.apache.org/docs/apache-airflow/stable/howto/set-up-database.html" target="_blank" rel="external noopener">设置数据库</a>，升级 SQLlite 或更改默认数据库。</p></li><li class="- topic/li li"><p class="- topic/p p">在流程开始前建议预先构建 DolphinDB 服务。具体安装方法可以参考 <a class="- topic/xref xref" href="ha_cluster_deployment.html">DolphinDB 高可用集群部署教程</a>。也可以参考基于 <a class="- topic/xref xref" href="docker-compose_high_cluster.html">Docker-Compose 的 DolphinDB 多容器集群部署</a>。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">主机环境</strong></p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">执行以下命令安装 Airflow：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>pip install airflow-provider-dolphindb</code></pre></li><li class="- topic/li li"><p class="- topic/p p">安装好 airflow.provider.dolphindb 插件后，启动 Airflow ：</p><p class="- topic/p p">部署以及安装 Airflow 详情见官网：<a class="- topic/xref xref" href="https://airflow.apache.org/docs/apache-airflow/stable/start.html" target="_blank" rel="external noopener">airflow 快速入门</a>。以下为启动 Airflow 的核心代码:</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>#初始化数据库
airflow db init

#创建用户
airflow users create  --username admin  --firstname Peter  --lastname Parker  --role Admin  --email spiderman@superhero.org  --password admin

# 守护进程运行 webserver
airflow webserver --port 8080 -D

# 守护进程运行 scheduler
airflow scheduler -D</code></pre></li><li class="- topic/li li"><p class="- topic/p p">执行以下命令验证 Airflow 是否成功启动：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>ps -aux|grep airflow</code></pre><p class="- topic/p p">预期输出如下图，证明 Airflow 启动成功：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_1.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">启动成功后，浏览器中登录 Airflow 的 web 界面：</p><ul class="- topic/ul ul"><li class="- topic/li li">默认地址：<code class="+ topic/ph pr-d/codeph ph codeph">http://IP:8080</code></li><li class="- topic/li li">默认账户：初始化 db 中创建，本文例子中为 <code class="+ topic/ph pr-d/codeph ph codeph">admin</code></li><li class="- topic/li li">默认密码：初始化 db 中创建, 本文例子中为 <code class="+ topic/ph pr-d/codeph ph codeph">admin</code></li></ul><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_2.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">输入上述创建用户名密码即可进入 Airflow 的 UI 界面，如下所示:</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_3.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">填写 DolphinDB 连接信息后连接到 DolphinDB 数据库。</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_4.png"/><br/><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/1_5.png"/><br/><p class="- topic/p p">连接成功后，在 DolphinDBOperator 中指定 <code class="+ topic/ph pr-d/codeph ph codeph">dolphindb_conn_id='dolphindb_test'</code>，即可运行 DolphinDB 脚本。上述准备工作完成后，下文以一个股票快照数据的 ETL 过程为例展现 Airflow 如何和 DolphinDB 交互。</p></li></ol></li></ul></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title7" id="2-airflow-调度对行情数据-etl"><h2 class="- topic/title title topictitle2" id="ariaid-title7">2. Airflow 调度对行情数据 ETL</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="21-整体-etl-架构图"><h3 class="- topic/title title topictitle3" id="ariaid-title8">2.1. 整体 ETL 架构图</h3><div class="- topic/body body"><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_1.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">ETL 平台功能模块代码目录结构</strong></p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_2.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">功能模块代码目录结构详解</strong></p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">add</em>：增量数据 ETL</p><ul class="- topic/ul ul"><li class="- topic/li li">addLoadSnapshot：每日新增 Snapshot 原始数据导入</li><li class="- topic/li li">addProcessSnapshot：增量 Snapshot 处理成 ArrayVector 以及清洗数据</li><li class="- topic/li li">addFactor：增加合成日 K 及一分钟 K 数据并存储</li><li class="- topic/li li">addETL.py：构建增量数据 DAG</li></ul></li><li class="- topic/li li"><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">full</em>：全量数据 ETL</p><ul class="- topic/ul ul"><li class="- topic/li li">loadSnapshot：Snapshot 建表与导入</li><li class="- topic/li li">processSnapshot：Snapshot 清洗结果建表，将数据处理成 ArrayVector 以及清洗数据并存储</li><li class="- topic/li li">Factor：创建因子存储表，将清洗后数据加工成日 K 以及一分钟 K 数据并存储</li><li class="- topic/li li">fullETL.py：构建全量数据 DAG</li></ul></li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">外部数据源 - &gt; ODS 数据源</strong>：将原始数据从外部数据源导入 DolphinDB</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">ODS 数据源 - &gt;DWD 数据明细</strong>：清洗原始数据，将原始数据中的多档数据清洗成 ArrayVector 并去重</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DWD 数据明细 - &gt; DWB/DWS 数据汇总</strong>:  对清洗后的快照数据进行计算加工合成 K 线数据</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：本教程使用 DolphinDB 中 module 功能以及 DolphinDB 客户端工具进行工程化管理 DolphinDB 脚本，详细介绍见 <a class="- topic/xref xref" href="module_tutorial.html">DolphinDB教程: 模块</a> 以及 <a class="- topic/xref xref" href="../getstarted/use_clients_server.html">使用客户端</a>。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="22-数据介绍"><h3 class="- topic/title title topictitle3" id="ariaid-title9">2.2. 数据介绍</h3><div class="- topic/body body"><p class="- topic/p p">本教程选取了 2020.01.04 - 2021.01.08 全市场所有股票的 5 天的 level 2 快照数据。以下是快照表在DolphinDB的结构。BidOrderQty，BidPrice，BidNumOrders，BidOrders，OfferPrice，OfferOrderQty，OfferNumOrders 和 OfferOrders 8个字段分别包含多档数据，在 DolphinDB 中采用 ArrayVector 数据类型来保存：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-数据介绍__entry__1">字段名</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-数据介绍__entry__2">字段含义</th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="22-数据介绍__entry__3">数据类型（DolphinDB）</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">SecurityID</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">证券代码</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">SYMBOL</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">DateTime</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">日期时间</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">TIMESTAMP</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">PreClosePx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">昨收价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">OpenPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">开始价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">HighPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">最高价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">LowPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">最低价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">LastPx</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">最新价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">TotalVolumeTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">成交总量</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">INT</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">TotalValueTrade</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">成交总金额</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">InstrumentStatus</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">交易状态</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">SYMBOL</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">BidPrice</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申买十价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">BidOrderQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申买十量</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">INT[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">BidNumOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申买十实际总委托笔 数</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">INT[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">BidOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申买一前 50 笔订单</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">INT[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">OfferPrice</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申卖十价</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">DOUBLE[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">OfferOrderQty</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申卖十量</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">INT[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">OfferNumOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申卖十实际总委托笔 数</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">INT[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">OfferOrders</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">申卖一前 50 笔订单</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">INT[]</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__1">……</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__2">……</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="22-数据介绍__entry__3">……</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="23-dolphindb-核心清洗脚本介绍"><h3 class="- topic/title title topictitle3" id="ariaid-title10">2.3. DolphinDB 核心清洗脚本介绍</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="231-创建分布式库表"><h4 class="- topic/title title topictitle4" id="ariaid-title11">2.3.1. 创建分布式库表</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">创建 snapshot 原始数据存储表：</p><p class="- topic/p p">创建存储原始 snapshot 原始数据的库表，核心代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>module loadSnapshot::createSnapshotTable

//创建 snapshot 原始数据存储库表
def createSnapshot(dbName, tbName){
	login("admin", "123456")
	if(existsDatabase(dbName)){
		dropDatabase(dbName)
	}
	db1 = database(, VALUE, 2020.01.01..2021.01.01)
	db2 = database(, HASH, [SYMBOL, 50])
	//按天和股票代码组合分区
	db = database(dbName,COMPO,[db1,db2],engine='TSDB')
	colName = ["SecurityID","DateTime","PreClosePx","OpenPx","HighPx","LowPx","LastPx","TotalVolumeTrade","TotalValueTrade","InstrumentStatus","BidPrice0","BidPrice1","BidPrice2","BidPrice3","BidPrice4","BidPrice5","BidPrice6","BidPrice7","BidPrice8","BidPrice9","BidOrderQty0","BidOrderQty1","BidOrderQty2","BidOrderQty3","BidOrderQty4","BidOrderQty5","BidOrderQty6","BidOrderQty7","BidOrderQty8","BidOrderQty9","BidNumOrders0","BidNumOrders1","BidNumOrders2","BidNumOrders3","BidNumOrders4","BidNumOrders5","BidNumOrders6","BidNumOrders7","BidNumOrders8","BidNumOrders9","BidOrders0","BidOrders1","BidOrders2","BidOrders3","BidOrders4","BidOrders5","BidOrders6","BidOrders7","BidOrders8","BidOrders9","BidOrders10","BidOrders11","BidOrders12","BidOrders13","BidOrders14","BidOrders15","BidOrders16","BidOrders17","BidOrders18","BidOrders19","BidOrders20","BidOrders21","BidOrders22","BidOrders23","BidOrders24","BidOrders25","BidOrders26","BidOrders27","BidOrders28","BidOrders29","BidOrders30","BidOrders31","BidOrders32","BidOrders33","BidOrders34","BidOrders35","BidOrders36","BidOrders37","BidOrders38","BidOrders39","BidOrders40","BidOrders41","BidOrders42","BidOrders43","BidOrders44","BidOrders45","BidOrders46","BidOrders47","BidOrders48","BidOrders49","OfferPrice0","OfferPrice1","OfferPrice2","OfferPrice3","OfferPrice4","OfferPrice5","OfferPrice6","OfferPrice7","OfferPrice8","OfferPrice9","OfferOrderQty0","OfferOrderQty1","OfferOrderQty2","OfferOrderQty3","OfferOrderQty4","OfferOrderQty5","OfferOrderQty6","OfferOrderQty7","OfferOrderQty8","OfferOrderQty9","OfferNumOrders0","OfferNumOrders1","OfferNumOrders2","OfferNumOrders3","OfferNumOrders4","OfferNumOrders5","OfferNumOrders6","OfferNumOrders7","OfferNumOrders8","OfferNumOrders9","OfferOrders0","OfferOrders1","OfferOrders2","OfferOrders3","OfferOrders4","OfferOrders5","OfferOrders6","OfferOrders7","OfferOrders8","OfferOrders9","OfferOrders10","OfferOrders11","OfferOrders12","OfferOrders13","OfferOrders14","OfferOrders15","OfferOrders16","OfferOrders17","OfferOrders18","OfferOrders19","OfferOrders20","OfferOrders21","OfferOrders22","OfferOrders23","OfferOrders24","OfferOrders25","OfferOrders26","OfferOrders27","OfferOrders28","OfferOrders29","OfferOrders30","OfferOrders31","OfferOrders32","OfferOrders33","OfferOrders34","OfferOrders35","OfferOrders36","OfferOrders37","OfferOrders38","OfferOrders39","OfferOrders40","OfferOrders41","OfferOrders42","OfferOrders43","OfferOrders44","OfferOrders45","OfferOrders46","OfferOrders47","OfferOrders48","OfferOrders49","NumTrades","IOPV","TotalBidQty","TotalOfferQty","WeightedAvgBidPx","WeightedAvgOfferPx","TotalBidNumber","TotalOfferNumber","BidTradeMaxDuration","OfferTradeMaxDuration","NumBidOrders","NumOfferOrders","WithdrawBuyNumber","WithdrawBuyAmount","WithdrawBuyMoney","WithdrawSellNumber","WithdrawSellAmount","WithdrawSellMoney","ETFBuyNumber","ETFBuyAmount","ETFBuyMoney","ETFSellNumber","ETFSellAmount","ETFSellMoney"]
	colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
	schemaTable = table(1:0,colName, colType)

	db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`DateTime`SecurityID, compressMethods={DateTime:"delta"}, sortColumns=`SecurityID`DateTime, keepDuplicates=ALL)
}</code></pre><p class="- topic/p p">对于 snapshot 数据，本文采用的数据库分区方案是组合分区，第一层按天分区，第二层对股票代码按 HASH 分50个分区。如何根据数据确定分区方案可参考 <a class="- topic/xref xref" href="database.html">DolphinDB 分区数据库教程</a>。</p></li><li class="- topic/li li"><p class="- topic/p p">创建清洗后 snapshot 数据存储表：</p><p class="- topic/p p">创建清洗后以 Array 格式存储 snapshot 数据的库表，核心代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>module processSnapshot::createSnapshot_array

//创建清洗后的 snapshot 数据存储表
def createProcessTable(dbName, tbName){
	if(existsDatabase(dbName)){
		dropDatabase(dbName)
	}
	db1 = database(, VALUE, 2020.01.01..2021.01.01)
	db2 = database(, HASH, [SYMBOL, 50])
	//按天和股票代码组合分区
	db = database(dbName,COMPO,[db1,db2],engine='TSDB')
	colName = ["SecurityID","DateTime","PreClosePx","OpenPx","HighPx","LowPx","LastPx","TotalVolumeTrade","TotalValueTrade","InstrumentStatus","BidPrice","BidOrderQty","BidNumOrders","BidOrders","OfferPrice","OfferOrderQty","OfferNumOrders","OfferOrders","NumTrades","IOPV","TotalBidQty","TotalOfferQty","WeightedAvgBidPx","WeightedAvgOfferPx","TotalBidNumber","TotalOfferNumber","BidTradeMaxDuration","OfferTradeMaxDuration","NumBidOrders","NumOfferOrders","WithdrawBuyNumber","WithdrawBuyAmount","WithdrawBuyMoney","WithdrawSellNumber","WithdrawSellAmount","WithdrawSellMoney","ETFBuyNumber","ETFBuyAmount","ETFBuyMoney","ETFSellNumber","ETFSellAmount","ETFSellMoney"]
	colType = ["SYMBOL","TIMESTAMP","DOUBLE","DOUBLE","DOUBLE","DOUBLE","DOUBLE","INT","DOUBLE","SYMBOL","DOUBLE[]","INT[]","INT[]","INT[]","DOUBLE[]","INT[]","INT[]","INT[]","INT","INT","INT","INT","DOUBLE","DOUBLE","INT","INT","INT","INT","INT","INT","INT","INT","DOUBLE","INT","INT","DOUBLE","INT","INT","INT","INT","INT","INT"]
	schemaTable = table(1:0, colName, colType)
	db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`DateTime`SecurityID, compressMethods={DateTime:"delta"}, sortColumns=`SecurityID`DateTime, keepDuplicates=ALL)
}</code></pre></li><li class="- topic/li li"><p class="- topic/p p">创建 K 线结果存储表：</p><p class="- topic/p p">创建分钟级 K 线结果存储表，核心代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>module Factor::createFactorOneMinute

//创建分钟 k 线因子储存表
def createFactorOneMinute(dbName, tbName){
	if(existsDatabase(dbName)){
		dropDatabase(dbName)
	}
	//按天分区
	db = database(dbName, VALUE, 2021.01.01..2021.01.03,engine = `TSDB)
	colName = `TradeDate`TradeTime`SecurityID`Open`High`Low`Close`Volume`Amount`Vwap
	colType =[DATE, MINUTE, SYMBOL, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, DOUBLE]
	tbSchema = table(1:0, colName, colType)
  	db.createPartitionedTable(table=tbSchema,tableName=tbName,partitionColumns=`TradeDate,sortColumns=`SecurityID`TradeTime,keepDuplicates=ALL)
}</code></pre><p class="- topic/p p">创建日级 K 线结果存储表，核心代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>module Factor::createFactorDaily

//创建日 K 线储存表
def createFactorDaily(dbName, tbName){
	if(existsDatabase(dbName)){
		dropDatabase(dbName)
	}
	//按年分区
	db = database(dbName, RANGE, datetimeAdd(2000.01M,(0..50)*12, "M"),engine = `TSDB)
	colName = `TradeDate`SecurityID`Open`High`Low`Close`Volume`Amount`Vwap
	colType =[DATE, SYMBOL, DOUBLE, DOUBLE, DOUBLE, DOUBLE, LONG, DOUBLE, DOUBLE]
	tbSchema = table(1:0, colName, colType)
  	db.createPartitionedTable(table=tbSchema,tableName=tbName,partitionColumns=`TradeDate,sortColumns=`SecurityID`TradeDate,keepDuplicates=ALL)
}</code></pre></li></ul></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title12" id="232-数据清洗"><h4 class="- topic/title title topictitle4" id="ariaid-title12">2.3.2. 数据清洗</h4><div class="- topic/body body"><p class="- topic/p p">本文将 snapshot 数据的清洗主要分为两个部分：</p><ul class="- topic/ul ul"><li class="- topic/li li">将多档价格、委托量以 Array 形式储存</li><li class="- topic/li li">数据去重</li></ul><p class="- topic/p p">具体的处理流程及核心代码如下:</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>module processSnapshot::processSnapshotData

//将数据组合为 array、去重，并统计重复数据量
def mapProcess(mutable t, dbName, tbName){
	n1 = t.size()
	t = select SecurityID, DateTime, PreClosePx, OpenPx, HighPx, LowPx, LastPx, TotalVolumeTrade, TotalValueTrade, InstrumentStatus, fixedLengthArrayVector(BidPrice0, BidPrice1, BidPrice2, BidPrice3, BidPrice4, BidPrice5, BidPrice6, BidPrice7, BidPrice8, BidPrice9) as BidPrice, fixedLengthArrayVector(BidOrderQty0, BidOrderQty1, BidOrderQty2, BidOrderQty3, BidOrderQty4, BidOrderQty5, BidOrderQty6, BidOrderQty7, BidOrderQty8, BidOrderQty9) as BidOrderQty, fixedLengthArrayVector(BidNumOrders0, BidNumOrders1, BidNumOrders2, BidNumOrders3, BidNumOrders4, BidNumOrders5, BidNumOrders6, BidNumOrders7, BidNumOrders8, BidNumOrders9) as BidNumOrders, fixedLengthArrayVector(BidOrders0, BidOrders1, BidOrders2, BidOrders3, BidOrders4, BidOrders5, BidOrders6, BidOrders7, BidOrders8, BidOrders9, BidOrders10, BidOrders11, BidOrders12, BidOrders13, BidOrders14, BidOrders15, BidOrders16, BidOrders17, BidOrders18, BidOrders19, BidOrders20, BidOrders21, BidOrders22, BidOrders23, BidOrders24, BidOrders25, BidOrders26, BidOrders27, BidOrders28, BidOrders29, BidOrders30, BidOrders31, BidOrders32, BidOrders33, BidOrders34, BidOrders35, BidOrders36, BidOrders37, BidOrders38, BidOrders39, BidOrders40, BidOrders41, BidOrders42, BidOrders43, BidOrders44, BidOrders45, BidOrders46, BidOrders47, BidOrders48, BidOrders49) as BidOrders, fixedLengthArrayVector(OfferPrice0, OfferPrice1, OfferPrice2, OfferPrice3, OfferPrice4, OfferPrice5, OfferPrice6, OfferPrice7, OfferPrice8, OfferPrice9) as OfferPrice, fixedLengthArrayVector(OfferOrderQty0, OfferOrderQty1, OfferOrderQty2, OfferOrderQty3, OfferOrderQty4, OfferOrderQty5, OfferOrderQty6, OfferOrderQty7, OfferOrderQty8, OfferOrderQty9) as OfferQty, fixedLengthArrayVector(OfferNumOrders0, OfferNumOrders1, OfferNumOrders2, OfferNumOrders3, OfferNumOrders4, OfferNumOrders5, OfferNumOrders6, OfferNumOrders7, OfferNumOrders8, OfferNumOrders9) as OfferNumOrders, fixedLengthArrayVector(OfferOrders0, OfferOrders1, OfferOrders2, OfferOrders3, OfferOrders4, OfferOrders5, OfferOrders6, OfferOrders7, OfferOrders8, OfferOrders9, OfferOrders10, OfferOrders11, OfferOrders12, OfferOrders13, OfferOrders14, OfferOrders15, OfferOrders16, OfferOrders17, OfferOrders18, OfferOrders19, OfferOrders20, OfferOrders21, OfferOrders22, OfferOrders23, OfferOrders24, OfferOrders25, OfferOrders26, OfferOrders27, OfferOrders28, OfferOrders29, OfferOrders30, OfferOrders31, OfferOrders32, OfferOrders33, OfferOrders34, OfferOrders35, OfferOrders36, OfferOrders37, OfferOrders38, OfferOrders39, OfferOrders40, OfferOrders41, OfferOrders42, OfferOrders43, OfferOrders44, OfferOrders45, OfferOrders46, OfferOrders47, OfferOrders48, OfferOrders49) as OfferOrders, NumTrades, IOPV, TotalBidQty, TotalOfferQty, WeightedAvgBidPx, WeightedAvgOfferPx, TotalBidNumber, TotalOfferNumber, BidTradeMaxDuration, OfferTradeMaxDuration, NumBidOrders, NumOfferOrders, WithdrawBuyNumber, WithdrawBuyAmount, WithdrawBuyMoney, WithdrawSellNumber, WithdrawSellAmount, WithdrawSellMoney, ETFBuyNumber, ETFBuyAmount, ETFBuyMoney, ETFSellNumber, ETFSellAmount, ETFSellMoney from t where isDuplicated([SecurityID, DateTime], FIRST) = false
	n2 = t.size()
	loadTable(dbName, tbName).append!(t)
	return n1,n2
}

def process(processDate, dbName_orig, tbName_orig, dbName_process, tbName_process){
	dataString = temporalFormat(processDate, "yyyyMMdd")
	//查询处理日期的数据在数据库中是否存在
	todayCount = exec count(*) from loadTable(dbName_process, tbName_process) where date(DateTime)=processDate
	//如果库里面已经存在当天要处理的数据，删除库里面已有数据
	if(todayCount != 0){
		writeLog("Start to delete the process snapshot data, the delete date is: " + dataString)
		dropPartition(database(dbName_process), processDate, tbName_process)
		writeLog("Successfully deleted the process snapshot data, the delete date is: " + dataString)
	}
	//开始处理数据
	writeLog("Start process Snapshot Data, the datetime is "+ dataString)
	ds = sqlDS(sql(select=sqlCol("*"), from=loadTable(dbName_orig,tbName_orig),where=&lt;date(DateTime)=processDate&gt;))
	n1,n2=mr(ds, mapProcess{, dbName_process, tbName_process}, +, , false)
	if(n1 != n2){
		writeLog("ERROR: Duplicated datas exists in " + dataString + ", Successfully drop " + string(n1-n2) + " pieces of data" )
	}
	writeLog("Successfully process the snapshot data, the processDate is: " + dataString)
}</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title13" id="233-清洗行情数据合成-k-线"><h4 class="- topic/title title topictitle4" id="ariaid-title13">2.3.3. 清洗行情数据合成 K 线</h4><div class="- topic/body body"><p class="- topic/p p">分钟级 K 线合成并入库, 核心代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>module Factor::calFactorOneMinute

//合成分钟 K 线并入库
def calFactorOneMinute(dbName, tbName, mutable factorTable){
	pt = loadTable(dbName, tbName)
	//将数据分为10天一组计算
	dayList = schema(pt).partitionSchema[0]
	if(dayList.size()&gt;10) dayList = dayList.cut(10)
	for(days in dayList){
		//计算分钟 K 线
		res =   select first(LastPX) as Open, max(LastPx) as High, min(LastPx) as Low, last(LastPx) as Close, sum(TotalVolumeTrade) as Volume, sum(LastPx*totalVolumeTrade) as Amount, wavg(LastPx, TotalVolumeTrade) as Vwap from pt where date(DateTime) in days group by date(DateTime) as TradeDate,minute(DateTime) as TradeTime, SecurityID
		writeLog("Start to append minute factor result , the days is: [" + concat(days, ",")+"]")
		//分钟 K 线入库
		factorTable.append!(res)
		writeLog("Successfully append the minute factor result to databse, the days is: [" + concat(days, ",")+"]")
	}
}</code></pre><p class="- topic/p p">日级 K 线合成并入库, 核心代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>module Factor::calFactorDaily1

//合成日 K 线并入库
def calFactorDaily(dbName, tbName, mutable factorTable){
	pt = loadTable(dbName, tbName)
	//将数据分为10天一组计算
	dayList = schema(pt).partitionSchema[0]
	if(dayList.size()&gt;10) dayList = dayList.cut(10)
	for(days in dayList){
		//计算日 K 线
		res =   select first(LastPX) as Open, max(LastPx) as High, min(LastPx) as Low, last(LastPx) as Close, sum(TotalVolumeTrade) as Volume, sum(LastPx*totalVolumeTrade) as Amount, wavg(LastPx, TotalVolumeTrade) as Vwap from pt where date(DateTime) in days group by date(DateTime) as TradeDate, SecurityID 
		writeLog("Start to append daily factor result , the days is: [" + concat(days, ",")+"]")
		//日 K 线入库
		factorTable.append!(res)
		writeLog("Successfully append the daily factor result to databse, the days is: [" + concat(days, ",")+"]")
	}
}</code></pre></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title14" id="24-增量数据清洗"><h3 class="- topic/title title topictitle3" id="ariaid-title14">2.4. 增量数据清洗</h3><div class="- topic/body body"><p class="- topic/p p">增量数据的导入和全量数据的导入整体逻辑相同，主要区别如下：</p><ul class="- topic/ul ul"><li class="- topic/li li">全量数据批量导入，增量数据每天定时执行</li><li class="- topic/li li">全量数据导入通过 DolphinDB submitjob 异步提交任务，增量数据导入通过调用 append! 接口同步导入</li><li class="- topic/li li">数据加工 K 线全量数据批量加工，增量数据只加工当天数据</li></ul><p class="- topic/p p">具体代码差别见附件。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title15" id="25-airflow-生成-dag-执行任务"><h3 class="- topic/title title topictitle3" id="ariaid-title15">2.5. Airflow 生成 DAG 执行任务</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title16" id="251-生成一个-dag-实例"><h4 class="- topic/title title topictitle4" id="ariaid-title16">2.5.1. 生成一个 DAG 实例</h4><div class="- topic/body body"><p class="- topic/p p">生成全量 DAG 实例的示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>with DAG(dag_id="ETLTest", start_date=datetime(2023, 3, 10), schedule_interval=None) as dag:</code></pre><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">dag_id</code> 指定了 DAG 名称，需要具有唯一性；<code class="+ topic/ph pr-d/codeph ph codeph">start_date</code> 设定任务开始日期；<code class="+ topic/ph pr-d/codeph ph codeph">schedule_interval</code> 指定两次任务的间隔；<code class="+ topic/ph pr-d/codeph ph codeph">None</code> 表示该任务不自动执行需手动触发。
增量 DAG 示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>args = {
    "owner" : "Airflow",
    "start_date" : days_ago(1),
    "catchup" : False,
    'retries' : 0
}
with DAG(dag_id="addETLTest", default_args = args, schedule_interval="0 12 * * *") as dag:</code></pre><p class="- topic/p p">增量 DAG 中 <code class="+ topic/ph pr-d/codeph ph codeph">catchup</code> 表示是否进行回填任务操作，<code class="+ topic/ph pr-d/codeph ph codeph">retries</code> 表示任务失败重试次数，<code class="+ topic/ph pr-d/codeph ph codeph">schedule_interval = “0 12 * * * ”</code> 表示在每天12点 (UTC) 运行任务。<code class="+ topic/ph pr-d/codeph ph codeph">schedule</code> 设置详细可参考：<a class="- topic/xref xref" href="https://airflow.apache.org/docs/apache-airflow/1.10.10/scheduler.html#scheduling-triggers" target="_blank" rel="external noopener">Scheduling &amp; Triggers</a></p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title17" id="252-获取-airflow-中的变量"><h4 class="- topic/title title topictitle4" id="ariaid-title17">2.5.2. 获取 Airflow 中的变量</h4><div class="- topic/body body"><p class="- topic/p p">Airflow 中设定的变量值，无法直接在 DolphinDB 脚本中获取，为了在后续的任务中使用，本文通过将 Airflow 中变量写入共享表的方式，来实现后续在 DolphinDB 任务读取变量，具体代码示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>//获取变量值
variable = ['ETL_dbName_origin', "ETL_tbName_origin", "ETL_dbName_process",
            "ETL_tbName_process", 'ETL_dbName_factor','ETL_tbName_factor','ETL_dbName_factor_daily',
            'ETL_tbName_factor_daily',"ETL_filedir", "ETL_start_date","ETL_end_date"]
value = []
for var in variable:
    value.append(str(Variable.get(var)))
variables = ",".join(variable)
values = ",".join(value)

//通过DolphinDBOperator创建共享表，并将变量值写入共享表中
  create_parameter_table = DolphinDBOperator(
        task_id='create_parameter_table',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            undef(`paramTable,SHARED)
            t = table(1:0, `param`value, [STRING, STRING])
            share t as paramTable
            '''
    )
    given_param = DolphinDBOperator(
        task_id='given_param',
        dolphindb_conn_id='dolphindb_test',
        sql="params = split('" + variables + "',',');" + \
            "values = split('" + values + "',',');" + \
            "for(i in 0..(params.size()-1)){" + \
            "insert into paramTable values(params[i], values[i]);}"
    )</code></pre><p class="- topic/p p">运行该任务后可在 DolphinDB GUI 共享变量栏中看到参数表及其值，如下图所示：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_3.png"/><br/><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_4.png"/><br/><p class="- topic/p p">每个 DAG 变量的值可以通过 AirFlow 进行修改，点击下图所示位置：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_5.png"/><br/><p class="- topic/p p">DAG 生成后，在如下 Web 页面显示 DAG 使用的变量可以动态修改，如下所示：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_6.png"/><br/><p class="- topic/p p">下表为本项目中涉及的变量名称及其含义：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="252-获取-airflow-中的变量__entry__1"><strong class="+ topic/ph hi-d/b ph b">变量名</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="252-获取-airflow-中的变量__entry__2"><strong class="+ topic/ph hi-d/b ph b">变量描述</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="252-获取-airflow-中的变量__entry__3"><strong class="+ topic/ph hi-d/b ph b">变量示例</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_dbName_factor</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储合成的分钟 k 线的库名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">dfs://oneMinuteFactor</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_tbName_factor</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储合成的分钟 k 线的表名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">oneMinuteFactor</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_dbName_factor_daily</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储合成的分钟 k 线的库名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">dfs://dailyFactor</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_tbName_factor_daily</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储合成的日 k 线的表名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">dailyFactor</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_dbName_origin</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储未处理的原始 snapshot 数据的库名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">dfs://TSDB_snapshot_orig</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_tbName_origin</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储未处理的原始 snapshot 数据的表名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">snapshot_orig</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_dbName_process</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储清洗后 snapshot 数据的库名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">dfs://TSDB_snapshot_process</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_tbName_process</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">存储清洗后 snapshot 数据的表名</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">snapshot_process</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_filedir</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">原始 snapshot 数据存储路径</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">/home/appadmin/（根据实际存放路径修改）</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_start_date</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">全量 ETL 任务中需要处理的原始数据的开始日期</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">2021.01.04</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__1">ETL_end_date</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__2">全量 ETL 任务中需要处理的原始数据的结束日期</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="252-获取-airflow-中的变量__entry__3">2021.01.04</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title18" id="253-dolphindboperator-执行任务"><h4 class="- topic/title title topictitle4" id="ariaid-title18">2.5.3. DolphinDBOperator 执行任务</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDBOperator 全量处理数据</strong></p><p class="- topic/p p">通过 DolphinDBOperator 将上述的数据入库、清洗、计算等设置为 DAG 中的任务</p><p class="- topic/p p">全量处理核心代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>   loadSnapshot = DolphinDBOperator(
        task_id='loadSnapshot',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用 module，加载已封装好的建表及入库函数
            use loadSnapshot::createSnapshotTable
            use  loadSnapshot::loadSnapshotData
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName = params[`ETL_dbName_origin]
            tbName = params[`ETL_tbName_origin]
            startDate = date(params[`ETL_start_date])
            endDate = date(params[`ETL_end_date])
            fileDir = params[`ETL_filedir]
            //结果库表不存在则创建
            if(not existsDatabase(dbName)){
                loadSnapshot::createSnapshotTable::createSnapshot(dbName, tbName)
            }
            //调用清洗函数，后台多进程写入，提高写入效率
            start = now()
            for (loadDate in startDate..endDate){
                submitJob("loadSnapshot"+year(loadDate)+monthOfYear(loadDate)+dayOfMonth(loadDate), "loadSnapshot", loadSnapshot::loadSnapshotData::loadSnapshot{, dbName, tbName, fileDir}, loadDate)
            }
            //查看写入任务是否完成，以保证后续处理部分数据源完整
            do{
                cnt = exec count(*) from getRecentJobs() where jobDesc="loadSnapshot" and endTime is null
            }
            while(cnt != 0)
            //查看导入过程中是否有异常，有异常则抛出异常
            cnt = exec count(*) from pnodeRun(getRecentJobs) where jobDesc="loadSnapshot" and errorMsg is not null and receivedTime &gt; start
            if (cnt != 0){
                error = exec errorMsg from pnodeRun(getRecentJobs) where jobDesc="loadSnapshot" and errorMsg is not null and receivedTime &gt; start
                throw error[0]
            }
            '''
    )
    processSnapshot = DolphinDBOperator(
        task_id='processSnapshot',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用 module，加载已封装好的建表及入库函数
            use processSnapshot::createSnapshot_array
            use processSnapshot::processSnapshotData
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName_orig = params[`ETL_dbName_origin]
            tbName_orig = params[`ETL_tbName_origin]
            dbName_process = params[`ETL_dbName_process]
            tbName_process = params[`ETL_tbName_process]
            startDate = date(params[`ETL_start_date])
            endDate = date(params[`ETL_end_date])
            //结果库表不存在则创建
            if(not existsDatabase(dbName_process)){
                processSnapshot::createSnapshot_array::createProcessTable(dbName_process, tbName_process)
            }
            //后台多进程处理，提高处理效率
            start = now()
            for (processDate in startDate..endDate){
                submitJob("processSnapshot"+year(processDate)+monthOfYear(processDate)+dayOfMonth(processDate), "processSnapshot", processSnapshot::processSnapshotData::process{, dbName_orig, tbName_orig, dbName_process, tbName_process}, processDate)
            }
            //查看清洗任务是否完成，以保证后续处理部分数据源完整
            do{
                cnt = exec count(*) from getRecentJobs() where jobDesc="processSnapshot" and endTime is null
            }
            while(cnt != 0)
            //查看清洗过程中是否有异常，有异常则抛出异常
            cnt = exec count(*) from pnodeRun(getRecentJobs) where jobDesc="processSnapshot" and errorMsg is not null and receivedTime &gt; start
            if (cnt != 0){
                error = exec errorMsg from pnodeRun(getRecentJobs) where jobDesc="processSnapshot" and errorMsg is not null and receivedTime &gt; start
                throw error[0]
            }
            '''
    )
    calMinuteFactor = DolphinDBOperator(
        task_id='calMinuteFactor',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用 module，加载已封装好的建表及入库函数
            use Factor::createFactorOneMinute
            use Factor::calFactorOneMinute
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName = params[`ETL_dbName_process]
            tbName = params[`ETL_tbName_process]	
            dbName_factor = params[`ETL_dbName_factor]
            tbName_factor = params[`ETL_tbName_factor]
            //结果库表不存在则创建
            if(not existsDatabase(dbName_factor)){
                createFactorOneMinute(dbName_factor, tbName_factor)
            }
            factorTable = loadTable(dbName_factor, tbName_factor)
            //调用计算函数
            calFactorOneMinute(dbName, tbName,factorTable)
            '''
    )
    calDailyFactor = DolphinDBOperator(
        task_id='calDailyFactor',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用 module，加载已封装好的建表及入库函数
            use Factor::createFactorDaily
            use Factor::calFactorDaily1	
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName = params[`ETL_dbName_process]
            tbName = params[`ETL_tbName_process]	
            dbName_factor = params[`ETL_dbName_factor_daily]
            tbName_factor = params[`ETL_tbName_factor_daily]
            //结果库表不存在则创建
            if(not existsDatabase(dbName_factor)){
                createFactorDaily(dbName_factor, tbName_factor)
            }
            //调用计算函数
            factorTable = loadTable(dbName_factor, tbName_factor)
            Factor::calFactorDaily1::calFactorDaily(dbName, tbName,factorTable)
            '''
    )</code></pre><p class="- topic/p p">根据任务间的依赖关系，构建 DAG，示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>    start_task &gt;&gt; create_parameter_table &gt;&gt; given_param &gt;&gt; loadSnapshot &gt;&gt; processSnapshot &gt;&gt; calMinuteFactor &gt;&gt; calDailyFactor</code></pre></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDBOperator 增量数据入库</strong></p><p class="- topic/p p">增量数据任务构建代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>addLoadSnapshot = DolphinDBOperator(
        task_id='addLoadSnapshot',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用module，加载已封装好的入库函数
            use  addLoadSnapshot::loadSnapshotData
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName = params[`ETL_dbName_origin]
            tbName = params[`ETL_tbName_origin]
            fileDir = params[`ETL_filedir]
            //获取交易日历
            MarketDays = getMarketCalendar("CFFEX")
            //是交易日则进行数据入库
            if(today() in MarketDays ){
                fileDir = params[`ETL_filedir]
                addLoadSnapshot::loadSnapshotData::loadSnapshot(today(), dbName, tbName, fileDir)
            }
            '''
    )
    addProcessSnapshot = DolphinDBOperator(
        task_id='addProcessSnapshot',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用module，加载已封装好的清洗函数
            use addProcessSnapshot::processSnapshotData
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName_orig = params[`ETL_dbName_origin]
            tbName_orig = params[`ETL_tbName_origin]
            dbName_process = params[`ETL_dbName_process]
            tbName_process = params[`ETL_tbName_process]
            //获取交易日历
            MarketDays = getMarketCalendar("CFFEX")
            //是交易日则进行数据处理
            if(today() in MarketDays ){
                addProcessSnapshot::processSnapshotData::process(today(), dbName_orig, tbName_orig, dbName_process, tbName_process)
            }
            '''
    )
    addCalMinuteFactor= DolphinDBOperator(
        task_id='addCalMinuteFactor',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用module，加载已封装好的计算函数
            use addFactor::calFactorOneMinute
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName = params[`ETL_dbName_process]
            tbName = params[`ETL_tbName_process]	
            dbName_factor = params[`ETL_dbName_factor]
            tbName_factor = params[`ETL_tbName_factor]
            factorTable = loadTable(dbName_factor, tbName_factor)
            //获取交易日历
            MarketDays = getMarketCalendar("CFFEX")
            //是交易日则调用计算函数合成分钟K线
            if(today() in MarketDays ){
                	addFactor::calFactorOneMinute::calFactorOneMinute(dbName, tbName,today(), factorTable)
            }
            '''
    )
    addCalDailyFactor= DolphinDBOperator(
        task_id='addCalDailyFactor',
        dolphindb_conn_id='dolphindb_test',
        sql='''
            pnodeRun(clearAllCache)
            undef(all)
            go;
            //使用module，加载已封装好的计算函数
            use addFactor::calFactorDaily1	
            //通过参数共享表获取参数
            params = dict(paramTable[`param], paramTable[`value])
            dbName = params[`ETL_dbName_process]
            tbName = params[`ETL_tbName_process]	
            dbName_factor = params[`ETL_dbName_factor_daily]
            tbName_factor = params[`ETL_tbName_factor_daily]
            factorTable = loadTable(dbName_factor, tbName_factor)
            //获取交易日历
            MarketDays = getMarketCalendar("CFFEX")
            //是交易日则调用计算函数合成日K线
            if(today() in MarketDays ){
                addFactor::calFactorDaily1::calFactorDaily(dbName, tbName,today(), factorTable)
            }
            '''
    )</code></pre><p class="- topic/p p">根据任务间的依赖关系，构建 DAG，示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>    start_task &gt;&gt; create_parameter_table &gt;&gt; given_param &gt;&gt; addLoadSnapshot &gt;&gt; addProcessSnapshot &gt;&gt; addCalMinuteFactor &gt;&gt; addCalDailyFactor</code></pre></li></ul></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title19" id="254-生成-dag"><h4 class="- topic/title title topictitle4" id="ariaid-title19">2.5.4. 生成 DAG</h4><div class="- topic/body body"><p class="- topic/p p">根据如下步骤部署项目：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第一步 DolphinDB 项目部署</strong></p><p class="- topic/p p">将 DolphinDB 项目中的 <em class="+ topic/ph hi-d/i ph i">addETL</em> 和 <em class="+ topic/ph hi-d/i ph i">fullETL</em> 项目分别导入 DolphinDB GUI (DolphinDB 客户端工具)中：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_7.png"/><br/><p class="- topic/p p">将 <em class="+ topic/ph hi-d/i ph i">addETL</em> 及 <em class="+ topic/ph hi-d/i ph i">fullETL</em> 项目中的 module 模块上传至 Airflow 中已建立连接的 DolphinDB server 中：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_8.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第二步 python 项目部署</strong></p><p class="- topic/p p">将 <em class="+ topic/ph hi-d/i ph i">python</em> 项目中的 python 脚本放置到 &lt;Airflow_install_Dir/airflow/dags&gt; 目录下。注意，新建的 DAG 任务并不会马上出现在界面上，默认需要等待5分钟后刷新，也可修改 <em class="+ topic/ph hi-d/i ph i">airflow.cfg</em> 文件中的 <em class="+ topic/ph hi-d/i ph i">dag_dir_list_interval</em> 调整刷新间隔。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第三步 Airflow 变量导入</strong></p><p class="- topic/p p">在 Airflow 网页中进入 Admin--&gt;Variables，将 <em class="+ topic/ph hi-d/i ph i">Variables.json</em> 文件上传，将变量导入 Airflow 中，并根据实际情况调整变量值。</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_9.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">第四步 上传原始数据文件</strong></p><p class="- topic/p p">将数据文件上传至服务器，并根据数据文件的实际存放路径，在 Airflow 中修改 <code class="+ topic/ph pr-d/codeph ph codeph">ETL_filedir</code> 变量。如运行增量 ETL 任务，需要将数据文件名中的日期改为当前日期，如：<em class="+ topic/ph hi-d/i ph i">20230330snapshot.csv</em>，以避免无数据导致任务失败。</p><p class="- topic/p p">最终实现 DAG 如下所示：</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">全量数据入库</strong>：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_10.png"/><br/><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">增量数据入库</strong>：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/2_11.png"/><br/><p class="- topic/p p">运行任务后，任务实例为绿色代表任务运行成功；红色表示任务运行失败；橙色则表示该任务所依赖的上游任务运行失败，任务未启动。</p></li></ul></div></article></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title20" id="3-常见问题解答faq"><h2 class="- topic/title title topictitle2" id="ariaid-title20">3. 常见问题解答(FAQ)</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title21" id="31-如何捕获-dolphindb-脚本中的-print-函数打印的信息"><h3 class="- topic/title title topictitle3" id="ariaid-title21">3.1. 如何捕获 DolphinDB 脚本中的 print 函数打印的信息</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">DolphinDB 脚本的 print 的信息为标准输出，可以在 <code class="+ topic/ph pr-d/codeph ph codeph">airflow-scheduler.out</code> 中找到，如下图所示：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_1.png"/><br/></li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title22" id="32-dolphindb-脚本中的异步作业-submitjob-如何检测其完成状态"><h3 class="- topic/title title topictitle3" id="ariaid-title22">3.2. DolphinDB 脚本中的异步作业 submitjob 如何检测其完成状态</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">通过 DolphinDB 的函数 <code class="+ topic/ph pr-d/codeph ph codeph">getRecntJobs</code> 获取后台作业信息, 之后在 DolphinDB DAG 中添加判断逻辑, 代码示例如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>DolphinDBOperator(
        task_id='processSnapshot',
        dolphindb_conn_id='dolphindb_test',
        sql='''
          //检查所有任务是否全部完成
            do{
                cnt = exec count(*) from getRecentJobs() where jobDesc="processSnapshot" and endTime is null
            }
            while(cnt != 0)
            //检查后台任务是否成功，失败则抛出异常
            cnt = exec count(*) from pnodeRun(getRecentJobs) where jobDesc="processSnapshot" and errorMsg is not null and receivedTime &gt; start
            if (cnt != 0){
                error = exec errorMsg from pnodeRun(getRecentJobs) where jobDesc="processSnapshot" and errorMsg is not null and receivedTime &gt; start
                throw error[0]
            }
            '''
    )</code></pre></li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title23" id="33-执行-airflow-中经常遇到连接超时断开该如何处理"><h3 class="- topic/title title topictitle3" id="ariaid-title23">3.3. 执行 Airflow 中经常遇到连接超时断开，该如何处理</h3><div class="- topic/body body"><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_2.png"/><br/><p class="- topic/p p">当遇到如上问题，可能是网络延时导致的，可以在建立连接时设置参数，如上图，在 DolphinDB 连接中设置 <em class="+ topic/ph hi-d/i ph i">KeepAliveTime</em> 及 <em class="+ topic/ph hi-d/i ph i">reconnect</em> 参数即可。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title24" id="34-将-start-date-日期设为当前日期每天运行一次为什么当天不会运行"><h3 class="- topic/title title topictitle3" id="ariaid-title24">3.4. 将 start_date 日期设为当前日期，每天运行一次，为什么当天不会运行</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">在 Airflow 中一个定时调度任务的最早开始时间为 start_date + scheduler_interval，例如：<code class="+ topic/ph pr-d/codeph ph codeph">start_date = 2023.03.16</code>，每天调用一次，则最早一次任务调度为 2023.03.17，所以当天的任务无法执行。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title25" id="35-dolphindboperator-任务运行失败如何定位失败原因"><h3 class="- topic/title title topictitle3" id="ariaid-title25">3.5. DolphinDBOperator 任务运行失败如何定位失败原因</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">任务失败后，DolphinDBOperator 会将具体的错误信息打印在日志中，可通过查看日志信息，定位异常代码并进行修改。查看日志信息步骤如下：</p><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_3.png"/><br/><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_4.png"/><br/><img class="- topic/image image" src="images/Best_Practices_for_DolphinDB_and_Python_AirFlow/3_5.png"/><br/></li></ul></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title26" id="4-法律声明"><h2 class="- topic/title title topictitle2" id="ariaid-title26">4. 法律声明</h2><div class="- topic/body body"><p class="- topic/p p">基于Apache License 2.0的使用许可协议，本文中所涉及到的 Airflow 相关安装包及源代码，作为 DolphinDB Airflow 插件的组成部分而存在，但 Airflow 安装包或源代码的版权归属于 Apache Software Foundation。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title27" id="5-附件"><h2 class="- topic/title title topictitle2" id="ariaid-title27">5. 附件</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">DolphinDB 工程项目：<a class="- topic/xref xref" href="script/Best_Practices_for_DolphinDB_and_Python_AirFlow/DolphinDB_projects/addETL.zip">addETL</a>，<a class="- topic/xref xref" href="script/Best_Practices_for_DolphinDB_and_Python_AirFlow/DolphinDB_projects/fullETL.zip">fullETL</a></li><li class="- topic/li li">Python 项目：<a class="- topic/xref xref" href="script/Best_Practices_for_DolphinDB_and_Python_AirFlow/Python_projects/addETL.py">addETL.py</a>，<a class="- topic/xref xref" href="script/Best_Practices_for_DolphinDB_and_Python_AirFlow/Python_projects/fullETL.py">fullETL.py</a></li><li class="- topic/li li">数据文件：<a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads/docs/Best_Practices_for_DolphinDB_and_Python_AirFlow.zip" target="_blank" rel="external noopener">20210104snapshot.csv</a></li><li class="- topic/li li">Airflow 变量：<a class="- topic/xref xref" href="script/Best_Practices_for_DolphinDB_and_Python_AirFlow/variables.json">Variables.json</a></li></ul></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-airflow" data-tocid="1-airflow">1. Airflow</a><ul><li class="topic-item"><a href="#11-airflow-%E7%AE%80%E4%BB%8B" data-tocid="11-airflow-简介">1.1. Airflow 简介</a></li><li class="topic-item"><a href="#12-airflow-%E9%83%A8%E5%88%86%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD" data-tocid="12-airflow-部分核心功能">1.2. Airflow 部分核心功能</a></li><li class="topic-item"><a href="#13-dolphindboperator" data-tocid="13-dolphindboperator">1.3. DolphinDBOperator</a></li><li class="topic-item"><a href="#14-airflow-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2" data-tocid="14-airflow-安装部署">1.4. Airflow 安装部署</a></li></ul></li><li class="topic-item"><a href="#2-airflow-%E8%B0%83%E5%BA%A6%E5%AF%B9%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE-etl" data-tocid="2-airflow-调度对行情数据-etl">2. Airflow 调度对行情数据 ETL</a><ul><li class="topic-item"><a href="#21-%E6%95%B4%E4%BD%93-etl-%E6%9E%B6%E6%9E%84%E5%9B%BE" data-tocid="21-整体-etl-架构图">2.1. 整体 ETL 架构图</a></li><li class="topic-item"><a href="#22-%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D" data-tocid="22-数据介绍">2.2. 数据介绍</a></li><li class="topic-item"><a href="#23-dolphindb-%E6%A0%B8%E5%BF%83%E6%B8%85%E6%B4%97%E8%84%9A%E6%9C%AC%E4%BB%8B%E7%BB%8D" data-tocid="23-dolphindb-核心清洗脚本介绍">2.3. DolphinDB 核心清洗脚本介绍</a><ul><li class="topic-item"><a href="#231-%E5%88%9B%E5%BB%BA%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%93%E8%A1%A8" data-tocid="231-创建分布式库表">2.3.1. 创建分布式库表</a></li><li class="topic-item"><a href="#232-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97" data-tocid="232-数据清洗">2.3.2. 数据清洗</a></li><li class="topic-item"><a href="#233-%E6%B8%85%E6%B4%97%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E5%90%88%E6%88%90-k-%E7%BA%BF" data-tocid="233-清洗行情数据合成-k-线">2.3.3. 清洗行情数据合成 K 线</a></li></ul></li><li class="topic-item"><a href="#24-%E5%A2%9E%E9%87%8F%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97" data-tocid="24-增量数据清洗">2.4. 增量数据清洗</a></li><li class="topic-item"><a href="#25-airflow-%E7%94%9F%E6%88%90-dag-%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1" data-tocid="25-airflow-生成-dag-执行任务">2.5. Airflow 生成 DAG 执行任务</a><ul><li class="topic-item"><a href="#251-%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA-dag-%E5%AE%9E%E4%BE%8B" data-tocid="251-生成一个-dag-实例">2.5.1. 生成一个 DAG 实例</a></li><li class="topic-item"><a href="#252-%E8%8E%B7%E5%8F%96-airflow-%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F" data-tocid="252-获取-airflow-中的变量">2.5.2. 获取 Airflow 中的变量</a></li><li class="topic-item"><a href="#253-dolphindboperator-%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1" data-tocid="253-dolphindboperator-执行任务">2.5.3. DolphinDBOperator 执行任务</a></li><li class="topic-item"><a href="#254-%E7%94%9F%E6%88%90-dag" data-tocid="254-生成-dag">2.5.4. 生成 DAG</a></li></ul></li></ul></li><li class="topic-item"><a href="#3-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94faq" data-tocid="3-常见问题解答faq">3. 常见问题解答(FAQ)</a><ul><li class="topic-item"><a href="#31-%E5%A6%82%E4%BD%95%E6%8D%95%E8%8E%B7-dolphindb-%E8%84%9A%E6%9C%AC%E4%B8%AD%E7%9A%84-print-%E5%87%BD%E6%95%B0%E6%89%93%E5%8D%B0%E7%9A%84%E4%BF%A1%E6%81%AF" data-tocid="31-如何捕获-dolphindb-脚本中的-print-函数打印的信息">3.1. 如何捕获 DolphinDB 脚本中的 print 函数打印的信息</a></li><li class="topic-item"><a href="#32-dolphindb-%E8%84%9A%E6%9C%AC%E4%B8%AD%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BD%9C%E4%B8%9A-submitjob-%E5%A6%82%E4%BD%95%E6%A3%80%E6%B5%8B%E5%85%B6%E5%AE%8C%E6%88%90%E7%8A%B6%E6%80%81" data-tocid="32-dolphindb-脚本中的异步作业-submitjob-如何检测其完成状态">3.2. DolphinDB 脚本中的异步作业 submitjob 如何检测其完成状态</a></li><li class="topic-item"><a href="#33-%E6%89%A7%E8%A1%8C-airflow-%E4%B8%AD%E7%BB%8F%E5%B8%B8%E9%81%87%E5%88%B0%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%E6%96%AD%E5%BC%80%E8%AF%A5%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86" data-tocid="33-执行-airflow-中经常遇到连接超时断开该如何处理">3.3. 执行 Airflow 中经常遇到连接超时断开，该如何处理</a></li><li class="topic-item"><a href="#34-%E5%B0%86-start-date-%E6%97%A5%E6%9C%9F%E8%AE%BE%E4%B8%BA%E5%BD%93%E5%89%8D%E6%97%A5%E6%9C%9F%E6%AF%8F%E5%A4%A9%E8%BF%90%E8%A1%8C%E4%B8%80%E6%AC%A1%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BD%93%E5%A4%A9%E4%B8%8D%E4%BC%9A%E8%BF%90%E8%A1%8C" data-tocid="34-将-start-date-日期设为当前日期每天运行一次为什么当天不会运行">3.4. 将 start_date 日期设为当前日期，每天运行一次，为什么当天不会运行</a></li><li class="topic-item"><a href="#35-dolphindboperator-%E4%BB%BB%E5%8A%A1%E8%BF%90%E8%A1%8C%E5%A4%B1%E8%B4%A5%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E5%A4%B1%E8%B4%A5%E5%8E%9F%E5%9B%A0" data-tocid="35-dolphindboperator-任务运行失败如何定位失败原因">3.5. DolphinDBOperator 任务运行失败如何定位失败原因</a></li></ul></li><li class="topic-item"><a href="#4-%E6%B3%95%E5%BE%8B%E5%A3%B0%E6%98%8E" data-tocid="4-法律声明">4. 法律声明</a></li><li class="topic-item"><a href="#5-%E9%99%84%E4%BB%B6" data-tocid="5-附件">5. 附件</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>