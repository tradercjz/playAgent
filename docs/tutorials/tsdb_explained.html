<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="如果需要进行引擎间的迁移或希望了解 OLAP 引擎和 TSDB 引擎的区别，推荐阅读第 1 章。 如果需要了解底层的架构和工作原理推荐阅读第 2 章。 如果希望直接上手搭建 TSDB 数据库，推荐从第 3 章开始阅读。 第 4 章给出了 TSDB 查询优化案例。 更多 TSDB 的实践案例，请参考第 5 章的场景指南。 第 8 章附录列出了 TSDB 相关的配置项、运维函数以及常见问题一览表。 ..."/><meta name="DC.rights.owner" content="(C) 版权 2025"/><meta name="copyright" content="(C) 版权 2025"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="tsdb-存储引擎详解"/><title>TSDB 存储引擎详解</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20250305183303418/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20250305183303418/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;tsdb-存储引擎详解&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 存储引擎详解&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:11;26:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-阅读指南&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1. 阅读指南&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;如果需要进行引擎间的迁移或希望了解 OLAP 引擎和 TSDB 引擎的区别，推荐阅读第 1 章。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;6:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;如果需要了解底层的架构和工作原理推荐阅读第 2 章。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;如果希望直接上手搭建 TSDB 数据库，推荐从第 3 章开始阅读。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;8:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;第 4 章给出了 TSDB 查询优化案例。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;更多 TSDB 的实践案例，请参考第 5 章的场景指南。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;第 8 章附录列出了 TSDB 相关的配置项、运维函数以及常见问题一览表。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;时序数据是一种按照时间顺序排列的数据集合，例如传感器数据、金融市场数据、网络日志等。由于时序数据具有时间上的连续性和大量的时间戳，传统的关系型数据库或通用数据库在处理大规模时序数据时可能效率较低。因此，针对时序数据进行优化的专用数据库——TSDB 变得越来越重要。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;14:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;为了更好地支持时序数据的分析和存储，DolphinDB 于 2.0 版本推出了”时序数据存储引擎“（Time Series Database Engine，以下简称 TSDB）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;2.0 版本以前 DolphinDB 仅支持分析型数据库存储引擎（Online Analytical Processing，以下简称 OLAP）。OLAP 引擎采用列式存储，压缩率高、查询和计算列的性能也十分优越。随着 DolphinDB 2.0 版本 TSDB 引擎的推出，用户在多模引擎的选择和使用上可能会遇到困难。本文的目标是通过原理解析、使用指导、案例分析的介绍，帮助用户更好地理解 TSDB 引擎，并能够在实际场景中配置更优的存储策略。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-tsdb-vs-olap&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;2. TSDB vs OLAP&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;关于 TSDB 和 OLAP 适用场景的描述性说明，请参照教程：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;tsdb_engine.md&#34; xtrc=&#34;xref:1;20:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;TSDB 存储引擎简介&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;为了便于用户由浅入深地进行学习，本文开头提供了一个 TSDB 和 OLAP 引擎的区别表，以帮助用户对两者的区别有一个概括性的认识。除了列出区别点外，表格中标注了一些使用上的注意点；表格中的术语请参照表尾的术语对照表。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;24:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;24:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;指标&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;24:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;24:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;24:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;24:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;OLAP&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;存储结构&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;26:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;行列混存（Partition Attributes Across，简称 PAX）写入时，每 32 M 数据存储为一个 Level File 文件（压缩后可能小于 10 M），文件内部进一步划分数据为多个 block 并记录索引信息。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;26:153&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;列式存储每个分区下每列都存储为一个文件。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;26:182&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：若列文件过多时，在 IO 时会造成性能瓶颈，因此 OLAP 不适合存储列数过多的宽表。建议 OLAP 字段不超过 100。&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:7;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据形式和类型（区别点）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:8;27:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Array Vector、BLOB 类型&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;27:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不支持左述两类数据&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:10;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据压缩&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:11;28:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;以 block 为压缩单元&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:12;28:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;以列文件为压缩单元。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;28:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：一般情况下，OLAP 压缩率会高于 TSDB。&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:13;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据加载（最小单元）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:14;29:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每个分区的 Level File 文件中的 block&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:15;29:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每个分区的子表的列文件&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:16;30:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写入方式&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:17;30:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;顺序写入&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;30:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：TSDB 引擎每次刷盘都会直接存储为新的 Level File 文件，无需像 OLAP 引擎一样追加数据到对应列文件，磁盘几乎没有寻道压力。&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:18;30:117&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;顺序写入&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;30:126&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：OLAP 引擎列文件过多时，写入时会增加磁盘（HDD）的寻道时间。&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:19;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查找方式&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:20;31:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1. 分区剪枝 查 Cache Engine 缓存（分为两个部分）：    a. unsorted buffer：遍历    b. sorted buffer：二分查找 3. 查找磁盘：根据索引快速定位到 block &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;31:182&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：TSDB 没有用户态的缓存机制，只有操作系统的缓存。&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:21;31:216&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1. 分区剪枝查2. Cache Engine 缓存3. 查找磁盘：读取相关列文件后遍历查找 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;31:277&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：OLAP 会维护用户态缓存。第一次查询后，会将上次查询的列文件缓存在内存中。&lt;/b&gt; 该部分缓存会保存在内存中，直到缓存占用达到 warningMemSize，系统才会回收部分内存。用户也可以调用 clearAllCache 手动清理缓存。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:22;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;是否支持索引&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:23;32:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;支持，以 sortKey 字段的组合值作为索引。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:24;32:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不支持&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:25;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;优化查询方法&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:26;33:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;命中分区剪枝；通过索引加速查询。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:27;33:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;命中分区剪枝；读取整列数据较为高效，因此查询整个分区或整列数据时具有查询优势。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:28;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;是否支持去重&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:29;34:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;支持，基于 sortColumns 去重&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:30;34:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不支持&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:31;35:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;读写数据是否有序&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:32;35:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每批刷盘的数据会按照 sortColumns 排序。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;35:61&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：查询时，只保证单个 Level File 内的数据是有序的，Level File 之间的数据顺序不能保证。&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:33;35:122&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;按写入顺序写入磁盘。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;35:137&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：单个分区内，查询结果的顺序和写入顺序一致；跨分区查询时，单分区数据和写入顺序一致，系统会按固定的分区顺序合并各分区的查询结果返回给用户端，因此重复查询仍维持结果的一致性。&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:34;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;增删改&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:35;36:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;36:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;增：&lt;/b&gt; 每次写入的数据可能存储在不同的 Level File。Level File 是不可修改和追加的。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;36:90&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;删：&lt;/b&gt; keepDuplicates=LAST 时，若 softDelete=true，则会先打上删除标记，追加写入到一个新的 Level File，然后在文件合并时将旧数据删除；若 softDelete=false，则读数据到内存，更新后再写回。keepDuplicates=FIRST/ALL 时：读数据到内存，更新后再写回 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;36:262&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;改：&lt;/b&gt; 取决于去重机制 keepDuplicates=LAST：直接追加写入到一个新的 Level File，文件合并时会将旧数据删除 keepDuplicates=FIRST/ALL：读数据到内存，更新后再写回&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:36;36:373&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;36:374&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;增：&lt;/b&gt; 直接追加到列尾&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;36:392&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;删：&lt;/b&gt; 读取相关分区下的所有列文件到内存，删除后再写回&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;36:426&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;改：&lt;/b&gt; 读列文件到内存，更新完再写回&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:37;37:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;DDL &amp;amp; DML 操作（仅列出两者存在区别的点）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:38;37:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不支持 rename!（修改字段名），replaceColumn!（修改字段的值或类型），dropColumns! （删除列字段）等操作&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:39;37:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;支持左述操作&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:40;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;资源开销（仅列出两者存在区别的点）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:41;38:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;内存：排序开销，索引缓存；磁盘：合并 Level File 的 IO 开销。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;14&#34; xtrc=&#34;entry:42;38:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不存在左述开销&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-术语对照&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;2.1. 术语对照&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;block：参见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#确定索引键值&#34; xtrc=&#34;xref:2;42:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;确定索引键值&lt;/xref&gt;部分的说明。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File：参见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#level-file-文件&#34; xtrc=&#34;xref:3;43:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;Level File&lt;/xref&gt; 部分的说明。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;unsorted buffer / sorted buffer：参见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#写入流程&#34; xtrc=&#34;xref:4;44:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;写入流程&lt;/xref&gt;部分的说明。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortColumns：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#排序列-sortcolumns&#34; xtrc=&#34;xref:5;45:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;sortColumns&lt;/xref&gt; 的介绍。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortKey：参见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#确定索引键值&#34; xtrc=&#34;xref:6;46:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;确定索引键值&lt;/xref&gt; 部分的说明。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-tsdb-存储引擎架构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3. TSDB 存储引擎架构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;48:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;50:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;本章将存储架构、读写流程，参数功能，以及底层文件组织层面详细解析 TSDB 引擎的工作原理，以帮助用户从架构层面理解 TSDB 引擎的机制，从而更好的调试和配置 TSDB 的功能参数，实现更优的解决方案。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-lsm-tree&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;52:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;52:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.1. LSM-Tree&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;52:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;54:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎是 DolphinDB 基于 Log Structured Merge Tree (以下简称 LSM-Tree) 自研的存储引擎。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;56:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LSM-Tree 是一种分层、有序、面向磁盘的数据结构，主要用于处理写入密集型的工作负载，如日志系统、实时分析系统和数据库等。其实现的核心思想是利用磁盘批量顺序写入大幅提高写入性能。其工作流程图如下所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/LSM_Tree.png&#34; xtrc=&#34;image:1;58:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;787&#34; dita-ot:image-height=&#34;457&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;60:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:18;60:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LSM-Tree 的数据写入流程：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;62:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;62:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据先写入 WAL Log（Write-Ahead Logging）用于故障恢复。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;63:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;完成 WAL Log 写入后，数据会先存储在内存中的一个有序数据结构中（通常称为“内存表”），可以是一个红黑树结构或者 Skip List。当内存表缓存到一定大小后，会将其冻结（immutable）等待刷盘，然后生成一个新的内存表供之后的写事务写入。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;64:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;将冻结的内存表写入磁盘的 SSTable（Sorted Strings Table）文件中，SSTable 是一种有序且不可变的数据文件，其内部的数据按照键值进行排序。（HINT：SSTable 即对应 DolphinDB 的 Level File 文件）。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;65:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LSM-Tree 通常维护多个层级的 SSTable 文件，越旧的数据会存储在磁盘上越高的层级，且 SSTable 文件大小也会逐级递增。刚写入的 SSTable 文件存储在磁盘的 Level 0 层级，当单层的文件数过多或文件大小过大，系统会将多个 SSTable 文件合并成一个更大的文件，并在合并时进行去重操作，以保证数据的有序性。通过合并操作，可以提高查询性能，减少存储占用。但注意，合并操作会造成一定程度的写放大。&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;67:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:19;67:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LSM-Tree 的数据查询流程：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:2;69:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;69:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;首先在内存表进行检索，由于内存表是有序的数据结构，因此可以利用算法快速检索并返回结果。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;如果在内存表中找不到数据，则会按层级遍历磁盘上的 SSTable 进行检索，由于 SSTable 文件数据是按键值排序的，因此可以在单个 SSTable 内快速进行范围查询。为了提高 SSTable 遍历的效率，可以给 SSTable 增加 Bloom Filter，以减少不必要的磁盘扫描。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;71:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询时，SSTable 可能会包含多个不同历史版本的数据，此时需要根据查询条件，找到符合版本的数据（例如最新一条数据）。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;73:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:20;73:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：&lt;/b&gt; 最坏的情况下，需要将所有层级的 SSTable 文件都遍历一遍，如果 SSTable 文件过多，查询是非常低效的，因此可以理解为什么 LSM-Tree 要引入合并机制，减小 SSTable 的文件数。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;相较于传统的 B+ 树而言，LSM-Tree 的优势在于高吞吐写入与较低的随机写延迟，这非常契合 DolphinDB 海量数据高性能写入的设计诉求。虽然没有 B+ 树那样高效的随机读和范围查询性能，LSM-Tree 依靠键值排序使得单个 SSTable 文件的范围查询也十分高效。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:21;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;参考资料：&lt;/b&gt; &lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://www.sobyte.net/post/2022-04/lsm-tree/&#34; scope=&#34;external&#34; xtrc=&#34;xref:7;77:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;Principle of LSM Tree&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;DolphinDB 的 TSDB 引擎是基于 LSM-Tree 架构进行开发的，因此大部分内部的流程机制也和 LSM-Tree 类似，但在某些步骤进行了优化：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;81:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:22;81:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写入：&lt;/b&gt; 与 LSM-Tree 直接写入一个有序的数据结构不同，DolphinDB TSDB 引擎在写入数据到内存时，会先按写入顺序存储在一个写缓冲区域（unsorted write Buffer），当数据量累积到一定程度，再进行排序转化为一个 sorted buffer。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;82:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:23;82:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询：&lt;/b&gt; DolphinDB TSDB 引擎会预先遍历 Level File（对应 LSM-Tree 的 SSTable 文件），读取查询涉及的分区下所有 Level File 尾部的索引信息到内存的索引区域（一次性读，常驻内存）。后续查询时，系统会先查询内存中的索引，若命中，则可以快速定位到对应 Level File 的数据块，无需再遍历磁盘上的文件。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/read_write.png&#34; xtrc=&#34;image:2;84:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;712&#34; dita-ot:image-height=&#34;631&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-tsdb-引擎-crud-流程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.2. TSDB 引擎 CRUD 流程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;88:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;本节将具体介绍 DolphinDB TSDB 引擎的增删改查（CRUD）流程。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;321-写入流程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.2.1. 写入流程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎写入整体上和 OLAP 一致，都是通过两阶段协议进行提交。写入时，先写 Redo Log（每个写事务都会产生一个 Redo Log），并写入 Cache Engine 缓存，最后 由后台线程异步批量写入磁盘。需要注意的是，TSDB 引擎和 OLAP 引擎各自单独维护 Redo 以及 Cache Engine，用户需要通过不同的配置项去设置两个引擎的 Cache Engine 大小，分别为 OLAPCacheEngineSize 和 TSDBCacheEngineSize。&lt;xref class=&#34;- topic/xref &#34; href=&#34;../db_distr_comp/cfg/function_configuration.dita&#34; xtrc=&#34;xref:8;92:246&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;功能配置&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:24;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;具体的写入流程如下：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:3;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;96:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;96:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:25;96:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写 Redo：&lt;/b&gt; 先将数据写入 TSDB Redo Log。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;98:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:26;98:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写 Cache Engine：&lt;/b&gt; 写 Redo Log 的同时，将数据写入 TSDB Cache Engine 的 CacheTable，并在 CacheTable 内部完成数据的排序过程。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/cacheTable.png&#34; xtrc=&#34;image:3;100:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;877&#34; dita-ot:image-height=&#34;261&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;102:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;CacheTable 分为两个部分：首先是 write buffer，数据刚写入时会追加到 write buffer 的尾部，该 buffer 的数据是未排序的。当 write buffer 超过 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;102:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheTableBufferThreshold&lt;/i&gt; 的配置值（默认 16384 行），则按照 sortColumns 指定的列排序，转成一个 sorted buffer (该内存是 read only 的)，同时清空 write buffer。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;104:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:27;104:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写磁盘：&lt;/b&gt; 若某写事务到来时，Cache Engine 中的数据累计超过了 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;104:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheEngineSize&lt;/i&gt;，或经过一定时间，系统将进行一次刷盘操作。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;106:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;106:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;106:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;刷盘前，系统会将 CacheTable 的所有数据按照 sortColumns 进行归并排序，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:28;106:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;再按分区&lt;/b&gt;写入磁盘 Level 0 层的 Level File 文件中（大小为 32M）。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;107:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;107:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;刷盘时，若单个分区的数据量很大，按 32 M 拆分可能产生多个 Level File 文件（见下注 1）；若单个分区写入数据量不足 32 M 或拆分后最后一部分数据不足 32 M，也会写为一个 Level File。由于 Level File 一旦写入就是不可变的，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:29;107:139&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;下次写入不会向磁盘的 Level File 文件追加数据&lt;/b&gt; 。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;109:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:30;109:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注 1：&lt;/b&gt; 同属于一个 sortKey 值的数据不会被拆分到不同的 Level File 文件。因此实际场景我们会发现一个 Level File 的文件可能会大于 32 M，若一个 sortKey 值对应的数据量特别巨大，甚至可能达到更高！&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;111:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:31;111:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注 2：&lt;/b&gt; 可以通过设置刷盘的工作线程数配置项 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;111:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheFlushWorkNum&lt;/i&gt; 来提高刷盘效率。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;113:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:32;113:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注 3：&lt;/b&gt; 根据步骤 2，3，可以发现刷盘前数据先局部排序（sorted buffer），再整体排序，共执行了两次排序操作。实际就是通过分治的思想，提升了排序的效率。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若刷盘过程中，又有新的数据写入 Cache Engine，则系统会分配新的 Cache Engine 空间来进行写入。在极端情况下，TSDB 的 Cache Engine 占用的内存 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:33;115:93&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;会达到两倍&lt;/b&gt; 的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;115:105&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheEngineSize&lt;/i&gt;（配置项）的指定值。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:34;115:136&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;在配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;115:142&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheEngineSize&lt;/i&gt; 大小和 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;115:168&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;maxMemSize&lt;/i&gt;，需要注意这一点，以免造成内存溢出的情况。&lt;/b&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;322-查询流程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.2.2. 查询流程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;相较于 OLAP 引擎，TSDB 引擎增加了索引的机制，因此更适用于点查场景，因此在配置 TSDB 引擎的 sortKey 字段（参照&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#确定索引键值&#34; xtrc=&#34;xref:9;119:68&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;确定索引键值&lt;/xref&gt;的说明）时，可以优先考虑从频繁查询的字段中进行选取（如需了解更多 sortColumns 的设置原则，请参见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#创建数据库&#34; xtrc=&#34;xref:10;119:139&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;创建数据库&lt;/xref&gt;的合理设置排序字段部分）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;此外和 OLAP 引擎在用户态缓存数据不同（第一次执行查询语句会加载分区数据，这部分数据会常驻内存，后续的查询可以提速，但增大了内存开销），TSDB 引擎只有操作系统的缓存，没有用户态的缓存。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:35;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;具体的查询流程：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:4;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;125:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:36;125:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区剪枝：&lt;/b&gt; 根据查询语句进行分区剪枝，缩窄查询范围。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;126:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:37;126:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;加载索引：&lt;/b&gt; 遍历涉及到的分区下的所有 Level File，将其尾部的索引信息加载到内存中（索引信息采用惰性缓存策略，即不会在节点启动时被立即加载进内存，而是在第一次查询命中该分区时才被加载进内存）。查询命中的分区的索引信息一旦被加载到内存后，会一直缓存在内存中（除非因内存不够被置换），后续查询若涉及该分区则不会重复此步骤，而是直接从内存中读取索引信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;128:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:38;128:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：&lt;/b&gt; 内存中存放索引的区域大小由配置项 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;128:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBLevelFileIndexCacheSize&lt;/i&gt; 决定，用户可以通过函数 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getLevelFileIndexCacheStats.dita&#34; xtrc=&#34;xref:11;128:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getLevelFileIndexCacheStatus&lt;/xref&gt; 在线查询内存中的索引占用。若加载的索引大小超过了该值，内部会通过一些缓存淘汰算法进行置换，用户可配置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;128:199&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBLevelFileIndexCacheInvalidPercent&lt;/i&gt; 来调整缓存淘汰算法的阈值。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;130:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;130:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:39;130:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查找内存中的数据：&lt;/b&gt; 先搜索 TSDB Cache Engine 中的数据。若数据在 write buffer 中，则采用顺序扫描的方式查找；若在 sorted buffer 种，则利用其有序性，采用二分查找。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;131:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:40;131:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查找磁盘上的数据：&lt;/b&gt; 根据索引查找磁盘 Level File 中各查询字段的数据块，解压到内存。若查询的过滤条件包含 sortKey 字段，即可根据索引加速查询。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;132:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;132:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:41;132:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;返回查询结果：&lt;/b&gt; 合并上述两步的结果并返回。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;134:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:42;134:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;其中，具体索引流程：&lt;/b&gt;&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/index.png&#34; xtrc=&#34;image:4;136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;1243&#34; dita-ot:image-height=&#34;545&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;138:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;内存索引包含两个部分：sortKey 维护的 block 的偏移量信息（对应 Level File indexes 部分），zonemap 信息（对应 Level File zonemap 部分）。&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:5;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;140:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:43;140:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询 indexes 定位 sortKey：&lt;/b&gt; indexes 中记录了每个 Level File 中每个 sortKey 值下每个字段的 block 的地址偏移量。若查询条件包含 sortKey 字段，则可以根据索引剪枝，缩窄查询范围。命中 sortKey 索引后，即可获取到对应 sortKey 下所有 block 的地址偏移量信息。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;142:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;例如，上图 sortColumns=`deviceId`location`time，查询条件 deviceId = 0，则可以快速定位到所有 Level File 中 deviceId= 0 的 sortKey 及其对应所有字段的 block 数据。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;144:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:44;144:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;根据 zonemap 定位 block：&lt;/b&gt; 由 1 定位到 sortKey 后，系统会查询对应 sortKey 在 zonemap 里的最值信息（min，max）。如果查询条件提供了 sortKey 以外的字段范围，则可以进一步过滤掉一些不在查询范围内的 block 数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;146:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;例如，上图 sortColumns=`deviceId`location`time，查询条件 time between 13:30 and 15:00，则可以根据 time 列的 zonemap 信息，快速定位到查询数据所在的 block 为“block2”。系统根据该信息再去 indexes 找到 block2 的地址偏移量信息，然后根据索引到的所有 Level File 的 block2 的地址，把 block 数据从磁盘中读取出来，再根据去重策略过滤结果后返回给用户端。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;323-更新流程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.2.3. 更新流程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎的更新效率取决于 keepDuplicates 参数配置的去重机制。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;152:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates=ALL/FIRST 时的更新流程：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:6;154:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;154:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:45;154:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区剪枝：&lt;/b&gt; 根据查询语句进行分区剪枝，缩窄查询范围。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;155:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:46;155:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查到内存更新：&lt;/b&gt; 取出对应分区所有数据到内存后，更新数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;156:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:47;156:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写回更新后的分区数据到新目录：&lt;/b&gt; 将更新后的数据重新写入数据库，系统会使用一个新的版本目录（默认是“物理表名_cid”，见下图，其中 tick_2 是物理表名）来保存更新后的分区数据，旧版本的分区数据文件将被定时回收（默认 30 min）。&lt;/li&gt;&lt;/ol&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/update.png&#34; xtrc=&#34;image:5;158:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;422&#34; dita-ot:image-height=&#34;63&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;160:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates=LAST 时的更新流程：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:7;162:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;162:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:48;162:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区剪枝：&lt;/b&gt; 根据查询语句进行分区剪枝，缩窄查询范围。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:41;163:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:49;163:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查到内存更新：&lt;/b&gt; 根据查询条件，查询出需要更新的数据。（查询步骤见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#查询流程&#34; xtrc=&#34;xref:12;163:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;查询流程&lt;/xref&gt;）&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:42;164:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:50;164:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;直接以写数据的方式追加写入：&lt;/b&gt; 更新后，直接追加写入数据库。&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;更新后的数据和旧的数据可能同时存储在磁盘上，但查询时，由于会按照 LAST 机制进行去重，因此可以保证不会查询出旧的数据。旧数据会在 Level File 合并操作时进行删除。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若需要深入了解更新方法、更新流程以及不同策略的更新性能，请参考教程：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;dolphindb_update.md&#34; xtrc=&#34;xref:13;168:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;分布式表数据更新原理和性能介绍&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;324-删除流程&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.2.4. 删除流程&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;172:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎的删除流程和更新流程一致，即：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:43;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;指定 keepDuplicates=ALL/FIRST 时，按分区全量取数，根据条件删除后写入一个新版本目录；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:44;175:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;指定 keepDuplicates=LAST 时，若同时指定 softDelete=true，则取出待删除的数据打上删除标记（软删除），再以追加的方式写回数据库；若指定 softDelete=false，则同 keepDuplicates=ALL/FIRST 时的删除流程。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:51;177:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;具体流程：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:8;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:45;179:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:52;179:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区剪枝：&lt;/b&gt; 根据查询语句进行分区剪枝，缩窄查询范围。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:46;180:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:53;180:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查到内存删除：&lt;/b&gt; 取出对应分区所有数据到内存后，根据条件删除数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:47;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:54;181:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写回删除后的分区数据到新目录：&lt;/b&gt; 将删除后的数据重新写入数据库，系统会使用一个新的 CHUNK 目录（默认是“物理表名_cid”）来保存写入的数据，旧的文件将被定时回收（默认 30 min）。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:55;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:9;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:48;185:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;185:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;在配置 keepDuplicates=ALL / FIRST 场景下，更新操作（keepDuplicates=ALL / FIRST）和删除操作是按分区全量修改，因此需要确保每次更新删除操作涉及分区总大小不会超过系统的可用内存大小，否正会造成内存溢出。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:49;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;187:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;在配置 keepDuplicates=LAST 场景下，更新操作和删除操作是按照直接追加的方式增量修改，效率更高，若业务场景需要高频更新和删除，可以配置此策略。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-排序列-sortcolumns&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.3. 排序列 sortColumns&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortColumns 参数在 TSDB 引擎中起到三个作用：确定索引键值、数据排序、数据去重。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;331-确定索引键值&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.3.1. 确定索引键值&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;193:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;195:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;根据查询流程可以知道，TSDB 的索引机制可以提升查询性能，那么索引又是如何确定的？&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;197:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写入流程提到，在 Cache Engine 中，数据会根据 sortColumns 指定的列进行排序，TSDB 引擎的索引列就是基于排序列建立的。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:56;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortColumns 由两部分组成：sortKey（可以是多列，其组合值作为数据的索引键）, timestamp（时间列）。&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;假设 sortColumns 指定了 n 个字段，则系统取前 n-1 个字段的组合值，作为索引键 sortKey，每个 sortKey 值对应的数据按列存储在一起（如下图，假设 sortColumns 为 deviceId 和 timestamp）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:57;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：&lt;/b&gt; 若 sortColumns 只有一列，则该列将作为 sortKey。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/indexing_mechanism.png&#34; xtrc=&#34;image:6;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;1150&#34; dita-ot:image-height=&#34;462&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每个 sortKey 内部的数据仍然是按列存储的，其中每个列的数据又按记录数划分为多个 block（按固定行数划分，参见 Level File 层级示意图）。block 是内部最小的查询单元，也是数据压缩的单元，其内部数据按照时间列的顺序排序。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;209:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询时，若查询条件包含 sortColumns 指定的字段，系统会先定位到对应的 sortKey 的数据所在的位置，然后根据 block 内部&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:58;209:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据的有序性&lt;/b&gt;以及&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:59;209:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;列之间 block 的对齐性&lt;/b&gt;，通过时间列快速定位到对应的 block，将相关列的 block 读取到内存中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:60;211:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;注：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:10;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:50;213:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:61;213:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;block 数据的有序性&lt;/b&gt;：block 内部数据是按照时间列排好序的，此外每个 sortKey 的元数据都记录了对应每个 block 的第一条数据，因此根据和每个 block 的第一条数据比较，可以快速过滤掉一些不必要的 block 的查询，从而提升查询性能。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:51;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:62;214:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;block 的对齐性&lt;/b&gt;：由于 block 的数据量都是固定的，因此根据时间列快速定位到时间列所在的 block，就能根据该 block 的 offset 快速定位到其他列的 block。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;216:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortKey 需要合理设置，每个分区的 sortKey 值不宜过多。因为同等数据量下，sortKey 值越多，意味着每个 sortKey 对应的数据量越少，不仅在命中索引的过程会增大查询开销，而且会增大读取每个 sortKey 元数据的开销，反而会降低查询效率。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;332-数据排序&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.3.2. 数据排序&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写入流程提到，在 TSDB Cache Engine 中，每批刷盘的数据会根据 sortColumns 进行排序，然后再写入磁盘，可以推断：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:52;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每个写入事务的数据一定是有序的。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:53;223:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;单个 Level File 文件内的数据一定是有序的。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:54;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File 之间数据的顺序无法保证。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:55;225:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每个分区的数据的有序性无法保证。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;结合 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#确定索引键值&#34; xtrc=&#34;xref:14;227:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;确定索引键值&lt;/xref&gt; 节的说明和上述推断，可以了解到 sortColumns 的数据排序功能，并不保证数据整体的有序性，而只是保证 Level File 内数据按 sortKey 有序排列，以及每个 sortKey 中 block 内数据的有序性，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:63;227:135&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;这有助于：&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;229:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:56;229:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询条件包含 sortKey 字段的范围查询或第一个 sortKey 字段的等值查询时，加速内存查找索引的效率。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:57;230:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;命中 sortKey 索引时，可以根据 sortKey 的元数据信息，加速 block 的定位。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;333-数据去重&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.3.3. 数据去重&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 的去重机制主要用于&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:64;234:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;同一个时间点产生多条数据，需要去重的场景&lt;/b&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;去重是基于 sortColumns 进行的，发生在写入时数据排序阶段以及 Level File 的合并阶段。其对应的配置参数为 keepDuplicates（在建表是设置），有三个可选项：ALL（保留所有数据，为默认值），LAST（仅保留最新数据），FIRST（仅保留第一条数据）。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不同去重机制可能会对更新操作产生影响（具体参见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#更新流程&#34; xtrc=&#34;xref:15;238:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;数据更新流程&lt;/xref&gt;）：若 keepDuplicates=ALL/FIRST，那么每次更新，都需要将分区数据读取到内存更新后再写回磁盘；若 keepDuplicates=LAST，则更新数据将以追加的方式写入，真正的更新操作将会在 Level File 合并阶段进行。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:65;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;需要注意：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:11;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:58;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;去重策略不能保证磁盘上存储数据不存在冗余，只能保证查询时不会返回冗余结果。查询数据时，会将对应 sortKey 所在各个 Level File 中的数据块读出，然后在内存中进行去重，再返回查询结果。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:59;243:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;DolphinDB 不支持约束。现实场景下，很多用户会利用 sortColumns 的去重机制，将数据中的主键或唯一约束设置为 sortColumns，造成一个 sortKey 键值对应的数据量很少，从而导致 TSDB 数据库&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:66;243:117&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据膨胀&lt;/b&gt;（详见案例 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#sortkey-数量对查询性能的影响&#34; xtrc=&#34;xref:16;243:131&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;sortkey 数量对查询性能的影响&lt;/xref&gt;）。&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;34-level-file-文件&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;245:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;245:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.4. Level File 文件&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;245:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;247:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎存储的数据文件在 DolphinDB 中被称为 Level File（对应 LSM-Tree 的 SSTable 文件），即 LSMTree 架构各 Level 层级的文件。Level File 主要保存了数据和索引信息，其中索引信息保存在 Level File 的尾部。为了更好地理解 Level File 在整个系统中发挥的作用，本节将对 Level File 进行一个简单介绍。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;341-level-file-的组成&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;249:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;249:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.4.1. Level File 的组成&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;249:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;251:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File 文件存储的内容可以划分为：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/levelFile.png&#34; xtrc=&#34;image:7;253:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;922&#34; dita-ot:image-height=&#34;145&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:60;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;header：记录了一些保留字段、表结构以及事务相关的信息。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:61;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sorted col data：按 sortKey 顺序排列，每个 sortKey 依次存储了每列的 block 数据块。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:62;257:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;zonemap：存储了数据的预聚合信息（每列每个 sortKey 对应数据的 min，max，sum，notnullcount）。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:63;258:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;indexes：sorted col data 的索引信息，记录了 sortKey 个数，每个 sortKey 的记录数、每列 block 数据块在文件中的偏移量信息，checksum 等。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:64;259:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;footer：存储 zonemap 的起始位置，用来定位预聚合和索引区域。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;261:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File 的 zonemap 和 indexes 部分在查询时会加载到内存中，用于索引。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;342-level-file-层级组织&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.4.2. Level File 层级组织&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;265:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File 层级间的组织形式如下图所示：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/level.png&#34; xtrc=&#34;image:8;267:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;768&#34; dita-ot:image-height=&#34;331&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;269:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;磁盘的 Level File 共分为 4 个层级，即 Level 0, 1, 2, 3 层。层级越高，Level File 文件大小越大，每个 Level File 中数据划分的 block 大小也越大。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/tsdb_explained/location.png&#34; xtrc=&#34;image:9;271:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; dita-ot:image-width=&#34;260&#34; dita-ot:image-height=&#34;330&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;343-level-file-合并&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;273:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;273:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;3.4.3. Level File 合并&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;273:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;多次写入后，多个相同的 sortKey 的数据可能分散在不同的 Level File 里。查询时，系统会将所有满足条件的数据读到内存，然后再根据去重机制进行去重。为此，TSDB 设计了文件合并的机制，通过合并操作（compaction）大大减少文件数，有效的清除无效数据，减少碎片化查找，提高磁盘空间利用率（压缩率提升）以及提升查询性能。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:67;277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;文件合并机制：&lt;/b&gt; 若一层的 Level File 超过 10 个，或者单层文件总大小超过下一层单个文件的大小，则做一次合并操作，合并时会根据参数 keepDuplicates 指定的去重策略进行去重。文件数过多时，用户也可以在线调用函数 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/t/triggerTSDBCompaction.dita&#34; xtrc=&#34;xref:17;277:123&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;triggerTSDBCompaction&lt;/xref&gt; 手动触发合并，以减少文件数，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:68;277:201&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;提升查询性能&lt;/b&gt;。合并状态可以通过调用函数 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBCompactionTaskStatus.dita&#34; xtrc=&#34;xref:18;277:225&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBCompactionTaskStatus&lt;/xref&gt; 进行查询。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;279:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:69;279:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;但需要注意：&lt;/b&gt; 合并操作非常消耗 CPU 和磁盘 IO，会造成一定程度的写放大。且对于每个 volume 而言，合并是单线程进行的，当合并任务很多时，耗时将会非常久。如果在写入高峰期，发生合并操作，会降低整个系统的吞吐量。因此，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:70;279:118&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;建议用户使用 scheduleJob 定时（在业务不密集的时间段）触发手动合并任务。&lt;/b&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-合理使用-tsdb-引擎&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;4. 合理使用 TSDB 引擎&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;281:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区、索引等因素都会影响引擎的写入和查询性能，因此在建库建表时合理地配置 TSDB 引擎至关重要。本章将从功能参数配置，以及使用时的注意事项方面，给出一些指导性的建议，方便用户快速上手。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-数据库部署&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;4.1. 数据库部署&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;287:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;在使用 TSDB 引擎前，可以按需调整系统的配置项（TSDB 引擎相关的配置项一览表见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#tsdb-引擎配置项汇总&#34; xtrc=&#34;xref:19;287:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;TSDB 引擎配置项汇总&lt;/xref&gt;），以充分发挥系统的性能。本节主要介绍其中几个重点参数：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:65;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBRedoLogDir：为了提高写入效率，建议将 TSDB redo log 配置在 SSD 盘。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:66;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheEngineSize：默认是 1G，写入压力较大的场景可以适当调大该值。&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;291:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:67;291:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若设置过小，可能导致 cache engine 频繁刷盘，影响系统性能；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:68;292:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若设置过大，由于 cache engine 内缓存的数据量很大，但由于未达到 cache engine 的大小（且未达到十分钟），因此数据尚未刷盘，此时若发生了机器断电或关机，重启后就需要回放大量事务，导致系统启动过慢。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:69;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBLevelFileIndexCacheSize：默认是 5% * maxMemSize，该配置项确定了索引数据（Level File indexes 和 zonemap）的上限，若配置过小，会造成索引频繁置换。在索引部分，较占内存空间的是 zonemap 部分，用户可以根据“分区数量 × sortKey 数量 × （4 × Σ各字段字节数）”进行估算（其中 4 表示 4 种预聚合指标 min，max，sum，notnullcount）。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:70;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBAsyncSortingWorkerNum：非负整数，默认值为 1，用于指定 TSDB cache engine 异步排序的工作线程数。在 CPU 资源充足的情况下，可以适当增大该值，以提高写入性能。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:71;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheFlushWorkNum：TSDB cache engine 刷盘的工作线程数，默认值是 volumes 指定的磁盘卷数。若配置值小于磁盘卷数，则仍取默认值。通常无需修改此配置。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-创建数据库&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;4.2. 创建数据库&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;下述脚本以创建一个组合分区的数据库为例，和 OLAP 引擎创库时的区别仅在于 engine 设置不同：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;db1 = database(, VALUE, 2020.01.01..2021.01.01) db2 = database(, HASH, [SYMBOL, 100]) db = database(directory=dbName, partitionType=COMPO, partitionScheme=[db1, db2], engine=&#34;TSDB&#34;)&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:72;307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;307:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:71;307:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;库表对应关系：&lt;/b&gt; 设计分布式数据库时，若存储的是分布式表，推荐一库一表，因为对于不同的表按照同一分区方案进行分区，可能造成每个分区的数据量不合理；若存储的是维度表，推荐一库多表，集中管理，因为维度表只有一个分区，且一次加载常驻内存。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:73;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;309:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:72;309:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区设计：&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;311:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:74;311:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;311:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:73;311:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎单个分区推荐大小&lt;/b&gt;：400MB - 1GB（压缩前）&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;313:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分布式查询按照分区加载数据进行并行计算（包括查询、删除、修改等操作），若分区粒度过大，可能会造成内存不足、查询并行度降低、更新删除效率降低等问题；若分区粒度过小，可能会产生大量子任务增加节点负荷、大量小文件独写增加系统负荷、控制节点元数据爆炸等问题。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:75;315:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;315:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:74;315:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区设计步骤：&lt;/b&gt;&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:12;317:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:76;317:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;以推荐大小作为参照，先根据表中的记录数和每个字段的大小&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:75;317:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;估算数据量&lt;/b&gt;，再根据分区方案计算的&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:76;317:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区数（如天 + 股票 HASH10 的组合分区，可以按天数 * 10）&lt;/b&gt;，通过数据量/分区数计算得到每个分区的大小。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:77;318:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若分区粒度不合理，调整分区粒度可以参考以下方案：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;319:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:78;319:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;粒度过小：若采用了值分区可以考虑改成范围分区，例如按天改成按月；若采用了 HASH 分区，可以考虑改小 HASH 分区数。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:79;320:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;粒度过大：若采用了范围分区可以考虑改成值分区，例如按年改成按月；若采用了 HASH 分区，可以考虑改大 HASH 分区数；若是一级分区，可以考虑用组合分区，此时新增一级通常是 HASH 分区，例按天单分区，粒度过大，考虑二级按股票代码 HASH 分区。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合理设置分区至关重要，如需了解详细的分区机制和如何设计合理的分区，可参见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;database.md&#34; xtrc=&#34;xref:20;322:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;数据库分区&lt;/xref&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:80;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;324:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:77;324:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;是否允许并发写入同一分区：&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;326:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;此外，为了支持用户多线程能够并发写数据且不会因写入分区冲突而失败，DolphinDB 在创建数据库时支持了一个特殊的配置参数 atomic（该参数是 OLAP 和 TSDB 引擎共有参数）：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;328:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:81;328:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;默认为‘TRANS'，即不允许并发写入同一个 CHUNK 分区；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:82;329:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;设置为‘CHUNK'，则允许多线程并发写入同一分区。系统内部仍会串行执行写入任务，当一个线程正在写入某个分区时，其他写入该分区的线程检测到冲突会不断尝试重新写入。尝试 250 次（每次尝试间隔时间会随着尝试次数增加而增加，上限是 1s，整个尝试过程约持续 5 分钟）后仍然无法写入，则会写入失败。atomic='CHUNK' 配置可能会破坏事务的原子性，因为若某线程冲突重试达到上限后仍失败，则该部分数据将会丢失，需要谨慎设置。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;331:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;实际场景下，若设置为 'CHUNK' 发生数据丢失，用户可能难以定位到具体的分区，针对该场景有几个较推荐的方案：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:13;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:83;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;使用 tableInsert 写入，该函数会返回写入数据的记录数，根据记录数可以定位到写入失败的线程任务，若线程涉及的分区没有重叠，可以删除相关分区数据后重新写入。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:84;334:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若使用 TSDB 引擎，且去重策略设置为了 FIRST 或者 LAST，则直接重复提交写入失败的线程任务，系统会进行去重，查询时不会读出重复数据。不适用于去重策略为 ALL 的场景，若为 ALL，则参照方案 1。&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;43-创建数据表&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;4.3. 创建数据表&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;336:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;338:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;创建分布式表/维度表时，与 OLAP 引擎不同，TSDB 需要额外设置 sortColumns 这个必选参数，以及 keepDuplicates, sortKeyMappingFunction, softDelete 这几个可选参数。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;cpp&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;340:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;// 函数 createPartitionedTable(dbHandle, table, tableName, [partitionColumns], [compressMethods], [sortColumns], [keepDuplicates=ALL], [sortKeyMappingFunction], [softDelete=false]) // 标准 SQL create table dbPath.tableName ( schema[columnDescription] ) [partitioned by partitionColumns], [sortColumns], [keepDuplicates=ALL], [sortKeyMappingFunction]&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;354:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;这里以通过函数创建一个 TSDB 下的分布式表为例：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;cpp&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT tbSchema = table(1:0, colName, colType) db.createPartitionedTable(table=tbSchema, tableName=tbName, partitionColumns=`TradeDate`SecurityID, compressMethods={TradeTime:&#34;delta&#34;}, sortColumns=`SecurityID`TradeDate`TradeTime, keepDuplicates=ALL)&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:18;363:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:85;363:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;363:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;对字段应用合适的压缩算法（compressMethods）：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:19;365:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:86;365:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;对重复较高的字符串，使用 SYMBOL 类型存储。需要注意单个分区下 SYMBOL 字段的唯一值数不能超过 2^21(2097152) 个，否则会抛异常，见 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../error_codes/S00003.dita&#34; xtrc=&#34;xref:21;365:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;S00003&lt;/xref&gt; 。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:87;366:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;对时序数据或顺序数据（整型）可以使用 delta 算法存储，压缩性能测试可以参考 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;iot_examples.md&#34; xtrc=&#34;xref:22;366:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;物联网应用范例&lt;/xref&gt; 。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:88;367:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;其余默认 lz4 压缩算法。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:89;369:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;369:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合理设置排序字段（sortColumns）：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:20;371:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:90;371:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;371:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:78;371:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;确保一个分区的 sortKey 的组合数小于 1000。&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;373:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;通常金融场景下会以 SecurityID+ 时间戳的组合、物联网场景下会以 deviceID+ 时间戳的组合来作为 sortColumns。 在 Level File 章节提及，Level File 的每个 sortKey 都对应存储了许多索引信息，因此在数据量固定的情况下，如果 sortKey 的数量过多，元数据也会变多。极端场景下，数据库可能会膨胀 50 倍！&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:79;374:117&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;因此不推荐把主键或唯一约束设置为 sortColumns。&lt;/b&gt;&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:91;376:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;376:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:80;376:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;建议把查询频率高的字段作为 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:9;376:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortColumns&lt;/i&gt; 中的前置列。&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;378:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;索引键值是 sortKey 的组合值，查询时，如果过滤条件中包含 sortKey 字段，即可以快速定位索引，从而快速定位到数据块 block 加速查询。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;380:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;因为索引键在内存中是按照其组合值排序的，如果将频繁查询的字段前置，则若查询语句中包含前置的字段，则定位索引时可以通过二分查找进行加速，否则系统会对内存中的索引进行遍历。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:92;382:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;382:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:81;382:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;如果 sortColumns 只有一列，该列将作为 sortKey，块内数据是无序的。&lt;/b&gt; 因此，对于每个 sortKey 需要遍历内部的每一个 block；如果 sortColumns 有多列，则除最后一列外的作为索引列 sortKey，最后一列必须是时间列，block 内部按时间排序，如果查询条件指定了时间列，可以无需对每个 sortKey 下的 block 进行遍历。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:93;384:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;384:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:82;384:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;类型限制&lt;/b&gt;：sortColumns 只支持 integer, temporal, string 或 symbol 类型；sortKey 不能为为 TIME, TIMESTAMP, NANOTIME, NANOTIMESTAMP 类型。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:94;386:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;386:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;索引降维（sortKeyMappingFunction）：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;388:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;如果单纯的依靠合理配置 sortColumns 仍然不能降低每个分区的 sortKey 数量，则可以通过指定该参数进行降维。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;390:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:83;390:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;例如：&lt;/b&gt; 5000 只股票，按照日期分区，设置股票代码和时间戳为 sortColumns，每个分区 sortKey 组合数约为 5000，不满足每个分区 sortKey 组合数不超过 1000 的原则，则可以通过指定 sortKeyMappingFunction=[hashBucket{, 500}] 进行降维，使每个分区的 sortKey 组合数降为 500。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:21;392:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:95;392:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;降维是对每个 sortKey 的字段进行的，因此有几个 sortKey 字段就需要指定几个降维函数。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:96;393:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;常用的降维函数是 hashBucket，即进行哈希映射。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:97;394:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;降维后可以通过 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBSortKeyEntry.dita&#34; xtrc=&#34;xref:23;394:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBSortKeyEntry&lt;/xref&gt; 查询每个分区的 sortKey 信息。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:98;396:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;396:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据去重（keepDuplicates）：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:22;398:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:99;398:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;对 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:84;398:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;同一个时间点产生多条数据，需要去重的场景，&lt;/b&gt; 可以根据业务需要设置 keepDuplicates=FIRST/LAST，分别对应每个 sortColumns 保留第一条还是最后一条数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:100;399:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若对去重策略没有要求，则可以根据以下需求进行评估，以设置去重策略：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:23;400:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:101;400:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;高频更新：建议指定 keepDuplicates=LAST，因为 LAST 采用追加更新的方式效率更高（见&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#更新流程&#34; xtrc=&#34;xref:24;400:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;更新流程&lt;/xref&gt;）。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:102;401:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询性能：较推荐使用 keepDuplicates=ALL，因为其他去重策略查询时有额外的去重开销。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:103;402:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;atomic=CHUNK：推荐使用 keepDuplicates=FIRST/LAST，若并发写入失败，直接重复写入即可，无需删除数据再写。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-tsdb-引擎查询优化案例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;5. TSDB 引擎查询优化案例&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;404:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:85;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;测试环境&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:24;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:104;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;CPU：48 核&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:105;409:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;内存：128 G&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:106;410:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;磁盘：HDD&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:107;411:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据库设置：单机集群 2 数据节点&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;51-sortkey-数量对查询性能的影响&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;5.1. sortKey 数量对查询性能的影响&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;415:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:86;415:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;推荐每个分区的 sortKey 组合数不要超过 1000。&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;417:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:87;417:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;测试场景&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;419:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;本节以一个极端场景为例，只利用 sortColumns 去重的特性，将其作为主键或唯一约束使用，每个 sortKey 只对应很少的数据。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:88;421:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据表结构&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;423:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;宽表存储，包含 100 个指标值。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:2;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:4;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:5;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:6;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:43;425:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:89;425:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;字段名&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:44;425:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:90;425:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;字段类型&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:45;425:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:91;425:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;说明&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:46;427:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;tradeDate&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:47;427:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;DATE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:48;427:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:49;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;tradeTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:50;428:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TIME&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:51;428:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;429:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:52;429:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ID&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:53;429:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;INT&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:54;429:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每个日期下具有唯一性&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;430:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:55;430:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;factor1~factor100&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:56;430:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:57;430:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt; &lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;432:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:92;432:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区方案&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:113;434:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;写入 5 日数据，每日 50 万条数据（约 400M），总数据量为 1.9 G。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:25;436:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:108;436:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区方案：单分区，按天 VALUE 分区。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:109;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;排序列 sortColumns：ID，tradeDate，TradeTime。其中 ID 和 tradeDate 的组合值将作为 sortKey。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:110;438:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;去重规则 keepDuplicates：LAST，对于重复数据只保存最新的一条。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:114;440:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:93;440:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;测试指标&lt;/b&gt;&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:3;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:7;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:8;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:9;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:58;442:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:94;442:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;属性&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:59;442:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:95;442:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;值&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:60;442:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:96;442:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询脚本&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:61;444:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;落盘实际大小&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:62;444:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;17.05 G&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:63;444:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;444:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;use opsgetTableDiskUsage(dbName, tableName)&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:64;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortKey 总数量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:65;445:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;2,500,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:66;445:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;445:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;chunkIDs = exec chunkID from pnodeRun(getChunksMeta{&#34;/test_tsdb%&#34;}) where dfsPath not like &#34;%tbl%&#34; and dfsPath not like &#34;%domain%&#34;select count(*) from pnodeRun(getTSDBSortKeyEntry{chunkIDs})&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:67;446:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询前 10 条数据耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:68;446:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;59.5 s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:69;446:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;446:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;timer select top 10 * from loadTable(dbName, tableName)&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;447:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:70;447:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;按照 ID 和 tradeDate 点查耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:71;447:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;4.5 s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:72;447:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;447:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;timer select * from loadTable(dbName, tableName) where ID = 1 and tradeDate = 2023.03.09&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:115;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:97;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;实验分析&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:116;451:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;当每个 sortKey 对应很少的数据量的时候，会产生以下几个问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:26;453:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:111;453:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;由于数据总量不变，导致 sortKey 非常多，索引信息占据大量内存。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:112;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据碎片化存储，导致数据读写效率降低。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:113;455:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;由于数据按照 block 进行压缩，而 block 是每个 sortKey 对应数据按照数据量进行划分的，若每个 block 数据量很少，压缩率也会降低。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:117;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:98;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若要对上述场景进行优化&lt;/b&gt;，可通过设置 sortKeyMappingFunction 对 sortKey 字段进行降维处理。该场景下，我们对 ID 字段进行降维，降维函数为 hashBucket{,500}，该函数用于将每个分区的 sortKey 数量降为 500：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;cpp&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;db.createPartitionedTable(table=tbSchema,tableName=tbName,partitionColumns=`tradeDate,sortColumns=`ID`tradeDate`TradeTime,keepDuplicates=LAST, sortKeyMappingFunction=[hashBucket{,500},])&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:4;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:10;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:11;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:12;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:73;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:99;463:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;属性&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:74;463:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:100;463:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;值&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:75;463:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:101;463:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询脚本&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:76;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;落盘实际大小&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:77;465:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;2.88 G&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:78;465:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;465:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;use opsgetTableDiskUsage(dbName, tableName)&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:79;466:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortKey 总数量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:80;466:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;2,500&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:81;466:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;466:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;chunkIDs = exec chunkID from pnodeRun(getChunksMeta{&#34;/test_tsdb%&#34;}) where dfsPath not like &#34;%tbl%&#34; and dfsPath not like &#34;%domain%&#34;select count(*) from pnodeRun(getTSDBSortKeyEntry{chunkIDs})&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:82;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询前 10 条数据耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:83;467:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;104 ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:84;467:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;467:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;timer select top 10 * from loadTable(dbName, tableName)&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:85;468:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;按照 ID 和 tradeDate 点查耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:86;468:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;7.62 ms&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:87;468:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;468:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;timer select * from loadTable(dbName, tableName) where ID = 1 and tradeDate = 2023.03.09&lt;/codeph&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:118;470:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;可以看到降维后，实际落盘大小和查询性能都有显著提升。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;52-level-file-数量对查询性能的影响&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;5.2. Level File 数量对查询性能的影响&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:119;474:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:102;474:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;测试场景&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:120;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不同去重策略下，Level File 合并前后对查询耗时的影响。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:121;478:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:103;478:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据表结构&lt;/b&gt;&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:5;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:13;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:14;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:88;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:104;480:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;字段名&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:89;480:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:105;480:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;字段类型&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:90;482:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;machineId&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:91;482:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;INT&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:92;483:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;datetime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:93;483:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TIMESTAMP&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;484:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:94;484:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;tag1~tag50&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:95;484:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;DOUBLE&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:122;486:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:106;486:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区方案&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:123;488:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;每日写入 100,000,000 条数据（约 3800 M，包含 100000 个设备），通过脚本写入 10 天的数据量。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:27;490:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:114;490:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;分区方案：组合分区，按 datetime（VALUE）+ machineId（HASH 100）分区。每个分区约 400 M 数据。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:115;491:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;排序列 sortColumns：machineId，datetime。machineId 将作为 sortKey。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:116;492:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;去重规则 keepDuplicates：建表时，通过 keepDuplicates 参数配置不同的去重策略，进行测试。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:124;494:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;实际场景下，重复数据一般是由设备或通讯协议的机制产生的。一般数据重复率在 5% 左右。本实验模拟物联网场景下的数据产生，数据量也较贴合现实场景的数据重复率。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;6&#34; xtrc=&#34;tgroup:6;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:15;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:16;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:17;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:18;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:19;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:20;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:96;496:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:107;496:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:97;496:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:108;496:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据量&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:98;496:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:109;496:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并前占用磁盘（GB）&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:99;496:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:110;496:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后占用磁盘（GB）&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:100;496:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:111;496:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并前 Level File 文件数&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:101;496:104&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:112;496:105&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后 Level File 文件数&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:102;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:103;498:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1,000,000,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:104;498:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;357.43&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:105;498:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;347.50&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:106;498:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level 0:9,000Level 1:1,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:107;498:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level 0:4,851Level 1:539Level 2:461&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:108;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;FIRST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:109;499:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;951,623,687&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:110;499:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;341.23&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:111;499:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;325.01&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:112;499:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level 0:9,000Level 1:1,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:113;499:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level 0:2,070Level 1:230Level 2:760&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:37;500:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:114;500:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LAST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:115;500:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;951,624,331&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:116;500:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;341.23&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:117;500:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;324.04&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:118;500:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level 0:9,000Level 1:1,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:119;500:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level 0:1,656Level 1:184Level 2:816&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:125;502:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:113;502:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;测试指标&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:28;504:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:117;504:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:126;504:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;进行点查（命中 sortKey）&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;506:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;select * from loadTable(dbName, tbName_all) where machineId=999&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:7;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:21;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:22;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:23;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:24;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:38;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:120;510:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:114;510:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:121;510:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:115;510:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据量&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:122;510:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:116;510:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并前耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:123;510:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:117;510:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;512:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:39;512:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:124;512:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:125;512:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;9,812&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:126;512:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;32.2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:127;512:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;28.5&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:40;513:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:128;513:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;FIRST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:129;513:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;9,541&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:130;513:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;27.7&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:131;513:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;26.7&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:41;514:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:132;514:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LAST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:133;514:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;9,507&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:134;514:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;29.7&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:135;514:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;26.3&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;516:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;select * from loadTable(dbName, tbName_all) where machineId=999 and datetime=2023.07.10&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:8;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:8;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:25;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:26;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:27;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:28;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:8;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:42;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:136;520:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:118;520:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:137;520:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:119;520:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据量&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:138;520:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:120;520:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并前耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:139;520:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:121;520:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:8;522:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:43;522:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:140;522:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:141;522:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1,054&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:142;522:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8.7&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:143;522:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8.2&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:44;523:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:144;523:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;FIRST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:145;523:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;916&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:146;523:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;7.6&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:147;523:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6.6&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:45;524:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:148;524:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LAST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:149;524:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;968&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:150;524:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8.1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:151;524:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6.8&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;526:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;select * from loadTable(dbName, tbName_all) where machineId=999 and datetime=2023.07.10 and datetime between 2023.07.10 09:00:01.000 and 2023.07.10 09:00:03.000&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:9;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:9;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:29;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:30;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:31;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:32;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:9;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:46;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:152;530:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:122;530:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:153;530:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:123;530:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据量&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:154;530:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:124;530:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并前耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:155;530:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:125;530:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:9;532:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:47;532:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:156;532:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:157;532:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;202&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:158;532:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6.2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:159;532:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6.1&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:48;533:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:160;533:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;FIRST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:161;533:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;201&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:162;533:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;5.8&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:163;533:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;5.8&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:49;534:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:164;534:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LAST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:165;534:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;197&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:166;534:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;5.8&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:167;534:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;5.8&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:118;536:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:127;536:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询单个分区所有记录&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;538:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;select * from loadTable(dbName, tbName_all) where datetime=2023.07.10&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:10;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:10;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:33;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:34;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:35;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:36;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:10;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:50;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:168;542:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:126;542:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:169;542:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:127;542:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据量&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:170;542:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:128;542:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并前耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:171;542:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:129;542:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:10;544:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:51;544:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:172;544:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:173;544:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;100,000,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:174;544:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;59,566.7&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:175;544:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;47,474.3&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:52;545:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:176;545:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;FIRST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:177;545:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;95,161,440&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:178;545:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;54,275.1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:179;545:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;46,069.2&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:53;546:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:180;546:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LAST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:181;546:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;95,161,940&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:182;546:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;57,954.2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:183;546:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;44,443.1&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:119;548:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:128;548:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;查询全表的总记录数（命中元数据）&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;550:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;select count(*) from loadTable(dbName, tbName)&lt;/codeblock&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:11;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:11;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:37;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:38;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:39;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:40;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:11;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:54;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:184;554:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:130;554:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:185;554:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:131;554:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据量&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:186;554:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:132;554:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并前耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:187;554:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:133;554:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后耗时（ms）&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:11;556:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:55;556:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:188;556:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:189;556:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1,000,000,000&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:190;556:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;218.9&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:191;556:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;216.8&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:56;557:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:192;557:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;FIRST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:193;557:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;951,623,687&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:194;557:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6,324.1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:195;557:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1,180.9&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:57;558:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:196;558:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;LAST&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:197;558:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;951,624,331&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:198;558:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6,470.2&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:199;558:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;958.7&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:129;560:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:134;560:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;实验分析&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:130;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:135;562:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;（一）&lt;/b&gt; 对比 Level File 合并前后，每个查询语句性能的区别：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:29;564:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:120;564:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;在不去重的场景下（&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:136;564:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;=ALL），整体提升不显著，但在遍历整个分区数据时，由于文件数据减少，查询性能提升约 20 %。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:121;565:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;在去重的场景下（&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:137;565:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;keepDuplicates&lt;/b&gt;=LAST / FIRST）：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:30;566:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:122;566:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;命中 sortKey 的查询语句：性能几乎不受 Level File 文件合并的影响。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:123;567:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;遍历分区的查询语句：性能在合并后会略所提升，约为 15 % 左右。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:124;568:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;命中元数据的查询语句：性能在合并前后提升较为显著，约提升 6 倍。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:131;570:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;从内部机制分析，合并 Level File 对性能的影响主要在：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:31;572:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:125;572:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;由于文件数减少，磁盘的寻道时间减少。但在查询数量大的场景下，磁盘的寻道时间可以忽略。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:126;573:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后重复数据减少，从而使数据去重的耗时也减少。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:127;574:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合并后文件数减少，从而使查询遍历的开销也减少。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:132;576:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File 的去重操作是在合并阶段完成的。若磁盘上存在较多的重复数据，查询时，会将这些数据全部读取到内存再进行去重。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:138;576:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;冗余的重复数据越多，这一步骤的耗时开销越显著&lt;/b&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:133;578:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:139;578:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;（二）&lt;/b&gt; 对比使用三种不同的去重策略时，每个查询语句性能的区别：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:32;580:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:128;580:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;命中 sortKey 的查询语句：三种去重策略性查询性能相差不大。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:129;581:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;遍历分区的查询语句：ALL 策略的查询性能会略低于 FIRST 和 LAST 策略，主要是因为 ALL 策略无需去重，FIRST 和 LAST 都有一定的去重开销。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:130;582:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;命中元数据的查询语句：ALL 的性能明显优于 FIRST 和 LAST（ALL 性能约为 FIRST/LAST 的 30 倍），这是因为 ALL 只需要读元数据即可，FIRST，ALL 需要对数据去重后进行统计，开销较大。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:134;584:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;不同的查询策略对性能的影响主要在：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:33;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:131;586:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL 策略文件数较 FIRST 和 LAST 策略多，理论上磁盘寻道时间应该更长，但在查询数量大的场景下，磁盘的寻道时间可以忽略。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:132;587:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ALL 策略在查询时无需去重，而 FIRST 和 LAST 策略在查询时，需要读出所有满足查询条件的数据，然后在内存中进行去重操作，这一步较为耗时。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:135;589:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:140;589:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;实验结论&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:136;591:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;在 Level File 文件数较多的场景下，若数据存在重复并设置了去重策略，则 Level File 文件合并后，遍历分区和命中元数据的查询语句性能会显著提升，点查性能提升不明显；若数据重复率低，或者未设置去重机制，则文件合并前后，查询性能提升较小。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:137;593:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;参考 Level File 合并章节，DolphinDB TSDB 引擎内置了 Level File 的自动合并机制，依靠自动合并，大部分场景下 Level File 数量不会成为查询性能的瓶颈。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:138;595:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若自动合并后，Level File 数量仍比较多，且满足下述场景：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:34;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:133;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据重复率较高&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:134;598:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据已经入库，不再变化（后续不再修改和写入）&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:139;600:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;用户也可以在线调用函数 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/t/triggerTSDBCompaction.dita&#34; xtrc=&#34;xref:25;600:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;triggerTSDBCompaction&lt;/xref&gt; 手动触发合并，以减少文件数，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:141;600:91&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;提升查询性能&lt;/b&gt;。合并状态可以通过调用函数 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBCompactionTaskStatus.dita&#34; xtrc=&#34;xref:26;600:115&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBCompactionTaskStatus&lt;/xref&gt; 进行查询。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-tsdb-引擎场景实践案例&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;602:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;602:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6. TSDB 引擎场景实践案例&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;602:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:140;604:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;本章汇总了 DolphinDB 教程中 TSDB 引擎相关的实践案例，供大家快速索引。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;61-金融场景&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:28;606:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:28;606:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6.1. 金融场景&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:28;606:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:12;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;5&#34; xtrc=&#34;tgroup:12;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:41;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:42;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:43;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:44;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:45;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:12;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:58;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:200;608:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:142;608:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;场景&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:201;608:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:143;608:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;教程链接&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:202;608:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:144;608:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;场景描述&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:203;608:105&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:145;608:106&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;存储方案&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:12;610:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:59;610:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:204;610:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;中高频多因子库存储&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:205;610:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;best_practices_for_multi_factor.md&#34; xtrc=&#34;xref:27;610:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;中高频多因子库存储最佳实践&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:206;610:73&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;测试 TSDB 宽表存储和 TSDB 窄表存储，在 HDD 和 SDD 这两种不同的硬件配置下的存储性能。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:207;610:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;推荐采用 TSDB 窄表存储&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:60;611:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:208;611:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level 2 行情数据存储&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:209;611:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;LoadDataForPoc.md&#34; xtrc=&#34;xref:28;611:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;金融 PoC 用户历史数据导入指导手册之股票 level2 逐笔篇&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;l2_stk_data_proc.md&#34; xtrc=&#34;xref:29;611:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;处理 Level 2 行情数据实例&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;appendices_market_replay_bp.md&#34; xtrc=&#34;xref:30;611:126&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;搭建行情回放服务的最佳实践&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:210;611:174&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;介绍行情快照、逐笔委托、逐笔成交的存储方案，以及数据导入的处理流程。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:morecols=&#34;1&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; nameend=&#34;col5&#34; namest=&#34;col4&#34; xtrc=&#34;entry:211;611:217&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;引擎：TSDB分区方案：交易日按值分区 + 标的哈希 20 分区sortColumns：market，SecurityID，TradeTime&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:61;612:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:212;612:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;公募基金数据存储&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:213;612:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;public_fund_basic_analysis.md&#34; xtrc=&#34;xref:31;612:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;公募基金历史数据基础分析教程&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:214;612:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;提供公开市场数据导入 TSDB 引擎的示例脚本。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:215;612:112&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据量较小，故存储为 TSDB 引擎维度表，sortColumns 为日期列。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:62;613:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:216;613:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;实时波动率预测&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:217;613:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;ml_volatility.md&#34; xtrc=&#34;xref:32;613:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;金融实时实际波动率预测&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:218;613:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;比较数据预处理阶段，OLAP 引擎和 TSDB 引擎的存储效率。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:219;613:96&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;使用 TSDB 引擎，将多档数据以 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../progr/data_types_forms/arrayVector.dita&#34; xtrc=&#34;xref:33;613:115&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;Array Vector&lt;/xref&gt; 的形式存储，原 40 列数据合并为 4 列，在数据压缩率、数据查询和计算性能上都会有大幅提升。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:63;614:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:220;614:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;ETL 数据清洗优化&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:221;614:19&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;data_ETL.md&#34; xtrc=&#34;xref:34;614:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;利用 DolphinDB 高效清洗数据&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:222;614:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;优化 ETL 数据清洗流程的性能。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:morecols=&#34;1&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; nameend=&#34;col5&#34; namest=&#34;col4&#34; xtrc=&#34;entry:223;614:98&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;利用 TSDB 的索引机制，可以通过扫描稀疏索引文件，来查询对应的数据块 ID。进而只读取对应数据块，从而避免全表扫描。&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;62-物联网场景&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:29;616:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:29;616:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;6.2. 物联网场景&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:29;616:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:13;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:13;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:46;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:47;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:48;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:49;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:13;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:64;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:224;618:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:146;618:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;案例&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:225;618:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:147;618:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;教程链接&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:226;618:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:148;618:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;场景描述&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:227;618:96&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:149;618:97&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;存储方案&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:13;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:65;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:228;620:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;地震波形数据存储&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:229;620:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;waveform_data_storage.md&#34; xtrc=&#34;xref:35;620:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;地震波形数据存储解决方案&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:230;620:64&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;介绍地震波形数据的存储方案，包含分区方案和字段压缩方案。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:231;620:96&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;引擎：TSDB 分区方案：设备 ID 值分区 + 按天值分区 sortColumns：设备 ID + 时间戳&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:66;621:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:232;621:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;实时数据异常预警：流数据入库存储&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:233;621:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;knn_iot.md&#34; xtrc=&#34;xref:36;621:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;物联网实时数据异常率预警&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:234;621:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;数据预警场景，订阅数据持久化部分采用 TSDB 引擎存储。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:235;621:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:150;621:83&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;消费数据入库：&lt;/b&gt;引擎：TSDB分区方案：设备代码值分区 + 按小时值分区sortColumns：设备代码 + 时间戳 &lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:151;621:165&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;聚合计算结果入库：&lt;/b&gt;引擎：TSDB分区方案：设备代码值分区 + 按天值分区sortColumns：设备代码 + 时间戳&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;7-总结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:30;623:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:30;623:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;7. 总结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:30;623:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:141;625:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎较 OLAP 引擎而言，内部实现机制更加复杂，对用户开放的配置也更多样。在使用时，需要根据用户的数据特性和查询场景，设置合理的去重机制和 sortColumns，才能够发挥 TSDB 的最佳性能。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:142;627:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:152;627:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎使用注意点汇总：&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:35;629:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:135;629:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;由于导入数据时的内存占用可能达到 TSDBCacheEngineSize 的两倍，因此用户需要根据导数据量以及内存情况，合理设置 TSDBCacheEngine 的大小。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:136;630:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;合理设置 sortColumns 字段(建议不超过 4 列)，一个通用原则是：确保每个分区的 sortKey 组合数不超过 2000，以及每个 sortColumns 对应的数据量不能过少。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:137;631:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;若查询性能较差，在引擎层面，可以从两个方面进行排查：&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:36;632:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:138;632:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;sortKey 组合数是否过多（可以在创建分布式表时指定 sortKeyMappingFunction 进行降维）。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:139;633:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File 文件数是否过多（可以手动调用 triggerTSDBCompaction 触发合并，减少 Level File 文件数）。&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;8-附录&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:31;635:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:31;635:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8. 附录&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:31;635:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;81-tsdb-引擎配置项汇总&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:32;637:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:32;637:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8.1. TSDB 引擎配置项汇总&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:32;637:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:14;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:14;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:50;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:51;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:52;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:14;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:67;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:236;639:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:153;639:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;功能&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:237;639:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:154;639:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;配置项&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:238;639:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:155;639:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;描述&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:14;641:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:68;641:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:239;641:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Redo&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:240;641:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBRedoLogDir&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:241;641:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 存储引擎重做日志的目录&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:69;642:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:242;642:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Cache Engine&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:243;642:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBCacheEngineSize TSDBCacheTableBufferThreshold TSDBCacheFlushWorkNum TSDBAsyncSortingWorkerNum&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:244;642:171&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;设置 TSDB 存储引擎 cache engine 的容量（单位为 GB） TSDB 引擎缓存数据进行批量排序的阈值 TSDB cache engine 刷盘的工作线程数 TSDB cache engine 异步排序的工作线程数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:70;643:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:245;643:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Index&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:246;643:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBLevelFileIndexCacheSize TSDBLevelFileIndexCacheInvalidPercent&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:247;643:116&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 存储引擎 level file 元数据内存占用空间上限 TSDB 引擎 level file 索引缓存淘汰后保留数据的百分比。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:71;644:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:248;644:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;SYMBOL 字段的缓存&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:249;644:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDBSymbolBaseEvictTime TSDBCachedSymbolBaseCapacity&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:250;644:111&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 存储引擎 symbolBase 内存占用空间上限及缓存管理策略。&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;82-tsdb-引擎运维函数汇总&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:33;647:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:33;647:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8.2. TSDB 引擎运维函数汇总&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:33;647:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:15;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:15;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:53;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:54;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:55;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:15;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:72;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:251;649:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:156;649:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;功能&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:252;649:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:157;649:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;函数&lt;/b&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:253;649:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:158;649:71&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;描述&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:15;651:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:73;651:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:254;651:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Level File 合并&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:255;651:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/t/triggerTSDBCompaction.dita&#34; xtrc=&#34;xref:37;651:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;triggerTSDBCompaction&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBCompactionTaskStatus.dita&#34; xtrc=&#34;xref:38;651:97&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBCompactionTaskStatus&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:256;651:173&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;触发合并 获取合并任务状态&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:74;652:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:257;652:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;异步排序&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:258;652:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/e/enableTSDBAsyncSorting.dita&#34; xtrc=&#34;xref:39;652:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;enableTSDBAsyncSorting&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/d/disableTSDBAsyncSorting.dita&#34; xtrc=&#34;xref:40;652:97&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;disableTSDBAsyncSorting&lt;/xref&gt; &lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:259;652:172&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;开启异步排 关闭异步排序序&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:75;653:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:260;653:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;Cache Engine&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:261;653:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/f/flushTSDBCache.dita&#34; xtrc=&#34;xref:41;653:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;flushTSDBCache&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/s/setTSDBCacheEngineSize.dita&#34; xtrc=&#34;xref:42;653:86&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;setTSDBCacheEngineSize&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBCacheEngineSize.dita&#34; xtrc=&#34;xref:43;653:156&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBCacheEngineSize&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:262;653:222&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;将 TSDB Cache Engine 中的数据强制刷盘 设置 TSDB Cache Engine 的内存大小 获取 TSDB Cache Engine 的内存大小&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:76;654:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:263;654:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;索引&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:264;654:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getLevelFileIndexCacheStats.dita&#34; xtrc=&#34;xref:44;654:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getLevelFileIndexCacheStatus&lt;/xref&gt; invalidateLevelIndexCache&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:265;654:137&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;获取所有 level file 的索引内存占用的情况 手动删除索引缓存&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:77;655:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:266;655:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;SYMBOL 字段的缓存&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:267;655:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBCachedSymbolBaseMemSize.dita&#34; xtrc=&#34;xref:45;655:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBCachedSymbolBaseMemSize&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/c/clearalltsdbsymbolbasecache.dita&#34; xtrc=&#34;xref:46;655:112&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;clearAllTSDBSymbolBaseCache&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:268;655:187&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;获取 TSDB 引擎中 SYMBOL 类型的字典编码的缓存大小。 清除SYMBOL 类型的字典编码的缓存&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:78;656:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:269;656:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;元数据信息&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:270;656:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBMetaData.dita&#34; xtrc=&#34;xref:47;656:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBMetaData&lt;/xref&gt; &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getTSDBSortKeyEntry.dita&#34; xtrc=&#34;xref:48;656:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getTSDBSortKeyEntry&lt;/xref&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:271;656:142&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;获取 TSDB 引擎 chunk 的元数据信息 获取 TSDB 引擎已经写入磁盘的 chunk 的 sort key 信息&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:143;658:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;触发集群中所有分区 Level File 合并脚本参考：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;cpp&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;660:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;// dbName 需要替换成自己的数据库名 chunkIDs = exec * from pnodeRun(getChunksMeta{&#34;/dbName/%&#34;}) where type=1 for(chunkID in chunkIDs){ pnodeRun(triggerTSDBCompaction{chunkID}) } // 检查是否完成 Level File 合并 select * from pnodeRun(getTSDBCompactionTaskStatus) where endTime is null&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;83-常见问题-q--a&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:34;670:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:34;670:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8.3. 常见问题 Q &amp;amp; A&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:34;670:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;table class=&#34;- topic/table &#34; style=&#34;undefined;table-layout: fixed; width: 1360px&#34; xtrc=&#34;table:16;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:16;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; colwidth=&#34; 590px&#34; xtrc=&#34;colspec:56;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; colwidth=&#34; 770px&#34; xtrc=&#34;colspec:57;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:16;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:79;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:272;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;问题&lt;?linebreak?&gt;&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:273;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;回答&lt;?linebreak?&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:16;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:80;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:274;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;创建报错 TSDB engine is not enabled.&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:275;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1. 检查 server 版本是否为 2.00 版本，1.30 版本不支持 TSDB 引擎。&lt;?linebreak?&gt;&lt;?linebreak?&gt;2. 检查配置文件是否设置了 TSDBCacheEngineSize 配置项。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:81;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:276;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 更新数据后，查询发现更新的数据出现在表末尾，而不是按时间序排序。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:277;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎只保证 level file 内部是有序的，但是 level file 间可能是无序的，可以尝试通过调用 triggerTSDBCompaction 函数手动触发 level file 文件的合并。&lt;?linebreak?&gt; &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:82;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:278;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;1.30 版本的 server 和 2.00 版本有什么区别？&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:279;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;相较于 1.30 版本，2.00 版本还支持了 TSDB 引擎，array vector 数据形式，DECIMAL 数据类型等功能。&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:83;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:280;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;如果希望表的数据写入后去重，可以使用 TSDB 引擎，然后将 sortColumns 设置为去重键吗？&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:281;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;- 如果去重键只有一个字段，不建议设置为 sortColumns，因为此时该字段会被作为 sortKey，去重后，一个 sortKey 只对应一条记录，会造成索引膨胀，影响查询效率。&lt;?linebreak?&gt;&lt;?linebreak?&gt;- 如果去重键有多个字段，需要评估每个 sortKey 对应的数据量，若数据量很少，不建议将其设置为 sortColumns。&lt;?linebreak?&gt;&lt;?linebreak?&gt;推荐使用 upsert! 方法写入数据，以达到数据去重的目的。 &lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:84;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:282;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;TSDB 引擎查询性能低于预期。&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:283;672:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;- sortKey 字段设置是否合理，可以调用 getTSDBSortKeyEntry 函数查询 sortKey 的信息。&lt;?linebreak?&gt;&lt;?linebreak?&gt;- LevelFile 的索引缓存是否设置过小。若每次查询设计的数据范围较大，可能造成索引的频繁置换，此时可以通过调整配置项 TSDBLevelFileIndexCacheSize，来调大索引的缓存空间，调整后需重启集群。&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;84-案例脚本&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:35;674:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:35;674:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;8.4. 案例脚本&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:35;674:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:37;676:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:140;676:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/tsdb_explained/test_5_1.dos&#34; xtrc=&#34;xref:49;676:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;test_5_._1.dos&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:141;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;dos&#34; href=&#34;script/tsdb_explained/test_5_2.dos&#34; xtrc=&#34;xref:50;677:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/tsdb_explained.md&#34;&gt;&lt;?ditaot usertext?&gt;test_5_._2.dos&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/tsdb_explained.md"/><meta name="wh-out-relpath" content="tutorials/tsdb_explained.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20250305183303"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20250305183303"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="tsdb-存储引擎详解" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://docs.dolphindb.cn/zh/index.html" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>
<script defer="defer"><!--

// 从主页重定向
const currentUrl = window.location.href;

// 判断当前URL是否包含index.html并且路径最后部分是index.html
if (currentUrl.endsWith('index.html')) {
    // 处理根目录下的index.html跳转
    const baseUrl = currentUrl.split('/index.html')[0]; // 获取index.html之前的部分
    const redirectUrl = `${baseUrl}/about/ddb_intro.html`; // 构建跳转路径
    window.location.href = redirectUrl; // 执行跳转
}

--></script>
            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/database.html">数据库</a></div></div></li><li class="active"><div class="topicref" data-id="tsdb-存储引擎详解"><div class="title"><a href="../tutorials/tsdb_explained.html">TSDB 存储引擎详解</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="ddb_intro-d9713e87" class="topicref" data-id="ddb_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_intro.html" id="ddb_intro-d9713e87-link">关于DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="chap1_getstarted-d9713e136" class="topicref" data-id="chap1_getstarted" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9713e136-link">快速上手</a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9713e189" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9713e189-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9713e189-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9713e2259-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9713e3760" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9713e3760-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9713e3760-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e7513" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e7513-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9713e7513-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9713e7940" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9713e7940-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9713e7940-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="troubleshooting-d9713e8780" class="topicref" data-id="troubleshooting" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action troubleshooting-d9713e8780-link" class="wh-expand-btn"></span><div class="title"><a href="../error_codes/troubleshooting.html" id="troubleshooting-d9713e8780-link">故障排查</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9713e20911" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9713e20911-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9713e20911-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9713e30925" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9713e30925-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9713e30925-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9713e94064" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9713e94064-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9713e94064-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9713e94210" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9713e94210-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9713e94210-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9713e97904" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9713e97904-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9713e97904-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9713e98227" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9713e98227-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9713e98227-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e98280" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e98280-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/new_users_finance.html" id="tocId-d9713e98280-link">新用户入门</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9713e98327" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9713e98327-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="tocId-d9713e98327-link">数据库</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="分区数据库设计和操作-d9713e98328" class="topicref" data-id="分区数据库设计和操作" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="分区数据库设计和操作-d9713e98328-link">分区数据库设计和操作</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-内存表详解-d9713e98374" class="topicref" data-id="dolphindb-内存表详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/in_memory_table.html" id="dolphindb-内存表详解-d9713e98374-link">DolphinDB 内存表详解</a></div></div></li><li role="treeitem"><div data-tocid="内存数据表-d9713e98420" class="topicref" data-id="内存数据表" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/partitioned_in_memory_table.html" id="内存数据表-d9713e98420-link">内存数据表</a></div></div></li><li role="treeitem"><div data-tocid="oltp-内存存储引擎非嵌入式版使用教程-d9713e98466" class="topicref" data-id="oltp-内存存储引擎非嵌入式版使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/oltp_in-memory_storage_engine_non-embedded_version_tutorials.html" id="oltp-内存存储引擎非嵌入式版使用教程-d9713e98466-link">OLTP 内存存储引擎（非嵌入式版）使用教程</a></div></div></li><li role="treeitem"><div data-tocid="利用缓存表快速实现-mysql-库间信息同步-d9713e98512" class="topicref" data-id="利用缓存表快速实现-mysql-库间信息同步" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cachedtable.html" id="利用缓存表快速实现-mysql-库间信息同步-d9713e98512-link">利用缓存表快速实现 MySQL 库间信息同步</a></div></div></li><li role="treeitem"><div data-tocid="建库建表最容易忽略的十个细节-d9713e98558" class="topicref" data-id="建库建表最容易忽略的十个细节" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database_and_table_creation_details.html" id="建库建表最容易忽略的十个细节-d9713e98558-link">建库建表最容易忽略的十个细节</a></div></div></li><li role="treeitem"><div data-tocid="redo-log-和-cache-engine-d9713e98604" class="topicref" data-id="redo-log-和-cache-engine" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/redoLog_cacheEngine.html" id="redo-log-和-cache-engine-d9713e98604-link">redo log 和 cache engine</a></div></div></li><li role="treeitem"><div data-tocid="tsdb-存储引擎简介-d9713e98650" class="topicref" data-id="tsdb-存储引擎简介" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_engine.html" id="tsdb-存储引擎简介-d9713e98650-link">TSDB 存储引擎简介</a></div></div></li><li role="treeitem" class="active"><div data-tocid="tsdb-存储引擎详解-d9713e98696" class="topicref" data-id="tsdb-存储引擎详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_explained.html" id="tsdb-存储引擎详解-d9713e98696-link">TSDB 存储引擎详解</a></div></div></li><li role="treeitem"><div data-tocid="分布式表数据更新原理和性能-d9713e98742" class="topicref" data-id="分布式表数据更新原理和性能" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_update.html" id="分布式表数据更新原理和性能-d9713e98742-link">分布式表数据更新原理和性能</a></div></div></li><li role="treeitem"><div data-tocid="软删除-d9713e98788" class="topicref" data-id="软删除" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/soft_delete.html" id="软删除-d9713e98788-link">软删除</a></div></div></li><li role="treeitem"><div data-tocid="基于-datax-的-dolphindb-数据导入工具-d9713e98835" class="topicref" data-id="基于-datax-的-dolphindb-数据导入工具" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/datax_writer.html" id="基于-datax-的-dolphindb-数据导入工具-d9713e98835-link">基于 DataX 的 DolphinDB 数据导入工具</a></div></div></li><li role="treeitem"><div data-tocid="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9713e98881" class="topicref" data-id="debezium--kafka-实时同步-mysql-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_and_Kafka_data_sync.html" id="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9713e98881-link">Debezium + Kafka 实时同步 MySQL 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9713e98927" class="topicref" data-id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_Kafka_Oracle_sync.html" id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9713e98927-link">Debezium+Kafka 实时同步 Oracle 11g 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="clear_cache-d9713e98973" class="topicref" data-id="clear_cache" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/clear_cache.html" id="clear_cache-d9713e98973-link">数据库缓存清理机制 </a></div></div></li><li role="treeitem"><div data-tocid="best_practice_for_storage_compute_separation-d9713e99019" class="topicref" data-id="best_practice_for_storage_compute_separation" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_storage_compute_separation.html" id="best_practice_for_storage_compute_separation-d9713e99019-link">存算分离最佳实践教程</a></div></div></li><li role="treeitem"><div data-tocid="database_and_table_creation_wizard-d9713e99065" class="topicref" data-id="database_and_table_creation_wizard" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database_and_table_creation_wizard.html" id="database_and_table_creation_wizard-d9713e99065-link">DolphinDB Web 界面库表创建指南</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e99111" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e99111-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="tocId-d9713e99111-link">编程</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100448" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100448-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="tocId-d9713e100448-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e100955" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e100955-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/scheduledJob_2.html" id="tocId-d9713e100955-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="模块概述-d9713e101923" class="topicref" data-id="模块概述" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action 模块概述-d9713e101923-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="模块概述-d9713e101923-link">模块</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e102568" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e102568-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="tocId-d9713e102568-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e104827" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e104827-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_engine_anomaly_alerts_2.html" id="tocId-d9713e104827-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105795" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105795-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_tensor_libtorch_tutorial.html" id="tocId-d9713e105795-link">机器学习</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105842" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105842-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/api_performance.html" id="tocId-d9713e105842-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9713e105982" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9713e105982-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_2.html" id="tocId-d9713e105982-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">TSDB 存储引擎详解</h1><div class="- topic/body body"></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-阅读指南"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 阅读指南</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">如果需要进行引擎间的迁移或希望了解 OLAP 引擎和 TSDB 引擎的区别，推荐阅读第 1 章。</li><li class="- topic/li li">如果需要了解底层的架构和工作原理推荐阅读第 2 章。</li><li class="- topic/li li">如果希望直接上手搭建 TSDB 数据库，推荐从第 3 章开始阅读。</li><li class="- topic/li li">第 4 章给出了 TSDB 查询优化案例。</li><li class="- topic/li li">更多 TSDB 的实践案例，请参考第 5 章的场景指南。</li><li class="- topic/li li">第 8 章附录列出了 TSDB 相关的配置项、运维函数以及常见问题一览表。</li></ul><p class="- topic/p p">时序数据是一种按照时间顺序排列的数据集合，例如传感器数据、金融市场数据、网络日志等。由于时序数据具有时间上的连续性和大量的时间戳，传统的关系型数据库或通用数据库在处理大规模时序数据时可能效率较低。因此，针对时序数据进行优化的专用数据库——TSDB 变得越来越重要。</p><p class="- topic/p p">为了更好地支持时序数据的分析和存储，DolphinDB 于 2.0 版本推出了”时序数据存储引擎“（Time Series Database Engine，以下简称 TSDB）。</p><p class="- topic/p p">2.0 版本以前 DolphinDB 仅支持分析型数据库存储引擎（Online Analytical Processing，以下简称 OLAP）。OLAP 引擎采用列式存储，压缩率高、查询和计算列的性能也十分优越。随着 DolphinDB 2.0 版本 TSDB 引擎的推出，用户在多模引擎的选择和使用上可能会遇到困难。本文的目标是通过原理解析、使用指导、案例分析的介绍，帮助用户更好地理解 TSDB 引擎，并能够在实际场景中配置更优的存储策略。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-tsdb-vs-olap"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. TSDB vs OLAP</h2><div class="- topic/body body"><p class="- topic/p p">关于 TSDB 和 OLAP 适用场景的描述性说明，请参照教程：<a class="- topic/xref xref" href="tsdb_engine.html">TSDB 存储引擎简介</a></p><p class="- topic/p p">为了便于用户由浅入深地进行学习，本文开头提供了一个 TSDB 和 OLAP 引擎的区别表，以帮助用户对两者的区别有一个概括性的认识。除了列出区别点外，表格中标注了一些使用上的注意点；表格中的术语请参照表尾的术语对照表。</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="2-tsdb-vs-olap__entry__1"><strong class="+ topic/ph hi-d/b ph b">指标</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="2-tsdb-vs-olap__entry__2"><strong class="+ topic/ph hi-d/b ph b">TSDB</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="2-tsdb-vs-olap__entry__3"><strong class="+ topic/ph hi-d/b ph b">OLAP</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">存储结构</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">行列混存（Partition Attributes Across，简称 PAX）写入时，每 32 M 数据存储为一个 Level File 文件（压缩后可能小于 10 M），文件内部进一步划分数据为多个 block 并记录索引信息。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">列式存储每个分区下每列都存储为一个文件。<strong class="+ topic/ph hi-d/b ph b">注：若列文件过多时，在 IO 时会造成性能瓶颈，因此 OLAP 不适合存储列数过多的宽表。建议 OLAP 字段不超过 100。</strong></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">数据形式和类型（区别点）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">Array Vector、BLOB 类型</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">不支持左述两类数据</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">数据压缩</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">以 block 为压缩单元</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">以列文件为压缩单元。<strong class="+ topic/ph hi-d/b ph b">注：一般情况下，OLAP 压缩率会高于 TSDB。</strong></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">数据加载（最小单元）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">每个分区的 Level File 文件中的 block</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">每个分区的子表的列文件</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">写入方式</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">顺序写入<strong class="+ topic/ph hi-d/b ph b">注：TSDB 引擎每次刷盘都会直接存储为新的 Level File 文件，无需像 OLAP 引擎一样追加数据到对应列文件，磁盘几乎没有寻道压力。</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">顺序写入<strong class="+ topic/ph hi-d/b ph b">注：OLAP 引擎列文件过多时，写入时会增加磁盘（HDD）的寻道时间。</strong></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">查找方式</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">1. 分区剪枝 查 Cache Engine 缓存（分为两个部分）：    a. unsorted buffer：遍历     b. sorted buffer：二分查找 3. 查找磁盘：根据索引快速定位到 block  <strong class="+ topic/ph hi-d/b ph b">注：TSDB 没有用户态的缓存机制，只有操作系统的缓存。</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">1. 分区剪枝查2. Cache Engine 缓存3. 查找磁盘：读取相关列文件后遍历查找  <strong class="+ topic/ph hi-d/b ph b">注：OLAP 会维护用户态缓存。第一次查询后，会将上次查询的列文件缓存在内存中。</strong> 该部分缓存会保存在内存中，直到缓存占用达到 warningMemSize，系统才会回收部分内存。用户也可以调用 clearAllCache 手动清理缓存。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">是否支持索引</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">支持，以 sortKey 字段的组合值作为索引。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">不支持</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">优化查询方法</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">命中分区剪枝；通过索引加速查询。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">命中分区剪枝；读取整列数据较为高效，因此查询整个分区或整列数据时具有查询优势。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">是否支持去重</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">支持，基于 sortColumns 去重</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">不支持</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">读写数据是否有序</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">每批刷盘的数据会按照 sortColumns 排序。<strong class="+ topic/ph hi-d/b ph b">注：查询时，只保证单个 Level File 内的数据是有序的，Level File 之间的数据顺序不能保证。</strong></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">按写入顺序写入磁盘。<strong class="+ topic/ph hi-d/b ph b">注：单个分区内，查询结果的顺序和写入顺序一致；跨分区查询时，单分区数据和写入顺序一致，系统会按固定的分区顺序合并各分区的查询结果返回给用户端，因此重复查询仍维持结果的一致性。</strong></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">增删改</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2"><strong class="+ topic/ph hi-d/b ph b">增：</strong> 每次写入的数据可能存储在不同的 Level File。Level File 是不可修改和追加的。<strong class="+ topic/ph hi-d/b ph b">删：</strong> keepDuplicates=LAST 时，若 softDelete=true，则会先打上删除标记，追加写入到一个新的 Level File，然后在文件合并时将旧数据删除；若 softDelete=false，则读数据到内存，更新后再写回。keepDuplicates=FIRST/ALL 时：读数据到内存，更新后再写回 <strong class="+ topic/ph hi-d/b ph b">改：</strong> 取决于去重机制 keepDuplicates=LAST：直接追加写入到一个新的 Level File，文件合并时会将旧数据删除 keepDuplicates=FIRST/ALL：读数据到内存，更新后再写回</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3"><strong class="+ topic/ph hi-d/b ph b">增：</strong> 直接追加到列尾<strong class="+ topic/ph hi-d/b ph b">删：</strong> 读取相关分区下的所有列文件到内存，删除后再写回<strong class="+ topic/ph hi-d/b ph b">改：</strong> 读列文件到内存，更新完再写回</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">DDL &amp; DML 操作（仅列出两者存在区别的点）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">不支持 rename!（修改字段名），replaceColumn!（修改字段的值或类型），dropColumns! （删除列字段）等操作</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">支持左述操作</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__1">资源开销（仅列出两者存在区别的点）</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__2">内存：排序开销，索引缓存；磁盘：合并 Level File 的 IO 开销。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="2-tsdb-vs-olap__entry__3">不存在左述开销</td></tr></tbody></table></div></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-术语对照"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1. 术语对照</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">block：参见 <a class="- topic/xref xref" href="#%E7%A1%AE%E5%AE%9A%E7%B4%A2%E5%BC%95%E9%94%AE%E5%80%BC">确定索引键值</a>部分的说明。</li><li class="- topic/li li">Level File：参见 <a class="- topic/xref xref" href="#level-file-%E6%96%87%E4%BB%B6">Level File</a> 部分的说明。</li><li class="- topic/li li">unsorted buffer / sorted buffer：参见<a class="- topic/xref xref" href="#%E5%86%99%E5%85%A5%E6%B5%81%E7%A8%8B">写入流程</a>部分的说明。</li><li class="- topic/li li">sortColumns：<a class="- topic/xref xref" href="#%E6%8E%92%E5%BA%8F%E5%88%97-sortcolumns">sortColumns</a> 的介绍。</li><li class="- topic/li li">sortKey：参见 <a class="- topic/xref xref" href="#%E7%A1%AE%E5%AE%9A%E7%B4%A2%E5%BC%95%E9%94%AE%E5%80%BC">确定索引键值</a> 部分的说明。</li></ul></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title5" id="3-tsdb-存储引擎架构"><h2 class="- topic/title title topictitle2" id="ariaid-title5">3. TSDB 存储引擎架构</h2><div class="- topic/body body"><p class="- topic/p p">本章将存储架构、读写流程，参数功能，以及底层文件组织层面详细解析 TSDB 引擎的工作原理，以帮助用户从架构层面理解 TSDB 引擎的机制，从而更好的调试和配置 TSDB 的功能参数，实现更优的解决方案。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="31-lsm-tree"><h3 class="- topic/title title topictitle3" id="ariaid-title6">3.1. LSM-Tree</h3><div class="- topic/body body"><p class="- topic/p p">TSDB 引擎是 DolphinDB 基于 Log Structured Merge Tree (以下简称 LSM-Tree) 自研的存储引擎。</p><p class="- topic/p p">LSM-Tree 是一种分层、有序、面向磁盘的数据结构，主要用于处理写入密集型的工作负载，如日志系统、实时分析系统和数据库等。其实现的核心思想是利用磁盘批量顺序写入大幅提高写入性能。其工作流程图如下所示：</p><img class="- topic/image image" src="images/tsdb_explained/LSM_Tree.png"/><br/><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">LSM-Tree 的数据写入流程：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li">数据先写入 WAL Log（Write-Ahead Logging）用于故障恢复。</li><li class="- topic/li li">完成 WAL Log 写入后，数据会先存储在内存中的一个有序数据结构中（通常称为“内存表”），可以是一个红黑树结构或者 Skip List。当内存表缓存到一定大小后，会将其冻结（immutable）等待刷盘，然后生成一个新的内存表供之后的写事务写入。</li><li class="- topic/li li">将冻结的内存表写入磁盘的 SSTable（Sorted Strings Table）文件中，SSTable 是一种有序且不可变的数据文件，其内部的数据按照键值进行排序。（HINT：SSTable 即对应 DolphinDB 的 Level File 文件）。</li><li class="- topic/li li">LSM-Tree 通常维护多个层级的 SSTable 文件，越旧的数据会存储在磁盘上越高的层级，且 SSTable 文件大小也会逐级递增。刚写入的 SSTable 文件存储在磁盘的 Level 0 层级，当单层的文件数过多或文件大小过大，系统会将多个 SSTable 文件合并成一个更大的文件，并在合并时进行去重操作，以保证数据的有序性。通过合并操作，可以提高查询性能，减少存储占用。但注意，合并操作会造成一定程度的写放大。</li></ol></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">LSM-Tree 的数据查询流程：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li">首先在内存表进行检索，由于内存表是有序的数据结构，因此可以利用算法快速检索并返回结果。</li><li class="- topic/li li">如果在内存表中找不到数据，则会按层级遍历磁盘上的 SSTable 进行检索，由于 SSTable 文件数据是按键值排序的，因此可以在单个 SSTable 内快速进行范围查询。为了提高 SSTable 遍历的效率，可以给 SSTable 增加 Bloom Filter，以减少不必要的磁盘扫描。</li><li class="- topic/li li">查询时，SSTable 可能会包含多个不同历史版本的数据，此时需要根据查询条件，找到符合版本的数据（例如最新一条数据）。</li></ol><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注：</strong> 最坏的情况下，需要将所有层级的 SSTable 文件都遍历一遍，如果 SSTable 文件过多，查询是非常低效的，因此可以理解为什么 LSM-Tree 要引入合并机制，减小 SSTable 的文件数。</p></li></ul><p class="- topic/p p">相较于传统的 B+ 树而言，LSM-Tree 的优势在于高吞吐写入与较低的随机写延迟，这非常契合 DolphinDB 海量数据高性能写入的设计诉求。虽然没有 B+ 树那样高效的随机读和范围查询性能，LSM-Tree 依靠键值排序使得单个 SSTable 文件的范围查询也十分高效。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">参考资料：</strong> <a class="- topic/xref xref" href="https://www.sobyte.net/post/2022-04/lsm-tree/" target="_blank" rel="external noopener">Principle of LSM Tree</a></p><p class="- topic/p p">DolphinDB 的 TSDB 引擎是基于 LSM-Tree 架构进行开发的，因此大部分内部的流程机制也和 LSM-Tree 类似，但在某些步骤进行了优化：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">写入：</strong> 与 LSM-Tree 直接写入一个有序的数据结构不同，DolphinDB TSDB 引擎在写入数据到内存时，会先按写入顺序存储在一个写缓冲区域（unsorted write Buffer），当数据量累积到一定程度，再进行排序转化为一个 sorted buffer。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">查询：</strong> DolphinDB TSDB 引擎会预先遍历 Level File（对应 LSM-Tree 的 SSTable 文件），读取查询涉及的分区下所有 Level File 尾部的索引信息到内存的索引区域（一次性读，常驻内存）。后续查询时，系统会先查询内存中的索引，若命中，则可以快速定位到对应 Level File 的数据块，无需再遍历磁盘上的文件。</p><img class="- topic/image image" src="images/tsdb_explained/read_write.png"/><br/></li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="32-tsdb-引擎-crud-流程"><h3 class="- topic/title title topictitle3" id="ariaid-title7">3.2. TSDB 引擎 CRUD 流程</h3><div class="- topic/body body"><p class="- topic/p p">本节将具体介绍 DolphinDB TSDB 引擎的增删改查（CRUD）流程。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title8" id="321-写入流程"><h4 class="- topic/title title topictitle4" id="ariaid-title8">3.2.1. 写入流程</h4><div class="- topic/body body"><p class="- topic/p p">TSDB 引擎写入整体上和 OLAP 一致，都是通过两阶段协议进行提交。写入时，先写 Redo Log（每个写事务都会产生一个 Redo Log），并写入 Cache Engine 缓存，最后 由后台线程异步批量写入磁盘。需要注意的是，TSDB 引擎和 OLAP 引擎各自单独维护 Redo 以及 Cache Engine，用户需要通过不同的配置项去设置两个引擎的 Cache Engine 大小，分别为 OLAPCacheEngineSize 和 TSDBCacheEngineSize。<a class="- topic/xref xref" href="../db_distr_comp/cfg/function_configuration.html">功能配置</a></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">具体的写入流程如下：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">写 Redo：</strong> 先将数据写入 TSDB Redo Log。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">写 Cache Engine：</strong> 写 Redo Log 的同时，将数据写入 TSDB Cache Engine 的 CacheTable，并在 CacheTable 内部完成数据的排序过程。</p><img class="- topic/image image" src="images/tsdb_explained/cacheTable.png"/><br/><p class="- topic/p p">CacheTable 分为两个部分：首先是 write buffer，数据刚写入时会追加到 write buffer 的尾部，该 buffer 的数据是未排序的。当 write buffer 超过 <em class="+ topic/ph hi-d/i ph i">TSDBCacheTableBufferThreshold</em> 的配置值（默认 16384 行），则按照 sortColumns 指定的列排序，转成一个 sorted buffer (该内存是 read only 的)，同时清空 write buffer。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">写磁盘：</strong> 若某写事务到来时，Cache Engine 中的数据累计超过了  <em class="+ topic/ph hi-d/i ph i">TSDBCacheEngineSize</em>，或经过一定时间，系统将进行一次刷盘操作。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">刷盘前，系统会将 CacheTable 的所有数据按照 sortColumns 进行归并排序，<strong class="+ topic/ph hi-d/b ph b">再按分区</strong>写入磁盘 Level 0 层的 Level File 文件中（大小为 32M）。</p></li><li class="- topic/li li"><p class="- topic/p p">刷盘时，若单个分区的数据量很大，按 32 M 拆分可能产生多个 Level File 文件（见下注 1）；若单个分区写入数据量不足 32 M 或拆分后最后一部分数据不足 32 M，也会写为一个 Level File。由于 Level File 一旦写入就是不可变的，<strong class="+ topic/ph hi-d/b ph b">下次写入不会向磁盘的 Level File 文件追加数据</strong> 。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注 1：</strong> 同属于一个 sortKey 值的数据不会被拆分到不同的 Level File 文件。因此实际场景我们会发现一个 Level File 的文件可能会大于 32 M，若一个 sortKey 值对应的数据量特别巨大，甚至可能达到更高！</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注 2：</strong> 可以通过设置刷盘的工作线程数配置项 <em class="+ topic/ph hi-d/i ph i">TSDBCacheFlushWorkNum</em> 来提高刷盘效率。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注 3：</strong> 根据步骤 2，3，可以发现刷盘前数据先局部排序（sorted buffer），再整体排序，共执行了两次排序操作。实际就是通过分治的思想，提升了排序的效率。</p></li></ul></li></ol><p class="- topic/p p">若刷盘过程中，又有新的数据写入 Cache Engine，则系统会分配新的 Cache Engine 空间来进行写入。在极端情况下，TSDB 的 Cache Engine 占用的内存 <strong class="+ topic/ph hi-d/b ph b">会达到两倍</strong> 的 <em class="+ topic/ph hi-d/i ph i">TSDBCacheEngineSize</em>（配置项）的指定值。<strong class="+ topic/ph hi-d/b ph b">在配置 <em class="+ topic/ph hi-d/i ph i">TSDBCacheEngineSize</em> 大小和 <em class="+ topic/ph hi-d/i ph i">maxMemSize</em>，需要注意这一点，以免造成内存溢出的情况。</strong></p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title9" id="322-查询流程"><h4 class="- topic/title title topictitle4" id="ariaid-title9">3.2.2. 查询流程</h4><div class="- topic/body body"><p class="- topic/p p">相较于 OLAP 引擎，TSDB 引擎增加了索引的机制，因此更适用于点查场景，因此在配置 TSDB 引擎的 sortKey 字段（参照<a class="- topic/xref xref" href="#%E7%A1%AE%E5%AE%9A%E7%B4%A2%E5%BC%95%E9%94%AE%E5%80%BC">确定索引键值</a>的说明）时，可以优先考虑从频繁查询的字段中进行选取（如需了解更多 sortColumns 的设置原则，请参见<a class="- topic/xref xref" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93">创建数据库</a>的合理设置排序字段部分）。</p><p class="- topic/p p">此外和 OLAP 引擎在用户态缓存数据不同（第一次执行查询语句会加载分区数据，这部分数据会常驻内存，后续的查询可以提速，但增大了内存开销），TSDB 引擎只有操作系统的缓存，没有用户态的缓存。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">具体的查询流程：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">分区剪枝：</strong> 根据查询语句进行分区剪枝，缩窄查询范围。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">加载索引：</strong> 遍历涉及到的分区下的所有 Level File，将其尾部的索引信息加载到内存中（索引信息采用惰性缓存策略，即不会在节点启动时被立即加载进内存，而是在第一次查询命中该分区时才被加载进内存）。查询命中的分区的索引信息一旦被加载到内存后，会一直缓存在内存中（除非因内存不够被置换），后续查询若涉及该分区则不会重复此步骤，而是直接从内存中读取索引信息。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注：</strong> 内存中存放索引的区域大小由配置项 <em class="+ topic/ph hi-d/i ph i">TSDBLevelFileIndexCacheSize</em> 决定，用户可以通过函数 <a class="- topic/xref xref" href="../funcs/g/getLevelFileIndexCacheStats.html">getLevelFileIndexCacheStatus</a>  在线查询内存中的索引占用。若加载的索引大小超过了该值，内部会通过一些缓存淘汰算法进行置换，用户可配置 <em class="+ topic/ph hi-d/i ph i">TSDBLevelFileIndexCacheInvalidPercent</em> 来调整缓存淘汰算法的阈值。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">查找内存中的数据：</strong> 先搜索 TSDB Cache Engine 中的数据。若数据在 write buffer 中，则采用顺序扫描的方式查找；若在 sorted buffer 种，则利用其有序性，采用二分查找。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">查找磁盘上的数据：</strong> 根据索引查找磁盘 Level File 中各查询字段的数据块，解压到内存。若查询的过滤条件包含 sortKey 字段，即可根据索引加速查询。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">返回查询结果：</strong> 合并上述两步的结果并返回。</p></li></ol><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">其中，具体索引流程：</strong></p><img class="- topic/image image" src="images/tsdb_explained/index.png"/><br/><p class="- topic/p p">内存索引包含两个部分：sortKey 维护的 block 的偏移量信息（对应 Level File indexes 部分），zonemap 信息（对应 Level File zonemap 部分）。</p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">查询 indexes 定位 sortKey：</strong> indexes 中记录了每个 Level File 中每个 sortKey 值下每个字段的 block 的地址偏移量。若查询条件包含 sortKey 字段，则可以根据索引剪枝，缩窄查询范围。命中 sortKey 索引后，即可获取到对应 sortKey 下所有 block 的地址偏移量信息。</p><p class="- topic/p p">例如，上图 sortColumns=`deviceId`location`time，查询条件 deviceId = 0，则可以快速定位到所有 Level File 中 deviceId= 0 的 sortKey 及其对应所有字段的 block 数据。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">根据 zonemap 定位 block：</strong> 由 1 定位到 sortKey 后，系统会查询对应 sortKey 在 zonemap 里的最值信息（min，max）。如果查询条件提供了 sortKey 以外的字段范围，则可以进一步过滤掉一些不在查询范围内的 block 数据。</p><p class="- topic/p p">例如，上图 sortColumns=`deviceId`location`time，查询条件 time between 13:30 and 15:00，则可以根据 time 列的 zonemap 信息，快速定位到查询数据所在的 block 为“block2”。系统根据该信息再去 indexes 找到 block2 的地址偏移量信息，然后根据索引到的所有 Level File 的 block2 的地址，把 block 数据从磁盘中读取出来，再根据去重策略过滤结果后返回给用户端。</p></li></ol></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title10" id="323-更新流程"><h4 class="- topic/title title topictitle4" id="ariaid-title10">3.2.3. 更新流程</h4><div class="- topic/body body"><p class="- topic/p p">TSDB 引擎的更新效率取决于 keepDuplicates 参数配置的去重机制。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">keepDuplicates=ALL/FIRST 时的更新流程：</p><ol class="- topic/ol ol"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">分区剪枝：</strong> 根据查询语句进行分区剪枝，缩窄查询范围。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">查到内存更新：</strong> 取出对应分区所有数据到内存后，更新数据。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">写回更新后的分区数据到新目录：</strong> 将更新后的数据重新写入数据库，系统会使用一个新的版本目录（默认是“物理表名_cid”，见下图，其中 tick_2 是物理表名）来保存更新后的分区数据，旧版本的分区数据文件将被定时回收（默认 30 min）。</li></ol><img class="- topic/image image" src="images/tsdb_explained/update.png"/><br/></li><li class="- topic/li li"><p class="- topic/p p">keepDuplicates=LAST 时的更新流程：</p><ol class="- topic/ol ol"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">分区剪枝：</strong> 根据查询语句进行分区剪枝，缩窄查询范围。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">查到内存更新：</strong> 根据查询条件，查询出需要更新的数据。（查询步骤见<a class="- topic/xref xref" href="#%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B">查询流程</a>）</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">直接以写数据的方式追加写入：</strong> 更新后，直接追加写入数据库。</li></ol></li></ul><p class="- topic/p p">更新后的数据和旧的数据可能同时存储在磁盘上，但查询时，由于会按照 LAST 机制进行去重，因此可以保证不会查询出旧的数据。旧数据会在 Level File 合并操作时进行删除。</p><p class="- topic/p p">若需要深入了解更新方法、更新流程以及不同策略的更新性能，请参考教程：<a class="- topic/xref xref" href="dolphindb_update.html">分布式表数据更新原理和性能介绍</a></p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="324-删除流程"><h4 class="- topic/title title topictitle4" id="ariaid-title11">3.2.4. 删除流程</h4><div class="- topic/body body"><p class="- topic/p p">TSDB 引擎的删除流程和更新流程一致，即：</p><ul class="- topic/ul ul"><li class="- topic/li li">指定 keepDuplicates=ALL/FIRST 时，按分区全量取数，根据条件删除后写入一个新版本目录；</li><li class="- topic/li li">指定 keepDuplicates=LAST 时，若同时指定 softDelete=true，则取出待删除的数据打上删除标记（软删除），再以追加的方式写回数据库；若指定 softDelete=false，则同 keepDuplicates=ALL/FIRST 时的删除流程。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">具体流程：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">分区剪枝：</strong> 根据查询语句进行分区剪枝，缩窄查询范围。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">查到内存删除：</strong> 取出对应分区所有数据到内存后，根据条件删除数据。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">写回删除后的分区数据到新目录：</strong> 将删除后的数据重新写入数据库，系统会使用一个新的 CHUNK 目录（默认是“物理表名_cid”）来保存写入的数据，旧的文件将被定时回收（默认 30 min）。</li></ol><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li"><p class="- topic/p p">在配置 keepDuplicates=ALL / FIRST 场景下，更新操作（keepDuplicates=ALL / FIRST）和删除操作是按分区全量修改，因此需要确保每次更新删除操作涉及分区总大小不会超过系统的可用内存大小，否正会造成内存溢出。</p></li><li class="- topic/li li"><p class="- topic/p p">在配置 keepDuplicates=LAST 场景下，更新操作和删除操作是按照直接追加的方式增量修改，效率更高，若业务场景需要高频更新和删除，可以配置此策略。</p></li></ol></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title12" id="33-排序列-sortcolumns"><h3 class="- topic/title title topictitle3" id="ariaid-title12">3.3. 排序列 sortColumns</h3><div class="- topic/body body"><p class="- topic/p p">sortColumns 参数在 TSDB 引擎中起到三个作用：确定索引键值、数据排序、数据去重。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title13" id="331-确定索引键值"><h4 class="- topic/title title topictitle4" id="ariaid-title13">3.3.1. 确定索引键值</h4><div class="- topic/body body"><p class="- topic/p p">根据查询流程可以知道，TSDB 的索引机制可以提升查询性能，那么索引又是如何确定的？</p><p class="- topic/p p">写入流程提到，在 Cache Engine 中，数据会根据 sortColumns 指定的列进行排序，TSDB 引擎的索引列就是基于排序列建立的。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">sortColumns 由两部分组成：sortKey（可以是多列，其组合值作为数据的索引键）, timestamp（时间列）。</strong></p><p class="- topic/p p">假设 sortColumns 指定了 n 个字段，则系统取前 n-1 个字段的组合值，作为索引键 sortKey，每个 sortKey 值对应的数据按列存储在一起（如下图，假设 sortColumns 为 deviceId 和 timestamp）。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注：</strong> 若 sortColumns 只有一列，则该列将作为 sortKey。</p><img class="- topic/image image" src="images/tsdb_explained/indexing_mechanism.png"/><br/><p class="- topic/p p">每个 sortKey 内部的数据仍然是按列存储的，其中每个列的数据又按记录数划分为多个 block（按固定行数划分，参见 Level File 层级示意图）。block 是内部最小的查询单元，也是数据压缩的单元，其内部数据按照时间列的顺序排序。</p><p class="- topic/p p">查询时，若查询条件包含 sortColumns 指定的字段，系统会先定位到对应的 sortKey 的数据所在的位置，然后根据 block 内部<strong class="+ topic/ph hi-d/b ph b">数据的有序性</strong>以及<strong class="+ topic/ph hi-d/b ph b">列之间 block 的对齐性</strong>，通过时间列快速定位到对应的 block，将相关列的 block 读取到内存中。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">block 数据的有序性</strong>：block 内部数据是按照时间列排好序的，此外每个 sortKey 的元数据都记录了对应每个 block 的第一条数据，因此根据和每个 block 的第一条数据比较，可以快速过滤掉一些不必要的 block 的查询，从而提升查询性能。</li><li class="- topic/li li"><strong class="+ topic/ph hi-d/b ph b">block 的对齐性</strong>：由于 block 的数据量都是固定的，因此根据时间列快速定位到时间列所在的 block，就能根据该 block 的 offset 快速定位到其他列的 block。</li></ol><p class="- topic/p p">sortKey 需要合理设置，每个分区的 sortKey 值不宜过多。因为同等数据量下，sortKey 值越多，意味着每个 sortKey 对应的数据量越少，不仅在命中索引的过程会增大查询开销，而且会增大读取每个 sortKey 元数据的开销，反而会降低查询效率。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title14" id="332-数据排序"><h4 class="- topic/title title topictitle4" id="ariaid-title14">3.3.2. 数据排序</h4><div class="- topic/body body"><p class="- topic/p p">写入流程提到，在 TSDB Cache Engine 中，每批刷盘的数据会根据 sortColumns 进行排序，然后再写入磁盘，可以推断：</p><ul class="- topic/ul ul"><li class="- topic/li li">每个写入事务的数据一定是有序的。</li><li class="- topic/li li">单个 Level File 文件内的数据一定是有序的。</li><li class="- topic/li li">Level File 之间数据的顺序无法保证。</li><li class="- topic/li li">每个分区的数据的有序性无法保证。</li></ul><p class="- topic/p p">结合 <a class="- topic/xref xref" href="#%E7%A1%AE%E5%AE%9A%E7%B4%A2%E5%BC%95%E9%94%AE%E5%80%BC">确定索引键值</a> 节的说明和上述推断，可以了解到 sortColumns 的数据排序功能，并不保证数据整体的有序性，而只是保证 Level File 内数据按 sortKey 有序排列，以及每个 sortKey 中 block 内数据的有序性，<strong class="+ topic/ph hi-d/b ph b">这有助于：</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">查询条件包含 sortKey 字段的范围查询或第一个 sortKey 字段的等值查询时，加速内存查找索引的效率。</li><li class="- topic/li li">命中 sortKey 索引时，可以根据 sortKey 的元数据信息，加速 block 的定位。</li></ul></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title15" id="333-数据去重"><h4 class="- topic/title title topictitle4" id="ariaid-title15">3.3.3. 数据去重</h4><div class="- topic/body body"><p class="- topic/p p">TSDB 的去重机制主要用于<strong class="+ topic/ph hi-d/b ph b">同一个时间点产生多条数据，需要去重的场景</strong>。</p><p class="- topic/p p">去重是基于 sortColumns 进行的，发生在写入时数据排序阶段以及 Level File 的合并阶段。其对应的配置参数为 keepDuplicates（在建表是设置），有三个可选项：ALL（保留所有数据，为默认值），LAST（仅保留最新数据），FIRST（仅保留第一条数据）。</p><p class="- topic/p p">不同去重机制可能会对更新操作产生影响（具体参见 <a class="- topic/xref xref" href="#%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B">数据更新流程</a>）：若 keepDuplicates=ALL/FIRST，那么每次更新，都需要将分区数据读取到内存更新后再写回磁盘；若 keepDuplicates=LAST，则更新数据将以追加的方式写入，真正的更新操作将会在 Level File 合并阶段进行。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">需要注意：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li">去重策略不能保证磁盘上存储数据不存在冗余，只能保证查询时不会返回冗余结果。查询数据时，会将对应 sortKey 所在各个 Level File 中的数据块读出，然后在内存中进行去重，再返回查询结果。</li><li class="- topic/li li">DolphinDB 不支持约束。现实场景下，很多用户会利用 sortColumns 的去重机制，将数据中的主键或唯一约束设置为 sortColumns，造成一个 sortKey 键值对应的数据量很少，从而导致 TSDB 数据库<strong class="+ topic/ph hi-d/b ph b">数据膨胀</strong>（详见案例 <a class="- topic/xref xref" href="#sortkey-%E6%95%B0%E9%87%8F%E5%AF%B9%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D">sortkey 数量对查询性能的影响</a>）。</li></ol></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title16" id="34-level-file-文件"><h3 class="- topic/title title topictitle3" id="ariaid-title16">3.4. Level File 文件</h3><div class="- topic/body body"><p class="- topic/p p">TSDB 引擎存储的数据文件在 DolphinDB 中被称为 Level File（对应 LSM-Tree 的 SSTable 文件），即 LSMTree 架构各 Level 层级的文件。Level File 主要保存了数据和索引信息，其中索引信息保存在 Level File 的尾部。为了更好地理解 Level File 在整个系统中发挥的作用，本节将对 Level File 进行一个简单介绍。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title17" id="341-level-file-的组成"><h4 class="- topic/title title topictitle4" id="ariaid-title17">3.4.1. Level File 的组成</h4><div class="- topic/body body"><p class="- topic/p p">Level File 文件存储的内容可以划分为：</p><img class="- topic/image image" src="images/tsdb_explained/levelFile.png"/><br/><ul class="- topic/ul ul"><li class="- topic/li li">header：记录了一些保留字段、表结构以及事务相关的信息。</li><li class="- topic/li li">sorted col data：按 sortKey 顺序排列，每个 sortKey 依次存储了每列的 block 数据块。</li><li class="- topic/li li">zonemap：存储了数据的预聚合信息（每列每个 sortKey 对应数据的 min，max，sum，notnullcount）。</li><li class="- topic/li li">indexes：sorted col data 的索引信息，记录了 sortKey 个数，每个 sortKey 的记录数、每列 block 数据块在文件中的偏移量信息，checksum 等。</li><li class="- topic/li li">footer：存储 zonemap 的起始位置，用来定位预聚合和索引区域。</li></ul><p class="- topic/p p">Level File 的 zonemap 和 indexes 部分在查询时会加载到内存中，用于索引。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title18" id="342-level-file-层级组织"><h4 class="- topic/title title topictitle4" id="ariaid-title18">3.4.2. Level File 层级组织</h4><div class="- topic/body body"><p class="- topic/p p">Level File 层级间的组织形式如下图所示：</p><img class="- topic/image image" src="images/tsdb_explained/level.png"/><br/><p class="- topic/p p">磁盘的 Level File 共分为 4 个层级，即 Level 0, 1, 2, 3 层。层级越高，Level File 文件大小越大，每个 Level File 中数据划分的 block 大小也越大。</p><img class="- topic/image image" src="images/tsdb_explained/location.png"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title19" id="343-level-file-合并"><h4 class="- topic/title title topictitle4" id="ariaid-title19">3.4.3. Level File 合并</h4><div class="- topic/body body"><p class="- topic/p p">多次写入后，多个相同的 sortKey 的数据可能分散在不同的 Level File 里。查询时，系统会将所有满足条件的数据读到内存，然后再根据去重机制进行去重。为此，TSDB 设计了文件合并的机制，通过合并操作（compaction）大大减少文件数，有效的清除无效数据，减少碎片化查找，提高磁盘空间利用率（压缩率提升）以及提升查询性能。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">文件合并机制：</strong> 若一层的 Level File 超过 10 个，或者单层文件总大小超过下一层单个文件的大小，则做一次合并操作，合并时会根据参数 keepDuplicates 指定的去重策略进行去重。文件数过多时，用户也可以在线调用函数 <a class="- topic/xref xref" href="../funcs/t/triggerTSDBCompaction.html">triggerTSDBCompaction</a>  手动触发合并，以减少文件数，<strong class="+ topic/ph hi-d/b ph b">提升查询性能</strong>。合并状态可以通过调用函数 <a class="- topic/xref xref" href="../funcs/g/getTSDBCompactionTaskStatus.html">getTSDBCompactionTaskStatus</a>  进行查询。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">但需要注意：</strong> 合并操作非常消耗 CPU 和磁盘 IO，会造成一定程度的写放大。且对于每个 volume 而言，合并是单线程进行的，当合并任务很多时，耗时将会非常久。如果在写入高峰期，发生合并操作，会降低整个系统的吞吐量。因此，<strong class="+ topic/ph hi-d/b ph b">建议用户使用 scheduleJob 定时（在业务不密集的时间段）触发手动合并任务。</strong></p></div></article></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title20" id="4-合理使用-tsdb-引擎"><h2 class="- topic/title title topictitle2" id="ariaid-title20">4. 合理使用 TSDB 引擎</h2><div class="- topic/body body"><p class="- topic/p p">分区、索引等因素都会影响引擎的写入和查询性能，因此在建库建表时合理地配置 TSDB 引擎至关重要。本章将从功能参数配置，以及使用时的注意事项方面，给出一些指导性的建议，方便用户快速上手。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title21" id="41-数据库部署"><h3 class="- topic/title title topictitle3" id="ariaid-title21">4.1. 数据库部署</h3><div class="- topic/body body"><p class="- topic/p p">在使用 TSDB 引擎前，可以按需调整系统的配置项（TSDB 引擎相关的配置项一览表见<a class="- topic/xref xref" href="#tsdb-%E5%BC%95%E6%93%8E%E9%85%8D%E7%BD%AE%E9%A1%B9%E6%B1%87%E6%80%BB">TSDB 引擎配置项汇总</a>），以充分发挥系统的性能。本节主要介绍其中几个重点参数：</p><ul class="- topic/ul ul"><li class="- topic/li li">TSDBRedoLogDir：为了提高写入效率，建议将 TSDB redo log 配置在 SSD 盘。</li><li class="- topic/li li">TSDBCacheEngineSize：默认是 1G，写入压力较大的场景可以适当调大该值。<ul class="- topic/ul ul"><li class="- topic/li li">若设置过小，可能导致 cache engine 频繁刷盘，影响系统性能；</li><li class="- topic/li li">若设置过大，由于 cache engine 内缓存的数据量很大，但由于未达到 cache engine 的大小（且未达到十分钟），因此数据尚未刷盘，此时若发生了机器断电或关机，重启后就需要回放大量事务，导致系统启动过慢。</li></ul></li><li class="- topic/li li">TSDBLevelFileIndexCacheSize：默认是 5% * maxMemSize，该配置项确定了索引数据（Level File indexes 和 zonemap）的上限，若配置过小，会造成索引频繁置换。在索引部分，较占内存空间的是 zonemap 部分，用户可以根据“分区数量 × sortKey 数量 × （4 × Σ各字段字节数）”进行估算（其中 4 表示 4 种预聚合指标 min，max，sum，notnullcount）。</li><li class="- topic/li li">TSDBAsyncSortingWorkerNum：非负整数，默认值为 1，用于指定 TSDB cache engine 异步排序的工作线程数。在 CPU 资源充足的情况下，可以适当增大该值，以提高写入性能。</li><li class="- topic/li li">TSDBCacheFlushWorkNum：TSDB cache engine 刷盘的工作线程数，默认值是 volumes 指定的磁盘卷数。若配置值小于磁盘卷数，则仍取默认值。通常无需修改此配置。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title22" id="42-创建数据库"><h3 class="- topic/title title topictitle3" id="ariaid-title22">4.2. 创建数据库</h3><div class="- topic/body body"><p class="- topic/p p">下述脚本以创建一个组合分区的数据库为例，和 OLAP 引擎创库时的区别仅在于 engine 设置不同：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db1 = database(, VALUE, 2020.01.01..2021.01.01)
db2 = database(, HASH, [SYMBOL, 100])
db = database(directory=dbName, partitionType=COMPO, partitionScheme=[db1, db2], engine="TSDB")</code></pre><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">库表对应关系：</strong> 设计分布式数据库时，若存储的是分布式表，推荐一库一表，因为对于不同的表按照同一分区方案进行分区，可能造成每个分区的数据量不合理；若存储的是维度表，推荐一库多表，集中管理，因为维度表只有一个分区，且一次加载常驻内存。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">分区设计：</strong></p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">TSDB 引擎单个分区推荐大小</strong>：400MB - 1GB（压缩前）</p><p class="- topic/p p">分布式查询按照分区加载数据进行并行计算（包括查询、删除、修改等操作），若分区粒度过大，可能会造成内存不足、查询并行度降低、更新删除效率降低等问题；若分区粒度过小，可能会产生大量子任务增加节点负荷、大量小文件独写增加系统负荷、控制节点元数据爆炸等问题。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">分区设计步骤：</strong></p><ol class="- topic/ol ol"><li class="- topic/li li">以推荐大小作为参照，先根据表中的记录数和每个字段的大小<strong class="+ topic/ph hi-d/b ph b">估算数据量</strong>，再根据分区方案计算的<strong class="+ topic/ph hi-d/b ph b">分区数（如天 + 股票 HASH10 的组合分区，可以按天数 * 10）</strong>，通过数据量/分区数计算得到每个分区的大小。</li><li class="- topic/li li">若分区粒度不合理，调整分区粒度可以参考以下方案：<ul class="- topic/ul ul"><li class="- topic/li li">粒度过小：若采用了值分区可以考虑改成范围分区，例如按天改成按月；若采用了 HASH 分区，可以考虑改小 HASH 分区数。</li><li class="- topic/li li">粒度过大：若采用了范围分区可以考虑改成值分区，例如按年改成按月；若采用了 HASH 分区，可以考虑改大 HASH 分区数；若是一级分区，可以考虑用组合分区，此时新增一级通常是 HASH 分区，例按天单分区，粒度过大，考虑二级按股票代码 HASH 分区。</li></ul></li></ol></li></ul></li></ul><p class="- topic/p p">合理设置分区至关重要，如需了解详细的分区机制和如何设计合理的分区，可参见<a class="- topic/xref xref" href="database.html">数据库分区</a></p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">是否允许并发写入同一分区：</strong></p><p class="- topic/p p">此外，为了支持用户多线程能够并发写数据且不会因写入分区冲突而失败，DolphinDB 在创建数据库时支持了一个特殊的配置参数 atomic（该参数是 OLAP 和 TSDB  引擎共有参数）：</p><ul class="- topic/ul ul"><li class="- topic/li li">默认为‘TRANS'，即不允许并发写入同一个 CHUNK 分区；</li><li class="- topic/li li">设置为‘CHUNK'，则允许多线程并发写入同一分区。系统内部仍会串行执行写入任务，当一个线程正在写入某个分区时，其他写入该分区的线程检测到冲突会不断尝试重新写入。尝试 250 次（每次尝试间隔时间会随着尝试次数增加而增加，上限是 1s，整个尝试过程约持续 5 分钟）后仍然无法写入，则会写入失败。atomic='CHUNK' 配置可能会破坏事务的原子性，因为若某线程冲突重试达到上限后仍失败，则该部分数据将会丢失，需要谨慎设置。</li></ul></li></ul><p class="- topic/p p">实际场景下，若设置为 'CHUNK' 发生数据丢失，用户可能难以定位到具体的分区，针对该场景有几个较推荐的方案：</p><ol class="- topic/ol ol"><li class="- topic/li li">使用 tableInsert 写入，该函数会返回写入数据的记录数，根据记录数可以定位到写入失败的线程任务，若线程涉及的分区没有重叠，可以删除相关分区数据后重新写入。</li><li class="- topic/li li">若使用 TSDB 引擎，且去重策略设置为了 FIRST 或者 LAST，则直接重复提交写入失败的线程任务，系统会进行去重，查询时不会读出重复数据。不适用于去重策略为 ALL 的场景，若为 ALL，则参照方案 1。</li></ol></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title23" id="43-创建数据表"><h3 class="- topic/title title topictitle3" id="ariaid-title23">4.3. 创建数据表</h3><div class="- topic/body body"><p class="- topic/p p">创建分布式表/维度表时，与 OLAP 引擎不同，TSDB 需要额外设置 sortColumns 这个必选参数，以及 keepDuplicates,  sortKeyMappingFunction, softDelete 这几个可选参数。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock cpp"><em class="hl-comment">// 函数</em>
createPartitionedTable(dbHandle, table, tableName, [partitionColumns], [compressMethods], [sortColumns], [keepDuplicates=ALL], [sortKeyMappingFunction], [softDelete=<strong class="hl-keyword">false</strong>])

<em class="hl-comment">// 标准 SQL</em>
create table dbPath.tableName (
    schema[columnDescription]
)
[partitioned by partitionColumns],
[sortColumns],
[keepDuplicates=ALL],
[sortKeyMappingFunction]</pre><p class="- topic/p p">这里以通过函数创建一个 TSDB 下的分布式表为例：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock cpp">colName = `SecurityID`TradeDate`TradeTime`TradePrice`TradeQty`TradeAmount`BuyNo`SellNo
colType = `SYMBOL`DATE`TIME`DOUBLE`INT`DOUBLE`INT`INT
tbSchema = table(<span class="hl-number">1</span>:<span class="hl-number">0</span>, colName, colType)
db.createPartitionedTable(table=tbSchema, tableName=tbName, partitionColumns=`TradeDate`SecurityID, compressMethods={TradeTime:<span class="hl-string">"delta"</span>}, sortColumns=`SecurityID`TradeDate`TradeTime, keepDuplicates=ALL)</pre><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">对字段应用合适的压缩算法（compressMethods）：</p><ul class="- topic/ul ul"><li class="- topic/li li">对重复较高的字符串，使用 SYMBOL 类型存储。需要注意单个分区下 SYMBOL 字段的唯一值数不能超过 2^21(2097152) 个，否则会抛异常，见 <a class="- topic/xref xref" href="../error_codes/S00003.html">S00003</a> 。</li><li class="- topic/li li">对时序数据或顺序数据（整型）可以使用 delta 算法存储，压缩性能测试可以参考 <a class="- topic/xref xref" href="iot_examples.html">物联网应用范例</a> 。</li><li class="- topic/li li">其余默认 lz4 压缩算法。</li></ul></li><li class="- topic/li li"><p class="- topic/p p">合理设置排序字段（sortColumns）：</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">确保一个分区的 sortKey 的组合数小于 1000。</strong></p><p class="- topic/p p">通常金融场景下会以 SecurityID+ 时间戳的组合、物联网场景下会以 deviceID+ 时间戳的组合来作为 sortColumns。
在 Level File 章节提及，Level File 的每个 sortKey 都对应存储了许多索引信息，因此在数据量固定的情况下，如果 sortKey 的数量过多，元数据也会变多。极端场景下，数据库可能会膨胀 50 倍！<strong class="+ topic/ph hi-d/b ph b">因此不推荐把主键或唯一约束设置为 sortColumns。</strong></p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">建议把查询频率高的字段作为 <em class="+ topic/ph hi-d/i ph i">sortColumns</em> 中的前置列。</strong></p><p class="- topic/p p">索引键值是 sortKey 的组合值，查询时，如果过滤条件中包含 sortKey 字段，即可以快速定位索引，从而快速定位到数据块 block 加速查询。</p><p class="- topic/p p">因为索引键在内存中是按照其组合值排序的，如果将频繁查询的字段前置，则若查询语句中包含前置的字段，则定位索引时可以通过二分查找进行加速，否则系统会对内存中的索引进行遍历。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">如果 sortColumns 只有一列，该列将作为 sortKey，块内数据是无序的。</strong> 因此，对于每个 sortKey 需要遍历内部的每一个 block；如果 sortColumns 有多列，则除最后一列外的作为索引列 sortKey，最后一列必须是时间列，block 内部按时间排序，如果查询条件指定了时间列，可以无需对每个 sortKey 下的 block 进行遍历。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">类型限制</strong>：sortColumns 只支持 integer, temporal, string 或 symbol 类型；sortKey 不能为为 TIME, TIMESTAMP, NANOTIME, NANOTIMESTAMP 类型。</p></li></ul></li><li class="- topic/li li"><p class="- topic/p p">索引降维（sortKeyMappingFunction）：</p><p class="- topic/p p">如果单纯的依靠合理配置 sortColumns 仍然不能降低每个分区的 sortKey 数量，则可以通过指定该参数进行降维。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">例如：</strong> 5000 只股票，按照日期分区，设置股票代码和时间戳为 sortColumns，每个分区 sortKey 组合数约为 5000，不满足每个分区 sortKey 组合数不超过 1000 的原则，则可以通过指定 sortKeyMappingFunction=[hashBucket{, 500}] 进行降维，使每个分区的 sortKey 组合数降为 500。</p><ul class="- topic/ul ul"><li class="- topic/li li">降维是对每个 sortKey 的字段进行的，因此有几个 sortKey 字段就需要指定几个降维函数。</li><li class="- topic/li li">常用的降维函数是 hashBucket，即进行哈希映射。</li><li class="- topic/li li">降维后可以通过 <a class="- topic/xref xref" href="../funcs/g/getTSDBSortKeyEntry.html">getTSDBSortKeyEntry</a>  查询每个分区的 sortKey 信息。</li></ul></li><li class="- topic/li li"><p class="- topic/p p">数据去重（keepDuplicates）：</p><ul class="- topic/ul ul"><li class="- topic/li li">对 <strong class="+ topic/ph hi-d/b ph b">同一个时间点产生多条数据，需要去重的场景，</strong> 可以根据业务需要设置 keepDuplicates=FIRST/LAST，分别对应每个 sortColumns 保留第一条还是最后一条数据。</li><li class="- topic/li li">若对去重策略没有要求，则可以根据以下需求进行评估，以设置去重策略：<ul class="- topic/ul ul"><li class="- topic/li li">高频更新：建议指定 keepDuplicates=LAST，因为 LAST 采用追加更新的方式效率更高（见<a class="- topic/xref xref" href="#%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B">更新流程</a>）。</li><li class="- topic/li li">查询性能：较推荐使用 keepDuplicates=ALL，因为其他去重策略查询时有额外的去重开销。</li><li class="- topic/li li">atomic=CHUNK：推荐使用 keepDuplicates=FIRST/LAST，若并发写入失败，直接重复写入即可，无需删除数据再写。</li></ul></li></ul></li></ul></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title24" id="5-tsdb-引擎查询优化案例"><h2 class="- topic/title title topictitle2" id="ariaid-title24">5. TSDB 引擎查询优化案例</h2><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试环境</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">CPU：48 核</li><li class="- topic/li li">内存：128 G</li><li class="- topic/li li">磁盘：HDD</li><li class="- topic/li li">数据库设置：单机集群 2 数据节点</li></ul></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title25" id="51-sortkey-数量对查询性能的影响"><h3 class="- topic/title title topictitle3" id="ariaid-title25">5.1. sortKey 数量对查询性能的影响</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">推荐每个分区的 sortKey 组合数不要超过 1000。</strong></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试场景</strong></p><p class="- topic/p p">本节以一个极端场景为例，只利用 sortColumns 去重的特性，将其作为主键或唯一约束使用，每个 sortKey 只对应很少的数据。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">数据表结构</strong></p><p class="- topic/p p">宽表存储，包含 100 个指标值。</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__1"><strong class="+ topic/ph hi-d/b ph b">字段名</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__2"><strong class="+ topic/ph hi-d/b ph b">字段类型</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__3"><strong class="+ topic/ph hi-d/b ph b">说明</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__1">tradeDate</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__2">DATE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__3"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__1">tradeTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__2">TIME</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__3"> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__1">ID</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__2">INT</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__3">每个日期下具有唯一性</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__1">factor1~factor100</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__2">DOUBLE</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__3"> </td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">分区方案</strong></p><p class="- topic/p p">写入 5 日数据，每日 50 万条数据（约 400M），总数据量为 1.9 G。</p><ul class="- topic/ul ul"><li class="- topic/li li">分区方案：单分区，按天 VALUE 分区。</li><li class="- topic/li li">排序列 sortColumns：ID，tradeDate，TradeTime。其中 ID 和 tradeDate 的组合值将作为 sortKey。</li><li class="- topic/li li">去重规则 keepDuplicates：LAST，对于重复数据只保存最新的一条。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试指标</strong></p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__16"><strong class="+ topic/ph hi-d/b ph b">属性</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__17"><strong class="+ topic/ph hi-d/b ph b">值</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__18"><strong class="+ topic/ph hi-d/b ph b">查询脚本</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__16">落盘实际大小</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__17">17.05 G</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__18"><code class="+ topic/ph pr-d/codeph ph codeph">use opsgetTableDiskUsage(dbName, tableName)</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__16">sortKey 总数量</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__17">2,500,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__18"><code class="+ topic/ph pr-d/codeph ph codeph">chunkIDs = exec chunkID from pnodeRun(getChunksMeta{"/test_tsdb%"}) where dfsPath not like "%tbl%" and dfsPath not like "%domain%"select count(*) from pnodeRun(getTSDBSortKeyEntry{chunkIDs})</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__16">查询前 10 条数据耗时</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__17">59.5 s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__18"><code class="+ topic/ph pr-d/codeph ph codeph">timer select top 10 *  from loadTable(dbName, tableName)</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__16">按照 ID  和 tradeDate 点查耗时</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__17">4.5 s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__18"><code class="+ topic/ph pr-d/codeph ph codeph">timer select *  from loadTable(dbName, tableName) where ID = 1 and tradeDate = 2023.03.09</code></td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">实验分析</strong></p><p class="- topic/p p">当每个 sortKey 对应很少的数据量的时候，会产生以下几个问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">由于数据总量不变，导致 sortKey 非常多，索引信息占据大量内存。</li><li class="- topic/li li">数据碎片化存储，导致数据读写效率降低。</li><li class="- topic/li li">由于数据按照 block 进行压缩，而 block 是每个 sortKey 对应数据按照数据量进行划分的，若每个 block 数据量很少，压缩率也会降低。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">若要对上述场景进行优化</strong>，可通过设置 sortKeyMappingFunction 对 sortKey 字段进行降维处理。该场景下，我们对 ID 字段进行降维，降维函数为 hashBucket{,500}，该函数用于将每个分区的 sortKey 数量降为 500：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock cpp">db.createPartitionedTable(table=tbSchema,tableName=tbName,partitionColumns=`tradeDate,sortColumns=`ID`tradeDate`TradeTime,keepDuplicates=LAST, sortKeyMappingFunction=[hashBucket{,<span class="hl-number">500</span>},])</pre><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__31"><strong class="+ topic/ph hi-d/b ph b">属性</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__32"><strong class="+ topic/ph hi-d/b ph b">值</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="51-sortkey-数量对查询性能的影响__entry__33"><strong class="+ topic/ph hi-d/b ph b">查询脚本</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__31">落盘实际大小</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__32">2.88 G</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__33"><code class="+ topic/ph pr-d/codeph ph codeph">use opsgetTableDiskUsage(dbName, tableName)</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__31">sortKey 总数量</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__32">2,500</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__33"><code class="+ topic/ph pr-d/codeph ph codeph">chunkIDs = exec chunkID from pnodeRun(getChunksMeta{"/test_tsdb%"}) where dfsPath not like "%tbl%" and dfsPath not like "%domain%"select count(*) from pnodeRun(getTSDBSortKeyEntry{chunkIDs})</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__31">查询前 10 条数据耗时</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__32">104 ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__33"><code class="+ topic/ph pr-d/codeph ph codeph">timer select top 10 *  from loadTable(dbName, tableName)</code></td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__31">按照 ID  和 tradeDate 点查耗时</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__32">7.62 ms</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="51-sortkey-数量对查询性能的影响__entry__33"><code class="+ topic/ph pr-d/codeph ph codeph">timer select *  from loadTable(dbName, tableName) where ID = 1 and tradeDate = 2023.03.09</code></td></tr></tbody></table></div><p class="- topic/p p">可以看到降维后，实际落盘大小和查询性能都有显著提升。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title26" id="52-level-file-数量对查询性能的影响"><h3 class="- topic/title title topictitle3" id="ariaid-title26">5.2. Level File 数量对查询性能的影响</h3><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试场景</strong></p><p class="- topic/p p">不同去重策略下，Level File 合并前后对查询耗时的影响。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">数据表结构</strong></p><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__1"><strong class="+ topic/ph hi-d/b ph b">字段名</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__2"><strong class="+ topic/ph hi-d/b ph b">字段类型</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__1">machineId</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__2">INT</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__1">datetime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__2">TIMESTAMP</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__1">tag1~tag50</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__2">DOUBLE</td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">分区方案</strong></p><p class="- topic/p p">每日写入 100,000,000 条数据（约 3800 M，包含 100000 个设备），通过脚本写入 10 天的数据量。</p><ul class="- topic/ul ul"><li class="- topic/li li">分区方案：组合分区，按 datetime（VALUE）+  machineId（HASH 100）分区。每个分区约 400 M 数据。</li><li class="- topic/li li">排序列 sortColumns：machineId，datetime。machineId 将作为 sortKey。</li><li class="- topic/li li">去重规则 keepDuplicates：建表时，通过 keepDuplicates 参数配置不同的去重策略，进行测试。</li></ul><p class="- topic/p p">实际场景下，重复数据一般是由设备或通讯协议的机制产生的。一般数据重复率在 5% 左右。本实验模拟物联网场景下的数据产生，数据量也较贴合现实场景的数据重复率。</p><div class="table-container"><table class="- topic/table table" data-cols="6"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__9"><strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__10"><strong class="+ topic/ph hi-d/b ph b">数据量</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__11"><strong class="+ topic/ph hi-d/b ph b">合并前占用磁盘（GB）</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__12"><strong class="+ topic/ph hi-d/b ph b">合并后占用磁盘（GB）</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__13"><strong class="+ topic/ph hi-d/b ph b">合并前 Level File 文件数</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__14"><strong class="+ topic/ph hi-d/b ph b">合并后 Level File 文件数</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__9">ALL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__10">1,000,000,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__11">357.43</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__12">347.50</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__13">Level 0:9,000Level 1:1,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__14">Level 0:4,851Level 1:539Level 2:461</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__9">FIRST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__10">951,623,687</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__11">341.23</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__12">325.01</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__13">Level 0:9,000Level 1:1,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__14">Level 0:2,070Level 1:230Level 2:760</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__9">LAST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__10">951,624,331</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__11">341.23</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__12">324.04</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__13">Level 0:9,000Level 1:1,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__14">Level 0:1,656Level 1:184Level 2:816</td></tr></tbody></table></div><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">测试指标</strong></p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p">进行点查（命中 sortKey）</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from loadTable(dbName, tbName_all) where machineId=999</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__33"><strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__34"><strong class="+ topic/ph hi-d/b ph b">数据量</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__35"><strong class="+ topic/ph hi-d/b ph b">合并前耗时（ms）</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__36"><strong class="+ topic/ph hi-d/b ph b">合并后耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__33">ALL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__34">9,812</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__35">32.2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__36">28.5</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__33">FIRST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__34">9,541</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__35">27.7</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__36">26.7</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__33">LAST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__34">9,507</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__35">29.7</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__36">26.3</td></tr></tbody></table></div><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from loadTable(dbName, tbName_all) where machineId=999 and datetime=2023.07.10</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__49"><strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__50"><strong class="+ topic/ph hi-d/b ph b">数据量</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__51"><strong class="+ topic/ph hi-d/b ph b">合并前耗时（ms）</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__52"><strong class="+ topic/ph hi-d/b ph b">合并后耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__49">ALL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__50">1,054</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__51">8.7</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__52">8.2</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__49">FIRST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__50">916</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__51">7.6</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__52">6.6</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__49">LAST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__50">968</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__51">8.1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__52">6.8</td></tr></tbody></table></div><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from loadTable(dbName, tbName_all) where machineId=999 and datetime=2023.07.10 and datetime between 2023.07.10 09:00:01.000 and 2023.07.10 09:00:03.000</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__65"><strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__66"><strong class="+ topic/ph hi-d/b ph b">数据量</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__67"><strong class="+ topic/ph hi-d/b ph b">合并前耗时（ms）</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__68"><strong class="+ topic/ph hi-d/b ph b">合并后耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__65">ALL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__66">202</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__67">6.2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__68">6.1</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__65">FIRST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__66">201</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__67">5.8</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__68">5.8</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__65">LAST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__66">197</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__67">5.8</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__68">5.8</td></tr></tbody></table></div></li><li class="- topic/li li"><p class="- topic/p p">查询单个分区所有记录</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from loadTable(dbName, tbName_all) where datetime=2023.07.10</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__81"><strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__82"><strong class="+ topic/ph hi-d/b ph b">数据量</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__83"><strong class="+ topic/ph hi-d/b ph b">合并前耗时（ms）</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__84"><strong class="+ topic/ph hi-d/b ph b">合并后耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__81">ALL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__82">100,000,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__83">59,566.7</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__84">47,474.3</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__81">FIRST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__82">95,161,440</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__83">54,275.1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__84">46,069.2</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__81">LAST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__82">95,161,940</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__83">57,954.2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__84">44,443.1</td></tr></tbody></table></div></li><li class="- topic/li li"><p class="- topic/p p">查询全表的总记录数（命中元数据）</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select count(*) from loadTable(dbName, tbName)</code></pre><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__97"><strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__98"><strong class="+ topic/ph hi-d/b ph b">数据量</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__99"><strong class="+ topic/ph hi-d/b ph b">合并前耗时（ms）</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="52-level-file-数量对查询性能的影响__entry__100"><strong class="+ topic/ph hi-d/b ph b">合并后耗时（ms）</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__97">ALL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__98">1,000,000,000</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__99">218.9</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__100">216.8</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__97">FIRST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__98">951,623,687</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__99">6,324.1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__100">1,180.9</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__97">LAST</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__98">951,624,331</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__99">6,470.2</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="52-level-file-数量对查询性能的影响__entry__100">958.7</td></tr></tbody></table></div></li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">实验分析</strong></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（一）</strong> 对比 Level File 合并前后，每个查询语句性能的区别：</p><ul class="- topic/ul ul"><li class="- topic/li li">在不去重的场景下（<strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong>=ALL），整体提升不显著，但在遍历整个分区数据时，由于文件数据减少，查询性能提升约 20 %。</li><li class="- topic/li li">在去重的场景下（<strong class="+ topic/ph hi-d/b ph b">keepDuplicates</strong>=LAST / FIRST）：<ul class="- topic/ul ul"><li class="- topic/li li">命中 sortKey 的查询语句：性能几乎不受 Level File 文件合并的影响。</li><li class="- topic/li li">遍历分区的查询语句：性能在合并后会略所提升，约为 15 % 左右。</li><li class="- topic/li li">命中元数据的查询语句：性能在合并前后提升较为显著，约提升 6 倍。</li></ul></li></ul><p class="- topic/p p">从内部机制分析，合并 Level File 对性能的影响主要在：</p><ul class="- topic/ul ul"><li class="- topic/li li">由于文件数减少，磁盘的寻道时间减少。但在查询数量大的场景下，磁盘的寻道时间可以忽略。</li><li class="- topic/li li">合并后重复数据减少，从而使数据去重的耗时也减少。</li><li class="- topic/li li">合并后文件数减少，从而使查询遍历的开销也减少。</li></ul><p class="- topic/p p">Level File 的去重操作是在合并阶段完成的。若磁盘上存在较多的重复数据，查询时，会将这些数据全部读取到内存再进行去重。<strong class="+ topic/ph hi-d/b ph b">冗余的重复数据越多，这一步骤的耗时开销越显著</strong>。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">（二）</strong> 对比使用三种不同的去重策略时，每个查询语句性能的区别：</p><ul class="- topic/ul ul"><li class="- topic/li li">命中 sortKey 的查询语句：三种去重策略性查询性能相差不大。</li><li class="- topic/li li">遍历分区的查询语句：ALL 策略的查询性能会略低于 FIRST 和 LAST 策略，主要是因为 ALL 策略无需去重，FIRST 和 LAST 都有一定的去重开销。</li><li class="- topic/li li">命中元数据的查询语句：ALL 的性能明显优于 FIRST 和 LAST（ALL 性能约为 FIRST/LAST 的 30 倍），这是因为 ALL 只需要读元数据即可，FIRST，ALL 需要对数据去重后进行统计，开销较大。</li></ul><p class="- topic/p p">不同的查询策略对性能的影响主要在：</p><ul class="- topic/ul ul"><li class="- topic/li li">ALL 策略文件数较 FIRST 和 LAST 策略多，理论上磁盘寻道时间应该更长，但在查询数量大的场景下，磁盘的寻道时间可以忽略。</li><li class="- topic/li li">ALL 策略在查询时无需去重，而 FIRST 和 LAST 策略在查询时，需要读出所有满足查询条件的数据，然后在内存中进行去重操作，这一步较为耗时。</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">实验结论</strong></p><p class="- topic/p p">在 Level File 文件数较多的场景下，若数据存在重复并设置了去重策略，则 Level  File 文件合并后，遍历分区和命中元数据的查询语句性能会显著提升，点查性能提升不明显；若数据重复率低，或者未设置去重机制，则文件合并前后，查询性能提升较小。</p><p class="- topic/p p">参考 Level File 合并章节，DolphinDB TSDB 引擎内置了 Level File 的自动合并机制，依靠自动合并，大部分场景下 Level File 数量不会成为查询性能的瓶颈。</p><p class="- topic/p p">若自动合并后，Level File 数量仍比较多，且满足下述场景：</p><ul class="- topic/ul ul"><li class="- topic/li li">数据重复率较高</li><li class="- topic/li li">数据已经入库，不再变化（后续不再修改和写入）</li></ul><p class="- topic/p p">用户也可以在线调用函数 <a class="- topic/xref xref" href="../funcs/t/triggerTSDBCompaction.html">triggerTSDBCompaction</a>  手动触发合并，以减少文件数，<strong class="+ topic/ph hi-d/b ph b">提升查询性能</strong>。合并状态可以通过调用函数 <a class="- topic/xref xref" href="../funcs/g/getTSDBCompactionTaskStatus.html">getTSDBCompactionTaskStatus</a>  进行查询。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title27" id="6-tsdb-引擎场景实践案例"><h2 class="- topic/title title topictitle2" id="ariaid-title27">6. TSDB 引擎场景实践案例</h2><div class="- topic/body body"><p class="- topic/p p">本章汇总了 DolphinDB 教程中 TSDB 引擎相关的实践案例，供大家快速索引。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title28" id="61-金融场景"><h3 class="- topic/title title topictitle3" id="ariaid-title28">6.1. 金融场景</h3><div class="- topic/body body"><div class="table-container"><table class="- topic/table table" data-cols="5"><caption></caption><colgroup><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="61-金融场景__entry__1"><strong class="+ topic/ph hi-d/b ph b">场景</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="61-金融场景__entry__2"><strong class="+ topic/ph hi-d/b ph b">教程链接</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="61-金融场景__entry__3"><strong class="+ topic/ph hi-d/b ph b">场景描述</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="61-金融场景__entry__4"><strong class="+ topic/ph hi-d/b ph b">存储方案</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__1">中高频多因子库存储</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__2"><a class="- topic/xref xref" href="best_practices_for_multi_factor.html">中高频多因子库存储最佳实践</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__3">测试 TSDB 宽表存储和 TSDB 窄表存储，在 HDD 和 SDD 这两种不同的硬件配置下的存储性能。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__4">推荐采用 TSDB 窄表存储</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__1">Level 2 行情数据存储</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__2"><a class="- topic/xref xref" href="LoadDataForPoc.html">金融 PoC 用户历史数据导入指导手册之股票 level2 逐笔篇</a> <a class="- topic/xref xref" href="l2_stk_data_proc.html">处理 Level 2 行情数据实例</a> <a class="- topic/xref xref" href="appendices_market_replay_bp.html">搭建行情回放服务的最佳实践</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__3">介绍行情快照、逐笔委托、逐笔成交的存储方案，以及数据导入的处理流程。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__4" colspan="2">引擎：TSDB分区方案：交易日按值分区 + 标的哈希 20 分区sortColumns：market，SecurityID，TradeTime</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__1">公募基金数据存储</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__2"><a class="- topic/xref xref" href="public_fund_basic_analysis.html">公募基金历史数据基础分析教程</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__3">提供公开市场数据导入 TSDB 引擎的示例脚本。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__4">数据量较小，故存储为 TSDB 引擎维度表，sortColumns 为日期列。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__1">实时波动率预测</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__2"><a class="- topic/xref xref" href="ml_volatility.html">金融实时实际波动率预测</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__3">比较数据预处理阶段，OLAP 引擎和 TSDB 引擎的存储效率。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__4">使用 TSDB 引擎，将多档数据以 <a class="- topic/xref xref" href="../progr/data_types_forms/arrayVector.html">Array Vector</a> 的形式存储，原 40 列数据合并为 4 列，在数据压缩率、数据查询和计算性能上都会有大幅提升。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__1">ETL 数据清洗优化</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__2"><a class="- topic/xref xref" href="data_ETL.html">利用 DolphinDB 高效清洗数据</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__3">优化 ETL 数据清洗流程的性能。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="61-金融场景__entry__4" colspan="2">利用 TSDB 的索引机制，可以通过扫描稀疏索引文件，来查询对应的数据块 ID。进而只读取对应数据块，从而避免全表扫描。</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title29" id="62-物联网场景"><h3 class="- topic/title title topictitle3" id="ariaid-title29">6.2. 物联网场景</h3><div class="- topic/body body"><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="62-物联网场景__entry__1"><strong class="+ topic/ph hi-d/b ph b">案例</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="62-物联网场景__entry__2"><strong class="+ topic/ph hi-d/b ph b">教程链接</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="62-物联网场景__entry__3"><strong class="+ topic/ph hi-d/b ph b">场景描述</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="62-物联网场景__entry__4"><strong class="+ topic/ph hi-d/b ph b">存储方案</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__1">地震波形数据存储</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__2"><a class="- topic/xref xref" href="waveform_data_storage.html">地震波形数据存储解决方案</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__3">介绍地震波形数据的存储方案，包含分区方案和字段压缩方案。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__4">引擎：TSDB 分区方案：设备 ID 值分区 + 按天值分区 sortColumns：设备 ID + 时间戳</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__1">实时数据异常预警：流数据入库存储</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__2"><a class="- topic/xref xref" href="knn_iot.html">物联网实时数据异常率预警</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__3">数据预警场景，订阅数据持久化部分采用 TSDB 引擎存储。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="62-物联网场景__entry__4"><strong class="+ topic/ph hi-d/b ph b">消费数据入库：</strong>引擎：TSDB分区方案：设备代码值分区 + 按小时值分区sortColumns：设备代码 + 时间戳 <strong class="+ topic/ph hi-d/b ph b">聚合计算结果入库：</strong>引擎：TSDB分区方案：设备代码值分区 + 按天值分区sortColumns：设备代码 + 时间戳</td></tr></tbody></table></div></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title30" id="7-总结"><h2 class="- topic/title title topictitle2" id="ariaid-title30">7. 总结</h2><div class="- topic/body body"><p class="- topic/p p">TSDB 引擎较 OLAP 引擎而言，内部实现机制更加复杂，对用户开放的配置也更多样。在使用时，需要根据用户的数据特性和查询场景，设置合理的去重机制和 sortColumns，才能够发挥 TSDB 的最佳性能。</p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">TSDB 引擎使用注意点汇总：</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">由于导入数据时的内存占用可能达到 TSDBCacheEngineSize 的两倍，因此用户需要根据导数据量以及内存情况，合理设置 TSDBCacheEngine 的大小。</li><li class="- topic/li li">合理设置 sortColumns 字段(建议不超过 4 列)，一个通用原则是：确保每个分区的 sortKey 组合数不超过 2000，以及每个 sortColumns 对应的数据量不能过少。</li><li class="- topic/li li">若查询性能较差，在引擎层面，可以从两个方面进行排查：<ul class="- topic/ul ul"><li class="- topic/li li">sortKey 组合数是否过多（可以在创建分布式表时指定 sortKeyMappingFunction 进行降维）。</li><li class="- topic/li li">Level File 文件数是否过多（可以手动调用 triggerTSDBCompaction 触发合并，减少 Level File 文件数）。</li></ul></li></ul></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title31" id="8-附录"><h2 class="- topic/title title topictitle2" id="ariaid-title31">8. 附录</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title32" id="81-tsdb-引擎配置项汇总"><h3 class="- topic/title title topictitle3" id="ariaid-title32">8.1. TSDB 引擎配置项汇总</h3><div class="- topic/body body"><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="81-tsdb-引擎配置项汇总__entry__1"><strong class="+ topic/ph hi-d/b ph b">功能</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="81-tsdb-引擎配置项汇总__entry__2"><strong class="+ topic/ph hi-d/b ph b">配置项</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="81-tsdb-引擎配置项汇总__entry__3"><strong class="+ topic/ph hi-d/b ph b">描述</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__1">Redo</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__2">TSDBRedoLogDir</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__3">TSDB 存储引擎重做日志的目录</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__1">Cache Engine</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__2">TSDBCacheEngineSize  TSDBCacheTableBufferThreshold  TSDBCacheFlushWorkNum   TSDBAsyncSortingWorkerNum</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__3">设置 TSDB 存储引擎 cache engine 的容量（单位为 GB）  TSDB 引擎缓存数据进行批量排序的阈值 TSDB cache engine 刷盘的工作线程数  TSDB cache engine 异步排序的工作线程数</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__1">Index</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__2">TSDBLevelFileIndexCacheSize  TSDBLevelFileIndexCacheInvalidPercent</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__3">TSDB 存储引擎 level file 元数据内存占用空间上限  TSDB 引擎 level file 索引缓存淘汰后保留数据的百分比。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__1">SYMBOL 字段的缓存</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__2">TSDBSymbolBaseEvictTime  TSDBCachedSymbolBaseCapacity</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="81-tsdb-引擎配置项汇总__entry__3">TSDB 存储引擎 symbolBase 内存占用空间上限及缓存管理策略。</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title33" id="82-tsdb-引擎运维函数汇总"><h3 class="- topic/title title topictitle3" id="ariaid-title33">8.2. TSDB 引擎运维函数汇总</h3><div class="- topic/body body"><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="82-tsdb-引擎运维函数汇总__entry__1"><strong class="+ topic/ph hi-d/b ph b">功能</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="82-tsdb-引擎运维函数汇总__entry__2"><strong class="+ topic/ph hi-d/b ph b">函数</strong></th><th class="- topic/entry entry colsep-0 rowsep-0" id="82-tsdb-引擎运维函数汇总__entry__3"><strong class="+ topic/ph hi-d/b ph b">描述</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__1">Level File 合并</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__2"><a class="- topic/xref xref" href="../funcs/t/triggerTSDBCompaction.html">triggerTSDBCompaction</a>  <a class="- topic/xref xref" href="../funcs/g/getTSDBCompactionTaskStatus.html">getTSDBCompactionTaskStatus</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__3">触发合并   获取合并任务状态</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__1">异步排序</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__2"><a class="- topic/xref xref" href="../funcs/e/enableTSDBAsyncSorting.html">enableTSDBAsyncSorting</a>  <a class="- topic/xref xref" href="../funcs/d/disableTSDBAsyncSorting.html">disableTSDBAsyncSorting</a> </td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__3">开启异步排  关闭异步排序序</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__1">Cache Engine</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__2"><a class="- topic/xref xref" href="../funcs/f/flushTSDBCache.html">flushTSDBCache</a>   <a class="- topic/xref xref" href="../funcs/s/setTSDBCacheEngineSize.html">setTSDBCacheEngineSize</a> <a class="- topic/xref xref" href="../funcs/g/getTSDBCacheEngineSize.html">getTSDBCacheEngineSize</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__3">将 TSDB Cache Engine 中的数据强制刷盘   设置 TSDB Cache Engine 的内存大小   获取 TSDB Cache Engine 的内存大小</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__1">索引</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__2"><a class="- topic/xref xref" href="../funcs/g/getLevelFileIndexCacheStats.html">getLevelFileIndexCacheStatus</a>  invalidateLevelIndexCache</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__3">获取所有 level file 的索引内存占用的情况      手动删除索引缓存</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__1">SYMBOL 字段的缓存</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__2"><a class="- topic/xref xref" href="../funcs/g/getTSDBCachedSymbolBaseMemSize.html">getTSDBCachedSymbolBaseMemSize</a>  <a class="- topic/xref xref" href="../funcs/c/clearalltsdbsymbolbasecache.html">clearAllTSDBSymbolBaseCache</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__3">获取 TSDB 引擎中 SYMBOL 类型的字典编码的缓存大小。   清除SYMBOL 类型的字典编码的缓存</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__1">元数据信息</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__2"><a class="- topic/xref xref" href="../funcs/g/getTSDBMetaData.html">getTSDBMetaData</a>  <a class="- topic/xref xref" href="../funcs/g/getTSDBSortKeyEntry.html">getTSDBSortKeyEntry</a></td><td class="- topic/entry entry colsep-0 rowsep-0" headers="82-tsdb-引擎运维函数汇总__entry__3">获取 TSDB 引擎 chunk 的元数据信息   获取 TSDB 引擎已经写入磁盘的 chunk 的 sort key 信息</td></tr></tbody></table></div><p class="- topic/p p">触发集群中所有分区 Level File 合并脚本参考：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock cpp"><em class="hl-comment">// dbName 需要替换成自己的数据库名</em>
chunkIDs = exec * from pnodeRun(getChunksMeta{<span class="hl-string">"/dbName/%"</span>}) where type=<span class="hl-number">1</span>
<strong class="hl-keyword">for</strong>(chunkID in chunkIDs){
    pnodeRun(triggerTSDBCompaction{chunkID})
}
<em class="hl-comment">// 检查是否完成 Level File 合并</em>
select * from pnodeRun(getTSDBCompactionTaskStatus) where endTime is null</pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title34" id="83-常见问题-q--a"><h3 class="- topic/title title topictitle3" id="ariaid-title34">8.3. 常见问题 Q &amp; A</h3><div class="- topic/body body"><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col style="width: 590px"/><col style="width: 770px"/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="83-常见问题-q--a__entry__1">问题<br/></th><th class="- topic/entry entry colsep-0 rowsep-0" id="83-常见问题-q--a__entry__2">回答<br/></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__1">创建报错 TSDB engine is not enabled.</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__2">1. 检查 server 版本是否为 2.00 版本，1.30 版本不支持 TSDB 引擎。<br/><br/>2. 检查配置文件是否设置了 TSDBCacheEngineSize 配置项。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__1">TSDB 更新数据后，查询发现更新的数据出现在表末尾，而不是按时间序排序。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__2">TSDB 引擎只保证 level file 内部是有序的，但是 level file 间可能是无序的，可以尝试通过调用 triggerTSDBCompaction 函数手动触发 level file 文件的合并。<br/> </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__1">1.30 版本的 server 和 2.00 版本有什么区别？</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__2">相较于 1.30 版本，2.00 版本还支持了 TSDB 引擎，array vector 数据形式，DECIMAL 数据类型等功能。</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__1">如果希望表的数据写入后去重，可以使用 TSDB 引擎，然后将 sortColumns 设置为去重键吗？</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__2">- 如果去重键只有一个字段，不建议设置为 sortColumns，因为此时该字段会被作为 sortKey，去重后，一个 sortKey 只对应一条记录，会造成索引膨胀，影响查询效率。<br/><br/>- 如果去重键有多个字段，需要评估每个 sortKey 对应的数据量，若数据量很少，不建议将其设置为 sortColumns。<br/><br/>推荐使用 upsert! 方法写入数据，以达到数据去重的目的。 </td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__1">TSDB 引擎查询性能低于预期。</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="83-常见问题-q--a__entry__2">- sortKey 字段设置是否合理，可以调用 getTSDBSortKeyEntry 函数查询 sortKey 的信息。<br/><br/>- LevelFile 的索引缓存是否设置过小。若每次查询设计的数据范围较大，可能造成索引的频繁置换，此时可以通过调整配置项 TSDBLevelFileIndexCacheSize，来调大索引的缓存空间，调整后需重启集群。</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title35" id="84-案例脚本"><h3 class="- topic/title title topictitle3" id="ariaid-title35">8.4. 案例脚本</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="script/tsdb_explained/test_5_1.dos">test_5_._1.dos</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/tsdb_explained/test_5_2.dos">test_5_._2.dos</a></li></ul></div></article></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E9%98%85%E8%AF%BB%E6%8C%87%E5%8D%97" data-tocid="1-阅读指南">1. 阅读指南</a></li><li class="topic-item"><a href="#2-tsdb-vs-olap" data-tocid="2-tsdb-vs-olap">2. TSDB vs OLAP</a><ul><li class="topic-item"><a href="#21-%E6%9C%AF%E8%AF%AD%E5%AF%B9%E7%85%A7" data-tocid="21-术语对照">2.1. 术语对照</a></li></ul></li><li class="topic-item"><a href="#3-tsdb-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%9E%B6%E6%9E%84" data-tocid="3-tsdb-存储引擎架构">3. TSDB 存储引擎架构</a><ul><li class="topic-item"><a href="#31-lsm-tree" data-tocid="31-lsm-tree">3.1. LSM-Tree</a></li><li class="topic-item"><a href="#32-tsdb-%E5%BC%95%E6%93%8E-crud-%E6%B5%81%E7%A8%8B" data-tocid="32-tsdb-引擎-crud-流程">3.2. TSDB 引擎 CRUD 流程</a><ul><li class="topic-item"><a href="#321-%E5%86%99%E5%85%A5%E6%B5%81%E7%A8%8B" data-tocid="321-写入流程">3.2.1. 写入流程</a></li><li class="topic-item"><a href="#322-%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B" data-tocid="322-查询流程">3.2.2. 查询流程</a></li><li class="topic-item"><a href="#323-%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B" data-tocid="323-更新流程">3.2.3. 更新流程</a></li><li class="topic-item"><a href="#324-%E5%88%A0%E9%99%A4%E6%B5%81%E7%A8%8B" data-tocid="324-删除流程">3.2.4. 删除流程</a></li></ul></li><li class="topic-item"><a href="#33-%E6%8E%92%E5%BA%8F%E5%88%97-sortcolumns" data-tocid="33-排序列-sortcolumns">3.3. 排序列 sortColumns</a><ul><li class="topic-item"><a href="#331-%E7%A1%AE%E5%AE%9A%E7%B4%A2%E5%BC%95%E9%94%AE%E5%80%BC" data-tocid="331-确定索引键值">3.3.1. 确定索引键值</a></li><li class="topic-item"><a href="#332-%E6%95%B0%E6%8D%AE%E6%8E%92%E5%BA%8F" data-tocid="332-数据排序">3.3.2. 数据排序</a></li><li class="topic-item"><a href="#333-%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D" data-tocid="333-数据去重">3.3.3. 数据去重</a></li></ul></li><li class="topic-item"><a href="#34-level-file-%E6%96%87%E4%BB%B6" data-tocid="34-level-file-文件">3.4. Level File 文件</a><ul><li class="topic-item"><a href="#341-level-file-%E7%9A%84%E7%BB%84%E6%88%90" data-tocid="341-level-file-的组成">3.4.1. Level File 的组成</a></li><li class="topic-item"><a href="#342-level-file-%E5%B1%82%E7%BA%A7%E7%BB%84%E7%BB%87" data-tocid="342-level-file-层级组织">3.4.2. Level File 层级组织</a></li><li class="topic-item"><a href="#343-level-file-%E5%90%88%E5%B9%B6" data-tocid="343-level-file-合并">3.4.3. Level File 合并</a></li></ul></li></ul></li><li class="topic-item"><a href="#4-%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8-tsdb-%E5%BC%95%E6%93%8E" data-tocid="4-合理使用-tsdb-引擎">4. 合理使用 TSDB 引擎</a><ul><li class="topic-item"><a href="#41-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%83%A8%E7%BD%B2" data-tocid="41-数据库部署">4.1. 数据库部署</a></li><li class="topic-item"><a href="#42-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93" data-tocid="42-创建数据库">4.2. 创建数据库</a></li><li class="topic-item"><a href="#43-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8" data-tocid="43-创建数据表">4.3. 创建数据表</a></li></ul></li><li class="topic-item"><a href="#5-tsdb-%E5%BC%95%E6%93%8E%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B" data-tocid="5-tsdb-引擎查询优化案例">5. TSDB 引擎查询优化案例</a><ul><li class="topic-item"><a href="#51-sortkey-%E6%95%B0%E9%87%8F%E5%AF%B9%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D" data-tocid="51-sortkey-数量对查询性能的影响">5.1. sortKey 数量对查询性能的影响</a></li><li class="topic-item"><a href="#52-level-file-%E6%95%B0%E9%87%8F%E5%AF%B9%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D" data-tocid="52-level-file-数量对查询性能的影响">5.2. Level File 数量对查询性能的影响</a></li></ul></li><li class="topic-item"><a href="#6-tsdb-%E5%BC%95%E6%93%8E%E5%9C%BA%E6%99%AF%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B" data-tocid="6-tsdb-引擎场景实践案例">6. TSDB 引擎场景实践案例</a><ul><li class="topic-item"><a href="#61-%E9%87%91%E8%9E%8D%E5%9C%BA%E6%99%AF" data-tocid="61-金融场景">6.1. 金融场景</a></li><li class="topic-item"><a href="#62-%E7%89%A9%E8%81%94%E7%BD%91%E5%9C%BA%E6%99%AF" data-tocid="62-物联网场景">6.2. 物联网场景</a></li></ul></li><li class="topic-item"><a href="#7-%E6%80%BB%E7%BB%93" data-tocid="7-总结">7. 总结</a></li><li class="topic-item"><a href="#8-%E9%99%84%E5%BD%95" data-tocid="8-附录">8. 附录</a><ul><li class="topic-item"><a href="#81-tsdb-%E5%BC%95%E6%93%8E%E9%85%8D%E7%BD%AE%E9%A1%B9%E6%B1%87%E6%80%BB" data-tocid="81-tsdb-引擎配置项汇总">8.1. TSDB 引擎配置项汇总</a></li><li class="topic-item"><a href="#82-tsdb-%E5%BC%95%E6%93%8E%E8%BF%90%E7%BB%B4%E5%87%BD%E6%95%B0%E6%B1%87%E6%80%BB" data-tocid="82-tsdb-引擎运维函数汇总">8.2. TSDB 引擎运维函数汇总</a></li><li class="topic-item"><a href="#83-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-q--a" data-tocid="83-常见问题-q--a">8.3. 常见问题 Q &amp; A</a></li><li class="topic-item"><a href="#84-%E6%A1%88%E4%BE%8B%E8%84%9A%E6%9C%AC" data-tocid="84-案例脚本">8.4. 案例脚本</a></li></ul></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2025 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>